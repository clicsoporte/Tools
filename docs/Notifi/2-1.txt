################################################################################
Archivo: novu-next/apps/web/src/studio/utils/shared.styles.ts
Tamaño: 355 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { css } from '@novu/novui/css';

/**
 * TODO: this should be refined and extracted to novui.
 */
export const truncatedFlexTextCss = css.raw({
  overflow: 'hidden',
  whiteSpace: 'nowrap',

  '& svg': {
    flexShrink: '0',
  },

  '& p, & h1, & h2, & h3': {
    overflow: 'hidden',
    whiteSpace: 'nowrap',
    textOverflow: 'ellipsis',
  },
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/studio/utils/variables.ts
Tamaño: 717 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SystemVariablesWithTypes } from '@novu/shared';

export function getSuggestionVariables(schemaObject, namespace: string) {
  return Object.keys(schemaObject)
    .flatMap((name) => {
      const schemaItem = schemaObject[name];
      if (schemaItem?.type === 'object') {
        return getSuggestionVariables(schemaItem.properties, `${namespace}.${name}`);
      }
      if (schemaItem?.type === 'array') {
        // TODO: determine how we should handle dynamic (array-based controls)

        return;
      }

      return `${namespace}.${name}`;
    })
    .filter((variable) => !!variable);
}

export const subscriberVariables = getSuggestionVariables(SystemVariablesWithTypes.subscriber, 'subscriber');


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getSuggestionVariables(schemaObject, namespace: string)
Declaraciones 'export' encontradas:
- export function getSuggestionVariables
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/testing/index.tsx
Tamaño: 1083 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { ReactNode } from 'react';
import styled from '@emotion/styled';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { MemoryRouter, MemoryRouterProps } from 'react-router-dom';
import { ThemeProvider } from '@novu/design-system';

import { SegmentProvider } from '../components/providers/SegmentProvider';

const queryClient = new QueryClient();

export function TestWrapper({
  children,
  initialEntries,
}: {
  children: ReactNode;
  initialEntries?: MemoryRouterProps['initialEntries'];
}) {
  return (
    <QueryClientProvider client={queryClient}>
      <MemoryRouter initialEntries={initialEntries}>
        <SegmentProvider>
          <Wrapper>
            <Frame>
              <ThemeProvider>{children}</ThemeProvider>
            </Frame>
          </Wrapper>
        </SegmentProvider>
      </MemoryRouter>
    </QueryClientProvider>
  );
}

const Frame = styled.div`
  min-width: 500px;
  display: inline-block;
`;

const Wrapper = styled.div`
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { ReactNode } from 'react';
import styled from '@emotion/styled';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { MemoryRouter, MemoryRouterProps } from 'react-router-dom';
import { ThemeProvider } from '@novu/design-system';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/web/src/types/FCBase.ts
Tamaño: 107 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FC } from 'react';

export type FCBase<P = unknown> = FC<P & { className?: string | undefined }>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/types/FCWithChildren.ts
Tamaño: 160 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FC, ReactNode } from 'react';

export type FCWithChildren<P = unknown> = FC<P & { children?: ReactNode | undefined; className?: string | undefined }>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/types/LocalizedMessage.ts
Tamaño: 339 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * @deprecated Use LocalizedMessage from @novu/novui.
 * Indicates a string that is expect to already be localized before being passed as a parameter / prop.
 *
 * Note: this is forward-thinking to minimize accruing new tech debt when we implement i18n!
 */
export type LocalizedMessage = string | React.ReactNode | React.ReactNode[];


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/types/index.ts
Tamaño: 60 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './FCWithChildren';
export * from './FCBase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/channels.ts
Tamaño: 2858 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, StepTypeEnum } from '@novu/shared';
import React from 'react';
import {
  ChatFilled,
  DelayAction,
  DigestAction,
  EmailFilled,
  InAppFilled,
  PushFilled,
  SmsFilled,
  Bolt,
} from '@novu/design-system';

export enum NodeTypeEnum {
  CHANNEL = 'channel',
  ACTION = 'action',
}

interface IChannelDefinition {
  tabKey: StepTypeEnum;
  label: string;
  description: string;
  Icon: React.FC<any>;
  testId: string;
  channelType: StepTypeEnum;
  type: NodeTypeEnum;
}

export const CHANNEL_TYPE_TO_STRING: Record<ChannelTypeEnum, string> = {
  [ChannelTypeEnum.IN_APP]: 'In-App',
  [ChannelTypeEnum.EMAIL]: 'Email',
  [ChannelTypeEnum.SMS]: 'SMS',
  [ChannelTypeEnum.CHAT]: 'Chat',
  [ChannelTypeEnum.PUSH]: 'Push',
};

export const channels: IChannelDefinition[] = [
  {
    tabKey: StepTypeEnum.IN_APP,
    label: 'In-App',
    description: 'Send notifications to the in-app notification center',
    Icon: InAppFilled,
    testId: 'inAppSelector',
    channelType: StepTypeEnum.IN_APP,
    type: NodeTypeEnum.CHANNEL,
  },
  {
    tabKey: StepTypeEnum.EMAIL,
    label: 'Email',
    description: 'Send using one of our email integrations',
    Icon: EmailFilled,
    testId: 'emailSelector',
    channelType: StepTypeEnum.EMAIL,
    type: NodeTypeEnum.CHANNEL,
  },
  {
    tabKey: StepTypeEnum.SMS,
    label: 'SMS',
    description: "Send an SMS directly to the user's phone",
    Icon: SmsFilled,
    testId: 'smsSelector',
    channelType: StepTypeEnum.SMS,
    type: NodeTypeEnum.CHANNEL,
  },
  {
    tabKey: StepTypeEnum.DIGEST,
    label: 'Digest',
    description: 'Aggregate events triggered to one notification',
    Icon: DigestAction,
    testId: 'digestSelector',
    channelType: StepTypeEnum.DIGEST,
    type: NodeTypeEnum.ACTION,
  },
  {
    tabKey: StepTypeEnum.DELAY,
    label: 'Delay',
    description: 'Delay before trigger of next event',
    Icon: DelayAction,
    testId: 'delaySelector',
    channelType: StepTypeEnum.DELAY,
    type: NodeTypeEnum.ACTION,
  },
  {
    tabKey: StepTypeEnum.CUSTOM,
    label: 'Custom',
    description: 'Run custom code',
    Icon: Bolt,
    testId: 'customSelector',
    channelType: StepTypeEnum.CUSTOM,
    type: NodeTypeEnum.ACTION,
  },
  {
    tabKey: StepTypeEnum.CHAT,
    label: 'Chat',
    description: 'Send a chat message',
    Icon: ChatFilled,
    testId: 'chatSelector',
    channelType: StepTypeEnum.CHAT,
    type: NodeTypeEnum.CHANNEL,
  },
  {
    tabKey: StepTypeEnum.PUSH,
    label: 'Push',
    description: "Send an Push Notification to a user's device",
    Icon: PushFilled,
    testId: 'pushSelector',
    channelType: StepTypeEnum.PUSH,
    type: NodeTypeEnum.CHANNEL,
  },
];

export const getChannel = (channelKey?: string): IChannelDefinition | undefined => {
  return channels.find((channel) => channel.tabKey === channelKey);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getChannel(channelKey?: string): IChannelDefinition | undefined)
Declaraciones 'export' encontradas:
- export  enum
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/codeSnippets.ts
Tamaño: 4862 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { API_ROOT } from '../config/index';

export type CodeSnippetProps = {
  identifier: string;
  to: Record<string, unknown>;
  payload: Record<string, unknown>;
  overrides?: Record<string, unknown>;
  snippet?: Record<string, unknown>;
  secretKey?: string;
  bridgeUrl?: string;
};

const SECRET_KEY_ENV_KEY = 'NOVU_SECRET_KEY';

const normalizePayload = (originalPayload: Record<string, unknown>) => {
  if (originalPayload?.__source) {
    // Remove internal params
    const { __source, ...payload } = originalPayload;

    return payload;
  }

  return originalPayload;
};
export const createNodeSnippet = ({ identifier, to, payload, overrides, snippet, secretKey }: CodeSnippetProps) => {
  const renderedSecretKey = secretKey ? `'${secretKey}'` : `process.env['${SECRET_KEY_ENV_KEY}']`;

  return `import { Novu } from '@novu/node'; 

const novu = new Novu(${renderedSecretKey});

novu.trigger('${identifier}', ${JSON.stringify(
    {
      to,
      payload: normalizePayload(payload),
      overrides,
      ...snippet,
    },
    null,
    2
  )
    .replace(/"([^"]+)":/g, '$1:')
    .replace(/"/g, "'")});
`;
};

export const createCurlSnippet = ({
  identifier,
  to,
  payload,
  overrides,
  snippet,
  bridgeUrl,
  secretKey = SECRET_KEY_ENV_KEY,
}: CodeSnippetProps) => {
  return `curl -X POST '${API_ROOT}/v1/events/trigger' \\
-H 'Authorization: ApiKey ${secretKey}' \\
-H 'Content-Type: application/json' \\
-d '${JSON.stringify(
    {
      name: identifier,
      to,
      payload: normalizePayload(payload),
      overrides,
      bridgeUrl,
      ...snippet,
    },
    null,
    2
  )}'
  `;
};

const transformJsonToPhpArray = (data: Record<string, unknown>, indentLevel = 4) => {
  const entries = Object.entries(data);
  const indent = ' '.repeat(indentLevel);

  const obj = entries
    .map(([key, value]) => {
      return `
${indent}'${key}' => ${JSON.stringify(value)},`;
    })
    .join('')
    .replace(/"/g, "'");

  return `${obj}${Object.keys(data).length > 0 ? `\n${new Array(indentLevel - 4).fill(' ').join('')}` : ''}`;
};

export const createPhpSnippet = ({ identifier, to, payload, secretKey }: CodeSnippetProps) => {
  const renderedSecretKey = secretKey ? `'${secretKey}'` : `getenv('${SECRET_KEY_ENV_KEY}')`;

  return `use Novu\\SDK\\Novu;

$novu = new Novu(${renderedSecretKey});

$response = $novu->triggerEvent([
    'name' => '${identifier}',
    'payload' => [${transformJsonToPhpArray(normalizePayload(payload), 8)}],
    'to' => [${transformJsonToPhpArray(to, 8)}],
])->toArray();`;
};

const transformJsonToPythonDict = (data: Record<string, unknown>, tabSpaces = 4): string => {
  const entries = Object.entries(data);
  const indent = ' '.repeat(tabSpaces);

  const obj = entries
    .map(([key, value]) => {
      return `
${indent}"${key}": ${JSON.stringify(value)},`;
    })
    .join('');

  return `${obj}${entries.length > 0 ? `\n${new Array(tabSpaces - 2).fill(' ').join('')}` : ''}`;
};

export const createPythonSnippet = ({
  identifier,
  to,
  payload,
  snippet = { test: 'value' },
  secretKey,
}: CodeSnippetProps) => {
  const renderedSecretKey = secretKey ? `'${secretKey}'` : `os.environ['${SECRET_KEY_ENV_KEY}']`;

  return `from novu.api import EventApi

url = "${API_ROOT}"

novu = EventApi(url, ${renderedSecretKey}).trigger(
    name="${identifier}",
    recipients={${to.subscriberId as string}},
    payload={${transformJsonToPythonDict(normalizePayload(payload), 6)}},
)`;
};

const transformJsonToGoMap = (data: Record<string, unknown>, tabSpaces = 4): string => {
  const entries = Object.entries(data);
  const indent = ' '.repeat(tabSpaces);

  const obj = entries
    .map(([key, value]) => {
      return `
${indent}"${key}": ${JSON.stringify(value)},`;
    })
    .join('');

  return `${obj}${entries.length > 0 ? `\n${new Array(tabSpaces - 4).fill(' ').join('')}` : ''}`;
};

export const createGoSnippet = ({ identifier, to, payload, snippet, secretKey }: CodeSnippetProps) => {
  const renderedSecretKey = secretKey ? `"${secretKey}"` : `os.Getenv("${SECRET_KEY_ENV_KEY}")`;

  return `package main

import (
	"context"
	"fmt"
	novu "github.com/novuhq/go-novu/lib"
	"log"
)

func main() {
	ctx := context.Background()
	to := map[string]interface{}{${transformJsonToGoMap(to, 8)}}
	payload := map[string]interface{}{${transformJsonToGoMap(normalizePayload(payload), 8)}}
	data := novu.ITriggerPayloadOptions{To: to, Payload: payload}
	novuClient := novu.NewAPIClient(${renderedSecretKey}, &novu.Config{})

	resp, err := novuClient.EventApi.Trigger(ctx, "${identifier}", data)
	if err != nil {
		log.Fatal("novu error", err.Error())
		return
	}

	fmt.Println(resp)

	// get integrations
	integrations, err := novuClient.IntegrationsApi.GetAll(ctx)
	if err != nil {
		log.Fatal("Get all integrations error: ", err.Error())
	}
	fmt.Println(integrations)
}`;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - normalizePayload(originalPayload: Record<string, unknown>))
 - createNodeSnippet({ identifier, to, payload, overrides, snippet, secretKey }: CodeSnippetProps))
 - secretKey(SECRET_KEY_ENV_KEY,
}: CodeSnippetProps))
 - indentLevel(4))
 - obj(entries
    .map(([key, value]))
 - createPhpSnippet({ identifier, to, payload, secretKey }: CodeSnippetProps))
 - $response($novu->triggerEvent([
    'name')
 - tabSpaces(4): string)
 - obj(entries
    .map(([key, value]))
 - snippet({ test: 'value' },
  secretKey,
}: CodeSnippetProps))
 - tabSpaces(4): string)
 - obj(entries
    .map(([key, value]))
 - createGoSnippet({ identifier, to, payload, snippet, secretKey }: CodeSnippetProps))
Declaraciones 'export' encontradas:
- export  type
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/cookies.ts
Tamaño: 1300 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import Cookies from 'js-cookie';

type LocationAttributes = {
  path?: string;
  domain?: string;
};

export function createCookieHandler(cookieName: string) {
  return {
    get() {
      return Cookies.get(cookieName);
    },

    set(newValue: string, options: Cookies.CookieAttributes = {}) {
      return Cookies.set(cookieName, newValue, options);
    },

    remove(locationAttributes?: LocationAttributes) {
      Cookies.remove(cookieName, locationAttributes);
    },

    getOnce(locationAttributes?: LocationAttributes) {
      const value = Cookies.get(cookieName);
      this.remove(locationAttributes);

      return value;
    },
  };
}

export const novuRedirectURLCookie = createCookieHandler('nv_redirect_url');

/*
 * TODO: Store the onboarding step in the cookie and resume the flow from that step on page reload.
 * For now we just store 1.
 */
export const novuOnboardedCookie = createCookieHandler('nv_onboarding_step');

const ONBOARDING_COOKIE_EXPIRY_DAYS = 10 * 365;

// Never expires! Well it does, in 10 years but you will change device or browser by then :)
export function setNovuOnboardingStepCookie() {
  return novuOnboardedCookie.set('1', {
    expires: ONBOARDING_COOKIE_EXPIRY_DAYS,
    sameSite: 'None',
    secure: window.location.protocol === 'https:',
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createCookieHandler(cookieName: string)
 - setNovuOnboardingStepCookie()
Declaraciones 'export' encontradas:
- export function createCookieHandler
- export  const
- export  const
- export function setNovuOnboardingStepCookie

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/create-hash.ts
Tamaño: 149 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import CryptoJS from 'crypto-js';

export const createHash = (message: string) => {
  return CryptoJS.SHA256(message).toString(CryptoJS.enc.Hex);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - createHash(message: string))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/errors.ts
Tamaño: 248 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { IResponseError } from '@novu/shared';

export function parseServerErrorMessage(error: IResponseError | null): string {
  if (!error) {
    return '';
  }

  return Array.isArray(error?.message) ? error?.message[0] : error?.message;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - parseServerErrorMessage(error: IResponseError | null)
Declaraciones 'export' encontradas:
- export function parseServerErrorMessage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/iframe.ts
Tamaño: 115 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function inIframe() {
  try {
    return window.self !== window.top;
  } catch (e) {
    return true;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - inIframe()
Declaraciones 'export' encontradas:
- export function inIframe

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/index copy.ts
Tamaño: 27 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './segment';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/index.ts
Tamaño: 200 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './cookies';
export * from './iframe';
export * from './pluralize';
export * from './templates';
export * from './url';
export * from './utils';
export * from './playground-navigation';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/notifications.tsx
Tamaño: 207 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { errorMessage as errorMessageRoot, successMessage as successMessageRoot } from '@novu/design-system';

export const errorMessage = errorMessageRoot;
export const successMessage = successMessageRoot;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { errorMessage as errorMessageRoot, successMessage as successMessageRoot } from '@novu/design-system';
export const errorMessage = errorMessageRoot;
export const successMessage = successMessageRoot;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/web/src/utils/playground-navigation.ts
Tamaño: 400 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ROUTES } from '../constants/routes';
import { CONTEXT_PATH } from '../config';

const basePath = CONTEXT_PATH.slice(0, -1);

/**
 * Note: Do not use client-side navigation (react-router-dom),
 * because we need to create new default headers for the dashboard.
 */
export const navigateToWorkflows = () => {
  window.location.replace(window.location.origin + basePath + ROUTES.WORKFLOWS);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - navigateToWorkflows())
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/pluralize.ts
Tamaño: 199 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const pluralizeTime = (amount: string | number, unit: 'minute' | 'hour' | 'day' | 'week' | 'month'): string =>
  amount === '1' || amount === '' || amount === 1 ? unit : `${amount} ${unit}s`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - pluralizeTime(amount: string | number, unit: 'minute' | 'hour' | 'day' | 'week' | 'month'): string)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/providers.ts
Tamaño: 1410 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ColorScheme } from '@mantine/core';
import {
  ChannelTypeEnum,
  chatProviders,
  EmailProviderIdEnum,
  emailProviders,
  inAppProviders,
  pushProviders,
  SmsProviderIdEnum,
  smsProviders,
} from '@novu/shared';

import { CONTEXT_PATH, IS_SELF_HOSTED } from '../config';
import { IIntegratedProvider } from '../pages/integrations/types';

const mapStructure = (listProv): IIntegratedProvider[] =>
  listProv.map((providerItem) => ({
    providerId: providerItem.id,
    displayName: providerItem.displayName,
    channel: providerItem.channel,
    docReference: providerItem.docReference,
  }));

let initialEmailProviders = emailProviders;
let initialSmsProviders = smsProviders;
if (IS_SELF_HOSTED) {
  initialEmailProviders = emailProviders.filter((provider) => provider.id !== EmailProviderIdEnum.Novu);
  initialSmsProviders = smsProviders.filter((provider) => provider.id !== SmsProviderIdEnum.Novu);
}

export const initialProvidersList = {
  [ChannelTypeEnum.EMAIL]: mapStructure(initialEmailProviders),
  [ChannelTypeEnum.SMS]: mapStructure(initialSmsProviders),
  [ChannelTypeEnum.PUSH]: mapStructure(pushProviders),
  [ChannelTypeEnum.IN_APP]: mapStructure(inAppProviders),
  [ChannelTypeEnum.CHAT]: mapStructure(chatProviders),
};

export const getLogoFileName = (id, schema: ColorScheme): string => {
  return `${CONTEXT_PATH}/static/images/providers/${schema}/square/${id}.svg`;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mapStructure(listProv): IIntegratedProvider[])
 - initialEmailProviders(emailProviders.filter((provider))
 - initialSmsProviders(smsProviders.filter((provider))
 - getLogoFileName(id, schema: ColorScheme): string)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/routeUtils.ts
Tamaño: 631 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  AUTH_INVITATION_TOKEN_TYPE,
  AUTH_RESET_TOKEN_TYPE,
  TEMPLATES_EDIT_TEMPLATEID_TYPE,
} from '../constants/routeParams';

type URLParams = AUTH_INVITATION_TOKEN_TYPE | AUTH_RESET_TOKEN_TYPE | TEMPLATES_EDIT_TEMPLATEID_TYPE;

const escapeRegExp = (string: string) => string.replace(/[.*+\-?^${}()|[\]\\]/g, '\\$&');

export const parseUrl = (urlToParse: string, params: URLParams | Record<string, string>) => {
  return Object.keys(params).reduce((url, name) => {
    const value = params[name];

    return url.replace(new RegExp(`:${escapeRegExp(name)}`, 'g'), encodeURIComponent(String(value)));
  }, urlToParse);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - escapeRegExp(string: string))
 - parseUrl(urlToParse: string, params: URLParams | Record<string, string>))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/segment.ts
Tamaño: 3154 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AnalyticsBrowser } from '@segment/analytics-next';
import { IUserEntity } from '@novu/shared';
import * as mixpanel from 'mixpanel-browser';
import { api } from '../api';

export class SegmentService {
  private _segment: AnalyticsBrowser | null = null;
  private _segmentEnabled: boolean;
  public _mixpanelEnabled: boolean;

  constructor() {
    this._segmentEnabled = !!process.env.REACT_APP_SEGMENT_KEY;
    this._mixpanelEnabled = !!process.env.REACT_APP_MIXPANEL_KEY;

    if (this._mixpanelEnabled) {
      mixpanel.init(process.env.REACT_APP_MIXPANEL_KEY as string, {
        record_sessions_percent: 100,
      });
    }

    if (this._segmentEnabled) {
      this._segment = AnalyticsBrowser.load({ writeKey: process.env.REACT_APP_SEGMENT_KEY as string });

      if (!this._mixpanelEnabled) {
        return;
      }

      this._segment.addSourceMiddleware(({ payload, next }) => {
        try {
          if (payload.type() === 'track' || payload.type() === 'page') {
            const segmentDeviceId = payload.obj.anonymousId;
            mixpanel.register({ $device_id: segmentDeviceId });
            const sessionReplayProperties = mixpanel.get_session_recording_properties();

            payload.obj.properties = {
              ...payload.obj.properties,
              ...sessionReplayProperties,
            };
          }

          const { userId } = payload.obj;

          if (payload.type() === 'identify' && userId) {
            mixpanel.identify(userId);
          }
        } catch (e) {
          console.error(e);
        }

        next(payload);
      });
    }
  }

  identify(user: IUserEntity) {
    if (!this.isSegmentEnabled()) {
      return;
    }

    this._segment?.identify(user?._id, {
      email: user.email,
      name: `${user.firstName} ${user.lastName}`,
      firstName: user.firstName,
      lastName: user.lastName,
      avatar: user.profilePicture,
      createdAt: user.createdAt,
    });
  }

  alias(anonymousId: string, userId: string) {
    if (!this.isSegmentEnabled()) {
      return;
    }

    if (this._mixpanelEnabled) {
      mixpanel.alias(userId, anonymousId);
    }

    this._segment?.alias(userId, anonymousId);
  }

  setAnonymousId(anonymousId: string) {
    if (!this.isSegmentEnabled() || !anonymousId) {
      return;
    }

    this._segment?.setAnonymousId(anonymousId);
  }

  async track(event: string, data?: Record<string, unknown>) {
    if (!this.isSegmentEnabled()) {
      return;
    }

    if (this._mixpanelEnabled) {
      const sessionReplayProperties = mixpanel.get_session_recording_properties();

      data = {
        ...(data || {}),
        ...sessionReplayProperties,
      };
    }

    await api.post('/v1/telemetry/measure', {
      event: `${event} - [WEB]`,
      data,
    });
  }

  pageView(url: string) {
    if (!this.isSegmentEnabled()) {
      return;
    }

    this._segment?.pageView(url);
  }

  reset() {
    if (!this.isSegmentEnabled()) {
      return;
    }

    this._segment?.reset();
  }

  isSegmentEnabled(): boolean {
    return this._segmentEnabled && this._segment !== null && typeof window !== 'undefined';
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - _segment(AnalyticsBrowser.load({ writeKey: process.env.REACT_APP_SEGMENT_KEY as string });

      if (!this._...)
Declaraciones 'export' encontradas:
- export class SegmentService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/string.ts
Tamaño: 136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function capitalizeFirstLetter(string) {
  if (!string) return '';

  return string.charAt(0).toUpperCase() + string.slice(1);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - capitalizeFirstLetter(string)
Declaraciones 'export' encontradas:
- export function capitalizeFirstLetter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/templates.ts
Tamaño: 488 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IconName } from '@fortawesome/fontawesome-svg-core';

export const getWorkflowBlueprintDetails = (templateName: string): { name: string; iconName: IconName } => {
  const regexResult = /^:.{1,}:/.exec(templateName);
  let name = '';
  let iconName = 'fa-solid fa-question';
  if (regexResult !== null) {
    name = templateName.replace(regexResult[0], '').trim();
    iconName = regexResult[0].replace(/:/g, '').trim();
  }

  return { name, iconName: iconName as IconName };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getWorkflowBlueprintDetails(templateName: string): { name: string; iconName: IconName })
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/url.ts
Tamaño: 627 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function openInNewTab(url: string) {
  return window.open(url, '_blank', 'noreferrer noopener');
}

export function validateURL(url: string, msg = 'The provided URL is invalid'): asserts url {
  try {
    new URL(url || '');
  } catch (err) {
    throw new Error(msg);
  }
}

const ALLOWED_PROTOCOLS = ['http:', 'https:'];

export function assertProtocol(url: URL | string | null) {
  if (!url) {
    return;
  }

  if (typeof url === 'string') {
    url = new URL(url);
  }

  if (!ALLOWED_PROTOCOLS.includes(url.protocol)) {
    throw new Error(`Novu: "${url.protocol}" protocol from "${url}" is not allowed.`);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - openInNewTab(url: string)
 - validateURL(url: string, msg = 'The provided URL is invalid')
 - assertProtocol(url: URL | string | null)
Declaraciones 'export' encontradas:
- export function openInNewTab
- export function validateURL
- export function assertProtocol

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/src/utils/utils.ts
Tamaño: 924 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function formatNumber(num: number, digits: number) {
  const lookup = [
    { value: 1, symbol: '' },
    { value: 1e3, symbol: 'k' },
    { value: 1e6, symbol: 'M' },
    { value: 1e9, symbol: 'G' },
    { value: 1e12, symbol: 'T' },
    { value: 1e15, symbol: 'P' },
    { value: 1e18, symbol: 'E' },
  ];
  const rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
  const item = lookup
    .slice()
    .reverse()
    .find(function (lookupItem) {
      return num >= lookupItem.value;
    });

  return item ? (num / item.value).toFixed(digits).replace(rx, '$1') + item.symbol : '0';
}

export function parsePayload(payload: string) {
  try {
    return JSON.parse(payload);
  } catch (e) {
    return {};
  }
}

const DOUBLE_QUOTE_REGEX = /^"(.*)"$/;
export function cleanDoubleQuotedString(str?: string | null) {
  if (!str) {
    return str;
  }
  const match = DOUBLE_QUOTE_REGEX.exec(str);

  return match ? match[1] : str;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - formatNumber(num: number, digits: number)
 - parsePayload(payload: string)
 - cleanDoubleQuotedString(str?: string | null)
Declaraciones 'export' encontradas:
- export function formatNumber
- export function parsePayload
- export function cleanDoubleQuotedString

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/README.md
Tamaño: 952 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

# E2E Testing with Playwright

This page is a wiki about how to test the Novu web app with Playwright.

## Run E2E locally

### Use Jarvis (WIP)

Jarvis is not fully updated yet to run the E2E suite with Playwright. It will be done very soon!

### Run individually in separate shells

```bash
NOVU_ENTERPRISE=true pnpm --filter @novu/api start:test

NOVU_ENTERPRISE=true pnpm --filter @novu/worker start:test

NOVU_ENTERPRISE=true REACT_APP_API_URL='http://127.0.0.1:1336' REACT_APP_LAUNCH_DARKLY_CLIENT_SIDE_ID='' pnpm --filter @novu/web start

NOVU_ENTERPRISE=true pnpm --filter @novu/web run test:e2e
```

## FAQ

### Set a feature flag in the scope of the test

> [!NOTE]
> Launch Darkly should be disabled in E2E tests as it causes high flakiness

```ts
import { setFeatureFlag } from './utils/browser';

// ...
test.beforeEach(async ({ page }) => {
  await setFeatureFlag(page, FeatureFlagsKeysEnum.IS_TEMPLATE_STORE_ENABLED, true);
}
// ...
```


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# E2E Testing with Playwright
This page is a wiki about how to test the Novu web app with Playwright.
## Run E2E locally
### Use Jarvis (WIP)
### Run individually in separate shells
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/web/tests/activities-page.spec.ts
Tamaño: 1624 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { ActivitiesPage, FILTER_TERM } from './page-models/activitiesPage';

import { initializeSession } from './utils/browser';
import { createNotifications, SessionData } from './utils/plugins';

let session: SessionData;

test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('displays and filter activity feed', async ({ page }) => {
  await createNotifications({
    identifier: session.templates[0].triggers[0].identifier,
    token: session.token,
    count: 25,
    organizationId: session.organization._id,
    environmentId: session.environment._id,
  });

  const activitiesPage = await ActivitiesPage.goTo(page);
  await expect(page).toHaveURL(/\/activities/);

  const addChannelButton = page.getByTestId('activity-stats-weekly-sent');
  await expect(addChannelButton).toContainText('25');

  const locator = activitiesPage.getActivityRowElements().first();
  await expect(locator).toContainText(session.templates[0].name);
  await activitiesPage.assertContainsExpectedUIElements();

  await expect(activitiesPage.getEmailStep()).toHaveCount(10);
  await activitiesPage.filterChannelSearchBy(FILTER_TERM.SMS);
  await activitiesPage.submitFilters();
  await expect(activitiesPage.getEmailStep()).toHaveCount(0);

  await activitiesPage.filterByFirstWorkflow();
  await activitiesPage.filterByTransaction('some value');
  await activitiesPage.filterBySubscriber('some value');
  await activitiesPage.clearFiltersButton().click();
  await activitiesPage.assertHasNoFilterValues();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/api-keys.spec.ts
Tamaño: 1686 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { ApiKeysPage } from './page-models/apiKeysPage';
import { SessionData } from './utils/plugins';

let session: SessionData;

test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should show/hide the API key, and display the application and environment identifier', async ({ page }) => {
  const apiKeysPage = await ApiKeysPage.goTo(page);
  const apiKeyContainer = await apiKeysPage.getApiKeyContainer();
  const apiKey = session.environment.apiKeys[0].key;

  expect(apiKeyContainer).toHaveValue(apiKey);

  expect(await apiKeyContainer.getAttribute('type')).toBe('password');
  await apiKeysPage.getApiKeyVisibilityButton().click();
  expect(await apiKeyContainer.getAttribute('type')).toBe('text');
  await apiKeysPage.getApiKeyVisibilityButton().click();
  expect(await apiKeyContainer.getAttribute('type')).toBe('password');

  const environmentId = apiKeysPage.getEnvironmentID();
  const applicationId = apiKeysPage.getAppIdentifier();
  expect(applicationId).toHaveValue(session.environment.identifier);
  expect(environmentId).toHaveValue(session.environment._id);
});

test('should regenerate the API key', async ({ page }) => {
  const apiKeysPage = await ApiKeysPage.goTo(page);
  const oldApiKeyValue = (await apiKeysPage.getApiKeyContainer()).inputValue();

  await apiKeysPage.regenerateApiKey();
  await apiKeysPage.assertCautionModal();

  const newApiKeyValue = (await apiKeysPage.getApiKeyContainer()).inputValue();

  await expect(newApiKeyValue).not.toBe(oldApiKeyValue);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - applicationId(apiKeysPage.getAppIdentifier();
  expect(applicationId).toHaveValue(session.environment.identifier);...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/billing.spec.ts
Tamaño: 4521 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { BillingPage } from './page-models/billingPage';
import { BillingRouteMocks } from './rest-mocks/BillingRouteMocks';
import { ApiServiceLevelEnum } from '@novu/shared';

const GREEN = 'rgb(77, 153, 128)';
const YELLOW = 'rgb(253, 224, 68)';

// TODO: new set of tests after redesign
test.describe.skip('Billing', () => {
  test.skip(process.env.NOVU_ENTERPRISE !== 'true', 'Skipping tests for non enterprise variant...');

  test.beforeEach(async ({ page }) => {
    await initializeSession(page, { noTemplates: true });
  });

  test('should display billing page', async ({ page }) => {
    await BillingRouteMocks.mockActiveSubscription(page);
    const billingPage = await BillingPage.goTo(page);
    await page.waitForTimeout(1000);
    await billingPage.assertBillingPlansTitle('Plans');
  });

  async function assertDynamicTimeLeftLabel(billingPage: BillingPage, timeInTrial: number) {
    await billingPage.assertTrialLabelContains(`${30 - timeInTrial}`);
  }

  test('should display free trial widget', async ({ page }) => {
    const billingPage = await testDynamicBannersInTrial(page, 0);
    await expect(billingPage.getTrialProgressBar()).toHaveCSS('width', '0px');
  });

  test('should display free trial widget after 10 days', async ({ page }) => {
    const billingPage = await testDynamicBannersInTrial(page, 10);
    await billingPage.assertTrialBarColor(GREEN);
  });

  test('should display free trial widget after 20 days', async ({ page }) => {
    const billingPage = await testDynamicBannersInTrial(page, 20);
    await billingPage.assertTrialBarColor(YELLOW);
    await billingPage.assertContactSalesBannerText('Contact sales');
  });

  test('should not display free trial widget after 30 days', async ({ page }) => {
    await BillingRouteMocks.mockActiveSubscription(page);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.settingsMenu.assertNoFreeTrial();
    await billingPage.assertNoFreeTrial();
  });

  test('should display free trail info on billing page', async ({ page }) => {
    await BillingRouteMocks.mockSubscriptionTrial(page, 0);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.assertBillingPlansTitle('Plans');
    await billingPage.assertTrialWidgetText('30 days left on your trial');
  });

  test('should be able to manage subscription', async ({ page }) => {
    await BillingRouteMocks.mockActiveSubscription(page);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.assertPlansIsTitle();
    await billingPage.waitForPlanBusinessCurrent();
    await billingPage.waitForPlanBusinessManage();
  });

  test('should be able to upgrade from free', async ({ page }) => {
    await BillingRouteMocks.mockActiveSubscription(page);
    await BillingRouteMocks.mockSubscriptionWithApiServiceLevel(page, ApiServiceLevelEnum.FREE);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.assertPlansIsTitle();
    await billingPage.waitForPlanFreeCurrent();
    await billingPage.waitForUpgradeButton();
  });

  test('full user flow from subscription to active', async ({ page }) => {
    await assertStateOnTrial(page);
    await assertTrialFinished(page);
  });

  async function assertStateOnTrial(page: Page) {
    await BillingRouteMocks.mockSubscriptionTrial(page, 20);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.assertPlansIsTitle();
    await billingPage.waitForPlanBusinessCurrent();
    await billingPage.waitForUpgradeButton();
    await billingPage.waitForFreeTrialWidget();
    await billingPage.assertTrialWidgetText('10 days left on your trial');
    await billingPage.waitForFreeTrialBanner();
  }
  async function testDynamicBannersInTrial(page: Page, timeInTrial: number) {
    await BillingRouteMocks.mockSubscriptionTrial(page, timeInTrial);
    const billingPage = await BillingPage.goTo(page);
    await assertDynamicTimeLeftLabel(billingPage, timeInTrial);
    await billingPage.assertUpgradeButtonTextContains('Upgrade');

    return billingPage;
  }

  async function assertTrialFinished(page: Page) {
    await BillingRouteMocks.mockActiveSubscription(page);
    const billingPage = await BillingPage.goTo(page);
    await billingPage.assertNoFreeTrial();
    await billingPage.settingsMenu.assertNoFreeTrial();
    await billingPage.assertNoFreeTrialBanner();
  }
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - assertDynamicTimeLeftLabel(billingPage: BillingPage, timeInTrial: number)
 - assertStateOnTrial(page: Page)
 - testDynamicBannersInTrial(page: Page, timeInTrial: number)
 - assertTrialFinished(page: Page)
Asignaciones con arrow functions encontradas (posibles funciones):
 - YELLOW('rgb(253, 224, 68)';

// TODO: new set of tests after redesign
test.describe.skip('Billing', ())
 - billingPage(await BillingPage.goTo(page);
    await page.waitForTimeout(1000);
    await billingPage.assertBilli...)
 - billingPage(await testDynamicBannersInTrial(page, 0);
    await expect(billingPage.getTrialProgressBar()).toHave...)
 - billingPage(await testDynamicBannersInTrial(page, 10);
    await billingPage.assertTrialBarColor(GREEN);
  });

...)
 - billingPage(await testDynamicBannersInTrial(page, 20);
    await billingPage.assertTrialBarColor(YELLOW);
    aw...)
 - billingPage(await BillingPage.goTo(page);
    await billingPage.settingsMenu.assertNoFreeTrial();
    await bill...)
 - billingPage(await BillingPage.goTo(page);
    await billingPage.assertBillingPlansTitle('Plans');
    await bill...)
 - billingPage(await BillingPage.goTo(page);
    await billingPage.assertPlansIsTitle();
    await billingPage.wait...)
 - billingPage(await BillingPage.goTo(page);
    await billingPage.assertPlansIsTitle();
    await billingPage.wait...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/brand.spec.ts
Tamaño: 1385 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { BrandPage } from './page-models/brandPage';
import { assertPageShowsMessage, initializeSession } from './utils/browser';

let session;
test.beforeEach(async ({ page }) => {
  const { session: newSession } = await initializeSession(page);
  session = newSession;
});

test.skip('updates logo', async ({ page }) => {
  const brandPage = await BrandPage.goTo(page);
  await brandPage.uploadLogoImage('../fixtures/test-logo.png');
  await brandPage.assertImageSourceSetCorrectly(session.organization._id);
});

test.skip('changes the color settings', async ({ page }) => {
  // NV-3793: browser freezes when clicking on the color picker
  const colorChoice = '#BA68C8';
  const brandPage = await BrandPage.goTo(page);
  await brandPage.choosesColorViaButton(colorChoice);
  await brandPage.submitBrandSettings();
  await page.reload();
  await assertPageShowsMessage(page, colorChoice);
  await brandPage.assertInputHasValue('color-picker', colorChoice);
});

test('changes the font settings', async ({ page }) => {
  const brandPage = await BrandPage.goTo(page);
  await brandPage.choosesFontViaDropdown('Fira Code');
  await brandPage.submitBrandSettings();
  await assertPageShowsMessage(page, 'Branding info updated successfully');
  await page.reload();
  await brandPage.assertInputHasValue('font-family-selector', 'Fira Code');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - session(newSession;
});

test.skip('updates logo', async ({ page }))
 - brandPage(await BrandPage.goTo(page);
  await brandPage.uploadLogoImage('../fixtures/test-logo.png');
  await ...)
 - brandPage(await BrandPage.goTo(page);
  await brandPage.choosesColorViaButton(colorChoice);
  await brandPage....)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/changes.spec.ts
Tamaño: 4966 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { test } from './utils/baseTest';
import { ChangesPage } from './page-models/changesPage';
import { SidebarPage } from './page-models/sidebarPage';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { WorkflowsPage } from './page-models/workflowsPage';

import { initializeSession } from './utils/browser';
import { SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should display changes to promote', async ({ page }) => {
  await createNotification(page);
  const changesPage = await ChangesPage.goTo(page);
  const tableRows = changesPage.getChangesTableRows();
  await expect(tableRows).toHaveCount(1);
});

test('fields should be disabled in Production', async ({ page }) => {
  await createNotification(page);
  await promoteNotification(page);

  const sidebarPage = await SidebarPage.goTo(page);
  await sidebarPage.toggleToProduction();

  const workflowsPage = new WorkflowsPage(page);
  await expect(workflowsPage.getCreateWorkflowButton()).toBeDisabled();
});

test('should show correct count of pending changes and update in real time', async ({ page }) => {
  await createNotification(page);
  const sidebarPage = new SidebarPage(page);
  await expect(sidebarPage.getChangesCount()).toContainText('1');

  await createNotification(page);
  await expect(sidebarPage.getChangesCount()).toContainText('2');

  await promoteNotification(page);
  await expect(sidebarPage.getChangesCount()).toContainText('1');
});

test('should show correct type and description of change', async ({ page }) => {
  await createNotification(page);
  const changesPage = await ChangesPage.goTo(page);
  await expect(changesPage.getChangeType()).toContainText('Workflow Change');
  await expect(changesPage.getChangeContent()).toContainText('Test Notification Title');
});

test('should show one change for status change and template update', async ({ page }) => {
  const template = session.templates[0];
  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const sidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();

  await sidePanel.fillTitle('Updated Title');
  await sidePanel.closeSidePanel();
  await workflowEditorPage.submitTemplateBtn().click();

  const sidebarPage = new SidebarPage(page);
  await expect(sidebarPage.getChangesCount()).toContainText('1');

  await workflowEditorPage.openWorkflowSettingsSidePanel();
  await sidePanel.clickToggleSwitch();

  await expect(sidebarPage.getChangesCount()).toContainText('1');

  await promoteNotification(page);
  await sidebarPage.toggleToProduction();

  const workflowsPage = new WorkflowsPage(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await workflowsTable.locator('tbody tr').first().click({ force: true });

  await workflowEditorPage.openWorkflowSettingsSidePanel();
  await expect(sidePanel.getTitleLocator()).toHaveValue('Updated Title');
  await expect(sidePanel.getActiveToggleSwitch()).not.toBeChecked();
});

test('should show history of changes', async ({ page }) => {
  await createNotification(page);
  await promoteNotification(page);

  const changesPage = new ChangesPage(page);
  const tableRows = changesPage.getChangesTableRows();
  await expect(tableRows).toHaveCount(0);

  await changesPage.switchToTab('History');

  const historyRows = changesPage.getHistoryChangesTableRows();
  await expect(historyRows).toHaveCount(1);
  await expect(changesPage.getPromoteButton()).toBeDisabled();
});

test('should promote all changes with promote all btn', async ({ page }) => {
  await createNotification(page);
  await createNotification(page);

  const changesPage = await ChangesPage.goTo(page);
  const tableRows = changesPage.getChangesTableRows();
  await expect(tableRows).toHaveCount(2);

  await changesPage.getPromoteAllButton().click();
  await expect(tableRows).toHaveCount(0);
});

async function createNotification(page: Page) {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test Notification Title');

  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test Notification Title',
    description: 'This is a test description for a test title',
  });
  await workflowSidePanel.closeSidePanel();

  const emailModalPage = await workflowEditorPage.addAndEditEmailNode();
  await emailModalPage.fillEmailSubject('this is email subject');
  await emailModalPage.closeSidePanel();
  await emailModalPage.getNotificationTemplateSubmitButton().click();
}

async function promoteNotification(page: Page) {
  const changesPage = await ChangesPage.goTo(page);
  await changesPage.getPromoteButton().click();
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createNotification(page: Page)
 - promoteNotification(page: Page)
Asignaciones con arrow functions encontradas (posibles funciones):
 - tableRows(changesPage.getChangesTableRows();
  await expect(tableRows).toHaveCount(1);
});

test('fields shoul...)
 - workflowsPage(new WorkflowsPage(page);
  await expect(workflowsPage.getCreateWorkflowButton()).toBeDisabled();
});...)
 - sidebarPage(new SidebarPage(page);
  await expect(sidebarPage.getChangesCount()).toContainText('1');

  await cr...)
 - changesPage(await ChangesPage.goTo(page);
  await expect(changesPage.getChangeType()).toContainText('Workflow Ch...)
 - workflowsTable(workflowsPage.getWorkflowsTable();
  await workflowsTable.locator('tbody tr').first().click({ force:...)
 - historyRows(changesPage.getHistoryChangesTableRows();
  await expect(historyRows).toHaveCount(1);
  await expect...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/create-notification.spec.ts
Tamaño: 22238 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { test } from './utils/baseTest';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { initializeSession } from './utils/browser';
import { ChannelType } from './utils/ChannelType';
import { CodeSnippetSidePanelPageModel, SNIPPET_TAB } from './page-models/codeSnippetSidePanelPageModel';
import { NodeEmailEditorPageModal } from './page-models/nodeEmailEditorPageModal';
import { NodeSmsEditingModalPageModel } from './page-models/nodeSmsEditingModalPageModel';
import { TimeUnit } from './page-models/nodeDigestEditorPageModal';
import { WorkflowsPage } from './page-models/workflowsPage';
import { WorkflowSettingsSidePanel } from './page-models/workflowSettingsSidePanel';
import { EditorState } from './page-models/editorState';

test.describe('Creation functionality', () => {
  test.beforeEach(async ({ page }) => {
    await initializeSession(page);
  });
  test('should create in-app notification', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage);
    await addInAppNode(workflowEditorPage);
    const snippetModal = await workflowEditorPage.clickTriggerWorkflow();
    await assertNodeSnippet(snippetModal);
    await snippetModal.changeSnippetTabTo(SNIPPET_TAB.CURL);
    await assertCurlSnippet(snippetModal);
  });
  test('should manage variables', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage);
    const emailEditorModal = await workflowEditorPage.addAndEditEmailNode();
    await testEditMode(emailEditorModal, page, workflowEditorPage);
    await testPreviewMode(emailEditorModal, workflowEditorPage);
    await testTestMode(emailEditorModal, workflowEditorPage);
  });

  test('should not clear the set default values of variables on update', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    const emailEditorModal = await workflowEditorPage.addAndEditEmailNode();
    await fillEmailEditorWithTestData(emailEditorModal, page, false);
    await addVarDefaultValuesAndVerifyStickiness(emailEditorModal);
    await testVariableDefaultsInSmsNode(workflowEditorPage, emailEditorModal);
  });

  test('should not throw error for using array variable with index greater than 0', async ({ page }) => {
    const emailEditorModal = await createWorkflowAndEmailNode(page, editWorkflowSettings);
    await emailEditorModal.editEmailBodyTextParagraph('This tests array var {{array.[1].name}}', 0);
    await verifyArrayRecognizedAndAppearsCorrectlyInTheStepVariables(page);
  });

  test('should create email notification', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage);
    await createEmailNodeAndFillTestData(workflowEditorPage, page);
    const firstEmailNodeSubtitle = await workflowEditorPage.getNodeSubtitle(ChannelType.EMAIL, 0).textContent();
    expect(firstEmailNodeSubtitle).toContain(EMAIL_BODY_FIRST_LINE_TEXT);
    await assertCodeSnippetStructureIncludingVariables(workflowEditorPage, TEST_WORKFLOW_ID);
  });

  test.skip('should be able to add many nodes.', async ({ page }) => {
    test.slow();
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage, 'Test 10 Nodes');
    await createEmptyEmailNodes(workflowEditorPage, 10);
    await createEmailNodeAndFillWithTestData(workflowEditorPage, page);
    expect(await workflowEditorPage.nodeEmailSelector().count()).toBe(11);
    await assertTestDataSaved(workflowEditorPage, page);
  });
  test('should add digest node', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage, WORKFLOW_NAME);
    await addEmailNodeFillWithTestDataAndClose(workflowEditorPage, page);
    await createDigestNodeAndFillWithTestData(workflowEditorPage, DIGEST_TEST_DATA);
    await assertSettingsSaved(workflowEditorPage, DIGEST_TEST_DATA);
  });
  test('should not reset action steps values on update', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage, WORKFLOW_NAME);
    await addEmailNodeFillWithTestDataAndClose(workflowEditorPage, page);
    const nodeDigestEditorPageModal = await createDigestNodeAndFillWithTestData(workflowEditorPage, DIGEST_TEST_DATA);
    await nodeDigestEditorPageModal.nodeSettingsUpdateButton().click();
    await assertSettingsSaved(workflowEditorPage, DIGEST_TEST_DATA);
  });
  test('should create and edit group id', async ({ page }) => {
    const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, sessionData.templates[0]._id);
    const workflowSettingsSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
    const groupLocator = await addANewCategory(workflowSettingsSidePanel);
    await workflowSettingsSidePanel.closeSidePanel();
    await workflowEditorPage.openWorkflowSettingsSidePanel();
    expect(await groupLocator.inputValue()).toBe('New Test Category');
    await workflowSettingsSidePanel.closeSidePanel();
    await workflowEditorPage.clickUpdate();
    const workflowsPage = await WorkflowsPage.goTo(page);
    await workflowsPage.clickTemplateEditLink(sessionData.templates[0]._id);
    await workflowEditorPage.settingsPage().click();
    expect(await groupLocator.inputValue()).toBe('New Test Category');
  });
  test('should show delay settings in side menu', async ({ page }) => {
    const workflowPage = await createWorkflow(page);
    const nodeDelayEditorPageModal = await workflowPage.addAndEditDelayNode();
    const delayNodeVisible = await workflowPage.getNode(ChannelType.DELAY, 0).isVisible();
    expect(delayNodeVisible).toBe(true);
    await expect(nodeDelayEditorPageModal.getDelayModeSwitch()).toBeVisible();
  });

  test.beforeEach(async ({ page }) => {
    const newSession = await initializeSession(page);
    sessionData = newSession.session;
  });
});
async function AddButtonToMailBodyEditTextAndValidate(emailEditorModal: NodeEmailEditorPageModal) {
  await emailEditorModal.clickAddElementToEmailPlusSign();
  await emailEditorModal.clickAddBtnBlock();
  await emailEditorModal.getButtonBlockWrapperLocator().click();
  await emailEditorModal.editButtonText(EMAIL_BUTTON_TEXT_WITH_HANDLEBARS);
  expect(await emailEditorModal.getButtonBlockWrapperLocator().innerText()).toContain(
    EMAIL_BUTTON_TEXT_WITH_HANDLEBARS
  );
}

async function addTextLineToEmailBodyAndValidate(emailEditorModal: NodeEmailEditorPageModal, text: string) {
  await emailEditorModal.clickEmailEditor();
  await emailEditorModal.clickEmailEditor();
  await emailEditorModal.clickAddElementToEmailPlusSign();
  await emailEditorModal.clickAddTextBlock();
  await emailEditorModal.editEmailBodyTextParagraph(text, 1);
}

async function validate3ElementsInEmailBody(emailEditorModal: NodeEmailEditorPageModal) {
  const settingLocators = await emailEditorModal.getAllRowSettingsLocators();
  expect(settingLocators.length).toBe(2);
}

async function removeButtonAndVerify(emailEditorModal: NodeEmailEditorPageModal, page: Page) {
  await emailEditorModal.clickSettingsRowButton(1);
  await emailEditorModal.clickRemoveRowButton();
  await expect(page.getByText(EMAIL_BUTTON_TEXT_WITH_HANDLEBARS)).toHaveCount(0);
  await emailEditorModal.getButtonBlockWrapperLocator().waitFor({ state: 'hidden' });
}
async function assertEmailBodyEditor(
  emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  shouldAddAnotherCustomVar: boolean
) {
  await emailEditorModal.editEmailBodyTextParagraph(EMAIL_BODY_FIRST_LINE_TEXT, 0);
  if (shouldAddAnotherCustomVar) {
    await AddButtonToMailBodyEditTextAndValidate(emailEditorModal);
    await validate3ElementsInEmailBody(emailEditorModal);
    await removeButtonAndVerify(emailEditorModal, page);
    await addTextLineToEmailBodyAndValidate(emailEditorModal, EMAIL_BODY_SECOND_LINE_TEXT_WITH_CUSTOM_VAR);
  }
}
async function assertSystemVariables(
  emailEditorModal: NodeEmailEditorPageModal,
  workflowEditorPage: WorkflowEditorPage
) {
  await emailEditorModal.getSystemVariablesButton().click();
  expect(await emailEditorModal.getVarItemStep().innerText()).toContain(STEP);
  expect(await emailEditorModal.getVarItemsBranding().innerText()).toContain(BRANDING);
  expect(await emailEditorModal.getVarItemsSubscriber().innerText()).toContain(SUBSCRIBER);
  await emailEditorModal.getVarItemsSubscriber().click();
  expect(await emailEditorModal.getItemFirstName().innerText()).toContain(FIRST_NAME);
  expect(await workflowEditorPage.getItemPhone().innerText()).toContain('string');
  await emailEditorModal.getStepVariablesButton().click();
  expect(await emailEditorModal.getItemCustomVariable().innerText()).toContain(CUSTOM_VARIABLE);
}

async function fillEmailEditorWithTestData(
  emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  shouldAddAnotherCustomVar: boolean
) {
  await assertEmailBodyEditor(emailEditorModal, page, shouldAddAnotherCustomVar);
  await emailEditorModal.fillEmailSubject(EMAIL_SUBJECT);
  await emailEditorModal.fillEmailPreheader(EMAIL_PREHEADER);
}

async function testEditMode(
  emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  workflowEditorPage: WorkflowEditorPage
) {
  await emailEditorModal.clickEmailEditor();
  await fillEmailEditorWithTestData(emailEditorModal, page, true);
  await emailEditorModal.getTranslationVariablesButton().click();
  await assertSystemVariables(emailEditorModal, workflowEditorPage);
}

async function testPreviewMode(emailEditorModal: NodeEmailEditorPageModal, workflowEditorPage: WorkflowEditorPage) {
  await emailEditorModal.switchEditorMode(EditorState.PREVIEW);
  expect(await workflowEditorPage.getPreviewSubject().innerText()).toContain(PREVIEW_SUBJECT);
  const previewContent = await workflowEditorPage.getPreviewContent().getAttribute('srcdoc');
  expect(previewContent).toContain(WRITTEN_TEXT);

  await workflowEditorPage.getPreviewModeSwitch().click();
  expect(await workflowEditorPage.getPreviewSubject().innerText()).toContain(PREVIEW_SUBJECT);
  const previewContentSwitched = await workflowEditorPage.getPreviewContent().getAttribute('srcdoc');
  expect(previewContentSwitched).toContain(WRITTEN_TEXT);

  await workflowEditorPage.getPreviewJsonParam().fill(JSON_PARAM);
  await workflowEditorPage.getApplyVariablesLocator().click();

  const previewContentUpdated = await workflowEditorPage.getPreviewContent().getAttribute('srcdoc');
  expect(previewContentUpdated).toContain(TEST_TEXT_NOVU);
  expect(previewContentUpdated).toContain(ANOTHER_TEXT_NOT_CUSTOM_VARIABLE);
}

async function testTestMode(emailEditorModal: NodeEmailEditorPageModal, workflowEditorPage: WorkflowEditorPage) {
  await emailEditorModal.switchEditorMode(EditorState.TEST);

  await workflowEditorPage.getTestEmailJsonParamsLocator().fill(JSON_PARAM);
  await workflowEditorPage.getTestSendEmailBtnLocator().click();
  const mantineLocator = await workflowEditorPage.getMantineNotificationRoot();
  await mantineLocator.waitFor();
  expect(await mantineLocator.textContent()).toContain(TEST_SENT_SUCCESSFULLY);
}

async function addVarDefaultValuesAndVerifyStickiness(emailEditorModal: NodeEmailEditorPageModal) {
  await emailEditorModal.getOpenEditVariablesButtonLocator().click();
  await emailEditorModal.getVariableDefaultValueLocator().fill('Test Var Value');
  await emailEditorModal.getCloseVarManagerModalLocator().click();
  await emailEditorModal.getNotificationTemplateSubmitButton().click();

  await emailEditorModal.getOpenEditVariablesButtonLocator().click();
  expect(await emailEditorModal.getVariableDefaultValueLocator().inputValue()).toBe('Test Var Value');
  await emailEditorModal.getCloseVarManagerModalLocator().click();
  await emailEditorModal.closeSidePanel();
}

async function validateDefaultVariableBehavior(
  nodeSmsEditingModalPageModel: NodeSmsEditingModalPageModel,
  emailEditorModal: NodeEmailEditorPageModal
) {
  await nodeSmsEditingModalPageModel.getOpenVariableManagementLocator().click();
  await nodeSmsEditingModalPageModel.getOpenEditVariablesButtonLocator().click();
  await nodeSmsEditingModalPageModel.getVariableDefaultValueLocator().fill('Test');
  await nodeSmsEditingModalPageModel.getCloseVarManagerModalLocator().click();
  await nodeSmsEditingModalPageModel.getNotificationTemplateSubmitButton().click();
  await nodeSmsEditingModalPageModel.getOpenVariableManagementLocator().click();
  await emailEditorModal.getOpenEditVariablesButtonLocator().click();
  expect(await emailEditorModal.getVariableDefaultValueLocator().inputValue()).toBe('Test');
}
async function createWorkflowAndEmailNode(
  page: Page,
  injectedCreateWorkflow: (p: WorkflowEditorPage) => Promise<void>
) {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await injectedCreateWorkflow(workflowEditorPage);
  const emailEditorModal = await workflowEditorPage.addAndEditEmailNode();
  await emailEditorModal.clickEmailEditor();
  await emailEditorModal.fillEmailSubject(EMAIL_SUBJECT);
  await emailEditorModal.fillEmailPreheader(EMAIL_PREHEADER);

  return emailEditorModal;
}

async function verifyArrayRecognizedAndAppearsCorrectlyInTheStepVariables(page: Page) {
  const arrayVarElement = page.getByTestId('var-items-array');
  expect(await arrayVarElement.textContent()).toContain('array');
  expect(await arrayVarElement.textContent()).toContain('object');
}
async function testVariableDefaultsInSmsNode(
  workflowEditorPage: WorkflowEditorPage,
  emailEditorModal: NodeEmailEditorPageModal
) {
  const nodeSmsEditingModalPageModel = await workflowEditorPage.addAndEditInSmsNode();
  await nodeSmsEditingModalPageModel.fillSmsBody('This is a test sms {{firstName}}');
  await validateDefaultVariableBehavior(nodeSmsEditingModalPageModel, emailEditorModal);
}

async function createEmailNodeAndFillTestData(workflowEditorPage: WorkflowEditorPage, page: Page) {
  const emailEditorModal = await workflowEditorPage.addAndEditEmailNode();
  await emailEditorModal.clickEmailEditor();
  await fillEmailEditorWithTestData(emailEditorModal, page, true);
  await emailEditorModal.nodeSettingsUpdateButton().click();
  await emailEditorModal.closeSidePanel();
}

async function assertCodeSnippetStructureIncludingVariables(
  workflowEditorPage: WorkflowEditorPage,
  TEST_WORKFLOW_ID: string
) {
  const codeSnippetSidePanelPageModel = await workflowEditorPage.clickTriggerWorkflow();
  const triggerCodeSnippet = codeSnippetSidePanelPageModel.getTriggerCodeSnippet();
  expect(await triggerCodeSnippet.isVisible()).toBe(true);
  const codeSnippet = await triggerCodeSnippet.textContent();
  expect(codeSnippet).toContain(TEST_WORKFLOW_ID);
  expect(codeSnippet).toContain('firstName:');
  expect(codeSnippet).toContain('customVariable:');
}
async function createEmptyEmailNodes(workflowEditorPage: WorkflowEditorPage, total: number) {
  for (let i = 0; i < total; i += 1) {
    await workflowEditorPage.buttonAdd().last().click({ force: true });
    await workflowEditorPage.addEmailNode().click();
  }
}

async function createEmailNodeAndFillWithTestData(workflowEditorPage: WorkflowEditorPage, page: Page) {
  const nodeEmailEditorPageModal = await workflowEditorPage.addAndEditEmailNode();
  await nodeEmailEditorPageModal.clickEmailEditor();
  await fillEmailEditorWithTestData(nodeEmailEditorPageModal, page, false);
  await nodeEmailEditorPageModal.nodeSettingsUpdateButton().click();
  await nodeEmailEditorPageModal.closeSidePanel();
}

async function assertTestDataSaved(workflowEditorPage: WorkflowEditorPage, page: Page) {
  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL, true);
  await workflowEditorPage.editAction().click();
  const emailPage = new NodeEmailEditorPageModal(page);

  expect(await emailPage.editableTextContent().textContent()).toContain('This text is written from a test');
  expect(await emailPage.emailSubject().inputValue()).toBe('this is email subject');
  expect(await emailPage.emailPreheader().inputValue()).toBe('this is email preheader');
}
async function createDigestNodeAndFillWithTestData(workflowEditorPage: WorkflowEditorPage, digestData: DigestTestData) {
  const digest = await workflowEditorPage.addAndEditDigestNode();
  await digest.digestSendOptionsAccordionSwitch().click();
  await digest.timeAmount().fill(`${digestData.timeAmount}`);
  await digest.chooseTimeUnitFromDropdown(digest, digestData.timeUnit);
  await digest.digestSendOptionsAccordionSwitch().click();
  await digest.onlyFrequentEventsSwitch().click({ force: true });
  await digest.backoffAmount().fill(`${digestData.backoffAmount}`);
  await digest.chooseTimeUnitBackOffFromDropDown(digest, digestData.timeUnitBackoff);
  await digest.digestGroupByOptions().click();
  await digest.batchKey().fill(digestData.batchKey);
  await digest.closeSidePanel();

  return digest;
}

function removeSuffix(digestData: TimeUnit) {
  const str: string = digestData;
  if (str.endsWith(' (s)')) {
    return str.slice(0, -4);
  } else {
    return str;
  }
}

async function assertSettingsSaved(workflowEditorPage: WorkflowEditorPage, digestData: DigestTestData) {
  const digest = await workflowEditorPage.getNodeSettings(ChannelType.DIGEST);
  await digest.digestSendOptionsAccordionSwitch().click();
  expect(await digest.timeAmount().inputValue()).toBe(`${digestData.timeAmount}`);
  expect(await digest.batchKey().inputValue()).toBe(digestData.batchKey);
  expect(await digest.backoffAmount().inputValue()).toBe(`${digestData.backoffAmount}`);
  expect(await digest.timeUnit().inputValue()).toBe(digestData.timeUnit);
  expect(await digest.timeUnitBackoff().inputValue()).toBe(digestData.timeUnitBackoff);
  await expect(workflowEditorPage.getNodeSubtitle(ChannelType.DIGEST, 0)).toContainText(
    `after ${digestData.backoffAmount} ${removeSuffix(digestData.timeUnitBackoff).toLowerCase()}`
  );
}

async function addEmailNodeFillWithTestDataAndClose(workflowEditorPage: WorkflowEditorPage, page: Page) {
  const nodeEMailEditorPageModal = await workflowEditorPage.addAndEditEmailNode();
  await nodeEMailEditorPageModal.clickEmailEditor();
  await fillEmailEditorWithTestData(nodeEMailEditorPageModal, page, false);
  await nodeEMailEditorPageModal.closeSidePanel();
}

const DIGEST_TEST_DATA = {
  backoffAmount: 20,
  batchKey: 'id',
  timeAmount: 20,
  timeUnit: TimeUnit.MINUTES,
  timeUnitBackoff: TimeUnit.MINUTES,
};

async function addANewCategory(workflowSettingsSidePanel: WorkflowSettingsSidePanel) {
  const groupLocator = workflowSettingsSidePanel.groupSelector();
  await groupLocator.click();
  await groupLocator.fill('');
  await groupLocator.fill('New Test Category');
  await workflowSettingsSidePanel.createGroupButton().click();

  return groupLocator;
}
async function editWorkflowSettings(workflowEditorPage: WorkflowEditorPage, title: string = WORKFLOW_NAME) {
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillTitle(title);
  await workflowSidePanel.fillDescription(WORKFLOW_DESCRIPTION);
  await workflowSidePanel.closeSidePanel();
}

async function addInAppNode(workflowEditorPage: WorkflowEditorPage) {
  const nodeSidePanel = await workflowEditorPage.addAndEditInAppNode();
  await nodeSidePanel.fillNotificationBody(IN_APP_EDITOR_HANDLEBAR_TEXT);
  await nodeSidePanel.fillInAppRedirect(REDIRECT_URL);
  await nodeSidePanel.getStepVariablesButton().waitFor();
  await nodeSidePanel.switchEditorMode(EditorState.PREVIEW);
  await nodeSidePanel.assertPreviewText(IN_APP_EDITOR_HANDLEBAR_RESOLVED_TEXT);
  await nodeSidePanel.pressUpdate();
  await nodeSidePanel.goBack();
}

async function assertNodeSnippet(snippetModal: CodeSnippetSidePanelPageModel) {
  const snippetText = await snippetModal.getTriggerCodeSnippet().textContent();
  expect(snippetText).toContain(TEST_WORKFLOW_ID);
  expect(snippetText).toContain(NODE_CODE_IMPORT_SAMPLE);
}

async function createWorkflow(page: Page) {
  const workflowPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await editWorkflowSettings(workflowPage);

  return workflowPage;
}
async function assertCurlSnippet(snippetModal: CodeSnippetSidePanelPageModel) {
  const curlSnippetText = await snippetModal.getCurlSnippet();
  expect(curlSnippetText).toContain("-H 'Authorization: ApiKey");
  expect(curlSnippetText).toContain('taskName');
}
interface DigestTestData {
  timeAmount: number;
  batchKey: string;
  backoffAmount: number;
  timeUnit: TimeUnit;
  timeUnitBackoff: TimeUnit;
}

const WORKFLOW_NAME = 'Test Notification Title';
const WORKFLOW_DESCRIPTION = 'This is a test description for a test title';
const EMAIL_BUTTON_TEXT_WITH_HANDLEBARS = 'Example Text Of {{ctaName}}';
const EMAIL_BODY_FIRST_LINE_TEXT = 'This text is written from a test {{firstName}}';
const EMAIL_BODY_SECOND_LINE_TEXT_WITH_CUSTOM_VAR = 'This another text will be {{customVariable}}';
const EMAIL_SUBJECT = 'this is email subject';
const EMAIL_PREHEADER = 'this is email preheader';
const STEP = 'step';
const BRANDING = 'branding';
const SUBSCRIBER = 'subscriber';
const FIRST_NAME = 'firstName';
const CUSTOM_VARIABLE = 'customVariable';
const PREVIEW_SUBJECT = 'this is email subject';
const WRITTEN_TEXT = 'This text is written from a test';
const JSON_PARAM = `{
  "firstName": "Novu",
  "customVariable": "notCustomVariable"
}`;
const TEST_TEXT_NOVU = 'This text is written from a test Novu';
const ANOTHER_TEXT_NOT_CUSTOM_VARIABLE = 'This another text will be notCustomVariable';
const TEST_SENT_SUCCESSFULLY = 'Test sent successfully!';
let sessionData;
const TEST_WORKFLOW_ID = 'test-notification-title';
const NODE_CODE_IMPORT_SAMPLE = "import { Novu } from '@novu/node'";
const IN_APP_EDITOR_HANDLEBAR_TEXT = '<p>{{firstName}} someone assigned you to {{taskName}}</p>';
const REDIRECT_URL = '/example/test';
const IN_APP_EDITOR_HANDLEBAR_RESOLVED_TEXT = 'firstName someone assigned you to taskName';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - AddButtonToMailBodyEditTextAndValidate(emailEditorModal: NodeEmailEditorPageModal)
 - addTextLineToEmailBodyAndValidate(emailEditorModal: NodeEmailEditorPageModal, text: string)
 - validate3ElementsInEmailBody(emailEditorModal: NodeEmailEditorPageModal)
 - removeButtonAndVerify(emailEditorModal: NodeEmailEditorPageModal, page: Page)
 - assertEmailBodyEditor(emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  shouldAddAnotherCustomVar: boolean)
 - assertSystemVariables(emailEditorModal: NodeEmailEditorPageModal,
  workflowEditorPage: WorkflowEditorPage)
 - fillEmailEditorWithTestData(emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  shouldAddAnotherCustomVar: boolean)
 - testEditMode(emailEditorModal: NodeEmailEditorPageModal,
  page: Page,
  workflowEditorPage: WorkflowEditorPage)
 - testPreviewMode(emailEditorModal: NodeEmailEditorPageModal, workflowEditorPage: WorkflowEditorPage)
 - testTestMode(emailEditorModal: NodeEmailEditorPageModal, workflowEditorPage: WorkflowEditorPage)
 - addVarDefaultValuesAndVerifyStickiness(emailEditorModal: NodeEmailEditorPageModal)
 - validateDefaultVariableBehavior(nodeSmsEditingModalPageModel: NodeSmsEditingModalPageModel,
  emailEditorModal: NodeEmailEditorPageModal)
 - createWorkflowAndEmailNode(page: Page,
  injectedCreateWorkflow: (p: WorkflowEditorPage)
 - verifyArrayRecognizedAndAppearsCorrectlyInTheStepVariables(page: Page)
 - testVariableDefaultsInSmsNode(workflowEditorPage: WorkflowEditorPage,
  emailEditorModal: NodeEmailEditorPageModal)
 - createEmailNodeAndFillTestData(workflowEditorPage: WorkflowEditorPage, page: Page)
 - assertCodeSnippetStructureIncludingVariables(workflowEditorPage: WorkflowEditorPage,
  TEST_WORKFLOW_ID: string)
 - createEmptyEmailNodes(workflowEditorPage: WorkflowEditorPage, total: number)
 - createEmailNodeAndFillWithTestData(workflowEditorPage: WorkflowEditorPage, page: Page)
 - assertTestDataSaved(workflowEditorPage: WorkflowEditorPage, page: Page)
 - createDigestNodeAndFillWithTestData(workflowEditorPage: WorkflowEditorPage, digestData: DigestTestData)
 - removeSuffix(digestData: TimeUnit)
 - assertSettingsSaved(workflowEditorPage: WorkflowEditorPage, digestData: DigestTestData)
 - addEmailNodeFillWithTestDataAndClose(workflowEditorPage: WorkflowEditorPage, page: Page)
 - addANewCategory(workflowSettingsSidePanel: WorkflowSettingsSidePanel)
 - editWorkflowSettings(workflowEditorPage: WorkflowEditorPage, title: string = WORKFLOW_NAME)
 - addInAppNode(workflowEditorPage: WorkflowEditorPage)
 - assertNodeSnippet(snippetModal: CodeSnippetSidePanelPageModel)
 - createWorkflow(page: Page)
 - assertCurlSnippet(snippetModal: CodeSnippetSidePanelPageModel)
Asignaciones con arrow functions encontradas (posibles funciones):
 - snippetModal(await workflowEditorPage.clickTriggerWorkflow();
    await assertNodeSnippet(snippetModal);
    awai...)
 - emailEditorModal(await workflowEditorPage.addAndEditEmailNode();
    await testEditMode(emailEditorModal, page, workf...)
 - emailEditorModal(await workflowEditorPage.addAndEditEmailNode();
    await fillEmailEditorWithTestData(emailEditorMod...)
 - emailEditorModal(await createWorkflowAndEmailNode(page, editWorkflowSettings);
    await emailEditorModal.editEmailBo...)
 - firstEmailNodeSubtitle(await workflowEditorPage.getNodeSubtitle(ChannelType.EMAIL, 0).textContent();
    expect(firstEmailN...)
 - workflowEditorPage(await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage, '...)
 - workflowEditorPage(await WorkflowEditorPage.goToNewWorkflow(page);
    await editWorkflowSettings(workflowEditorPage, W...)
 - nodeDigestEditorPageModal(await createDigestNodeAndFillWithTestData(workflowEditorPage, DIGEST_TEST_DATA);
    await nodeDiges...)
 - workflowsPage(await WorkflowsPage.goTo(page);
    await workflowsPage.clickTemplateEditLink(sessionData.templates[...)
 - delayNodeVisible(await workflowPage.getNode(ChannelType.DELAY, 0).isVisible();
    expect(delayNodeVisible).toBe(true...)
 - mantineLocator(await workflowEditorPage.getMantineNotificationRoot();
  await mantineLocator.waitFor();
  expect(aw...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/debugging-test-trigger.spec.ts
Tamaño: 1655 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { initializeSession } from './utils/browser';
import { SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should open test trigger modal', async ({ page }) => {
  const template = session.templates[0];
  const userId = session.user._id;

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const workflowTriggerSidebar = await workflowEditorPage.openWorkflowTriggerSidebar();

  await expect(workflowTriggerSidebar.locator()).toBeVisible();
  await expect(workflowTriggerSidebar.getTestTriggerToParam()).toContainText(`"subscriberId": "${userId}"`);
});

test('should not test trigger on error', async ({ page }) => {
  const template = session.templates[0];
  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const workflowTriggerSidebar = await workflowEditorPage.openWorkflowTriggerSidebar();

  await expect(workflowTriggerSidebar.locator()).toBeVisible();
  await workflowTriggerSidebar.getTestTriggerToParam().fill('Backspace');
  await workflowTriggerSidebar.getTestTriggerPayloadParam().click();
  await expect(workflowTriggerSidebar.getTestTriggerBtn()).toBeDisabled();
  await expect(workflowTriggerSidebar.locator()).toBeVisible();
  await expect(workflowTriggerSidebar.getTestTriggerToParam()).toHaveClass(/mantine-JsonInput-invalid/);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowTriggerSidebar(await workflowEditorPage.openWorkflowTriggerSidebar();

  await expect(workflowTriggerSidebar.locato...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/drag-and-drop.spec.ts
Tamaño: 1607 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession, waitForNetworkIdle } from './utils/browser';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { ChannelType } from './utils/ChannelType';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('should drag and drop channel', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test drag and drop channel',
  });
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.addChannelToWorkflow(ChannelType.IN_APP);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP, true);
});

test('should add a step with plus button', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test Plus Button',
  });
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.buttonAdd().click();
  await workflowEditorPage.addSmsNode().click();
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(2 + 1); // + drag&drop placeholder
  await expect(workflowEditorPage.getAllNodes().first()).toContainText('Workflow trigger');
  await expect(workflowEditorPage.getAllNodes().nth(1)).toContainText('SMS');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowSidePanel(await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotific...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/environment-switch.spec.ts
Tamaño: 843 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { Environment, SidebarPage } from './page-models/sidebarPage';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('should switch between development and production environment via the environment select', async ({ page }) => {
  const sidebarPage = await SidebarPage.goTo(page);
  const envSwitch = await sidebarPage.getEnvironmentSwitch();

  expect(envSwitch).toHaveValue(Environment.Development);

  await sidebarPage.toggleToProduction();
  await expect(sidebarPage.getEnvironmentSwitch()).toHaveValue(Environment.Production);

  await sidebarPage.toggleToDevelopment();
  await expect(sidebarPage.getEnvironmentSwitch()).toHaveValue(Environment.Development);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/explore.spec.ts
Tamaño: 326 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('auth user navigating to root gets directed to workflows', async ({ page }) => {
  await page.goto('/');
  await page.waitForURL('/workflows**');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/get-started-page.spec.ts
Tamaño: 2197 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { GetStartedPage, Tab } from './page-models/getStartedPage';

test.beforeEach(async ({ context, page }) => {
  await initializeSession(page, { noTemplates: true });
});

test.skip('GetStartedPage', () => {
  test('should display get started page', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.assertGetStartedPageIsVisible();
  });

  test('should have all Tab and default to in-app', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.assertTabsAreVisible(Object.values(Tab));
    await getStartedPage.assertTabSelected(Tab.IN_APP);
  });

  test('should load the page with a specific tab selected when the appropriate URL search param is passed', async ({
    page,
  }) => {
    const queryParams = '?tab=multi-channel';
    const getStartedPage = await GetStartedPage.goTo(page, queryParams);
    await getStartedPage.assertTabSelected(Tab.MULTI_CHANNEL);
  });

  test('should navigate to the In-app tab, and have the correct content', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.IN_APP);
  });

  test('should navigate to the Multi-channel tab, and have the correct content', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.MULTI_CHANNEL);
  });

  test('should navigate to the Digest tab, and have the correct content', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.DIGEST);
  });

  test('should navigate to the Delay tab, and have the correct content', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.DELAY);
  });

  test('should navigate to the Translate tab, and have the correct content', async ({ page }) => {
    const getStartedPage = await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.TRANSLATE);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.assertGetStartedPageIsVisible();
  });

  ...)
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.assertTabsAreVisible(Object.values(Tab));
...)
 - getStartedPage(await GetStartedPage.goTo(page, queryParams);
    await getStartedPage.assertTabSelected(Tab.MULTI_C...)
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.IN_APP);
  });

  tes...)
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.MULTI_CHANNEL);
  });...)
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.DIGEST);
  });

  tes...)
 - getStartedPage(await GetStartedPage.goTo(page);
    await getStartedPage.verifyTabContent(Tab.DELAY);
  });

  test...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/header.spec.ts
Tamaño: 1646 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';

import { OrganizationEntity, UserEntity } from '@novu/dal';

import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { HeaderPage } from './page-models/headerPage';
import { SessionData } from './utils/plugins';

let user: UserEntity;
let organization: OrganizationEntity;
let session: SessionData;

test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page, { noTemplates: true }));
  user = session.user;
  organization = session.organization;
});

test('should display correct user photo', async ({ page }) => {
  const headerPage = await HeaderPage.goTo(page);
  const avatarImage = await headerPage.getAvatarImageSrc();
  expect(avatarImage).toBe(user.profilePicture);
});

test('should display user name in dropdown', async ({ page }) => {
  const headerPage = await HeaderPage.goTo(page);
  await headerPage.clickAvatar();
  const username = await headerPage.getUserName();
  expect(username).toContain(user.firstName);
  expect(username).toContain(user.lastName);
});

test('should display organization name in dropdown', async ({ page }) => {
  const headerPage = await HeaderPage.goTo(page);
  await headerPage.clickAvatar();
  expect(await headerPage.getOrganizationName()).toContain(organization.name);
});

test('logout user successfully', async ({ page }) => {
  const headerPage = await HeaderPage.goTo(page);
  await headerPage.clickAvatar();
  await headerPage.clickLogout();
  expect(page.url()).toContain('/auth/login');
  expect(await page.evaluate(() => localStorage.getItem('nv_auth_token'))).toBeNull();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - organization(session.organization;
});

test('should display correct user photo', async ({ page }))
 - avatarImage(await headerPage.getAvatarImageSrc();
  expect(avatarImage).toBe(user.profilePicture);
});

test('sh...)
 - username(await headerPage.getUserName();
  expect(username).toContain(user.firstName);
  expect(username).toC...)
 - headerPage(await HeaderPage.goTo(page);
  await headerPage.clickAvatar();
  expect(await headerPage.getOrganiza...)
 - headerPage(await HeaderPage.goTo(page);
  await headerPage.clickAvatar();
  await headerPage.clickLogout();
  e...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/integrations-list-modal.spec.ts
Tamaño: 31394 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ChannelTypeEnum,
  chatProviders,
  EmailProviderIdEnum,
  emailProviders,
  FeatureFlagsKeysEnum,
  InAppProviderIdEnum,
  inAppProviders,
  pushProviders,
  SmsProviderIdEnum,
  smsProviders,
} from '@novu/shared';
import { expect } from '@playwright/test';
import { test } from './utils/baseTest';

import { initializeSession, isDarkTheme, setFeatureFlag } from './utils/browser';
import {
  checkTableLoading,
  checkTableRow,
  clickOnListRow,
  interceptIntegrationsRequest,
  navigateToGetStarted,
} from './utils/integrations';
import { deleteProvider, SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  await setFeatureFlag(page, FeatureFlagsKeysEnum.IS_V2_ENABLED, false);
  ({ session } = await initializeSession(page));
});

test('should show the table loading skeleton and empty state', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: () => ({ data: [] }),
  });

  await navigateToGetStarted(page, 'channel-card-sms');

  const providerSidebar = page.getByTestId('select-provider-sidebar');
  await expect(providerSidebar).toBeVisible();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableLoading(page);
  await integrationsPromise;

  const noIntegrationsPlaceholder = page.getByTestId('no-integrations-placeholder');
  await expect(noIntegrationsPlaceholder).toBeVisible();
  await expect(noIntegrationsPlaceholder).toContainText('Choose a channel you want to start sending notifications');

  const inAppCard = page.getByTestId('integration-channel-card-in_app');
  await expect(inAppCard).toBeEnabled();
  await expect(inAppCard).toContainText('In-App');
  const emailCard = page.getByTestId('integration-channel-card-email');
  await expect(emailCard).toBeEnabled();
  await expect(emailCard).toContainText('Email');
  const chatCard = page.getByTestId('integration-channel-card-chat');
  await expect(chatCard).toBeEnabled();
  await expect(chatCard).toContainText('Chat');
  const pushCard = page.getByTestId('integration-channel-card-push');
  await expect(pushCard).toBeEnabled();
  await expect(pushCard).toContainText('Push');
  const smsCard = page.getByTestId('integration-channel-card-sms');
  await expect(smsCard).toBeEnabled();
  await expect(smsCard).toContainText('SMS');
});

test('should show the table loading skeleton and then table', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
  });

  await navigateToGetStarted(page, 'channel-card-sms');

  const providerSidebar = page.getByTestId('select-provider-sidebar');
  await expect(providerSidebar).toBeVisible();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableLoading(page);
  await integrationsPromise;

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await expect(addProvider).toContainText('Add a provider');

  await checkTableRow(page, {
    name: 'SendGrid',
    provider: 'SendGrid',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Twilio',
    provider: 'Twilio',
    channel: 'SMS',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Slack',
    provider: 'Slack',
    channel: 'Chat',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Discord',
    provider: 'Discord',
    channel: 'Chat',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Firebase Cloud Messaging',
    provider: 'Firebase Cloud Messaging',
    channel: 'Push',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Novu Inbox',
    isFree: false,
    provider: 'Novu Inbox',
    channel: 'In-App',
    environment: 'Development',
    status: 'Active',
  });
});

test('should show the select provider sidebar', async ({ page }) => {
  await deleteProvider({
    providerId: InAppProviderIdEnum.Novu,
    channel: ChannelTypeEnum.IN_APP,
    environmentId: session.environment._id,
    organizationId: session.organization._id,
  });

  await navigateToGetStarted(page);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
  await expect(selectProviderSidebar).toContainText('Select a provider');
  await expect(selectProviderSidebar).toContainText('Select a provider to create instance for a channel');
  const search = selectProviderSidebar.locator('input[type="search"]');
  await expect(search).toHaveAttribute('placeholder', 'Search a provider...');
  const sidebarClose = page.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const activeTab = channelTabs.locator('[data-active="true"]');
  await expect(activeTab).toContainText('Email');
  await expect(channelTabs).toContainText('In-App');
  await expect(channelTabs).toContainText('Email');
  await expect(channelTabs).toContainText('Chat');
  await expect(channelTabs).toContainText('Push');
  await expect(channelTabs).toContainText('SMS');

  const inAppGroup = page.getByTestId('providers-group-in_app');
  await expect(inAppGroup).toContainText('In-App');
  const emailGroup = page.getByTestId('providers-group-email');
  await expect(emailGroup).toContainText('Email');
  const chatGroup = page.getByTestId('providers-group-chat');
  await expect(chatGroup).toContainText('Chat');
  const pushGroup = page.getByTestId('providers-group-push');
  await expect(pushGroup).toContainText('Push');
  const smsGroup = page.getByTestId('providers-group-sms');
  await expect(smsGroup).toContainText('SMS');

  const allProviders = inAppProviders.concat(emailProviders, chatProviders, pushProviders, smsProviders);
  for (const provider of allProviders) {
    if (provider.id === EmailProviderIdEnum.Novu || provider.id === SmsProviderIdEnum.Novu) {
      continue;
    }

    const providerInGroup = page.getByTestId(`provider-${provider.id}`);
    await expect(providerInGroup).toContainText(provider.displayName);
  }

  const cancel = page.getByTestId('select-provider-sidebar-cancel');
  await expect(cancel).toContainText('Cancel');
  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should allow for searching', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const search = selectProviderSidebar.locator('input[type="search"]');
  await search.fill('Mail');

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const inAppTab = channelTabs.locator('button', { hasText: 'In-App' });
  await expect(inAppTab).toBeHidden();
  const emailTab = channelTabs.locator('button', { hasText: 'Email' });
  await expect(emailTab).toBeVisible();
  const chatTab = channelTabs.locator('button', { hasText: 'Chat' });
  await expect(chatTab).toBeHidden();
  const pushTab = channelTabs.locator('button', { hasText: 'Push' });
  await expect(pushTab).toBeHidden();
  const smsTab = channelTabs.locator('button', { hasText: 'SMS' });
  await expect(smsTab).toBeHidden();

  const emailGroup = page.getByTestId('providers-group-email');
  await expect(emailGroup).toContainText('Email');
  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  const mailgun = page.getByTestId(`provider-${EmailProviderIdEnum.Mailgun}`);
  await expect(mailgun).toContainText('Mailgun');
  const mailerSend = page.getByTestId(`provider-${EmailProviderIdEnum.MailerSend}`);
  await expect(mailerSend).toContainText('MailerSend');
  const emailWebhook = page.getByTestId(`provider-${EmailProviderIdEnum.EmailWebhook}`);
  await expect(emailWebhook).toContainText('Email Webhook');

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should show empty search results', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const search = selectProviderSidebar.locator('input[type="search"]');
  await search.fill('safasdfasdfasdfasdfas');

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const inAppTab = channelTabs.locator('button', { hasText: 'In-App' });
  await expect(inAppTab).toBeHidden();
  const emailTab = channelTabs.locator('button', { hasText: 'Email' });
  await expect(emailTab).toBeHidden();
  const chatTab = channelTabs.locator('button', { hasText: 'Chat' });
  await expect(chatTab).toBeHidden();
  const pushTab = channelTabs.locator('button', { hasText: 'Push' });
  await expect(pushTab).toBeHidden();
  const smsTab = channelTabs.locator('button', { hasText: 'SMS' });
  await expect(smsTab).toBeHidden();

  const noSearchResults = page.getByTestId('select-provider-no-search-results-img');
  await expect(noSearchResults).toBeVisible();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should allow selecting a provider', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const selectedProviderImage = page.getByTestId(`selected-provider-image-${EmailProviderIdEnum.Mailjet}`).first();
  const isDarkThemeEnabled = await isDarkTheme(page);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${EmailProviderIdEnum.Mailjet}.svg`
  );

  const selectedProviderName = page.getByTestId('selected-provider-name');
  await expect(selectedProviderName).toContainText('Mailjet');

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeEnabled();
});

test('should allow moving to create sidebar', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const createProviderInstanceSidebar = page.getByTestId('create-provider-instance-sidebar');
  await expect(createProviderInstanceSidebar).toBeVisible();
  await expect(createProviderInstanceSidebar).toContainText(
    'Specify assignment preferences to automatically allocate the provider instance to the Email channel.'
  );
  await expect(createProviderInstanceSidebar).toContainText('Environment');
  await expect(createProviderInstanceSidebar).toContainText('Provider instance executes only for');

  const sidebarClose = createProviderInstanceSidebar.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const selectedProviderImage = page.getByTestId(`selected-provider-image-${EmailProviderIdEnum.Mailjet}`).first();
  const isDarkThemeEnabled = await isDarkTheme(page);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${EmailProviderIdEnum.Mailjet}.svg`
  );

  const selectedProviderName = page.getByTestId('provider-instance-name');
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Mailjet');

  const environmentRadios = createProviderInstanceSidebar.locator('[role="radiogroup"]');
  const selectedEnv = environmentRadios.locator('[data-checked="true"]');
  await expect(selectedEnv).toContainText('Development');
  await expect(environmentRadios).toContainText('Production');

  const cancel = page.getByTestId('create-provider-instance-sidebar-cancel');
  await expect(cancel).toContainText('Cancel');
  await expect(cancel).toBeEnabled();

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
});

test('should allow moving back from create provider sidebar to select provider sidebar', async ({ page }) => {
  await navigateToGetStarted(page);

  let selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const back = page.getByTestId('create-provider-instance-sidebar-back');
  await expect(back).toBeVisible();
  await back.click();

  selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
});

test('should create a new mailjet integration', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const close = updateProviderSidebar.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await close.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should update the mailjet integration', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  let providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();
  await expect(updateProviderSidebar).toContainText('Set up credentials to start sending notifications.');

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('Email');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await expect(providerName).toHaveValue('Mailjet Integration');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/mailjet/);

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toBeDisabled();

  await providerName.clear();
  await providerName.fill('Mailjet Integration Updated');

  const apiKey = page.getByTestId('apiKey');
  await apiKey.fill('fake-api-key');

  const secretKey = page.getByTestId('secretKey');
  await secretKey.fill('fake-secret-key');

  const fromField = page.getByTestId('from');
  await fromField.fill('info@novu.co');

  const senderName = page.getByTestId('senderName');
  await senderName.fill('Novu');

  const toastClose = page.locator('.mantine-Notification-closeButton');
  await toastClose.click();

  await expect(updateButton).toBeEnabled();
  await updateButton.click();
  await expect(updateButton).toBeDisabled();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration Updated',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should update the mailjet integration from the list', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  let providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  let sidebarClose = updateProviderSidebar.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, 'Mailjet Integration');

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await expect(providerName).toHaveValue('Mailjet Integration');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/mailjet/);

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toBeDisabled();

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration Updated');

  const apiKey = page.getByTestId('apiKey');
  await apiKey.fill('fake-api-key');

  const secretKey = page.getByTestId('secretKey');
  await secretKey.fill('fake-secret-key');

  const fromField = page.getByTestId('from');
  await fromField.fill('info@novu.co');

  const senderName = page.getByTestId('senderName');
  await senderName.fill('Novu');

  const toastClose = page.locator('.mantine-Notification-closeButton');
  await toastClose.click();

  await expect(updateButton).toBeEnabled();
  await updateButton.click();
  await expect(updateButton).toBeDisabled();

  sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration Updated',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should allow to delete the mailjet integration', async ({ page }) => {
  await navigateToGetStarted(page);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const sidebarClose = updateProviderSidebar.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, 'Mailjet Integration');

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const menu = updateProviderSidebar.locator('[aria-haspopup="menu"]');
  await menu.click();
  const deleteButton = updateProviderSidebar.locator('button[data-menu-item="true"]', { hasText: 'Delete' });
  await deleteButton.click();

  const deleteModal = page.getByTestId('delete-provider-instance-modal');
  await expect(deleteModal).toBeVisible();
  await expect(deleteModal).toContainText('Delete Mailjet Integration instance?');
  await expect(deleteModal).toContainText(
    'Deleting a provider instance will fail workflows relying on its configuration, leading to undelivered notifications.'
  );

  const cancel = deleteModal.getByRole('button', { name: 'Cancel' });
  await expect(cancel).toBeEnabled();
  const deleteInstanceButton = deleteModal.getByRole('button', { name: 'Delete instance' });
  await expect(deleteInstanceButton).toBeEnabled();
  await deleteInstanceButton.click();

  const integrationsTable = page.getByTestId('integration-name-cell').getByText('Mailjet Integration');
  await expect(integrationsTable).toBeHidden();
});

test('should show the Novu in-app integration', async ({ page }) => {
  await navigateToGetStarted(page);

  await clickOnListRow(page, /Novu Inbox.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();
  await expect(updateProviderSidebar).toContainText(
    'Select a framework to set up credentials to start sending notifications.'
  );

  const sidebarClose = updateProviderSidebar.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('In-App');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const linkToDocs = updateProviderSidebar.getByRole('link', { name: 'Explore set-up guide' });
  await expect(linkToDocs).toBeVisible();

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  const isDarkThemeEnabled = await isDarkTheme(page);
  const selectedProviderImage = page.getByTestId(`selected-provider-image-${InAppProviderIdEnum.Novu}`);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${InAppProviderIdEnum.Novu}.svg`
  );

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu Inbox');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/novu-in-app/);

  const hmacCheckbox = page.getByTestId('hmac');
  await expect(hmacCheckbox).not.toBeChecked();

  const novuInAppFrameworks = page.getByTestId('novu-in-app-frameworks');
  await expect(novuInAppFrameworks).toContainText('Integrate In-App using a framework below');
  await expect(novuInAppFrameworks).toContainText('React');
  await expect(novuInAppFrameworks).toContainText('Angular');
  await expect(novuInAppFrameworks).toContainText('Web Component');
  await expect(novuInAppFrameworks).toContainText('Headless');
  await expect(novuInAppFrameworks).toContainText('Vue');
  await expect(novuInAppFrameworks).toContainText('iFrame');

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Update');
  await expect(updateButton).toBeDisabled();
});

test('should show the Novu in-app integration - React guide', async ({ page }) => {
  await navigateToGetStarted(page);

  await clickOnListRow(page, /Novu Inbox.*Development/);

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const novuInAppFrameworks = page.getByTestId('novu-in-app-frameworks');
  await expect(novuInAppFrameworks).toContainText('React');

  const reactGuide = novuInAppFrameworks.locator('div').filter({ hasText: 'React' }).nth(1);
  await reactGuide.click();

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toContainText('React integration guide');

  const sidebarBack = page.getByTestId('sidebar-back');
  await expect(sidebarBack).toBeVisible();
  const setupTimeline = page.getByTestId('setup-timeline');
  await expect(setupTimeline).toBeVisible();

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Update');
  await expect(updateButton).toBeDisabled();
});

test('should show the Novu Email integration sidebar', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: (body) => {
      const [firstIntegration] = body.data;
      body.data = [
        {
          _id: EmailProviderIdEnum.Novu,
          _environmentId: firstIntegration._environmentId,
          providerId: EmailProviderIdEnum.Novu,
          active: true,
          channel: ChannelTypeEnum.EMAIL,
          name: 'Novu Email',
          identifier: EmailProviderIdEnum.Novu,
        },
        ...body.data,
      ];

      return body;
    },
  });

  await navigateToGetStarted(page);
  await integrationsPromise;

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, /Novu Email.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar-novu');
  await expect(updateProviderSidebar).toContainText('Test Provider');
  await expect(updateProviderSidebar).toBeVisible();

  const isDarkThemeEnabled = await isDarkTheme(page);
  const novuEmailLogo = updateProviderSidebar.locator(
    `img[src="/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${
      EmailProviderIdEnum.Novu
    }.svg"]`
  );
  await expect(novuEmailLogo).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('Email');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu Email');

  const providerLimits = page.getByTestId('novu-provider-limits');
  const providerLimitsText = await providerLimits.innerText();
  await expect(providerLimitsText).toEqual(
    'Novu provider allows sending max 300 emails per month,\nto send more messages, configure a different provider'
  );

  const limitbarLimit = page.getByTestId('limitbar-limit');
  const limitbarText = await limitbarLimit.innerText();
  await expect(limitbarText).toEqual('300 emails per month');
});

test('should show the Novu SMS integration sidebar', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: (body) => {
      const [firstIntegration] = body.data;
      body.data = [
        {
          _id: SmsProviderIdEnum.Novu,
          _environmentId: firstIntegration._environmentId,
          providerId: SmsProviderIdEnum.Novu,
          active: true,
          channel: ChannelTypeEnum.SMS,
          name: 'Novu SMS',
          identifier: SmsProviderIdEnum.Novu,
        },
        ...body.data,
      ];

      return body;
    },
  });

  await navigateToGetStarted(page);
  await integrationsPromise;

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, /Novu SMS.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar-novu');
  await expect(updateProviderSidebar).toContainText('Test Provider');
  await expect(updateProviderSidebar).toBeVisible();

  const isDarkThemeEnabled = await isDarkTheme(page);
  const novuEmailLogo = updateProviderSidebar.locator(
    `img[src="/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${SmsProviderIdEnum.Novu}.svg"]`
  );
  await expect(novuEmailLogo).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('SMS');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu SMS');

  const providerLimits = page.getByTestId('novu-provider-limits');
  const providerLimitsText = await providerLimits.innerText();
  expect(providerLimitsText).toEqual(
    'Novu provider allows sending max 20 messages per month,\nto send more messages, configure a different provider'
  );

  const limitbarLimit = page.getByTestId('limitbar-limit');
  const limitbarText = await limitbarLimit.innerText();
  expect(limitbarText).toEqual('20 messages per month');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: ())
 - smsCard(page.getByTestId('integration-channel-card-sms');
  await expect(smsCard).toBeEnabled();
  await exp...)
 - addProvider(page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await expect(addProvi...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - create(page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('C...)
 - selectProviderSidebar(page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
})...)
 - close(updateProviderSidebar.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await clo...)
 - sidebarClose(page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    ...)
 - sidebarClose(page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    ...)
 - integrationsTable(page.getByTestId('integration-name-cell').getByText('Mailjet Integration');
  await expect(integrati...)
 - updateButton(page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Upda...)
 - updateButton(page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Upda...)
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: (body))
 - limitbarText(await limitbarLimit.innerText();
  await expect(limitbarText).toEqual('300 emails per month');
});

...)
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: (body))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/integrations-list-page.spec.ts
Tamaño: 43768 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ChannelTypeEnum,
  ChatProviderIdEnum,
  chatProviders,
  EmailProviderIdEnum,
  emailProviders,
  InAppProviderIdEnum,
  inAppProviders,
  ProvidersIdEnum,
  PushProviderIdEnum,
  pushProviders,
  SmsProviderIdEnum,
  smsProviders,
} from '@novu/shared';
import { expect } from '@playwright/test';
import { test } from './utils/baseTest';

import { initializeSession, isDarkTheme } from './utils/browser';
import { checkTableLoading, checkTableRow, clickOnListRow, interceptIntegrationsRequest } from './utils/integrations';
import { deleteProvider, SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should show the table loading skeleton and empty state', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: () => ({ data: [] }),
  });

  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  await checkTableLoading(page);
  await integrationsPromise;

  const noIntegrationsPlaceholder = page.getByTestId('no-integrations-placeholder');
  await expect(noIntegrationsPlaceholder).toBeVisible();
  await expect(noIntegrationsPlaceholder).toContainText('Choose a channel you want to start sending notifications');

  const inAppCard = page.getByTestId('integration-channel-card-in_app');
  await expect(inAppCard).toBeEnabled();
  await expect(inAppCard).toContainText('In-App');
  const emailCard = page.getByTestId('integration-channel-card-email');
  await expect(emailCard).toBeEnabled();
  await expect(emailCard).toContainText('Email');
  const chatCard = page.getByTestId('integration-channel-card-chat');
  await expect(chatCard).toBeEnabled();
  await expect(chatCard).toContainText('Chat');
  const pushCard = page.getByTestId('integration-channel-card-push');
  await expect(pushCard).toBeEnabled();
  await expect(pushCard).toContainText('Push');
  const smsCard = page.getByTestId('integration-channel-card-sms');
  await expect(smsCard).toBeEnabled();
  await expect(smsCard).toContainText('SMS');
});

test('should show the table loading skeleton and then table', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
  });

  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  await checkTableLoading(page);
  await integrationsPromise;

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await expect(addProvider).toContainText('Add a provider');

  await checkTableRow(page, {
    name: 'SendGrid',
    provider: 'SendGrid',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Twilio',
    provider: 'Twilio',
    channel: 'SMS',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Slack',
    provider: 'Slack',
    channel: 'Chat',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Discord',
    provider: 'Discord',
    channel: 'Chat',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Firebase Cloud Messaging',
    provider: 'Firebase Cloud Messaging',
    channel: 'Push',
    environment: 'Development',
    status: 'Active',
  });

  await checkTableRow(page, {
    name: 'Novu Inbox',
    isFree: false,
    provider: 'Novu Inbox',
    channel: 'In-App',
    environment: 'Development',
    status: 'Active',
  });
});

test('should show the select provider sidebar', async ({ page }) => {
  await deleteProvider({
    providerId: InAppProviderIdEnum.Novu,
    channel: ChannelTypeEnum.IN_APP,
    environmentId: session.environment._id,
    organizationId: session.organization._id,
  });

  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
  await expect(selectProviderSidebar).toContainText('Select a provider');
  await expect(selectProviderSidebar).toContainText('Select a provider to create instance for a channel');
  const search = selectProviderSidebar.locator('input[type="search"]');
  await expect(search).toHaveAttribute('placeholder', 'Search a provider...');
  const sidebarClose = page.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const activeTab = channelTabs.locator('[data-active="true"]');
  await expect(activeTab).toContainText('In-App');
  await expect(channelTabs).toContainText('In-App');
  await expect(channelTabs).toContainText('Email');
  await expect(channelTabs).toContainText('Chat');
  await expect(channelTabs).toContainText('Push');
  await expect(channelTabs).toContainText('SMS');

  const inAppGroup = page.getByTestId('providers-group-in_app');
  await expect(inAppGroup).toContainText('In-App');
  const emailGroup = page.getByTestId('providers-group-email');
  await expect(emailGroup).toContainText('Email');
  const chatGroup = page.getByTestId('providers-group-chat');
  await expect(chatGroup).toContainText('Chat');
  const pushGroup = page.getByTestId('providers-group-push');
  await expect(pushGroup).toContainText('Push');
  const smsGroup = page.getByTestId('providers-group-sms');
  await expect(smsGroup).toContainText('SMS');

  const allProviders = inAppProviders.concat(emailProviders, chatProviders, pushProviders, smsProviders);
  for (const provider of allProviders) {
    if (provider.id === EmailProviderIdEnum.Novu || provider.id === SmsProviderIdEnum.Novu) {
      continue;
    }

    const providerInGroup = page.getByTestId(`provider-${provider.id}`);
    await expect(providerInGroup).toContainText(provider.displayName);
  }

  const cancel = page.getByTestId('select-provider-sidebar-cancel');
  await expect(cancel).toContainText('Cancel');
  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should allow for searching', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const search = selectProviderSidebar.locator('input[type="search"]');
  await search.fill('Mail');

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const inAppTab = channelTabs.locator('button', { hasText: 'In-App' });
  await expect(inAppTab).toBeHidden();
  const emailTab = channelTabs.locator('button', { hasText: 'Email' });
  await expect(emailTab).toBeVisible();
  const chatTab = channelTabs.locator('button', { hasText: 'Chat' });
  await expect(chatTab).toBeHidden();
  const pushTab = channelTabs.locator('button', { hasText: 'Push' });
  await expect(pushTab).toBeHidden();
  const smsTab = channelTabs.locator('button', { hasText: 'SMS' });
  await expect(smsTab).toBeHidden();

  const emailGroup = page.getByTestId('providers-group-email');
  await expect(emailGroup).toContainText('Email');
  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  const mailgun = page.getByTestId(`provider-${EmailProviderIdEnum.Mailgun}`);
  await expect(mailgun).toContainText('Mailgun');
  const mailerSend = page.getByTestId(`provider-${EmailProviderIdEnum.MailerSend}`);
  await expect(mailerSend).toContainText('MailerSend');
  const emailWebhook = page.getByTestId(`provider-${EmailProviderIdEnum.EmailWebhook}`);
  await expect(emailWebhook).toContainText('Email Webhook');

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should show empty search results', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const search = selectProviderSidebar.locator('input[type="search"]');
  await search.fill('safasdfasdfasdfasdfas');

  const channelTabs = selectProviderSidebar.locator('[role="tablist"]');
  const inAppTab = channelTabs.locator('button', { hasText: 'In-App' });
  await expect(inAppTab).toBeHidden();
  const emailTab = channelTabs.locator('button', { hasText: 'Email' });
  await expect(emailTab).toBeHidden();
  const chatTab = channelTabs.locator('button', { hasText: 'Chat' });
  await expect(chatTab).toBeHidden();
  const pushTab = channelTabs.locator('button', { hasText: 'Push' });
  await expect(pushTab).toBeHidden();
  const smsTab = channelTabs.locator('button', { hasText: 'SMS' });
  await expect(smsTab).toBeHidden();

  const noSearchResults = page.getByTestId('select-provider-no-search-results-img');
  await expect(noSearchResults).toBeVisible();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeDisabled();
});

test('should allow selecting a provider', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const selectedProviderImage = page.getByTestId(`selected-provider-image-${EmailProviderIdEnum.Mailjet}`).first();
  const isDarkThemeEnabled = await isDarkTheme(page);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${EmailProviderIdEnum.Mailjet}.svg`
  );

  const selectedProviderName = page.getByTestId('selected-provider-name');
  await expect(selectedProviderName).toContainText('Mailjet');

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await expect(next).toBeEnabled();
});

test('should allow moving to create sidebar', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const createProviderInstanceSidebar = page.getByTestId('create-provider-instance-sidebar');
  await expect(createProviderInstanceSidebar).toBeVisible();
  await expect(createProviderInstanceSidebar).toContainText(
    'Specify assignment preferences to automatically allocate the provider instance to the Email channel.'
  );
  await expect(createProviderInstanceSidebar).toContainText('Environment');
  await expect(createProviderInstanceSidebar).toContainText('Provider instance executes only for');

  const sidebarClose = page.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const selectedProviderImage = page.getByTestId(`selected-provider-image-${EmailProviderIdEnum.Mailjet}`).first();
  const isDarkThemeEnabled = await isDarkTheme(page);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${EmailProviderIdEnum.Mailjet}.svg`
  );

  const selectedProviderName = page.getByTestId('provider-instance-name');
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Mailjet');

  const environmentRadios = createProviderInstanceSidebar.locator('[role="radiogroup"]');
  const selectedEnv = environmentRadios.locator('[data-checked="true"]');
  await expect(selectedEnv).toContainText('Development');
  await expect(environmentRadios).toContainText('Production');

  const cancel = page.getByTestId('create-provider-instance-sidebar-cancel');
  await expect(cancel).toContainText('Cancel');
  await expect(cancel).toBeEnabled();

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
});

test('should allow moving back from create provider sidebar to select provider sidebar', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  let selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const back = page.getByTestId('create-provider-instance-sidebar-back');
  await expect(back).toBeVisible();
  await back.click();

  selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
});

test('should create a new mailjet integration', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const close = page.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await close.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should create a new mailjet integration with conditions', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const addConditionsButton = page.getByTestId('add-conditions-btn');
  await addConditionsButton.click();

  const conditionsTitle = page.getByTestId('conditions-form-title');
  await expect(conditionsTitle).toContainText('Conditions for Mailjet Integration provider instance');

  const addConditionButton = page.getByTestId('add-new-condition');
  await addConditionButton.click();

  const formOn = page.getByTestId('conditions-form-on');
  await expect(formOn).toHaveValue('Tenant');

  const formKey = page.getByTestId('conditions-form-key');
  await formKey.fill('identifier');

  const formOperator = page.getByTestId('conditions-form-operator');
  await expect(formOperator).toHaveValue('Equal');

  const formValue = page.getByTestId('conditions-form-value');
  await formValue.fill('tenant123');

  let applyButton = page.getByTestId('apply-conditions-btn');
  await applyButton.click();

  await expect(addConditionsButton).toContainText('Edit conditions');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  let headerAddConditions = page.getByTestId('header-add-conditions-btn');
  await expect(headerAddConditions).toContainText('1');
  await headerAddConditions.click();

  const addNewCondition = page.getByTestId('add-new-condition');
  await addNewCondition.click();

  const conditionsFormKey = page.getByTestId('conditions-form-key').last();
  await conditionsFormKey.fill('identifier');

  const conditionsFormValue = page.getByTestId('conditions-form-value').last();
  await conditionsFormValue.fill('tenant456');

  applyButton = page.getByTestId('apply-conditions-btn');
  await applyButton.click();

  headerAddConditions = page.getByTestId('header-add-conditions-btn');
  await expect(headerAddConditions).toContainText('2');

  await expect(page).toHaveURL(/\/integrations\//);

  const close = page.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await close.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should remove as primary when adding conditions', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  await clickOnListRow(page, /SendGrid.*Development/);

  const headerAddConditions = page.getByTestId('header-add-conditions-btn');
  await headerAddConditions.click();

  const removePrimaryFlagModal = page.getByTestId('remove-primary-flag-modal');
  await expect(removePrimaryFlagModal).toBeVisible();
  await expect(removePrimaryFlagModal).toContainText('Primary flag will be removed');
  await expect(removePrimaryFlagModal).toContainText(
    'Adding conditions to the primary provider instance removes its primary status when a user applies changes by'
  );

  const cancel = removePrimaryFlagModal.getByRole('button', { name: 'Cancel' });
  await expect(cancel).toBeVisible();

  const gotIt = removePrimaryFlagModal.getByRole('button', { name: 'Got it' });
  await expect(gotIt).toBeVisible();
  await gotIt.click();

  const conditionsTitle = page.getByTestId('conditions-form-title');
  await expect(conditionsTitle).toContainText('Conditions for SendGrid provider instance');

  const addConditionButton = page.getByTestId('add-new-condition');
  await addConditionButton.click();

  const formOn = page.getByTestId('conditions-form-on');
  await expect(formOn).toHaveValue('Tenant');

  const formKey = page.getByTestId('conditions-form-key');
  await formKey.fill('identifier');

  const formOperator = page.getByTestId('conditions-form-operator');
  await expect(formOperator).toHaveValue('Equal');

  const formValue = page.getByTestId('conditions-form-value');
  await formValue.fill('tenant123');

  const applyButton = page.getByTestId('apply-conditions-btn');
  await applyButton.click();

  const providerName = page.getByPlaceholder('Enter instance name');
  await providerName.clear();
  await providerName.fill('SendGrid test');

  const fromField = page.getByTestId('from');
  await fromField.fill('info@novu.co');

  const senderName = page.getByTestId('senderName');
  await senderName.fill('Novu');

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Update');
  await expect(updateButton).toBeEnabled();
  await updateButton.click();

  const makePrimaryButton = page.locator('button', { hasText: 'Make primary' });
  await expect(makePrimaryButton).toBeVisible();

  const closeButton = page.locator('.mantine-Modal-close');
  await closeButton.click();
});

test('should remove conditions when set to primary', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  await expect(page).toHaveURL(/\/integrations\/create/);

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  await expect(page).toHaveURL(/\/integrations\/create\/email\/mailjet/);

  const providerName = page.getByPlaceholder('Enter instance name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const addConditionsButton = page.getByTestId('add-conditions-btn');
  await addConditionsButton.click();

  const conditionsTitle = page.getByTestId('conditions-form-title');
  await expect(conditionsTitle).toContainText('Conditions for Mailjet Integration provider instance');

  const addNewCondition = page.getByTestId('add-new-condition');
  await addNewCondition.click();

  const formOn = page.getByTestId('conditions-form-on');
  await expect(formOn).toHaveValue('Tenant');

  const formKey = page.getByTestId('conditions-form-key');
  await formKey.fill('identifier');

  const formOperator = page.getByTestId('conditions-form-operator');
  await expect(formOperator).toHaveValue('Equal');

  const formValue = page.getByTestId('conditions-form-value');
  await formValue.fill('tenant123');

  const applyButton = page.getByTestId('apply-conditions-btn');
  await applyButton.click();

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const headerAddConditions = page.getByTestId('header-add-conditions-btn');
  await expect(headerAddConditions).toContainText('1');

  let makePrimaryButton = page.getByTestId('header-make-primary-btn');
  await makePrimaryButton.click();

  const removeConditionsModal = page.getByTestId('remove-conditions-modal');
  await expect(removeConditionsModal).toBeVisible();
  await expect(removeConditionsModal).toContainText('Conditions will be removed');
  await expect(removeConditionsModal).toContainText('Marking this instance as primary will remove all conditions');
  const cancel = removeConditionsModal.getByRole('button', { name: 'Cancel' });
  await expect(cancel).toBeVisible();
  const removeConditionsButton = removeConditionsModal.getByRole('button', { name: 'Remove conditions' });
  await expect(removeConditionsButton).toBeVisible();
  await removeConditionsButton.click();

  makePrimaryButton = page.getByTestId('header-make-primary-btn');
  await expect(makePrimaryButton).toBeHidden();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, /Mailjet Integration.*Development/);
});

test('should update the mailjet integration', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  let providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();
  await expect(updateProviderSidebar).toContainText('Set up credentials to start sending notifications.');

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('Email');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await expect(providerName).toHaveValue('Mailjet Integration');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/mailjet/);

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toBeDisabled();

  await providerName.clear();
  await providerName.fill('Mailjet Integration Updated');

  const apiKey = page.getByTestId('apiKey');
  await apiKey.fill('fake-api-key');

  const secretKey = page.getByTestId('secretKey');
  await secretKey.fill('fake-secret-key');

  const fromField = page.getByTestId('from');
  await fromField.fill('info@novu.co');

  const senderName = page.getByTestId('senderName');
  await senderName.fill('Novu');

  const toastClose = page.locator('.mantine-Notification-closeButton');
  await toastClose.click();

  await expect(updateButton).toBeEnabled();
  await updateButton.click();
  await expect(updateButton).toBeDisabled();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration Updated',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should update the mailjet integration from the list', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  let providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  let sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, 'Mailjet Integration');

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await expect(providerName).toHaveValue('Mailjet Integration');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/mailjet/);

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toBeDisabled();

  providerName = updateProviderSidebar.getByPlaceholder('Enter instance name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration Updated');

  const apiKey = page.getByTestId('apiKey');
  await apiKey.fill('fake-api-key');

  const secretKey = page.getByTestId('secretKey');
  await secretKey.fill('fake-secret-key');

  const fromField = page.getByTestId('from');
  await fromField.fill('info@novu.co');

  const senderName = page.getByTestId('senderName');
  await senderName.fill('Novu');

  const toastClose = page.locator('.mantine-Notification-closeButton');
  await toastClose.click();

  await expect(updateButton).toBeEnabled();
  await updateButton.click();
  await expect(updateButton).toBeDisabled();

  sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    name: 'Mailjet Integration Updated',
    provider: 'Mailjet',
    channel: 'Email',
    environment: 'Development',
    status: 'Active',
  });
});

test('should allow to delete the mailjet integration', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  const addProvider = page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await addProvider.click();

  const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();

  const mailjet = page.getByTestId(`provider-${EmailProviderIdEnum.Mailjet}`);
  await expect(mailjet).toContainText('Mailjet');
  await mailjet.click();

  const next = page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  await next.click();

  const providerName = page.getByTestId('provider-instance-name');
  await providerName.clear();
  await providerName.fill('Mailjet Integration');

  const create = page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('Create');
  await expect(create).toBeEnabled();
  await create.click();

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const sidebarClose = page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, 'Mailjet Integration');

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const menu = updateProviderSidebar.locator('[aria-haspopup="menu"]');
  await menu.click();
  const deleteButton = updateProviderSidebar.locator('button[data-menu-item="true"]', { hasText: 'Delete' });
  await deleteButton.click();

  const deleteModal = page.getByTestId('delete-provider-instance-modal');
  await expect(deleteModal).toBeVisible();
  await expect(deleteModal).toContainText('Delete Mailjet Integration instance?');
  await expect(deleteModal).toContainText(
    'Deleting a provider instance will fail workflows relying on its configuration, leading to undelivered notifications.'
  );

  const cancel = deleteModal.getByRole('button', { name: 'Cancel' });
  await expect(cancel).toBeEnabled();
  const deleteInstanceButton = deleteModal.getByRole('button', { name: 'Delete instance' });
  await expect(deleteInstanceButton).toBeEnabled();
  await deleteInstanceButton.click();

  const integrationsTable = page.getByTestId('integration-name-cell').getByText('Mailjet Integration');
  await expect(integrationsTable).toBeHidden();
});

test('should show the Novu in-app integration', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  await clickOnListRow(page, /Novu Inbox.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();
  await expect(updateProviderSidebar).toContainText(
    'Select a framework to set up credentials to start sending notifications.'
  );

  const sidebarClose = page.getByTestId('sidebar-close');
  await expect(sidebarClose).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('In-App');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const linkToDocs = updateProviderSidebar.getByRole('link', { name: 'Explore set-up guide' });
  await expect(linkToDocs).toBeVisible();

  const isActive = page.getByTestId('is_active_id');
  await expect(isActive).toHaveValue('true');

  const isDarkThemeEnabled = await isDarkTheme(page);
  const selectedProviderImage = page.getByTestId(`selected-provider-image-${InAppProviderIdEnum.Novu}`);
  await expect(selectedProviderImage).toHaveAttribute(
    'src',
    `/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${InAppProviderIdEnum.Novu}.svg`
  );

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu Inbox');

  const identifier = page.getByTestId('provider-instance-identifier');
  await expect(identifier).toHaveValue(/novu-in-app/);

  const hmacCheckbox = page.getByTestId('hmac');
  await expect(hmacCheckbox).not.toBeChecked();

  const novuInAppFrameworks = page.getByTestId('novu-in-app-frameworks');
  await expect(novuInAppFrameworks).toContainText('Integrate In-App using a framework below');
  await expect(novuInAppFrameworks).toContainText('React');
  await expect(novuInAppFrameworks).toContainText('Angular');
  await expect(novuInAppFrameworks).toContainText('Web Component');
  await expect(novuInAppFrameworks).toContainText('Headless');
  await expect(novuInAppFrameworks).toContainText('Vue');
  await expect(novuInAppFrameworks).toContainText('iFrame');

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Update');
  await expect(updateButton).toBeDisabled();
});

test('should show the Novu in-app integration - React guide', async ({ page }) => {
  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);

  await clickOnListRow(page, /Novu Inbox.*Development/);

  let updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toBeVisible();

  const novuInAppFrameworks = page.getByTestId('novu-in-app-frameworks');
  await expect(novuInAppFrameworks).toContainText('React');

  const reactGuide = novuInAppFrameworks.locator('div').filter({ hasText: 'React' }).nth(1);
  await reactGuide.click();

  updateProviderSidebar = page.getByTestId('update-provider-sidebar');
  await expect(updateProviderSidebar).toContainText('React integration guide');

  const sidebarBack = page.getByTestId('sidebar-back');
  await expect(sidebarBack).toBeVisible();
  const setupTimeline = page.getByTestId('setup-timeline');
  await expect(setupTimeline).toBeVisible();

  const updateButton = page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Update');
  await expect(updateButton).toBeDisabled();
});

test('should show the Novu Email integration sidebar', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: (body) => {
      const [firstIntegration] = body.data;
      body.data = [
        {
          _id: EmailProviderIdEnum.Novu,
          _environmentId: firstIntegration._environmentId,
          providerId: EmailProviderIdEnum.Novu,
          active: true,
          channel: ChannelTypeEnum.EMAIL,
          name: 'Novu Email',
          identifier: EmailProviderIdEnum.Novu,
        },
        ...body.data,
      ];

      return body;
    },
  });

  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);
  await integrationsPromise;

  await clickOnListRow(page, /Novu Email.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar-novu');
  await expect(updateProviderSidebar).toContainText('Test Provider');
  await expect(updateProviderSidebar).toBeVisible();

  const isDarkThemeEnabled = await isDarkTheme(page);
  const novuEmailLogo = updateProviderSidebar.locator(
    `img[src="/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${
      EmailProviderIdEnum.Novu
    }.svg"]`
  );
  await expect(novuEmailLogo).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('Email');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu Email');

  const providerLimits = page.getByTestId('novu-provider-limits');
  const providerLimitsText = await providerLimits.innerText();
  await expect(providerLimitsText).toEqual(
    'Novu provider allows sending max 300 emails per month,\nto send more messages, configure a different provider'
  );

  const limitbarLimit = page.getByTestId('limitbar-limit');
  const limitbarText = await limitbarLimit.innerText();
  await expect(limitbarText).toEqual('300 emails per month');
});

test('should show the Novu SMS integration sidebar', async ({ page }) => {
  const integrationsPromise = interceptIntegrationsRequest({
    page,
    modifyBody: (body) => {
      const [firstIntegration] = body.data;
      body.data = [
        {
          _id: SmsProviderIdEnum.Novu,
          _environmentId: firstIntegration._environmentId,
          providerId: SmsProviderIdEnum.Novu,
          active: true,
          channel: ChannelTypeEnum.SMS,
          name: 'Novu SMS',
          identifier: SmsProviderIdEnum.Novu,
        },
        ...body.data,
      ];

      return body;
    },
  });

  await page.goto('/integrations');
  await expect(page).toHaveURL(/\/integrations/);
  await integrationsPromise;

  await clickOnListRow(page, /Novu SMS.*Development/);

  const updateProviderSidebar = page.getByTestId('update-provider-sidebar-novu');
  await expect(updateProviderSidebar).toContainText('Test Provider');
  await expect(updateProviderSidebar).toBeVisible();

  const isDarkThemeEnabled = await isDarkTheme(page);
  const novuEmailLogo = updateProviderSidebar.locator(
    `img[src="/static/images/providers/${isDarkThemeEnabled ? 'dark' : 'light'}/square/${SmsProviderIdEnum.Novu}.svg"]`
  );
  await expect(novuEmailLogo).toBeVisible();

  const integrationChannel = page.getByTestId('provider-instance-channel');
  await expect(integrationChannel).toContainText('SMS');

  const integrationEnvironment = page.getByTestId('provider-instance-environment');
  await expect(integrationEnvironment).toContainText('Development');

  const selectedProviderName = page.getByTestId('provider-instance-name').first();
  await expect(selectedProviderName).toBeVisible();
  await expect(selectedProviderName).toHaveValue('Novu SMS');

  const providerLimits = page.getByTestId('novu-provider-limits');
  const providerLimitsText = await providerLimits.innerText();
  await expect(providerLimitsText).toEqual(
    'Novu provider allows sending max 20 messages per month,\nto send more messages, configure a different provider'
  );

  const limitbarLimit = page.getByTestId('limitbar-limit');
  const limitbarText = await limitbarLimit.innerText();
  await expect(limitbarText).toEqual('20 messages per month');
});

type PrimaryToggleButtonTest = {
  channelType: ChannelTypeEnum;
  providerId: ProvidersIdEnum;
  providerName: string;
  enabled: boolean;
};

const testCases: PrimaryToggleButtonTest[] = [
  {
    channelType: ChannelTypeEnum.SMS,
    providerId: SmsProviderIdEnum.Twilio,
    providerName: 'Twilio',
    enabled: true,
  },
  {
    channelType: ChannelTypeEnum.EMAIL,
    providerId: EmailProviderIdEnum.Mailjet,
    providerName: 'Mailjet',
    enabled: true,
  },
  {
    channelType: ChannelTypeEnum.CHAT,
    providerId: ChatProviderIdEnum.Discord,
    providerName: 'Discord',
    enabled: false,
  },
  {
    channelType: ChannelTypeEnum.PUSH,
    providerId: PushProviderIdEnum.FCM,
    providerName: 'Firebase',
    enabled: false,
  },
];

testCases.forEach((testCase) => {
  test(`should ${testCase.enabled ? 'show' : 'NOT show'} the primary toggle button for ${
    testCase.providerName
  }`, async ({ page }) => {
    await page.goto('/integrations');
    await expect(page).toHaveURL(/\/integrations/);

    const addProvider = page.getByTestId('add-provider');
    await expect(addProvider).toBeEnabled();
    await addProvider.click();

    const selectProviderSidebar = page.getByTestId('select-provider-sidebar');
    await expect(selectProviderSidebar).toBeVisible();

    const mailjet = page.getByTestId(`provider-${testCase.providerId}`);
    await expect(mailjet).toContainText(testCase.providerName);
    await mailjet.click();

    const next = page.getByTestId('select-provider-sidebar-next');
    await expect(next).toContainText('Next');
    await next.click();

    const providerName = page.getByTestId('provider-instance-name');
    await providerName.clear();
    await providerName.fill(`${testCase.providerName} Integration`);

    const create = page.getByTestId('create-provider-instance-sidebar-create');
    await expect(create).toContainText('Create');
    await expect(create).toBeEnabled();
    await create.click();

    await expect(page.getByTestId('header-make-primary-btn')).toBeVisible({ visible: testCase.enabled });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: ())
 - smsCard(page.getByTestId('integration-channel-card-sms');
  await expect(smsCard).toBeEnabled();
  await exp...)
 - addProvider(page.getByTestId('add-provider');
  await expect(addProvider).toBeEnabled();
  await expect(addProvi...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - next(page.getByTestId('select-provider-sidebar-next');
  await expect(next).toContainText('Next');
  awai...)
 - create(page.getByTestId('create-provider-instance-sidebar-create');
  await expect(create).toContainText('C...)
 - selectProviderSidebar(page.getByTestId('select-provider-sidebar');
  await expect(selectProviderSidebar).toBeVisible();
})...)
 - close(page.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await close.click();

  aw...)
 - close(page.getByTestId('sidebar-close');
  await expect(close).toBeVisible();
  await close.click();

  aw...)
 - closeButton(page.locator('.mantine-Modal-close');
  await closeButton.click();
});

test('should remove conditio...)
 - sidebarClose(page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await clickOnListRow(page, /Mail...)
 - sidebarClose(page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    ...)
 - sidebarClose(page.getByTestId('sidebar-close');
  await sidebarClose.click();

  await checkTableRow(page, {
    ...)
 - integrationsTable(page.getByTestId('integration-name-cell').getByText('Mailjet Integration');
  await expect(integrati...)
 - updateButton(page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Upda...)
 - updateButton(page.getByTestId('update-provider-sidebar-update');
  await expect(updateButton).toContainText('Upda...)
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: (body))
 - limitbarText(await limitbarLimit.innerText();
  await expect(limitbarText).toEqual('300 emails per month');
});

...)
 - integrationsPromise(interceptIntegrationsRequest({
    page,
    modifyBody: (body))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/invites.spec.ts
Tamaño: 3047 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { AuthLoginPage } from './page-models/authLoginPage';
import { HeaderPage } from './page-models/headerPage';
import { SidebarPage } from './page-models/sidebarPage';
import { SignUpPage } from './page-models/signupPage';
import { initializeSession } from './utils/browser';
import { logout } from './utils/commands';
import { createUser, randomEmail, testPassword, inviteUser, SessionData } from './utils/plugins';

let session: SessionData;

let testUser;

test.describe('Invites', () => {
  test.skip(process.env.NOVU_ENTERPRISE !== 'true', 'Skipping tests for non enterprise variant...');

  test.beforeAll(async () => {
    testUser = await createUser();
  });

  test.beforeEach(async ({ page }) => {
    const { session: newSession } = await initializeSession(page);
    session = newSession;
  });

  // TODO: Enabling the terms and conditions checkbox doesn't enable the button in Playwright. Investigate why.
  test.skip('invite a new user to the organization', async ({ browser, page }) => {
    const inviteeEmail = randomEmail();
    const invitation = await inviteUser(session, inviteeEmail);
    await logout(page, session);

    const newContext = await browser.newContext();
    const pageForInvitedUser = await newContext.newPage();

    await pageForInvitedUser.goto(`/auth/invitation/${invitation.token}`);

    const signUpPage = new SignUpPage(pageForInvitedUser);
    await signUpPage.getFullNameLocator().fill('Invited User');
    await signUpPage.getPasswordLocator().fill(testPassword());
    await signUpPage.getAcceptTermsAndConditionsCheckMark().click();
    await signUpPage.clickSignUpButton();

    await signUpPage.assertNavigationPath('/auth/application');
    await signUpPage.fillUseCaseData();
    await signUpPage.clickGetStartedButton();

    await signUpPage.assertNavigationPath('/get-started**');

    const sidebarPage = await SidebarPage.goTo(pageForInvitedUser);
    await expect(sidebarPage.getOrganizationSwitch()).toHaveValue(new RegExp(invitation.organization.name, 'i'));
  });

  test('invite an existing user to the organization', async ({ browser, page }) => {
    const invitation = await inviteUser(session, testUser.email);
    await logout(page, session);

    const newContext = await browser.newContext();
    const pageForInvitedUser = await newContext.newPage();

    await pageForInvitedUser.goto(`/auth/invitation/${invitation.token}`);

    const loginPage = new AuthLoginPage(pageForInvitedUser);
    await expect(loginPage.getEmailLocator()).toHaveValue(testUser.email);
    await loginPage.setPasswordTo(testPassword());
    await loginPage.clickSignInButton();

    await new HeaderPage(pageForInvitedUser).clickAvatar();
    const orgSwitch = new SidebarPage(pageForInvitedUser).getOrganizationSwitch();
    await orgSwitch.focus();
    const orgOptions = orgSwitch.page().getByRole('option', { name: invitation.organization.name });
    await expect(orgOptions).toBeVisible();
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - testUser(await createUser();
  });

  test.beforeEach(async ({ page }))
 - session(newSession;
  });

  // TODO: Enabling the terms and conditions checkbox doesn't enable the button i...)
 - sidebarPage(await SidebarPage.goTo(pageForInvitedUser);
    await expect(sidebarPage.getOrganizationSwitch()).to...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/layout.spec.ts
Tamaño: 632 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { LayoutsPage } from './page-models/layoutsPage';
import { initializeSession } from './utils/browser';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('should display layouts list', async ({ page }) => {
  const subscribersPage = await LayoutsPage.goTo(page);
  await subscribersPage.assertIsVisible();
  // The last empty string is for the action column and doesn't have a header
  await subscribersPage.assertLayoutsTableHeaders(['Name', 'Description', 'Created At', 'Last Updated', '']);
  await subscribersPage.assertLayoutsTableRowCount(1);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/main-functionality.spec.ts
Tamaño: 21280 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import os from 'node:os';
import { test } from './utils/baseTest';
import { ChangesPage } from './page-models/changesPage';
import { NodeEmailEditorPageModal } from './page-models/nodeEmailEditorPageModal';
import { NodeInAppEditingModalPageModel } from './page-models/nodeInAppEditingModalPageModel';
import { SidebarPage } from './page-models/sidebarPage';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { WorkflowsPage } from './page-models/workflowsPage';
import { initializeSession, waitForNetworkIdle } from './utils/browser';
import { ChannelType } from './utils/ChannelType';
import { SessionData } from './utils/plugins';

const isMac = os.platform() === 'darwin';
const modifier = isMac ? 'Meta' : 'Control';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should not reset data when switching channel types', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test notification title',
  });
  await workflowSidePanel.closeSidePanel();

  const inAppNodeModal = await workflowEditorPage.addAndEditInAppNode();
  await inAppNodeModal.fillNotificationBody('{{firstName}} someone assigned you to {{taskName}}');
  await inAppNodeModal.closeSidePanel();

  const emailNodeModal = await workflowEditorPage.addAndEditEmailNode();

  await emailNodeModal.fillEmailSubject('this is email subject');
  await emailNodeModal.fillEmailPreheader('this is email preheader');

  await emailNodeModal.editEmailBodyTextParagraph('This text is written from a test {{firstName}}');
  await emailNodeModal.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL);
  await workflowEditorPage.editAction().click();
  await expect(emailNodeModal.emailSubject()).toHaveValue('this is email subject');
  await expect(emailNodeModal.emailPreheader()).toHaveValue('this is email preheader');
  await expect(emailNodeModal.editableTextContent()).toContainText('This text is written from a test');
});

test.skip('should update to empty data when switching from editor to customHtml', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test notification title',
  });
  await workflowSidePanel.closeSidePanel();

  const emailNodeModal = await workflowEditorPage.addAndEditEmailNode();
  await emailNodeModal.editEmailBodyTextParagraph('This text is written from a test {{firstName}}');
  await emailNodeModal.fillEmailSubject('this is email subject');
  await emailNodeModal.getNotificationTemplateSubmitButton().click();

  await waitForNetworkIdle(page);
  await emailNodeModal.getCustomCodeEditorType().click({ force: true });
  await waitForNetworkIdle(page);

  await emailNodeModal.fillEmailSubject('new email subject');
  await emailNodeModal.getNotificationTemplateSubmitButton().click();

  const workflowsPage = await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText('Test Notification').click();

  await page
    .locator('[data-test-id="editor-type-selector"] .mantine-Tabs-tabsList')
    .getByText(/Custom Code/)
    .first()
    .click();

  subjectEl = getByTestId(page, 'emailSubject');
  await subjectEl.clear();
  await subjectEl.fill('new email subject');

  await updateWorkflowButtonClick(page);

  const templatesLinkPage = getByTestId(page, 'side-nav-templates-link');
  await templatesLinkPage.click();

  const notificationsTemplate = getByTestId(page, 'notifications-template');
  await notificationsTemplate.getByText(/Test Notification/).click();

  await editChannel(page, 'email');

  await expect(
    page
      .locator('[data-test-id="editor-type-selector"] .mantine-Tabs-tabsList')
      .locator('[data-active="true"]')
      .getByText(/Custom Code/)
      .first()
  ).toBeVisible();
});

test.skip('should save avatar enabled and content for in app', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test save avatar',
  });
  await workflowSidePanel.closeSidePanel();

  const inAppNodeModal = await workflowEditorPage.addAndEditInAppNode();
  await inAppNodeModal.fillNotificationBody('new content for notification');

  await inAppNodeModal.getEnableAddAvatarToggle().click();
  const avatarIconInfo = inAppNodeModal.getAvatarIconInfo();
  await inAppNodeModal.getChooseAvatarButton().click();
  await avatarIconInfo.click();

  await inAppNodeModal.getNotificationTemplateSubmitButton().click();
  await waitForNetworkIdle(page);

  await expect(page.getByTestId('enabled-avatar')).toBeChecked();
  await expect(avatarIconInfo).toBeVisible();
});

test('should edit in-app notification', async ({ page }) => {
  const template = session.templates[0];
  const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  const settingsPanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await expect(settingsPanel.getTitleLocator()).toHaveValue(template.name);
  await settingsPanel.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  const inAppPage = new NodeInAppEditingModalPageModel(page);
  await inAppPage.fillNotificationBody('Test content for <b>{{firstName}}</b>');
  await inAppPage.closeSidePanel();

  await workflowEditorPage.setWorkflowNameInput('This is the new notification title');
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();

  await inAppPage.getFeedButton(1).click();
  await inAppPage.fillNotificationBody('new content for notification');
  await inAppPage.closeSidePanel();
  await inAppPage.getNotificationTemplateSubmitButton().click();

  const workflowsPage = await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await expect(workflowsTable.getByText('This is the new notification title', { exact: true })).toBeVisible();

  await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();

  await expect(inAppPage.getFeedButton(0)).toBeVisible();
  await expect(inAppPage.getFeedButtonChecked(1)).toBeVisible();

  await inAppPage.createAndFillFeedInput('test4');
  await inAppPage.getAddFeedButton().click();
  await expect(inAppPage.getFeedButtonChecked(2)).toBeVisible();
});

test('should unset feedId for in app step', async ({ page }) => {
  const template = session.templates[0];

  const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  const inAppPage = new NodeInAppEditingModalPageModel(page);

  await expect(inAppPage.getUseFeedsCheckbox()).toBeChecked();
  await inAppPage.getUseFeedsCheckbox().click();
  await inAppPage.getNotificationTemplateSubmitButton().click();

  const workflowsPage = await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await expect(workflowsTable.getByText(template.name, { exact: false })).toBeVisible();

  await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();

  await expect(inAppPage.getUseFeedsCheckbox()).not.toBeChecked();
});

test('should edit email notification', async ({ page }) => {
  const template = session.templates[0];

  const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL);
  await workflowEditorPage.editAction().click();

  const emailPage = new NodeEmailEditorPageModal(page);
  const firstEditorRow = emailPage.getEditorRow().first();
  await firstEditorRow.click();
  await firstEditorRow.press(`${modifier}+KeyA`);
  await firstEditorRow.press(`${modifier}+KeyX`);
  await page.keyboard.type('Hello world!');
});

test('should update notification active status', async ({ page }) => {
  const template = session.templates[0];

  const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  const settingsPage = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await expect(settingsPage.getActiveToggleSwitch()).toBeChecked();
  await settingsPage.clickToggleSwitch();
  await expect(settingsPage.getActiveToggleSwitch()).not.toBeChecked();

  await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  await workflowEditorPage.openWorkflowSettingsSidePanel();
  await expect(settingsPage.getActiveToggleSwitch()).not.toBeChecked();
});

test('should toggle active states of channels', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test toggle active states of channels',
  });
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.addAndEditEmailNode();
  await expect(workflowSidePanel.getStepActiveSwitch().locator('input')).toBeChecked();
  await workflowSidePanel.getStepActiveSwitch().click();
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.addAndEditInAppNode();
  await expect(workflowSidePanel.getStepActiveSwitch().locator('input')).toBeChecked();
});

test('should show trigger snippet block when editing', async ({ page }) => {
  const template = session.templates[0];
  const workflowEditorPage = await WorkflowEditorPage.goToEditWorkflow(page, template._id);
  const codeSnippet = await workflowEditorPage.clickTriggerWorkflow();
  await expect(codeSnippet.getTriggerCodeSnippet()).toContainText('test-event');
});

test('should show error on node if message field is missing', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test toggle active states of channels',
  });
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.addChannelToWorkflow(ChannelType.EMAIL);
  let errorCircle = page.getByTestId('error-circle');
  await expect(errorCircle).toBeVisible();

  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL);
  await workflowEditorPage.editAction().first().click();
  const emailPage = new NodeEmailEditorPageModal(page);
  await expect(emailPage.emailSubject()).toHaveClass(/mantine-TextInput-invalid/);
  await emailPage.fillEmailSubject('this is email subject');
  await emailPage.closeSidePanel();

  errorCircle = page.getByTestId('error-circle');
  await expect(errorCircle).not.toBeVisible();
});

// TODO: Fix flaky test
test.skip('should allow uploading a logo from email editor', async ({ page }) => {
  await page.route('**/v1/organizations', async (route) => {
    const response = await page.request.fetch(route.request());
    const body = await response.json();
    if (body) {
      delete body.data[0].branding.logo;
    }

    await route.fulfill({
      response,
      body: JSON.stringify({ ...body }),
    });
  });

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test allow uploading a logo from email editor',
  });
  await workflowSidePanel.closeSidePanel();

  const emailPage = await workflowEditorPage.addAndEditEmailNode();
  await emailPage.getUploadImageButton().click();

  await page.getByRole('button', { name: 'Yes' }).click();
  // await waitForNetworkIdle(page);
  expect(page.url()).toContain('/brand');
});

test('should show the brand logo on main page', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test allow uploading a logo from email editor',
  });
  await workflowSidePanel.closeSidePanel();

  await workflowEditorPage.addAndEditChannel(ChannelType.EMAIL);

  const brandLogo = page.getByTestId('brand-logo');
  await expect(brandLogo).toHaveAttribute('src', 'https://dashboard.novu.co/static/images/logo-light.png');
});

test('should support RTL text content', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test support RTL text content',
  });
  await workflowSidePanel.closeSidePanel();

  const emailPage = await workflowEditorPage.addAndEditEmailNode();
  const editableTextContent = await emailPage.getEditableTextContentByIndex(0);
  await editableTextContent.hover();
  await expect(editableTextContent).toHaveCSS('text-align', 'left');

  await emailPage.clickSettingsRowButton();
  await emailPage.getAlignRightButton().click();

  await expect(editableTextContent).toHaveCSS('text-align', 'right');
});

test('should create an SMS channel message', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test SMS Notification Title',
  });
  await workflowSidePanel.closeSidePanel();

  const smsPage = await workflowEditorPage.addAndEditInSmsNode();
  await smsPage.fillSmsBody('{{firstName}} someone assigned you to {{taskName}}');
  await smsPage.closeSidePanel();
  await workflowEditorPage.submitTemplateBtn().click();

  const triggerCodeSnippetPage = await workflowEditorPage.clickTriggerWorkflow();
  const triggerCodeSnippet = triggerCodeSnippetPage.getTriggerCodeSnippet();

  await expect(triggerCodeSnippet).toContainText('test-sms-notification-title');
  await expect(triggerCodeSnippet).toContainText("import { Novu } from '@novu/node'");
  await expect(triggerCodeSnippet).toContainText('taskName');
  await expect(triggerCodeSnippet).toContainText('firstName');
});

test('should save HTML template email', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Custom Code HTML Notification Title',
  });
  await workflowSidePanel.closeSidePanel();

  const emailPage = await workflowEditorPage.addAndEditEmailNode();
  await emailPage.fillEmailSubject('this is email subject');
  await emailPage.getCustomCodeEditorType().click();
  await emailPage.fillEmailCustomCodeBody('Hello world code {{name}} <div>Test</div>');
  await emailPage.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL);
  await workflowEditorPage.editAction().click();
  await emailPage.getMonacoEditor().click();
  await expect(emailPage.getMonacoEditor()).toContainText('Hello world code {{name}} <div>Test</div>');
});

test.skip('should redirect to the workflows page when switching environments', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Custom Code HTML Notification Title',
  });
  await workflowSidePanel.closeSidePanel();
  await workflowEditorPage.submitTemplateBtn().click();

  const changesPage = await ChangesPage.goTo(page);
  const promoteChangesPromise = page.waitForResponse((response) => {
    return !!response.url().match(/\/v1\/changes\/.*\/apply/) && response.request().method() === 'POST';
  });
  await changesPage.getPromoteButton().click();
  await promoteChangesPromise;

  await new SidebarPage(page).toggleToProduction();
  await expect(page).toHaveURL(/\/workflows/);

  await new SidebarPage(page).toggleToDevelopment();
  await expect(page).toHaveURL(/\/workflows/);
});

test.skip('New workflow button should be disabled in the Production', async ({ page }) => {
  const workflowsPage = await WorkflowsPage.goTo(page);
  await new SidebarPage(page).toggleToProduction();
  await expect(workflowsPage.getCreateWorkflowButton()).toBeDisabled();
});

test.skip('Should not allow to go to New Template page in Production', async ({ page }) => {
  await WorkflowEditorPage.goToNewWorkflow(page);
  await new SidebarPage(page).toggleToProduction();
  expect(page.url()).toContain('/workflows');
});

test.skip('should save Cta buttons state in inApp channel', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'In App CTA button',
  });
  await workflowSidePanel.closeSidePanel();

  const inAppPage = await workflowEditorPage.addAndEditInAppNode();
  await inAppPage.fillNotificationBody('Text content');
  await inAppPage.getControlAddButton().click();
  await inAppPage.getTemplateContainerClickArea().first().click();

  await inAppPage.closeSidePanel();
  await workflowEditorPage.submitTemplateBtn().click();

  const workflowsPage = await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText(/In App CTA button/).click();
  expect(page.url()).toContain('/workflows/edit');

  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();

  expect(inAppPage.getTemplateContainer().first().locator('input')).toHaveCount(1);
});

test.skip('should load successfully the recently created notification template, when going back from editor -> templates list -> editor', async ({
  page,
}) => {
  const workflowsPage = await WorkflowsPage.goTo(page);
  await workflowsPage.getCreateWorkflowButton().click();
  await workflowsPage.getCreateBlankWorkflowButton().click();

  const workflowEditorPage = new WorkflowEditorPage(page);
  const workflowSidePanel = await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotificationDetails({
    title: 'Test notification',
  });
  await workflowSidePanel.closeSidePanel();

  const inAppPage = await workflowEditorPage.addAndEditInAppNode();
  await inAppPage.fillNotificationBody('Test in-app');
  await inAppPage.closeSidePanel();

  const emailPage = await workflowEditorPage.addAndEditEmailNode();
  await emailPage.fillEmailSubject('this is email subject');
  await emailPage.fillEmailPreheader('this is email preheader');
  await emailPage.editEmailBodyTextParagraph('This text is written from a test');
  await emailPage.closeSidePanel();
  await workflowEditorPage.submitTemplateBtn().click();

  await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText(/Test notification/).click();
  expect(page.url()).toContain('/workflows/edit');

  await expect(workflowEditorPage.getNode(ChannelType.IN_APP, 0)).toBeVisible();
  await expect(workflowEditorPage.getNode(ChannelType.EMAIL, 0)).toBeVisible();
});

test('should load successfully the same notification template, when going back from templates list -> editor -> templates list -> editor', async ({
  page,
}) => {
  const template = session.templates[0];
  const workflowsPage = await WorkflowsPage.goTo(page);
  const workflowsTable = workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText(template.name).click();
  expect(page.url()).toContain('/workflows/edit');

  const workflowEditorPage = new WorkflowEditorPage(page);
  await expect(workflowEditorPage.getNode(ChannelType.IN_APP, 0)).toBeVisible();
  await expect(workflowEditorPage.getNode(ChannelType.EMAIL, 0)).toBeVisible();

  await WorkflowsPage.goTo(page);
  await workflowsTable.getByText(template.name).click();
  expect(page.url()).toContain('/workflows/edit');

  await expect(workflowEditorPage.getNode(ChannelType.IN_APP, 0)).toBeVisible();
  await expect(workflowEditorPage.getNode(ChannelType.EMAIL, 0)).toBeVisible();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - modifier(isMac ? 'Meta' : 'Control';

let session: SessionData;
test.beforeEach(async ({ page }))
 - emailNodeModal(await workflowEditorPage.addAndEditEmailNode();

  await emailNodeModal.fillEmailSubject('this is em...)
 - active("true"]')
      .getByText(/Custom Code/)
      .first()
  ).toBeVisible();
});

test.skip('should s...)
 - avatarIconInfo(inAppNodeModal.getAvatarIconInfo();
  await inAppNodeModal.getChooseAvatarButton().click();
  await ...)
 - workflowsTable(workflowsPage.getWorkflowsTable();
  await expect(workflowsTable.getByText('This is the new notifica...)
 - workflowsTable(workflowsPage.getWorkflowsTable();
  await expect(workflowsTable.getByText(template.name, { exact: f...)
 - firstEditorRow(emailPage.getEditorRow().first();
  await firstEditorRow.click();
  await firstEditorRow.press(`${mo...)
 - settingsPage(await workflowEditorPage.openWorkflowSettingsSidePanel();
  await expect(settingsPage.getActiveToggl...)
 - workflowSidePanel(await workflowEditorPage.openWorkflowSettingsSidePanel();
  await workflowSidePanel.fillBasicNotific...)
 - codeSnippet(await workflowEditorPage.clickTriggerWorkflow();
  await expect(codeSnippet.getTriggerCodeSnippet())...)
 - errorCircle(page.getByTestId('error-circle');
  await expect(errorCircle).not.toBeVisible();
});

// TODO: Fix f...)
 - emailPage(await workflowEditorPage.addAndEditEmailNode();
  await emailPage.getUploadImageButton().click();

 ...)
 - brandLogo(page.getByTestId('brand-logo');
  await expect(brandLogo).toHaveAttribute('src', 'https://dashboard....)
 - editableTextContent(await emailPage.getEditableTextContentByIndex(0);
  await editableTextContent.hover();
  await expec...)
 - triggerCodeSnippet(triggerCodeSnippetPage.getTriggerCodeSnippet();

  await expect(triggerCodeSnippet).toContainText('t...)
 - emailPage(await workflowEditorPage.addAndEditEmailNode();
  await emailPage.fillEmailSubject('this is email su...)
 - promoteChangesPromise(page.waitForResponse((response))
 - workflowsPage(await WorkflowsPage.goTo(page);
  await new SidebarPage(page).toggleToProduction();
  await expect(w...)
 - workflowsTable(workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText(/In App CTA button/).click();
  ...)
 - workflowsTable(workflowsPage.getWorkflowsTable();
  await workflowsTable.getByText(/Test notification/).click();
  ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/navbar-sidebar.spec.ts
Tamaño: 1733 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { initializeSession } from './utils/browser';
import { test } from './utils/baseTest';
import { SidebarPage } from './page-models/sidebarPage';

test.describe('Main Nav (Sidebar)', () => {
  test.beforeEach(async ({ page, context }) => {
    await initializeSession(page, { noTemplates: false });
  });

  test('should render all navigation links', async ({ page }) => {
    // Check if all expected navigation links are present
    const sidebarPage = await SidebarPage.goTo(page);
    await expect(sidebarPage.getQuickStartLingLocator()).toBeVisible();
    await expect(sidebarPage.getIntegrationLinkLocator()).toBeVisible();
    await expect(sidebarPage.getSettingsLinkLocator()).toBeVisible();
    await expect(sidebarPage.getTemplatesLinkLocator()).toBeVisible();
    await expect(sidebarPage.getActivitiesLinkLocator()).toBeVisible();
    await expect(sidebarPage.getChangesLinkLocator()).toBeVisible();
    await expect(sidebarPage.getSubscribersLinkLocator()).toBeVisible();
    await expect(sidebarPage.getTenantsLinkLocator()).toBeVisible();
    await expect(sidebarPage.getTranslationsLinkLocator()).toBeVisible();
  });

  test('should navigate to correct routes when clicking links', async ({ page }) => {
    // Check if clicking on a navigation link navigates to the correct route
    const sidebarPage = await SidebarPage.goTo(page);
    await sidebarPage.getQuickStartLingLocator().click();
    expect(page.url()).toContain('/get-started');

    await sidebarPage.getIntegrationLinkLocator().click();
    expect(page.url()).toContain('/integrations');

    await sidebarPage.getSettingsLinkLocator().click();
    expect(page.url()).toContain('/settings');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - sidebarPage(await SidebarPage.goTo(page);
    await expect(sidebarPage.getQuickStartLingLocator()).toBeVisible()...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/organization-switch.spec.ts
Tamaño: 1402 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { SidebarPage } from './page-models/sidebarPage';
import { addOrganization, SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should display organization select with the current organization', async ({ page }) => {
  const sidebarPage = await SidebarPage.goTo(page);
  await expect(sidebarPage.getOrganizationSwitch()).toHaveValue(new RegExp(session.organization.name, 'i'));
});

test('should use a different jwt token after switching organization', async ({ page }) => {
  const originToken = session.token;
  const newOrg = await addOrganization(session.user._id);

  await page.reload();

  const sidebarPage = await SidebarPage.goTo(page);
  const orgSwitch = await sidebarPage.getOrganizationSwitch();
  await orgSwitch.scrollIntoViewIfNeeded();
  await orgSwitch.focus();

  const responsePromise = page.waitForResponse('**/auth/organizations/**/switch');
  const selectItem = orgSwitch.page().getByRole('option', { name: newOrg.name });
  await selectItem.click({ force: true });
  await responsePromise;

  const newToken = await page.evaluate(() => localStorage.getItem('nv_auth_token'));
  expect(newToken).not.toBe(originToken);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - sidebarPage(await SidebarPage.goTo(page);
  await expect(sidebarPage.getOrganizationSwitch()).toHaveValue(new Re...)
 - newToken(await page.evaluate(())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/start-from-scratch-tour.spec.ts
Tamaño: 9184 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';

test.beforeEach(async ({ page }) => {
  await initializeSession(page, { showOnBoardingTour: true });
});

test('should show the start from scratch intro step', async ({ page }) => {
  await page.goto('/workflows/create');

  const scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  const scratchWorkflowTooltipTitle = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle).toHaveText('Discover a quick guide');

  const scratchWorkflowTooltipDescription = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription).toHaveText('Four simple tips to become a workflow expert.');

  const scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');

  const scratchWorkflowTooltipPrimaryButton = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton).toHaveText('Show me');
});

test('should hide the start from scratch intro step after clicking on watch later', async ({ page }) => {
  await page.goto('/workflows/create');

  const scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  const scratchWorkflowTooltipTitle = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle).toHaveText('Discover a quick guide');

  const scratchWorkflowTooltipDescription = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription).toHaveText('Four simple tips to become a workflow expert.');

  const scratchWorkflowTooltipPrimaryButton = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton).toHaveText('Show me');

  const scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');
  await scratchWorkflowTooltipSkipButton.click();

  await expect(scratchWorkflowTooltip).not.toBeVisible();
});

test('should show the start from scratch tour hints', async ({ page }) => {
  await page.goto('/workflows/create');

  const scratchWorkflowTooltip = await page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  const scratchWorkflowTooltipTitle = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle).toHaveText('Discover a quick guide');

  const scratchWorkflowTooltipDescription = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription).toHaveText('Four simple tips to become a workflow expert.');

  const scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');

  const scratchWorkflowTooltipPrimaryButton = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton).toHaveText('Show me');
  await scratchWorkflowTooltipPrimaryButton.click();

  const scratchWorkflowTooltipTitle2 = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle2).toHaveText('Click to edit workflow name');

  const scratchWorkflowTooltipDescription2 = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription2).toHaveText(
    'Specify a name for your workflow here or in the workflow settings.'
  );

  const scratchWorkflowTooltipPrimaryButton2 = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton2).toHaveText('Next');
  await scratchWorkflowTooltipPrimaryButton2.click();

  const scratchWorkflowTooltipTitle3 = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle3).toHaveText('Verify workflow settings');

  const scratchWorkflowTooltipDescription3 = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription3).toHaveText(
    'Manage name, identifier, group and description. Set up channels, active by default.'
  );

  const scratchWorkflowTooltipPrimaryButton3 = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton3).toHaveText('Next');
  await scratchWorkflowTooltipPrimaryButton3.click();

  const scratchWorkflowTooltipTitle4 = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle4).toHaveText('Build a notification workflow');

  const scratchWorkflowTooltipDescription4 = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription4).toHaveText(
    'Add channels you would like to send notifications to. The channels will be inserted to the trigger snippet.'
  );

  const scratchWorkflowTooltipPrimaryButton4 = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton4).toHaveText('Next');
  await scratchWorkflowTooltipPrimaryButton4.click();

  const scratchWorkflowTooltipTitle5 = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle5).toHaveText('Run a test or Get Snippet');

  const scratchWorkflowTooltipDescription5 = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription5).toHaveText(
    'Test a trigger as if it was sent from your API. Deploy it to your App by copy/paste trigger snippet.'
  );

  const gotItButton = await page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(gotItButton).toHaveText('Got it');
  await gotItButton.click();

  await expect(scratchWorkflowTooltip).not.toBeVisible();
});

test('should show the dots navigation after the intro step', async ({ page }) => {
  await page.goto('/workflows/create');

  const scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  const scratchWorkflowTooltipTitle = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle).toHaveText('Discover a quick guide');

  const scratchWorkflowTooltipDescription = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription).toHaveText('Four simple tips to become a workflow expert.');

  const scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');

  const scratchWorkflowTooltipPrimaryButton = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton).toHaveText('Show me');
  await scratchWorkflowTooltipPrimaryButton.click();

  const dotsNavigation = page.getByTestId('scratch-workflow-tooltip-dots-navigation');
  await expect(dotsNavigation).toBeVisible();
});

test.skip('should not show the start from scratch tour hints after it is shown twice ', async ({ page }) => {
  await page.goto('/workflows/create');

  let scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  const scratchWorkflowTooltipTitle = page.getByTestId('scratch-workflow-tooltip-title');
  await expect(scratchWorkflowTooltipTitle).toHaveText('Discover a quick guide');

  const scratchWorkflowTooltipDescription = page.getByTestId('scratch-workflow-tooltip-description');
  await expect(scratchWorkflowTooltipDescription).toHaveText('Four simple tips to become a workflow expert.');

  const scratchWorkflowTooltipPrimaryButton = page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPrimaryButton).toHaveText('Show me');

  let scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');
  await scratchWorkflowTooltipSkipButton.click();

  await expect(scratchWorkflowTooltip).not.toBeVisible();

  await page.reload();

  scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).toBeVisible();

  scratchWorkflowTooltipSkipButton = page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipButton).toHaveText('Watch later');
  await scratchWorkflowTooltipSkipButton.click();

  const scratchWorkflowTooltip2 = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip2).not.toBeVisible();

  await page.reload();

  scratchWorkflowTooltip = page.getByTestId('scratch-workflow-tooltip');
  await expect(scratchWorkflowTooltip).not.toBeVisible();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - scratchWorkflowTooltipPrimaryButton(page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(scratchWorkflowTooltipPr...)
 - scratchWorkflowTooltipSkipButton(page.getByTestId('scratch-workflow-tooltip-skip-button');
  await expect(scratchWorkflowTooltipSkipB...)
 - gotItButton(await page.getByTestId('scratch-workflow-tooltip-primary-button');
  await expect(gotItButton).toHav...)
 - dotsNavigation(page.getByTestId('scratch-workflow-tooltip-dots-navigation');
  await expect(dotsNavigation).toBeVis...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/steps-actions.spec.ts
Tamaño: 14070 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { ChannelType } from './utils/ChannelType';
import { NodeInAppEditingModalPageModel } from './page-models/nodeInAppEditingModalPageModel';
import { NodeDigestEditorPageModal } from './page-models/nodeDigestEditorPageModal';
import { NodeEmailEditorPageModal } from './page-models/nodeEmailEditorPageModal';
import { SessionData } from './utils/plugins';

let session: SessionData;
test.beforeEach(async ({ page }) => {
  ({ session } = await initializeSession(page));
});

test('should be able to delete a step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(4);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  await inAppModalPage.getStepActionsMenuButtonLocator().click();
  await inAppModalPage.getDeleteStepActionLocator().click();
  await page.getByRole('button', { name: 'Delete step' }).click();

  await expect(workflowEditorPage.getNode(ChannelType.IN_APP, 0)).not.toBeVisible();
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(3);
  await expect(workflowEditorPage.getAllNodes().nth(1)).toContainText('Email');

  await workflowEditorPage.submitTemplateBtn().click();
  await page.goto(`/workflows/edit/${template._id}`);
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(3);
});

test('should show add step in sidebar after delete', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(4);

  await workflowEditorPage.getNode(ChannelType.IN_APP, 0).hover();
  await workflowEditorPage.getStepActionsMenuButtonLocator().click();
  await workflowEditorPage.getDeleteStepActionLocator().click();
  await page.getByRole('button', { name: 'Delete step' }).click();

  await expect(workflowEditorPage.getNode(ChannelType.IN_APP, 0)).not.toBeVisible();
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(3);
  await expect(workflowEditorPage.getDragSideMenu()).toContainText('Channels');
});

test('should show add step in sidebar after a delete of a step with side settings ', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.addChannelToWorkflow(ChannelType.DIGEST);
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(5);

  await workflowEditorPage.clickWorkflowNode(ChannelType.DIGEST);
  const digestModalPage = new NodeDigestEditorPageModal(page);
  await digestModalPage.getDeleteButton().click();
  await page.getByRole('button', { name: 'Delete step' }).click();

  await expect(workflowEditorPage.getNode(ChannelType.DIGEST, 0)).not.toBeVisible();
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(4);
  await expect(workflowEditorPage.getDragSideMenu()).toContainText('Channels');
});

test('should keep steps order on reload', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const smsModalPage = await workflowEditorPage.addAndEditInSmsNode();
  await smsModalPage.fillSmsBody('new content for sms');
  await smsModalPage.nodeSettingsUpdateButton().click();

  await page.goto(`/workflows/edit/${template._id}`);

  await expect(workflowEditorPage.getAllNodes()).toHaveCount(5);
  await expect(workflowEditorPage.getAllNodes().nth(0)).toContainText('Workflow trigger');
  await expect(workflowEditorPage.getAllNodes().nth(1)).toContainText('In-App');
  await expect(workflowEditorPage.getAllNodes().nth(2)).toContainText('Email');
  await expect(workflowEditorPage.getAllNodes().nth(3)).toContainText('SMS');
});

test('should be able to disable step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  const inAppModalPage = new NodeInAppEditingModalPageModel(page);

  await expect(inAppModalPage.getStepActiveSwitch().locator('input')).toBeChecked();
  await inAppModalPage.getStepActiveSwitch().click({ force: true });
  await inAppModalPage.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  await expect(inAppModalPage.getStepActiveSwitch().locator('input')).not.toBeChecked();
});

test('should be able to toggle ShouldStopOnFailSwitch', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  const inAppModalPage = new NodeInAppEditingModalPageModel(page);

  await expect(inAppModalPage.getStepShouldStopOnFailSwitch()).toContainText('Stop if step fails');
  await inAppModalPage.getStepShouldStopOnFailSwitch().click({ force: true });
  await inAppModalPage.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await workflowEditorPage.editAction().click();
  await expect(inAppModalPage.getStepShouldStopOnFailSwitch().locator('input')).toBeChecked();
});

test('should be able to add filters to a digest step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const digestModalPage = await workflowEditorPage.addAndEditDigestNode();
  const conditionsPage = await digestModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('filter-key', 'Equal', 'filter-value');

  await expect(digestModalPage.getEditorSidebarEditConditionsButton()).toHaveText('1');
  await digestModalPage.nodeSettingsUpdateButton().click();
  await page.goto(`/workflows/edit/${template._id}`);
  await workflowEditorPage.clickWorkflowNode(ChannelType.DIGEST);
  await expect(digestModalPage.getEditorSidebarEditConditionsButton()).toContainText('1');
});

test('should be able to add filters to a delay step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  const delayModalPage = await workflowEditorPage.addAndEditDelayNode();
  const conditionsPage = await delayModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('filter-key', 'Equal', 'filter-value');

  await expect(delayModalPage.getEditorSidebarEditConditionsButton()).toHaveText('1');
  await delayModalPage.nodeSettingsUpdateButton().click();
  await page.goto(`/workflows/edit/${template._id}`);
  await workflowEditorPage.clickWorkflowNode(ChannelType.DELAY);
  await expect(delayModalPage.getEditorSidebarEditConditionsButton()).toContainText('1');
});

test('should be able to add filters to a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('filter-key', 'Equal', 'filter-value');

  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('1');
});

test('should be able to add read/seen filters to a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.EMAIL);

  const emailModalPage = new NodeEmailEditorPageModal(page);
  const conditionsPage = await emailModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewPreviousStepCondition('In-App', 'Seen');

  await expect(emailModalPage.getAddConditionsAction()).toHaveText('1');
});

test('should be able to not add read/seen filters to first step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.getAddNewConditionButton().click();
  await conditionsPage.getConditionsFormOnDropdown().click();
  await expect(page.getByRole('option', { name: 'Previous step' })).not.toBeVisible();
});

test('should be able to remove filters for a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('filter-key', 'Equal', 'filter-value');
  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('1');

  await inAppModalPage.getAddConditionsAction().click();
  await conditionsPage.getConditionsRowButton().click();
  await conditionsPage.getConditionsRowDeleteButton().click();
  await conditionsPage.getApplyConditionsButton().click();
  await expect(inAppModalPage.getAddConditionsAction()).not.toHaveText('1');
});

test('should be able to add webhook filter for a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewWebhookCondition('www.example.com', 'filter-key', 'Equal', 'filter-value');
  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('1');
});

test('should be able to add online right now filter for a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addOnlineNowCondition(true);
  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('1');
});

test('should be able to add online in the last X time period filter for a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addLastTimeOnlineCondition('Hours', '1');
  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('1');
});

test('should be able to add multiple filters to a particular step', async ({ page }) => {
  const template = session.templates[0];

  await page.goto(`/workflows/edit/${template._id}`);

  const workflowEditorPage = new WorkflowEditorPage(page);
  await workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);

  const inAppModalPage = new NodeInAppEditingModalPageModel(page);
  const conditionsPage = await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('filter-key', 'Equal', 'filter-value');
  await inAppModalPage.getAddConditionsAction().click();
  await conditionsPage.addOnlineNowCondition(true);
  await expect(inAppModalPage.getAddConditionsAction()).toHaveText('2');
});

test.skip('should re-render content on between step click', async ({ page }) => {
  await page.goto('/workflows/create');

  const workflowEditorPage = new WorkflowEditorPage(page);
  const smsModalPage1 = await workflowEditorPage.addAndEditInSmsNode();
  await smsModalPage1.fillSmsBody('first content for sms');
  await smsModalPage1.nodeSettingsUpdateButton().click();

  await smsModalPage1.closeSidePanel();

  const smsModalPage2 = await workflowEditorPage.addAndEditInSmsNode();
  await smsModalPage2.fillSmsBody('second content for sms');
  await smsModalPage2.nodeSettingsUpdateButton().click();

  await smsModalPage2.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.SMS, false);
  await workflowEditorPage.editAction().click();
  await expect(smsModalPage1.getMonacoEditor()).toContainText('first content for sms');

  await smsModalPage1.closeSidePanel();

  await workflowEditorPage.clickWorkflowNode(ChannelType.SMS, true);
  await workflowEditorPage.editAction().click();
  await expect(smsModalPage2.getMonacoEditor()).toContainText('second content for sms');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - inAppModalPage(new NodeInAppEditingModalPageModel(page);
  await inAppModalPage.getStepActionsMenuButtonLocator().c...)
 - workflowEditorPage(new WorkflowEditorPage(page);
  await expect(workflowEditorPage.getAllNodes()).toHaveCount(4);

  aw...)
 - digestModalPage(new NodeDigestEditorPageModal(page);
  await digestModalPage.getDeleteButton().click();
  await page...)
 - smsModalPage(await workflowEditorPage.addAndEditInSmsNode();
  await smsModalPage.fillSmsBody('new content for sm...)
 - inAppModalPage(new NodeInAppEditingModalPageModel(page);

  await expect(inAppModalPage.getStepActiveSwitch().locat...)
 - inAppModalPage(new NodeInAppEditingModalPageModel(page);

  await expect(inAppModalPage.getStepShouldStopOnFailSwit...)
 - conditionsPage(await digestModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('...)
 - conditionsPage(await delayModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('f...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('f...)
 - conditionsPage(await emailModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewPreviousStepCondition(...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.getAddNewConditionButton().c...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('f...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewWebhookCondition('www....)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addOnlineNowCondition(true);...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addLastTimeOnlineCondition('...)
 - conditionsPage(await inAppModalPage.openAddConditionsSidebar();
  await conditionsPage.addNewSubscriberCondition('f...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/subscribers.spec.ts
Tamaño: 657 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { SubscribersPage } from './page-models/subscribers';
import { initializeSession } from './utils/browser';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('should display subscribers list', async ({ page }) => {
  const subscribersPage = await SubscribersPage.goTo(page);
  await subscribersPage.assertSubscribersPageIsVisible();
  await subscribersPage.assertSubscribersTableHeaders([
    'Subscriber identifier',
    'First Name',
    'Last Name',
    'Email',
    'Phone',
    'Created At',
    'Data',
  ]);
  await subscribersPage.assertSubscribersTableRowCount(1);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/team-members.spec.ts
Tamaño: 690 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { initializeSession } from './utils/browser';
import { TeamMembersPage } from './page-models/teamMembersPage';

test.beforeEach(async ({ page }) => {
  await initializeSession(page);
});

test('invite a member to the organization and then remove them', async ({ page }) => {
  const teamMembersPage = await TeamMembersPage.goTo(page);
  await teamMembersPage.assertNumberOfUsersInTeamMembersList(1);

  await teamMembersPage.inviteUserByEmail('test@test.com');
  await teamMembersPage.assertNumberOfUsersInTeamMembersList(2);

  await teamMembersPage.removeUserFromTeam();
  await teamMembersPage.assertNumberOfUsersInTeamMembersList(1);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/templates-store.spec.ts
Tamaño: 1391 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { FeatureFlagsKeysEnum } from '@novu/shared';
import { test } from './utils/baseTest';
import { WorkflowsPage } from './page-models/workflowsPage';
import { initializeSession, setFeatureFlag } from './utils/browser';
import { populateBlueprints } from './utils/plugins';

test.beforeAll(async () => {
  await populateBlueprints();
});

test.beforeEach(async ({ page }) => {
  await setFeatureFlag(page, FeatureFlagsKeysEnum.IS_TEMPLATE_STORE_ENABLED, true);
  await initializeSession(page, { noTemplates: true });
});

test.skip('shows templates and creates a new workflow on template selection', async ({ page }) => {
  const workflowsPage = await WorkflowsPage.goTo(page);
  await expect(workflowsPage.getNoWorkflowsPlaceholder()).toBeVisible();
  await expect(workflowsPage.getCreateWorkflowTile()).toBeVisible();
  await expect(workflowsPage.getAllWorkflowTile()).toBeVisible();

  await expect(workflowsPage.getCreateWorkflowDropdown()).toBeVisible();
  await workflowsPage.getCreateWorkflowDropdown().click();
  await expect(workflowsPage.getCreateWorkflowButton()).toBeVisible();
  await expect(workflowsPage.getCreateAllTemplatesWorkflowButton()).toBeVisible();

  const createTemplateItem = workflowsPage.getCreateTemplateDropdownItem().nth(0);
  await createTemplateItem.click();

  await page.waitForURL('/workflows/edit/*');
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/tenants.spec.ts
Tamaño: 1156 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { test } from './utils/baseTest';
import { TenantsPage } from './page-models/tenantsPage';
import { assertPageShowsMessage, initializeSession } from './utils/browser';

test.beforeEach(async ({ page }) => {
  await initializeSession(page, { noTemplates: true });
});

test('should display empty tenants info', async ({ page }) => {
  await TenantsPage.goTo(page);
  await assertPageShowsMessage(page, 'Add the first tenant for the');
});
test('should add new tenant', async ({ page }) => {
  const tenantsPage = await TenantsPage.goTo(page);
  const newTenantName = await tenantsPage.createNewTenant();
  await assertPageShowsMessage(page, newTenantName);
});

test('should update existing tenant name', async ({ page }) => {
  let tenantsPage = await TenantsPage.goTo(page);
  const newTenantName = await tenantsPage.createNewTenant();
  await tenantsPage.clickElementByText(newTenantName);
  const newName = 'Some_updated_name';
  await page.getByTestId('tenant-name').fill(newName);
  await page.getByTestId('update-tenant-sidebar-submit').click();
  tenantsPage = await TenantsPage.goTo(page);
  await assertPageShowsMessage(page, newName);
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - newTenantName(await tenantsPage.createNewTenant();
  await assertPageShowsMessage(page, newTenantName);
});

test(...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/translations.spec.ts
Tamaño: 1681 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import path from 'path';
import { test } from './utils/baseTest';
import { assertPageShowsMessage, initializeSession, setFeatureFlag } from './utils/browser';
import { TranslationsPage } from './page-models/translationsPage';

test.describe('Translations', () => {
  test.skip(process.env.NOVU_ENTERPRISE !== 'true', 'Skipping tests for non enterprise variant...');

  test.beforeEach(async ({ page }) => {
    await initializeSession(page, { noTemplates: true });
  });

  test.skip('Can create translation group', async ({ page }) => {
    const groupName = 'My Test Group';
    const translationsPage = await TranslationsPage.goTo(page);
    await translationsPage.assertTitleEquals('Translations');
    await translationsPage.createGroup(groupName);
    await translationsPage.assertHasHeading(groupName);
  });

  test.skip('Can delete a translation group', async ({ page }) => {
    const translationsPage = await TranslationsPage.goTo(page);
    const { identifier } = await translationsPage.createGroup();
    await translationsPage.navigateToGroup(identifier);
    await page.getByTestId('delete-group-btn').click();
    await page.getByTestId('delete-group-submit-btn').click();
    await translationsPage.assertGroupDoesNotExist(identifier);
  });

  test.skip('Can upload translation file', async ({ page }) => {
    const translationsPage = await TranslationsPage.goTo(page);
    const { identifier } = await translationsPage.createGroup();
    await translationsPage.navigateToGroup(identifier);
    await translationsPage.uploadTranslationFile(path.join(__dirname, 'fixtures/translation.json'));
    await assertPageShowsMessage(page, 'translation.json');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - translationsPage(await TranslationsPage.goTo(page);
    await translationsPage.assertTitleEquals('Translations');
   ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/variants.spec.ts
Tamaño: 18573 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { test } from './utils/baseTest';
import { VARIANT_NAMES, VariantPreviewModalPage } from './page-models/variantPreviewModalPage';
import { WorkflowEditorPage } from './page-models/workflowEditorPage';
import { initializeSession, waitForNetworkIdle } from './utils/browser';
import { ChannelType } from './utils/ChannelType';
import { EditorState } from './page-models/editorState';
import { ChangesPage } from './page-models/changesPage';
import { SidebarPage } from './page-models/sidebarPage';
import { WorkflowsPage } from './page-models/workflowsPage';
import { addConditions } from './utils/commands';

test.beforeEach(async ({ page }) => {
  await initializeSession(page, { noTemplates: true });
});

test('Creates variant for email channel', async ({ page }) => {
  const emailSubject = 'test email subject';
  const emailParagraph = 'this is a test paragraph';
  const emailSubjectVariant = 'Variant test email subject';
  const emailParagraphVariant = 'Variant this is a test paragraph';
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillEmailNode(emailSubject, emailParagraph, 'Test Add Variant Flow for email');
  const emailVariantEditor = await workflowEditorPage.addVariantToEmailNode();
  await emailVariantEditor.assertEmailSubjectContains(emailSubject);
  await emailVariantEditor.assertEmailContentFirstParagraphContains(emailParagraph);
  const variantPreviewModalPage = await emailVariantEditor.updateEmailData(emailSubjectVariant, emailParagraphVariant);
  await workflowEditorPage.assertPageShowsPopUpMessage('Trigger code is updated successfully');
  await variantPreviewModalPage.assertHasVariant(VARIANT_NAMES.EMAIL);
});

test('Creates variant for inApp channel', async ({ page }) => {
  const inAppBody = 'this is a test paragraph';
  const inAppBodyVariant = 'Variant this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillInAppNode(inAppBody, 'Test Add Variant Flow for inApp');
  const inAppVariantEditor = await workflowEditorPage.addVariantToInAppNode();
  await inAppVariantEditor.assertPreviewText(inAppBody);
  const variantPreviewModalPage = await inAppVariantEditor.updateInAppData(inAppBodyVariant);
  await workflowEditorPage.assertPageShowsPopUpMessage('Trigger code is updated successfully');
  await variantPreviewModalPage.assertHasVariant(VARIANT_NAMES.IN_APP);
});

test('Creates variant for SMS channel', async ({ page }) => {
  const smsBody = 'this is a test paragraph';
  const smsBodyVariant = 'Variant this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillSmsNode(smsBody, 'Test Add Variant Flow for SMS');
  const smsVariantEditor = await workflowEditorPage.addVariantToSmsNode();
  await smsVariantEditor.assertBodyContains(smsBody);
  const variantPreviewModalPage = await smsVariantEditor.updateSmsData(smsBodyVariant);
  await workflowEditorPage.assertPageShowsPopUpMessage('Trigger code is updated successfully');
  await variantPreviewModalPage.assertHasVariant(VARIANT_NAMES.SMS);
});

test('Creates variant for Chat channel', async ({ page }) => {
  const chatBody = 'this is a test paragraph';
  const chatBodyVariant = 'Variant this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillChatNode(chatBody, 'Test Add Variant Flow for Chat');
  const chatVariantEditor = await workflowEditorPage.addVariantToChatNode();
  await chatVariantEditor.assertBodyContains(chatBody);
  const variantPreviewModalPage = await chatVariantEditor.updateChatData(chatBodyVariant);
  await workflowEditorPage.assertPageShowsPopUpMessage('Trigger code is updated successfully');
  await variantPreviewModalPage.assertHasVariant(VARIANT_NAMES.CHAT);
});

test('Creates variant for Push channel', async ({ page }) => {
  const pushSubject = 'this is a push subject';
  const pushBody = 'this is a test paragraph';

  const pushSubjectVariant = 'this is a push subject';
  const pushBodyVariant = 'Variant this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillPushNode(pushSubject, pushBody, 'Test Add Variant Flow for Push');
  const pushVariantEditor = await workflowEditorPage.addVariantToPushNode();
  await pushVariantEditor.assertPushSubjectContains(pushSubject);
  await pushVariantEditor.assertPushBodyContains(pushBody);
  const variantPreviewModalPage = await pushVariantEditor.updatePushData(pushSubjectVariant, pushBodyVariant);
  await workflowEditorPage.assertPageShowsPopUpMessage('Trigger code is updated successfully');
  await variantPreviewModalPage.assertHasVariant(VARIANT_NAMES.PUSH);
});

test('should allow creating variant from the step editor', async ({ page }) => {
  const inAppBody = 'this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test Add Variant Flow from step editor');
  const nodeInAppEditingPageModel = await workflowEditorPage.addAndEditInAppNode();
  await nodeInAppEditingPageModel.fillNotificationBody(inAppBody);
  await nodeInAppEditingPageModel.getEditorAddVariantButton().click();

  await addConditions(page);

  await nodeInAppEditingPageModel.switchEditorMode(EditorState.PREVIEW);
  await nodeInAppEditingPageModel.assertPreviewText(inAppBody);
});

test('should allow adding multiple variants', async ({ page }) => {
  const inAppBody = 'this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test Add multiple variants');
  const nodeInAppEditingPageModel = await workflowEditorPage.addAndEditInAppNode();
  await nodeInAppEditingPageModel.fillNotificationBody(inAppBody);
  await nodeInAppEditingPageModel.getEditorAddVariantButton().click();

  await addConditions(page);

  await nodeInAppEditingPageModel.closeSidePanel();
  const variantPreviewModalPage = new VariantPreviewModalPage(page);

  await variantPreviewModalPage.getVariantPreviewAddVariantButton().click();

  await addConditions(page);

  await variantPreviewModalPage.closeSidePanel();
  variantPreviewModalPage.assertHasVariantCount(2);
});

test('shold not allow adding variants for digest step', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test no variants in digest');
  const nodeDigestEditorPageModal = await workflowEditorPage.addAndEditDigestNode();
  expect(page.getByTestId('editor-sidebar-add-variant')).toHaveCount(0);
  expect(page.getByTestId('add-variant-action')).toHaveCount(0);
  await nodeDigestEditorPageModal.closeSidePanel();
  await workflowEditorPage.hoverWorkflowNode(ChannelType.DIGEST, true);
  await workflowEditorPage.getStepActionsMenuButtonLocator().click();
  expect(page.getByTestId('editor-sidebar-add-variant')).toHaveCount(0);
  expect(page.getByTestId('add-variant-action')).toHaveCount(0);
});

test('shold not allow adding variants for delay step', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test no variants in delay');
  const nodeDelayEditorPageModal = await workflowEditorPage.addAndEditDelayNode();
  expect(page.getByTestId('editor-sidebar-add-variant')).toHaveCount(0);
  expect(page.getByTestId('add-variant-action')).toHaveCount(0);
  await nodeDelayEditorPageModal.closeSidePanel();
  await workflowEditorPage.hoverWorkflowNode(ChannelType.DELAY, true);
  await workflowEditorPage.getStepActionsMenuButtonLocator().click();
  expect(page.getByTestId('editor-sidebar-add-variant')).toHaveCount(0);
  expect(page.getByTestId('add-variant-action')).toHaveCount(0);
});

// TODO: Fix Flakey test
test.skip('should show step actions with no variants', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test no variants in delay');
  await workflowEditorPage.addChannelToWorkflow(ChannelType.IN_APP);
  await workflowEditorPage.hoverWorkflowNode(ChannelType.IN_APP);
  await expect(workflowEditorPage.getStepActionsMenuButtonLocator()).toBeVisible();
  await expect(workflowEditorPage.editAction()).toBeVisible();
  await expect(workflowEditorPage.getAddConditionsButton()).toBeVisible();
  await workflowEditorPage.getStepActionsMenuButtonLocator().click();
  await expect(workflowEditorPage.getAddVariantActionLocator()).toBeVisible();
  await expect(workflowEditorPage.getDeleteStepActionLocator()).toBeVisible();
});

// TODO: Fix Flakey test
test.skip('should show step actions with a variant', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test no variants in delay');
  const nodeInAppEditingPageModel = await workflowEditorPage.addAndEditInAppNode();
  await nodeInAppEditingPageModel.fillNotificationBody('some notification body');
  await nodeInAppEditingPageModel.pressUpdate();
  await nodeInAppEditingPageModel.closeSidePanel();

  const variantOverviewPage = await workflowEditorPage.addVariantToInAppNode();

  await variantOverviewPage.closeSidePanel();

  await workflowEditorPage.hoverWorkflowNode(ChannelType.IN_APP);
  await expect(workflowEditorPage.getStepActionsMenuButtonLocator()).toBeVisible();
  await expect(workflowEditorPage.editAction()).toBeVisible();
  await expect(workflowEditorPage.getAddConditionsButton()).toBeVisible();
  await workflowEditorPage.getStepActionsMenuButtonLocator().click();
  await expect(workflowEditorPage.getAddVariantActionLocator()).toBeVisible();
  await expect(workflowEditorPage.getDeleteStepActionLocator()).toBeVisible();
});

test('should show only edit step in production for simple node', async ({ page }) => {
  let workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillSmsNode('this is a test paragraph', 'Test Add Variant Flow for SMS');

  const changesPage = await ChangesPage.goTo(page);
  await changesPage.getPromoteAllButton().click();
  const sidebarPage = await SidebarPage.goTo(page);
  await sidebarPage.toggleToProduction();

  await sidebarPage.getTemplatesLink().click();
  workflowEditorPage = await new WorkflowsPage(page).getFirstWorkflowEditor();
  const relevantNode = workflowEditorPage.getNode(ChannelType.SMS, 0);

  await relevantNode.hover();
  expect(relevantNode.getByTestId('conditions-action')).toHaveCount(0);
  expect(relevantNode.getByTestId('edit-action')).toHaveCount(1);
  expect(relevantNode.getByTestId('add-conditions-action')).toHaveCount(0);
  expect(relevantNode.getByTestId('step-actions-menu')).toHaveCount(0);
});

test.skip('should show edit step and conditions in production for node with conditions', async ({ page }) => {
  let workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillSmsNode('this is a test paragraph', 'Test Add Variant Flow for SMS');

  await workflowEditorPage.addConditionToNode(ChannelType.SMS);
  await workflowEditorPage.clickUpdate();

  const changesPage = await ChangesPage.goTo(page);
  await changesPage.getPromoteAllButton().click();
  const sidebarPage = await SidebarPage.goTo(page);
  await sidebarPage.toggleToProduction();

  await sidebarPage.getTemplatesLink().click();
  workflowEditorPage = await new WorkflowsPage(page).getFirstWorkflowEditor();
  const relevantNode = workflowEditorPage.getNode(ChannelType.SMS, 0);

  await relevantNode.hover();
  expect(relevantNode.getByTestId('conditions-action')).toHaveCount(0);
  expect(relevantNode.getByTestId('edit-action')).toHaveCount(1);
  expect(relevantNode.getByTestId('add-conditions-action')).toHaveCount(1);
  expect(relevantNode.getByTestId('step-actions-menu')).toHaveCount(0);
});

test('ensure the step editor has expected actions', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test Add Variant Flow for email');
  await workflowEditorPage.addAndEditEmailNode();
  await assertHasExpectedNonVariantEditorButtons(page);
});

test('ensure the variant step editor has expected actions', async ({ page }) => {
  const emailSubject = 'test email subject';
  const emailParagraph = 'this is a test paragraph';

  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Test Add Variant Flow for email');
  const nodeEmailEditorPageModal = await workflowEditorPage.addAndEditEmailNode();
  await nodeEmailEditorPageModal.fillEmailSubject(emailSubject);
  await nodeEmailEditorPageModal.editEmailBodyTextParagraph(emailParagraph);
  await nodeEmailEditorPageModal.closeSidePanel();
  await workflowEditorPage.addVariantToEmailNode();

  await assertHasExpectedVariantEditorButtons(page);
});

test('ensure production node editor only shows close button for simple case', async ({ page }) => {
  let workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillSmsNode('this is a test paragraph', 'Test Add Flow for SMS');

  const changesPage = await ChangesPage.goTo(page);
  await changesPage.getPromoteAllButton().click();
  const sidebarPage = await SidebarPage.goTo(page);
  await sidebarPage.toggleToProduction();

  await sidebarPage.getTemplatesLink().click();
  workflowEditorPage = await new WorkflowsPage(page).getFirstWorkflowEditor();
  const smsNodeEditorPage = await workflowEditorPage.getFirstSmsNodeEditor();

  expect(smsNodeEditorPage.getEditorAddVariantButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getAddConditionsSidebarButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getEditConditionsButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getDeleteButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getCloseSidebarLocator()).toHaveCount(1);
});

test.skip('ensure production shows close and edit conditions button for conditioned node', async ({ page }) => {
  let workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillSmsNode('this is a test paragraph', 'Test Add Flow for SMS');
  await workflowEditorPage.addConditionToNode(ChannelType.SMS);
  await workflowEditorPage.clickUpdate();

  const changesPage = await ChangesPage.goTo(page);
  await changesPage.getPromoteAllButton().click();
  const sidebarPage = await SidebarPage.goTo(page);
  await sidebarPage.toggleToProduction();

  await sidebarPage.getTemplatesLink().click();
  workflowEditorPage = await new WorkflowsPage(page).getFirstWorkflowEditor();

  const smsNodeEditorPage = await workflowEditorPage.getFirstSmsNodeEditor();

  expect(smsNodeEditorPage.getEditorAddVariantButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getAddConditionsSidebarButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getEditConditionsButton()).toHaveCount(1);
  expect(smsNodeEditorPage.getDeleteButton()).toHaveCount(0);
  expect(smsNodeEditorPage.getCloseSidebarLocator()).toHaveCount(1);
});

test('Allows adding conditions on the step', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillInAppNode('this is a test paragraph', 'Test Add conditional Flow for inApp');
  const relevantNode = workflowEditorPage.getNode(ChannelType.IN_APP, 0);
  await relevantNode.hover();
  workflowEditorPage.getAddConditionsButton().click();
  await addConditions(page);
  workflowEditorPage.clickWorkflowNode(ChannelType.IN_APP);
  await expect(workflowEditorPage.getAddConditionsButton()).toHaveCount(1);
  await expect(workflowEditorPage.getConditionsButton()).toHaveCount(1);
});

test('Allows adding conditions from the variants overview modal header', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillInAppNode('this is a test paragraph', 'Test Add conditional Flow for inApp');
  const inAppVariantEditor = await workflowEditorPage.addVariantToInAppNode();
  const variantOverview = await inAppVariantEditor.updateInAppData('some new content');
  await expect(variantOverview.getVariantAddConditionsButton()).toHaveCount(1);
  await variantOverview.addConditionToVariantNode();
  await expect(variantOverview.getVariantEditConditionsButton()).toHaveCount(1);
});

test('Allows adding second variant condition from the variants overview modal header', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.addAndFillInAppNode('this is a test paragraph', 'Test Add conditional Flow for inApp');
  const inAppVariantEditor = await workflowEditorPage.addVariantToInAppNode();
  const variantOverview = await inAppVariantEditor.updateInAppData('some new content');
  await expect(variantOverview.getVariantAtIndex(0)).toContainText('1');
  await variantOverview.addVariantConditionAtIndex(0);
  await expect(variantOverview.getVariantAtIndex(0)).toContainText('2');
});

// TODO: Fix flakey test
test.skip('Allows adding second condition from the in step editor', async ({ page }) => {
  const workflowEditorPage = await WorkflowEditorPage.goToNewWorkflow(page);
  const inAppEditor = await workflowEditorPage.addAndEditInAppNode();
  await inAppEditor.fillNotificationBody('some content');
  await inAppEditor.pressUpdate();
  await inAppEditor.addConditionViaSidebar();
  expect(inAppEditor.getEditConditionsButton()).toContainText('1');
  await inAppEditor.addMoreConditionViaSidebar();
  expect(inAppEditor.getEditConditionsButton()).toContainText('2');
});

async function assertHasExpectedNonVariantEditorButtons(page: Page) {
  await expect(page.getByTestId('editor-sidebar-add-variant')).toBeVisible();
  await expect(page.getByTestId('editor-sidebar-add-conditions')).toBeVisible();
  await expect(page.getByTestId('editor-sidebar-delete')).toBeVisible();
}

async function assertHasExpectedVariantEditorButtons(page: Page) {
  await expect(page.getByTestId('editor-sidebar-edit-conditions')).toBeVisible();
  await expect(page.getByTestId('editor-sidebar-delete')).toBeVisible();
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - assertHasExpectedNonVariantEditorButtons(page: Page)
 - assertHasExpectedVariantEditorButtons(page: Page)
Asignaciones con arrow functions encontradas (posibles funciones):
 - variantPreviewModalPage(await emailVariantEditor.updateEmailData(emailSubjectVariant, emailParagraphVariant);
  await workfl...)
 - variantPreviewModalPage(await inAppVariantEditor.updateInAppData(inAppBodyVariant);
  await workflowEditorPage.assertPageSho...)
 - variantPreviewModalPage(await smsVariantEditor.updateSmsData(smsBodyVariant);
  await workflowEditorPage.assertPageShowsPopU...)
 - variantPreviewModalPage(await chatVariantEditor.updateChatData(chatBodyVariant);
  await workflowEditorPage.assertPageShowsP...)
 - variantPreviewModalPage(await pushVariantEditor.updatePushData(pushSubjectVariant, pushBodyVariant);
  await workflowEditorP...)
 - nodeInAppEditingPageModel(await workflowEditorPage.addAndEditInAppNode();
  await nodeInAppEditingPageModel.fillNotificationBo...)
 - variantPreviewModalPage(new VariantPreviewModalPage(page);

  await variantPreviewModalPage.getVariantPreviewAddVariantButto...)
 - nodeDigestEditorPageModal(await workflowEditorPage.addAndEditDigestNode();
  expect(page.getByTestId('editor-sidebar-add-varia...)
 - nodeDelayEditorPageModal(await workflowEditorPage.addAndEditDelayNode();
  expect(page.getByTestId('editor-sidebar-add-varian...)
 - workflowEditorPage(await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Tes...)
 - variantOverviewPage(await workflowEditorPage.addVariantToInAppNode();

  await variantOverviewPage.closeSidePanel();

  ...)
 - relevantNode(workflowEditorPage.getNode(ChannelType.SMS, 0);

  await relevantNode.hover();
  expect(relevantNode...)
 - relevantNode(workflowEditorPage.getNode(ChannelType.SMS, 0);

  await relevantNode.hover();
  expect(relevantNode...)
 - workflowEditorPage(await WorkflowEditorPage.goToNewWorkflow(page);
  await workflowEditorPage.setWorkflowNameInput('Tes...)
 - nodeEmailEditorPageModal(await workflowEditorPage.addAndEditEmailNode();
  await nodeEmailEditorPageModal.fillEmailSubject(em...)
 - smsNodeEditorPage(await workflowEditorPage.getFirstSmsNodeEditor();

  expect(smsNodeEditorPage.getEditorAddVariantBut...)
 - smsNodeEditorPage(await workflowEditorPage.getFirstSmsNodeEditor();

  expect(smsNodeEditorPage.getEditorAddVariantBut...)
 - relevantNode(workflowEditorPage.getNode(ChannelType.IN_APP, 0);
  await relevantNode.hover();
  workflowEditorPag...)
 - variantOverview(await inAppVariantEditor.updateInAppData('some new content');
  await expect(variantOverview.getVari...)
 - variantOverview(await inAppVariantEditor.updateInAppData('some new content');
  await expect(variantOverview.getVari...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/variants.unmigrated-tests.ts
Tamaño: 32271 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

// import { Channel } from '.';

/*
 * const EDITOR_TEXT = 'Hello, world!';
 * const VARIANT_EDITOR_TEXT = 'Hello, world from Variant!';
 * const SUBJECT_LINE = 'Novu test';
 * const PUSH_TITLE = 'Push test';
 */

/*
 * describe('Workflow Editor - Variants', function () {
 *   beforeEach(function () {
 *     cy.initializeSession().as('session');
 *   });
 */

//   const createWorkflow = (title: string) => {
//     cy.intercept('GET', '**/notification-templates/**').as('getWorkflow');
//     cy.intercept('PUT', '**/notification-templates/**').as('updateWorkflow');
//     cy.waitLoadTemplatePage(() => {
//       cy.visit('/workflows/create');
//     });
//     cy.wait('@getWorkflow');
//     cy.getByTestId('name-input').first().clear().type(title).blur();
//   };

/*
 *   const fillInAppEditorContentWith = (text: string) => {
 *     cy.get('.monaco-editor textarea:first').parent().click().find('textarea').clear({ force: true }).type(text, {
 *       parseSpecialCharSequences: false,
 *       force: true,
 *     });
 *   };
 */

/*
 *   const fillEmailEditorContentWith = (subjectLine: string, content: string) => {
 *     cy.getByTestId('emailSubject').clear().type(subjectLine, {
 *       parseSpecialCharSequences: false,
 *       force: true,
 *     });
 *     cy.getByTestId('editable-text-content').clear().type(content, {
 *       parseSpecialCharSequences: false,
 *     });
 *   };
 */

/*
 *   const fillSmsEditorContentWith = (content: string) => {
 *     cy.get('.monaco-editor textarea:first').parent().click().find('textarea').clear({ force: true }).type(content, {
 *       parseSpecialCharSequences: false,
 *       force: true,
 *     });
 *   };
 */

/*
 *   const fillChatEditorContentWith = (content: string) => {
 *     cy.get('.monaco-editor textarea:first').parent().click().find('textarea').clear({ force: true }).type(content, {
 *       parseSpecialCharSequences: false,
 *       force: true,
 *     });
 *   };
 */

/*
 *   const fillPushEditorContentWith = (title: string, content: string) => {
 *     cy.get('[data-test-id=push-title-container] .monaco-editor textarea:first')
 *       .parent()
 *       .click()
 *       .find('textarea')
 *       .clear({ force: true })
 *       .type(title, {
 *         parseSpecialCharSequences: false,
 *         force: true,
 *       });
 *     cy.get('[data-test-id=push-content-container] .monaco-editor textarea:first')
 *       .parent()
 *       .click()
 *       .find('textarea')
 *       .clear({ force: true })
 *       .type(content, {
 *         parseSpecialCharSequences: false,
 *         force: true,
 *       });
 *   };
 */

/*
 *   const showStepActions = (channel: Channel) => {
 *     cy.getByTestId(`node-${channel}Selector`).parent().trigger('mouseover');
 *   };
 */

/*
 *   const addVariantActionClick = (channel: Channel) => {
 *     cy.getByTestId(`node-${channel}Selector`)
 *       .getByTestId('step-actions-menu')
 *       .click()
 *       .getByTestId('add-variant-action')
 *       .click();
 *   };
 */

/*
 *   const addConditions = () => {
 *     cy.getByTestId('add-new-condition').click();
 *     cy.getByTestId('conditions-form-key').last().type('test');
 *     cy.getByTestId('conditions-form-value').last().type('test');
 *     cy.getByTestId('apply-conditions-btn').click({ force: true });
 *   };
 */

/*
 *   const fillEditorContent = (channel: Channel, isVariant = false) => {
 *     switch (channel) {
 *       case 'inApp':
 *         fillInAppEditorContentWith(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'email':
 *         fillEmailEditorContentWith(SUBJECT_LINE, isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'sms':
 *         fillSmsEditorContentWith(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'chat':
 *         fillChatEditorContentWith(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'push':
 *         fillPushEditorContentWith(PUSH_TITLE, isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *     }
 *   };
 */

/*
 *   const checkEditorContent = (channel: Channel, isVariant = false) => {
 *     switch (channel) {
 *       case 'inApp':
 *         cy.get('.monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .contains(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'email':
 *         cy.getByTestId('emailSubject').should('have.value', SUBJECT_LINE);
 *         cy.getByTestId('email-editor').contains(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'sms':
 *         cy.get('.monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .contains(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'chat':
 *         cy.get('.monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .contains(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *       case 'push':
 *         cy.get('[data-test-id=push-title-container] .monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .contains(PUSH_TITLE);
 *         cy.get('[data-test-id=push-content-container] .monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .contains(isVariant ? VARIANT_EDITOR_TEXT : EDITOR_TEXT);
 *         break;
 *     }
 *   };
 */

/*
 *   const clearEditorContent = (channel: Channel) => {
 *     switch (channel) {
 *       case 'inApp':
 *         cy.get('.monaco-editor textarea:first').parent().click().type('{cmd}a').find('textarea').clear({
 *           force: true,
 *         });
 *         break;
 *       case 'email':
 *         cy.getByTestId('emailSubject').clear();
 *         cy.getByTestId('email-editor').clear();
 *         break;
 *       case 'sms':
 *         cy.get('.monaco-editor textarea:first').parent().click().type('{cmd}a').find('textarea').clear({
 *           force: true,
 *         });
 *         break;
 *       case 'chat':
 *         cy.get('.monaco-editor textarea:first').parent().click().type('{cmd}a').find('textarea').clear({
 *           force: true,
 *         });
 *         break;
 *       case 'push':
 *         cy.get('[data-test-id=push-title-container] .monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .find('textarea')
 *           .type(Cypress.platform === 'darwin' ? '{cmd}a' : '{ctrl}a', { force: true })
 *           .clear({
 *             force: true,
 *           });
 */

/*
 *         cy.get('[data-test-id=push-content-container] .monaco-editor textarea:first')
 *           .parent()
 *           .click()
 *           .find('textarea')
 *           .type(Cypress.platform === 'darwin' ? '{cmd}a' : '{ctrl}a', { force: true })
 *           .clear({
 *             force: true,
 *           });
 *         break;
 *     }
 *   };
 */

/*
 *   const navigateAndPromoteAllChanges = () => {
 *     cy.getByTestId('side-nav-changes-link').click();
 *     cy.waitForNetworkIdle(500);
 *     cy.awaitAttachedGetByTestId('promote-all-btn').click();
 *   };
 */

/*
 *   const navigateAndOpenFirstWorkflow = () => {
 *     cy.getByTestId('side-nav-templates-link').click();
 *     cy.waitForNetworkIdle(500);
 *     cy.getByTestId('notifications-template').find('tbody tr').first().click();
 *     cy.wait('@getWorkflow');
 *   };
 */

/*
 *   const switchEnvironment = (environment: 'Production' | 'Development') => {
 *     cy.getByTestId('environment-switch').find(`input[value="${environment}"]`).click({ force: true });
 *     cy.waitForNetworkIdle(500);
 *   };
 */

/*
 *   const checkVariantListCard = ({
 *     selector,
 *     message,
 *     hasBorder = false,
 *   }: {
 *     message: string;
 *     selector: string;
 *     hasBorder?: boolean;
 *   }) => {
 *     cy.getByTestId(selector).contains(message);
 *     if (hasBorder) {
 *       cy.getByTestId(selector)
 *         .find('div[role="button"]')
 *         .first()
 *         .should('have.css', 'border-style', 'solid')
 *         .and('have.css', 'border-width', '1px');
 *     }
 *   };
 */

/*
 *   describe('Add conditions action', function () {
 *     it('should allow adding the conditions in the variant editor', function () {
 *       createWorkflow('Test Conditions Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'email'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'email'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('email')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('email');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('email');
 *       addVariantActionClick('email');
 *       addConditions();
 */

/*
 *       cy.getByTestId('editor-sidebar-edit-conditions').contains('1');
 *       cy.getByTestId('editor-sidebar-edit-conditions').click();
 *       addConditions();
 */

/*
 *       cy.getByTestId('editor-sidebar-edit-conditions').contains('2');
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 *       cy.getByTestId('editor-sidebar-edit-conditions').contains('2');
 *     });
 */

/*
 *     it('in production should only allow edit and view conditions on variant list item', function () {
 *       const channel = 'chat';
 *       createWorkflow(`Production Variant Actions`);
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${channel}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes(channel)) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent(channel);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

//       navigateAndPromoteAllChanges();

//       switchEnvironment('Production');

//       navigateAndOpenFirstWorkflow();

//       cy.clickWorkflowNode(`node-${channel}Selector`);

/*
 *       cy.getByTestId('variant-item-card-0').getByTestId('conditions-action').should('be.visible').contains('1');
 *       cy.getByTestId('variant-item-card-0').trigger('mouseover');
 *       cy.getByTestId('variant-item-card-0').getByTestId('edit-action').should('be.visible');
 *       cy.getByTestId('variant-item-card-0').getByTestId('add-conditions-action').should('be.visible');
 *       cy.getByTestId('variant-item-card-0').getByTestId('step-actions-menu').should('not.exist');
 *     });
 */

/*
 *     it('in production should only allow edit the variant root list item', function () {
 *       const channel = 'chat';
 *       createWorkflow(`Production Variant Actions`);
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${channel}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes(channel)) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent(channel);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

//       navigateAndPromoteAllChanges();

//       switchEnvironment('Production');

//       navigateAndOpenFirstWorkflow();

//       cy.clickWorkflowNode(`node-${channel}Selector`);

/*
 *       cy.getByTestId('variant-root-card').getByTestId('conditions-action').should('be.visible').contains('No');
 *       cy.getByTestId('variant-root-card').trigger('mouseover');
 *       cy.getByTestId('variant-root-card').getByTestId('edit-step-action').should('be.visible');
 *       cy.getByTestId('variant-root-card').getByTestId('add-conditions-action').should('not.exist');
 *       cy.getByTestId('variant-root-card').getByTestId('step-actions-menu').should('not.exist');
 *     });
 *   });
 */

/*
 *   describe('Edit action', function () {
 *     it('should allow editing step', function () {
 *       createWorkflow('Test Edit Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'inApp'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'inApp'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('inApp')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('inApp');
 *       cy.getByTestId('edit-action').should('be.visible').click();
 */

/*
 *       checkEditorContent('inApp');
 *     });
 */

/*
 *     it('should allow editing root step from the variants list', function () {
 *       createWorkflow('Test Edit Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'inApp'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'inApp'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('inApp')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('inApp');
 *       addVariantActionClick('inApp');
 *       addConditions();
 *       checkEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       cy.getByTestId('variant-root-card').getByTestId('conditions-action').should('be.visible').contains('No');
 *       cy.getByTestId('variant-root-card').should('be.visible').trigger('mouseover');
 *       cy.getByTestId('variant-root-card').getByTestId('edit-step-action').should('be.visible').click();
 */

/*
 *       checkEditorContent('inApp');
 *     });
 */

/*
 *     it('should allow editing variant from the variants list', function () {
 *       createWorkflow('Test Edit Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'inApp'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'inApp'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('inApp')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('inApp');
 *       addVariantActionClick('inApp');
 *       addConditions();
 *       checkEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       cy.getByTestId('variant-item-card-0').getByTestId('conditions-action').should('be.visible').contains('1');
 *       cy.getByTestId('variant-item-card-0').should('be.visible').trigger('mouseover');
 *       cy.getByTestId('variant-item-card-0').getByTestId('edit-action').should('be.visible').click();
 */

/*
 *       checkEditorContent('inApp');
 *     });
 *   });
 */

/*
 *   describe('Delete action', function () {
 *     it('should allow deleting step', function () {
 *       createWorkflow('Test Delete Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'inApp'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'inApp'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('inApp')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('inApp');
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 */

/*
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('inApp');
 *       cy.getByTestId('step-actions-menu').should('be.visible').click();
 *       cy.getByTestId('step-actions-menu').getByTestId('delete-step-action').should('be.visible').click();
 */

/*
 *       cy.get('.mantine-Modal-modal').contains('Delete step?');
 *       cy.get('.mantine-Modal-modal button').contains('Delete step').click();
 *       cy.getByTestId(`node-inAppSelector`).should('not.exist');
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 */

/*
 *       cy.getByTestId(`node-inAppSelector`).should('not.exist');
 *     });
 */

/*
 *     it('should allow deleting step from the variants list', function () {
 *       createWorkflow('Test Delete Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'email'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'email'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('email')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('email');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('email');
 *       addVariantActionClick('email');
 *       addConditions();
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 */

//       cy.getByTestId('variant-sidebar-delete').click();

/*
 *       cy.get('.mantine-Modal-modal').contains('Delete step?');
 *       cy.get('.mantine-Modal-modal button').contains('Delete step').click();
 *       cy.getByTestId(`node-emailSelector`).should('not.exist');
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 */

/*
 *       cy.getByTestId(`node-emailSelector`).should('not.exist');
 *     });
 */

/*
 *     it('should allow deleting variant', function () {
 *       createWorkflow('Test Delete Action');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'email'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'email'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('email')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('email');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('email');
 *       addVariantActionClick('email');
 *       addConditions();
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       cy.getByTestId('variant-item-card-0').should('be.visible').trigger('mouseover');
 *       cy.getByTestId('variant-item-card-0').getByTestId('step-actions-menu').should('be.visible').click();
 *       cy.getByTestId('variant-item-card-0').getByTestId('delete-step-action').click();
 */

/*
 *       cy.get('.mantine-Modal-modal').contains('Delete variant?');
 *       cy.get('.mantine-Modal-modal button').contains('Delete variant').click();
 *       cy.getByTestId('variant-item-card-0').should('not.exist');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 *       cy.getByTestId('variants-count').should('not.exist');
 *     });
 */

/*
 *     it('should not allow removing all conditions from a variant', function () {
 *       createWorkflow('Test Removing All Conditions');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${'inApp'}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${'inApp'}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes('inApp')) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent('inApp');
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions('inApp');
 *       addVariantActionClick('inApp');
 *       addConditions();
 */

/*
 *       cy.getByTestId('notification-template-submit-btn').click();
 *       cy.wait('@updateWorkflow');
 */

/*
 *       cy.reload();
 *       cy.wait('@getWorkflow');
 */

/*
 *       // edit the variant condition
 *       cy.getByTestId('editor-sidebar-edit-conditions').click();
 */

/*
 *       // open conditions row menu
 *       cy.getByTestId('conditions-row-btn').click();
 */

/*
 *       // delete the condition
 *       cy.contains('Delete').click();
 */

/*
 *       // submit ("Apply conditions") should be disabled
 *       cy.getByTestId('apply-conditions-btn').should('be.disabled').click({ force: true });
 */

/*
 *       // tooltip should warn the user
 *       cy.get('div[role="tooltip"]').contains('At least one condition is required');
 *     });
 *   });
 */

/*
 *   describe('Variants List Errors', function () {
 *     const checkCurrentError = ({ message, count }: { message: string; count: string }) => {
 *       cy.getByTestId('variants-list-current-error').contains(message);
 *       cy.getByTestId('variants-list-errors-count').contains(count);
 *     };
 */

/*
 *     it('should show the push variant errors', function () {
 *       const channel = 'push';
 *       const messageTitleMissing = 'Message title is missing!';
 *       const messageContentMissing = 'Message content is missing!';
 *       createWorkflow('Variants List Errors');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       cy.clickWorkflowNode(`node-${channel}Selector`, false);
 *       if (['inApp', 'email', 'sms', 'chat', 'push'].includes(channel)) {
 *         cy.getByTestId('edit-action').click();
 *       }
 *       fillEditorContent(channel);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       clearEditorContent(channel);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       checkCurrentError({ message: messageTitleMissing, count: '1/2' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageTitleMissing, hasBorder: true });
 */

/*
 *       cy.getByTestId('variants-list-errors-down').click();
 *       checkCurrentError({ message: messageContentMissing, count: '2/2' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageContentMissing, hasBorder: true });
 */

/*
 *       cy.getByTestId('variants-list-errors-up').click();
 *       checkCurrentError({ message: messageTitleMissing, count: '1/2' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageTitleMissing, hasBorder: true });
 *     });
 */

/*
 *     it('should show the push variant errors and root errors', function () {
 *       const channel = 'push';
 *       const messageTitleMissing = 'Message title is missing!';
 *       const messageContentMissing = 'Message content is missing!';
 *       createWorkflow('Variants List Errors');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       checkCurrentError({ message: messageTitleMissing, count: '1/4' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageTitleMissing, hasBorder: true });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageTitleMissing });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageContentMissing, count: '2/4' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageContentMissing, hasBorder: true });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageTitleMissing });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageTitleMissing, count: '3/4' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageTitleMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageTitleMissing, hasBorder: true });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageContentMissing, count: '4/4' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageTitleMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageContentMissing, hasBorder: true });
 *     });
 */

/*
 *     it('should show the email variant and root errors', function () {
 *       const channel = 'email';
 *       const messageSubjectMissing = 'Email subject is missing!';
 *       createWorkflow('Variants List Errors');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       fillEditorContent(channel, true);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       checkCurrentError({ message: messageSubjectMissing, count: '1/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-2', message: messageSubjectMissing, hasBorder: true });
 *       checkVariantListCard({ selector: 'variant-item-card-1', message: VARIANT_EDITOR_TEXT });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageSubjectMissing });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageSubjectMissing, count: '2/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-2', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-item-card-1', message: VARIANT_EDITOR_TEXT });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing, hasBorder: true });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageSubjectMissing });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageSubjectMissing, count: '3/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-2', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-item-card-1', message: VARIANT_EDITOR_TEXT });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageSubjectMissing, hasBorder: true });
 *     });
 */

//     it('should show the provider missing error', function () {
//       cy.intercept('*/integrations', {
//         data: [],
//         delay: 0,
//       }).as('getIntegrations');
//       cy.intercept('*/integrations/active', {
//         data: [],
//         delay: 0,
//       }).as('getActiveIntegrations');

/*
 *       const channel = 'email';
 *       const messageSubjectMissing = 'Email subject is missing!';
 *       const messageProviderMissing = 'Provider is missing!';
 *       createWorkflow('Variants List Errors');
 */

//       const dataTransfer = new DataTransfer();

/*
 *       cy.getByTestId(`dnd-${channel}Selector`).trigger('dragstart', { dataTransfer });
 *       cy.getByTestId('addNodeButton').parent().trigger('drop', { dataTransfer });
 *       showStepActions(channel);
 *       addVariantActionClick(channel);
 *       addConditions();
 *       cy.getByTestId('sidebar-close').click();
 *       cy.waitForNetworkIdle(500);
 */

/*
 *       checkCurrentError({ message: messageSubjectMissing, count: '1/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing, hasBorder: true });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageProviderMissing });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageProviderMissing, count: '2/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageProviderMissing, hasBorder: true });
 */

//       cy.getByTestId('variants-list-errors-down').click();

/*
 *       checkCurrentError({ message: messageSubjectMissing, count: '3/3' });
 *       checkVariantListCard({ selector: 'variant-item-card-0', message: messageSubjectMissing });
 *       checkVariantListCard({ selector: 'variant-root-card', message: messageSubjectMissing, hasBorder: true });
 *     });
 *   });
 * });
 */


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - createWorkflow(title: string))
 - fillInAppEditorContentWith(text: string))
 - fillEmailEditorContentWith(subjectLine: string, content: string))
 - fillSmsEditorContentWith(content: string))
 - fillChatEditorContentWith(content: string))
 - fillPushEditorContentWith(title: string, content: string))
 - showStepActions(channel: Channel))
 - addVariantActionClick(channel: Channel))
 - addConditions())
 - isVariant(false))
 - isVariant(false))
 - clearEditorContent(channel: Channel))
 - navigateAndPromoteAllChanges())
 - navigateAndOpenFirstWorkflow())
 - switchEnvironment(environment: 'Production' | 'Development'))
 - hasBorder(false,
 *   }: {
 *     message: string;
 *     selector: string;
 *     hasBorder?: boolean;
 *   }...)
 - checkCurrentError({ message, count }: { message: string; count: string }))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/workflows.spec.ts
Tamaño: 4294 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TriggerTypeEnum } from '@novu/shared';
import { expect } from '@playwright/test';
import { test } from './utils/baseTest';

import { WorkflowsPage } from './page-models/workflowsPage';
import { initializeSession } from './utils/browser';
import { createWorkflows, SessionData } from './utils/plugins';

let session: SessionData;

test.describe('Workflows tests without templates', () => {
  test.beforeEach(async ({ page }) => {
    ({ session } = await initializeSession(page, { noTemplates: true }));
  });
  test('when no workflows created it should show the page placeholder', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    await expect(workflowsPage.getNoWorkflowsPlaceholder()).toBeVisible();
    await expect(workflowsPage.getCreateWorkflowTile()).toBeVisible();
  });
  test('when clicking on create workflow it should redirect to create workflow page', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    await expect(workflowsPage.getNoWorkflowsPlaceholder()).toBeVisible();
    await expect(workflowsPage.getCreateWorkflowTile()).toBeVisible();
    await workflowsPage.getCreateWorkflowTile().click();
    await expect(page).toHaveURL(/\/workflows\/edit/);
  });
});
test.describe('Workflows tests with templates', () => {
  test.beforeEach(async ({ page }) => {
    ({ session } = await initializeSession(page));
  });

  test('should display workflows list', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    const workflowsTable = workflowsPage.getWorkflowsTable();
    const firstRow = workflowsTable.locator('tbody tr').first();
    const editLink = await workflowsPage.getRowEditLink(firstRow);
    const foundTemplate = session.templates.find((template) => editLink?.includes(template._id));

    expect(foundTemplate).toBeDefined();
    expect(editLink).toBe(`/workflows/edit/${foundTemplate?._id}`);

    await workflowsPage.assertRowStatusLabel(firstRow, foundTemplate?.active ?? false);
    await workflowsPage.assertRowCategoryLabel(firstRow, 'General');
  });

  test('should show the create workflow dropdown', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    await workflowsPage.getCreateWorkflowButton().click();
    await expect(workflowsPage.getCreateAllTemplatesWorkflowButton()).toContainText('All templates');
    await expect(workflowsPage.getCreateBlankWorkflowButton()).toContainText('Blank workflow');
  });

  test('should allow searching by name or identifier', async ({ page }) => {
    await createWorkflows({
      userId: session.user._id,
      organizationId: session.organization._id,
      environmentId: session.environment._id,
      workflows: [
        { name: 'SMS Workflow' },
        { triggers: [{ identifier: 'sms-test', variables: [], type: TriggerTypeEnum.EVENT }] },
      ],
    });

    const workflowsPage = await WorkflowsPage.goTo(page);
    const workflowsTable = workflowsPage.getWorkflowsTable();

    await workflowsPage.searchWorkflow('SMS');

    const firstRow = workflowsTable.locator('tbody tr').first();
    const secondRow = workflowsTable.locator('tbody tr').nth(1);

    // the order is not guaranteed
    if ((await workflowsPage.getWorkflowName(firstRow)) === 'SMS Workflow') {
      expect(await workflowsPage.getWorkflowTriggerIdentifier(secondRow)).toEqual('sms-test');
    } else {
      expect(await workflowsPage.getWorkflowName(secondRow)).toEqual('SMS Workflow');
      expect(await workflowsPage.getWorkflowTriggerIdentifier(firstRow)).toEqual('sms-test');
    }
  });

  test('should allow clearing the search', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    await workflowsPage.searchWorkflow('This template does not exist');
    await expect(workflowsPage.getNoWorkflowsMatchesPlaceholder()).toBeVisible();

    await workflowsPage.clearSearchInput();
    await expect(workflowsPage.getNoWorkflowsPlaceholder()).not.toBeVisible();
  });

  test('should show no results view', async ({ page }) => {
    const workflowsPage = await WorkflowsPage.goTo(page);
    await workflowsPage.searchWorkflow('This template does not exist');
    await expect(workflowsPage.getNoWorkflowsMatchesPlaceholder()).toBeVisible();
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowsPage(await WorkflowsPage.goTo(page);
    await expect(workflowsPage.getNoWorkflowsPlaceholder()).toBeVisi...)
 - workflowsPage(await WorkflowsPage.goTo(page);
    await expect(workflowsPage.getNoWorkflowsPlaceholder()).toBeVisi...)
 - foundTemplate(session.templates.find((template))
 - workflowsPage(await WorkflowsPage.goTo(page);
    await workflowsPage.getCreateWorkflowButton().click();
    await...)
 - workflowsPage(await WorkflowsPage.goTo(page);
    await workflowsPage.searchWorkflow('This template does not exist...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/fixtures/test-logo.png
Tamaño: 8713 bytes
Tipo: BINARIO o no legible como texto. Archivo no incluido.

################################################################################
Archivo: novu-next/apps/web/tests/fixtures/translation.json
Tamaño: 700 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "key": "value",
  "keyDeep": {
    "inner": "value"
  },
  "keyNesting": "reuse $t(keyDeep.inner)",
  "keyInterpolate": "replace this {{value}}",
  "keyInterpolateUnescaped": "replace this {{- value}}",
  "keyContext_male": "the male variant",
  "keyContext_female": "the female variant",
  "keyPluralSimple": "the singular",
  "keyPluralSimple_plural": "the plural",
  "keyPluralMultipleEgArabic_0": "the plural form 0",
  "keyPluralMultipleEgArabic_1": "the plural form 1",
  "keyPluralMultipleEgArabic_2": "the plural form 2",
  "keyPluralMultipleEgArabic_3": "the plural form 3",
  "keyPluralMultipleEgArabic_11": "the plural form 4",
  "keyPluralMultipleEgArabic_100": "the plural form 5"
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"key": "value",
"keyDeep": {
"inner": "value"
},
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/web/tests/page-models/activitiesPage.ts
Tamaño: 2655 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';

export enum FILTER_TERM {
  EMAIL = 'Email',
  IN_APP = 'In-App',
  SMS = 'SMS',
  PUSH = 'Push',
}

export class ActivitiesPage {
  constructor(private page: Page) {}

  public static async goTo(page: Page) {
    const pageDataLoadedPromise = this.getPageDataLoadedPromise(page);
    await page.goto('/activities');
    await pageDataLoadedPromise;

    return new ActivitiesPage(page);
  }

  private static getPageDataLoadedPromise(page: Page) {
    const notificationsPromise = page.waitForResponse('**/notifications?page=0');
    const notificationsGraphStatsPromise = page.waitForResponse('**/notifications/graph/stats');
    const notificationsStatsPromise = page.waitForResponse('**/notifications/stats');

    return Promise.all([notificationsPromise, notificationsGraphStatsPromise, notificationsStatsPromise]);
  }

  async assertHasNoFilterValues() {
    await expect(this.page.getByTestId('subscriberId-filter')).toBeEmpty();
    await expect(this.page.getByTestId('transactionId-filter')).toBeEmpty();
    await expect(this.page.getByTestId('templates-filter').locator('.mantine-Text-root')).toHaveCount(0);
    await expect(this.page.getByTestId('activities-filter').locator('.mantine-Text-root')).toHaveCount(0);
  }

  async filterBySubscriber(filterTerm: string) {
    await this.page.getByTestId('subscriberId-filter').fill(filterTerm);
  }

  async filterByTransaction(filterTerm: string) {
    await this.page.getByTestId('transactionId-filter').fill(filterTerm);
  }

  async filterByFirstWorkflow() {
    await this.page.getByTestId('templates-filter').click();
    await this.page.locator('.mantine-MultiSelect-item').first().click();
  }

  clearFiltersButton() {
    return this.page.getByTestId('clear-filters');
  }

  async assertHasClearFiltersButtonEnabled() {
    await expect(this.clearFiltersButton()).toBeEnabled();
  }

  async submitFilters() {
    await this.page.getByTestId('submit-filters').click();
  }

  async filterChannelSearchBy(filterTerm: FILTER_TERM) {
    await this.page.getByTestId('activities-filter').click();
    await this.page.locator('.mantine-MultiSelect-item').getByText(filterTerm).click();
  }

  async assertContainsExpectedUIElements() {
    await expect(this.page.getByTestId('in_app-step').first()).toBeVisible();
    await expect(this.page.getByTestId('email-step').first()).toBeVisible();
    await expect(this.page.getByTestId('subscriber-id').first()).toBeVisible();
  }

  getActivityRowElements() {
    return this.page.getByTestId('row-template-name');
  }

  getEmailStep() {
    return this.page.getByTestId('email-step');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class ActivitiesPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/apiKeysPage.ts
Tamaño: 1183 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, expect } from '@playwright/test';

export class ApiKeysPage {
  constructor(private page: Page) {}

  static async goTo(page: Page): Promise<ApiKeysPage> {
    const responsePromise = page.waitForResponse('**/environments/api-keys');
    await page.goto(`/api-keys`);
    await responsePromise;

    return new ApiKeysPage(page);
  }

  async getApiKeyContainer() {
    return this.page.getByTestId('api-key');
  }

  getApiKeyVisibilityButton() {
    return this.page.locator('#api-key-toggle-visibility-btn');
  }

  getCopyButton(container: string) {
    return this.page.getByTestId(`${container}-copy`);
  }

  getAppIdentifier() {
    return this.page.getByTestId('application-identifier');
  }

  getEnvironmentID() {
    return this.page.getByTestId('environment-id');
  }

  async regenerateApiKey() {
    await this.page.locator('#api-key-regenerate-btn').click();
  }

  async assertCautionModal() {
    await expect(this.page.getByTestId('regenerate-api-key-modal')).toBeVisible();
    await this.page.getByTestId('regenerate-api-key-modal-button').click();
    await this.page.getByTestId('regenerate-api-key-modal').waitFor({ state: 'detached' });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ApiKeysPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/authLoginPage.ts
Tamaño: 1882 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, selectors } from '@playwright/test';
import { setBrowserDateTimeTo } from '../utils/browser';

export class LoginData {
  email: string;
  password: string;
}

export class AuthLoginPage {
  public async passAuthTokenExpirationTime() {
    // setting current time in future, to simulate expired token
    const ONE_MINUTE = 1000 * 60; // adding 1 minute to be sure that token is expired
    const THIRTY_DAYS = ONE_MINUTE * 60 * 24 * 30; // iat - exp = 30 days
    const fakeNow = new Date(Date.now() + THIRTY_DAYS + ONE_MINUTE);

    await setBrowserDateTimeTo(this.page, fakeNow);
  }
  constructor(private page: Page) {
    selectors.setTestIdAttribute('data-test-id');
  }

  public async assertNavigationPath(path: string) {
    await this.page.waitForURL(path);
  }

  static async goTo(
    page: Page,
    { token, redirectURL }: { token?: string; redirectURL?: string } = {}
  ): Promise<AuthLoginPage> {
    const searchParams = new URLSearchParams();

    if (redirectURL) {
      searchParams.append('redirect_url', redirectURL);
    }

    if (token) {
      searchParams.append('token', token);
    }

    await page.goto(`/auth/login?${searchParams.toString()}`);

    return new AuthLoginPage(page);
  }

  public async submitLoginToken(token: string) {
    await this.page.goto(`auth/login?token=${token}`);
  }

  public getEmailLocator() {
    return this.page.getByTestId('email');
  }

  public async setEmailTo(value: string) {
    await this.page.getByTestId('email').fill(value);
  }

  public async setPasswordTo(value: string) {
    await this.page.getByTestId('password').fill(value);
  }

  public async clickSignInButton() {
    await this.page.getByTestId('submit-btn').click();
  }

  public async fillLoginForm(loginData: LoginData) {
    await this.setEmailTo(loginData.email);
    await this.setPasswordTo(loginData.password);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LoginData
- export class AuthLoginPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/basePage.ts
Tamaño: 239 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { waitForNetworkIdle } from '../utils/browser';

export class BasePage {
  constructor(protected page: Page) {}

  async waitForNetworkIdle() {
    await waitForNetworkIdle(this.page);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BasePage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/billingPage.ts
Tamaño: 3884 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { SettingsMenuPage } from './settingsMenuPage';

export class BillingPage {
  public settingsMenu: SettingsMenuPage;
  constructor(private page: Page) {
    this.settingsMenu = new SettingsMenuPage(page);
  }

  static async goTo(page: Page): Promise<BillingPage> {
    await page.goto('/settings/billing');

    return new BillingPage(page);
  }

  public async getPlanTitle() {
    return await this.page.getByTestId('plan-title').textContent();
  }

  public async assertNoFreeTrial() {
    await this.page.waitForSelector('[data-test-id="free-trial-plan-widget"]', { state: 'detached' });
  }

  public waitForFreeTrialWidget() {
    return this.page.waitForSelector('[data-test-id="free-trial-plan-widget"]');
  }

  public getTrialLabel() {
    return this.page.locator('[data-test-id="free-trial-widget-text"]');
  }

  public getTrialProgressBar() {
    return this.page.locator('[data-test-id="free-trial-widget-progress"] .mantine-Progress-bar');
  }

  public getUpgradeTrialButton() {
    return this.page.locator('[data-test-id="free-trial-widget-button"]');
  }

  public async assertTrialLabelContains(expectedLabel: string) {
    const trialLabel = this.getTrialLabel();
    await expect(trialLabel).toContainText(expectedLabel);
  }

  public async assertTrialBarColor(expectedColor: string) {
    const color = await this.getTrialProgressBarColor();
    expect(color).toBe(expectedColor);
  }

  public async getTrialProgressBarColor() {
    return await this.page.$eval('[data-test-id="free-trial-widget-progress"] .mantine-Progress-bar', (element) =>
      getComputedStyle(element).getPropertyValue('background-color')
    );
  }

  public async assertFreeTrialBannerText(expectedBannerText: string) {
    await this.page.waitForSelector('[data-test-id="free-trial-banner"]');
    await this.page.waitForSelector('[data-test-id="free-trial-banner-upgrade"]');
    const upgradeText = await this.page.$eval(
      '[data-test-id="free-trial-banner-upgrade"]',
      (element) => element.textContent
    );
    expect(upgradeText).toBe(expectedBannerText);
  }

  public async assertContactSalesBannerText(contactSales: string) {
    await this.page.waitForSelector('[data-test-id="free-trial-banner-contact-sales"]');
    const contactSalesText = await this.page.$eval(
      '[data-test-id="free-trial-banner-contact-sales"]',
      (element) => element.textContent
    );
    expect(contactSalesText).toBe(contactSales);
  }

  public async assertUpgradeButtonTextContains(expected: string) {
    const upgradeTrialButton = await this.getUpgradeTrialButton().textContent();
    expect(upgradeTrialButton).toContain(expected);
  }

  async assertBillingPlansTitle(expectedText: string) {
    expect(await this.getPlanTitle()).toBe(expectedText);
  }

  public async waitForPlanBusinessCurrent() {
    await this.page.waitForSelector('[data-test-id="plan-business-current"]');
  }

  public async waitForPlanBusinessManage() {
    await this.page.waitForSelector('[data-test-id="plan-business-manage"]');
  }

  async assertPlansIsTitle() {
    await this.assertBillingPlansTitle('Plans');
  }
  public async waitForPlanFreeCurrent() {
    await this.page.waitForSelector('[data-test-id="plan-free-current"]');
  }

  public async waitForUpgradeButton() {
    await this.page.waitForSelector('[data-test-id="plan-business-upgrade"]');
  }

  async waitForFreeTrialBanner() {
    await this.page.waitForSelector('[data-test-id="free-trial-banner"]');
  }

  async assertNoFreeTrialBanner() {
    await this.page.waitForSelector('[data-test-id="free-trial-banner"]', { state: 'detached' });
  }

  async assertTrialWidgetText(expectedText: string) {
    const actualContent = await this.page.locator('[data-test-id="free-trial-plan-widget"]').textContent();
    expect(actualContent).toBe(expectedText);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - id("free-trial-widget-progress"] .mantine-Progress-bar', (element))
 - id("free-trial-banner-upgrade"]',
      (element))
 - id("free-trial-banner-contact-sales"]',
      (element))
Declaraciones 'export' encontradas:
- export class BillingPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/brandPage.ts
Tamaño: 2017 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import path from 'path';
import { setFileForFilePicker } from '../utils/commands';
import { SidebarPage } from './sidebarPage';

export class BrandPage {
  async assertImageSourceSetCorrectly(orgIdentifier: string) {
    expect(await this.page.getByTestId('logo-image-wrapper').getAttribute('src')).toContain('.png');
    expect(await this.page.getByTestId('logo-image-wrapper').getAttribute('src')).toContain(orgIdentifier);
  }
  public async choosesFontViaDropdown(fontFamily: string) {
    await this.page.getByTestId('font-family-selector').click();
    await this.clickElementByText(fontFamily);
  }
  constructor(private page: Page) {}
  public async clickElementByText(text: string) {
    await this.page.getByText(text).click();
  }
  static async goTo(page: Page): Promise<BrandPage> {
    const sidebarPage = await SidebarPage.goTo(page);
    const settingsMenuPage = await sidebarPage.clickSettings();

    return await settingsMenuPage.clickBrandLink();
  }

  public async submitBrandSettings() {
    await this.page.getByTestId('submit-branding-settings').click();
  }

  public async choosesColorViaButton(colorCode: string) {
    await this.page.getByTestId('color-picker').click();
    const buttonColorLabelSelector = `button[aria-label="${colorCode}"]`;
    await this.page.locator(buttonColorLabelSelector).click();
  }

  public async uploadLogoImage(imagePath: string) {
    await this.page.waitForTimeout(3000);
    const fileUploader = this.page.getByTestId('upload-image-button').locator('input[type="file"]');
    const logoPath = path.join(__dirname, imagePath);
    await setFileForFilePicker(fileUploader, logoPath);
    await this.page.waitForTimeout(3000);
    const failed = await this.page.getByText('Failed to upload branding').isVisible();
    expect(failed).toBe(false);
  }
  public async assertInputHasValue(identifier: string, value: string) {
    expect(await this.page.getByTestId(identifier).inputValue()).toBe(value);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BrandPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/changesPage.ts
Tamaño: 1374 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';

export class ChangesPage {
  constructor(private page: Page) {}

  static async goTo(page: Page): Promise<ChangesPage> {
    await page.goto('/changes');

    return new ChangesPage(page);
  }

  getChangesTable() {
    return this.page.getByTestId('pending-changes-table');
  }

  getHistoryChangesTable() {
    return this.page.getByTestId('history-changes-table');
  }

  getChangesTableRows() {
    return this.getChangesTable().locator('tbody tr');
  }

  getHistoryChangesTableRows() {
    return this.getHistoryChangesTable().locator('tbody tr');
  }

  switchToTab(tabName: string) {
    return this.page.getByRole('tab', { name: tabName }).click();
  }

  getPromoteButton(name?: string) {
    if (name) {
      return this.page.getByRole('row', { name }).getByTestId('promote-btn');
    }

    return this.page.getByTestId('promote-btn').first();
  }

  getPromoteAllButton() {
    return this.page.getByTestId('promote-all-btn');
  }

  getChangeType(name?: string) {
    if (name) {
      return this.page.getByRole('row', { name }).getByTestId('change-type');
    }

    return this.page.getByTestId('change-type');
  }

  getChangeContent(name?: string) {
    if (name) {
      return this.page.getByRole('row', { name }).getByTestId('change-content');
    }

    return this.page.getByTestId('change-content');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChangesPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/codeSnippetSidePanelPageModel.ts
Tamaño: 503 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';

export enum SNIPPET_TAB {
  CURL = 'Curl',
}

export class CodeSnippetSidePanelPageModel {
  constructor(private page: Page) {}

  getTriggerCodeSnippet() {
    return this.page.getByTestId('trigger-code-snippet');
  }

  async changeSnippetTabTo(tab: SNIPPET_TAB) {
    await this.page.locator('.mantine-Tabs-tabsList').getByText(tab).click();
  }

  async getCurlSnippet() {
    return await this.page.getByTestId('trigger-curl-snippet').textContent();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class CodeSnippetSidePanelPageModel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/conditionsPage.ts
Tamaño: 4142 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';

export class ConditionsPage {
  constructor(private page: Page) {}

  async addNewSubscriberCondition(key: string, operator: string, value: string) {
    await this.getAddNewConditionButton().click();
    await this.selectConditionOnDropdown('Subscriber');
    await this.getConditionsFormKeyInput().fill(key);
    await this.selectConditionOperatorDropdown(operator);
    await this.getConditionsFormValueInput().fill(value);
    await this.getApplyConditionsButton().click();
  }

  async addNewPreviousStepCondition(step: string, type: string) {
    await this.getAddNewConditionButton().click();
    await this.selectConditionOnDropdown('Previous step');
    await this.selectPreviousStepConditionDropdown(step);
    await this.selectPreviousStepTypeDropdown(type);
    await this.getApplyConditionsButton().click();
  }

  async addNewWebhookCondition(webhookUrl: string, key: string, operator: string, value: string) {
    await this.getAddNewConditionButton().click();
    await this.selectConditionOnDropdown('Webhook');
    await this.getWebhookUrlInput().fill(webhookUrl);
    await this.getConditionsFormKeyInput().fill(key);
    await this.selectConditionOperatorDropdown(operator);
    await this.getConditionsFormValueInput().fill(value);
    await this.getApplyConditionsButton().click();
  }

  async addOnlineNowCondition(isOnline: boolean) {
    await this.getAddNewConditionButton().click();
    await this.selectConditionOnDropdown('Is online');
    await this.page.getByTestId('online-now-value-dropdown').click();
    await this.page.getByRole('option', { name: isOnline ? 'Yes' : 'No', exact: true }).click();
    await this.getApplyConditionsButton().click();
  }

  async addLastTimeOnlineCondition(period: string, value: string) {
    await this.getAddNewConditionButton().click();
    await this.selectConditionOnDropdown('Last time was online');
    await this.page.getByTestId('online-in-last-operator-dropdown').click();
    await this.page.getByRole('option', { name: period, exact: true }).click();
    await this.page.getByTestId('online-in-last-value-input').fill(value);
    await this.getApplyConditionsButton().click();
  }

  getAddNewConditionButton() {
    return this.page.getByTestId('add-new-condition');
  }

  getConditionsRowButton() {
    return this.page.getByTestId('conditions-row-btn').last();
  }

  getConditionsRowDeleteButton() {
    return this.page.getByTestId('conditions-row-delete').last();
  }

  getConditionsFormOnDropdown() {
    return this.page.getByTestId('conditions-form-on').last();
  }

  async selectConditionOnDropdown(condition: string) {
    await this.getConditionsFormOnDropdown().click();

    return this.page.getByRole('option', { name: condition, exact: true }).click();
  }

  getConditionsFormOperatorDropdown() {
    return this.page.getByTestId('conditions-form-operator').last();
  }

  getPreviousStepTypeDropdown() {
    return this.page.getByTestId('previous-step-type-dropdown').last();
  }

  getPreviousStepConditionDropdown() {
    return this.page.getByTestId('previous-step-dropdown').last();
  }

  async selectConditionOperatorDropdown(operator: string) {
    await this.getConditionsFormOperatorDropdown().click();

    return this.page.getByRole('option', { name: operator, exact: true }).click();
  }

  async selectPreviousStepConditionDropdown(step: string) {
    await this.getPreviousStepConditionDropdown().click();

    return this.page.getByRole('option', { name: step, exact: true }).click();
  }

  async selectPreviousStepTypeDropdown(type: string) {
    await this.getPreviousStepTypeDropdown().click();

    return this.page.getByRole('option', { name: type, exact: true }).click();
  }

  getConditionsFormKeyInput() {
    return this.page.getByTestId('conditions-form-key').last();
  }

  getWebhookUrlInput() {
    return this.page.getByTestId('webhook-filter-url-input').last();
  }

  getConditionsFormValueInput() {
    return this.page.getByTestId('conditions-form-value').last();
  }

  getApplyConditionsButton() {
    return this.page.getByTestId('apply-conditions-btn');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ConditionsPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/editorState.ts
Tamaño: 85 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum EditorState {
  EDIT = 'Edit',
  PREVIEW = 'Preview',
  TEST = 'Test',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/getStartedPage.ts
Tamaño: 5210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, expect } from '@playwright/test';

export enum Tab {
  IN_APP = 'In-app',
  MULTI_CHANNEL = 'Multi-channel',
  DIGEST = 'Digest',
  DELAY = 'Delay',
  TRANSLATE = 'Translate',
}

interface ITabLinkInfo {
  label: string;
  type: 'button' | 'link';
  urlRegex: RegExp;
}

interface ITabTest {
  name: Tab;
  title: string;
  steps: number;
  links: ITabLinkInfo[];
}

const TabConfigs: Record<Tab, ITabTest> = {
  [Tab.IN_APP]: {
    name: Tab.IN_APP,
    title: 'In-app notifications',
    steps: 4,
    links: [
      { label: 'Create In-app provider', type: 'link', urlRegex: /\/integrations\/[A-Z0-9]+/i },
      { label: 'Customize', type: 'button', urlRegex: /\/workflows\/edit\/\w+/ },
      { label: 'Test the trigger', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/test-workflow/ },
      { label: 'activity feed', type: 'link', urlRegex: /\/activities/ },
    ],
  },
  [Tab.MULTI_CHANNEL]: {
    name: Tab.MULTI_CHANNEL,
    title: 'Multi-channel notifications',
    steps: 4,
    links: [
      { label: 'Integration store', type: 'link', urlRegex: /\/integrations\/create/ },
      { label: 'Customize', type: 'button', urlRegex: /\/workflows\/edit\/\w+/ },
      { label: 'Test the trigger', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/test-workflow/ },
      { label: 'activity feed', type: 'link', urlRegex: /\/activities/ },
    ],
  },
  [Tab.DIGEST]: {
    name: Tab.DIGEST,
    title: 'Digest multiple events',
    steps: 5,
    links: [
      { label: 'Integration store', type: 'link', urlRegex: /\/integrations\/create/ },
      { label: 'Customize', type: 'button', urlRegex: /\/workflows\/edit\/\w+/ },
      { label: 'Customize digest node', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/digest\/\w+/ },
      { label: 'Test the trigger', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/test-workflow/ },
      { label: 'activity feed', type: 'link', urlRegex: /\/activities/ },
    ],
  },
  [Tab.DELAY]: {
    name: Tab.DELAY,
    title: 'Delay step execution',
    steps: 5,
    links: [
      { label: 'Integration store', type: 'link', urlRegex: /\/integrations\/create/ },
      { label: 'Customize', type: 'button', urlRegex: /\/workflows\/edit\/\w+/ },
      { label: 'Customize delay', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/delay\/\w+/ },
      { label: 'Test the trigger', type: 'button', urlRegex: /\/workflows\/edit\/\w+\/test-workflow/ },
      { label: 'activity feed', type: 'link', urlRegex: /\/activities/ },
    ],
  },
  [Tab.TRANSLATE]: {
    name: Tab.TRANSLATE,
    title: 'Translate content',
    steps: 4,
    links: [
      { label: 'Integration store', type: 'link', urlRegex: /\/integrations\/create/ },
      { label: 'Translations page', type: 'link', urlRegex: /\/translations/ },
    ],
  },
};

export class GetStartedPage {
  constructor(private page: Page) {}

  static async goTo(page: Page, queryParams: string = ''): Promise<GetStartedPage> {
    await page.goto(`/get-started${queryParams}`);

    return new GetStartedPage(page);
  }

  async clickTab(tab: Tab) {
    await this.page.getByRole('tab', { name: tab }).click();
  }

  async assertGetStartedPageIsVisible() {
    await expect(this.page.getByRole('heading', { name: 'Get started' })).toBeVisible();
    await expect(this.page).toHaveURL(/\/get-started/);
  }

  async assertTabsAreVisible(tabs: Tab[]) {
    for (const tab of tabs) {
      await expect(this.page.getByRole('tab', { name: tab })).toBeVisible();
    }
  }

  async assertTabSelected(tab: Tab) {
    await expect(this.page.getByRole('tab', { name: tab, selected: true })).toBeVisible();
  }

  async ensureLinkWithAttributes(
    label: string,
    type: 'link' | 'button',
    urlRegex: RegExp,
    exact: boolean = true
  ): Promise<void> {
    const link = this.page.getByRole(type, { name: label, exact });
    await expect(link).toBeVisible();

    if (type === 'link') {
      await expect(link).toHaveAttribute('target', '_blank');
      await expect(link).toHaveAttribute('rel', expect.stringMatching(/^(noopener noreferrer|noreferrer noopener)$/));
      await expect(link).toHaveAttribute('href', urlRegex);
    } else if (type === 'button') {
      const [newPage] = await Promise.all([this.page.waitForEvent('popup'), link.click()]);
      await newPage.waitForLoadState();
      expect(newPage.url()).toMatch(urlRegex);
      await newPage.close();
    }
  }

  async assertTabTitle(tabTitle: string) {
    await expect(this.page.getByRole('heading', { name: tabTitle })).toBeVisible();
  }

  async verifyTabContent(tab: Tab) {
    const tabConfig = TabConfigs[tab];

    await this.clickTab(tabConfig.name);
    await this.assertTabSelected(tabConfig.name);
    await this.assertTabTitle(tabConfig.title);

    await this.ensureLinkWithAttributes('Learn about ', 'link', /docs.novu.co/, false);
    await expect(this.page.locator('canvas')).toBeVisible();

    for (let index = 1; index <= tabConfig.steps; index += 1) {
      expect(this.page.getByText(`${index}`, { exact: true })).toBeVisible();
    }

    for (const linkInfo of tabConfig.links) {
      await this.ensureLinkWithAttributes(linkInfo.label, linkInfo.type, linkInfo.urlRegex);
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class GetStartedPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/headerPage.ts
Tamaño: 886 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { waitForNetworkIdle } from '../utils/browser';

export class HeaderPage {
  private page: Page;

  constructor(page: Page) {
    this.page = page;
  }

  static async goTo(page: Page): Promise<HeaderPage> {
    await page.goto('./');

    return new HeaderPage(page);
  }

  getAvatarImageSrc() {
    const locator = this.page.locator('[data-test-id="header-profile-avatar"] >> img');

    return locator.first().getAttribute('src');
  }

  getUserName() {
    return this.page.getByTestId('header-dropdown-username').textContent();
  }

  getOrganizationName() {
    return this.page.getByTestId('header-dropdown-organization-name').textContent();
  }

  async clickAvatar() {
    await this.page.getByTestId('header-profile-avatar').click();
  }

  async clickLogout() {
    await this.page.getByTestId('logout-button').click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HeaderPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/layoutsPage.ts
Tamaño: 894 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, expect } from '@playwright/test';

export class LayoutsPage {
  constructor(private page: Page) {}

  static async goTo(page: Page): Promise<LayoutsPage> {
    await page.goto('/layouts');

    return new LayoutsPage(page);
  }

  async assertIsVisible() {
    await expect(this.page.getByRole('heading', { name: 'Layouts' })).toBeVisible();
    await expect(this.page).toHaveURL(/\/layout/);
  }

  getLayoutsTable() {
    return this.page.getByTestId('layouts-table');
  }

  async assertLayoutsTableHeaders(headerTitles: string[]) {
    const headers = this.getLayoutsTable().locator('th');
    await headers.allTextContents().then((texts) => expect(texts).toEqual(headerTitles));
  }

  async assertLayoutsTableRowCount(count: number) {
    const rows = this.getLayoutsTable().locator('tr');
    await rows.count().then((rowCount) => expect(rowCount - 1).toBe(count));
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - headers(this.getLayoutsTable().locator('th');
    await headers.allTextContents().then((texts))
 - rows(this.getLayoutsTable().locator('tr');
    await rows.count().then((rowCount))
Declaraciones 'export' encontradas:
- export class LayoutsPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeChatEditingModalPageModel.ts
Tamaño: 875 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';
import { fillTextInAMonacoEditor } from '../utils/browser';
import { VariantPreviewModalPage } from './variantPreviewModalPage';

export class NodeChatEditingModalPageModel extends WorkflowBaseSidePanelPage {
  async updateChatData(chatBodyVariant: string) {
    await this.fillChatBody(chatBodyVariant);
    await this.nodeSettingsUpdateButton().click();
    await this.closeSidePanel();

    return new VariantPreviewModalPage(this.page);
  }
  async assertBodyContains(chatBody: string) {
    await expect(this.getMonacoEditor()).toContainText(chatBody);
  }

  async fillChatBody(chatBody: string) {
    await fillTextInAMonacoEditor(this.page, '.monaco-editor', chatBody);
  }

  getMonacoEditor() {
    return this.page.locator('.monaco-editor');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodeChatEditingModalPageModel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeDelayEditorPageModal.ts
Tamaño: 553 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ConditionsPage } from './conditionsPage';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export class NodeDelayEditorPageModal extends WorkflowBaseSidePanelPage {
  getEditorSidebarEditConditionsButton() {
    return this.page.getByTestId('editor-sidebar-edit-conditions');
  }

  getDelayModeSwitch() {
    return this.page.getByTestId('delay-type');
  }

  async openAddConditionsSidebar() {
    await this.page.getByTestId('editor-sidebar-add-conditions').click();

    return new ConditionsPage(this.page);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodeDelayEditorPageModal

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeDigestEditorPageModal.ts
Tamaño: 1994 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Locator } from '@playwright/test';
import { ConditionsPage } from './conditionsPage';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export enum TimeUnit {
  SECONDS = 'sec (s)',
  MINUTES = 'min (s)',
  HOURS = 'hour (s)',
  DAYS = 'day (s)',
}
export class NodeDigestEditorPageModal extends WorkflowBaseSidePanelPage {
  timeAmount(): Locator {
    return this.page.getByTestId('time-amount');
  }

  timeUnit(): Locator {
    return this.page.getByTestId('time-unit');
  }

  getDropdownLocator(optionValue: string): Locator {
    return this.page.locator('.mantine-Select-item').getByText(optionValue);
  }
  mantineSelectItem(): Locator {
    return this.page.locator('.mantine-Select-item');
  }
  digestGroupByOptions(): Locator {
    return this.page.getByTestId('digest-group-by-options');
  }

  digestSendOptionsAccordionSwitch(): Locator {
    return this.page.getByTestId('digest-send-options');
  }

  async openAddConditionsSidebar() {
    await this.page.getByTestId('editor-sidebar-add-conditions').click();

    return new ConditionsPage(this.page);
  }

  getEditorSidebarEditConditionsButton() {
    return this.page.getByTestId('editor-sidebar-edit-conditions');
  }

  batchKey(): Locator {
    return this.page.getByTestId('batch-key');
  }

  onlyFrequentEventsSwitch(): Locator {
    return this.page.getByTestId('backoff-switch').locator('..');
  }

  backoffAmount(): Locator {
    return this.page.getByTestId('backoff-amount');
  }

  timeUnitBackoff(): Locator {
    return this.page.getByTestId('time-unit-backoff');
  }

  async chooseTimeUnitFromDropdown(digest: NodeDigestEditorPageModal, optionValue: TimeUnit) {
    await digest.timeUnit().click();
    await digest.getDropdownLocator(optionValue).click();
  }

  async chooseTimeUnitBackOffFromDropDown(digest: NodeDigestEditorPageModal, optionValue: TimeUnit) {
    await digest.timeUnitBackoff().click();
    await digest.getDropdownLocator(optionValue).click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class NodeDigestEditorPageModal

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeEmailEditorPageModal.ts
Tamaño: 4712 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { fillTextInAMonacoEditor } from '../utils/browser';
import { ConditionsPage } from './conditionsPage';
import { VariantPreviewModalPage } from './variantPreviewModalPage';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export class NodeEmailEditorPageModal extends WorkflowBaseSidePanelPage {
  async assertEmailContentFirstParagraphContains(emailParagraph: string) {
    expect(await (await this.getEditableTextContentByIndex(0)).innerText()).toContain(emailParagraph);
  }
  async assertEmailSubjectContains(emailSubject: string) {
    expect(await this.getEmailSubjectInput().inputValue()).toContain(emailSubject);
  }
  async updateEmailData(emailSubjectVariant: string, emailParagraphVariant: string) {
    await this.fillEmailSubject(emailSubjectVariant);
    await this.editEmailBodyTextParagraph(emailParagraphVariant);
    await this.nodeSettingsUpdateButton().click();
    await this.closeSidePanel();

    return new VariantPreviewModalPage(this.page);
  }

  async clickSettingsRowButton(instance = 0) {
    const locators = await this.getAllRowSettingsLocators();
    await locators[instance].dispatchEvent('click');
  }

  getMonacoEditor() {
    return this.page.locator('.monaco-editor');
  }

  async fillEmailCustomCodeBody(emailBody: string) {
    await fillTextInAMonacoEditor(this.page, '.monaco-editor', emailBody);
  }

  public async getAllRowSettingsLocators() {
    return await this.page.getByTestId('settings-row-btn').all();
  }

  async clickRemoveRowButton() {
    await this.page.getByTestId('remove-row-btn').click();
  }

  getAddConditionsAction() {
    return this.page.getByTestId('add-conditions-action');
  }

  async openAddConditionsSidebar() {
    await this.page.getByTestId('add-conditions-action').click();

    return new ConditionsPage(this.page);
  }

  async fillEmailSubject(EMAIL_SUBJECT: string) {
    await this.getEmailSubjectInput().fill(EMAIL_SUBJECT);
  }

  getCustomCodeEditorType() {
    return this.page.getByTestId('editor-type-selector').getByRole('tab', { name: 'Custom Code' });
  }

  emailSubject() {
    return this.page.getByTestId('emailSubject');
  }

  emailPreheader() {
    return this.page.getByTestId('emailPreheader');
  }

  editableTextContent() {
    return this.page.getByTestId('editable-text-content');
  }

  public getEmailSubjectInput() {
    return this.page.getByTestId('emailSubject');
  }

  async fillEmailPreheader(EMAIL_PREHEADER: string) {
    await this.page.getByTestId('emailPreheader').fill(EMAIL_PREHEADER);
  }

  getSystemVariablesButton() {
    return this.page.getByTestId('var-label').getByText('System Variables');
  }

  getTranslationVariablesButton() {
    return this.page.getByTestId('var-label').getByText('Translation Variables');
  }

  getItemFirstName() {
    return this.page.getByRole('button', { name: 'firstNamestring' });
  }

  getItemCustomVariable() {
    return this.page.getByTestId('var-item-customVariable-string');
  }

  getVarItemStep() {
    return this.page.getByTestId('var-items-step');
  }

  getVarItemsBranding() {
    return this.page.getByTestId('var-items-branding');
  }

  getVarItemsSubscriber() {
    return this.page.getByTestId('var-items-subscriber');
  }

  async clickEmailEditor() {
    await this.page.getByTestId('email-editor').click();

    return new NodeEmailEditorPageModal(this.page);
  }

  async clickAddElementToEmailPlusSign() {
    await this.page.getByTestId('control-add').click();
  }

  async clickAddBtnBlock() {
    await this.page.getByTestId('add-btn-block').click();
  }

  getButtonBlockWrapperLocator() {
    return this.page.getByTestId('button-block-wrapper').locator('button');
  }

  async editButtonText(EXAMPLE_TEXT: string) {
    await this.page.getByTestId('button-text-input').fill(EXAMPLE_TEXT);
  }

  async editEmailBodyTextParagraph(TEST_TEXT: string, instance = 0) {
    const locator = await this.getEditableTextContentByIndex(instance);
    await locator.fill(TEST_TEXT);
    await locator.focus();
    await this.page.keyboard.press('Enter');
  }

  public async getEditableTextContentByIndex(instance: number) {
    const locators = await this.page.getByTestId('editable-text-content').all();

    return locators[instance];
  }

  async clickAddTextBlock() {
    await this.page.getByTestId('add-text-block').click();
  }

  getEditorRow() {
    return this.page.getByTestId('editor-row');
  }

  getUploadImageButton() {
    return this.page.getByTestId('upload-image-button');
  }

  getBrandLogo() {
    return this.page.getByTestId('brand-logo');
  }

  getAlignRightButton() {
    return this.page.getByTestId('align-right-btn');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodeEmailEditorPageModal

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeInAppEditingModalPageModel.ts
Tamaño: 3124 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { fillTextInAMonacoEditor } from '../utils/browser';
import { addConditions } from '../utils/commands';
import { ConditionsPage } from './conditionsPage';
import { EditorState } from './editorState';
import { VariantPreviewModalPage } from './variantPreviewModalPage';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export class NodeInAppEditingModalPageModel extends WorkflowBaseSidePanelPage {
  async addMoreConditionViaSidebar() {
    await this.getEditConditionsButton().click();
    await addConditions(this.page);
  }
  async addConditionViaSidebar() {
    await this.getAddConditionsSidebarButton().click();
    await addConditions(this.page);
  }
  async updateInAppData(inAppBodyVariant: string) {
    await this.fillNotificationBody(inAppBodyVariant);
    await this.nodeSettingsUpdateButton().click();
    await this.closeSidePanel();

    return new VariantPreviewModalPage(this.page);
  }

  async fillNotificationBody(notificationBody: string) {
    await fillTextInAMonacoEditor(this.page, '.monaco-editor', notificationBody);
  }

  async fillInAppRedirect(redirect: string) {
    await this.page.getByTestId('inAppRedirect').fill(redirect);
  }

  getAddConditionsAction() {
    return this.page.getByTestId('add-conditions-action');
  }

  getEnableAddAvatarToggle() {
    return this.page.getByTestId('enable-add-avatar');
  }

  getChooseAvatarButton() {
    return this.page.getByTestId('choose-avatar-btn');
  }

  getAvatarIconInfo() {
    return this.page.getByTestId('avatar-icon-info');
  }

  getFeedButton(nth: number) {
    return this.page.getByTestId(`feed-button-${nth}`);
  }

  getFeedButtonChecked(nth: number) {
    return this.page.getByTestId(`feed-button-${nth}-checked`);
  }

  createAndFillFeedInput(text: string) {
    return this.page.getByTestId('create-feed-input').fill(text);
  }

  getAddFeedButton() {
    return this.page.getByTestId('add-feed-button');
  }

  getUseFeedsCheckbox() {
    return this.page.getByTestId('use-feeds-checkbox');
  }

  getControlAddButton() {
    return this.page.getByTestId('control-add');
  }

  getTemplateContainerClickArea() {
    return this.page.getByTestId('template-container-click-area');
  }

  getTemplateContainer() {
    return this.page.getByTestId('template-container');
  }

  getRemoveButtonIcon() {
    return this.page.getByTestId('remove-button-icon');
  }

  async openAddConditionsSidebar() {
    await this.page.getByTestId('add-conditions-action').click();

    return new ConditionsPage(this.page);
  }

  async assertPreviewText(assertedText: string) {
    await this.switchEditorMode(EditorState.PREVIEW);
    const previewText = await this.page.getByTestId('in-app-content-preview').textContent();
    expect(previewText).toContain(assertedText);
    await this.switchEditorMode(EditorState.EDIT);
  }

  async pressUpdate() {
    await this.page.getByTestId('notification-template-submit-btn').click();
  }

  public async goBack() {
    const closeButton = this.page.getByTestId('sidebar-close');
    await closeButton.click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodeInAppEditingModalPageModel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodePushEditorPageModal.ts
Tamaño: 1483 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { fillTextInAMonacoEditorLocator } from '../utils/browser';
import { VariantPreviewModalPage } from './variantPreviewModalPage';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export class NodePushEditorPageModal extends WorkflowBaseSidePanelPage {
  async updatePushData(pushSubjectVariant: string, pushBodyVariant: string) {
    await this.fillPushTitle(pushSubjectVariant);
    await this.fillPushContent(pushBodyVariant);
    await this.nodeSettingsUpdateButton().click();
    await this.closeSidePanel();

    return new VariantPreviewModalPage(this.page);
  }
  async assertPushBodyContains(pushBody: string) {
    await expect(this.getPushContentEditorLocator()).toContainText(pushBody);
  }
  async assertPushSubjectContains(pushSubject: string) {
    await expect(this.getPushTitleEditorLocator()).toContainText(pushSubject);
  }
  public getPushTitleEditorLocator() {
    return this.page.getByTestId('push-title-container').locator('.monaco-editor').nth(0);
  }

  public getPushContentEditorLocator() {
    return this.page.getByTestId('push-content-container').locator('.monaco-editor').nth(0);
  }

  public async fillPushTitle(titleText: string) {
    await fillTextInAMonacoEditorLocator(this.getPushTitleEditorLocator(), titleText);
  }

  public async fillPushContent(contentText: string) {
    await fillTextInAMonacoEditorLocator(this.getPushContentEditorLocator(), contentText);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodePushEditorPageModal

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/nodeSmsEditingModalPageModel.ts
Tamaño: 957 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';
import { fillTextInAMonacoEditor } from '../utils/browser';
import { VariantPreviewModalPage } from './variantPreviewModalPage';

export class NodeSmsEditingModalPageModel extends WorkflowBaseSidePanelPage {
  async updateSmsData(smsBody: string) {
    await this.fillSmsBody(smsBody);
    await this.nodeSettingsUpdateButton().click();
    await this.closeSidePanel();

    return new VariantPreviewModalPage(this.page);
  }
  async assertBodyContains(smsBody: string) {
    await expect(this.getMonacoEditor()).toContainText(smsBody);
  }

  async fillSmsBody(smsBody: string) {
    await fillTextInAMonacoEditor(this.page, '.monaco-editor', smsBody);
  }

  getMonacoEditor() {
    return this.page.locator('.monaco-editor');
  }

  getOpenVariableManagementLocator() {
    return this.page.getByTestId('open-variable-management');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodeSmsEditingModalPageModel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/passwordResetPage.ts
Tamaño: 536 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, selectors } from '@playwright/test';

export class PasswordResetPage {
  constructor(private page: Page) {
    selectors.setTestIdAttribute('data-test-id');
  }

  static async goTo(page: Page): Promise<PasswordResetPage> {
    await page.goto('/auth/reset/request');

    return new PasswordResetPage(page);
  }

  public async setEmailTo(value: string) {
    await this.page.getByTestId('email').fill(value);
  }

  public async clickResetPasswordButton() {
    await this.page.getByTestId('submit-btn').click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PasswordResetPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/settingsMenuPage.ts
Tamaño: 647 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { BrandPage } from './brandPage';

export class SettingsMenuPage {
  constructor(private page: Page) {}

  public async assertNoFreeTrial() {
    await this.page.waitForSelector('[data-test-id="free-trial-widget-text"]', { state: 'detached' });
  }
  private getWidgetFreeTrialTextLocator() {
    return this.page.locator('[data-test-id="free-trial-widget-text"]');
  }
  async clickBrandLink() {
    await this.getBrandingLinkLocator().click();

    return new BrandPage(this.page);
  }
  public getBrandingLinkLocator() {
    return this.page.getByTestId('side-nav-settings-branding-link');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SettingsMenuPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/sidebarPage.ts
Tamaño: 3536 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { getAttByTestId } from '../utils/browser';
import { SettingsMenuPage } from './settingsMenuPage';

export enum Environment {
  Development = 'Development',
  Production = 'Production',
}

export class SidebarPage {
  constructor(private page: Page) {}

  public getTemplatesLink() {
    return this.page.getByTestId('side-nav-templates-link');
  }

  public getOrganizationSwitch() {
    return this.page.getByTestId('organization-switch');
  }

  public getEnvironmentSwitch() {
    return this.page.getByTestId('environment-switch');
  }

  public async toggleToProduction() {
    await this.getEnvironmentSwitch().click();
    await this.page.getByRole('option', { name: Environment.Production }).click();
  }

  public async toggleToDevelopment() {
    await this.getEnvironmentSwitch().click();
    await this.page.getByRole('option', { name: Environment.Development }).click();
  }

  public async getSupportLink() {
    return await getAttByTestId(this.page, 'side-nav-bottom-link-support', 'href');
  }

  public async getDocumentationLink() {
    return await getAttByTestId(this.page, 'side-nav-bottom-link-documentation', 'href');
  }

  public async getShareFeedbackLink() {
    return await getAttByTestId(this.page, 'side-nav-bottom-link-share-feedback', 'href');
  }

  public getSettingsLink() {
    return this.page.getByTestId('side-nav-settings-link');
  }

  public async getSettingsLinkHref() {
    return await getAttByTestId(this.page, 'side-nav-settings-link', 'href');
  }

  public getQuickStartLingLocator() {
    return this.page.getByTestId('side-nav-quickstart-link');
  }

  public getIntegrationLinkLocator() {
    return this.page.getByTestId('side-nav-integrations-link');
  }

  public getSettingsLinkLocator() {
    return this.page.getByTestId('side-nav-settings-link');
  }

  public getTemplatesLinkLocator() {
    return this.page.getByTestId('side-nav-templates-link');
  }

  public getActivitiesLinkLocator() {
    return this.page.getByTestId('side-nav-activities-link');
  }

  public getChangesLinkLocator() {
    return this.page.getByTestId('side-nav-changes-link');
  }

  public getChangesCount() {
    return this.page.getByTestId('side-nav-changes-count');
  }

  public getSubscribersLinkLocator() {
    return this.page.getByTestId('side-nav-subscribers-link');
  }

  public getTenantsLinkLocator() {
    return this.page.getByTestId('side-nav-tenants-link');
  }

  public getTranslationsLinkLocator() {
    return this.page.getByTestId('side-nav-translations-link');
  }

  static async goTo(page: Page) {
    return new SidebarPage(page);
  }
  public getUserProfileLocator() {
    return this.page.getByTestId('side-nav-settings-user-profile');
  }

  public getOrganizationLinkLocator() {
    return this.page.getByTestId('side-nav-settings-organization-link');
  }

  public getSecurityLinkLocator() {
    return this.page.getByTestId('side-nav-settings-security-link');
  }

  public getTeamLinkLocator() {
    return this.page.getByTestId('side-nav-settings-team-link');
  }

  public getBillingLinkLocator() {
    return this.page.getByTestId('side-nav-settings-billing-link');
  }

  public getApiKeysLocator() {
    return this.page.getByTestId('side-nav-settings-api-keys');
  }

  public getInboundWebhookLocator() {
    return this.page.getByTestId('side-nav-settings-inbound-webhook');
  }

  async clickSettings() {
    await this.getSettingsLinkLocator().click();

    return new SettingsMenuPage(this.page);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class SidebarPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/signupPage.ts
Tamaño: 3280 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { UserEntity } from '@novu/dal';
import { Page, selectors } from '@playwright/test';
import { faker } from '@faker-js/faker';
import { JobTitleEnum, jobTitleToLabelMapper } from '@novu/shared';

export interface SignUpTestData extends Partial<UserEntity> {
  fullName?: string;
}

export class SignUpPage {
  static async goTo(
    page: Page,
    { token, redirectURL }: { token?: string; redirectURL?: string } = {}
  ): Promise<SignUpPage> {
    const searchParams = new URLSearchParams();

    if (redirectURL) {
      searchParams.append('redirect_url', redirectURL);
    }

    if (token) {
      searchParams.append('token', token);
    }

    await page.goto(`/auth/signup?${searchParams.toString()}`);

    return new SignUpPage(page);
  }

  constructor(private page: Page) {
    selectors.setTestIdAttribute('data-test-id');
  }
  public getPasswordFromUserOrGenerate() {
    return faker.internet.password(20, true, /[A-Za-z0-9]/, 'Admin!234');
  }

  public getNameFromUserOrGenerate(data: Partial<UserEntity> & { fullName?: string }) {
    return data?.fullName ?? `${faker.name.firstName()} ${faker.name.lastName()}`;
  }

  public async assertNavigationPath(path: string) {
    selectors.setTestIdAttribute('data-test-id');
    await this.page.waitForURL(path);
  }

  public async clickGetStartedButton() {
    await this.page.getByTestId('submit-btn').click();
  }

  public async chooseMultiChannelUseCase() {
    await this.page.getByTestId('check-box-container-multi_channel').click();
  }

  public async setCompanyNameTo(name: string) {
    await this.page.getByTestId('questionnaire-company-name').fill(name);
  }

  public async selectJobTitle(jobTitle: string) {
    await this.page.getByTestId('questionnaire-job-title').click();
    await this.clickElementByText(jobTitle);
  }
  public async clickElementByText(text: string) {
    await this.page.getByText(text).click();
  }
  public getAcceptTermsAndConditionsCheckMark() {
    return this.page.getByTestId('accept-cb');
  }

  public async clickSignUpButton() {
    await this.page.getByTestId('submitButton').click();
  }

  public async fillSignUpData(data?: SignUpTestData) {
    await this.getFullNameLocator().fill(this.getNameFromUserOrGenerate(data));
    await this.getEmailInputLocator().fill(SignUpPage.fakeEmailFromUserOrGenerate(data));
    await this.getPasswordLocator().fill(this.getPasswordFromUserOrGenerate());
    await this.getPasswordLocator().blur();
    await this.getAcceptTermsAndConditionsCheckMark().setChecked(true);
  }

  public getPasswordLocator() {
    return this.page.getByTestId('password');
  }

  public getEmailInputLocator() {
    return this.page.getByTestId('email');
  }

  public getFullNameLocator() {
    return this.page.getByTestId('fullName');
  }

  public static fakeEmailFromUserOrGenerate(data: Partial<UserEntity> & { fullName?: string }) {
    return data?.email ?? faker.internet.email();
  }

  public async fillUseCaseData() {
    await this.selectJobTitle(jobTitleToLabelMapper[JobTitleEnum.PRODUCT_MANAGER]);
    await this.setCompanyNameTo('Company Name');
    await this.chooseLanguageSelector();
  }

  public async chooseLanguageSelector() {
    await this.page.getByTestId('language-checkbox').getByText('PHP').click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class SignUpPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/subscribers.ts
Tamaño: 940 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page, expect } from '@playwright/test';

export class SubscribersPage {
  constructor(private page: Page) {}

  static async goTo(page: Page): Promise<SubscribersPage> {
    await page.goto('/subscribers');

    return new SubscribersPage(page);
  }

  async assertSubscribersPageIsVisible() {
    await expect(this.page.getByRole('heading', { name: 'Subscribers' })).toBeVisible();
    await expect(this.page).toHaveURL(/\/subscribers/);
  }

  getSubscribersTable() {
    return this.page.getByTestId('subscribers-table');
  }

  async assertSubscribersTableHeaders(headerTitles: string[]) {
    const headers = this.getSubscribersTable().locator('th');
    await headers.allTextContents().then((texts) => expect(texts).toEqual(headerTitles));
  }

  async assertSubscribersTableRowCount(count: number) {
    const rowCount = await this.getSubscribersTable().locator('tr').count();
    expect(rowCount).toBeGreaterThan(1);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - headers(this.getSubscribersTable().locator('th');
    await headers.allTextContents().then((texts))
Declaraciones 'export' encontradas:
- export class SubscribersPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/teamMembersPage.ts
Tamaño: 1147 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';

export class TeamMembersPage {
  constructor(private page: Page) {}

  static async goTo(page: Page): Promise<TeamMembersPage> {
    await page.goto('/settings/team');

    return new TeamMembersPage(page);
  }

  getInviteUserInputBox() {
    return this.page.getByRole('textbox', { name: 'Invite user by email' });
  }

  async inviteUserByEmail(email: string) {
    const responsePromise = this.page.waitForResponse('**/invites');
    const inputBox = this.getInviteUserInputBox();
    await expect(inputBox).toBeVisible();

    await inputBox.fill(email);
    await this.page.getByTestId('submit-btn').click();
    await responsePromise;
  }

  async removeUserFromTeam() {
    const responsePromise = this.page.waitForResponse('**/organizations/members/**');
    await this.page.getByTestId('actions-row-btn').click();
    await this.page.getByTestId('remove-row-btn').click();
    await responsePromise;
  }

  async assertNumberOfUsersInTeamMembersList(count: number) {
    const memberRows = this.page.getByTestId(/^member-row-.*$/);
    await expect(memberRows).toHaveCount(count);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TeamMembersPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/templateStoreModal.ts
Tamaño: 870 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';

export class TemplateStoreModal {
  constructor(private page: Page) {}

  locator() {
    return this.page.getByTestId('templates-store-modal');
  }

  getTemplateStoreModalUseTemplate() {
    return this.page.getByTestId('templates-store-modal-use-template');
  }

  getSidebarItems() {
    return this.page.locator('[data-test-id="templates-store-modal-sidebar"] div');
  }

  getWorkflowCanvas() {
    return this.page.locator('.react-flow');
  }

  getBluePrintName(name: string) {
    return this.page.getByTestId('templates-store-modal-blueprint-name').getByText(name);
  }

  getBluePrintDescription() {
    return this.page.getByTestId('templates-store-modal-blueprint-description');
  }

  getBlueprintItem(name: string) {
    return this.page.getByTestId('templates-store-modal-blueprint-item').getByText(name);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TemplateStoreModal

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/tenantsPage.ts
Tamaño: 729 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { faker } from '@faker-js/faker';

export class TenantsPage {
  public async createNewTenant() {
    const name = faker.name.firstName();
    await this.page.getByTestId('add-tenant').click();
    await this.page.getByTestId('tenant-name').fill(name);
    await this.page.getByTestId('tenant-identifier').fill(faker.datatype.uuid());
    await this.page.getByTestId('create-tenant-sidebar-submit').click();

    return name;
  }
  constructor(private page: Page) {}

  public static async goTo(page: Page) {
    await page.goto('/tenants');

    return new TenantsPage(page);
  }
  public async clickElementByText(text: string) {
    await this.page.getByText(text).click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TenantsPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/translationsPage.ts
Tamaño: 2208 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Page } from '@playwright/test';
import { faker } from '@faker-js/faker';
import { setFileForFilePicker } from '../utils/commands';

export class TranslationsPage {
  public async uploadTranslationFile(fileName: string) {
    const locator = this.page.getByTestId('upload-files-container').locator('input[type="file"]');
    await setFileForFilePicker(locator, fileName);
  }
  public async assertGroupDoesNotExist(identifier: string) {
    const responsePromise = this.page.waitForResponse(`**/v1/translations/groups/${identifier}`);
    await this.navigateToGroup(identifier);
    const response = await responsePromise;
    expect(response.status()).toBe(404);
  }
  public async navigateToGroup(identifier: string) {
    return await this.page.goto(`/translations/edit/${identifier}`);
  }
  public async assertHasHeading(expextedTitle: string) {
    await expect(this.page.getByRole('heading').getByText(expextedTitle)).toBeVisible();
  }
  submitDefaultLanguageButton() {
    return this.page.getByTestId('default-language-submit-btn');
  }
  public async selectDefaultLanguage(language: string) {
    await this.page.getByTestId('default-language-select').fill(language);
    await this.page.locator('.mantine-Select-item').first().click();
  }
  public addGroupButton() {
    return this.page.getByTestId('add-group-btn');
  }
  constructor(private page: Page) {}

  public static async goTo(page: Page) {
    await page.goto('/translations');

    return new TranslationsPage(page);
  }

  public async assertTitleEquals(expectation: string) {
    await expect(this.page.getByTestId('translation-title')).toHaveText(expectation);
  }

  public async createGroup(name?: string) {
    const identifier = faker.datatype.uuid();
    const groupName = name ?? faker.name.lastName();
    await this.addGroupButton().click();
    await this.selectDefaultLanguage('Hindi (India)');
    await this.submitDefaultLanguageButton().click();
    await this.page.getByTestId('group-name-input').fill(groupName);
    await this.page.getByTestId('group-identifier-input').fill(identifier);
    await this.page.getByTestId('add-group-submit-btn').click();

    return { groupName, identifier };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TranslationsPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/variantPreviewModalPage.ts
Tamaño: 1838 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from '@playwright/test';
import { addConditions } from '../utils/commands';
import { WorkflowBaseSidePanelPage } from './workflowSettingsSidePanel';

export class VariantPreviewModalPage extends WorkflowBaseSidePanelPage {
  async addVariantConditionAtIndex(index: number) {
    await this.getVariantAtIndex(index).hover();
    await this.getVariantAddConditionButton(index).click();
    await addConditions(this.page);
  }
  getVariantAddConditionButton(index: number) {
    return this.getVariantAtIndex(index).getByTestId('add-conditions-action');
  }
  public getVariantAddConditionsButton() {
    return this.page.getByTestId('variant-sidebar-add-conditions');
  }

  public getVariantEditConditionsButton() {
    return this.page.getByTestId('variant-sidebar-edit-conditions');
  }
  public async addConditionToVariantNode() {
    await this.getVariantAddConditionsButton().click();
    await addConditions(this.page);
  }
  public async assertHasVariant(variant: VARIANT_NAMES) {
    await expect(this.getVariantAtIndex(0)).toContainText(variant);
    await expect(this.getVariantAtIndex(0).getByTestId('conditions-action')).toContainText('1');
    await expect(this.getVariantRootCard()).toBeVisible();
  }

  public getVariantRootCard() {
    return this.page.getByTestId('variant-root-card');
  }

  public getVariantAtIndex(index: number) {
    return this.page.getByTestId(`variant-item-card-${index}`);
  }

  public async assertHasVariantCount(count: number) {
    await expect(this.page.getByTestId('variants-count')).toContainText(`${count} variants`);
  }

  getVariantPreviewAddVariantButton() {
    return this.page.getByTestId('variant-sidebar-add-variant');
  }
}

export enum VARIANT_NAMES {
  IN_APP = 'V1 In-App',
  EMAIL = 'V1 Email',
  SMS = 'V1 SMS',
  CHAT = 'V1 Chat',
  PUSH = 'V1 Push',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class VariantPreviewModalPage
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/workflowEditorPage.ts
Tamaño: 11497 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Locator, Page, expect } from '@playwright/test';
import { dragAndDrop } from '../utils/browser';
import { WorkflowBaseSidePanelPage, WorkflowSettingsSidePanel } from './workflowSettingsSidePanel';
import { ChannelType } from '../utils/ChannelType';
import { NodeInAppEditingModalPageModel } from './nodeInAppEditingModalPageModel';
import { CodeSnippetSidePanelPageModel } from './codeSnippetSidePanelPageModel';
import { NodeEmailEditorPageModal } from './nodeEmailEditorPageModal';
import { NodeSmsEditingModalPageModel } from './nodeSmsEditingModalPageModel';
import { WorkflowTriggerSidebar } from './workflowTriggerSidebar';
import { NodeDigestEditorPageModal } from './nodeDigestEditorPageModal';
import { NodeChatEditingModalPageModel } from './nodeChatEditingModalPageModel';
import { NodePushEditorPageModal } from './nodePushEditorPageModal';
import { NodeDelayEditorPageModal } from './nodeDelayEditorPageModal';
import { ConditionsPage } from './conditionsPage';
import { addConditions } from '../utils/commands';

export class WorkflowEditorPage {
  async getFirstSmsNodeEditor() {
    await this.getNode(ChannelType.SMS, 0).hover();
    await this.editAction().click();

    return new NodeSmsEditingModalPageModel(this.page);
  }
  async addConditionToNode(channel: ChannelType) {
    await this.clickWorkflowNode(channel);
    await this.getAddConditionsButton().click();
    await addConditions(this.page);
    const sidePanel = new WorkflowSettingsSidePanel(this.page);
    await sidePanel.closeSidePanel();
  }
  async addVariantToPushNode() {
    await this.addVariantToNode(ChannelType.PUSH);

    return new NodePushEditorPageModal(this.page);
  }
  async addAndFillPushNode(pushSubject: string, pushBody: string, workflowTitle: string) {
    await this.setWorkflowNameInput(workflowTitle);
    const nodePushEditingPageModal = await this.addAndEditPushNode();
    await nodePushEditingPageModal.fillPushTitle(pushSubject);
    await nodePushEditingPageModal.fillPushContent(pushBody);
    await nodePushEditingPageModal.closeSidePanel();
  }
  async addVariantToChatNode() {
    await this.addVariantToNode(ChannelType.CHAT);

    return new NodeChatEditingModalPageModel(this.page);
  }
  async addAndFillChatNode(chatBody: string, workflowTitle: string) {
    await this.setWorkflowNameInput(workflowTitle);
    const nodeChatEditingPageModel = await this.addAndEditInChatNode();
    await nodeChatEditingPageModel.fillChatBody(chatBody);
    await nodeChatEditingPageModel.closeSidePanel();
  }
  async addVariantToSmsNode() {
    await this.addVariantToNode(ChannelType.SMS);

    return new NodeSmsEditingModalPageModel(this.page);
  }
  async addAndFillSmsNode(smsBody: string, workflowTitle: string) {
    await this.setWorkflowNameInput(workflowTitle);
    const nodeSmsEditingPageModel = await this.addAndEditInSmsNode();
    await nodeSmsEditingPageModel.fillSmsBody(smsBody);
    await nodeSmsEditingPageModel.nodeSettingsUpdateButton().click();
    await nodeSmsEditingPageModel.closeSidePanel();
  }
  async assertPageShowsPopUpMessage(expectedMessage: string) {
    await expect(this.page.getByText(expectedMessage)).toBeVisible();
  }
  async addVariantToInAppNode() {
    await this.addVariantToNode(ChannelType.IN_APP);

    return new NodeInAppEditingModalPageModel(this.page);
  }
  async addAndFillInAppNode(inAppBody: string, workflowTitle: string) {
    await this.setWorkflowNameInput(workflowTitle);
    const nodeInAppEditingPageModel = await this.addAndEditInAppNode();
    await nodeInAppEditingPageModel.fillNotificationBody(inAppBody);
    await nodeInAppEditingPageModel.closeSidePanel();
  }
  async addVariantToEmailNode() {
    await this.addVariantToNode(ChannelType.EMAIL);

    return new NodeEmailEditorPageModal(this.page);
  }
  async addVariantToNode(channel: ChannelType, last?: boolean) {
    await this.clickWorkflowNode(channel, last);
    const conditionsPage = await this.addVariantViaStepActions();
    await conditionsPage.getAddNewConditionButton().click();
    await conditionsPage.getConditionsFormKeyInput().fill('test');
    await conditionsPage.getConditionsFormValueInput().fill('test');
    await conditionsPage.getApplyConditionsButton().click();
  }

  async addVariantViaStepActions() {
    await this.getStepActionsMenuButtonLocator().click();
    await this.getAddVariantActionLocator().click();

    return new ConditionsPage(this.page);
  }
  async addAndFillEmailNode(emailSubject: string, emailParagraph: string, workflowTitle: string) {
    await this.setWorkflowNameInput(workflowTitle);
    const nodeEmailEditorPageModal = await this.addAndEditEmailNode();
    await nodeEmailEditorPageModal.fillEmailSubject(emailSubject);
    await nodeEmailEditorPageModal.editEmailBodyTextParagraph(emailParagraph);
    await nodeEmailEditorPageModal.closeSidePanel();
  }
  getEditConditionsButton(): any {
    return this.page.getByTestId('add-conditions-action');
  }
  public closeNotificationButton() {
    return this.page.locator('.mantine-Notification-closeButton');
  }
  EDITABLE_CHANNELS: ChannelType[] = [
    ChannelType.IN_APP,
    ChannelType.EMAIL,
    ChannelType.SMS,
    ChannelType.CHAT,
    ChannelType.PUSH,
  ];
  constructor(private page: Page) {}

  static async goToNewWorkflow(page: Page): Promise<WorkflowEditorPage> {
    await page.goto('../workflows/create');

    return new WorkflowEditorPage(page);
  }
  static async goToEditWorkflow(page: Page, templateId: string): Promise<WorkflowEditorPage> {
    await page.goto(`../workflows/edit/${templateId}`);

    return new WorkflowEditorPage(page);
  }

  private workflowSettingsSidePanel: WorkflowSettingsSidePanel;
  private workflowTriggerSidebar: WorkflowTriggerSidebar;

  public async openWorkflowSettingsSidePanel() {
    await this.page.getByTestId('settings-page').click();
    this.workflowSettingsSidePanel = new WorkflowSettingsSidePanel(this.page);

    return this.workflowSettingsSidePanel;
  }

  public async openWorkflowTriggerSidebar() {
    await this.nodeTriggerSelector().click();
    this.workflowTriggerSidebar = new WorkflowTriggerSidebar(this.page);

    return this.workflowTriggerSidebar;
  }

  async clickTriggerWorkflow() {
    await this.page.getByTestId('get-snippet-btn').click();

    return new CodeSnippetSidePanelPageModel(this.page);
  }

  getItemPhone() {
    return this.page.getByRole('button', { name: 'phonestring' });
  }

  setWorkflowNameInput(name: string) {
    return this.page.getByTestId('name-input').fill(name);
  }

  getPreviewSubject() {
    return this.page.getByTestId('preview-subject');
  }

  getPreviewContent() {
    return this.page.getByTestId('preview-content');
  }

  getPreviewModeSwitch() {
    return this.page.getByTestId('preview-mode-switch');
  }

  getPreviewJsonParam() {
    return this.page.getByTestId('preview-json-param');
  }

  getApplyVariablesLocator() {
    return this.page.getByTestId('apply-variables');
  }

  getTestEmailJsonParamsLocator() {
    return this.page.getByTestId('test-email-json-param');
  }

  getTestSendEmailBtnLocator() {
    return this.page.getByTestId('test-send-email-btn');
  }

  async getMantineNotificationRoot() {
    return this.page.locator('.mantine-Notification-root');
  }

  public settingsPage(): Locator {
    return this.page.getByTestId('settings-page');
  }

  body(): Locator {
    return this.page.locator('body');
  }

  getDragSideMenu() {
    return this.page.getByTestId('drag-side-menu');
  }

  addNodeButton(): Locator {
    return this.page.getByTestId('addNodeButton');
  }

  buttonAdd() {
    return this.page.getByTestId('button-add');
  }

  addSmsNode() {
    return this.page.getByTestId('add-sms-node');
  }

  addEmailNode() {
    return this.page.getByTestId('add-email-node');
  }

  editAction() {
    return this.page.getByTestId('edit-action');
  }

  getAddConditionsButton() {
    return this.page.getByTestId('add-conditions-action');
  }

  getConditionsButton() {
    return this.page.getByTestId('step-actions').getByTestId('conditions-action');
  }

  nodeEmailSelector() {
    return this.page.getByTestId('node-emailSelector');
  }

  nodeTriggerSelector() {
    return this.page.getByTestId('node-triggerSelector');
  }

  submitTemplateBtn() {
    return this.page.getByTestId('notification-template-submit-btn');
  }

  getStepActionsMenuButtonLocator() {
    return this.page.getByTestId('step-actions-menu');
  }

  getDeleteStepActionLocator() {
    return this.page.getByTestId('delete-step-action');
  }

  getAddVariantActionLocator() {
    return this.page.getByTestId('add-variant-action');
  }

  public async addAndEditInAppNode() {
    await this.addAndEditChannel(ChannelType.IN_APP);

    return new NodeInAppEditingModalPageModel(this.page);
  }

  public async addAndEditInSmsNode() {
    await this.addAndEditChannel(ChannelType.SMS);

    return new NodeSmsEditingModalPageModel(this.page);
  }
  public async addAndEditInChatNode() {
    await this.addAndEditChannel(ChannelType.CHAT);

    return new NodeChatEditingModalPageModel(this.page);
  }

  public async addAndEditEmailNode() {
    await this.addAndEditChannel(ChannelType.EMAIL);

    return new NodeEmailEditorPageModal(this.page);
  }

  async addAndEditDigestNode() {
    await this.addAndEditChannel(ChannelType.DIGEST);

    return new NodeDigestEditorPageModal(this.page);
  }

  async addAndEditDelayNode() {
    await this.addAndEditChannel(ChannelType.DELAY);

    return new NodeDelayEditorPageModal(this.page);
  }
  public async addAndEditPushNode() {
    await this.addAndEditChannel(ChannelType.PUSH);

    return new NodePushEditorPageModal(this.page);
  }
  public async addAndEditChannel(channel: ChannelType) {
    await this.addChannelToWorkflow(channel);
    await this.clickWorkflowNode(channel, true);
    await this.openNodeForEditing(channel);
  }

  private async openNodeForEditing(channel: ChannelType) {
    if (this.EDITABLE_CHANNELS.includes(channel)) {
      await this.page.getByTestId('channel-node').getByTestId('edit-action').click();
    }
  }

  public async addChannelToWorkflow(channel: ChannelType) {
    const source = this.page.getByTestId(`dnd-${channel}Selector`);
    const dest = this.page.getByTestId('addNodeButton').locator('..');
    await dragAndDrop(source, dest);
  }

  public async clickWorkflowNode(channel: ChannelType, last?: boolean) {
    const node = last
      ? this.page.getByTestId(`node-${channel}Selector`).last()
      : this.page.getByTestId(`node-${channel}Selector`).first();
    await node.click();
  }

  public async hoverWorkflowNode(channel: ChannelType, last?: boolean) {
    const node = last
      ? this.page.getByTestId(`node-${channel}Selector`).last()
      : this.page.getByTestId(`node-${channel}Selector`).first();
    await node.hover();
  }

  getNode(channel: ChannelType, number: number) {
    return this.page.getByTestId(`node-${channel}Selector`).nth(number);
  }

  getAllNodes() {
    return this.page.locator('.react-flow__node');
  }
  async getNodeSettings(channel: ChannelType) {
    await this.clickWorkflowNode(channel, true);
    await this.openNodeForEditing(channel);

    return new NodeDigestEditorPageModal(this.page);
  }
  getNodeSubtitle(channel: ChannelType, number: number) {
    return this.getNode(channel, number).getByTestId('workflow-node-subtitle');
  }

  async clickUpdate() {
    await this.page.getByTestId('notification-template-submit-btn').click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowEditorPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/workflowSettingsSidePanel.ts
Tamaño: 3379 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';
import { BasePage } from './basePage';
import { EditorState } from './editorState';

export abstract class WorkflowBaseSidePanelPage extends BasePage {
  protected constructor(page: Page) {
    super(page);
  }
  nodeSettingsUpdateButton() {
    return this.page.getByTestId('notification-template-submit-btn');
  }
  getAddConditionsSidebarButton() {
    return this.page.getByTestId('editor-sidebar-add-conditions');
  }
  getEditConditionsButton() {
    return this.page.getByTestId('editor-sidebar-edit-conditions');
  }
  async closeSidePanel() {
    await this.getCloseSidebarLocator().click();
  }
  getDeleteButton() {
    return this.page.getByTestId('editor-sidebar-delete');
  }
  getCloseSidebarLocator() {
    return this.page.getByTestId('sidebar-close');
  }

  getStepActiveSwitch() {
    return this.page.getByTestId('step-active-switch').locator('..');
  }

  getStepShouldStopOnFailSwitch() {
    return this.page.getByTestId('step-should-stop-on-fail-switch').locator('..');
  }

  getOpenEditVariablesButtonLocator() {
    return this.page.getByTestId('open-edit-variables-btn');
  }

  getVariableDefaultValueLocator() {
    return this.page.getByTestId('variable-default-value');
  }

  getCloseVarManagerModalLocator() {
    return this.page.getByTestId('close-var-manager-modal');
  }

  getNotificationTemplateSubmitButton() {
    return this.page.getByTestId('notification-template-submit-btn');
  }

  getStepActionsMenuButtonLocator() {
    return this.page.getByTestId('step-actions-menu');
  }

  getDeleteStepActionLocator() {
    return this.page.getByTestId('delete-step-action');
  }

  public async switchEditorMode(emailEditorState: EditorState) {
    const locator = this.page.getByTestId('editor-mode-switch').getByText(emailEditorState);
    await locator.click();
  }

  getStepVariablesButton() {
    return this.page.getByTestId('var-label').getByText('Step Variables');
  }
  getEditorAddVariantButton() {
    return this.page.getByTestId('editor-sidebar-add-variant');
  }
}

export class WorkflowSettingsSidePanel extends WorkflowBaseSidePanelPage {
  public getTitleLocator() {
    return this.page.getByTestId('title');
  }

  public getDescriptionLocator() {
    return this.page.getByTestId('description');
  }

  public getActiveToggleSwitch() {
    return this.page.getByTestId('active-toggle-switch');
  }

  public clickToggleSwitch() {
    return this.page.locator('.mantine-Switch-thumb').click();
  }

  public async fillTitle(title: string) {
    await this.getTitleLocator().fill(title);
  }

  public async fillDescription(fillDescription: string) {
    await this.getDescriptionLocator().fill(fillDescription);
  }
  public async fillBasicNotificationDetails({ title, description }: { title?: string; description?: string } = {}) {
    const titleLocator = this.getTitleLocator();
    await titleLocator.clear();
    await titleLocator.fill(title ?? 'Test Notification Title');

    const descriptionLocator = this.getDescriptionLocator();
    await descriptionLocator.fill(description ?? 'This is a test description for a test title');
  }

  groupSelector() {
    return this.page.getByTestId('groupSelector');
  }

  createGroupButton() {
    return this.page.getByTestId('submit-category-btn');
  }

  getTriggerId() {
    return this.page.getByTestId('trigger-id');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract
- export class WorkflowSettingsSidePanel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/workflowTriggerSidebar.ts
Tamaño: 469 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Page } from '@playwright/test';

export class WorkflowTriggerSidebar {
  constructor(private page: Page) {}

  locator() {
    return this.page.getByTestId('workflow-sidebar');
  }

  getTestTriggerToParam() {
    return this.page.getByTestId('test-trigger-to-param');
  }

  getTestTriggerPayloadParam() {
    return this.page.getByTestId('test-trigger-payload-param');
  }

  getTestTriggerBtn() {
    return this.page.getByTestId('test-trigger-btn');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowTriggerSidebar

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/page-models/workflowsPage.ts
Tamaño: 3490 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Locator, Page } from '@playwright/test';
import { TemplateStoreModal } from './templateStoreModal';
import { WorkflowEditorPage } from './workflowEditorPage';

export class WorkflowsPage {
  async getFirstWorkflowEditor(): Promise<WorkflowEditorPage> {
    const workflowsTable = this.getWorkflowsTable();
    await workflowsTable.locator('tbody tr').first().click();

    return new WorkflowEditorPage(this.page);
  }

  private templateStoreModal: TemplateStoreModal;

  constructor(private page: Page) {
    this.templateStoreModal = new TemplateStoreModal(page);
  }

  static async goTo(page: Page): Promise<WorkflowsPage> {
    await page.goto('/workflows');

    return new WorkflowsPage(page);
  }
  async clickTemplateEditLink(triggerId: string) {
    const locator = await this.templateEditLink(triggerId);
    await locator?.click();

    return new WorkflowEditorPage(this.page);
  }
  async templateEditLink(triggerId: string) {
    const locators = this.page.getByTestId('template-edit-link');
    await expect(locators.first()).toBeVisible();
    const count = await locators.count();
    for (let i = 0; i < count; i += 1) {
      const href = await locators.nth(i).getAttribute('href');
      if (href?.includes(triggerId)) {
        return locators.nth(i);
      }
    }
  }
  getTemplateStoreModal() {
    return this.templateStoreModal;
  }

  getCreateWorkflowButton() {
    return this.page.getByTestId('create-workflow-btn');
  }

  getCreateWorkflowDropdown() {
    return this.page.getByTestId('create-workflow-dropdown');
  }

  getCreateBlankWorkflowButton() {
    return this.page.getByTestId('create-workflow-blank');
  }

  getCreateAllTemplatesWorkflowButton() {
    return this.page.getByTestId('create-workflow-all-templates');
  }

  getCreateTemplateDropdownItem() {
    return this.page.getByTestId('create-template-dropdown-item');
  }

  getWorkflowsTable() {
    return this.page.getByTestId('notifications-template');
  }

  getRowEditLink(row: Locator) {
    return row.getByTestId('template-edit-link').getAttribute('href');
  }

  getStatusLabelTestId(active: boolean) {
    return active ? 'active-status-label' : 'disabled-status-label';
  }

  getNoWorkflowsPlaceholder() {
    return this.page.getByTestId('no-workflow-templates-placeholder');
  }

  getNoWorkflowsMatchesPlaceholder() {
    return this.page.getByTestId('workflows-no-matches');
  }

  getCreateWorkflowTile() {
    return this.page.getByTestId('create-workflow-tile');
  }

  getAllWorkflowTile() {
    return this.page.getByTestId('all-workflow-tile');
  }

  getPopularWorkflowTile() {
    return this.page.getByTestId('popular-workflow-tile');
  }

  getWorkflowName(row: Locator) {
    return row.getByTestId('workflow-row-name').textContent();
  }

  getWorkflowTriggerIdentifier(row: Locator) {
    return row.getByTestId('workflow-row-trigger-identifier').textContent();
  }

  assertRowStatusLabel(row: Locator, active: boolean) {
    return expect(row.getByTestId(this.getStatusLabelTestId(active))).toBeVisible();
  }

  assertRowCategoryLabel(row: Locator, category: string) {
    return expect(row.getByTestId('category-label')).toContainText(category);
  }

  async searchWorkflow(search: string) {
    await this.page.getByTestId('workflows-search-input').fill(search);
    await this.page.waitForResponse('**/v1/notification-templates*');
  }

  async clearSearchInput() {
    return this.page.getByTestId('search-input-clear').click();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowsPage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/rest-mocks/BillingRouteMocks.ts
Tamaño: 2054 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiServiceLevelEnum, GetSubscriptionDto } from '@novu/shared';
import { Page } from '@playwright/test';
import { addDays, endOfDay, startOfDay, subDays } from 'date-fns';

const SUBSCRIPTION_ROUTE = '**/v1/billing/subscription';

const subscriptionMock: GetSubscriptionDto = {
  status: 'active',
  apiServiceLevel: ApiServiceLevelEnum.BUSINESS,
  isActive: true,
  currentPeriodStart: new Date().toISOString(),
  currentPeriodEnd: new Date().toISOString(),
  billingInterval: 'month',
  events: {
    current: 0,
    included: 1000000,
  },
  trial: {
    isActive: false,
    start: null,
    end: null,
    daysTotal: 0,
  },
};

export class BillingRouteMocks {
  public static async mockSubscriptionRestCall(page, mockPayload: GetSubscriptionDto) {
    await page.route(SUBSCRIPTION_ROUTE, (route) => {
      route.fulfill({
        status: 200,
        contentType: 'application/json',
        body: JSON.stringify({
          data: mockPayload,
        }),
      });
    });
  }
  static async mockSubscriptionWithStatus(page: Page, status: string) {
    return await BillingRouteMocks.mockSubscriptionRestCall(page, {
      ...subscriptionMock,
      status,
    });
  }

  static async mockActiveSubscription(page: Page) {
    return await BillingRouteMocks.mockSubscriptionRestCall(page, {
      ...subscriptionMock,
      status: 'active',
    });
  }

  static async mockSubscriptionWithApiServiceLevel(page: Page, apiServiceLevel: ApiServiceLevelEnum) {
    return await BillingRouteMocks.mockSubscriptionRestCall(page, {
      ...subscriptionMock,
      apiServiceLevel,
    });
  }

  public static async mockSubscriptionTrial(page: Page, daysFromStart: number) {
    await BillingRouteMocks.mockSubscriptionRestCall(page, {
      ...subscriptionMock,
      trial: {
        ...subscriptionMock.trial,
        isActive: true,
        start: subDays(startOfDay(new Date()), daysFromStart).toISOString(),
        end: addDays(endOfDay(new Date()), 30 - daysFromStart).toISOString(),
      },
      status: 'trialing',
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - GetSubscriptionDto({
  status: 'active',
  apiServiceLevel: ApiServiceLevelEnum.BUSINESS,
  isActive: true,
  currentPe...)
Declaraciones 'export' encontradas:
- export class BillingRouteMocks

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/ChannelType.ts
Tamaño: 156 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum ChannelType {
  IN_APP = 'inApp',
  EMAIL = 'email',
  SMS = 'sms',
  CHAT = 'chat',
  PUSH = 'push',
  DIGEST = 'digest',
  DELAY = 'delay',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/baseTest.ts
Tamaño: 442 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/*
 * This is the only location where this import is allowed. We add setting contextual data
 * to every test context before execution.
 */

import { test as baseTest } from '@playwright/test';

export const test = baseTest.extend({
  context: async ({ context }, use) => {
    await context.addInitScript(() => {
      (window as any).isPlaywright = true;
    });
    await use(context);
  },
});

export { expect } from '@playwright/test';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - test(baseTest.extend({
  context: async ({ context }, use))
Declaraciones 'export' encontradas:
- export  const
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/browser.ts
Tamaño: 3736 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Locator, Page, selectors } from '@playwright/test';
import os from 'node:os';
import { FeatureFlagsKeysEnum } from '@novu/shared';
import { getSession, ISessionOptions } from './plugins';

const isMac = os.platform() === 'darwin';
const modifier = isMac ? 'Meta' : 'Control';

export async function initializeSession(page: Page, settings: ISessionOptions = {}) {
  selectors.setTestIdAttribute('data-test-id');

  const session = await getSession(settings);

  /*
   * Why is this necessary?
   *
   * Most Playwright tests, create a sessions using some utility functions. The session
   * is injected in the test, but also needs to be injected in the browser storage, so that
   * the app can work as expected. Currently, the apps shares token and environment information
   * between React hooks and the api.client.ts via the localStorage. This needs to be revised
   * in favor of an in-memory approach.
   */
  await page.addInitScript((currentSession) => {
    window.addEventListener('DOMContentLoaded', () => {
      localStorage.setItem('nv_auth_token', currentSession.token);
      localStorage.setItem('nv_last_environment_id', currentSession.environment._id);
    });
  }, session);

  // TODO: Remove the first navigation from this function and move it per test to have more control per test
  await page.goto('/');

  return { session };
}

export async function fillTextInAMonacoEditor(page: Page, selector: string, textToType: string) {
  const monacoEditor = page.locator(selector).nth(0);
  await monacoEditor.click();
  await monacoEditor.press(`${modifier}+KeyX`);
  await page.keyboard.type(textToType);
}

export async function fillTextInAMonacoEditorLocator(locator: Locator, textToType: string) {
  await locator.click();
  await locator.page().keyboard.type(textToType);
}

export async function dragAndDrop(dragSelector: Locator, dropSelector: Locator) {
  await dragSelector.dragTo(dropSelector, { force: true });
}

export async function deleteIndexedDB(page: Page, dbName: string) {
  await page.goto('/');
  await page.evaluate((name) => {
    indexedDB.deleteDatabase(name);
  }, dbName);
}

export async function isDarkTheme(page: Page) {
  // TODO: there should be a more idiomatic way to find out what theme is selected
  const backgroundColor = await page.evaluate(() => {
    const { body } = document;

    return window.getComputedStyle(body).backgroundColor;
  });

  return backgroundColor.toLowerCase() === 'rgb(30, 30, 38)';
}

export async function getAttByTestId(page: Page, testId: string, att: string) {
  return await page.getByTestId(testId).getAttribute(att);
}
export async function waitForNetworkIdle(page: Page) {
  await page.waitForLoadState('networkidle');
}

export async function setBrowserDateTimeTo(page: Page, value: Date) {
  await page.addInitScript(`{
    // Extend Date constructor to default to [value]
    Date = class extends Date {
      constructor(...args) {
        if (args.length === 0) {
          super(${value});
        } else {
          super(...args);
        }
      }
    }
    // Override Date.now() to start from [value]
    const __DateNowOffset = ${value} - Date.now();
    const __DateNow = Date.now;
    Date.now = () => __DateNow() + __DateNowOffset;
  }`);
}

export async function assertPageShowsMessage(page: Page, text: string) {
  await expect(page.getByText(text)).toBeVisible();
}

declare global {
  interface Window {
    _env_: Record<string, string | undefined>;
  }
}

export async function setFeatureFlag(page: Page, key: FeatureFlagsKeysEnum, value: string | boolean) {
  await page.addInitScript(
    ({ k, v }) => {
      window._env_ = window._env_ || { [k]: v.toString() };
    },
    { k: key, v: value }
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - initializeSession(page: Page, settings: ISessionOptions = {})
 - fillTextInAMonacoEditor(page: Page, selector: string, textToType: string)
 - fillTextInAMonacoEditorLocator(locator: Locator, textToType: string)
 - dragAndDrop(dragSelector: Locator, dropSelector: Locator)
 - deleteIndexedDB(page: Page, dbName: string)
 - isDarkTheme(page: Page)
 - getAttByTestId(page: Page, testId: string, att: string)
 - waitForNetworkIdle(page: Page)
 - setBrowserDateTimeTo(page: Page, value: Date)
 - assertPageShowsMessage(page: Page, text: string)
 - setFeatureFlag(page: Page, key: FeatureFlagsKeysEnum, value: string | boolean)
Asignaciones con arrow functions encontradas (posibles funciones):
 - session(await getSession(settings);

  /*
   * Why is this necessary?
   *
   * Most Playwright tests, creat...)
 - monacoEditor(page.locator(selector).nth(0);
  await monacoEditor.click();
  await monacoEditor.press(`${modifier}...)
 - backgroundColor(await page.evaluate(())
 - now())
Declaraciones 'export' encontradas:
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/commands.ts
Tamaño: 1101 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Locator, Page } from '@playwright/test';
import { ConditionsPage } from '../page-models/conditionsPage';

export async function logout(page: Page, settings = {}) {
  await page.goto('/');
  await page.evaluate(() => {
    localStorage.removeItem('nv_auth_token');
    localStorage.removeItem('nv_last_environment_id');
  });
}

export function getClipboardValue(page: Page) {
  return page.evaluate(() => navigator.clipboard.readText());
}

export async function setFileForFilePicker(locator: Locator, filePath: string) {
  const fileChooserPromise = locator.page().waitForEvent('filechooser');
  await locator.dispatchEvent('click');
  const fileChooser = await fileChooserPromise;
  await fileChooser.setFiles(filePath);
}

export async function addConditions(page: Page) {
  const conditionsModal = new ConditionsPage(page);
  await conditionsModal.getAddNewConditionButton().click();
  await conditionsModal.getConditionsFormKeyInput().fill('test');
  await conditionsModal.getConditionsFormValueInput().fill('test');
  await conditionsModal.getApplyConditionsButton().click();
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - logout(page: Page, settings = {})
 - getClipboardValue(page: Page)
 - setFileForFilePicker(locator: Locator, filePath: string)
 - addConditions(page: Page)
Asignaciones con arrow functions encontradas (posibles funciones):
 - settings({}) {
  await page.goto('/');
  await page.evaluate(())
Declaraciones 'export' encontradas:
- export  async
- export function getClipboardValue
- export  async
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/integrations.ts
Tamaño: 3877 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, Locator, Page } from '@playwright/test';

export const navigateToGetStarted = async (page: Page, card = 'channel-card-email') => {
  await page.goto('/get-started');
  await expect(page).toHaveURL(/\/get-started/);

  const cardComponent = page.getByTestId(card);
  const button = cardComponent.locator('button');
  await expect(button).toContainText('Change Provider');
  await button.click();

  const integrationsModal = page.getByTestId('integrations-list-modal');
  await expect(integrationsModal).toBeVisible();
  await expect(integrationsModal.getByRole('heading')).toContainText('Integration Store');
};

export const checkTableLoading = async (page: Page | Locator) => {
  const nameCellLoadingElements = page.getByTestId('integration-name-cell-loading');
  await expect(nameCellLoadingElements).toHaveCount(10);
  await expect(nameCellLoadingElements.first()).toBeVisible();

  const providerCellLoadingElements = page.getByTestId('integration-provider-cell-loading');
  await expect(providerCellLoadingElements).toHaveCount(10);
  await expect(providerCellLoadingElements.first()).toBeVisible();

  const channelCellLoadingElements = page.getByTestId('integration-channel-cell-loading');
  await expect(channelCellLoadingElements).toHaveCount(10);
  await expect(channelCellLoadingElements.first()).toBeVisible();

  const envCellLoadingElements = page.getByTestId('integration-environment-cell-loading');
  await expect(envCellLoadingElements).toHaveCount(10);
  await expect(envCellLoadingElements.first()).toBeVisible();

  const statusCellLoadingElements = page.getByTestId('integration-status-cell-loading');
  await expect(statusCellLoadingElements).toHaveCount(10);
  await expect(statusCellLoadingElements.first()).toBeVisible();
};

export const checkTableRow = async (
  page: Page | Locator,
  {
    name,
    isFree,
    provider,
    channel,
    environment,
    status,
  }: {
    name: string;
    isFree?: boolean;
    provider: string;
    channel: string;
    environment?: string;
    status: string;
  }
) => {
  const integrationsTable = page.getByTestId('integrations-list-table');
  const nthRow = integrationsTable.locator('tbody tr', { hasText: new RegExp(`^${name}.*${environment ?? ''}`) });
  const nameCell = nthRow.getByTestId('integration-name-cell').getByText(name, { exact: true });
  await expect(nthRow).toBeVisible();
  await expect(nameCell).toBeVisible();

  if (isFree) {
    await expect(nameCell).toContainText('Test Provider');
  }

  const providerCell = nthRow.getByTestId('integration-provider-cell').getByText(provider);
  await expect(providerCell).toBeVisible();

  const channelCell = nthRow.getByTestId('integration-channel-cell').getByText(channel);
  await expect(channelCell).toBeVisible();

  if (environment) {
    const environmentCell = nthRow.getByTestId('integration-environment-cell').getByText(environment);
    await expect(environmentCell).toBeVisible();
  }

  const statusCell = nthRow.getByTestId('integration-status-cell').getByText(status);
  await expect(statusCell).toBeVisible();
};

export const clickOnListRow = async (page: Page | Locator, name: string | RegExp) => {
  const integrationsTable = page.getByTestId('integrations-list-table');
  const row = integrationsTable.locator('tr').getByText(name).first();
  await expect(row).toBeVisible();
  await row.click();
};

export async function interceptIntegrationsRequest({
  page,
  modifyBody,
}: {
  page: Page;
  modifyBody?: (body: any) => any;
}) {
  return page.route('**/v1/integrations', async (route) => {
    const response = await page.request.fetch(route.request());
    await new Promise((resolve) => {
      setTimeout(resolve, 3000);
    });
    const body = await response.json();

    await route.fulfill({
      response,
      body: JSON.stringify(modifyBody ? modifyBody(body) : body),
    });
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - interceptIntegrationsRequest({
  page,
  modifyBody,
}: {
  page: Page;
  modifyBody?: (body: any)
Asignaciones con arrow functions encontradas (posibles funciones):
 - card('channel-card-email'))
 - checkTableLoading(async (page: Page | Locator))
 - checkTableRow(async (
  page: Page | Locator,
  {
    name,
    isFree,
    provider,
    channel,
    environment...)
 - clickOnListRow(async (page: Page | Locator, name: string | RegExp))
 - row(integrationsTable.locator('tr').getByText(name).first();
  await expect(row).toBeVisible();
  await ...)
 - response(await page.request.fetch(route.request());
    await new Promise((resolve))
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/jsonUtils.ts
Tamaño: 168 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class JsonUtils {
  public static isJsonString(str) {
    try {
      JSON.parse(str);

      return true;
    } catch (error) {
      return false;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class JsonUtils

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/web/tests/utils/plugins.ts
Tamaño: 9958 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DalService,
  IntegrationRepository,
  NotificationGroupRepository,
  NotificationTemplateEntity,
  EnvironmentEntity,
  OrganizationEntity,
  UserEntity,
} from '@novu/dal';
import { ChannelTypeEnum, getPopularTemplateIds, MemberStatusEnum, ProvidersIdEnum } from '@novu/shared';
import {
  CreateTemplatePayload,
  EnvironmentService,
  JobsService,
  NotificationsService,
  NotificationTemplateService,
  OrganizationService,
  SubscribersService,
  UserService,
  UserSession,
} from '@novu/testing';
import { Page } from '@playwright/test';

export interface SessionData {
  token: string;
  user: UserEntity;
  organization: OrganizationEntity;
  environment: EnvironmentEntity;
  templates: NotificationTemplateEntity[]; // You can replace 'any' with a more specific type if needed
}

export interface OverrideSessionOptions {
  singleTokenInjection?: boolean;
  page?: Page;
}

export interface ISessionOptions {
  noEnvironment?: boolean;
  partialTemplate?: Partial<NotificationTemplateEntity>;
  noTemplates?: boolean;
  showOnBoardingTour?: boolean;
  overrideSessionOptions?: OverrideSessionOptions;
  shouldSkipLogin?: boolean;
}

export async function getSession(settings: ISessionOptions = {}): Promise<SessionData> {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');

  const session = new UserSession('http://127.0.0.1:1336');
  await session.initialize({
    noEnvironment: settings?.noEnvironment,
    showOnBoardingTour: settings?.showOnBoardingTour,
  });

  const notificationTemplateService = new NotificationTemplateService(
    session.user._id,
    session.organization._id,
    session.environment._id as string
  );

  let templates;
  if (!settings?.noTemplates) {
    const templatePartial = settings?.partialTemplate || {};

    templates = await Promise.all([
      notificationTemplateService.createTemplate({ ...(templatePartial as any) }),
      notificationTemplateService.createTemplate({
        active: false,
        draft: true,
      }),
      notificationTemplateService.createTemplate(),
      notificationTemplateService.createTemplate(),
      notificationTemplateService.createTemplate(),
      notificationTemplateService.createTemplate(),
    ]);
  }

  return {
    token: session.token.split(' ')[1],
    user: session.user,
    organization: session.organization,
    environment: session.environment,
    templates,
  };
}

export async function deleteProvider(query: {
  providerId: ProvidersIdEnum;
  channel: ChannelTypeEnum;
  environmentId: string;
  organizationId: string;
}) {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');

  const repository = new IntegrationRepository();

  return await repository.deleteMany({
    channel: query.channel,
    providerId: query.providerId,
    _environmentId: query.environmentId,
    _organizationId: query.organizationId,
  });
}

export async function createNotifications({
  identifier,
  token,
  count = 1,
  subscriberId,
  environmentId,
  organizationId,
  templateId,
}: {
  identifier: string;
  token: string;
  count?: number;
  subscriberId?: string;
  environmentId: string;
  organizationId: string;
  templateId?: string;
}) {
  const jobsService = new JobsService();
  let subId = subscriberId;
  if (!subId) {
    const subscribersService = new SubscribersService(organizationId, environmentId);
    const subscriber = await subscribersService.createSubscriber();
    subId = subscriber.subscriberId;
  }

  const triggerIdentifier = identifier;
  const service = new NotificationsService(token, environmentId);
  const session = new UserSession(process.env.REACT_APP_API_URL);

  for (let i = 0; i < count; i += 1) {
    await service.triggerEvent(triggerIdentifier, subId, {});
  }

  if (organizationId) {
    await session.waitForJobCompletion(templateId, organizationId);
  }

  while ((await jobsService.standardQueue.getWaitingCount()) || (await jobsService.standardQueue.getActiveCount())) {
    await new Promise((resolve) => {
      setTimeout(resolve, 50);
    });
  }

  return 'ok';
}

/*
 * Use only before or after the suite execution. Do not drop the database in tests as
 * it will break parallel test runs.
 */
export async function dropDatabase() {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');
  await dal.destroy();

  return true;
}

export async function createUser(): Promise<UserEntity> {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');

  const userService = new UserService();

  return await userService.createTestUser();
}

export function randomEmail() {
  return new UserService().randomEmail();
}

export function randomPassword() {
  return new UserService().randomPassword();
}

export function testPassword() {
  return new UserService().testPassword();
}

export async function addOrganization(userId: string) {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');
  const organizationService = new OrganizationService();

  const organization = await organizationService.createOrganization();
  await organizationService.addMember(organization._id as string, userId);

  return organization;
}

export async function createWorkflows({
  userId,
  organizationId,
  environmentId,
  workflows,
}: {
  userId: string;
  organizationId: string;
  environmentId: string;
  workflows: Partial<CreateTemplatePayload>[];
}) {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');

  const notificationTemplateService = new NotificationTemplateService(userId, organizationId, environmentId);

  return Promise.all(workflows.map((workflow) => notificationTemplateService.createTemplate(workflow)));
}

export async function inviteUser(
  session: SessionData,
  email: string
): Promise<{ token: string; inviter: any; organization: any }> {
  const apiUrl = process.env.REACT_APP_API_URL;

  const inviteResponse = await fetch(`${apiUrl}/v1/invites`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${session.token}`,
      'Novu-Environment-Id': session.environment._id,
    },
    body: JSON.stringify({
      email,
      role: 'ADMIN',
    }),
  });

  if (!inviteResponse.ok) {
    throw new Error(`Failed to send invite: ${await inviteResponse.text()}`);
  }

  const membersResponse = await fetch(`${apiUrl}/v1/organizations/members`, {
    method: 'GET',
    headers: {
      Authorization: `Bearer ${session.token}`,
      'Novu-Environment-Id': session.environment._id,
    },
  });

  if (!membersResponse.ok) {
    throw new Error(`Failed to fetch members: ${await membersResponse.text()}`);
  }

  const membersData = await membersResponse.json();
  const invitedMember = membersData.data.find((member) => member.memberStatus === MemberStatusEnum.INVITED);

  if (!invitedMember || !invitedMember.invite.token) {
    throw new Error('No invited member found or no token available');
  }

  return {
    token: invitedMember.invite.token,
    inviter: session.user,
    organization: session.organization,
  };
}

export async function populateBlueprints() {
  const dal = new DalService();
  await dal.connect(process.env.MONGODB_URL ?? '');

  const userService = new UserService();
  const user = await userService.createUser();

  const notificationGroupRepository = new NotificationGroupRepository();
  const organizationService = new OrganizationService();
  const environmentService = new EnvironmentService();

  let organization = await organizationService.getOrganization(process.env.BLUEPRINT_CREATOR ?? '');

  if (!organization) {
    organization = await organizationService.createOrganization({ _id: process.env.BLUEPRINT_CREATOR });
  }

  const organizationId = organization._id;

  let developmentEnvironment = await environmentService.getDevelopmentEnvironment(organizationId);
  if (!developmentEnvironment) {
    developmentEnvironment = await environmentService.createDevelopmentEnvironment(organizationId, user._id);
  }

  let productionEnvironment = await environmentService.getProductionEnvironment(organizationId);
  if (!productionEnvironment) {
    productionEnvironment = await environmentService.createProductionEnvironment(
      organizationId,
      user._id,
      developmentEnvironment._id
    );
  }

  const productionEnvironmentId = productionEnvironment._id;

  const productionGeneralGroup = await notificationGroupRepository.findOne({
    name: 'General',
    _environmentId: productionEnvironmentId,
    _organizationId: organizationId,
  });
  const productionGetStartedGroup = await notificationGroupRepository.findOne({
    name: 'Get started',
    _environmentId: productionEnvironmentId,
    _organizationId: organizationId,
  });

  if (!productionGeneralGroup) {
    await notificationGroupRepository.create({
      name: 'General',
      _environmentId: productionEnvironmentId,
      _organizationId: organizationId,
    });
  }
  if (!productionGetStartedGroup) {
    await notificationGroupRepository.create({
      name: 'Get started',
      _environmentId: productionEnvironmentId,
      _organizationId: organizationId,
    });
  }

  const productionNotificationTemplateService = new NotificationTemplateService(
    user._id,
    organizationId,
    productionEnvironmentId
  );

  const popularTemplateIds = getPopularTemplateIds({ production: false });

  const blueprintTemplates = await productionNotificationTemplateService.getBlueprintTemplates(
    organizationId,
    productionEnvironmentId
  );

  if (blueprintTemplates.length === 0) {
    return await Promise.all([
      productionNotificationTemplateService.createTemplate({
        _id: popularTemplateIds[0],
        noFeedId: true,
        noLayoutId: true,
        name: ':fa-solid fa-star: Super cool workflow',
        isBlueprint: true,
      }),
    ]);
  }

  return blueprintTemplates;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getSession(settings: ISessionOptions = {})
 - deleteProvider(query: {
  providerId: ProvidersIdEnum;
  channel: ChannelTypeEnum;
  environmentId: string;
  organizationId: string;
})
 - createNotifications({
  identifier,
  token,
  count = 1,
  subscriberId,
  environmentId,
  organizationId,
  templateId,
}: {
  identifier: string;
  token: string;
  count?: number;
  subscriberId?: string;
  environmentId: string;
  organizationId: string;
  templateId?: string;
})
 - dropDatabase()
 - createUser()
 - randomEmail()
 - randomPassword()
 - testPassword()
 - addOrganization(userId: string)
 - createWorkflows({
  userId,
  organizationId,
  environmentId,
  workflows,
}: {
  userId: string;
  organizationId: string;
  environmentId: string;
  workflows: Partial<CreateTemplatePayload>[];
})
 - inviteUser(session: SessionData,
  email: string)
 - populateBlueprints()
Asignaciones con arrow functions encontradas (posibles funciones):
 - notificationTemplateService(new NotificationTemplateService(userId, organizationId, environmentId);

  return Promise.all(workfl...)
 - invitedMember(membersData.data.find((member))
Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export  async
- export  async
- export  async
- export  async
- export  async
- export function randomEmail
- export function randomPassword
- export function testPassword
- export  async
- export  async
- export  async
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/.dockerignore
Tamaño: 539 bytes
Lenguaje detectado: DOCKERIGNORE

### CONTENIDO ORIGINAL ###

# Ignore node_modules to avoid copying them into the image
node_modules

# Ignore local environment files
.env
.env.local
.env.*.local

# Ignore logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Ignore build directories
dist
build

# Ignore test directories and files
coverage
*.test.js
*.spec.js
*.test.ts
*.spec.ts

# Ignore Docker-related files
Dockerfile*
.dockerignore

# Ignore IDE/editor config files
.vscode
.idea
*.swp

# Ignore OS-specific files
.DS_Store
Thumbs.db

# Ignore temporary files
tmp
temp
*.tmp
*.temp

### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Ignore node_modules to avoid copying them into the image
node_modules
# Ignore local environment files
.env
# Ignore logs
# Ignore build directories
# Ignore test directories and files
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/.gitignore
Tamaño: 366 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# compiled output
/dist
/node_modules

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS
.DS_Store

# Tests
/coverage
/.nyc_output

# IDEs and editors
/.idea
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

# IDE - VSCode
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json


dist


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# compiled output
/dist
/node_modules
# Logs
# OS
# Tests
# IDEs and editors
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/Dockerfile
Tamaño: 2305 bytes
Lenguaje detectado: DOCKERFILE

### CONTENIDO ORIGINAL ###

# Use the base image for development
FROM node:20-alpine3.19 AS dev_base
RUN apk add --no-cache g++ make py3-pip
ENV NX_DAEMON=false

# Install global dependencies
RUN npm --no-update-notifier --no-fund --global install pm2 pnpm@10.16.1&& \
    pnpm --version

# Set non-root user
USER 1000
WORKDIR /usr/src/app

FROM dev_base AS dev
ARG PACKAGE_PATH

# Copy necessary directories to the image with appropriate ownership
COPY --chown=1000:1000 ./meta ./deps ./pkg ./

# Install dependencies and build the webhook service
RUN --mount=type=cache,id=pnpm-store-webhook,target=/root/.pnpm-store \
    pnpm install --reporter=silent --filter "novuhq" --filter "{${PACKAGE_PATH}}..." \
    --frozen-lockfile --unsafe-perm --reporter=silent && \
    NODE_ENV=production pnpm build:webhook

# Set the working directory to the webhook app and copy example environment file
WORKDIR /usr/src/app/apps/webhook
RUN cp src/dotenvcreate.mjs dist/dotenvcreate.mjs
RUN cp src/.example.env dist/.env
RUN cp src/.env.test dist/.env.test
RUN cp src/.env.development dist/.env.development
RUN cp src/.env.production dist/.env.production

# Set the working directory to the root of the app
WORKDIR /usr/src/app

# ------- ASSETS BUILD ----------
# Create a new stage for building assets
FROM dev AS assets

# Remove node_modules and source directories
RUN rm -rf node_modules && pnpm recursive exec -- rm -rf ./src ./node_modules

# ------- PRODUCTION BUILD ----------
# Use the base image for production
FROM dev_base AS prod
ARG PACKAGE_PATH

# Set environment variables for production
ENV CI=true

# Set the working directory to the root of the app
WORKDIR /usr/src/app

# Copy necessary directories from the build stage
COPY --chown=1000:1000 ./meta ./
COPY --chown=1000:1000 --from=assets /usr/src/app .

# Install production dependencies
RUN --mount=type=cache,id=pnpm-store-webhook,target=/root/.pnpm-store \
    pnpm install --reporter=silent --filter "{${PACKAGE_PATH}}..." \
    --frozen-lockfile --unsafe-perm --reporter=silent

# Set the working directory to the webhook app and start the application using pm2-runtime
WORKDIR /usr/src/app/apps/webhook
ENTRYPOINT [ "sh", "-c", "node dist/dotenvcreate.mjs -s=novu/webhook -r=$NOVU_REGION -e=$NOVU_ENTERPRISE -v=$NODE_ENV && pm2-runtime start dist/main.js -i max" ]


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Use the base image for development
FROM node:20-alpine3.19 AS dev_base
RUN apk add --no-cache g++ make py3-pip
ENV NX_DAEMON=false
# Install global dependencies
# Set non-root user
# Copy necessary directories to the image with appropriate ownership
# Install dependencies and build the webhook service
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/nest-cli.json
Tamaño: 619 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "assets": [
      {
        "include": ".env",
        "outDir": "dist"
      },
      {
        "include": ".env.development",
        "outDir": "dist"
      },
      {
        "include": ".env.test",
        "outDir": "dist"
      },
      {
        "include": ".env.production",
        "outDir": "dist"
      }
    ],
    "plugins": [],
    "builder": {
      "type": "swc",
      "options": {
        "stripLeadingPaths": true
      }
    },
    "typeCheck": true
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"$schema": "https://json.schemastore.org/nest-cli",
"collection": "@nestjs/schematics",
"sourceRoot": "src",
"compilerOptions": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/package.json
Tamaño: 3071 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/webhook",
  "version": "3.9.0",
  "description": "",
  "author": "",
  "private": true,
  "license": "UNLICENSED",
  "scripts": {
    "prebuild": "rimraf dist",
    "build": "nest build",
    "docker:build": "pnpm --silent --workspace-root pnpm-context -- apps/webhook/Dockerfile | docker buildx build --load --build-arg PACKAGE_PATH=apps/webhook - -t novu-webhook $DOCKER_BUILD_ARGUMENTS",
    "docker:build:depot": "pnpm --silent --workspace-root pnpm-context -- apps/webhook/Dockerfile | depot build --build-arg PACKAGE_PATH=apps/webhook - -t novu-webhook --load",
    "start": "pnpm start:dev",
    "start:dev": "nest start --watch",
    "start:test": "cross-env NODE_ENV=test nest start",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "test": "echo 'test'",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test:e2e": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file e2e/setup.ts e2e/**/*.e2e.ts src/**/*.e2e.ts"
  },
  "dependencies": {
    "@aws-sdk/client-secrets-manager": "^3.716.0",
    "@nestjs/axios": "3.0.3",
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/platform-express": "10.4.18",
    "@nestjs/terminus": "10.2.3",
    "@novu/application-generic": "workspace:*",
    "@novu/dal": "workspace:*",
    "@novu/shared": "workspace:*",
    "@novu/stateless": "workspace:*",
    "@novu/testing": "workspace:*",
    "@sentry/browser": "^8.33.1",
    "@sentry/hub": "^7.114.0",
    "@sentry/nestjs": "^8.33.1",
    "@sentry/node": "^8.33.1",
    "@sentry/profiling-node": "^8.33.1",
    "@sentry/tracing": "^7.40.0",
    "axios": "^1.9.0",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "dotenv": "^16.4.5",
    "envalid": "^8.0.0",
    "jsonwebtoken": "9.0.0",
    "lodash": "^4.17.15",
    "nest-raven": "10.1.0",
    "newrelic": "^12.8.1",
    "reflect-metadata": "0.2.2",
    "rimraf": "^3.0.2",
    "rxjs": "7.8.1",
    "yargs": "^17.7.2"
  },
  "devDependencies": {
    "@nestjs/cli": "10.4.5",
    "@nestjs/schematics": "10.1.4",
    "@nestjs/testing": "10.4.18",
    "@types/chai": "^4.3.4",
    "@types/express": "^4.17.8",
    "@types/jest": "^29.5.0",
    "@types/mocha": "^10.0.2",
    "@types/node": "^20.15.0",
    "@types/sinon": "^9.0.0",
    "@types/supertest": "^2.0.10",
    "chai": "^4.2.0",
    "cross-env": "^7.0.3",
    "jest": "^27.0.6",
    "mocha": "^10.2.0",
    "sinon": "^9.2.4",
    "supertest": "^7.0.0",
    "ts-jest": "^27.0.7",
    "ts-loader": "~9.4.0",
    "ts-node": "~10.9.1",
    "tsconfig-paths": "~4.1.0",
    "typescript": "5.6.2"
  },
  "workspaces": {
    "nohoist": [
      "@nestjs/platform-socket.io",
      "@nestjs/platform-socket.io/**"
    ]
  },
  "nx": {
    "tags": [
      "type:app"
    ],
    "targets": {
      "lint": {
        "executor": "nx:run-commands",
        "options": {
          "command": "npx biome lint apps/webhook"
        }
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/webhook",
"version": "3.9.0",
"description": "",
"author": "",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/tsconfig.build.json
Tamaño: 546 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "declaration": true,
    "esModuleInterop": false,
    "noImplicitAny": false,
    "removeComments": true,
    "allowSyntheticDefaultImports": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es6",
    "sourceMap": true,
    "outDir": "./dist",
    "baseUrl": "./src",
    "types": ["node", "mocha"]
  },
  "include": ["src/**/*", "src/**/*.d.ts"],
  "exclude": ["node_modules", "**/*.spec.ts", "**/*.e2e.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"module": "commonjs",
"declaration": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/tsconfig.json
Tamaño: 317 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "module": "commonjs",
    "allowSyntheticDefaultImports": true,
    "types": ["node", "mocha", "chai", "sinon"],
    "target": "es2017",
    "allowJs": false,
    "esModuleInterop": true,
    "declarationMap": true
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/e2e/mocha.e2e.opts
Tamaño: 0 bytes
Lenguaje detectado: OPTS

### CONTENIDO ORIGINAL ###



### ANALISIS AUTOMATICO (ESPAÑOL) ###

Sin cabecera detectada en las primeras líneas.
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/e2e/setup.ts
Tamaño: 525 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DalService } from '@novu/dal';
import { testServer } from '@novu/testing';
import sinon from 'sinon';
import { bootstrap } from '../src/bootstrap';

const dalService = new DalService();

before(async () => {
  await testServer.create(await bootstrap());
  await dalService.connect(process.env.MONGO_URL);
});

after(async () => {
  await testServer.teardown();
  try {
    await dalService.destroy();
  } catch (e) {
    if (e.code !== 12586) {
      throw e;
    }
  }
});

afterEach(() => {
  sinon.restore();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - dalService(new DalService();

before(async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/.env.development
Tamaño: 197 bytes
Lenguaje detectado: DEVELOPMENT

### CONTENIDO ORIGINAL ###

NODE_ENV=dev
PORT=3003
MONGO_URL=mongodb://127.0.0.1:27017/novu-db

NEW_RELIC_ENABLED=true
NEW_RELIC_APP_NAME="[DEV] - WEBHOOK"
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
LOG_LEVEL=info


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=dev
PORT=3003
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
NEW_RELIC_ENABLED=true
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/src/.env.production
Tamaño: 218 bytes
Lenguaje detectado: PRODUCTION

### CONTENIDO ORIGINAL ###

NODE_ENV=production
PORT=3003
REDIS_PORT=6379
REDIS_DB_INDEX=2
WIDGET_BASE_URL=https://widget.novu.co

NEW_RELIC_ENABLED=true
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
LOG_LEVEL=info
MONGO_MIN_POOL_SIZE=50


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=production
PORT=3003
REDIS_PORT=6379
REDIS_DB_INDEX=2
WIDGET_BASE_URL=https://widget.novu.co
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/src/.env.test
Tamaño: 87 bytes
Lenguaje detectado: TEST

### CONTENIDO ORIGINAL ###

MONGO_URL=mongodb://127.0.0.1:27017/novu-test
PORT=1341
NODE_ENV=test

LOG_LEVEL=error


### ANALISIS AUTOMATICO (ESPAÑOL) ###

MONGO_URL=mongodb://127.0.0.1:27017/novu-test
PORT=1341
NODE_ENV=test
LOG_LEVEL=error
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/src/.example.env
Tamaño: 109 bytes
Lenguaje detectado: ENV

### CONTENIDO ORIGINAL ###

NODE_ENV=local
PORT=3003
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
MONGO_MAX_POOL_SIZE=500

LOG_LEVEL=info


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=local
PORT=3003
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
MONGO_MAX_POOL_SIZE=500
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/webhook/src/app.controller.ts
Tamaño: 274 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/app.module.ts
Tamaño: 1027 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';

import { createNestLoggingModuleOptions, LoggerModule, TracingModule } from '@novu/application-generic';
import { SentryModule } from '@sentry/nestjs/setup';
import packageJson from '../package.json';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { HealthModule } from './health/health.module';
import { SharedModule } from './shared/shared.module';
import { WebhooksModule } from './webhooks/webhooks.module';

const modules = [
  SharedModule,
  HealthModule,
  WebhooksModule,
  TracingModule.register(packageJson.name, packageJson.version),
  LoggerModule.forRoot(
    createNestLoggingModuleOptions({
      serviceName: packageJson.name,
      version: packageJson.version,
    })
  ),
];

const providers: any[] = [AppService];

if (process.env.SENTRY_DSN) {
  modules.unshift(SentryModule.forRoot());
}

@Module({
  imports: modules,
  exports: [],
  controllers: [AppController],
  providers,
})
export class AppModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/app.service.ts
Tamaño: 142 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  getHello(): string {
    return 'Hello World!';
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/bootstrap.ts
Tamaño: 728 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './instrument';
import { INestApplication } from '@nestjs/common';
import { NestFactory } from '@nestjs/core';
import { getErrorInterceptor, Logger } from '@novu/application-generic';

import { AppModule } from './app.module';

export async function bootstrap(): Promise<INestApplication> {
  const app = await NestFactory.create(AppModule, { bufferLogs: true });

  app.useLogger(app.get(Logger));
  app.flushLogs();

  app.useGlobalInterceptors(getErrorInterceptor());

  app.enableCors({
    origin: '*',
    preflightContinue: false,
    allowedHeaders: ['Content-Type', 'Authorization'],
    methods: ['GET', 'HEAD', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  });

  await app.listen(process.env.PORT);

  return app;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - bootstrap()
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/instrument.ts
Tamaño: 312 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './config/env.config';
import { init } from '@sentry/nestjs';
import { version } from '../package.json';

if (process.env.SENTRY_DSN) {
  init({
    dsn: process.env.SENTRY_DSN,
    environment: process.env.NODE_ENV,
    release: `v${version}`,
    ignoreErrors: ['Non-Error exception captured'],
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/main.ts
Tamaño: 55 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { bootstrap } from './bootstrap';

bootstrap();


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/config/env.config.ts
Tamaño: 325 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import path from 'node:path';
import { getContextPath, getEnvFileNameForNodeEnv, NovuComponentEnum } from '@novu/shared';
import dotenv from 'dotenv';

dotenv.config({ path: path.join(__dirname, '..', getEnvFileNameForNodeEnv(process.env.NODE_ENV)) });

export const CONTEXT_PATH = getContextPath(NovuComponentEnum.WEBHOOK);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/config/env.validators.ts
Tamaño: 779 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { StringifyEnv } from '@novu/shared';
import { bool, CleanedEnv, cleanEnv, num, port, str, ValidatorSpec } from 'envalid';

export function validateEnv() {
  return cleanEnv(process.env, envValidators);
}

export type ValidatedEnv = StringifyEnv<CleanedEnv<typeof envValidators>>;

export const envValidators = {
  MONGO_AUTO_CREATE_INDEXES: bool({ default: false }),
  MONGO_MAX_IDLE_TIME_IN_MS: num({ default: 1000 * 30 }),
  MONGO_MAX_POOL_SIZE: num({ default: 50 }),
  MONGO_MIN_POOL_SIZE: num({ default: 10 }),
  MONGO_URL: str(),
  NODE_ENV: str({ choices: ['dev', 'test', 'production', 'ci', 'local'], default: 'local' }),
  PORT: port(),
  SENTRY_DSN: str({ default: undefined }),
  TZ: str({ default: 'UTC' }),
} satisfies Record<string, ValidatorSpec<unknown>>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - validateEnv()
Declaraciones 'export' encontradas:
- export function validateEnv
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/health/health.controller.ts
Tamaño: 777 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Controller, Get } from '@nestjs/common';
import { HealthCheck, HealthCheckResult, HealthCheckService } from '@nestjs/terminus';
import { DalServiceHealthIndicator } from '@novu/application-generic';

import { version } from '../../package.json';

@Controller('v1/health-check')
export class HealthController {
  constructor(
    private healthCheckService: HealthCheckService,
    private dalHealthIndicator: DalServiceHealthIndicator
  ) {}

  @Get()
  @HealthCheck()
  async healthCheck(): Promise<HealthCheckResult> {
    const result = await this.healthCheckService.check([
      async () => ({
        apiVersion: {
          version,
          status: 'up',
        },
      }),
      () => this.dalHealthIndicator.isHealthy(),
    ]);

    return result;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - result(await this.healthCheckService.check([
      async ())
Declaraciones 'export' encontradas:
- export class HealthController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/health/health.module.ts
Tamaño: 438 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { TerminusModule } from '@nestjs/terminus';
import { DalServiceHealthIndicator } from '@novu/application-generic';
import { SharedModule } from '../shared/shared.module';
import { HealthController } from './health.controller';

@Module({
  imports: [SharedModule, TerminusModule],
  controllers: [HealthController],
  providers: [DalServiceHealthIndicator],
})
export class HealthModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HealthModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/shared/constants.ts
Tamaño: 41 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const DAL_SERVICE = 'DalService';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/shared/shared.module.ts
Tamaño: 883 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { AnalyticsService } from '@novu/application-generic';
import { DalService, ExecutionDetailsRepository, IntegrationRepository, MessageRepository } from '@novu/dal';

const DAL_MODELS = [ExecutionDetailsRepository, MessageRepository, IntegrationRepository];

const dalService = new DalService();

const PROVIDERS = [
  {
    provide: DalService,
    useFactory: async () => {
      await dalService.connect(process.env.MONGO_URL);

      return dalService;
    },
  },
  ...DAL_MODELS,
  {
    provide: AnalyticsService,
    useFactory: async () => {
      const analyticsService = new AnalyticsService(process.env.SEGMENT_TOKEN);

      await analyticsService.initialize();

      return analyticsService;
    },
  },
];

@Module({
  imports: [],
  providers: [...PROVIDERS],
  exports: [...PROVIDERS],
})
export class SharedModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - PROVIDERS([
  {
    provide: DalService,
    useFactory: async ())
Declaraciones 'export' encontradas:
- export class SharedModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/shared/framework/response.interceptor.ts
Tamaño: 1058 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CallHandler, ExecutionContext, Injectable, NestInterceptor } from '@nestjs/common';
import { instanceToPlain } from 'class-transformer';
import { isArray, isObject } from 'lodash';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';

export interface Response<T> {
  data: T;
}

@Injectable()
export class ResponseInterceptor<T> implements NestInterceptor<T, Response<T>> {
  intercept(context, next: CallHandler): Observable<Response<T>> {
    if (context.getType() === 'graphql') return next.handle();

    return next.handle().pipe(
      map((data) => {
        return {
          data: isObject(data) ? this.transformResponse(data) : data,
        };
      })
    );
  }

  private transformResponse(response) {
    if (isArray(response)) {
      return response.map((item) => this.transformToPlain(item));
    }

    return this.transformToPlain(response);
  }

  private transformToPlain(plainOrClass) {
    return plainOrClass && plainOrClass.constructor !== Object ? instanceToPlain(plainOrClass) : plainOrClass;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class ResponseInterceptor

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/shared/framework/user.decorator.ts
Tamaño: 1345 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createParamDecorator, UnauthorizedException } from '@nestjs/common';
import jwt from 'jsonwebtoken';

export const UserSession = createParamDecorator((data, ctx) => {
  let req;

  if (ctx.getType() === 'graphql') {
    req = ctx.getArgs()[2].req;
  } else {
    req = ctx.switchToHttp().getRequest();
  }

  if (req.user) return req.user;

  if (req.headers) {
    if (req.headers.authorization) {
      const tokenParts = req.headers.authorization.split(' ');

      if (tokenParts[0] !== 'Bearer') throw new UnauthorizedException('bad_token');
      if (!tokenParts[1]) throw new UnauthorizedException('bad_token');

      const user = jwt.decode(tokenParts[1]);

      return user;
    }
  }

  return null;
});

export const SubscriberSession = createParamDecorator((data, ctx) => {
  let req;

  if (ctx.getType() === 'graphql') {
    req = ctx.getArgs()[2].req;
  } else {
    req = ctx.switchToHttp().getRequest();
  }

  if (req.user) return req.user;
  if (req.headers) {
    if (req.headers.authorization) {
      const tokenParts = req.headers.authorization.split(' ');

      if (tokenParts[0] !== 'Bearer') throw new UnauthorizedException('bad_token');
      if (!tokenParts[1]) throw new UnauthorizedException('bad_token');

      const user = jwt.decode(tokenParts[1]);

      return user;
    }
  }

  return null;
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - UserSession(createParamDecorator((data, ctx))
 - SubscriberSession(createParamDecorator((data, ctx))
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/shared/helpers/regex.service.ts
Tamaño: 136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function escapeRegExp(text: string): string {
  if (!text) return text;

  return text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - escapeRegExp(text: string)
Declaraciones 'export' encontradas:
- export function escapeRegExp

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/types/env.d.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ValidatedEnv } from '../config';

declare global {
  namespace NodeJS {
    interface ProcessEnv extends ValidatedEnv {
      NODE_ENV: 'test' | 'production' | 'dev' | 'ci' | 'local';
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/webhooks.controller.ts
Tamaño: 1579 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Body, ClassSerializerInterceptor, Controller, Param, Post, UseInterceptors } from '@nestjs/common';

import { IWebhookResult } from './dtos/webhooks-response.dto';
import { WebhookCommand } from './usecases/webhook/webhook.command';
import { Webhook } from './usecases/webhook/webhook.usecase';

@Controller('/webhooks')
@UseInterceptors(ClassSerializerInterceptor)
export class WebhooksController {
  constructor(private webhookUsecase: Webhook) {}

  @Post('/organizations/:organizationId/environments/:environmentId/email/:providerOrIntegrationId')
  public emailWebhook(
    @Param('organizationId') organizationId: string,
    @Param('environmentId') environmentId: string,
    @Param('providerOrIntegrationId') providerOrIntegrationId: string,
    @Body() body: any
  ): Promise<IWebhookResult[]> {
    return this.webhookUsecase.execute(
      WebhookCommand.create({
        environmentId,
        organizationId,
        providerOrIntegrationId,
        body,
        type: 'email',
      })
    );
  }

  @Post('/organizations/:organizationId/environments/:environmentId/sms/:providerOrIntegrationId')
  public smsWebhook(
    @Param('organizationId') organizationId: string,
    @Param('environmentId') environmentId: string,
    @Param('providerOrIntegrationId') providerOrIntegrationId: string,
    @Body() body: any
  ): Promise<IWebhookResult[]> {
    return this.webhookUsecase.execute(
      WebhookCommand.create({
        environmentId,
        organizationId,
        providerOrIntegrationId,
        body,
        type: 'sms',
      })
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebhooksController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/webhooks.module.ts
Tamaño: 489 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MiddlewareConsumer, Module, NestModule } from '@nestjs/common';
import { SharedModule } from '../shared/shared.module';
import { USE_CASES } from './usecases';
import { WebhooksController } from './webhooks.controller';

@Module({
  imports: [SharedModule],
  providers: [...USE_CASES],
  exports: [...USE_CASES],
  controllers: [WebhooksController],
})
export class WebhooksModule implements NestModule {
  configure(consumer: MiddlewareConsumer): MiddlewareConsumer | void {}
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebhooksModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/dtos/webhooks-response.dto.ts
Tamaño: 118 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IEventBody } from '@novu/stateless';

export interface IWebhookResult {
  id: string;
  event: IEventBody;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/e2e/email-webhook.e2e.ts
Tamaño: 9015 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExecutionDetailsRepository, IntegrationRepository, MessageRepository } from '@novu/dal';
import { ChannelTypeEnum, ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';
import { IEmailEventBody } from '@novu/stateless';
import axios from 'axios';
import { expect } from 'chai';

const axiosInstance = axios.create();

const callWebhook = async (
  environmentId: string,
  organizationId: string,
  webhookBody: object,
  providerOrIntegrationId = 'sendgrid'
) => {
  const serverUrl = `http://127.0.0.1:${process.env.PORT}`;

  const { data, status } = await axiosInstance.post(
    `${serverUrl}/webhooks/organizations/${organizationId}/environments/${environmentId}/email/${providerOrIntegrationId}`,
    webhookBody
  );

  return { data, status };
};

describe('Email webhook - /organizations/:organizationId/environments/:environmentId/email/:providerId (POST)', () => {
  const messageRepository = new MessageRepository();
  const integrationRepository = new IntegrationRepository();

  it('should handle webhook', async () => {
    const envId = MessageRepository.createObjectId();
    const orgId = MessageRepository.createObjectId();
    const id = MessageRepository.createObjectId();

    const message = await messageRepository.create({
      _id: id,
      _notificationId: MessageRepository.createObjectId(),
      _environmentId: envId,
      _organizationId: orgId,
      _subscriberId: MessageRepository.createObjectId(),
      _templateId: MessageRepository.createObjectId(),
      _messageTemplateId: MessageRepository.createObjectId(),
      channel: ChannelTypeEnum.EMAIL,
      _feedId: MessageRepository.createObjectId(),
      transactionId: MessageRepository.createObjectId(),
      content: '',
      payload: {},
      templateIdentifier: '',
      identifier: id,
    });

    await integrationRepository.create({
      _environmentId: envId,
      _organizationId: orgId,
      providerId: 'sendgrid',
      channel: ChannelTypeEnum.EMAIL,
      credentials: {
        apiKey: 'SG.123',
      },
      active: true,
    });

    const webhookBody = {
      email: 'example@test.com',
      timestamp: 1513299569,
      'smtp-id': '<14c5d75ce93.dfd.64b469@ismtpd-555>',
      event: 'delivered',
      ip: '168.1.1.1',
      category: 'cat facts',
      sg_event_id: 'sg_event_id',
      sg_message_id: 'sg_message_id',
      response: '400 try again later',
      attempt: '5',
      id: message._id,
    };

    const { data } = await callWebhook(envId, orgId, webhookBody);

    const { event } = data[0];
    expect(data[0].id).to.equal(webhookBody.id);
    expect(event.externalId).to.equal(webhookBody.id);
    expect(event.attempts).to.equal(5);
    expect(event.response).to.equal('400 try again later');
    expect(event.row).to.eql(webhookBody);
  });

  it('should allow calling webhook with the integrationId', async () => {
    const envId = MessageRepository.createObjectId();
    const orgId = MessageRepository.createObjectId();
    const id = MessageRepository.createObjectId();

    const message = await messageRepository.create({
      _id: id,
      _notificationId: MessageRepository.createObjectId(),
      _environmentId: envId,
      _organizationId: orgId,
      _subscriberId: MessageRepository.createObjectId(),
      _templateId: MessageRepository.createObjectId(),
      _messageTemplateId: MessageRepository.createObjectId(),
      channel: ChannelTypeEnum.EMAIL,
      _feedId: MessageRepository.createObjectId(),
      transactionId: MessageRepository.createObjectId(),
      content: '',
      payload: {},
      templateIdentifier: '',
      identifier: id,
    });

    const sendgridIntegration = await integrationRepository.create({
      _environmentId: envId,
      _organizationId: orgId,
      providerId: 'sendgrid',
      channel: ChannelTypeEnum.EMAIL,
      credentials: {
        apiKey: 'SG.123',
      },
      active: true,
    });

    const webhookBody = {
      email: 'example@test.com',
      timestamp: 1513299569,
      'smtp-id': '<14c5d75ce93.dfd.64b469@ismtpd-555>',
      event: 'delivered',
      ip: '168.1.1.1',
      category: 'cat facts',
      sg_event_id: 'sg_event_id',
      sg_message_id: 'sg_message_id',
      response: 'success',
      attempt: '5',
      id: message._id,
    };

    const { data } = await callWebhook(envId, orgId, webhookBody, sendgridIntegration._id);

    const { event } = data[0];
    expect(data[0].id).to.equal(webhookBody.id);
    expect(event.externalId).to.equal(webhookBody.id);
    expect(event.attempts).to.equal(5);
    expect(event.response).to.equal(webhookBody.response);
    expect(event.row).to.eql(webhookBody);
  });

  it("should throw bad request error when integration doesn't have credentials configured", async () => {
    const envId = MessageRepository.createObjectId();
    const orgId = MessageRepository.createObjectId();

    const sendgridIntegration = await integrationRepository.create({
      _environmentId: envId,
      _organizationId: orgId,
      providerId: 'sendgrid',
      channel: ChannelTypeEnum.EMAIL,
      active: true,
    });

    const webhookBody = {};

    try {
      await callWebhook(envId, orgId, webhookBody, sendgridIntegration._id);
      expect.fail();
    } catch (error) {
      expect(error).to.be.ok;
      expect(error.response.status).to.equal(400);
      expect(error.response.data.message).to.equal(
        `Integration ${sendgridIntegration._id} doesn't have credentials set up`
      );
    }
  });

  it("should throw not found error when integration doesn't exist", async () => {
    const envId = MessageRepository.createObjectId();
    const orgId = MessageRepository.createObjectId();
    const notExistingIntegrationId = MessageRepository.createObjectId();

    const webhookBody = {};

    try {
      await callWebhook(envId, orgId, webhookBody, notExistingIntegrationId);
      expect.fail();
    } catch (error) {
      expect(error).to.be.ok;
      expect(error.response.status).to.equal(404);
      expect(error.response.data.message).to.equal(`Integration for ${notExistingIntegrationId} was not found`);
    }
  });

  it('should create execution details after processing the response of a webhook', async () => {
    const environmentId = MessageRepository.createObjectId();
    const id = MessageRepository.createObjectId();
    const messageTemplateId = MessageRepository.createObjectId();
    const notificationId = MessageRepository.createObjectId();
    const organizationId = MessageRepository.createObjectId();
    const providerId = 'sendgrid';
    const subscriberId = MessageRepository.createObjectId();
    const templateId = MessageRepository.createObjectId();
    const transactionId = MessageRepository.createObjectId();

    const message = await messageRepository.create({
      _id: id,
      _notificationId: notificationId,
      _environmentId: environmentId,
      _organizationId: organizationId,
      _subscriberId: subscriberId,
      _templateId: templateId,
      _messageTemplateId: messageTemplateId,
      channel: ChannelTypeEnum.EMAIL,
      _feedId: MessageRepository.createObjectId(),
      transactionId,
      content: '',
      payload: {},
      templateIdentifier: '',
      identifier: id,
    });

    await integrationRepository.create({
      _environmentId: environmentId,
      _organizationId: organizationId,
      providerId,
      channel: ChannelTypeEnum.EMAIL,
      credentials: {
        apiKey: '',
      },
      active: true,
    });

    const webhookBody = {
      email: 'example@test.com',
      timestamp: 1513299569,
      'smtp-id': '<14c5d75ce93.dfd.64b469@ismtpd-555>',
      event: 'delivered',
      ip: '168.1.1.1',
      category: 'cat facts',
      sg_event_id: 'sg_event_id',
      sg_message_id: 'sg_message_id',
      response: '400 try again later',
      attempt: '5',
      id: message._id,
    };

    await callWebhook(environmentId, organizationId, webhookBody);

    const executionDetailsRepository = new ExecutionDetailsRepository();
    const [executionDetails] = await executionDetailsRepository.find({
      _environmentId: environmentId,
      _organizationId: organizationId,
      _notificationId: notificationId,
      providerId,
    });

    const expectedObject = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      _notificationId: notificationId,
      _notificationTemplateId: templateId,
      _subscriberId: subscriberId,
      providerId,
      transactionId,
      detail: '400 try again later - (delivered)',
      source: ExecutionDetailsSourceEnum.WEBHOOK,
      status: ExecutionDetailsStatusEnum.SUCCESS,
      isTest: false,
      isRetry: false,
    };

    expect(executionDetails).to.exist;
    expect(executionDetails).to.have.property('_id');
    expect(executionDetails).to.have.property('createdAt');
    expect(executionDetails).to.have.property('updatedAt');
    expect(executionDetails).to.contain(expectedObject);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - providerOrIntegrationId('sendgrid'
))
 - integrationRepository(new IntegrationRepository();

  it('should handle webhook', async ())
 - webhookBody({};

    try {
      await callWebhook(envId, orgId, webhookBody, sendgridIntegration._id);
      ex...)
 - webhookBody({};

    try {
      await callWebhook(envId, orgId, webhookBody, notExistingIntegrationId);
      e...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/interfaces/webhook.interface.ts
Tamaño: 44 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type WebhookTypes = 'sms' | 'email';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/usecases/index.ts
Tamaño: 209 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CreateExecutionDetails } from './execution-details/create-execution-details.usecase';
import { Webhook } from './webhook/webhook.usecase';

export const USE_CASES = [CreateExecutionDetails, Webhook];


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/usecases/execution-details/create-execution-details.command.ts
Tamaño: 722 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentCommand } from '@novu/application-generic';
import { MessageEntity } from '@novu/dal';
import { ChannelTypeEnum } from '@novu/shared';
import { IsDefined } from 'class-validator';
import { IWebhookResult } from '../../dtos/webhooks-response.dto';
import { WebhookTypes } from '../../interfaces/webhook.interface';

export class CreateExecutionDetailsCommand {
  @IsDefined()
  webhook: WebhookCommand;

  @IsDefined()
  message: MessageEntity;

  @IsDefined()
  webhookEvent: IWebhookResult;

  @IsDefined()
  channel: ChannelTypeEnum;
}

export class WebhookCommand extends EnvironmentCommand {
  @IsDefined()
  providerId: string;

  @IsDefined()
  body: any;

  @IsDefined()
  type: WebhookTypes;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateExecutionDetailsCommand
- export class WebhookCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/usecases/execution-details/create-execution-details.usecase.ts
Tamaño: 4790 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { ExecutionDetailsEntity, ExecutionDetailsRepository, MessageEntity } from '@novu/dal';
import { ChannelTypeEnum, ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';

import { EmailEventStatusEnum, SmsEventStatusEnum } from '@novu/stateless';
import { IWebhookResult } from '../../dtos/webhooks-response.dto';
import { CreateExecutionDetailsCommand, WebhookCommand } from './create-execution-details.command';

const LOG_CONTEXT = 'CreateExecutionDetails';

@Injectable()
export class CreateExecutionDetails {
  constructor(private executionDetailsRepository: ExecutionDetailsRepository) {}

  async execute(command: CreateExecutionDetailsCommand): Promise<void> {
    const executionDetailsEntity = this.mapWebhookEventIntoEntity(
      command.webhook,
      command.message,
      command.webhookEvent,
      command.channel
    );

    Logger.verbose({ executionDetailsEntity }, 'Creating execution details', LOG_CONTEXT);

    await this.executionDetailsRepository.create(executionDetailsEntity, { writeConcern: 1 });

    Logger.verbose({ executionDetailsEntity }, 'Created execution details', LOG_CONTEXT);
  }

  private mapWebhookEventIntoEntity(
    webhook: WebhookCommand,
    message: MessageEntity,
    webhookEvent: IWebhookResult,
    channel: ChannelTypeEnum
  ): Omit<ExecutionDetailsEntity, '_id' | 'createdAt'> {
    const { environmentId: _environmentId, organizationId: _organizationId, providerId, type } = webhook;
    const { _jobId, _templateId, _notificationId, _subscriberId, transactionId, _id } = message;
    const { externalId, attempts, response, row, status } = webhookEvent.event;

    return {
      _jobId,
      _environmentId,
      _organizationId,
      _subscriberId,
      _notificationId,
      _messageId: _id,
      _notificationTemplateId: _templateId,
      providerId,
      transactionId,
      status: this.mapStatus(status as EmailEventStatusEnum | SmsEventStatusEnum, channel),
      detail: `${response} - (${status})`,
      source: ExecutionDetailsSourceEnum.WEBHOOK,
      raw: JSON.stringify(row),
      isRetry: false,
      isTest: false,
      webhookStatus: status,
    };
  }

  private mapStatus(
    eventStatus: EmailEventStatusEnum | SmsEventStatusEnum,
    channel: ChannelTypeEnum
  ): ExecutionDetailsStatusEnum {
    switch (channel) {
      case ChannelTypeEnum.EMAIL:
        return this.mapEmailStatus(eventStatus as EmailEventStatusEnum);
      case ChannelTypeEnum.SMS:
        return this.mapSmsStatus(eventStatus as SmsEventStatusEnum);
      default:
        return ExecutionDetailsStatusEnum.SUCCESS;
    }
  }

  private mapEmailStatus(eventStatus: EmailEventStatusEnum): ExecutionDetailsStatusEnum {
    switch (eventStatus) {
      case EmailEventStatusEnum.OPENED:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case EmailEventStatusEnum.REJECTED:
        return ExecutionDetailsStatusEnum.FAILED;
      case EmailEventStatusEnum.SENT:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case EmailEventStatusEnum.DEFERRED:
        return ExecutionDetailsStatusEnum.PENDING;
      case EmailEventStatusEnum.DELIVERED:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case EmailEventStatusEnum.BOUNCED:
        return ExecutionDetailsStatusEnum.FAILED;
      case EmailEventStatusEnum.DROPPED:
        return ExecutionDetailsStatusEnum.FAILED;
      case EmailEventStatusEnum.CLICKED:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case EmailEventStatusEnum.BLOCKED:
        return ExecutionDetailsStatusEnum.FAILED;
      case EmailEventStatusEnum.SPAM:
        return ExecutionDetailsStatusEnum.FAILED;
      case EmailEventStatusEnum.UNSUBSCRIBED:
        return ExecutionDetailsStatusEnum.FAILED;
      default:
        return ExecutionDetailsStatusEnum.SUCCESS;
    }
  }

  private mapSmsStatus(eventStatus: SmsEventStatusEnum): ExecutionDetailsStatusEnum {
    switch (eventStatus) {
      case SmsEventStatusEnum.CREATED:
        return ExecutionDetailsStatusEnum.PENDING;
      case SmsEventStatusEnum.DELIVERED:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case SmsEventStatusEnum.ACCEPTED:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case SmsEventStatusEnum.QUEUED:
        return ExecutionDetailsStatusEnum.QUEUED;
      case SmsEventStatusEnum.SENDING:
        return ExecutionDetailsStatusEnum.PENDING;
      case SmsEventStatusEnum.SENT:
        return ExecutionDetailsStatusEnum.SUCCESS;
      case SmsEventStatusEnum.FAILED:
        return ExecutionDetailsStatusEnum.FAILED;
      case SmsEventStatusEnum.UNDELIVERED:
        return ExecutionDetailsStatusEnum.FAILED;
      default:
        return ExecutionDetailsStatusEnum.SUCCESS;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateExecutionDetails

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/usecases/webhook/webhook.command.ts
Tamaño: 354 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentCommand } from '@novu/application-generic';
import { IsDefined } from 'class-validator';

import { WebhookTypes } from '../../interfaces/webhook.interface';

export class WebhookCommand extends EnvironmentCommand {
  @IsDefined()
  providerOrIntegrationId: string;

  @IsDefined()
  body: any;

  @IsDefined()
  type: WebhookTypes;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebhookCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/webhook/src/webhooks/usecases/webhook/webhook.usecase.ts
Tamaño: 5570 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, Logger, NotFoundException, Scope } from '@nestjs/common';
import { AnalyticsService, IMailHandler, ISmsHandler, MailFactory, SmsFactory } from '@novu/application-generic';
import { IntegrationEntity, IntegrationQuery, IntegrationRepository, MessageRepository } from '@novu/dal';
import { ChannelTypeEnum, providers } from '@novu/shared';
import { IEmailProvider, ISmsProvider } from '@novu/stateless';
import { IWebhookResult } from '../../dtos/webhooks-response.dto';
import { WebhookTypes } from '../../interfaces/webhook.interface';
import { CreateExecutionDetails } from '../execution-details/create-execution-details.usecase';
import { WebhookCommand } from './webhook.command';

@Injectable({ scope: Scope.REQUEST })
export class Webhook {
  public readonly mailFactory = new MailFactory();
  public readonly smsFactory = new SmsFactory();
  private provider: IEmailProvider | ISmsProvider;

  constructor(
    private createExecutionDetails: CreateExecutionDetails,
    private integrationRepository: IntegrationRepository,
    private messageRepository: MessageRepository,
    private analyticsService: AnalyticsService
  ) {}

  async execute(command: WebhookCommand): Promise<IWebhookResult[]> {
    const { providerOrIntegrationId } = command;
    const isProviderId = !!providers.find((el) => el.id === providerOrIntegrationId);
    const channel: ChannelTypeEnum = command.type === 'email' ? ChannelTypeEnum.EMAIL : ChannelTypeEnum.SMS;

    const query: IntegrationQuery = {
      ...(isProviderId
        ? { providerId: providerOrIntegrationId, credentials: { $exists: true }, channel }
        : { _id: providerOrIntegrationId }),
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
    };

    const integration: IntegrationEntity = await this.integrationRepository.findOne(query);
    if (!integration) {
      throw new NotFoundException(`Integration for ${providerOrIntegrationId} was not found`);
    }

    const hasNoCredentials = !integration.credentials || Object.keys(integration.credentials).length === 0;
    if (hasNoCredentials) {
      throw new BadRequestException(`Integration ${integration._id} doesn't have credentials set up`);
    }

    this.analyticsService.track('[Webhook] - Provider Webhook called', '', {
      _organization: command.organizationId,
      _environmentId: command.environmentId,
      providerId: integration.providerId,
      channel,
    });

    this.createProvider(integration, command.type);

    if (!this.provider.getMessageId || !this.provider.parseEventBody) {
      throw new NotFoundException(`Provider with ${integration.providerId} can not handle webhooks`);
    }

    const events = await this.parseEvents(command, integration.providerId, channel);

    this.analyticsService.track('[Webhook] - Provider Webhook events parsed', '', {
      _organization: command.organizationId,
      _environmentId: command.environmentId,
      providerId: integration.providerId,
      channel,
      events,
    });

    return events;
  }

  private async parseEvents(
    command: WebhookCommand,
    providerId: string,
    channel: ChannelTypeEnum
  ): Promise<IWebhookResult[]> {
    const { body } = command;
    const messageIdentifiers: string[] = this.provider.getMessageId(body);

    const events: IWebhookResult[] = [];

    for (const messageIdentifier of messageIdentifiers) {
      const event = await this.parseEvent(messageIdentifier, command, providerId, channel);

      if (event === undefined) {
        continue;
      }

      events.push(event);
    }

    return events;
  }

  private async parseEvent(
    messageIdentifier: string,
    command: WebhookCommand,
    providerId: string,
    channel: ChannelTypeEnum
  ): Promise<IWebhookResult | undefined> {
    const message = await this.messageRepository.findOne({
      identifier: messageIdentifier,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
    });

    if (!message) {
      Logger.error(`Message with ${messageIdentifier} as identifier was not found`);

      return;
    }

    const event = this.provider.parseEventBody(command.body, messageIdentifier);

    if (event === undefined) {
      return undefined;
    }

    const parsedEvent = {
      id: messageIdentifier,
      event,
    };

    /**
     * TODO: Individually performing the creation of the execution details because here we can pass message that contains
     * most of the __foreign keys__ we need. But we can't take advantage of a bulk write of all events. Besides the writing
     * being hiding inside auxiliary methods of the use case.
     */
    await this.createExecutionDetails.execute({
      message,
      webhook: {
        ...command,
        providerId,
      },
      webhookEvent: parsedEvent,
      channel,
    });

    return parsedEvent;
  }

  private getHandler(integration: IntegrationEntity, type: WebhookTypes): ISmsHandler | IMailHandler | null {
    switch (type) {
      case 'sms':
        return this.smsFactory.getHandler(integration);
      default:
        return this.mailFactory.getHandler(integration);
    }
  }

  private createProvider(integration: IntegrationEntity, type: 'sms' | 'email') {
    const handler = this.getHandler(integration, type);
    if (!handler) {
      throw new NotFoundException(`Handler for integration of ${integration.providerId} was not found`);
    }
    handler.buildProvider(integration.credentials);

    this.provider = handler.getProvider();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - isProviderId(!!providers.find((el))
Declaraciones 'export' encontradas:
- export class Webhook

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/.gitignore
Tamaño: 2015 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.idea
.build

# Runtime data
pids
*.pid
*.seed
*.pid.lock

dist
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov


# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea/**/*/workspace.xml
.idea/**/*/tasks.xml
.idea/**/*/dictionaries
.idea/**/*/shelf

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests

.serverless
newrelic_agent.log


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/.mocharc.json
Tamaño: 155 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "timeout": 10000,
  "require": "ts-node/register",
  "file": ["e2e/setup.ts"],
  "exit": true,
  "files": ["src/**/*.e2e.ts", "src/**/**/*.spec.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"timeout": 10000,
"require": "ts-node/register",
"file": ["e2e/setup.ts"],
"exit": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/Dockerfile
Tamaño: 2546 bytes
Lenguaje detectado: DOCKERFILE

### CONTENIDO ORIGINAL ###

FROM node:20-alpine3.19 AS dev_base
RUN apk --update --no-cache add curl g++ make py3-pip
ENV NX_DAEMON=false


RUN npm i pm2 -g
RUN npm --no-update-notifier --no-fund --global install pnpm@10.16.1
RUN pnpm --version


USER 1000
WORKDIR /usr/src/app

# ------- DEV BUILD ----------
FROM dev_base AS dev
ARG PACKAGE_PATH

COPY --chown=1000:1000 ./meta .
COPY --chown=1000:1000 ./deps .
COPY --chown=1000:1000 ./pkg .

RUN --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && \
    if [ -n "${BULL_MQ_PRO_NPM_TOKEN}" ] ; then echo 'Building with Enterprise Edition of Novu'; rm -f .npmrc ; cp .npmrc-cloud .npmrc ; fi

RUN --mount=type=cache,id=pnpm-store-worker,target=/root/.pnpm-store\
    --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && \
 pnpm install --filter "novuhq" --filter "{${PACKAGE_PATH}}..."\
 --frozen-lockfile\
 --unsafe-perm\
 --reporter=silent

RUN --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && NODE_ENV=production NX_DAEMON=false pnpm build:worker

WORKDIR /usr/src/app/apps/worker

RUN cp src/dotenvcreate.mjs dist/dotenvcreate.mjs
RUN cp src/.example.env dist/.env
RUN cp src/.env.test dist/.env.test
RUN cp src/.env.development dist/.env.development
RUN cp src/.env.production dist/.env.production

WORKDIR /usr/src/app

# ------- ASSETS BUILD ----------
FROM dev AS assets

WORKDIR /usr/src/app

# Remove all dependencies so later we can only install prod dependencies without devDependencies
RUN rm -rf node_modules && pnpm recursive exec -- rm -rf ./src ./node_modules

# ------- PRODUCTION BUILD ----------
FROM dev_base AS prod
ARG PACKAGE_PATH

ENV CI=true

WORKDIR /usr/src/app

COPY --chown=1000:1000 ./meta .

# Get the build artifacts that only include dist folders
COPY --chown=1000:1000 --from=assets /usr/src/app .

RUN --mount=type=cache,id=pnpm-store-worker,target=/root/.pnpm-store\
    --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && \
 pnpm install --filter "{${PACKAGE_PATH}}..." \
 --frozen-lockfile \
 --unsafe-perm \
 --reporter=silent

ENV NEW_RELIC_NO_CONFIG_FILE=true

WORKDIR /usr/src/app/apps/worker
ENTRYPOINT [ "sh", "-c", "node dist/dotenvcreate.mjs -s=$SECRET_NAME -r=$NOVU_REGION -e=$NOVU_ENTERPRISE -v=$NODE_ENV -h=$IS_SELF_HOSTED && pm2-runtime start dist/main.js -i max" ]


### ANALISIS AUTOMATICO (ESPAÑOL) ###

FROM node:20-alpine3.19 AS dev_base
RUN apk --update --no-cache add curl g++ make py3-pip
ENV NX_DAEMON=false
# ------- DEV BUILD ----------
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/README.md
Tamaño: 3427 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo_text.svg" width="320" alt="Nest Logo" /></a>
</p>

[travis-image]: https://api.travis-ci.org/nestjs/nest.svg?branch=main
[travis-url]: https://travis-ci.org/nestjs/nest
[linux-image]: https://img.shields.io/travis/nestjs/nest/master.svg?label=linux
[linux-url]: https://travis-ci.org/nestjs/nest

  <p align="center">A progressive <a href="http://nodejs.org" target="blank">Node.js</a> framework for building efficient and scalable server-side applications, heavily inspired by <a href="https://angular.io" target="blank">Angular</a>.</p>
  <p align="center">
<a href="https://www.npmjs.com/~nestjscore"><img src="https://img.shields.io/npm/v/@nestjs/core.svg" alt="NPM Version" /></a>
<a href="https://www.npmjs.com/~nestjscore"><img src="https://img.shields.io/npm/l/@nestjs/core.svg" alt="Package License" /></a>
<a href="https://www.npmjs.com/~nestjscore"><img src="https://img.shields.io/npm/dm/@nestjs/core.svg" alt="NPM Downloads" /></a>
<a href="https://travis-ci.org/nestjs/nest"><img src="https://api.travis-ci.org/nestjs/nest.svg?branch=master" alt="Travis" /></a>
<a href="https://travis-ci.org/nestjs/nest"><img src="https://img.shields.io/travis/nestjs/nest/master.svg?label=linux" alt="Linux" /></a>
<a href="https://coveralls.io/github/nestjs/nest?branch=master"><img src="https://coveralls.io/repos/github/nestjs/nest/badge.svg?branch=master#5" alt="Coverage" /></a>
<a href="https://gitter.im/nestjs/nestjs?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=body_badge"><img src="https://badges.gitter.im/nestjs/nestjs.svg" alt="Gitter" /></a>
<a href="https://opencollective.com/nest#backer"><img src="https://opencollective.com/nest/backers/badge.svg" alt="Backers on Open Collective" /></a>
<a href="https://opencollective.com/nest#sponsor"><img src="https://opencollective.com/nest/sponsors/badge.svg" alt="Sponsors on Open Collective" /></a>
  <a href="https://paypal.me/kamilmysliwiec"><img src="https://img.shields.io/badge/Donate-PayPal-dc3d53.svg"/></a>
  <a href="https://twitter.com/nestframework"><img src="https://img.shields.io/twitter/follow/nestframework.svg?style=social&label=Follow"></a>
</p>
  <!--[![Backers on Open Collective](https://opencollective.com/nest/backers/badge.svg)](https://opencollective.com/nest#backer)
  [![Sponsors on Open Collective](https://opencollective.com/nest/sponsors/badge.svg)](https://opencollective.com/nest#sponsor)-->

## Description

[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

## Installation

```bash
$ npm install
```

## Running the app

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# incremental rebuild (webpack)
$ npm run webpack
$ npm run start:hmr

# production mode
$ npm run start:prod
```

## Test

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Support

Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).

## Stay in touch

- Author - [Kamil Myśliwiec](https://kamilmysliwiec.com)
- Website - [https://nestjs.com](https://nestjs.com/)
- X - [@nestframework](https://twitter.com/nestframework)

## License

Nest is [MIT licensed](LICENSE).


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<p align="center">
<a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo_text.svg" width="320" alt="Nest Logo" /></a>
</p>
[travis-image]: https://api.travis-ci.org/nestjs/nest.svg?branch=main
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/nest-cli.json
Tamaño: 626 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "typeCheck": true,
    "deleteOutDir": true,
    "builder": {
      "type": "swc",
      "options": {
        "stripLeadingPaths": true
      }
    },
    "assets": [
      {
        "include": ".env",
        "outDir": "dist"
      },
      {
        "include": ".env.development",
        "outDir": "dist"
      },
      {
        "include": ".env.test",
        "outDir": "dist"
      },
      {
        "include": ".env.production",
        "outDir": "dist"
      }
    ]
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"$schema": "https://json.schemastore.org/nest-cli",
"collection": "@nestjs/schematics",
"sourceRoot": "src",
"compilerOptions": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/package.json
Tamaño: 3642 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/worker",
  "version": "3.9.0",
  "description": "description",
  "author": "",
  "private": "true",
  "license": "MIT",
  "scripts": {
    "prebuild": "rimraf dist",
    "build": "nest build",
    "docker:build": "pnpm --silent --workspace-root pnpm-context -- apps/worker/Dockerfile | BULL_MQ_PRO_NPM_TOKEN=${BULL_MQ_PRO_NPM_TOKEN} docker buildx build --secret id=BULL_MQ_PRO_NPM_TOKEN --build-arg PACKAGE_PATH=apps/worker - -t novu-worker --load $DOCKER_BUILD_ARGUMENTS",
    "docker:build:depot": "pnpm --silent --workspace-root pnpm-context -- apps/worker/Dockerfile | depot build --build-arg PACKAGE_PATH=apps/worker - -t novu-worker --load",
    "start": "pnpm start:dev",
    "start:dev": "nest start --watch",
    "start:test": "cross-env NODE_ENV=test nest start",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main.js",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file e2e/setup.ts src/**/**/*.spec.ts",
    "test:e2e": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file e2e/setup.ts src/**/*.e2e.ts"
  },
  "dependencies": {
    "@aws-sdk/client-secrets-manager": "^3.716.0",
    "@nestjs/axios": "3.0.3",
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/platform-express": "10.4.18",
    "@nestjs/schedule": "^4.1.1",
    "@nestjs/swagger": "7.4.0",
    "@nestjs/terminus": "10.2.3",
    "@novu/application-generic": "workspace:*",
    "@novu/dal": "workspace:*",
    "@novu/framework": "workspace:*",
    "@novu/shared": "workspace:*",
    "@novu/stateless": "workspace:*",
    "@novu/testing": "workspace:*",
    "@sentry/browser": "^8.33.1",
    "@sentry/hub": "^7.114.0",
    "@sentry/nestjs": "^8.33.1",
    "@sentry/node": "^8.33.1",
    "@sentry/profiling-node": "^8.33.1",
    "@sentry/tracing": "^7.40.0",
    "@types/newrelic": "^9.14.6",
    "svix": "^1.64.1",
    "axios": "^1.9.0",
    "body-parser": "^2.2.0",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "cron-parser": "^4.9.0",
    "cross-env": "^7.0.3",
    "date-fns": "^2.29.2",
    "date-fns-tz": "^2.0.1",
    "dotenv": "^16.4.5",
    "envalid": "^8.0.0",
    "helmet": "^6.0.1",
    "i18next": "^23.7.6",
    "inline-css": "^4.0.2",
    "ioredis": "^5.2.4",
    "lodash": "^4.17.15",
    "nest-raven": "10.1.0",
    "newrelic": "^12.25.0",
    "reflect-metadata": "0.2.2",
    "rimraf": "^3.0.2",
    "rxjs": "7.8.1",
    "shortid": "^2.2.16",
    "simple-statistics": "^7.8.3",
    "uuid": "^8.3.2"
  },
  "devDependencies": {
    "@faker-js/faker": "^6.0.0",
    "@nestjs/cli": "10.4.5",
    "@nestjs/schematics": "10.1.4",
    "@nestjs/testing": "10.4.18",
    "@types/bcrypt": "^3.0.0",
    "@types/chai": "^4.2.11",
    "@types/express": "4.17.17",
    "@types/inline-css": "^3.0.3",
    "@types/mocha": "^10.0.2",
    "@types/node": "^20.15.0",
    "@types/sinon": "^9.0.0",
    "@types/supertest": "^2.0.8",
    "chai": "^4.2.0",
    "mocha": "^10.2.0",
    "sinon": "^9.2.4",
    "superagent-defaults": "^0.1.14",
    "supertest": "^7.0.0",
    "ts-loader": "~9.4.0",
    "ts-node": "~10.9.1",
    "tsconfig-paths": "~4.1.0",
    "typescript": "5.6.2"
  },
  "optionalDependencies": {
    "@novu/ee-billing": "workspace:*",
    "@novu/ee-shared-services": "workspace:*",
    "@novu/ee-translation": "workspace:*"
  },
  "nx": {
    "tags": [
      "type:app"
    ]
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/worker",
"version": "3.9.0",
"description": "description",
"author": "",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/project.json
Tamaño: 694 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/worker",
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "tags": ["type:app"],
  "sourceRoot": "apps/worker/src",
  "projectType": "application",
  "targets": {
    "build": {
      "cache": true,
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint apps/worker"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/worker",
"$schema": "../../node_modules/nx/schemas/project-schema.json",
"tags": ["type:app"],
"sourceRoot": "apps/worker/src",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/tsconfig.build.json
Tamaño: 576 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "declaration": true,
    "noImplicitAny": false,
    "removeComments": true,
    "allowSyntheticDefaultImports": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "strictNullChecks": true,
    "target": "es6",
    "esModuleInterop": false,
    "sourceMap": true,
    "outDir": "./dist",
    "baseUrl": "./src",
    "types": ["node", "mocha"]
  },
  "include": ["src/**/*", "src/**/*.d.ts"],
  "exclude": ["node_modules", "**/*.spec.ts", "**/*.e2e.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"module": "commonjs",
"declaration": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/tsconfig.json
Tamaño: 357 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "module": "commonjs",
    "sourceMap": true,
    "allowSyntheticDefaultImports": true,
    "emitDecoratorMetadata": true,
    "types": ["node", "mocha"],
    "target": "es2017",
    "allowJs": false,
    "esModuleInterop": true,
    "declarationMap": true
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/tsconfig.spec.json
Tamaño: 162 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "apps/api/tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "types": ["node", "mocha"],
    "esModuleInterop": false
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "apps/api/tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"types": ["node", "mocha"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/webpack.config.js
Tamaño: 76 bytes
Lenguaje detectado: JavaScript

### CONTENIDO ORIGINAL ###

module.exports = (options) => ({
  ...options,
  devtool: 'source-map',
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - exports(options))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/.vscode/settings.json
Tamaño: 237 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "mochaExplorer.configFile": ".mocharc.json",
  "mochaExplorer.files": ["e2e/setup.ts", "src/**/*.e2e.ts", "src/**/**/*.spec.ts"],
  "mochaExplorer.require": ["ts-node/register"],
  "mochaExplorer.env": {
    "NODE_ENV": "test"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"mochaExplorer.configFile": ".mocharc.json",
"mochaExplorer.files": ["e2e/setup.ts", "src/**/*.e2e.ts", "src/**/**/*.spec.ts"],
"mochaExplorer.require": ["ts-node/register"],
"mochaExplorer.env": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/e2e/setup.ts
Tamaño: 3689 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClickHouseClient, ClickHouseService, createClickHouseClient, PinoLogger } from '@novu/application-generic';
import { DalService } from '@novu/dal';
import { testServer } from '@novu/testing';
import sinon from 'sinon';
import { bootstrap } from '../src/bootstrap';

const dalService = new DalService();
let analyticsConnection: ClickHouseClient | undefined;
let clickHouseService: ClickHouseService | undefined;

function createClickHouseTestClient(database?: string): ClickHouseClient {
  return createClickHouseClient({
    host: 'http://localhost:8123',
    username: 'default',
    password: '',
    database: database || 'default',
  });
}

async function ensureClickHouseDatabase(databaseName: string): Promise<void> {
  try {
    const client = createClickHouseTestClient('default');
    await client.query({
      query: `CREATE DATABASE IF NOT EXISTS ${databaseName}`,
    });
    console.log(`Database "${databaseName}" ensured.`);
  } catch (error) {
    console.log(`Failed to create database ${databaseName}:`, error.message);
  }
}

async function getClickHouseConnection(): Promise<ClickHouseClient | undefined> {
  if (!analyticsConnection) {
    if (!clickHouseService) {
      clickHouseService = new ClickHouseService();
      await clickHouseService.init();
    }
    analyticsConnection = clickHouseService?.client;
  }

  return analyticsConnection;
}

async function truncateClickHouseTable(databaseName: string, tableName: string): Promise<void> {
  try {
    const conn = await getClickHouseConnection();
    if (!conn) return;

    await conn.exec({ query: `TRUNCATE TABLE IF EXISTS ${databaseName}.${tableName}` });
    console.log(`Successfully cleaned table ${tableName}`);
  } catch (error) {
    console.log(`Failed to clean table ${tableName}:`, error.message);
  }
}

async function getClickHouseTables(databaseName: string): Promise<string[]> {
  try {
    const conn = await getClickHouseConnection();
    if (!conn) return [];

    const result = await conn.query({
      query: `SHOW TABLES FROM ${databaseName}`,
      format: 'JSONEachRow',
    });

    const tables = (await result.json()) as Array<{ name: string }>;

    return tables.map((t) => t.name);
  } catch (error) {
    console.log(`Could not query tables in ${databaseName}: ${error.message}`);

    return [];
  }
}

async function cleanupClickHouseDatabase(): Promise<void> {
  try {
    const databaseName = process.env.CLICK_HOUSE_DATABASE || 'test_logs';
    console.log(`Cleaning up ClickHouse database: ${databaseName}`);

    await ensureClickHouseDatabase(databaseName);

    const tables = await getClickHouseTables(databaseName);
    if (tables.length > 0) {
      console.log(`Found ${tables.length} tables: ${tables.join(', ')}`);
      await Promise.all(tables.map((table) => truncateClickHouseTable(databaseName, table)));
      console.log(`Cleaned up ${tables.length} tables in ${databaseName}`);
    } else {
      console.log(`No tables to clean up in ${databaseName}`);
    }

    console.log(`ClickHouse database ${databaseName} cleanup completed`);
  } catch (error) {
    console.log('Analytics database cleanup encountered an issue:', error.message);
    console.log('This is acceptable for test environment - continuing with test setup');
  }
}

before(async () => {
  await testServer.create(await bootstrap());
  await dalService.connect(process.env.MONGO_URL);
  await cleanupClickHouseDatabase();
});

after(async () => {
  try {
    await testServer.teardown();
    await dalService.destroy();
    await cleanupClickHouseDatabase();
  } catch (e) {
    if (e.code !== 12586) {
      throw e;
    }
  }
});

afterEach(() => {
  sinon.restore();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createClickHouseTestClient(database?: string)
 - ensureClickHouseDatabase(databaseName: string)
 - getClickHouseConnection()
 - truncateClickHouseTable(databaseName: string, tableName: string)
 - getClickHouseTables(databaseName: string)
 - cleanupClickHouseDatabase()
Asignaciones con arrow functions encontradas (posibles funciones):
 - tables(await result.json()) as Array<{ name: string }>;

    return tables.map((t))
 - tables(await getClickHouseTables(databaseName);
    if (tables.length > 0) {
      console.log(`Found ${tab...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/.env.development
Tamaño: 1671 bytes
Lenguaje detectado: DEVELOPMENT

### CONTENIDO ORIGINAL ###

NODE_ENV=dev
PORT=3004
# STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"

# Novu
MAX_NOVU_INTEGRATION_MAIL_REQUESTS=300
MAX_NOVU_INTEGRATION_SMS_REQUESTS=20
# NOVU_EMAIL_INTEGRATION_API_KEY=

# Storage Service
# STORAGE_SERVICE=


# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_REDIS_PASSWORD=
REDIS_DB_INDEX=2

# Redis (for caching)
REDIS_CACHE_SERVICE_HOST=localhost
REDIS_CACHE_SERVICE_PORT=6379
REDIS_CACHE_DB_INDEX=
REDIS_CACHE_TTL=
REDIS_CACHE_PASSWORD=
REDIS_CACHE_CONNECTION_TIMEOUT=
REDIS_CACHE_KEEP_ALIVE=
REDIS_CACHE_FAMILY=
REDIS_CACHE_KEY_PREFIX=
REDIS_CACHE_SERVICE_TLS=
REDIS_CACHE_ENABLE_AUTOPIPELINING=true

# Redis (for cluster)
IS_IN_MEMORY_CLUSTER_MODE_ENABLED=false
ELASTICACHE_CLUSTER_SERVICE_HOST=
ELASTICACHE_CLUSTER_SERVICE_PORT=
REDIS_CLUSTER_SERVICE_HOST=localhost
REDIS_CLUSTER_SERVICE_PORTS=[7000,7001,7002,7003,7004,7005]
REDIS_CLUSTER_DB_INDEX=
REDIS_CLUSTER_TTL=
REDIS_CLUSTER_PASSWORD=
REDIS_CLUSTER_CONNECTION_TIMEOUT=
REDIS_CLUSTER_KEEP_ALIVE=
REDIS_CLUSTER_FAMILY=
REDIS_CLUSTER_KEY_PREFIX=

# MongoDB
# MONGO_URL=

# Storage
# S3_LOCAL_STACK=http://127.0.0.1:4566
# S3_BUCKET_NAME=novu-local
# S3_REGION=us-east-1
# GCS_BUCKET_NAME=novu-local
# AZURE_ACCOUNT_NAME=novu
# AZURE_ACCOUNT_KEY=123456
# AZURE_HOST_NAME=https://novu.blob.core.windows.net
# AZURE_CONTAINER_NAME=novu-local
# AWS_ACCESS_KEY_ID=test
# AWS_SECRET_ACCESS_KEY=test

# New Relic
NEW_RELIC_APP_NAME="[DEV] - worker"
# NEW_RELIC_LICENSE_KEY=

# Segment Analytics
# SEGMENT_TOKEN=

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=

MONGO_AUTO_CREATE_INDEXES=true

BROADCAST_QUEUE_CHUNK_SIZE=100
MULTICAST_QUEUE_CHUNK_SIZE=100

API_ROOT_URL=http://localhost:3000


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=dev
PORT=3004
# STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"
# Novu
# NOVU_EMAIL_INTEGRATION_API_KEY=
# Storage Service
# STORAGE_SERVICE=
# Redis
# REDIS_REDIS_PASSWORD=
# Redis (for caching)
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/src/.env.production
Tamaño: 1751 bytes
Lenguaje detectado: PRODUCTION

### CONTENIDO ORIGINAL ###

NODE_ENV=production
PORT=3004
FLEET_NAME="default"
# STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"

# Novu
MAX_NOVU_INTEGRATION_MAIL_REQUESTS=300

MAX_NOVU_INTEGRATION_SMS_REQUESTS=20

# NOVU_EMAIL_INTEGRATION_API_KEY=

# Storage Service
# STORAGE_SERVICE=

# Redis
# REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_REDIS_PASSWORD=
REDIS_DB_INDEX=2

# Redis (for caching)
REDIS_CACHE_SERVICE_HOST=localhost
REDIS_CACHE_SERVICE_PORT=6379
REDIS_CACHE_DB_INDEX=
REDIS_CACHE_TTL=
REDIS_CACHE_PASSWORD=
REDIS_CACHE_CONNECTION_TIMEOUT=
REDIS_CACHE_KEEP_ALIVE=
REDIS_CACHE_FAMILY=
REDIS_CACHE_KEY_PREFIX=
REDIS_CACHE_SERVICE_TLS=

# Redis (for cluster)
IS_IN_MEMORY_CLUSTER_MODE_ENABLED=false
ELASTICACHE_CLUSTER_SERVICE_HOST=
ELASTICACHE_CLUSTER_SERVICE_PORT=
REDIS_CLUSTER_SERVICE_HOST=localhost
REDIS_CLUSTER_SERVICE_PORTS=[7000,7001,7002,7003,7004,7005]
REDIS_CLUSTER_DB_INDEX=
REDIS_CLUSTER_TTL=
REDIS_CLUSTER_PASSWORD=
REDIS_CLUSTER_CONNECTION_TIMEOUT=
REDIS_CLUSTER_KEEP_ALIVE=
REDIS_CLUSTER_FAMILY=
REDIS_CLUSTER_KEY_PREFIX=

# MongoDB
# MONGO_URL=
MONGO_MIN_POOL_SIZE=50

# Storage
# S3_LOCAL_STACK=http://127.0.0.1:4566
# S3_BUCKET_NAME=novu-local
# S3_REGION=us-east-1
# GCS_BUCKET_NAME=novu-local
# AZURE_ACCOUNT_NAME=novu
# AZURE_ACCOUNT_KEY=123456
# AZURE_HOST_NAME=https://novu.blob.core.windows.net
# AZURE_CONTAINER_NAME=novu-local
# AWS_ACCESS_KEY_ID=test
# AWS_SECRET_ACCESS_KEY=test

# New Relic
NEW_RELIC_APP_NAME="[PROD] - worker"
# NEW_RELIC_LICENSE_KEY=

# Segment Analytics
# SEGMENT_TOKEN=

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=


## This value should be set to true if it is the first time you are running the with the database
MONGO_AUTO_CREATE_INDEXES=false

BROADCAST_QUEUE_CHUNK_SIZE=100
MULTICAST_QUEUE_CHUNK_SIZE=100


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=production
PORT=3004
FLEET_NAME="default"
# STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"
# Novu
# NOVU_EMAIL_INTEGRATION_API_KEY=
# Storage Service
# STORAGE_SERVICE=
# Redis
# REDIS_HOST=localhost
# REDIS_REDIS_PASSWORD=
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/src/.env.test
Tamaño: 2131 bytes
Lenguaje detectado: TEST

### CONTENIDO ORIGINAL ###

NODE_ENV=test
PORT=1342
STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"
STORE_NOTIFICATION_CONTENT=true

# Novu
MAX_NOVU_INTEGRATION_MAIL_REQUESTS=300
NOVU_EMAIL_INTEGRATION_API_KEY=test

MAX_NOVU_INTEGRATION_SMS_REQUESTS=20
NOVU_SMS_INTEGRATION_ACCOUNT_SID=test
NOVU_SMS_INTEGRATION_TOKEN=test
NOVU_SMS_INTEGRATION_SENDER=1234567890
# Storage Service
# STORAGE_SERVICE=


# Redis
REDIS_PORT=6379
REDIS_HOST=localhost
# REDIS_REDIS_PASSWORD=
REDIS_DB_INDEX=1

# Redis (for caching)
REDIS_CACHE_SERVICE_HOST=localhost
REDIS_CACHE_SERVICE_PORT=6379
REDIS_CACHE_DB_INDEX=
REDIS_CACHE_TTL=
REDIS_CACHE_PASSWORD=
REDIS_CACHE_CONNECTION_TIMEOUT=
REDIS_CACHE_KEEP_ALIVE=
REDIS_CACHE_FAMILY=
REDIS_CACHE_KEY_PREFIX=
REDIS_CACHE_SERVICE_TLS=

# Redis (for cluster)
IS_IN_MEMORY_CLUSTER_MODE_ENABLED=false
ELASTICACHE_CLUSTER_SERVICE_HOST=
ELASTICACHE_CLUSTER_SERVICE_PORT=
REDIS_CLUSTER_SERVICE_HOST=localhost
REDIS_CLUSTER_SERVICE_PORTS=[7000,7001,7002,7003,7004,7005]
REDIS_CLUSTER_DB_INDEX=
REDIS_CLUSTER_TTL=
REDIS_CLUSTER_PASSWORD=
REDIS_CLUSTER_CONNECTION_TIMEOUT=
REDIS_CLUSTER_KEEP_ALIVE=
REDIS_CLUSTER_FAMILY=
REDIS_CLUSTER_KEY_PREFIX=

# MongoDB
MONGO_URL=mongodb://127.0.0.1:27017/novu-test

# Storage
S3_LOCAL_STACK=http://127.0.0.1:4566
S3_BUCKET_NAME=novu-test
S3_REGION=us-east-1
# GCS_BUCKET_NAME=novu-test
# AZURE_ACCOUNT_NAME=novu
# AZURE_ACCOUNT_KEY=123456
# AZURE_HOST_NAME=https://novu.blob.core.windows.net
# AZURE_CONTAINER_NAME=novu-test
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test

# New Relic
NEW_RELIC_APP_NAME="[TEST] - worker"
# NEW_RELIC_LICENSE_KEY=

# Segment Analytics
# SEGMENT_TOKEN=

LOG_LEVEL=info

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=

MONGO_AUTO_CREATE_INDEXES=true

IS_USE_MERGED_DIGEST_ID_ENABLED=true

BROADCAST_QUEUE_CHUNK_SIZE=100
MULTICAST_QUEUE_CHUNK_SIZE=100

API_ROOT_URL=http://localhost:1336

CLICK_HOUSE_URL=http://localhost:8123
CLICK_HOUSE_USER=default
CLICK_HOUSE_PASSWORD=
CLICK_HOUSE_DATABASE=test_logs

IS_TRACE_LOGS_ENABLED=true
IS_STEP_RUN_LOGS_WRITE_ENABLED=true
IS_WORKFLOW_RUN_LOGS_WRITE_ENABLED=true
IS_SUBSCRIBERS_SCHEDULE_ENABLED=true
IS_CONTEXT_ENABLED=true


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=test
PORT=1342
STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"
STORE_NOTIFICATION_CONTENT=true
# Novu
# Storage Service
# STORAGE_SERVICE=
# Redis
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/src/.example.env
Tamaño: 2021 bytes
Lenguaje detectado: ENV

### CONTENIDO ORIGINAL ###

NODE_ENV=local
PORT=3004
FLEET_NAME="default"
STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"

# Novu
MAX_NOVU_INTEGRATION_MAIL_REQUESTS=300
# NOVU_EMAIL_INTEGRATION_API_KEY=

MAX_NOVU_INTEGRATION_SMS_REQUESTS=20

# Storage Service
# STORAGE_SERVICE=

# Redis
REDIS_PORT=6379
REDIS_HOST=localhost
# REDIS_REDIS_PASSWORD=
REDIS_DB_INDEX=2

# Redis (for caching)
REDIS_CACHE_SERVICE_HOST=localhost
REDIS_CACHE_SERVICE_PORT=6379
REDIS_CACHE_DB_INDEX=
REDIS_CACHE_TTL=
REDIS_CACHE_PASSWORD=
REDIS_CACHE_CONNECTION_TIMEOUT=
REDIS_CACHE_KEEP_ALIVE=
REDIS_CACHE_FAMILY=
REDIS_CACHE_KEY_PREFIX=
REDIS_CACHE_SERVICE_TLS=

# Redis (for cluster)
IS_IN_MEMORY_CLUSTER_MODE_ENABLED=false
# ELASTICACHE_CLUSTER_SERVICE_HOST=
# ELASTICACHE_CLUSTER_SERVICE_PORT=
# REDIS_CLUSTER_SERVICE_HOST=localhost
# REDIS_CLUSTER_SERVICE_PORTS=[7000,7001,7002,7003,7004,7005]
# REDIS_CLUSTER_DB_INDEX=
# REDIS_CLUSTER_TTL=
# REDIS_CLUSTER_PASSWORD=
# REDIS_CLUSTER_CONNECTION_TIMEOUT=
# REDIS_CLUSTER_KEEP_ALIVE=
# REDIS_CLUSTER_FAMILY=
# REDIS_CLUSTER_KEY_PREFIX=

# MongoDB
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
MONGO_MAX_POOL_SIZE=500

# Storage
S3_LOCAL_STACK=http://127.0.0.1:4566
S3_BUCKET_NAME=novu-local
S3_REGION=us-east-1
# GCS_BUCKET_NAME=novu-local
# AZURE_ACCOUNT_NAME=novu
# AZURE_ACCOUNT_KEY=123456
# AZURE_HOST_NAME=https://novu.blob.core.windows.net
# AZURE_CONTAINER_NAME=novu-local
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test

# New Relic
NEW_RELIC_APP_NAME="[LOCAL] - worker"
# NEW_RELIC_LICENSE_KEY=

# Segment Analytics
# SEGMENT_TOKEN=

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=

BROADCAST_QUEUE_CHUNK_SIZE=100
MULTICAST_QUEUE_CHUNK_SIZE=100

API_ROOT_URL=http://localhost:3000
# expressed in seconds or a string describing a time span [zeit/ms](https://github.com/zeit/ms.js).  Eg: 60, "2 days", "10h", "7d"
SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME='15 days'

# ClickHouse connection variables
CLICK_HOUSE_URL=http://127.0.0.1:8123
CLICK_HOUSE_USER=default
CLICK_HOUSE_PASSWORD=
CLICK_HOUSE_DATABASE=novu-local


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=local
PORT=3004
FLEET_NAME="default"
STORE_ENCRYPTION_KEY="<ENCRYPTION_KEY_MUST_BE_32_LONG>"
# Novu
# NOVU_EMAIL_INTEGRATION_API_KEY=
# Storage Service
# STORAGE_SERVICE=
# Redis
# REDIS_REDIS_PASSWORD=
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/worker/src/app.module.ts
Tamaño: 1430 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DynamicModule,
  ForwardReference,
  Logger,
  Module,
  OnApplicationBootstrap,
  OnApplicationShutdown,
  OnModuleDestroy,
  Provider,
  Type,
} from '@nestjs/common';

import { APP_FILTER } from '@nestjs/core';
import { SentryGlobalFilter, SentryModule } from '@sentry/nestjs/setup';
import { HealthModule } from './app/health/health.module';
import { SharedModule } from './app/shared/shared.module';
import { TelemetryModule } from './app/telemetry/telemetry.module';
import { WorkflowModule } from './app/workflow/workflow.module';

const modules: Array<Type | DynamicModule | Promise<DynamicModule> | ForwardReference> = [
  SharedModule,
  HealthModule,
  WorkflowModule,
  TelemetryModule,
];

const providers: Provider[] = [];

if (process.env.SENTRY_DSN) {
  modules.unshift(SentryModule.forRoot());
  providers.unshift({
    provide: APP_FILTER,
    useClass: SentryGlobalFilter,
  });
}

@Module({
  imports: modules,
  controllers: [],
  providers,
})
export class AppModule implements OnApplicationBootstrap, OnApplicationShutdown, OnModuleDestroy {
  onModuleDestroy() {
    Logger.log(`[@novu/worker]: AppModule is shuttind down...`);
    Logger.flush();
  }

  onApplicationBootstrap() {
    Logger.log(`[@novu/worker]: Bootstrapped successfully!`);
  }

  onApplicationShutdown(signal: string) {
    Logger.log(`[@novu/worker]: Application shutdown with signal ${signal}`);
    Logger.flush();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/bootstrap.ts
Tamaño: 2747 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './instrument';

import { INestApplication, Logger, ValidationPipe } from '@nestjs/common';
import { NestFactory } from '@nestjs/core';
import { BullMqService, getErrorInterceptor, Logger as PinoLogger } from '@novu/application-generic';
import bodyParser from 'body-parser';
import helmet from 'helmet';
import { ResponseInterceptor } from './app/shared/response.interceptor';
import { prepareAppInfra, startAppInfra } from './app/workflow/services/cold-start.service';
import { AppModule } from './app.module';
import { CONTEXT_PATH, validateEnv } from './config';

const extendedBodySizeRoutes = ['/v1/events', '/v1/notification-templates', '/v1/layouts'];

// Validate the ENV variables after launching SENTRY, so missing variables will report to sentry
validateEnv();

export async function bootstrap(): Promise<INestApplication> {
  BullMqService.haveProInstalled();

  const app = await NestFactory.create(AppModule, { bufferLogs: true });
  app.useLogger(app.get(PinoLogger));
  app.flushLogs();

  await prepareAppInfra(app);

  app.use(helmet());

  app.setGlobalPrefix(`${CONTEXT_PATH}v1`);

  app.useGlobalPipes(
    new ValidationPipe({
      transform: true,
      forbidUnknownValues: false,
    })
  );

  app.useGlobalInterceptors(new ResponseInterceptor());
  app.useGlobalInterceptors(getErrorInterceptor());

  app.use(extendedBodySizeRoutes, bodyParser.json({ limit: '20mb' }));
  app.use(extendedBodySizeRoutes, bodyParser.urlencoded({ limit: '20mb', extended: true }));
  app.use(bodyParser.json());
  app.use(bodyParser.urlencoded({ extended: true }));

  app.enableShutdownHooks();

  /*
   * Handle unhandled promise rejections
   * We explicitly crash the process on unhandled rejections as they indicate the application
   * is in an undefined state. NestJS can't handle these as they occur outside the event lifecycle.
   * According to Node.js docs, it's unsafe to resume normal operation after unhandled rejections.
   * We log these rejections with fatal level to ensure they are properly monitored and tracked.
   * See: https://nodejs.org/api/process.html#process_warning_using_uncaughtexception_correctly
   */
  process.on('unhandledRejection', (reason, promise) => {
    app.get(PinoLogger).fatal(
      {
        err: reason,
        message: 'Unhandled promise rejection',
        promise,
      },
      'Bootstrap'
    );
    process.exit(1);
  });

  await app.init();

  try {
    await startAppInfra(app);
  } catch (e) {
    Logger.error('[@novu/worker]: Failed to start app infra', e.message, e.start);
    process.exit(1);
  }

  await app.listen(process.env.PORT!);

  Logger.log(`[@novu/worker]: Listening for NODE_ENV=${process.env.NODE_ENV} on port ${process.env.PORT}`);

  return app;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - bootstrap()
Asignaciones con arrow functions encontradas (posibles funciones):
 - app(await NestFactory.create(AppModule, { bufferLogs: true });
  app.useLogger(app.get(PinoLogger));
  a...)
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/instrument.ts
Tamaño: 335 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './config/env.config';

require('newrelic');

import { init } from '@sentry/nestjs';
import { version } from '../package.json';

if (process.env.SENTRY_DSN) {
  init({
    dsn: process.env.SENTRY_DSN,
    environment: process.env.NODE_ENV,
    release: `v${version}`,
    ignoreErrors: ['Non-Error exception captured'],
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/main.ts
Tamaño: 55 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { bootstrap } from './bootstrap';

bootstrap();


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/newrelic.ts
Tamaño: 2210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * New Relic agent configuration.
 *
 * See lib/config/default.js in the agent distribution for a more complete
 * description of configuration variables and their potential values.
 */

exports.config = {
  /**
   * Array of application names.
   */
  app_name: [process.env.NEW_RELIC_APP_NAME],
  /**
   * Your New Relic license key.
   */
  license_key: process.env.NEW_RELIC_LICENSE_KEY,
  /**
   * This setting controls distributed tracing.
   * Distributed tracing lets you see the path that a request takes through your
   * distributed system. Enabling distributed tracing changes the behavior of some
   * New Relic features, so carefully consult the transition guide before you enable
   * this feature: https://docs.newrelic.com/docs/transition-guide-distributed-tracing
   * Default is true.
   */
  distributed_tracing: {
    /**
     * Enables/disables distributed tracing.
     *
     * @env NEW_RELIC_DISTRIBUTED_TRACING_ENABLED
     */
    enabled: true,
  },
  application_logging: {
    forwarding: {
      enabled: true,
    },
  },
  logging: {
    /**
     * Level at which to log. 'trace' is most useful to New Relic when diagnosing
     * issues with the agent, 'info' and higher will impose the least overhead on
     * production applications.
     */
    level: 'info',
  },
  /**
   * When true, all request headers except for those listed in attributes.exclude
   * will be captured for all traces, unless otherwise specified in a destination's
   * attributes include/exclude lists.
   */
  allow_all_headers: true,
  attributes: {
    /**
     * Prefix of attributes to exclude from all destinations. Allows * as wildcard
     * at end.
     *
     * NOTE: If excluding headers, they must be in camelCase form to be filtered.
     *
     * @env NEW_RELIC_ATTRIBUTES_EXCLUDE
     */
    exclude: [
      'request.headers.cookie',
      'request.headers.authorization',
      'request.headers.proxyAuthorization',
      'request.headers.setCookie*',
      'request.headers.x*',
      'response.headers.cookie',
      'response.headers.authorization',
      'response.headers.proxyAuthorization',
      'response.headers.setCookie*',
      'response.headers.x*',
    ],
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/health/health.controller.ts
Tamaño: 1032 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Controller, Get, Inject } from '@nestjs/common';
import { ApiExcludeController } from '@nestjs/swagger';
import { HealthCheck, HealthCheckResult, HealthCheckService } from '@nestjs/terminus';
import { DalServiceHealthIndicator, QueueHealthIndicator } from '@novu/application-generic';

import { version } from '../../../package.json';

@Controller('health-check')
@ApiExcludeController()
export class HealthController {
  constructor(
    @Inject('QUEUE_HEALTH_INDICATORS')
    private healthIndicators: QueueHealthIndicator[],
    private healthCheckService: HealthCheckService,
    private dalHealthIndicator: DalServiceHealthIndicator
  ) {}

  @Get()
  @HealthCheck()
  healthCheck(): Promise<HealthCheckResult> {
    return this.healthCheckService.check([
      async () => this.dalHealthIndicator.isHealthy(),
      ...this.healthIndicators.map((indicator) => async () => indicator.isHealthy()),
      async () => ({
        apiVersion: {
          version,
          status: 'up',
        },
      }),
    ]);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HealthController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/health/health.module.ts
Tamaño: 342 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { TerminusModule } from '@nestjs/terminus';
import { SharedModule } from '../shared/shared.module';
import { HealthController } from './health.controller';

@Module({
  imports: [SharedModule, TerminusModule],
  controllers: [HealthController],
  providers: [],
})
export class HealthModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HealthModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/health/e2e/health-check.e2e.ts
Tamaño: 521 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect } from 'chai';
import defaults from 'superagent-defaults';
import request from 'supertest';

describe('Health-check', () => {
  let testAgent;

  before(async () => {
    testAgent = defaults(request(`http://127.0.0.1:${process.env.PORT}`));
  });

  describe('/health-check (GET)', () => {
    it('should correctly return a health check', async () => {
      const {
        body: { data },
      } = await testAgent.get('/v1/health-check');

      expect(data?.status).to.equal('ok');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - testAgent(defaults(request(`http://127.0.0.1:${process.env.PORT}`));
  });

  describe('/health-check (GET)', ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/response.interceptor.ts
Tamaño: 1313 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CallHandler, Injectable, NestInterceptor } from '@nestjs/common';
import { instanceToPlain } from 'class-transformer';
import { isArray, isObject } from 'lodash';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';

export interface Response<T> {
  data: T;
}

@Injectable()
export class ResponseInterceptor<T> implements NestInterceptor<T, Response<T>> {
  intercept(context, next: CallHandler): Observable<Response<T>> {
    if (context.getType() === 'graphql') return next.handle();

    return next.handle().pipe(
      map((data) => {
        // For paginated results that already contain the data wrapper, return the whole object
        if (data?.data) {
          return {
            ...data,
            data: isObject(data.data) ? this.transformResponse(data.data) : data.data,
          };
        }

        return {
          data: isObject(data) ? this.transformResponse(data) : data,
        };
      })
    );
  }

  private transformResponse(response) {
    if (isArray(response)) {
      return response.map((item) => this.transformToPlain(item));
    }

    return this.transformToPlain(response);
  }

  private transformToPlain(plainOrClass) {
    return plainOrClass && plainOrClass.constructor !== Object ? instanceToPlain(plainOrClass) : plainOrClass;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class ResponseInterceptor

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/shared.module.ts
Tamaño: 3303 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import {
  analyticsService,
  BulkCreateExecutionDetails,
  ComputeJobWaitDurationService,
  CreateExecutionDetails,
  CreateNotificationJobs,
  CreateOrUpdateSubscriberUseCase,
  CreateTenant,
  cacheService,
  clickHouseService,
  createNestLoggingModuleOptions,
  DalServiceHealthIndicator,
  DigestFilterSteps,
  ExecuteBridgeRequest,
  featureFlagsService,
  GetDecryptedSecretKey,
  GetTenant,
  InvalidateCacheService,
  LoggerModule,
  MetricsModule,
  ProcessTenant,
  QueuesModule,
  StepRunRepository,
  StorageHelperService,
  storageService,
  TraceLogRepository,
  UpdateSubscriber,
  UpdateSubscriberChannel,
  UpdateTenant,
  WorkflowRunRepository,
} from '@novu/application-generic';
import {
  ControlValuesRepository,
  DalService,
  EnvironmentRepository,
  ExecutionDetailsRepository,
  IntegrationRepository,
  JobRepository,
  LayoutRepository,
  MessageRepository,
  MessageTemplateRepository,
  NotificationGroupRepository,
  NotificationRepository,
  NotificationTemplateRepository,
  SubscriberRepository,
  TenantRepository,
  TopicRepository,
  TopicSubscribersRepository,
  WorkflowOverrideRepository,
} from '@novu/dal';

import { JobTopicNameEnum } from '@novu/shared';
import packageJson from '../../../package.json';
import { UNIQUE_WORKER_DEPENDENCIES } from '../../config/worker-init.config';
import { ActiveJobsMetricService } from '../workflow/services';

const DAL_MODELS = [
  EnvironmentRepository,
  ExecutionDetailsRepository,
  NotificationTemplateRepository,
  SubscriberRepository,
  NotificationRepository,
  MessageRepository,
  MessageTemplateRepository,
  NotificationGroupRepository,
  LayoutRepository,
  IntegrationRepository,
  JobRepository,
  TopicRepository,
  TopicSubscribersRepository,
  TenantRepository,
  WorkflowOverrideRepository,
  ControlValuesRepository,
];

const dalService = {
  provide: DalService,
  useFactory: async () => {
    const service = new DalService();

    await service.connect(process.env.MONGO_URL!);

    return service;
  },
};

const ANALYTICS_PROVIDERS = [
  // Repositories
  TraceLogRepository,
  StepRunRepository,
  WorkflowRunRepository,

  // Services
  clickHouseService,
];

const PROVIDERS = [
  analyticsService,
  BulkCreateExecutionDetails,
  cacheService,
  ComputeJobWaitDurationService,
  CreateExecutionDetails,
  CreateNotificationJobs,
  CreateOrUpdateSubscriberUseCase,
  dalService,
  DalServiceHealthIndicator,
  DigestFilterSteps,
  featureFlagsService,
  InvalidateCacheService,
  StorageHelperService,
  storageService,
  UpdateSubscriber,
  UpdateSubscriberChannel,
  UpdateTenant,
  GetTenant,
  CreateTenant,
  ProcessTenant,
  ...DAL_MODELS,
  ActiveJobsMetricService,
  ExecuteBridgeRequest,
  GetDecryptedSecretKey,
  ...ANALYTICS_PROVIDERS,
];

@Module({
  imports: [
    MetricsModule,
    QueuesModule.forRoot(
      UNIQUE_WORKER_DEPENDENCIES.length
        ? [JobTopicNameEnum.ACTIVE_JOBS_METRIC, ...UNIQUE_WORKER_DEPENDENCIES]
        : undefined
    ),
    LoggerModule.forRoot(
      createNestLoggingModuleOptions({
        serviceName: packageJson.name,
        version: packageJson.version,
      })
    ),
  ],
  providers: [...PROVIDERS],
  exports: [...PROVIDERS, LoggerModule, QueuesModule],
})
export class SharedModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - dalService({
  provide: DalService,
  useFactory: async ())
Declaraciones 'export' encontradas:
- export class SharedModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/utils/constants.ts
Tamaño: 98 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const EXCEPTION_MESSAGE_ON_WEBHOOK_FILTER = 'Exception while performing webhook request.';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/utils/exceptions.ts
Tamaño: 48 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class PlatformException extends Error {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PlatformException

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/utils/index.ts
Tamaño: 106 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './constants';
export * from './exceptions';
export * from './should-halt-on-step-failure';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/shared/utils/should-halt-on-step-failure.ts
Tamaño: 620 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { isActionStepType } from '@novu/application-generic';
import { JobEntity } from '@novu/dal';

export const shouldHaltOnStepFailure = (job: JobEntity): boolean => {
  if (!job.type) {
    return typeof job.step.shouldStopOnFail === 'boolean' ? job.step.shouldStopOnFail : false;
  }

  /*
   * Action steps always stop on failure across all versions (v1 & v2)
   */
  if (isActionStepType(job.type)) {
    return true;
  }

  /*
   * Legacy v1 behavior:
   * Return true if shouldStopOnFail was explicitly enabled by user
   */
  if (job.step.shouldStopOnFail === true) {
    return true;
  }

  return false;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - shouldHaltOnStepFailure(job: JobEntity): boolean)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/telemetry/telemetry.module.ts
Tamaño: 1018 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { HttpModule } from '@nestjs/axios';
import { Module } from '@nestjs/common';
import { ScheduleModule } from '@nestjs/schedule';
import {
  CommunityOrganizationRepository,
  CommunityUserRepository,
  IntegrationRepository,
  NotificationRepository,
  NotificationTemplateRepository,
  SubscriberRepository,
  TopicRepository,
} from '@novu/dal';
import { SharedModule } from '../shared/shared.module';
import { MachineInfoService } from './usecases/machineInfoService.usecase';
import { UserInfoService } from './usecases/userInfoService.usecase';

const REPOSITORIES = [
  CommunityUserRepository,
  CommunityOrganizationRepository,
  NotificationTemplateRepository,
  NotificationRepository,
  TopicRepository,
  SubscriberRepository,
  IntegrationRepository,
];

const SERVICES = [MachineInfoService, UserInfoService];

const MODULES = [ScheduleModule.forRoot(), SharedModule, HttpModule];

@Module({
  imports: [...MODULES],
  providers: [...SERVICES, ...REPOSITORIES],
})
export class TelemetryModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TelemetryModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/telemetry/usecases/machineInfoService.usecase.ts
Tamaño: 1224 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { HttpService } from '@nestjs/axios';
import { Injectable } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import { getMachineInfo, loadOrCreateMachineId } from '../utils/machine.utils';
import { sendDataToNovuTrace } from '../utils/sendDataToNovuTrace.utils';

@Injectable()
export class MachineInfoService {
  private machineId: string;

  constructor(private readonly httpService: HttpService) {}

  private async sendMachineTelemetry(eventName: string) {
    const telemetryData = {
      distinct_id: this.machineId,
      instanceId: this.machineId,
      ...getMachineInfo(),
    };

    await sendDataToNovuTrace(this.httpService, eventName, telemetryData);
  }

  async onApplicationBootstrap() {
    if (process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'false') {
      this.machineId = loadOrCreateMachineId();
      await this.sendMachineTelemetry('Initial Setup - [OS Telemetry]');
    }
  }

  @Cron(CronExpression.EVERY_HOUR)
  private async sendRegularTelemetry() {
    if (process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'false') {
      await this.sendMachineTelemetry('Regular Beacon - [OS Telemetry]');
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MachineInfoService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/telemetry/usecases/userInfoService.usecase.ts
Tamaño: 2816 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { HttpService } from '@nestjs/axios';
import { Injectable } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import {
  CommunityOrganizationRepository,
  CommunityUserRepository,
  IntegrationRepository,
  NotificationRepository,
  NotificationTemplateRepository,
  SubscriberRepository,
  TopicRepository,
} from '@novu/dal';
import { loadOrCreateMachineId } from '../utils/machine.utils';
import { sendDataToNovuTrace } from '../utils/sendDataToNovuTrace.utils';

@Injectable()
export class UserInfoService {
  constructor(
    private readonly userRepository: CommunityUserRepository,
    private readonly organizationRepository: CommunityOrganizationRepository,
    private readonly notificationTemplateRepository: NotificationTemplateRepository,
    private readonly notificationRepository: NotificationRepository,
    private readonly topicRepository: TopicRepository,
    private readonly subscriberRepository: SubscriberRepository,
    private readonly integrationRepository: IntegrationRepository,
    private readonly httpService: HttpService
  ) {}

  private async getUserData() {
    const results = await Promise.allSettled([
      this.userRepository.estimatedDocumentCount(),
      this.organizationRepository.estimatedDocumentCount(),
      this.notificationTemplateRepository.estimatedDocumentCount(),
      this.notificationRepository.estimatedDocumentCount(),
      this.topicRepository.estimatedDocumentCount(),
      this.subscriberRepository.estimatedDocumentCount(),
      this.integrationRepository.sumByProviderId(),
      this.notificationTemplateRepository.getTotalSteps(),
    ]);

    return {
      distinct_id: loadOrCreateMachineId(),
      userCount: results[0].status === 'fulfilled' ? results[0].value : null,
      orgCount: results[1].status === 'fulfilled' ? results[1].value : null,
      workflowCount: results[2].status === 'fulfilled' ? results[2].value : null,
      eventCount: results[3].status === 'fulfilled' ? results[3].value : null,
      topicCount: results[4].status === 'fulfilled' ? results[4].value : null,
      subscriberCount: results[5].status === 'fulfilled' ? results[5].value : null,
      integrationCount: results[6].status === 'fulfilled' ? results[6].value : null,
      totalSteps: results[7].status === 'fulfilled' ? results[7].value : null,
    };
  }

  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)
  async sendDailyUserTelemetry() {
    const isSelfHosted = process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'false';
    const telemetryEnabled = process.env.NOVU_TELEMETRY !== 'false';

    if (isSelfHosted && telemetryEnabled) {
      const userData = await this.getUserData();
      await sendDataToNovuTrace(this.httpService, 'User Info - [OS Telemetry]', userData);
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UserInfoService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/telemetry/utils/machine.utils.ts
Tamaño: 1409 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { existsSync, readFileSync, writeFileSync } from 'fs';
import { freemem, homedir, hostname, networkInterfaces as os_networkInterfaces, platform, release, totalmem } from 'os';
import { join } from 'path';
import { v4 as uuidv4 } from 'uuid';

const machineIdFilePath = join(homedir(), '.novu-machine-id');

export function loadOrCreateMachineId(): string {
  try {
    if (existsSync(machineIdFilePath)) {
      return readFileSync(machineIdFilePath, 'utf-8').trim();
    } else {
      const machineId = uuidv4();
      writeFileSync(machineIdFilePath, machineId);

      return machineId;
    }
  } catch (error) {
    Logger.error('Error loading or creating machine ID, falling back to hostname and IP.', error);

    return getFallbackMachineId();
  }
}

export function getMachineInfo() {
  const networkInterfaces = os_networkInterfaces();
  const networkInterface = networkInterfaces.eth0 || networkInterfaces.en0 || [];
  const ipAddress = networkInterface.find((iface) => iface.family === 'IPv4' && !iface.internal)?.address || 'Unknown';

  return {
    hostname: hostname(),
    totalMemory: totalmem(),
    freeMemory: freemem(),
    platform: platform(),
    release: release(),
    ipAddress,
  };
}

function getFallbackMachineId(): string {
  const machineInfo = getMachineInfo();

  return `${machineInfo.hostname}-${machineInfo.ipAddress}`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - loadOrCreateMachineId()
 - getMachineInfo()
 - getFallbackMachineId()
Asignaciones con arrow functions encontradas (posibles funciones):
 - ipAddress(networkInterface.find((iface))
Declaraciones 'export' encontradas:
- export function loadOrCreateMachineId
- export function getMachineInfo

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/telemetry/utils/sendDataToNovuTrace.utils.ts
Tamaño: 587 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { HttpService } from '@nestjs/axios';
import { Logger } from '@nestjs/common';
import { firstValueFrom } from 'rxjs';

export async function sendDataToNovuTrace(httpService: HttpService, event: string, properties: any) {
  try {
    const dataToSend = {
      event,
      properties: {
        ...properties,
        timestamp: new Date().toISOString(),
      },
    };

    const res = await firstValueFrom(httpService.post(process.env.OS_TELEMETRY_URL as string, dataToSend));
  } catch (error) {
    Logger.error(`Error sending '${event}' event to Novu Trace:`, error);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - sendDataToNovuTrace(httpService: HttpService, event: string, properties: any)
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/workflow.module.ts
Tamaño: 7210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DynamicModule, Logger, Module, OnApplicationShutdown, Provider, Type } from '@nestjs/common';
import { ForwardReference } from '@nestjs/common/interfaces/modules/forward-reference.interface';
import {
  BulkCreateExecutionDetails,
  CalculateLimitNovuIntegration,
  CompileEmailTemplate,
  CompileInAppTemplate,
  CompileTemplate,
  ConditionsFilter,
  CreateExecutionDetails,
  GetDecryptedIntegrations,
  GetLayoutUseCase,
  GetNovuLayout,
  GetNovuProviderCredentials,
  GetPreferences,
  GetSubscriberSchedule,
  GetSubscriberTemplatePreference,
  GetTopicSubscribersUseCase,
  InMemoryProviderService,
  NormalizeVariables,
  ProcessTenant,
  RedisThrottleService,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
  TierRestrictionsValidateUsecase,
  TriggerBroadcast,
  TriggerEvent,
  TriggerMulticast,
  WorkflowInMemoryProviderService,
  WorkflowRunService,
} from '@novu/application-generic';
import {
  ChannelConnectionRepository,
  ChannelEndpointRepository,
  CommunityOrganizationRepository,
  CommunityUserRepository,
  ContextRepository,
  JobRepository,
  PreferencesRepository,
} from '@novu/dal';
import { JobTopicNameEnum } from '@novu/shared';
import { ACTIVE_WORKERS, workersToProcess } from '../../config/worker-init.config';
import { SharedModule } from '../shared/shared.module';
import {
  Digest,
  ExecuteBridgeJob,
  GetDigestEventsBackoff,
  GetDigestEventsRegular,
  HandleLastFailedJob,
  ProcessUnsnoozeJob,
  QueueNextJob,
  RunJob,
  SendMessage,
  SendMessageChat,
  SendMessageDelay,
  SendMessageEmail,
  SendMessageInApp,
  SendMessagePush,
  SendMessageSms,
  SetJobAsCompleted,
  SetJobAsFailed,
  Throttle,
  UpdateJobStatus,
  WebhookFilterBackoffStrategy,
} from './usecases';
import { AddJob, MergeOrCreateDigest } from './usecases/add-job';
import { InboundEmailParse } from './usecases/inbound-email-parse/inbound-email-parse.usecase';
import { NoopSendWebhookMessage } from './usecases/noop-send-webhook-message.usecase';
import { ExecuteStepCustom } from './usecases/send-message/execute-step-custom.usecase';
import { StoreSubscriberJobs } from './usecases/store-subscriber-jobs';
import { SubscriberJobBound } from './usecases/subscriber-job-bound/subscriber-job-bound.usecase';

const enterpriseImports = (): Array<Type | DynamicModule | Promise<DynamicModule> | ForwardReference> => {
  const modules: Array<Type | DynamicModule | Promise<DynamicModule> | ForwardReference> = [];
  try {
    if (process.env.NOVU_ENTERPRISE === 'true' || process.env.CI_EE_TEST === 'true') {
      Logger.log('Importing enterprise modules', 'EnterpriseImport');
      if (require('@novu/ee-translation')?.EnterpriseTranslationModuleWithoutControllers) {
        Logger.log('Importing enterprise translations module', 'EnterpriseImport');
        modules.push(require('@novu/ee-translation')?.EnterpriseTranslationModuleWithoutControllers);
      }

      if (require('@novu/ee-billing')?.BillingModule) {
        Logger.log('Importing enterprise billing module', 'EnterpriseImport');
        const activeWorkers = workersToProcess.length ? workersToProcess : Object.values(JobTopicNameEnum);
        modules.push(require('@novu/ee-billing')?.BillingModule.forRoot(activeWorkers));
      }
    }
  } catch (e) {
    Logger.error(e, `Unexpected error while importing enterprise modules`, 'EnterpriseImport');
  }

  return modules;
};

const REPOSITORIES = [
  JobRepository,
  CommunityOrganizationRepository,
  PreferencesRepository,
  CommunityUserRepository,
  ChannelEndpointRepository,
  ChannelConnectionRepository,
  ContextRepository,
];

const webhookProvider: Provider = {
  provide: SendWebhookMessage,
  useClass: (() => {
    const isEnterprise = process.env.NOVU_ENTERPRISE === 'true' || process.env.CI_EE_TEST === 'true';

    if (isEnterprise) {
      Logger.log('Using enterprise SendWebhookMessage provider', 'EnterpriseProvider');
      return SendWebhookMessage;
    } else {
      Logger.log('Using noop SendWebhookMessage provider', 'EnterpriseProvider');
      return NoopSendWebhookMessage;
    }
  })(),
};

const svixProvider: Provider = {
  provide: 'SVIX_CLIENT',
  useFactory: () => {
    const isEnterprise = process.env.NOVU_ENTERPRISE === 'true' || process.env.CI_EE_TEST === 'true';

    if (isEnterprise) {
      Logger.log('Using enterprise SvixProviderService provider', 'EnterpriseProvider');
      const apiKey = process.env.SVIX_API_KEY;
      if (!apiKey) {
        return null;
      }
      // eslint-disable-next-line @typescript-eslint/no-require-imports
      const { Svix } = require('svix');
      return new Svix(apiKey);
    } else {
      Logger.log('Using noop SvixProviderService provider', 'EnterpriseProvider');
      return null;
    }
  },
};

const USE_CASES = [
  TierRestrictionsValidateUsecase,
  MergeOrCreateDigest,
  AddJob,
  CalculateLimitNovuIntegration,
  CompileEmailTemplate,
  CompileTemplate,
  CreateExecutionDetails,
  ConditionsFilter,
  NormalizeVariables,
  BulkCreateExecutionDetails,
  Digest,
  GetDecryptedIntegrations,
  GetDigestEventsBackoff,
  GetDigestEventsRegular,
  GetLayoutUseCase,
  GetNovuLayout,
  GetNovuProviderCredentials,
  SelectIntegration,
  SelectVariant,
  GetSubscriberTemplatePreference,
  HandleLastFailedJob,
  ProcessTenant,
  QueueNextJob,
  RunJob,
  SendMessage,
  SendMessageChat,
  SendMessageDelay,
  SendMessageEmail,
  SendMessageInApp,
  SendMessagePush,
  SendMessageSms,
  Throttle,
  ExecuteStepCustom,
  StoreSubscriberJobs,
  SetJobAsCompleted,
  SetJobAsFailed,
  TriggerEvent,
  UpdateJobStatus,
  ProcessUnsnoozeJob,
  WebhookFilterBackoffStrategy,
  GetTopicSubscribersUseCase,
  SubscriberJobBound,
  TriggerBroadcast,
  TriggerMulticast,
  CompileInAppTemplate,
  InboundEmailParse,
  ExecuteBridgeJob,
  GetPreferences,
  WorkflowRunService,
  GetSubscriberSchedule,
];

const PROVIDERS: Provider[] = [RedisThrottleService];
const activeWorkersToken: any = {
  provide: 'ACTIVE_WORKERS',
  useFactory: (...args: any[]) => {
    return args;
  },
  inject: ACTIVE_WORKERS,
};

const memoryQueueService = {
  provide: WorkflowInMemoryProviderService,
  useFactory: async () => {
    const memoryService = new WorkflowInMemoryProviderService();

    await memoryService.initialize();

    return memoryService;
  },
};

const inMemoryProviderService = {
  provide: InMemoryProviderService,
  useFactory: (workflowInMemoryProviderService: WorkflowInMemoryProviderService) => {
    return workflowInMemoryProviderService.inMemoryProviderService;
  },
  inject: [WorkflowInMemoryProviderService],
};

@Module({
  imports: [SharedModule, ...enterpriseImports()],
  controllers: [],
  providers: [
    memoryQueueService,
    inMemoryProviderService,
    ...ACTIVE_WORKERS,
    ...PROVIDERS,
    ...USE_CASES,
    ...REPOSITORIES,
    activeWorkersToken,
    webhookProvider,
    svixProvider,
  ],
  exports: [...PROVIDERS, ...USE_CASES, ...REPOSITORIES, activeWorkersToken],
})
export class WorkflowModule implements OnApplicationShutdown {
  constructor(private workflowInMemoryProviderService: WorkflowInMemoryProviderService) {}

  async onApplicationShutdown() {
    await this.workflowInMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - enterpriseImports(): Array<Type | DynamicModule | Promise<DynamicModule> | ForwardReference>)
 - Provider({
  provide: SendWebhookMessage,
  useClass: (())
 - Provider({
  provide: 'SVIX_CLIENT',
  useFactory: ())
 - any({
  provide: 'ACTIVE_WORKERS',
  useFactory: (...args: any[]))
 - memoryQueueService({
  provide: WorkflowInMemoryProviderService,
  useFactory: async ())
 - inMemoryProviderService({
  provide: InMemoryProviderService,
  useFactory: (workflowInMemoryProviderService: WorkflowInMemo...)
Declaraciones 'export' encontradas:
- export class WorkflowModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/active-jobs-metric.service.ts
Tamaño: 4434 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import {
  ActiveJobsMetricQueueService,
  ActiveJobsMetricWorkerService,
  MetricsService,
  QueueBaseService,
  WorkerOptions,
} from '@novu/application-generic';
import { CronExpressionEnum } from '@novu/shared';

const nr = require('newrelic');

const LOG_CONTEXT = 'ActiveJobMetricService';
const METRIC_JOB_ID = 'metrics-job';

@Injectable()
export class ActiveJobsMetricService {
  constructor(
    @Inject('BULLMQ_LIST') private tokenList: QueueBaseService[],
    public readonly activeJobsMetricQueueService: ActiveJobsMetricQueueService,
    public readonly activeJobsMetricWorkerService: ActiveJobsMetricWorkerService,
    private metricsService: MetricsService
  ) {
    if (process.env.NOVU_MANAGED_SERVICE === 'true' && process.env.NEW_RELIC_LICENSE_KEY) {
      this.activeJobsMetricWorkerService.createWorker(this.getWorkerProcessor(), this.getWorkerOptions());

      this.activeJobsMetricWorkerService.worker.on('completed', async (job) => {
        Logger.log({ jobId: job.id }, 'Metric Completed Job', LOG_CONTEXT);
      });

      this.activeJobsMetricWorkerService.worker.on('failed', async (job, error) => {
        Logger.error(error, 'Metric Completed Job failed', LOG_CONTEXT);
      });

      this.addToQueueIfMetricJobExists();
    }
  }

  private addToQueueIfMetricJobExists(): void {
    Promise.resolve(
      this.activeJobsMetricQueueService.queue.getRepeatableJobs().then((job): boolean => {
        let exists = false;
        for (const jobElement of job) {
          if (jobElement.id === METRIC_JOB_ID) {
            exists = true;
          }
        }

        return exists;
      })
    )
      .then(async (exists: boolean): Promise<void> => {
        Logger.log(`metric job exists: ${exists}`, LOG_CONTEXT);

        if (!exists) {
          Logger.log(`metricJob doesn't exist, creating it`, LOG_CONTEXT);

          return await this.activeJobsMetricQueueService.add({
            name: METRIC_JOB_ID,
            data: undefined,
            groupId: '',
            options: {
              jobId: METRIC_JOB_ID,
              repeatJobKey: METRIC_JOB_ID,
              repeat: {
                immediately: true,
                pattern: CronExpressionEnum.EVERY_30_SECONDS,
              },
              removeOnFail: true,
              removeOnComplete: true,
              attempts: 1,
            },
          });
        }

        return undefined;
      })
      .catch((error) => {
        nr.noticeError(error);

        Logger.error('Metric Job Exists function errored', LOG_CONTEXT, error);
      });
  }

  private getWorkerOptions(): WorkerOptions {
    return {
      lockDuration: 900,
      concurrency: 1,
      settings: {},
    };
  }

  private getWorkerProcessor() {
    return async () => {
      return await new Promise<void>(async (resolve, reject): Promise<void> => {
        Logger.log('metric job started', LOG_CONTEXT);
        const deploymentName = process.env.FLEET_NAME ?? 'default';

        try {
          for (const queueService of this.tokenList) {
            const waitCount = queueService.getGroupsJobsCount
              ? await queueService.getGroupsJobsCount()
              : await queueService.getWaitingCount();
            const delayedCount = await queueService.getDelayedCount();
            const activeCount = await queueService.getActiveCount();

            Logger.verbose('Recording active, waiting, and delayed metrics');

            this.metricsService.recordMetric(`Queue/${deploymentName}/${queueService.topic}/waiting`, waitCount);
            this.metricsService.recordMetric(`Queue/${deploymentName}/${queueService.topic}/delayed`, delayedCount);
            this.metricsService.recordMetric(`Queue/${deploymentName}/${queueService.topic}/active`, activeCount);
          }

          return resolve();
        } catch (error) {
          return reject(error);
        }
      });
    };
  }

  public async gracefulShutdown(): Promise<void> {
    Logger.log('Shutting the Active Jobs Metric service down', LOG_CONTEXT);

    if (this.activeJobsMetricQueueService) {
      await this.activeJobsMetricQueueService.gracefulShutdown();
    }
    if (this.activeJobsMetricWorkerService) {
      await this.activeJobsMetricWorkerService.gracefulShutdown();
    }

    Logger.log('Shutting down the Active Jobs Metric service has finished', LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - exists(true;
          }
        }

        return exists;
      })
    )
      .then(async (exists: boolea...)
Declaraciones 'export' encontradas:
- export class ActiveJobsMetricService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/cold-start.service.ts
Tamaño: 702 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { INestApplication } from '@nestjs/common';
import { INovuWorker, ReadinessService } from '@novu/application-generic';

const getWorkers = (app: INestApplication): INovuWorker[] => {
  const workers = app.get('ACTIVE_WORKERS');

  return workers;
};

export const prepareAppInfra = async (app: INestApplication): Promise<void> => {
  const readinessService = app.get(ReadinessService);
  const workers = getWorkers(app);

  await readinessService.pauseWorkers(workers);
};

export const startAppInfra = async (app: INestApplication): Promise<void> => {
  const readinessService = app.get(ReadinessService);
  const workers = getWorkers(app);

  await readinessService.enableWorkers(workers);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getWorkers(app: INestApplication): INovuWorker[])
 - prepareAppInfra(async (app: INestApplication): Promise<void>)
 - startAppInfra(async (app: INestApplication): Promise<void>)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/index.ts
Tamaño: 161 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './active-jobs-metric.service';
export * from './standard.worker';
export * from './subscriber-process.worker';
export * from './workflow.worker';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/standard.worker.spec.ts
Tamaño: 11637 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { faker } from '@faker-js/faker';
import { Test } from '@nestjs/testing';
import { StandardQueueService, WorkflowInMemoryProviderService } from '@novu/application-generic';
import {
  CommunityOrganizationRepository,
  EnvironmentEntity,
  JobEntity,
  JobRepository,
  JobStatusEnum,
  MessageTemplateEntity,
  NotificationRepository,
  NotificationTemplateEntity,
  NotificationTemplateRepository,
  OrganizationEntity,
  SubscriberEntity,
  UserEntity,
} from '@novu/dal';
import { StepTypeEnum } from '@novu/shared';
import {
  EnvironmentService,
  JobsService,
  NotificationTemplateService,
  OrganizationService,
  SubscribersService,
  UserService,
} from '@novu/testing';
import { expect } from 'chai';
import { formatISO } from 'date-fns';
import { setTimeout } from 'timers/promises';
import { v4 as uuid } from 'uuid';
import { SharedModule } from '../../shared/shared.module';
import { HandleLastFailedJob, RunJob, SetJobAsFailed, WebhookFilterBackoffStrategy } from '../usecases';
import { WorkflowModule } from '../workflow.module';
import { StandardWorker } from './standard.worker';

let standardQueueService: StandardQueueService;
let standardWorker: StandardWorker;

describe('Standard Worker', () => {
  let jobRepository: JobRepository;
  let notificationRepository: NotificationRepository;
  let organization: OrganizationEntity;
  let environment: EnvironmentEntity;
  let user: UserEntity;
  let subscriber: SubscriberEntity;
  let subscriberService: SubscribersService;
  let template: NotificationTemplateEntity;
  let jobsService: JobsService;

  before(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [WorkflowModule],
    }).compile();
    process.env.IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

    jobRepository = new JobRepository();
    notificationRepository = new NotificationRepository();
    jobsService = new JobsService();
    const userService = new UserService();

    const card = {
      firstName: faker.name.firstName(),
      lastName: faker.name.lastName(),
    };
    const userEntity: Partial<UserEntity> = {
      lastName: card.lastName,
      firstName: card.firstName,
      email: `${card.firstName}_${card.lastName}_${faker.datatype.uuid()}@gmail.com`.toLowerCase(),
      profilePicture: `https://randomuser.me/api/portraits/men/${Math.floor(Math.random() * 60) + 1}.jpg`,
      tokens: [],
      password: 'asd#Faf4fd',
      showOnBoarding: true,
    };

    user = await userService.createUser(userEntity);

    const organizationService = new OrganizationService();
    organization = await organizationService.createOrganization();
    await organizationService.addMember(organization._id, user._id);

    const environmentService = new EnvironmentService();
    environment = await environmentService.createEnvironment(organization._id, user._id);

    subscriberService = new SubscribersService(organization._id, environment._id);
    subscriber = await subscriberService.createSubscriber();

    const templateService = new NotificationTemplateService(user._id, organization._id, environment._id);
    template = await templateService.createTemplate({ noFeedId: true, noLayoutId: true, noGroupId: true });
    const workflowInMemoryProviderService = moduleRef.get<WorkflowInMemoryProviderService>(
      WorkflowInMemoryProviderService
    );

    standardQueueService = new StandardQueueService(workflowInMemoryProviderService);
    await standardQueueService.queue.obliterate();
  });

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [WorkflowModule, SharedModule],
    }).compile();

    const handleLastFailedJob = moduleRef.get<HandleLastFailedJob>(HandleLastFailedJob);
    const runJob = moduleRef.get<RunJob>(RunJob);
    const setJobAsFailed = moduleRef.get<SetJobAsFailed>(SetJobAsFailed);
    const webhookFilterBackoffStrategy = moduleRef.get<WebhookFilterBackoffStrategy>(WebhookFilterBackoffStrategy);
    const workflowInMemoryProviderService = moduleRef.get<WorkflowInMemoryProviderService>(
      WorkflowInMemoryProviderService
    );
    const organizationRepository = moduleRef.get<CommunityOrganizationRepository>(CommunityOrganizationRepository);

    standardWorker = new StandardWorker(
      handleLastFailedJob,
      runJob,
      setJobAsFailed,
      webhookFilterBackoffStrategy,
      workflowInMemoryProviderService,
      organizationRepository,
      jobRepository
    );
  });

  after(async () => {
    await standardQueueService.queue.drain();
    await standardWorker.gracefulShutdown();
  });

  it('should be initialised properly', async () => {
    expect(standardWorker).to.be.ok;

    expect(standardWorker.DEFAULT_ATTEMPTS).to.eql(3);
    expect(standardWorker.worker).to.deep.include({
      _eventsCount: 2,
      _maxListeners: undefined,
      name: 'standard',
    });
    expect(await standardWorker.bullMqService.getStatus()).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'standard',
      workerIsPaused: false,
      workerIsRunning: true,
    });
    expect(standardWorker.worker.opts).to.deep.include({
      concurrency: 200,
      lockDuration: 90000,
    });
  });

  it('should a job added to the queue be updated as completed if works right', async () => {
    const existingJobs = await standardQueueService.queue.getJobs();
    expect(existingJobs.length).to.equal(0);

    const transactionId = uuid();
    const _environmentId = environment._id;
    const notification = await notificationRepository.create({
      _environmentId,
      _organizationId: organization._id,
      _subscriberId: subscriber._id,
      _templateId: template._id,
      _userId: user._id,
      tags: [],
    });
    const _notificationId = notification._id;
    const _organizationId = organization._id;
    const _subscriberId = subscriber._id;
    const _templateId = template._id;
    const _userId = user._id;

    // Job with fake notification template and fake notification.
    const job: Omit<JobEntity, '_id'> = {
      identifier: 'job-to-complete',
      payload: {},
      overrides: {},
      step: {
        template: {
          _environmentId,
          _organizationId,
          _creatorId: _userId,
          type: StepTypeEnum.TRIGGER,
          content: '',
        } as MessageTemplateEntity,
        _templateId,
      },
      transactionId,
      _notificationId,
      _environmentId,
      _organizationId,
      _userId,
      _subscriberId,
      subscriberId: subscriber.subscriberId,
      status: JobStatusEnum.PENDING,
      _templateId,
      digest: undefined,
      type: StepTypeEnum.TRIGGER,
      providerId: 'sendgrid',
      createdAt: formatISO(Date.now()),
      updatedAt: formatISO(Date.now()),
    };

    const jobCreated = await jobRepository.create(job);

    const jobData = {
      _environmentId: jobCreated._environmentId,
      _id: jobCreated._id,
      _organizationId: jobCreated._organizationId,
      _userId: jobCreated._userId,
    };

    await standardQueueService.add({ name: jobCreated._id, data: jobData, groupId: '0' });

    await jobsService.waitForJobCompletion({
      templateId: _templateId,
      organizationId: organization._id,
    });

    const jobs = await jobRepository.find({ _environmentId, _organizationId, _notificationId });
    expect(jobs.length).to.equal(1);

    expect(jobs[0].status).to.eql(JobStatusEnum.COMPLETED);
  });

  it('should a job added to the queue be updated as failed if it fails', async () => {
    const transactionId = uuid();
    const _environmentId = environment._id;
    const _notificationId = NotificationRepository.createObjectId();
    const _organizationId = organization._id;
    const _subscriberId = subscriber._id;
    const _templateId = NotificationTemplateRepository.createObjectId();
    const _userId = user._id;

    // Job with fake notification template and fake notification.
    const job: Omit<JobEntity, '_id'> = {
      identifier: 'job-to-fail',
      payload: {},
      overrides: {},
      step: {
        template: {
          _environmentId,
          _organizationId,
          _creatorId: _userId,
          type: StepTypeEnum.TRIGGER,
          content: '',
        } as MessageTemplateEntity,
        _templateId,
      },
      transactionId,
      _notificationId,
      _environmentId,
      _organizationId,
      _userId,
      _subscriberId,
      subscriberId: subscriber.subscriberId,
      status: JobStatusEnum.PENDING,
      _templateId,
      digest: undefined,
      type: StepTypeEnum.TRIGGER,
      providerId: 'sendgrid',
      createdAt: formatISO(Date.now()),
      updatedAt: formatISO(Date.now()),
    };

    const jobCreated = await jobRepository.create(job);

    const jobData = {
      _environmentId: jobCreated._environmentId,
      _id: jobCreated._id,
      _organizationId: jobCreated._organizationId,
      _userId: jobCreated._userId,
    };

    await standardQueueService.add({ name: jobCreated._id, data: jobData, groupId: '0' });

    await jobsService.waitForJobCompletion({
      templateId: _templateId,
      organizationId: organization._id,
    });

    /**
     * We pause a bit as little trick to allow the `failed` status to be updated
     * in the callback of the Worker and not having a race condition.
     */
    await setTimeout(100);

    let failedTrigger: JobEntity | null = null;
    do {
      failedTrigger = await jobRepository.findOne({
        _environmentId,
        _organizationId,
        _notificationId,
        status: JobStatusEnum.FAILED,
        type: StepTypeEnum.TRIGGER,
      });
    } while (!failedTrigger || !failedTrigger.error);

    expect(failedTrigger.error).to.deep.include({
      message: `Notification with id ${_notificationId} not found`,
    });
  });

  it('should pause the worker', async () => {
    const isPaused = await standardWorker.worker.isPaused();
    expect(isPaused).to.equal(false);

    const runningStatus = await standardWorker.bullMqService.getStatus();
    expect(runningStatus).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'standard',
      workerIsPaused: false,
      workerIsRunning: true,
    });

    await standardWorker.pause();

    const isNowPaused = await standardWorker.worker.isPaused();
    expect(isNowPaused).to.equal(true);

    const runningStatusChanged = await standardWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'standard',
      workerIsPaused: true,
      workerIsRunning: true,
    });
  });

  it('should resume the worker', async () => {
    await standardWorker.pause();

    const isPaused = await standardWorker.worker.isPaused();
    expect(isPaused).to.equal(true);

    const runningStatus = await standardWorker.bullMqService.getStatus();
    expect(runningStatus).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'standard',
      workerIsPaused: true,
      workerIsRunning: true,
    });

    await standardWorker.resume();

    const isNowPaused = await standardWorker.worker.isPaused();
    expect(isNowPaused).to.equal(false);

    const runningStatusChanged = await standardWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'standard',
      workerIsPaused: false,
      workerIsRunning: true,
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - standardQueueService(new StandardQueueService(workflowInMemoryProviderService);
    await standardQueueService.queue.obli...)
 - standardWorker(new StandardWorker(
      handleLastFailedJob,
      runJob,
      setJobAsFailed,
      webhookFilt...)
 - jobs(await jobRepository.find({ _environmentId, _organizationId, _notificationId });
    expect(jobs.leng...)
 - failedTrigger(await jobRepository.findOne({
        _environmentId,
        _organizationId,
        _notification...)
 - runningStatusChanged(await standardWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
   ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/standard.worker.ts
Tamaño: 7524 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable, Logger } from '@nestjs/common';
import {
  BullMqService,
  getStandardWorkerOptions,
  IStandardDataDto,
  Job,
  PinoLogger,
  StandardWorkerService,
  Store,
  storage,
  WorkerOptions,
  WorkflowInMemoryProviderService,
} from '@novu/application-generic';
import { CommunityOrganizationRepository, JobRepository } from '@novu/dal';
import { JobStatusEnum, ObservabilityBackgroundTransactionEnum } from '@novu/shared';
import {
  HandleLastFailedJob,
  HandleLastFailedJobCommand,
  RunJob,
  RunJobCommand,
  SetJobAsFailed,
  SetJobAsFailedCommand,
  WebhookFilterBackoffStrategy,
} from '../usecases';

const nr = require('newrelic');

const LOG_CONTEXT = 'StandardWorker';

@Injectable()
export class StandardWorker extends StandardWorkerService {
  constructor(
    private handleLastFailedJob: HandleLastFailedJob,
    private runJob: RunJob,
    @Inject(forwardRef(() => SetJobAsFailed)) private setJobAsFailed: SetJobAsFailed,
    @Inject(forwardRef(() => WebhookFilterBackoffStrategy))
    private webhookFilterBackoffStrategy: WebhookFilterBackoffStrategy,
    @Inject(forwardRef(() => WorkflowInMemoryProviderService))
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService,
    private organizationRepository: CommunityOrganizationRepository,
    private jobRepository: JobRepository
  ) {
    super(new BullMqService(workflowInMemoryProviderService));

    this.initWorker(this.getWorkerProcessor(), this.getWorkerOptions());

    this.worker.on('failed', async (job: Job<IStandardDataDto, void, string>, error: Error): Promise<void> => {
      await this.jobHasFailed(job, error);
    });

    this.worker.on('completed', async (job: Job<IStandardDataDto, void, string>): Promise<void> => {
      await this.jobHasCompleted(job);
    });
  }

  private getWorkerOptions(): WorkerOptions {
    return {
      ...getStandardWorkerOptions(),
      settings: {
        backoffStrategy: this.getBackoffStrategies(),
      },
    };
  }

  private extractMinimalJobData(data: IStandardDataDto): {
    environmentId: string;
    jobId: string;
    organizationId: string;
    userId: string;
  } {
    const { _environmentId: environmentId, _id: jobId, _organizationId: organizationId, _userId: userId } = data;

    if (!environmentId || !jobId || !organizationId || !userId) {
      const message = data.payload?.message;

      if (!message) {
        throw new Error(`Job data is missing required fields${JSON.stringify(data)}`);
      }

      return {
        environmentId: message._environmentId,
        jobId: message._jobId,
        organizationId: message._organizationId,
        userId,
      };
    }

    return {
      environmentId,
      jobId,
      organizationId,
      userId,
    };
  }

  private getWorkerProcessor() {
    return async ({ data }: { data: IStandardDataDto }) => {
      const minimalJobData = this.extractMinimalJobData(data);
      const organizationExists = await this.organizationExist(data);

      if (!organizationExists) {
        Logger.verbose(
          `Organization not found for organizationId ${minimalJobData.organizationId}. Skipping job.`,
          LOG_CONTEXT
        );

        return;
      }

      Logger.verbose(`Job ${minimalJobData.jobId} is being processed in the new instance standard worker`, LOG_CONTEXT);

      return await new Promise((resolve, reject) => {
        const _this = this;

        nr.startBackgroundTransaction(
          ObservabilityBackgroundTransactionEnum.JOB_PROCESSING_QUEUE,
          'Trigger Engine',
          function processTask() {
            const transaction = nr.getTransaction();

            storage.run(new Store(PinoLogger.root), () => {
              _this.runJob
                .execute(RunJobCommand.create(minimalJobData))
                .then(resolve)
                .catch((error) => {
                  Logger.error(
                    error,
                    `Failed to run the job ${minimalJobData.jobId} during worker processing`,
                    LOG_CONTEXT
                  );

                  return reject(error);
                })
                .finally(() => {
                  transaction.end();
                });
            });
          }
        );
      });
    };
  }

  private async jobHasCompleted(job: Job<IStandardDataDto, void, string>): Promise<void> {
    let jobId;

    try {
      const minimalData = this.extractMinimalJobData(job.data);
      jobId = minimalData.jobId;

      /*
       * The job might have been cancelled in the pipeline (e.g., by a digest or delay step)
       * In such cases, we only update jobs that are in RUNNING status to COMPLETED, preserving other final statuses
       */
      await this.jobRepository.updateOne(
        {
          _environmentId: minimalData.environmentId,
          _id: minimalData.jobId,
          status: JobStatusEnum.RUNNING,
        },
        {
          $set: {
            status: JobStatusEnum.COMPLETED,
          },
        }
      );
    } catch (error) {
      Logger.error(error, `Failed to set job ${jobId} as completed`, LOG_CONTEXT);
    }
  }

  private async jobHasFailed(job: Job<IStandardDataDto, void, string>, error: Error): Promise<void> {
    let jobId;

    nr.noticeError(error);

    try {
      const minimalData = this.extractMinimalJobData(job.data);
      jobId = minimalData.jobId;

      const hasToBackoff = this.runJob.shouldBackoff(error);
      const hasReachedMaxAttempts = job.attemptsMade >= this.DEFAULT_ATTEMPTS;
      const shouldHandleLastFailedJob = hasToBackoff && hasReachedMaxAttempts;

      const shouldBeSetAsFailed = !hasToBackoff || shouldHandleLastFailedJob;
      if (shouldBeSetAsFailed) {
        let isLastJobInWorkflow = false;

        const jobEntity = await this.jobRepository.findOne({
          _id: minimalData.jobId,
          _environmentId: minimalData.environmentId,
        });

        if (jobEntity) {
          const hasNextJob = await this.jobRepository.findOne({
            _environmentId: minimalData.environmentId,
            _parentId: minimalData.jobId,
          });

          const shouldHaltOnFailure =
            jobEntity.step?.shouldStopOnFail === undefined ? true : jobEntity.step.shouldStopOnFail;

          isLastJobInWorkflow = !hasNextJob || shouldHaltOnFailure;
        }

        await this.setJobAsFailed.execute(SetJobAsFailedCommand.create({ ...minimalData, isLastJobInWorkflow }), error);
      }

      if (shouldHandleLastFailedJob) {
        await this.handleLastFailedJob.execute(
          HandleLastFailedJobCommand.create({
            ...minimalData,
            error,
          })
        );
      }
    } catch (anotherError) {
      Logger.error(anotherError, `Failed to set job ${jobId} as failed`, LOG_CONTEXT);
    }
  }

  private getBackoffStrategies = () => {
    return async (attemptsMade: number, type: string, eventError: Error, eventJob: Job): Promise<number> => {
      return await this.webhookFilterBackoffStrategy.execute({
        attemptsMade,
        environmentId: eventJob?.data?._environmentId,
        eventError,
        eventJob,
        organizationId: eventJob?.data?._organizationId,
        userId: eventJob?.data?._userId,
      });
    };
  };

  private async organizationExist(data: IStandardDataDto): Promise<boolean> {
    const { _organizationId } = data;

    const organization = await this.organizationRepository.findOne({ _id: _organizationId });

    return !!organization;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - processTask()
Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('StandardWorker';

@Injectable()
export class StandardWorker extends StandardWorkerService {
  const...)
 - message(data.payload?.message;

      if (!message) {
        throw new Error(`Job data is missing required ...)
 - organizationExists(await this.organizationExist(data);

      if (!organizationExists) {
        Logger.verbose(
      ...)
 - transaction(nr.getTransaction();

            storage.run(new Store(PinoLogger.root), ())
 - getBackoffStrategies())
Declaraciones 'export' encontradas:
- export class StandardWorker

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/subscriber-process.worker.ts
Tamaño: 2630 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import {
  BullMqService,
  getSubscriberProcessWorkerOptions,
  IProcessSubscriberDataDto,
  PinoLogger,
  Store,
  SubscriberProcessWorkerService,
  storage,
  WorkerOptions,
  WorkflowInMemoryProviderService,
} from '@novu/application-generic';
import { CommunityOrganizationRepository } from '@novu/dal';
import { ObservabilityBackgroundTransactionEnum } from '@novu/shared';
import { SubscriberJobBound } from '../usecases/subscriber-job-bound/subscriber-job-bound.usecase';

const nr = require('newrelic');

const LOG_CONTEXT = 'SubscriberProcessWorker';

@Injectable()
export class SubscriberProcessWorker extends SubscriberProcessWorkerService {
  constructor(
    private subscriberJobBoundUsecase: SubscriberJobBound,
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService,
    private organizationRepository: CommunityOrganizationRepository
  ) {
    super(new BullMqService(workflowInMemoryProviderService));

    this.initWorker(this.getWorkerProcessor(), this.getWorkerOpts());
  }

  public getWorkerProcessor() {
    return async ({ data }: { data: IProcessSubscriberDataDto }) => {
      const organizationExists = await this.organizationExist(data);

      if (!organizationExists) {
        Logger.log(`Organization not found for organizationId ${data.organizationId}. Skipping job.`, LOG_CONTEXT);

        return;
      }

      return await new Promise((resolve, reject) => {
        const _this = this;

        nr.startBackgroundTransaction(
          ObservabilityBackgroundTransactionEnum.SUBSCRIBER_PROCESSING_QUEUE,
          'Trigger Engine',
          function processTask() {
            const transaction = nr.getTransaction();

            storage.run(new Store(PinoLogger.root), () => {
              _this.subscriberJobBoundUsecase
                .execute(data)
                .then(resolve)
                .catch((e) => {
                  Logger.error(e, 'unexpected error', 'SubscriberProcessWorkerService - getWorkerProcessor');
                  nr.noticeError(e);
                  reject(e);
                })

                .finally(() => {
                  transaction.end();
                });
            });
          }
        );
      });
    };
  }

  private getWorkerOpts(): WorkerOptions {
    return getSubscriberProcessWorkerOptions();
  }

  private async organizationExist(data: IProcessSubscriberDataDto): Promise<boolean> {
    const { organizationId } = data;

    const organization = await this.organizationRepository.findOne({ _id: organizationId });

    return !!organization;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - processTask()
Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('SubscriberProcessWorker';

@Injectable()
export class SubscriberProcessWorker extends SubscriberPro...)
 - organizationExists(await this.organizationExist(data);

      if (!organizationExists) {
        Logger.log(`Organizati...)
 - transaction(nr.getTransaction();

            storage.run(new Store(PinoLogger.root), ())
Declaraciones 'export' encontradas:
- export class SubscriberProcessWorker

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/workflow.worker.spec.ts
Tamaño: 5002 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import {
  BullMqService,
  PinoLogger,
  TriggerEvent,
  WorkflowInMemoryProviderService,
  WorkflowQueueService,
} from '@novu/application-generic';
import { CommunityOrganizationRepository } from '@novu/dal';
import { expect } from 'chai';
import { setTimeout } from 'timers/promises';
import { WorkflowModule } from '../workflow.module';
import { WorkflowWorker } from './workflow.worker';

let workflowQueueService: WorkflowQueueService;
let workflowWorker: WorkflowWorker;

describe('Workflow Worker', () => {
  before(async () => {
    process.env.IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

    const moduleRef = await Test.createTestingModule({
      imports: [WorkflowModule],
    }).compile();

    const triggerEventUseCase = moduleRef.get<TriggerEvent>(TriggerEvent);
    const workflowInMemoryProviderService = moduleRef.get<WorkflowInMemoryProviderService>(
      WorkflowInMemoryProviderService
    );
    const organizationRepository = moduleRef.get<CommunityOrganizationRepository>(CommunityOrganizationRepository);

    workflowWorker = new WorkflowWorker(
      triggerEventUseCase,
      workflowInMemoryProviderService,
      organizationRepository,
      new PinoLogger({})
    );

    workflowQueueService = new WorkflowQueueService(workflowInMemoryProviderService);
    await workflowQueueService.queue.obliterate();
  });

  after(async () => {
    await workflowQueueService.queue.drain();
    await workflowWorker.gracefulShutdown();
  });

  it('should be initialised properly', async () => {
    expect(workflowWorker).to.be.ok;
    expect(await workflowWorker.bullMqService.getStatus()).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'trigger-handler',
      workerIsPaused: false,
      workerIsRunning: true,
    });
    expect(workflowWorker.worker.opts).to.deep.include({
      concurrency: 200,
      lockDuration: 90000,
    });
  });

  it('should be able to automatically pull a job from the queue', async () => {
    const existingJobs = await workflowQueueService.queue.getJobs();
    expect(existingJobs.length).to.equal(0);

    const jobId = 'trigger-processor-queue-job-id';
    const _environmentId = 'trigger-processor-queue-environment-id';
    const _organizationId = 'trigger-processor-queue-organization-id';
    const _userId = 'trigger-processor-queue-user-id';
    const jobData = {
      _id: jobId,
      test: 'trigger-processor-queue-job-data',
      _environmentId,
      _organizationId,
      _userId,
    } as any;

    await workflowQueueService.add({ name: jobId, data: jobData, groupId: _organizationId });

    expect(await workflowQueueService.queue.getActiveCount()).to.equal(1);
    expect(await workflowQueueService.queue.getWaitingCount()).to.equal(0);

    // When we arrive to pull the job it has been already pulled by the worker
    const nextJob = await workflowWorker.worker.getNextJob(jobId);
    expect(nextJob).to.equal(undefined);

    await setTimeout(100);

    // No jobs left in queue
    const queueJobs = await workflowQueueService.queue.getJobs();
    expect(queueJobs.length).to.equal(0);
  });

  it('should pause the worker', async () => {
    const isPaused = await workflowWorker.worker.isPaused();
    expect(isPaused).to.equal(false);

    const runningStatus = await workflowWorker.bullMqService.getStatus();
    expect(runningStatus).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'trigger-handler',
      workerIsPaused: false,
      workerIsRunning: true,
    });

    await workflowWorker.pause();

    const isNowPaused = await workflowWorker.worker.isPaused();
    expect(isNowPaused).to.equal(true);

    const runningStatusChanged = await workflowWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'trigger-handler',
      workerIsPaused: true,
      workerIsRunning: true,
    });
  });

  it('should resume the worker', async () => {
    await workflowWorker.pause();

    const isPaused = await workflowWorker.worker.isPaused();
    expect(isPaused).to.equal(true);

    const runningStatus = await workflowWorker.bullMqService.getStatus();
    expect(runningStatus).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'trigger-handler',
      workerIsPaused: true,
      workerIsRunning: true,
    });

    await workflowWorker.resume();

    const isNowPaused = await workflowWorker.worker.isPaused();
    expect(isNowPaused).to.equal(false);

    const runningStatusChanged = await workflowWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'trigger-handler',
      workerIsPaused: false,
      workerIsRunning: true,
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowQueueService(new WorkflowQueueService(workflowInMemoryProviderService);
    await workflowQueueService.queue.obli...)
 - queueJobs(await workflowQueueService.queue.getJobs();
    expect(queueJobs.length).to.equal(0);
  });

  it('s...)
 - runningStatusChanged(await workflowWorker.bullMqService.getStatus();
    expect(runningStatusChanged).to.deep.equal({
   ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/services/workflow.worker.ts
Tamaño: 2510 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  BullMqService,
  getWorkflowWorkerOptions,
  IWorkflowDataDto,
  PinoLogger,
  Store,
  storage,
  TriggerEvent,
  WorkerOptions,
  WorkerProcessor,
  WorkflowInMemoryProviderService,
  WorkflowWorkerService,
} from '@novu/application-generic';
import { CommunityOrganizationRepository } from '@novu/dal';
import { ObservabilityBackgroundTransactionEnum } from '@novu/shared';

const nr = require('newrelic');

@Injectable()
export class WorkflowWorker extends WorkflowWorkerService {
  constructor(
    private triggerEventUsecase: TriggerEvent,
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService,
    private organizationRepository: CommunityOrganizationRepository,
    private logger: PinoLogger
  ) {
    super(new BullMqService(workflowInMemoryProviderService));
    this.logger.setContext(this.constructor.name);
    this.initWorker(this.getWorkerProcessor(), this.getWorkerOptions());
  }

  private getWorkerOptions(): WorkerOptions {
    return getWorkflowWorkerOptions();
  }

  private getWorkerProcessor(): WorkerProcessor {
    return async ({ data }: { data: IWorkflowDataDto }) => {
      const organizationExists = await this.organizationExist(data);

      if (!organizationExists) {
        this.logger.warn(`Organization not found for organizationId ${data.organizationId}. Skipping job.`);

        return;
      }

      return await new Promise((resolve, reject) => {
        const _this = this;

        this.logger.trace(`Job ${data.identifier} is being processed in the new instance workflow worker`);

        nr.startBackgroundTransaction(
          ObservabilityBackgroundTransactionEnum.TRIGGER_HANDLER_QUEUE,
          'Trigger Engine',
          function processTask() {
            const transaction = nr.getTransaction();

            storage.run(new Store(PinoLogger.root), () => {
              _this.triggerEventUsecase
                .execute(data)
                .then(resolve)
                .catch((e) => {
                  nr.noticeError(e);
                  reject(e);
                })
                .finally(() => {
                  transaction.end();
                });
            });
          }
        );
      });
    };
  }

  private async organizationExist(data: IWorkflowDataDto): Promise<boolean> {
    const { organizationId } = data;

    const organization = await this.organizationRepository.findOne({ _id: organizationId });

    return !!organization;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - processTask()
Asignaciones con arrow functions encontradas (posibles funciones):
 - nr(require('newrelic');

@Injectable()
export class WorkflowWorker extends WorkflowWorkerService {
  co...)
 - organizationExists(await this.organizationExist(data);

      if (!organizationExists) {
        this.logger.warn(`Orga...)
 - transaction(nr.getTransaction();

            storage.run(new Store(PinoLogger.root), ())
Declaraciones 'export' encontradas:
- export class WorkflowWorker

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/specs/conditions-filter.usecase.spec.ts
Tamaño: 34876 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CompileTemplate, ConditionsFilter, ConditionsFilterCommand } from '@novu/application-generic';
import { JobEntity, MessageTemplateEntity, NotificationStepEntity } from '@novu/dal';
import {
  BuilderGroupValues,
  FILTER_TO_LABEL,
  FieldLogicalOperatorEnum,
  FieldOperatorEnum,
  FilterParts,
  FilterPartTypeEnum,
  StepTypeEnum,
  TimeOperatorEnum,
} from '@novu/shared';
import axios from 'axios';
import { expect } from 'chai';
import { Duration, sub } from 'date-fns';
import sinon from 'sinon';

describe('Message filter matcher', () => {
  const executionLogQueueService = {
    add: sinon.stub(),
  };
  const conditionsFilter = new ConditionsFilter(
    undefined as any,
    undefined as any,
    undefined as any,
    undefined as any,
    executionLogQueueService as any,
    new CompileTemplate()
  );

  it('should filter correct message by the filter value', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'firstVar',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 'firstVar',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should filter correct message by the filter variable value', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: '{{payload.var}}',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 'firstVar',
            var: 'firstVar',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should match a message for AND filter group', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'firstVar',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'secondVar',
            field: 'secondField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 'firstVar',
            secondField: 'secondVar',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should not match AND group for single bad item', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Title', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'firstVar',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'secondVar',
            field: 'secondField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 'firstVar',
            secondField: 'secondVarBad',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(false);
  });

  it('should match a NOT_EQUAL for EQUAL var', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'firstVar',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
          {
            operator: FieldOperatorEnum.NOT_EQUAL,
            value: 'secondVar',
            field: 'secondField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 'firstVar',
            secondField: 'secondVarBad',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should match a EQUAL for a boolean var', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: true,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should fall thru for no filters item', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match 2', FieldLogicalOperatorEnum.OR, []),
        variables: {
          payload: {
            varField: 'firstVar',
            secondField: 'secondVarBad',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should get larger payload var then filter value', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.LARGER,
            value: '0',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should get smaller payload var then filter value', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.SMALLER,
            value: '3',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 0,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should get larger or equal payload var then filter value', async () => {
    let matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.LARGER_EQUAL,
            value: '0',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);

    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.LARGER_EQUAL,
            value: '3',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });
  it('should check if value is defined in payload', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.IS_DEFINED,
            value: '',
            field: 'emailMessage',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            emailMessage: '<b>This works</b>',
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should check if key is defined or not in subscriber data', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.IS_DEFINED,
            value: '',
            field: 'data.nestedKey',
            on: FilterPartTypeEnum.SUBSCRIBER,
          },
        ]),
        variables: {
          subscriber: {
            firstName: '',
            lastName: '',
            email: '',
            subscriberId: '',
            deleted: false,
            createdAt: '',
            updatedAt: '',
            _id: '',
            _organizationId: '',
            _environmentId: '',
            data: {
              nested_Key: 'nestedValue',
            },
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(false);
  });

  it('should get nested custom subscriber data', async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'nestedValue',
            field: 'data.nestedKey',
            on: FilterPartTypeEnum.SUBSCRIBER,
          },
        ]),
        variables: {
          subscriber: {
            firstName: '',
            lastName: '',
            email: '',
            subscriberId: '',
            deleted: false,
            createdAt: '',
            updatedAt: '',
            _id: '',
            _organizationId: '',
            _environmentId: '',
            data: {
              nestedKey: 'nestedValue',
            },
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it("should return false with nested data that doesn't exist", async () => {
    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'nestedValue',
            field: 'data.nestedKey.doesNotExist',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            data: {
              nestedKey: {
                childKey: 'nestedValue',
              },
            },
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(false);
  });

  it('should get smaller or equal payload var then filter value', async () => {
    let matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.SMALLER_EQUAL,
            value: '3',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 0,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);

    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.SMALLER_EQUAL,
            value: '3',
            field: 'varField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should handle now filters', async () => {
    let matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: {
          _templateId: '123',
          template: {
            subject: 'Test Subject',
            type: StepTypeEnum.EMAIL,
            name: '',
            content: 'Test',
            _organizationId: '123',
            _environmentId: 'asdas',
            _creatorId: '123',
          } as MessageTemplateEntity,
          filters: undefined,
        },
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);

    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: {
          _templateId: '123',
          template: {
            subject: 'Test Subject',
            type: StepTypeEnum.EMAIL,
            name: '',
            content: 'Test',
            _organizationId: '123',
            _environmentId: 'asdas',
            _creatorId: '123',
          } as MessageTemplateEntity,
          filters: [],
        },
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: {
          _templateId: '123',
          template: {
            subject: 'Test Subject',
            type: StepTypeEnum.EMAIL,
            name: '',
            content: 'Test',
            _organizationId: '123',
            _environmentId: 'asdas',
            _creatorId: '123',
          } as MessageTemplateEntity,
          filters: [
            {
              isNegated: false,
              type: 'GROUP',
              value: FieldLogicalOperatorEnum.AND,
              children: [],
            },
          ],
        },
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: {
          _templateId: '123',
          template: {
            subject: 'Test Subject',
            type: StepTypeEnum.EMAIL,
            name: '',
            content: 'Test',
            _organizationId: '123',
            _environmentId: 'asdas',
            _creatorId: '123',
          } as MessageTemplateEntity,
          filters: [
            {
              isNegated: false,
              type: 'GROUP',
              value: FieldLogicalOperatorEnum.AND,
              children: [],
            },
          ],
        },
        variables: {
          payload: {
            varField: 3,
          },
        },
      })
    );

    expect(matchedMessage.passed).to.equal(true);
  });

  it('should handle webhook filter', async () => {
    const gotGetStub = sinon.stub(axios, 'post').resolves(
      Promise.resolve({
        data: { varField: true },
      })
    );

    const matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', undefined, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.WEBHOOK,
            webhookUrl: 'www.user.com/webhook',
          },
        ]),
        variables: { payload: {} },
      })
    );

    expect(matchedMessage.passed).to.equal(true);

    gotGetStub.restore();
  });

  it('should skip async filter if child under OR returned true', async () => {
    const gotGetStub = sinon.stub(axios, 'post').resolves(
      Promise.resolve({
        body: '{"varField":true}',
      })
    );

    let matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'payloadVarField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.WEBHOOK,
            webhookUrl: 'www.user.com/webhook',
          },
        ]),
        variables: { payload: { payloadVarField: true } },
      })
    );

    let requestsCount = gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.equal(true);

    // Reorder children order to make sure it is not random

    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.OR, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.WEBHOOK,
            webhookUrl: 'www.user.com/webhook',
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'payloadVarField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: { payload: { payloadVarField: true } },
      })
    );

    requestsCount = gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.equal(true);

    gotGetStub.restore();
  });

  it('should skip async filter if child under AND returned false', async () => {
    const gotGetStub = sinon.stub(axios, 'post').resolves(
      Promise.resolve({
        body: '{"varField":true}',
      })
    );

    let matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'payloadVarField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.WEBHOOK,
            webhookUrl: 'www.user.com/webhook',
          },
        ]),
        variables: { payload: { payloadVarField: false } },
      })
    );

    let requestsCount = gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.equal(false);

    // Reorder children order to make sure it is not random

    matchedMessage = await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'varField',
            on: FilterPartTypeEnum.WEBHOOK,
            webhookUrl: 'www.user.com/webhook',
          },
          {
            operator: FieldOperatorEnum.EQUAL,
            value: 'true',
            field: 'payloadVarField',
            on: FilterPartTypeEnum.PAYLOAD,
          },
        ]),
        variables: { payload: { payloadVarField: false } },
      })
    );

    requestsCount = gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.equal(false);

    gotGetStub.restore();
  });

  describe('is online filters', () => {
    const getSubscriber = (
      { isOnline }: { isOnline?: boolean } = {},
      { subDuration }: { subDuration?: Duration } = {}
    ) => ({
      firstName: 'John',
      lastName: 'Doe',
      isOnline: isOnline ?? true,
      lastOnlineAt: subDuration ? sub(new Date(), subDuration).toISOString() : undefined,
    });

    describe('isOnline', () => {
      it('allows to process multiple filter parts', async () => {
        const filter = new ConditionsFilter(
          { findOne: () => Promise.resolve(getSubscriber()) } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE,
                value: true,
              },
              {
                operator: FieldOperatorEnum.EQUAL,
                value: 'true',
                field: 'payloadVarField',
                on: FilterPartTypeEnum.PAYLOAD,
              },
            ]),
            variables: { payload: { payloadVarField: true } },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it("doesn't allow to process if the subscriber has no online fields set and filter is true", async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () =>
              Promise.resolve({
                firstName: 'John',
                lastName: 'Doe',
              }),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE,
                value: true,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(false);
      });

      it("doesn't allow to process if the subscriber has no online fields set and filter is false", async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () =>
              Promise.resolve({
                firstName: 'John',
                lastName: 'Doe',
              }),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE,
                value: false,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(false);
      });

      it('allows to process if the subscriber is online', async () => {
        const filter = new ConditionsFilter(
          { findOne: () => Promise.resolve(getSubscriber()) } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE,
                value: true,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it("doesn't allow to process if the subscriber is not online", async () => {
        const filter = new ConditionsFilter(
          { findOne: () => Promise.resolve(getSubscriber({ isOnline: false })) } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE,
                value: true,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(false);
      });
    });

    describe('isOnlineInLast', () => {
      it('allows to process multiple filter parts', async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: true }, { subDuration: { minutes: 3 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 5,
                timeOperator: TimeOperatorEnum.MINUTES,
              },
              {
                operator: FieldOperatorEnum.EQUAL,
                value: 'true',
                field: 'payloadVarField',
                on: FilterPartTypeEnum.PAYLOAD,
              },
            ]),
            variables: { payload: { payloadVarField: true } },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it("doesn't allow to process if the subscriber with no online fields set", async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () =>
              Promise.resolve({
                firstName: 'John',
                lastName: 'Doe',
              }),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 5,
                timeOperator: TimeOperatorEnum.MINUTES,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(false);
      });

      it('allows to process if the subscriber is still online', async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: true }, { subDuration: { minutes: 10 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 5,
                timeOperator: TimeOperatorEnum.MINUTES,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it('allows to process if the subscriber was online in last 5 min', async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: false }, { subDuration: { minutes: 4 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 5,
                timeOperator: TimeOperatorEnum.MINUTES,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it("doesn't allow to process if the subscriber was online more that last 5 min", async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: false }, { subDuration: { minutes: 6 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 5,
                timeOperator: TimeOperatorEnum.MINUTES,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(false);
      });

      it('allows to process if the subscriber was online in last 1 hour', async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: false }, { subDuration: { minutes: 30 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 1,
                timeOperator: TimeOperatorEnum.HOURS,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });

      it('allows to process if the subscriber was online in last 1 day', async () => {
        const filter = new ConditionsFilter(
          {
            findOne: () => Promise.resolve(getSubscriber({ isOnline: false }, { subDuration: { hours: 23 } })),
          } as any,
          undefined as any,
          undefined as any,
          undefined as any,
          executionLogQueueService as any,
          new CompileTemplate()
        );
        const matchedMessage = await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Match', FieldLogicalOperatorEnum.AND, [
              {
                on: FilterPartTypeEnum.IS_ONLINE_IN_LAST,
                value: 1,
                timeOperator: TimeOperatorEnum.DAYS,
              },
            ]),
            variables: { payload: {} },
          })
        );

        expect(matchedMessage.passed).to.equal(true);
      });
    });
  });

  describe('it summarize used filters based on condition', () => {
    it('should add a passed condition', () => {
      const result = ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
          passedFilters: ['payload'],
        },
        {
          filter: FILTER_TO_LABEL.payload,
          field: '',
          expected: '',
          actual: '',
          operator: FieldOperatorEnum.LARGER,
          passed: true,
        }
      );

      expect(result.passedFilters).to.contain('payload');
      expect(result.passedFilters.length).to.eq(1);
      expect(result.filters.length).to.eq(1);
      expect(result.filters).to.contain('payload');
    });

    it('should add a failed condition', () => {
      const result = ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
          passedFilters: [],
        },
        {
          filter: FILTER_TO_LABEL.payload,
          field: '',
          expected: '',
          actual: '',
          operator: FieldOperatorEnum.LARGER,
          passed: false,
        }
      );

      expect(result.failedFilters).to.contain('payload');
      expect(result.failedFilters.length).to.eq(1);
      expect(result.filters.length).to.eq(1);
      expect(result.filters).to.contain('payload');
    });

    it('should add online for both cases of online', () => {
      let result = ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
          passedFilters: [],
        },
        {
          filter: FILTER_TO_LABEL.isOnlineInLast,
          field: '',
          expected: '',
          actual: '',
          operator: FieldOperatorEnum.LARGER,
          passed: true,
        }
      );

      expect(result.passedFilters).to.contain('online');
      expect(result.passedFilters.length).to.eq(1);
      expect(result.filters.length).to.eq(1);
      expect(result.filters).to.contain('online');

      result = ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
          passedFilters: [],
        },
        {
          filter: FILTER_TO_LABEL.isOnline,
          field: '',
          expected: '',
          actual: '',
          operator: FieldOperatorEnum.LARGER,
          passed: true,
        }
      );

      expect(result.passedFilters).to.contain('online');
      expect(result.passedFilters.length).to.eq(1);
      expect(result.filters.length).to.eq(1);
      expect(result.filters).to.contain('online');
    });
  });
});

function makeStep(
  name: string,
  groupOperator: BuilderGroupValues = FieldLogicalOperatorEnum.AND,
  filters: FilterParts[],
  channel = StepTypeEnum.EMAIL
): NotificationStepEntity {
  return {
    _templateId: '123',
    template: {
      subject: 'Test Subject',
      type: channel,
      name,
      content: 'Test',
      _organizationId: '123',
      _environmentId: 'asdas',
      _creatorId: '123',
    } as MessageTemplateEntity,
    filters: filters?.length
      ? [
          {
            isNegated: false,
            type: 'GROUP',
            value: groupOperator,
            children: filters,
          },
        ]
      : [],
  };
}

function mapConditionsFilterCommand({
  step,
  variables,
}: {
  step: NotificationStepEntity;
  variables?: any;
}): ConditionsFilterCommand {
  return {
    variables: { ...(variables || {}) },
    filters: [],
    step,
    environmentId: '123',
    organizationId: '123',
    userId: '123',
    job: {
      _notificationId: '123',
      transactionId: '123',
      _environmentId: '123',
      _organizationId: '123',
      _subscriberId: '123',
      subscriberId: '1234',
    } as JobEntity,
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - makeStep(name: string,
  groupOperator: BuilderGroupValues = FieldLogicalOperatorEnum.AND,
  filters: FilterParts[],
  channel = StepTypeEnum.EMAIL)
 - mapConditionsFilterCommand({
  step,
  variables,
}: {
  step: NotificationStepEntity;
  variables?: any;
})
Asignaciones con arrow functions encontradas (posibles funciones):
 - conditionsFilter(new ConditionsFilter(
    undefined as any,
    undefined as any,
    undefined as any,
    undefine...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Title', Fi...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: {
          _templat...)
 - matchedMessage(await conditionsFilter.filter(
      mapConditionsFilterCommand({
        step: makeStep('Correct Ma...)
 - requestsCount(gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.e...)
 - requestsCount(gotGetStub.callCount;

    expect(requestsCount).to.equal(0);
    expect(matchedMessage.passed).to.e...)
 - filter(new ConditionsFilter(
          { findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          { findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          { findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - filter(new ConditionsFilter(
          {
            findOne: ())
 - matchedMessage(await filter.filter(
          mapConditionsFilterCommand({
            step: makeStep('Correct Matc...)
 - result(ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
         ...)
 - result(ConditionsFilter.sumFilters(
        {
          filters: [],
          failedFilters: [],
         ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/specs/inbound-email-parse.spec.ts
Tamaño: 12212 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test, TestingModule } from '@nestjs/testing';
import { CompileTemplate } from '@novu/application-generic';
import { JobRepository, MessageRepository } from '@novu/dal';
import axios, { AxiosResponse } from 'axios';
import { expect } from 'chai';
import sinon from 'sinon';
import { InboundEmailParseCommand } from '../usecases/inbound-email-parse/inbound-email-parse.command';
import { InboundEmailParse, IUserWebhookPayload } from '../usecases/inbound-email-parse/inbound-email-parse.usecase';

const axiosInstance = axios.create();

const eventTriggerPath = '/v1/events/trigger';
const USER_MAIL_DOMAIN = 'mail.domain.com';
const USER_PARSE_WEBHOOK = 'user-parse.com/webhook/{{compiledVariable}}';

describe('Should handle the new arrived mail', () => {
  let inboundEmailParseUsecase: InboundEmailParse;

  let sandbox;

  beforeEach(async () => {
    sandbox = sinon.createSandbox();

    const module: TestingModule = await Test.createTestingModule({
      providers: [InboundEmailParse, JobRepository, MessageRepository, CompileTemplate],
    }).compile();

    inboundEmailParseUsecase = module.get<InboundEmailParse>(InboundEmailParse);
  });

  afterEach(async () => {
    sandbox.restore();
  });

  it('should send webhook request to the users webhook', async () => {
    const mail = getMailData();

    const axiosPostStub = sandbox.stub(axios, 'post').resolves();
    const getEntitiesStub = sandbox.stub(inboundEmailParseUsecase, 'getEntities').resolves(getEntitiesStubObject);

    await inboundEmailParseUsecase.execute(InboundEmailParseCommand.create(mail));

    sinon.assert.calledOnce(axiosPostStub);
    axiosPostStub.calledWith(sinon.match.array);
    const { args } = axiosPostStub.getCall(0);

    const webhook: string = args[0];
    const payload: IUserWebhookPayload = args[1];

    // Should compile the payload variables
    expect(webhook).to.equal(USER_PARSE_WEBHOOK.replace('{{compiledVariable}}', 'test-env'));
    expect(payload.mail).to.be.ok;
    expect(payload.payload).to.ok;
    expect(payload.template).to.ok;
    expect(payload.message).to.ok;
    expect(payload.transactionId).to.ok;
    expect(payload.hmac).to.ok;
    expect(payload.notification).to.ok;
    expect(payload.templateIdentifier).to.ok;
  });

  it('should not send webhook request with missing transactionId', async () => {
    try {
      // const message = await triggerEmail();
      const mail = getMailData({ skipTransactionId: true });

      await inboundEmailParseUsecase.execute(InboundEmailParseCommand.create(mail));

      throw new Error('Should not reach here, en error should be thrown');
    } catch (e) {
      expect(e.message).to.contains('Missing transactionId on address');
    }
  });

  it('should not send webhook request with when domain white list', async () => {
    try {
      const mail = getMailData({ userDomain: 'invalid-domain.com' });
      const getEntitiesStub = sandbox.stub(inboundEmailParseUsecase, 'getEntities').resolves(getEntitiesStubObject);

      await inboundEmailParseUsecase.execute(InboundEmailParseCommand.create(mail));

      throw new Error('Should not reach here, en error should be thrown');
    } catch (e) {
      expect(e.message).to.equal('Domain is not in environment white list');
    }
  });

  it('should not send webhook request when missing replay callback url', async () => {
    try {
      const entitiesWithMissingParseWebhook = getEntitiesStubObject;
      entitiesWithMissingParseWebhook.template.steps[0].replyCallback = {} as any;

      const mail = getMailData();
      const getEntitiesStub = sandbox
        .stub(inboundEmailParseUsecase, 'getEntities')
        .resolves(entitiesWithMissingParseWebhook);

      await inboundEmailParseUsecase.execute(InboundEmailParseCommand.create(mail));

      throw new Error('Should not reach here, en error should be thrown');
    } catch (e) {
      expect(e.message).to.contains('Missing parse webhook on template');
    }
  });

  interface IMailData {
    message?: any;
    transactionId?: string;
    environmentId?: string;
    userDomain?: string;
    skipTransactionId?: boolean;
  }

  function getMailData({ transactionId, environmentId, userDomain, skipTransactionId }: IMailData = {}) {
    const mail = JSON.parse(mailData) as InboundEmailParseCommand;

    const userNameDelimiter = '-nv-e=';

    const [user, domain] = mail.to[0].address.split('@');
    const toMetaIds = user.split('+')[1];
    const [mailTransactionId, mailEnvironmentId] = toMetaIds.split(userNameDelimiter);

    const parsedTransactionId = skipTransactionId ? '' : transactionId || mailTransactionId;

    mail.to[0].address = `parse+${parsedTransactionId}-nv-e=${environmentId || mailTransactionId}@${
      userDomain || USER_MAIL_DOMAIN
    }`;

    return mail;
  }
});

const mailData =
  '{"html":"<b>This is a test email sent to a local SMTP server.</b>","text":"This is a test email sent to a local SMTP server.","headers":{"content-type":"multipart/alternative; boundary=\\"--_NmP-f7fda3731bcaef89-Part_1\\"","from":"sender@example.com","to":"parse+c50420f2-6aef-48f5-9a41-3c9dd1a81ba5-nv-e=63945d20068f12be94e79cb0@local-demo.com","subject":"Test email","message-id":"<705c2187-b2ad-2b1e-e3fc-9f40a840e736@example.com>","date":"Wed, 25 Jan 2023 20:37:24 +0000","mime-version":"1.0"},"subject":"Test email","messageId":"705c2187-b2ad-2b1e-e3fc-9f40a840e736@example.com","priority":"normal","from":[{"address":"sender@example.com","name":""}],"to":[{"address":"parse+c50420f2-6aef-48f5-9a41-3c9dd1a81ba5-nv-e=63945d20068f12be94e79cb0@local-demo.com","name":""}],"date":"2023-01-25T20:37:24.000Z","dkim":"failed","spf":"failed","spamScore":0,"language":"english","cc":[],"connection":{"id":"bb49053e-a142-4492-9459-61d7960b0857","remoteAddress":"127.0.0.1","remotePort":55722,"clientHostname":"[127.0.0.1]","openingCommand":"HELLO","hostNameAppearsAs":"[127.0.0.1]","xClient":{},"xForward":{},"transmissionType":"ESMTPS","tlsOptions":{"name":"TLS_AES_256_GCM_SHA384","standardName":"TLS_AES_256_GCM_SHA384","version":"TLSv1.3"},"envelope":{"mailFrom":{"address":"sender@example.com","args":false},"rcptTo":[{"address":"parse+c50420f2-6aef-48f5-9a41-3c9dd1a81ba5@local-demo.com","args":false}]},"transaction":1,"mailPath":".tmp/bb49053e-a142-4492-9459-61d7960b0857"},"envelopeFrom":{"address":"sender@example.com","args":false},"envelopeTo":[{"address":"parse+c50420f2-6aef-48f5-9a41-3c9dd1a81ba5-nv-e=63945d20068f12be94e79cb0@local-demo.com","args":false}]}\n';

const getEntitiesStubObject = {
  template: {
    _id: '657ec2402c5ac81fb1e0f007',
    steps: [
      {
        active: true,
        replyCallback: {
          active: true,
          url: 'user-parse.com/webhook/{{compiledVariable}}',
        },
        shouldStopOnFail: false,
        filters: [],
        _templateId: '657ec2402c5ac81fb1e0f005',
        metadata: {
          timed: {
            weekDays: [],
            monthDays: [],
          },
        },
        variants: [],
        _id: '657ec2402c5ac81fb1e0f00c',
      },
    ],
  },
  notification: {
    _id: '657ec24013bdfd2ae0785f3f',
    _templateId: '657ec2402c5ac81fb1e0f007',
    _environmentId: '657ec2402c5ac81fb1e0efbc',
    _organizationId: '657ec2402c5ac81fb1e0efb6',
    _subscriberId: '657ec2402c5ac81fb1e0efff',
    transactionId: 'ec7d3f9b-ede7-4287-8761-0b192d473f7c',
    channels: ['email'],
    to: {
      subscriberId: '657ec2402c5ac81fb1e0effe',
      lastName: 'Smith',
      email: 'test@email.novu',
    },
    payload: {
      organizationName: 'Umbrella Corp',
      compiledVariable: 'test-env',
    },
    createdAt: '2023-12-17T09:41:20.863Z',
    updatedAt: '2023-12-17T09:41:20.863Z',
    __v: 0,
  },
  subscriber: {
    _id: '657ec2402c5ac81fb1e0efff',
    subscriberId: '657ec2402c5ac81fb1e0effe',
  },
  environment: {
    _id: '657ec2402c5ac81fb1e0efbc',
    apiKeys: [
      {
        key: 'e088ccce-d18c-42d6-9acb-a40b232b846f',
        _userId: '657ec2402c5ac81fb1e0efb4',
        _id: '657ec2402c5ac81fb1e0efbd',
      },
    ],
    dns: {
      mxRecordConfigured: true,
      inboundParseDomain: 'mail.domain.com',
    },
  },
  job: {
    _id: '657ec24013bdfd2ae0785f41',
    identifier: 'test-event-6f1b2973-d4bd-44fc-889e-4b9024eb2bea',
    status: 'completed',
    payload: {
      organizationName: 'Umbrella Corp',
      compiledVariable: 'test-env',
    },
    tenant: null,
    step: {
      replyCallback: {
        active: true,
        url: 'user-parse.com/webhook/{{compiledVariable}}',
      },
      metadata: {
        timed: {
          weekDays: [],
          monthDays: [],
        },
      },
      active: true,
      shouldStopOnFail: false,
      filters: [],
      _templateId: '657ec2402c5ac81fb1e0f005',
      variants: [],
      _id: '657ec2402c5ac81fb1e0f00c',
      id: '657ec2402c5ac81fb1e0f00c',
      template: {
        _id: '657ec2402c5ac81fb1e0f005',
        type: 'email',
        active: true,
        name: 'Message Name',
        subject: 'Test email {{nested.subject}}',
        variables: [],
        content: [
          {
            type: 'text',
            content: 'Hello {{subscriber.lastName}}, Welcome to {{organizationName}}',
          },
        ],
        _environmentId: '657ec2402c5ac81fb1e0efbc',
        _organizationId: '657ec2402c5ac81fb1e0efb6',
        _creatorId: '657ec2402c5ac81fb1e0efb4',
        _feedId: '657ec2402c5ac81fb1e0efeb',
        _layoutId: '657ec2402c5ac81fb1e0efc1',
        deleted: false,
        createdAt: '2023-12-17T09:41:20.768Z',
        updatedAt: '2023-12-17T09:41:20.768Z',
        __v: 0,
        id: '657ec2402c5ac81fb1e0f005',
      },
    },
    _templateId: '657ec2402c5ac81fb1e0f007',
    transactionId: 'ec7d3f9b-ede7-4287-8761-0b192d473f7c',
    _notificationId: '657ec24013bdfd2ae0785f3f',
    subscriberId: '657ec2402c5ac81fb1e0effe',
    _subscriberId: '657ec2402c5ac81fb1e0efff',
    _userId: '657ec2402c5ac81fb1e0efb4',
    _organizationId: '657ec2402c5ac81fb1e0efb6',
    _environmentId: '657ec2402c5ac81fb1e0efbc',
    digest: {
      events: [],
      timed: {
        weekDays: [],
        monthDays: [],
      },
    },
    type: 'email',
    providerId: 'sendgrid',
    createdAt: '2023-12-17T09:41:20.866Z',
    __v: 0,
    updatedAt: '2023-12-17T09:41:20.978Z',
  },
  message: {
    cta: {
      action: {
        buttons: [],
      },
    },
    _id: '657ec24013bdfd2ae0785f54',
    _templateId: '657ec2402c5ac81fb1e0f007',
    _environmentId: '657ec2402c5ac81fb1e0efbc',
    _messageTemplateId: '657ec2402c5ac81fb1e0f005',
    _notificationId: '657ec24013bdfd2ae0785f3f',
    _organizationId: '657ec2402c5ac81fb1e0efb6',
    _subscriberId: '657ec2402c5ac81fb1e0efff',
    _jobId: '657ec24013bdfd2ae0785f41',
    templateIdentifier: 'test-event-6f1b2973-d4bd-44fc-889e-4b9024eb2bea',
    email: 'test@email.novu',
    subject: 'Test email',
    channel: 'email',
    providerId: 'sendgrid',
    deviceTokens: [],
    seen: false,
    read: false,
    status: 'sent',
    transactionId: 'ec7d3f9b-ede7-4287-8761-0b192d473f7c',
    payload: {
      organizationName: 'Umbrella Corp',
      compiledVariable: 'test-env',
    },
    deleted: false,
    createdAt: '2023-12-17T09:41:20.940Z',
    updatedAt: '2023-12-17T09:41:20.970Z',
    __v: 0,
    content: [
      {
        type: 'text',
        content: 'Hello Smith, Welcome to Umbrella Corp',
        url: '',
      },
    ],
    id: '657ec24013bdfd2ae0785f54',
  },
};
export async function sendTrigger(
  session,
  template,
  newSubscriberIdInAppNotification: string,
  payload: Record<string, unknown> = {},
  overrides: Record<string, unknown> = {},
  tenant?: string,
  actor?: string
): Promise<AxiosResponse> {
  return await axiosInstance.post(
    `${session.serverUrl}${eventTriggerPath}`,
    {
      name: template.triggers[0].identifier,
      to: [{ subscriberId: newSubscriberIdInAppNotification, lastName: 'Smith', email: 'test@email.novu' }],
      payload: {
        organizationName: 'Umbrella Corp',
        compiledVariable: 'test-env',
        ...payload,
      },
      overrides,
      tenant,
      actor,
    },
    {
      headers: {
        authorization: `ApiKey ${session.apiKey}`,
      },
    }
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getMailData({ transactionId, environmentId, userDomain, skipTransactionId }: IMailData = {})
 - sendTrigger(session,
  template,
  newSubscriberIdInAppNotification: string,
  payload: Record<string, unknown> = {},
  overrides: Record<string, unknown> = {},
  tenant?: string,
  actor?: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - USER_PARSE_WEBHOOK('user-parse.com/webhook/{{compiledVariable}}';

describe('Should handle the new arrived mail', ())
 - inboundEmailParseUsecase(module.get<InboundEmailParse>(InboundEmailParse);
  });

  afterEach(async ())
 - IUserWebhookPayload(args[1];

    // Should compile the payload variables
    expect(webhook).to.equal(USER_PARSE_WEBHOO...)
 - mail(getMailData({ skipTransactionId: true });

      await inboundEmailParseUsecase.execute(InboundEmail...)
 - getEntitiesStub(sandbox.stub(inboundEmailParseUsecase, 'getEntities').resolves(getEntitiesStubObject);

      await ...)
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/index.ts
Tamaño: 301 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './execute-bridge-job';
export * from './handle-last-failed-job';
export * from './process-unsnooze-job';
export * from './queue-next-job';
export * from './run-job';
export * from './send-message';
export * from './update-job-status';
export * from './webhook-filter-backoff-strategy';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/noop-send-webhook-message.usecase.ts
Tamaño: 294 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { SendWebhookMessageCommand } from '@novu/application-generic';

@Injectable()
export class NoopSendWebhookMessage {
  async execute(_command: SendWebhookMessageCommand): Promise<{ eventId: string } | undefined> {
    return undefined;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NoopSendWebhookMessage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/add-job.command.ts
Tamaño: 372 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { JobEntity } from '@novu/dal';
import { StatelessControls } from '@novu/shared';
import { IsDefined } from 'class-validator';

export class AddJobCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  jobId: string;

  @IsDefined()
  job: JobEntity;

  controls?: StatelessControls;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AddJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/add-job.usecase.ts
Tamaño: 34045 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable } from '@nestjs/common';
import {
  ComputeJobWaitDurationService,
  ConditionsFilter,
  ConditionsFilterCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  DurationUtils,
  getDigestType,
  getNestedValue,
  IFilterVariables,
  InstrumentUsecase,
  isDynamicOutput,
  isLookBackDigestOutput,
  isRegularOutput,
  isTimedOutput,
  JobsOptions,
  LogDecorator,
  NormalizeVariables,
  NormalizeVariablesCommand,
  PinoLogger,
  RedisThrottleService,
  StandardQueueService,
  StepRunRepository,
  StepRunStatus,
  TierRestrictionsValidateCommand,
  TierRestrictionsValidateUsecase,
  WorkflowRunStatusEnum,
} from '@novu/application-generic';
import { JobEntity, JobRepository, JobStatusEnum, SubscriberRepository } from '@novu/dal';
import { DelayOutput, DigestOutput, ExecuteOutput } from '@novu/framework/internal';
import {
  castUnitToDigestUnitEnum,
  DelayTypeEnum,
  DeliveryLifecycleStatusEnum,
  DigestCreationResultEnum,
  DigestTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IDelayDynamicMetadata,
  IDelayRegularMetadata,
  IDelayTimedMetadata,
  IDigestBaseMetadata,
  IDigestRegularMetadata,
  IDigestTimedMetadata,
  IWorkflowStepMetadata,
  StepTypeEnum,
} from '@novu/shared';
import { parseExpression as parseCronExpression } from 'cron-parser';
import { differenceInMilliseconds } from 'date-fns';
import { formatInTimeZone } from 'date-fns-tz';
import _ from 'lodash';
import { ExecuteBridgeJob, ExecuteBridgeJobCommand } from '../execute-bridge-job';
import { AddJobCommand } from './add-job.command';
import { MergeOrCreateDigestCommand } from './merge-or-create-digest.command';
import { MergeOrCreateDigest } from './merge-or-create-digest.usecase';
import { validateDigest } from './validation';

export enum BackoffStrategiesEnum {
  WEBHOOK_FILTER_BACKOFF = 'webhookFilterBackoff',
}

/*
 * @description: This is the result of the add job usecase
 *
 * Returns undefined when the end result is not determined yet
 */
type AddJobResult = {
  workflowStatus: WorkflowRunStatusEnum | null;
  deliveryLifecycleStatus: DeliveryLifecycleStatusEnum | null;
  stepStatus?: StepRunStatus;
};

@Injectable()
export class AddJob {
  constructor(
    private jobRepository: JobRepository,
    @Inject(forwardRef(() => StandardQueueService))
    private standardQueueService: StandardQueueService,
    @Inject(forwardRef(() => CreateExecutionDetails))
    private createExecutionDetails: CreateExecutionDetails,
    private mergeOrCreateDigestUsecase: MergeOrCreateDigest,
    @Inject(forwardRef(() => ComputeJobWaitDurationService))
    private computeJobWaitDurationService: ComputeJobWaitDurationService,
    @Inject(forwardRef(() => ConditionsFilter))
    private conditionsFilter: ConditionsFilter,
    private normalizeVariablesUsecase: NormalizeVariables,
    private tierRestrictionsValidateUsecase: TierRestrictionsValidateUsecase,
    private executeBridgeJob: ExecuteBridgeJob,
    private stepRunRepository: StepRunRepository,
    private subscriberRepository: SubscriberRepository,
    private redisThrottleService: RedisThrottleService,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  @LogDecorator()
  public async execute(command: AddJobCommand): Promise<AddJobResult> {
    this.logger.trace('Getting Job');
    const { job } = command;
    this.logger.debug(`Job contents for job ${job._id}`, job);

    if (!job) {
      this.logger.warn(`Job was null in both the input and search`);

      return {
        workflowStatus: null,
        deliveryLifecycleStatus: null,
      };
    }

    this.logger.info(`Scheduling New Job ${job._id} of type: ${job.type}`);
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.STEP_QUEUED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: false,
      })
    );

    const result = isJobDeferredType(job.type)
      ? await this.executeDeferredJob(command)
      : await this.executeNoneDeferredJob(command);

    return result;
  }

  private async executeDeferredJob(command: AddJobCommand): Promise<AddJobResult> {
    const { job } = command;

    let digestAmount: number | undefined;
    let delayAmount: number | undefined;

    const variables = await this.normalizeVariablesUsecase.execute(
      NormalizeVariablesCommand.create({
        filters: command.job.step.filters || [],
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        userId: command.userId,
        step: job.step,
        job,
      })
    );

    const shouldRun = await this.conditionsFilter.filter(
      ConditionsFilterCommand.create({
        filters: job.step.filters || [],
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        userId: command.userId,
        step: job.step,
        job,
        variables,
      })
    );

    const filterVariables = shouldRun.variables;
    const filtered = !shouldRun.passed;
    const bridgeResponse = await this.fetchBridgeData(command, filterVariables);

    if (filtered || bridgeResponse?.options?.skip) {
      return {
        workflowStatus: null,
        deliveryLifecycleStatus: null,
        stepStatus: JobStatusEnum.SKIPPED,
      };
    }

    let digestResult: {
      digestAmount: number;
      digestCreationResult: DigestCreationResultEnum;
      cronExpression?: string;
    } | null = null;

    const subscriber = await this.subscriberRepository.findOne(
      {
        _id: job._subscriberId,
        _environmentId: job._environmentId,
      },
      'timezone',
      { readPreference: 'secondaryPreferred' }
    );
    const bridgeDelayAmountDate = this.getBridgeNextCronDate(bridgeResponse, subscriber?.timezone);
    const bridgeDelayAmount = bridgeDelayAmountDate
      ? differenceInMilliseconds(bridgeDelayAmountDate, new Date())
      : undefined;

    if (job.type === StepTypeEnum.DIGEST) {
      digestResult = await this.handleDigest({
        command,
        job,
        bridgeResponse,
        bridgeDelayAmountDate,
        bridgeDelayAmount,
        timezone: subscriber?.timezone,
      });

      if (isShouldHaltJobExecution(digestResult.digestCreationResult)) {
        if (digestResult.digestCreationResult === DigestCreationResultEnum.MERGED) {
          return {
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.MERGED,
          };
        }

        if (digestResult.digestCreationResult === DigestCreationResultEnum.SKIPPED) {
          return {
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.SKIPPED,
          };
        }
      }

      digestAmount = digestResult.digestAmount;
    }

    if (job.type === StepTypeEnum.THROTTLE) {
      try {
        const throttleResult = await this.handleThrottle(command, job, bridgeResponse);

        if (throttleResult.shouldSkip) {
          await this.handleThrottleSkip(
            command,
            job,
            throttleResult as { shouldSkip: boolean; executionCount: number; threshold: number; throttledUntil: string }
          );

          return {
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.SKIPPED,
          };
        }
      } catch (error) {
        return await this.handleStepValidationError(
          command,
          job,
          error,
          StepTypeEnum.THROTTLE,
          DetailEnum.DELAY_MISCONFIGURATION
        );
      }
    }

    if (job.type === StepTypeEnum.DELAY) {
      try {
        delayAmount = await this.handleDelay({
          command,
          job,
          bridgeResponse,
          bridgeDelayAmountDate,
          bridgeDelayAmount,
          timezone: subscriber?.timezone,
        });

        if (delayAmount === undefined) {
          this.logger.warn(`Delay Amount does not exist on a delay job ${job._id}`);

          return {
            workflowStatus: null,
            deliveryLifecycleStatus: null,
          };
        }
      } catch (error) {
        return await this.handleStepValidationError(
          command,
          job,
          error,
          StepTypeEnum.DELAY,
          DetailEnum.DELAY_MISCONFIGURATION
        );
      }
    }

    if ((digestAmount || delayAmount) && filtered) {
      this.logger.trace(`Delay for job ${job._id} will be 0 because job was filtered`);
    }

    const delay = this.getExecutionDelayAmount(filtered, digestAmount, delayAmount);

    const valid = await this.validateDeferDuration(delay, job, command, digestResult?.cronExpression);

    if (!valid) {
      throw new Error('Defer duration limit exceeded');
    }

    const updatedJob = await this.jobRepository.findOne({
      _id: job._id,
      _environmentId: job._environmentId,
    });

    if (!updatedJob) {
      throw new Error(`Job with id ${job._id} not found`);
    }

    await this.stepRunRepository.create(updatedJob, {
      status: JobStatusEnum.DELAYED,
    });

    await this.queueJob({ job, delay, untilDate: bridgeDelayAmountDate, timezone: subscriber?.timezone });

    return {
      workflowStatus: null,
      deliveryLifecycleStatus: null,
    };
  }

  private async validateDeferDuration(
    delay: number,
    job: JobEntity,
    command: AddJobCommand,
    cronExpression?: string
  ): Promise<boolean> {
    const errors = await this.tierRestrictionsValidateUsecase.execute(
      TierRestrictionsValidateCommand.create({
        deferDurationMs: delay,
        stepType: job.type,
        organizationId: command.organizationId,
        cron: cronExpression,
      })
    );

    if (errors.length > 0) {
      const uniqueErrors = _.uniq(errors.map((error) => error.message));
      this.logger.warn({ errors, jobId: job._id }, uniqueErrors);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.DEFER_DURATION_LIMIT_EXCEEDED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ errors: uniqueErrors }),
        })
      );

      return false;
    }

    return true;
  }

  private async executeNoneDeferredJob(command: AddJobCommand): Promise<AddJobResult> {
    const { job } = command;

    this.logger.trace(`Updating status to queued for job ${job._id}`);
    await this.jobRepository.updateStatus(command.environmentId, job._id, JobStatusEnum.QUEUED);

    await this.stepRunRepository.create(job, {
      status: JobStatusEnum.QUEUED,
    });

    await this.queueJob({ job, delay: 0, untilDate: null });

    return {
      workflowStatus: null,
      deliveryLifecycleStatus: null,
    };
  }

  private async handleDelay({
    command,
    job,
    bridgeResponse,
    bridgeDelayAmountDate,
    bridgeDelayAmount,
    timezone,
  }: {
    command: AddJobCommand;
    job: JobEntity;
    bridgeResponse: ExecuteOutput | null;
    bridgeDelayAmountDate: Date | null;
    bridgeDelayAmount: number | undefined;
    timezone: string | undefined;
  }) {
    let metadata: IWorkflowStepMetadata;
    if (bridgeResponse) {
      // Assign V2 metadata from Bridge response
      metadata = await this.updateMetadata(bridgeResponse, command, bridgeDelayAmountDate);
    } else {
      // Assign V1 metadata from known values
      metadata = command.job.step.metadata as IWorkflowStepMetadata;
    }

    const delayAmount =
      bridgeDelayAmount ??
      (await this.computeJobWaitDurationService.calculateDelay({
        stepMetadata: metadata,
        payload: job.payload,
        overrides: job.overrides,
        timezone,
      }));

    const delayType = 'type' in metadata ? metadata.type : null;
    if (delayType === DelayTypeEnum.DYNAMIC) {
      await this.validateDynamicDuration(command, job, delayAmount, StepTypeEnum.DELAY);
    }

    await this.jobRepository.updateStatus(command.environmentId, job._id, JobStatusEnum.DELAYED);

    this.logger.debug(`Delay step Amount is: ${delayAmount}`);

    return delayAmount;
  }

  private async validateDynamicDuration(
    command: AddJobCommand,
    job: JobEntity,
    durationMs: number,
    stepType: StepTypeEnum.DELAY | StepTypeEnum.THROTTLE
  ): Promise<void> {
    const stepTypeName = stepType === StepTypeEnum.DELAY ? 'delay' : 'throttle';
    const pastTimeDetail =
      stepType === StepTypeEnum.DELAY ? DetailEnum.DELAY_MISCONFIGURATION : DetailEnum.THROTTLE_WINDOW_IN_PAST;

    if (durationMs <= 0) {
      this.logger.error(`Dynamic ${stepTypeName} must be in the future. durationMs: ${durationMs}, jobId: ${job._id}`);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: pastTimeDetail,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ error: `${stepTypeName} must be in the future` }),
        })
      );

      throw new Error(`Dynamic ${stepTypeName} must be in the future. durationMs: ${durationMs}`);
    }

    const tierValidationErrors = await this.tierRestrictionsValidateUsecase.execute(
      TierRestrictionsValidateCommand.create({
        organizationId: command.organizationId,
        environmentId: command.environmentId,
        stepType,
        deferDurationMs: durationMs,
      })
    );

    if (tierValidationErrors && tierValidationErrors.length > 0) {
      const errorMessage = tierValidationErrors[0].message;
      this.logger.error(`${stepTypeName} duration exceeds tier limits: ${errorMessage}, jobId: ${job._id}`);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.DEFER_DURATION_LIMIT_EXCEEDED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ errorMessage }),
        })
      );

      throw new Error(`${stepTypeName} duration exceeds tier limits: ${errorMessage}`);
    }
  }

  private async handleStepValidationError(
    command: AddJobCommand,
    job: JobEntity,
    error: Error,
    stepType: StepTypeEnum,
    detail: DetailEnum
  ): Promise<AddJobResult> {
    const stepTypeName = stepType.toLowerCase();
    this.logger.error(`${stepTypeName} validation failed for job ${job._id}: ${error.message}`);

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.FAILED,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({ error: error.message }),
      })
    );

    await this.jobRepository.updateOne(
      { _id: job._id, _environmentId: command.environmentId },
      {
        $set: {
          status: JobStatusEnum.FAILED,
          error: {
            message: error.message,
            name: error.name,
            stack: error.stack,
          },
        },
      }
    );

    await this.stepRunRepository.create(job, {
      status: JobStatusEnum.FAILED,
    });

    return {
      workflowStatus: WorkflowRunStatusEnum.ERROR,
      deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.ERRORED,
    };
  }

  private async fetchBridgeData(
    command: AddJobCommand,
    filterVariables: IFilterVariables
  ): Promise<ExecuteOutput | null> {
    const response = await this.executeBridgeJob.execute(
      ExecuteBridgeJobCommand.create({
        identifier: command.job.identifier,
        ...command,
        variables: filterVariables,
      })
    );

    if (!response) {
      return null;
    }

    return response;
  }

  private async updateMetadata(response: ExecuteOutput, command: AddJobCommand, untilDate?: Date | null) {
    let metadata = {} as IWorkflowStepMetadata;

    if (command.job.type === StepTypeEnum.DELAY) {
      return this.updateDelayMetadata(response, command);
    }

    const digest = command.job.digest as IDigestBaseMetadata;

    const outputs = response.outputs as DigestOutput;
    // digest value is pre-computed by framework and passed as digestKey
    const outputDigestValue = outputs?.digestKey;
    const digestType = getDigestType(outputs);

    if (isTimedOutput(outputs)) {
      metadata = {
        type: DigestTypeEnum.TIMED,
        digestValue: outputDigestValue || 'No-Value-Provided',
        digestKey: digest.digestKey || 'No-Key-Provided',
        timed: { cronExpression: outputs?.cron, untilDate: untilDate?.toISOString() },
      } as IDigestTimedMetadata;
      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'digest.type': metadata.type,
            'digest.digestValue': metadata.digestValue,
            'digest.digestKey': metadata.digestKey,
            'digest.amount': metadata.amount,
            'digest.unit': metadata.unit,
            'digest.timed.cronExpression': metadata.timed?.cronExpression,
            'digest.timed.untilDate': metadata.timed?.untilDate,
          },
        }
      );
    }

    if (isLookBackDigestOutput(outputs)) {
      metadata = {
        type: digestType,
        amount: outputs?.amount,
        digestValue: outputDigestValue || 'No-Value-Provided',
        digestKey: digest.digestKey || 'No-Key-Provided',
        unit: outputs.unit ? castUnitToDigestUnitEnum(outputs?.unit) : undefined,
        backoff: digestType === DigestTypeEnum.BACKOFF,
        backoffAmount: outputs.lookBackWindow?.amount,
        backoffUnit: outputs.lookBackWindow?.unit ? castUnitToDigestUnitEnum(outputs.lookBackWindow.unit) : undefined,
      } as IDigestRegularMetadata;

      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'digest.type': metadata.type,
            'digest.digestValue': metadata.digestValue,
            'digest.digestKey': metadata.digestKey,
            'digest.amount': metadata.amount,
            'digest.unit': metadata.unit,
            'digest.backoff': metadata.backoff,
            'digest.backoffAmount': metadata.backoffAmount,
            'digest.backoffUnit': metadata.backoffUnit,
          },
        }
      );
    }

    if (isRegularOutput(outputs)) {
      if (!outputs.amount && !outputs.unit) {
        outputs.amount = 0;
        outputs.unit = 'seconds';
      }

      metadata = {
        type: digestType,
        amount: outputs?.amount,
        digestKey: digest.digestKey || 'No-Key-Provided',
        digestValue: outputDigestValue || 'No-Value-Provided',
        unit: outputs.unit ? castUnitToDigestUnitEnum(outputs?.unit) : undefined,
      } as IDigestRegularMetadata;

      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'digest.type': metadata.type,
            'digest.digestKey': metadata.digestKey,
            'digest.digestValue': metadata.digestValue,
            'digest.amount': metadata.amount,
            'digest.unit': metadata.unit,
          },
        }
      );
    }

    return metadata;
  }

  private async updateDelayMetadata(response: ExecuteOutput, command: AddJobCommand) {
    const outputs = response.outputs as DelayOutput;
    let metadata = {} as IWorkflowStepMetadata;

    if (isDynamicOutput(outputs)) {
      metadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: (outputs as unknown as { dynamicKey: string }).dynamicKey,
      } as IDelayDynamicMetadata;

      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'step.metadata.type': metadata.type,
            'step.metadata.dynamicKey': (metadata as IDelayDynamicMetadata).dynamicKey,
          },
        }
      );
    } else if (isTimedOutput(outputs)) {
      metadata = {
        type: DelayTypeEnum.TIMED,
        amount: 0,
        unit: castUnitToDigestUnitEnum('seconds'),
      } as IDelayTimedMetadata;

      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'step.metadata.type': DelayTypeEnum.TIMED,
          },
        }
      );
    } else if (isRegularOutput(outputs)) {
      const regularOutputs = outputs as { amount?: number; unit?: string };
      metadata = {
        type: DelayTypeEnum.REGULAR,
        amount: regularOutputs?.amount || 0,
        unit: regularOutputs.unit ? castUnitToDigestUnitEnum(regularOutputs?.unit) : undefined,
      } as IDelayRegularMetadata;

      await this.jobRepository.updateOne(
        {
          _id: command.job._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            'step.metadata.type': metadata.type,
            'step.metadata.amount': metadata.amount,
            'step.metadata.unit': metadata.unit,
          },
        }
      );
    }

    return metadata;
  }

  private parseDynamicDurationValue(
    job: JobEntity,
    dynamicKey: string,
    stepType: 'delay' | 'throttle'
  ): { durationMs: number; identifier: string } | null {
    const keyPath = dynamicKey?.replace('payload.', '');
    const value = getNestedValue(job.payload, keyPath);

    if (!value) {
      this.logger.debug(`Dynamic ${stepType} key '${dynamicKey}' not found in payload data`);

      return null;
    }

    if (typeof value === 'string' && DurationUtils.isISO8601(value)) {
      const targetTime = new Date(value).getTime();
      const now = Date.now();

      return {
        durationMs: targetTime - now,
        identifier: value,
      };
    }

    if (typeof value === 'object' && value !== null && 'unit' in value && 'amount' in value) {
      const durationObj = value as { unit: string; amount: number };

      try {
        const durationMs = DurationUtils.convertToMilliseconds(durationObj.amount, durationObj.unit);

        return {
          durationMs,
          identifier: `${durationObj.amount}:${durationObj.unit}`,
        };
      } catch (error) {
        this.logger.warn(`Invalid ${stepType} duration unit '${durationObj.unit}': ${error.message}`);

        return null;
      }
    }

    this.logger.warn(`Dynamic ${stepType} value '${JSON.stringify(value)}' is not a valid format`);

    return null;
  }

  private async handleThrottle(
    command: AddJobCommand,
    job: JobEntity,
    bridgeResponse: ExecuteOutput | null
  ): Promise<{ shouldSkip: boolean; executionCount?: number; threshold?: number; throttledUntil?: string }> {
    // Get throttle configuration from bridge response or job step
    const throttleConfig = bridgeResponse?.outputs || {};
    const { type = 'fixed', threshold = 1, throttleKey } = throttleConfig;

    let windowMs: number;

    if (type === 'fixed') {
      const { amount, unit } = throttleConfig;
      if (!amount || !unit) {
        this.logger.warn(`Fixed throttle configuration missing amount or unit for job ${job._id}`);
        return { shouldSkip: false };
      }

      try {
        windowMs = DurationUtils.convertToMilliseconds(amount as number, unit as string);
      } catch {
        this.logger.warn(`Invalid throttle unit '${unit}' for job ${job._id}`);
        return { shouldSkip: false };
      }
    } else if (type === 'dynamic') {
      const { dynamicKey } = throttleConfig;
      if (!dynamicKey) {
        this.logger.warn(`Dynamic throttle configuration missing dynamicKey for job ${job._id}`);
        return { shouldSkip: false };
      }

      // Parse dynamic window value
      const dynamicValue = this.parseDynamicDurationValue(job, dynamicKey as string, 'throttle');
      if (!dynamicValue) {
        this.logger.warn(`Could not parse dynamic throttle value for job ${job._id}, key: ${dynamicKey}`);
        return { shouldSkip: false };
      }

      windowMs = dynamicValue.durationMs;
    } else {
      this.logger.warn(`Unknown throttle type '${type}' for job ${job._id}`);
      return { shouldSkip: false };
    }

    const nowMs = Date.now();

    // Validate throttle window duration
    await this.validateThrottleWindow(command, job, windowMs, type);

    if (!job.step.stepId) {
      throw new Error('Step ID is required for throttle reservation');
    }

    const throttleValue = throttleKey ? getNestedValue(job.payload, throttleKey as string) : 'default';

    const throttleJobId = `${job._id}:${Date.now()}`;

    const reservationResult = await this.redisThrottleService.reserveThrottleSlot({
      environmentId: command.environmentId,
      subscriberId: job._subscriberId,
      workflowId: job._templateId,
      stepId: job.step.stepId,
      jobId: throttleJobId,
      windowMs,
      limit: threshold as number,
      nowMs,
      throttleKey: (throttleKey as string) || 'default',
      throttleValue: throttleValue,
    });

    this.logger.debug(
      {
        jobId: job._id,
        reservationResult,
        threshold,
        windowMs,
        type,
      },
      'Redis throttle reservation result'
    );

    if (!reservationResult.granted) {
      return {
        shouldSkip: true,
        executionCount: reservationResult.count,
        threshold: threshold as number,
        throttledUntil: new Date(reservationResult.windowStartMs + windowMs).toISOString(),
      };
    }

    // Slot reserved successfully, proceed with execution
    return {
      shouldSkip: false,
      executionCount: reservationResult.count,
      threshold: threshold as number,
      throttledUntil: new Date(reservationResult.windowStartMs + windowMs).toISOString(),
    };
  }

  private async handleDigest({
    command,
    job,
    bridgeResponse,
    bridgeDelayAmountDate,
    bridgeDelayAmount,
    timezone,
  }: {
    command: AddJobCommand;
    job: JobEntity;
    bridgeResponse: ExecuteOutput | null;
    bridgeDelayAmountDate: Date | null;
    bridgeDelayAmount: number | undefined;
    timezone: string | undefined;
  }) {
    let metadata: IWorkflowStepMetadata;
    if (bridgeResponse) {
      metadata = await this.updateMetadata(bridgeResponse, command, bridgeDelayAmountDate);
    } else {
      metadata = job.digest || ({} as IWorkflowStepMetadata);
    }

    // Update the job digest directly to avoid an extra database call
    command.job.digest = { ...command.job.digest, ...metadata } as IWorkflowStepMetadata;

    validateDigest(job);

    const digestAmount =
      bridgeDelayAmount ??
      this.computeJobWaitDurationService.calculateDelay({
        stepMetadata: metadata,
        payload: job.payload,
        overrides: job.overrides,
        timezone,
      });

    this.logger.debug(`Digest step amount is: ${digestAmount}`);

    const digestCreationResult = await this.mergeOrCreateDigestUsecase.execute(
      MergeOrCreateDigestCommand.create({
        job,
      })
    );

    if (digestCreationResult === DigestCreationResultEnum.MERGED) {
      this.handleDigestMerged();
    }

    if (digestCreationResult === DigestCreationResultEnum.SKIPPED) {
      await this.handleDigestSkip(command, job);
    }

    return { digestAmount, digestCreationResult, cronExpression: bridgeResponse?.outputs?.cron as string | undefined };
  }

  private getBridgeNextCronDate(bridgeResponse: ExecuteOutput | null, timezone?: string): Date | null {
    const outputs = bridgeResponse?.outputs as DigestOutput | DelayOutput;
    if (!isTimedOutput(outputs) || !outputs.cron) {
      return null;
    }

    const bridgeAmountExpression = parseCronExpression(outputs.cron, { tz: timezone });
    const bridgeAmountDate = bridgeAmountExpression.next();

    return bridgeAmountDate.toDate();
  }

  private handleDigestMerged() {
    this.logger.info('Digest was merged, queueing next job');
  }

  private async handleDigestSkip(command: AddJobCommand, job) {
    const nextJobToSchedule = await this.jobRepository.findOne({
      _environmentId: command.environmentId,
      _parentId: job._id,
    });

    if (!nextJobToSchedule) {
      return;
    }

    await this.execute({
      userId: job._userId,
      environmentId: job._environmentId,
      organizationId: command.organizationId,
      jobId: nextJobToSchedule._id,
      job: nextJobToSchedule,
    });
  }

  private async handleThrottleSkip(
    command: AddJobCommand,
    job: JobEntity,
    throttleResult: { shouldSkip: boolean; executionCount: number; threshold: number; throttledUntil: string }
  ) {
    this.logger.info(
      `Job ${job._id} throttled: ${throttleResult.executionCount} executions exceed threshold ${throttleResult.threshold as number}`
    );

    await this.jobRepository.updateOne(
      { _id: job._id, _environmentId: command.environmentId },
      {
        $set: {
          status: JobStatusEnum.SKIPPED,
          stepOutput: {
            throttled: true,
            executionCount: throttleResult.executionCount,
            threshold: throttleResult.threshold as number,
            throttledUntil: throttleResult.throttledUntil,
          },
        },
      }
    );

    await this.stepRunRepository.create(job, {
      status: JobStatusEnum.SKIPPED,
    });

    const childJobsUpdated = await this.jobRepository.updateAllChildJobStatus(job, JobStatusEnum.SKIPPED, job._id);

    if (childJobsUpdated.length > 0) {
      await this.stepRunRepository.createMany(childJobsUpdated, {
        status: JobStatusEnum.SKIPPED,
      });

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.THROTTLE_LIMIT_EXCEEDED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ ...throttleResult }),
        })
      );
    }
  }

  private getExecutionDelayAmount(
    filtered: boolean,
    digestAmount: number | undefined,
    delayAmount: undefined | number
  ) {
    return (filtered ? 0 : (digestAmount ?? delayAmount)) ?? 0;
  }

  public async queueJob({
    job,
    delay,
    untilDate,
    timezone,
  }: {
    job: JobEntity;
    delay: number;
    untilDate: Date | null;
    timezone?: string;
  }) {
    const stepContainsWebhookFilter = this.stepContainsFilter(job, 'webhook');
    const options: JobsOptions = {
      delay,
    };
    if (stepContainsWebhookFilter) {
      options.backoff = {
        type: BackoffStrategiesEnum.WEBHOOK_FILTER_BACKOFF,
      };
      options.attempts = this.standardQueueService.DEFAULT_ATTEMPTS;
    }

    const jobData = {
      _environmentId: job._environmentId,
      _id: job._id,
      _organizationId: job._organizationId,
      _userId: job._userId,
    };

    this.logger.trace(jobData, 'Going to add a minimal job in Standard Queue');

    await this.standardQueueService.add({
      name: job._id,
      data: jobData,
      groupId: job._organizationId,
      options,
    });

    if (delay) {
      const logMessage =
        job.type === StepTypeEnum.DELAY
          ? 'Delay is active, Creating execution details'
          : job.type === StepTypeEnum.DIGEST
            ? 'Digest is active, Creating execution details'
            : 'Unexpected job type, Creating execution details';

      this.logger.trace(logMessage);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: job.type === StepTypeEnum.DELAY ? DetailEnum.STEP_DELAYED : DetailEnum.STEP_DIGESTED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.PENDING,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({
            delay,
            ...(untilDate && {
              untilDate: timezone
                ? formatInTimeZone(untilDate, timezone, 'yyyy-MM-dd HH:mm:ss zzz')
                : untilDate.toISOString(),
            }),
          }),
        })
      );
    }
  }

  private stepContainsFilter(job: JobEntity, onFilter: string) {
    return job.step.filters?.some((filter) => {
      return filter.children?.some((child) => {
        return child.on === onFilter;
      });
    });
  }

  private async validateThrottleWindow(
    command: AddJobCommand,
    job: JobEntity,
    windowMs: number,
    throttleType: string
  ): Promise<void> {
    if (throttleType === 'dynamic') {
      await this.validateDynamicDuration(command, job, windowMs, StepTypeEnum.THROTTLE);
    }
  }
}

function isJobDeferredType(jobType: StepTypeEnum | undefined) {
  if (!jobType) return false;

  return [StepTypeEnum.DELAY, StepTypeEnum.DIGEST, StepTypeEnum.THROTTLE].includes(jobType);
}

function isShouldHaltJobExecution(digestCreationResult: DigestCreationResultEnum) {
  return [DigestCreationResultEnum.MERGED, DigestCreationResultEnum.SKIPPED].includes(digestCreationResult);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isJobDeferredType(jobType: StepTypeEnum | undefined)
 - isShouldHaltJobExecution(digestCreationResult: DigestCreationResultEnum)
Asignaciones con arrow functions encontradas (posibles funciones):
 - AddJobResult({
  workflowStatus: WorkflowRunStatusEnum | null;
  deliveryLifecycleStatus: DeliveryLifecycleStatus...)
 - uniqueErrors(_.uniq(errors.map((error))
Declaraciones 'export' encontradas:
- export  enum
- export class AddJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/index.ts
Tamaño: 246 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { AddJobCommand } from './add-job.command';
export { AddJob } from './add-job.usecase';
export { MergeOrCreateDigestCommand } from './merge-or-create-digest.command';
export { MergeOrCreateDigest } from './merge-or-create-digest.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/merge-or-create-digest.command.ts
Tamaño: 240 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseCommand } from '@novu/application-generic';

import { JobEntity } from '@novu/dal';
import { IsDefined } from 'class-validator';

export class MergeOrCreateDigestCommand extends BaseCommand {
  @IsDefined()
  job: JobEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MergeOrCreateDigestCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/merge-or-create-digest.usecase.ts
Tamaño: 7954 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, forwardRef, Inject, Injectable } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  Instrument,
  InstrumentUsecase,
  RetryOnError,
  StepRunRepository,
} from '@novu/application-generic';
import { IDelayOrDigestJobResult, JobEntity, JobRepository, NotificationRepository } from '@novu/dal';
import {
  DigestCreationResultEnum,
  DigestTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IDigestBaseMetadata,
  IDigestRegularMetadata,
  IDigestTimedMetadata,
  JobStatusEnum,
} from '@novu/shared';
import { isBefore } from 'date-fns';
import { MergeOrCreateDigestCommand } from './merge-or-create-digest.command';

type MergeOrCreateDigestResultType = DigestCreationResultEnum;

@Injectable()
export class MergeOrCreateDigest {
  constructor(
    private jobRepository: JobRepository,
    @Inject(forwardRef(() => CreateExecutionDetails))
    private createExecutionDetails: CreateExecutionDetails,
    private notificationRepository: NotificationRepository,
    private stepRunRepository: StepRunRepository
  ) {}

  @InstrumentUsecase()
  public async execute(command: MergeOrCreateDigestCommand): Promise<MergeOrCreateDigestResultType> {
    const { job } = command;

    const digestMeta = job.digest as IDigestBaseMetadata;
    const digestAction = await this.computeDigestLogicBasedOnExistingDigestState(job, digestMeta);

    switch (digestAction.digestResult) {
      case DigestCreationResultEnum.MERGED: {
        if (!digestAction.activeDigestId || !digestAction.activeNotificationId) {
          throw new BadRequestException(
            `Active digest or notification id is missing, active digest id ${digestAction.activeDigestId},` +
              `active notification id ${digestAction.activeNotificationId}`
          );
        }

        return await this.processMergedDigest(job, digestAction.activeDigestId, digestAction.activeNotificationId);
      }
      case DigestCreationResultEnum.SKIPPED:
        return await this.processSkippedDigest(job);
      case DigestCreationResultEnum.CREATED:
        return await this.processCreatedDigest(digestMeta as IDigestBaseMetadata, job);
      default:
        throw new BadRequestException('Something went wrong with digest creation');
    }
  }

  @Instrument()
  private async processCreatedDigest(
    digestMeta: IDigestBaseMetadata | undefined,
    job: JobEntity
  ): Promise<DigestCreationResultEnum> {
    if ((digestMeta as unknown as IDigestTimedMetadata)?.timed?.cronExpression) {
      return DigestCreationResultEnum.CREATED;
    }

    const regularDigestMeta = digestMeta as IDigestRegularMetadata | undefined;
    if (!regularDigestMeta?.amount || !regularDigestMeta?.unit) {
      throw new BadRequestException(`Somehow ${job._id} had wrong digest settings and escaped validation`);
    }

    return DigestCreationResultEnum.CREATED;
  }

  @Instrument()
  private async processMergedDigest(
    job: JobEntity,
    activeDigestId: string,
    activeNotificationId: string
  ): Promise<DigestCreationResultEnum> {
    const childJobsUpdated = await this.jobRepository.updateAllChildJobStatus(
      job,
      JobStatusEnum.MERGED,
      activeDigestId
    );

    await Promise.all([
      this.jobRepository.update(
        {
          _environmentId: job._environmentId,
          _id: job._id,
        },
        {
          $set: {
            status: JobStatusEnum.MERGED,
            _mergedDigestId: activeDigestId,
          },
        }
      ),
      this.digestMergedExecutionDetails(job),
      this.notificationRepository.update(
        {
          _environmentId: job._environmentId,
          _id: job._notificationId,
        },
        {
          $set: {
            _digestedNotificationId: activeNotificationId,
          },
        }
      ),
      this.stepRunRepository.createMany([job, ...childJobsUpdated], {
        status: JobStatusEnum.MERGED,
      }),
    ]);

    return DigestCreationResultEnum.MERGED;
  }

  @Instrument()
  private async processSkippedDigest(job: JobEntity): Promise<DigestCreationResultEnum> {
    await Promise.all([
      this.jobRepository.update(
        {
          _environmentId: job._environmentId,
          _id: job._id,
        },
        {
          $set: {
            status: JobStatusEnum.SKIPPED,
          },
        }
      ),
      this.digestSkippedExecutionDetails(job),
    ]);

    return DigestCreationResultEnum.SKIPPED;
  }

  @RetryOnError('MongoServerError', {
    maxRetries: 3,
    delay: 500,
  })
  private async computeDigestLogicBasedOnExistingDigestState(
    job: JobEntity,
    digestMeta?: IDigestBaseMetadata
  ): Promise<IDelayOrDigestJobResult> {
    if (this.isBackOffDigestType(job, digestMeta)) {
      return await this.backoffLogic(job, digestMeta);
    }

    return await this.isMasterDigestOrShouldMergeToExisting(job, digestMeta);
  }

  private async isMasterDigestOrShouldMergeToExisting(job: JobEntity, digestMeta: IDigestBaseMetadata | undefined) {
    const delayedDigestJob = await this.jobRepository.getExistingDelayedJobWithTheSameDigestValue(job, digestMeta);
    if (!delayedDigestJob) {
      await this.jobRepository.markJobAsDigestMaster(job);

      return {
        activeDigestId: job._id,
        digestResult: DigestCreationResultEnum.CREATED,
      };
    }

    return {
      activeDigestId: delayedDigestJob._id,
      activeNotificationId: delayedDigestJob._notificationId?.toString(),
      digestResult: DigestCreationResultEnum.MERGED,
    };
  }

  private isBackOffDigestType(job: JobEntity, digestMeta?: IDigestBaseMetadata): digestMeta is IDigestRegularMetadata {
    return !!(
      (job.digest && 'type' in job.digest && job.digest.type === DigestTypeEnum.BACKOFF) ||
      (job.digest as IDigestRegularMetadata)?.backoff ||
      (digestMeta && 'backoff' in digestMeta && digestMeta?.backoff)
    );
  }

  private getEarliestJobUpdateDate(jobs: JobEntity[] | undefined): JobEntity | null {
    if (!jobs || jobs.length === 0) {
      return null;
    }

    return jobs.reduce((earliestJob, currentJob) => {
      const earliestDate = new Date(earliestJob.createdAt);
      const currentDate = new Date(currentJob.createdAt);

      return currentDate < earliestDate ? currentJob : earliestJob;
    });
  }

  private async backoffLogic(job: JobEntity, digestMeta?: IDigestRegularMetadata) {
    const otherJobsWithSameDigest = await this.jobRepository.getAnotherJobTriggeredWithinBackoffTime(job, digestMeta);
    const earliestOtherJobDate = this.getEarliestJobUpdateDate(otherJobsWithSameDigest);
    if (!earliestOtherJobDate) {
      return {
        digestResult: DigestCreationResultEnum.SKIPPED,
      };
    }
    const isMyJobBefore = isBefore(new Date(job.createdAt), new Date(earliestOtherJobDate.createdAt));

    if (isMyJobBefore) {
      return {
        digestResult: DigestCreationResultEnum.SKIPPED,
      };
    }

    return await this.isMasterDigestOrShouldMergeToExisting(job, digestMeta);
  }

  private async digestMergedExecutionDetails(job: JobEntity): Promise<void> {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.DIGEST_MERGED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.SUCCESS,
        isTest: false,
        isRetry: false,
      })
    );
  }

  private async digestSkippedExecutionDetails(job: JobEntity): Promise<void> {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.DIGEST_SKIPPED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.SUCCESS,
        isTest: false,
        isRetry: false,
      })
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - MergeOrCreateDigestResultType(DigestCreationResultEnum;

@Injectable()
export class MergeOrCreateDigest {
  constructor(
    priva...)
Declaraciones 'export' encontradas:
- export class MergeOrCreateDigest

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/add-job/validation.ts
Tamaño: 4141 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import { isRegularDigest } from '@novu/application-generic';
import { JobEntity } from '@novu/dal';
import {
  DaysEnum,
  DigestTypeEnum,
  DigestUnitEnum,
  IDigestBaseMetadata,
  IDigestRegularMetadata,
  IDigestTimedMetadata,
  ITimedConfig,
  MonthlyTypeEnum,
  OrdinalEnum,
  OrdinalValueEnum,
  StepTypeEnum,
} from '@novu/shared';

const validateAmountAndUnit = (digest: IDigestBaseMetadata) => {
  if (!digest?.amount) {
    throw new BadRequestException('Invalid digest amount');
  }

  if (!digest?.unit) {
    throw new BadRequestException('Invalid digest unit');
  }
};

const hasValidAtTime = (atTime: string) => {
  const atTimeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$/;

  return atTimeRegex.test(atTime);
};

const validateAtTime = (atTime?: string) => {
  if (!atTime) {
    throw new BadRequestException('Digest timed config atTime is missing');
  }

  if (!hasValidAtTime(atTime)) {
    throw new BadRequestException('Digest timed config atTime has invalid format, expected 24h time format');
  }
};

const validateWeekDays = (weekDays?: DaysEnum[]) => {
  if (!weekDays) {
    throw new BadRequestException('Digest timed config weekDays is missing');
  }

  const allowedValues = Object.values(DaysEnum);
  const allValid = weekDays.every((day) => allowedValues.includes(day));
  if (!allValid) {
    throw new BadRequestException('Digest timed config weekDays has invalid values');
  }
};

const validMonthDayRange = (monthDay: number) => monthDay < 1 || monthDay > 31;

const validateMonthDays = (monthDays?: number[]) => {
  if (!monthDays) {
    throw new BadRequestException('Digest timed config monthDays is missing');
  }

  const allValid = monthDays.every((day) => validMonthDayRange(day));
  if (!allValid) {
    throw new BadRequestException('Digest timed config monthDays values are invalid');
  }
};

const validateOrdinal = (timed: ITimedConfig) => {
  if (!timed.ordinal || !timed.ordinalValue) {
    throw new BadRequestException('Digest timed config ordinal is missing');
  }

  if (!Object.values(OrdinalEnum).includes(timed.ordinal)) {
    throw new BadRequestException('Digest timed config for ordinal is invalid');
  }

  if (!Object.values(OrdinalValueEnum).includes(timed.ordinalValue)) {
    throw new BadRequestException('Digest timed config for ordinal value is invalid');
  }
};

export const validateDigest = (job: JobEntity): void => {
  if (!job.digest || job.type !== StepTypeEnum.DIGEST) {
    throw new BadRequestException('Job is not a digest type');
  }

  // Type guard to check if digest has type property (digest metadata)
  if (!('type' in job.digest)) {
    throw new BadRequestException('Invalid digest metadata: missing type');
  }

  const digestWithType = job.digest as IDigestRegularMetadata | IDigestTimedMetadata;

  if (
    digestWithType.type &&
    (digestWithType.type === DigestTypeEnum.REGULAR || digestWithType.type === DigestTypeEnum.BACKOFF) &&
    isRegularDigest(digestWithType.type)
  ) {
    validateAmountAndUnit(digestWithType as IDigestRegularMetadata);
  }

  if (digestWithType.type === DigestTypeEnum.TIMED) {
    const timedDigest = digestWithType as IDigestTimedMetadata;
    if (timedDigest.timed?.cronExpression) {
      return;
    }

    validateAmountAndUnit(timedDigest);

    switch (timedDigest.unit) {
      case DigestUnitEnum.DAYS:
      case DigestUnitEnum.WEEKS:
      case DigestUnitEnum.MONTHS: {
        if (!timedDigest.timed) {
          throw new BadRequestException('Digest timed config is missing');
        }
        validateAtTime(timedDigest.timed.atTime);

        if (timedDigest.unit === DigestUnitEnum.WEEKS) {
          validateWeekDays(timedDigest.timed.weekDays);
        }

        if (timedDigest.unit === DigestUnitEnum.MONTHS && timedDigest.timed.monthlyType === MonthlyTypeEnum.EACH) {
          validateMonthDays(timedDigest.timed.monthDays);
        }

        if (timedDigest.unit === DigestUnitEnum.MONTHS && timedDigest.timed.monthlyType === MonthlyTypeEnum.ON) {
          validateOrdinal(timedDigest.timed);
        }
      }
    }
  }
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - validateAmountAndUnit(digest: IDigestBaseMetadata))
 - hasValidAtTime(atTime: string))
 - validateAtTime(atTime?: string))
 - validateWeekDays(weekDays?: DaysEnum[]))
 - allValid(weekDays.every((day))
 - validMonthDayRange(monthDay: number))
 - validateMonthDays(monthDays?: number[]))
 - allValid(monthDays.every((day))
 - validateOrdinal(timed: ITimedConfig))
 - validateDigest(job: JobEntity): void)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/execute-bridge-job/execute-bridge-job.command.ts
Tamaño: 587 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand, IFilterVariables } from '@novu/application-generic';

import { JobEntity } from '@novu/dal';
import { IsDefined, IsString } from 'class-validator';

export class ExecuteBridgeJobCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsString()
  environmentId: string;

  @IsDefined()
  @IsString()
  organizationId: string;

  @IsDefined()
  @IsString()
  userId: string;

  @IsDefined()
  @IsString()
  identifier: string;

  @IsDefined()
  jobId: string;

  @IsDefined()
  job: JobEntity;

  @IsDefined()
  variables?: IFilterVariables;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExecuteBridgeJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/execute-bridge-job/execute-bridge-job.usecase.ts
Tamaño: 9582 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  dashboardSanitizeControlValues,
  ExecuteBridgeRequest,
  ExecuteBridgeRequestCommand,
  Instrument,
  InstrumentUsecase,
  PinoLogger,
} from '@novu/application-generic';
import {
  ControlValuesRepository,
  EnvironmentRepository,
  JobEntity,
  JobRepository,
  MessageRepository,
  NotificationTemplateEntity,
  NotificationTemplateRepository,
} from '@novu/dal';
import {
  DelayResult,
  DigestResult,
  Event,
  ExecuteOutput,
  InAppResult,
  PostActionEnum,
  State,
  ThrottleResult,
} from '@novu/framework/internal';
import {
  ControlValuesLevelEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  ITriggerPayload,
  JobStatusEnum,
  ResourceOriginEnum,
  ResourceTypeEnum,
} from '@novu/shared';
import { ExecuteBridgeJobCommand } from './execute-bridge-job.command';

@Injectable()
export class ExecuteBridgeJob {
  constructor(
    private jobRepository: JobRepository,
    private notificationTemplateRepository: NotificationTemplateRepository,
    private messageRepository: MessageRepository,
    private environmentRepository: EnvironmentRepository,
    private controlValuesRepository: ControlValuesRepository,
    private createExecutionDetails: CreateExecutionDetails,
    private executeBridgeRequest: ExecuteBridgeRequest,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute(command: ExecuteBridgeJobCommand): Promise<ExecuteOutput | null> {
    const stepId = command.job.step.stepId || command.job.step.uuid;

    const isStateful = !command.job.step.bridgeUrl;

    let workflow: NotificationTemplateEntity | null = null;
    if (isStateful) {
      workflow = await this.notificationTemplateRepository.findOne(
        {
          _id: command.job._templateId,
          _environmentId: command.environmentId,
          type: {
            $in: [ResourceTypeEnum.ECHO, ResourceTypeEnum.BRIDGE],
          },
        },
        '_id triggers type origin'
      );
    }

    if (!workflow && isStateful) {
      return null;
    }

    if (!stepId) {
      throw new Error('Step id is not set');
    }

    const environment = await this.environmentRepository.findOne(
      {
        _id: command.environmentId,
        _organizationId: command.organizationId,
      },
      'echo apiKeys _id'
    );

    if (!environment) {
      throw new Error(`Environment id ${command.environmentId} is not found`);
    }

    if (!environment?.echo?.url && isStateful && workflow?.origin === ResourceOriginEnum.EXTERNAL) {
      throw new Error(`Bridge URL is not set for environment id: ${environment._id}`);
    }

    const { subscriber, payload: originalPayload, context } = command.variables || {};
    const payload = this.normalizePayload(originalPayload);

    const state = await this.generateState(command);

    const variablesStores = isStateful
      ? await this.findControlValues(command, workflow as NotificationTemplateEntity)
      : command.job.step.controlVariables;

    const bridgeEvent: Omit<Event, 'workflowId' | 'stepId' | 'action'> = {
      payload: payload ?? {},
      controls: variablesStores ?? {},
      state,
      subscriber: subscriber ?? {},
      context: context ?? {},
    };

    const workflowId = isStateful
      ? (workflow as NotificationTemplateEntity).triggers[0].identifier
      : command.identifier;

    const bridgeResponse = await this.sendBridgeRequest({
      environmentId: command.environmentId,
      /*
       * TODO: We fallback to external due to lack of backfilling origin for existing Workflows.
       * Once we backfill the origin field for existing Workflows, we should remove the fallback.
       */
      workflowOrigin: workflow?.origin || ResourceOriginEnum.EXTERNAL,
      statelessBridgeUrl: command.job.step.bridgeUrl,
      event: bridgeEvent,
      job: command.job,
      searchParams: {
        workflowId,
        stepId,
        jobId: command.job._id,
      },
    });

    return bridgeResponse;
  }

  private async findControlValues(command: ExecuteBridgeJobCommand, workflow: NotificationTemplateEntity) {
    const controls = await this.controlValuesRepository.findOne({
      _organizationId: command.organizationId,
      _workflowId: workflow._id,
      _stepId: command.job.step._id,
      level: ControlValuesLevelEnum.STEP_CONTROLS,
    });

    if (workflow?.origin === ResourceOriginEnum.NOVU_CLOUD) {
      return controls?.controls
        ? dashboardSanitizeControlValues(this.logger, controls.controls, command.job?.step?.template?.type)
        : {};
    }

    return controls?.controls;
  }

  private normalizePayload(originalPayload: ITriggerPayload = {}) {
    // Remove internal params
    const { __source, ...payload } = originalPayload;

    return payload;
  }

  private async generateState(command: ExecuteBridgeJobCommand): Promise<State[]> {
    const previousJobs: State[] = [];
    let theJob = (await this.jobRepository.findOne({
      _id: command.job._parentId,
      _environmentId: command.environmentId,
    })) as JobEntity;

    if (theJob) {
      const jobState = await this.mapState(theJob);
      previousJobs.push(jobState);
    }

    while (theJob) {
      theJob = (await this.jobRepository.findOne({
        _id: theJob._parentId,
        _environmentId: command.environmentId,
      })) as JobEntity;

      if (theJob) {
        const jobState = await this.mapState(theJob);
        previousJobs.push(jobState);
      }
    }

    return previousJobs;
  }

  @Instrument()
  private async sendBridgeRequest({
    statelessBridgeUrl,
    event,
    job,
    searchParams,
    workflowOrigin,
    environmentId,
  }: Omit<ExecuteBridgeRequestCommand, 'processError' | 'action' | 'retriesLimit'> & {
    job: JobEntity;
  }): Promise<ExecuteOutput> {
    return this.executeBridgeRequest.execute({
      statelessBridgeUrl,
      event,
      action: PostActionEnum.EXECUTE,
      searchParams,
      workflowOrigin,
      environmentId,
      processError: async (response) => {
        await this.createExecutionDetails.execute({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.FAILED_BRIDGE_EXECUTION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({
            url: response.url,
            statusCode: response.statusCode,
            message: response.message,
            code: response.code,
            data: response.data,
            cause: response.cause,
          }),
        });
      },
    }) as Promise<ExecuteOutput>;
  }

  private async mapOutput(job: JobEntity) {
    switch (job.type) {
      case 'delay': {
        return {
          duration: Date.now() - new Date(job.createdAt).getTime(),
        } satisfies DelayResult;
      }
      case 'digest': {
        const digestJobs = await this.jobRepository.find(
          {
            _mergedDigestId: job._id,
            type: 'digest',
            status: JobStatusEnum.MERGED,
            _environmentId: job._environmentId,
          },
          {
            payload: 1,
            createdAt: 1,
            _id: 1,
            transactionId: 1,
          }
        );
        const events = [...digestJobs, job]
          .map((digestJob) => ({
            id: digestJob._id,
            time: digestJob.createdAt,
            payload: digestJob.payload ?? {},
          }))
          .sort((a, b) => new Date(a.time).getTime() - new Date(b.time).getTime());

        return {
          events,
          eventCount: events.length,
        } satisfies DigestResult;
      }
      case 'custom': {
        return job.stepOutput || {};
      }
      case 'in_app': {
        const message = await this.messageRepository.findOne(
          { _environmentId: job._environmentId, _jobId: job._id },
          'seen read lastSeenDate lastReadDate'
        );
        if (message) {
          return {
            seen: message.seen,
            read: message.read,
            lastSeenDate: message.lastSeenDate || null,
            lastReadDate: message.lastReadDate || null,
          } satisfies InAppResult;
        } else {
          /*
           * Provide fallback state for in-app messages to satisfy framework inAppResultSchema validation
           * when message is not found (e.g., cancelled jobs, nv-5120)
           */
          return {
            seen: false,
            read: false,
            lastSeenDate: null,
            lastReadDate: null,
          } satisfies InAppResult;
        }
      }
      case 'throttle': {
        const stepOutput = job.stepOutput as ThrottleResult | undefined;

        if (!stepOutput) {
          return {
            throttled: false,
          } satisfies ThrottleResult;
        }

        return {
          throttled: stepOutput.throttled,
          executionCount: stepOutput.executionCount,
          threshold: stepOutput.threshold,
          windowStart: stepOutput.windowStart,
        } satisfies ThrottleResult;
      }
      default:
        return {};
    }
  }

  @Instrument()
  private async mapState(job: JobEntity) {
    const output = await this.mapOutput(job);

    return {
      stepId: job?.step.stepId || job?.step.uuid || '',
      outputs: output ?? {},
      state: {
        status: job?.status,
        error: job?.error,
      },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - jobState(await this.mapState(theJob);
        previousJobs.push(jobState);
      }
    }

    return previous...)
 - events([...digestJobs, job]
          .map((digestJob))
Declaraciones 'export' encontradas:
- export class ExecuteBridgeJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/execute-bridge-job/index.ts
Tamaño: 137 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ExecuteBridgeJobCommand } from './execute-bridge-job.command';
export { ExecuteBridgeJob } from './execute-bridge-job.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/handle-last-failed-job/handle-last-failed-job.command.ts
Tamaño: 261 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { IsDefined } from 'class-validator';

export class HandleLastFailedJobCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  jobId: string;

  @IsDefined()
  error: Error;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HandleLastFailedJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/handle-last-failed-job/handle-last-failed-job.usecase.ts
Tamaño: 2448 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  InstrumentUsecase,
  PinoLogger,
} from '@novu/application-generic';
import { JobEntity, JobRepository } from '@novu/dal';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';
import { PlatformException, shouldHaltOnStepFailure } from '../../../shared/utils';
import { QueueNextJob, QueueNextJobCommand } from '../queue-next-job';
import { HandleLastFailedJobCommand } from './handle-last-failed-job.command';

@Injectable()
export class HandleLastFailedJob {
  constructor(
    private createExecutionDetails: CreateExecutionDetails,
    private queueNextJob: QueueNextJob,
    private jobRepository: JobRepository,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  /**
   * This use case is only meant to be executed when a backed off job is in the last of the retry
   * attempts allowed and has also failed.
   * We isolate it here as is a use case we would need to do a DB call and it will help to minimize
   * the amount of times that call will be made.
   */
  @InstrumentUsecase()
  public async execute(command: HandleLastFailedJobCommand): Promise<void> {
    const { jobId, error } = command;

    const job = await this.jobRepository.findOne({ _id: jobId, _environmentId: command.environmentId });
    if (!job) {
      const message = `Job ${jobId} not found when handling the failure of the latest attempt for a backed off job`;
      this.logger.error(message);
      throw new PlatformException(message);
    }

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.WEBHOOK_FILTER_FAILED_LAST_RETRY,
        source: ExecutionDetailsSourceEnum.WEBHOOK,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: true,
        raw: JSON.stringify({ message: JSON.parse(error.message).message }),
      })
    );

    if (!shouldHaltOnStepFailure(job)) {
      await this.queueNextJob.execute(
        QueueNextJobCommand.create({
          parentId: job?._id,
          environmentId: job?._environmentId,
          organizationId: job?._organizationId,
          userId: job?._userId,
          subscriberId: job?._subscriberId,
        })
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HandleLastFailedJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/handle-last-failed-job/index.ts
Tamaño: 151 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { HandleLastFailedJobCommand } from './handle-last-failed-job.command';
export { HandleLastFailedJob } from './handle-last-failed-job.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/inbound-email-parse/inbound-email-parse.command.ts
Tamaño: 1112 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  BaseCommand,
  IConnection,
  IEnvelopeFrom,
  IEnvelopeTo,
  IFrom,
  IHeaders,
  IInboundParseDataDto,
  ITo,
} from '@novu/application-generic';
import { IsDefined, IsNumber, IsOptional, IsString } from 'class-validator';

export class InboundEmailParseCommand extends BaseCommand implements IInboundParseDataDto {
  @IsDefined()
  @IsString()
  html: string;

  @IsDefined()
  @IsString()
  text: string;

  @IsDefined()
  headers: IHeaders;

  @IsDefined()
  @IsString()
  subject: string;

  @IsDefined()
  @IsString()
  messageId: string;

  @IsDefined()
  @IsString()
  priority: string;

  @IsDefined()
  from: IFrom[];

  @IsDefined()
  to: ITo[];

  @IsDefined()
  date: Date;

  @IsDefined()
  @IsString()
  dkim: string;

  @IsDefined()
  @IsString()
  spf: string;

  @IsDefined()
  @IsNumber()
  spamScore: number;

  @IsDefined()
  @IsString()
  language: string;

  @IsDefined()
  cc: any[];

  @IsDefined()
  @IsOptional()
  attachments?: any[];

  @IsDefined()
  connection: IConnection;

  @IsDefined()
  envelopeFrom: IEnvelopeFrom;

  @IsDefined()
  envelopeTo: IEnvelopeTo[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InboundEmailParseCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/inbound-email-parse/inbound-email-parse.usecase.ts
Tamaño: 3858 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, Logger } from '@nestjs/common';
import { CompileTemplate, CompileTemplateCommand, createHash } from '@novu/application-generic';
import {
  JobEntity,
  JobRepository,
  MessageEntity,
  MessageRepository,
  NotificationEntity,
  NotificationTemplateEntity,
} from '@novu/dal';
import { StepTypeEnum } from '@novu/shared';
import axios from 'axios';
import { InboundEmailParseCommand } from './inbound-email-parse.command';

const LOG_CONTEXT = 'InboundEmailParse';

@Injectable()
export class InboundEmailParse {
  constructor(
    private jobRepository: JobRepository,
    private messageRepository: MessageRepository,
    private compileTemplate: CompileTemplate
  ) {}

  async execute(command: InboundEmailParseCommand) {
    const { domain, transactionId, environmentId } = this.splitTo(command.to[0].address);

    Logger.log({ domain, transactionId, environmentId }, `Received new email to parse`, LOG_CONTEXT);

    const { template, notification, subscriber, environment, job, message } = await this.getEntities(
      transactionId,
      environmentId
    );

    if (domain !== environment?.dns?.inboundParseDomain) {
      this.throwMiddleware('Domain is not in environment white list');
    }

    const currentParseWebhook = template.steps.find((step) => step?._id?.toString() === job?.step?._id)?.replyCallback
      ?.url;

    if (!currentParseWebhook) {
      this.throwMiddleware(
        `Missing parse webhook on template ${template._id} job ${job._id} transactionId ${transactionId}.`
      );
    }

    const compiledDomain = await this.compileTemplate.execute({
      template: currentParseWebhook as string,
      data: job.payload,
    });

    const userPayload: IUserWebhookPayload = {
      hmac: createHash(environment?.apiKeys[0]?.key, subscriber.subscriberId),
      transactionId,
      payload: job.payload,
      templateIdentifier: job.identifier,
      template,
      notification,
      message,
      mail: command,
    };

    await axios.post(compiledDomain, userPayload);
  }

  private splitTo(address: string) {
    const userNameDelimiter = '-nv-e=';

    const [user, domain] = address.split('@');
    const toMetaIds = user.split('+')[1];
    const [transactionId, environmentId] = toMetaIds.split(userNameDelimiter);

    if (!transactionId) {
      this.throwMiddleware(`Missing transactionId on address ${address}`);
    }

    if (!domain) {
      this.throwMiddleware(`Missing domain  on address ${address}`);
    }

    if (!environmentId) {
      this.throwMiddleware(`Missing environmentId on address ${address}`);
    }

    return { domain, transactionId, environmentId };
  }

  private throwMiddleware(error: string) {
    Logger.error(error, LOG_CONTEXT);

    throw new BadRequestException(error);
  }

  private async getEntities(transactionId: string, environmentId: string) {
    const partial: Partial<JobEntity> = { transactionId, _environmentId: environmentId, type: StepTypeEnum.EMAIL };

    const { template, notification, subscriber, environment, ...job } = await this.jobRepository.findOnePopulate({
      query: partial as JobEntity,
      selectTemplate: 'steps',
      selectSubscriber: 'subscriberId',
      selectEnvironment: 'apiKeys dns',
    });

    const message = await this.messageRepository.findOne({
      transactionId,
      _environmentId: environment._id,
      _subscriberId: subscriber._id,
    });

    return { template, notification, subscriber, environment, job, message };
  }
}

class MailMetadata extends InboundEmailParseCommand {}

export interface IUserWebhookPayload {
  transactionId: string;
  templateIdentifier: string;
  payload: Record<string, unknown>;
  template: NotificationTemplateEntity;
  notification: NotificationEntity;
  message: MessageEntity | null;
  mail: MailMetadata;
  hmac: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - currentParseWebhook(template.steps.find((step))
Declaraciones 'export' encontradas:
- export class InboundEmailParse
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/process-unsnooze-job/index.ts
Tamaño: 96 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './process-unsnooze-job.command';
export * from './process-unsnooze-job.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/process-unsnooze-job/process-unsnooze-job.command.ts
Tamaño: 212 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentCommand } from '@novu/application-generic';
import { IsDefined } from 'class-validator';

export class ProcessUnsnoozeJobCommand extends EnvironmentCommand {
  @IsDefined()
  jobId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ProcessUnsnoozeJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/process-unsnooze-job/process-unsnooze-job.usecase.ts
Tamaño: 4523 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import {
  buildFeedKey,
  buildMessageCountKey,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  InvalidateCacheService,
  PlatformException,
  WebSocketsQueueService,
} from '@novu/application-generic';
import { JobRepository, MessageRepository } from '@novu/dal';
import {
  ChannelTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  WebSocketEventEnum,
} from '@novu/shared';
import { ProcessUnsnoozeJobCommand } from './process-unsnooze-job.command';

@Injectable()
export class ProcessUnsnoozeJob {
  constructor(
    private readonly jobRepository: JobRepository,
    private readonly messageRepository: MessageRepository,
    private readonly webSocketsQueueService: WebSocketsQueueService,
    private readonly createExecutionDetails: CreateExecutionDetails,
    private readonly invalidateCache: InvalidateCacheService
  ) {}

  public async execute(command: ProcessUnsnoozeJobCommand) {
    const job = await this.jobRepository.findOne({ _id: command.jobId, _environmentId: command.environmentId });

    if (!job) {
      throw new NotFoundException(`Could not find a job with id '${command.jobId}'.`);
    }

    try {
      const snoozedNotification = await this.messageRepository.findOne({
        _notificationId: job._notificationId,
        _environmentId: job._environmentId,
        channel: ChannelTypeEnum.IN_APP,
        snoozedUntil: { $exists: true, $ne: null },
      });

      if (!snoozedNotification) {
        throw new NotFoundException(
          `Could not find a snoozed notification with id '${job._notificationId}'. ` +
            'The notification may not exist or may not be in a snoozed state.'
        );
      }

      const nowDate = new Date();
      const createdAtDate = new Date(snoozedNotification.createdAt);

      await this.messageRepository.update(
        { _environmentId: job._environmentId, _notificationId: job._notificationId },
        [
          {
            $set: {
              snoozedUntil: null,
              createdAt: nowDate,
              read: false,
              lastReadDate: null,
              deliveredAt: {
                $cond: {
                  if: { $isArray: '$deliveredAt' },
                  then: { $concatArrays: ['$deliveredAt', [nowDate]] },
                  else: [createdAtDate, nowDate],
                },
              },
            },
          },
        ],
        {
          timestamps: false,
          strict: false,
        }
      );

      await Promise.all([
        this.webSocketsQueueService.add({
          name: 'sendMessage',
          data: {
            event: WebSocketEventEnum.RECEIVED,
            userId: job._subscriberId,
            _environmentId: job._environmentId,
            contextKeys: snoozedNotification.contextKeys,
            payload: {
              messageId: snoozedNotification._id,
            },
          },
          options: {
            removeOnComplete: true,
            removeOnFail: true,
          },
          groupId: job._organizationId,
        }),
        this.invalidateCache.invalidateQuery({
          key: buildFeedKey().invalidate({
            subscriberId: job.subscriberId,
            _environmentId: job._environmentId,
          }),
        }),
        this.invalidateCache.invalidateQuery({
          key: buildMessageCountKey().invalidate({
            subscriberId: job.subscriberId,
            _environmentId: job._environmentId,
          }),
        }),
      ]);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.MESSAGE_UNSNOOZED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
        })
      );
    } catch (error) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.MESSAGE_UNSNOOZE_FAILED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ error: error.message }),
        })
      );
      throw new PlatformException(`Failed to unsnooze notification: ${error.message}`);
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ProcessUnsnoozeJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/queue-next-job/index.ts
Tamaño: 121 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { QueueNextJobCommand } from './queue-next-job.command';
export { QueueNextJob } from './queue-next-job.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/queue-next-job/queue-next-job.command.ts
Tamaño: 265 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { IsDefined } from 'class-validator';

export class QueueNextJobCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  parentId: string;

  @IsDefined()
  subscriberId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class QueueNextJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/queue-next-job/queue-next-job.usecase.ts
Tamaño: 1307 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable } from '@nestjs/common';
import { InstrumentUsecase } from '@novu/application-generic';
import { JobEntity, JobRepository } from '@novu/dal';
import { AddJob } from '../add-job';
import { QueueNextJobCommand } from './queue-next-job.command';

@Injectable()
export class QueueNextJob {
  constructor(
    private jobRepository: JobRepository,
    @Inject(forwardRef(() => AddJob)) private addJobUsecase: AddJob,
    // private workflowStatusUpdateService: WorkflowRunService
  ) {}

  @InstrumentUsecase()
  public async execute(command: QueueNextJobCommand): Promise<JobEntity | undefined> {
    const job = await this.jobRepository.findOne({
      _environmentId: command.environmentId,
      _parentId: command.parentId,
    });

    if (!job) {
      // await this.workflowStatusUpdateService.updateDeliveryLifecycle({
      //   notificationId: command.parentId,
      //   environmentId: command.environmentId,
      //   organizationId: command.organizationId,
      //   subscriberId: command.subscriberId,
      // });

      return;
    }

    await this.addJobUsecase.execute({
      userId: job._userId,
      environmentId: job._environmentId,
      organizationId: command.organizationId,
      jobId: job._id,
      job,
    });

    return job;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class QueueNextJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/run-job/index.ts
Tamaño: 95 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { RunJobCommand } from './run-job.command';
export { RunJob } from './run-job.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/run-job/run-job.command.ts
Tamaño: 216 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { IsDefined } from 'class-validator';

export class RunJobCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  jobId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RunJobCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/run-job/run-job.usecase.ts
Tamaño: 29221 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable, Logger } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  FeatureFlagsService,
  GetSubscriberSchedule,
  GetSubscriberScheduleCommand,
  getJobDigest,
  Instrument,
  InstrumentUsecase,
  PinoLogger,
  StepRunRepository,
  StorageHelperService,
  WorkflowRunService,
  WorkflowRunStatusEnum,
} from '@novu/application-generic';
import {
  JobEntity,
  JobRepository,
  JobStatusEnum,
  NotificationEntity,
  NotificationRepository,
  NotificationTemplateEntity,
  NotificationTemplateRepository,
  SubscriberRepository,
} from '@novu/dal';
import {
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  FeatureFlagsKeysEnum,
  Schedule,
  StepTypeEnum,
} from '@novu/shared';
import { setUser } from '@sentry/node';
import { differenceInMilliseconds } from 'date-fns';
import { formatInTimeZone } from 'date-fns-tz';
import { EXCEPTION_MESSAGE_ON_WEBHOOK_FILTER, PlatformException, shouldHaltOnStepFailure } from '../../../shared/utils';
import { AddJob } from '../add-job';
import { ExecuteBridgeJob, ExecuteBridgeJobCommand } from '../execute-bridge-job';
import { ProcessUnsnoozeJob, ProcessUnsnoozeJobCommand } from '../process-unsnooze-job';
import { SendMessage, SendMessageCommand } from '../send-message';
import { SendMessageStatus } from '../send-message/send-message-type.usecase';
import { SetJobAsFailedCommand } from '../update-job-status/set-job-as.command';
import { SetJobAsFailed } from '../update-job-status/set-job-as-failed.usecase';
import { RunJobCommand } from './run-job.command';
import { calculateNextAvailableTime, isWithinSchedule } from './schedule-validator';

const nr = require('newrelic');

export type SelectedWorkflowFields = Pick<NotificationTemplateEntity, 'steps'>;

/**
 * MongoDB projection object for SelectedWorkflowFields.
 * This ensures the projection is always aligned with the type definition.
 */
export const SELECTED_WORKFLOW_FIELDS_PROJECTION: Record<keyof SelectedWorkflowFields, 1> = {
  steps: 1,
} as const;

@Injectable()
export class RunJob {
  constructor(
    private jobRepository: JobRepository,
    private sendMessage: SendMessage,
    @Inject(forwardRef(() => AddJob)) private addJobUsecase: AddJob,
    @Inject(forwardRef(() => SetJobAsFailed)) private setJobAsFailed: SetJobAsFailed,
    private storageHelperService: StorageHelperService,
    private notificationRepository: NotificationRepository,
    private notificationTemplateRepository: NotificationTemplateRepository,
    private processUnsnoozeJob: ProcessUnsnoozeJob,
    private stepRunRepository: StepRunRepository,
    private workflowRunService: WorkflowRunService,
    private createExecutionDetails: CreateExecutionDetails,
    private getSubscriberSchedule: GetSubscriberSchedule,
    private logger: PinoLogger,
    private subscriberRepository: SubscriberRepository,
    private featureFlagsService: FeatureFlagsService,
    private executeBridgeJob: ExecuteBridgeJob
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  public async execute(command: RunJobCommand): Promise<JobEntity | undefined> {
    setUser({
      id: command.userId,
      organizationId: command.organizationId,
      environmentId: command.environmentId,
    });

    let job = await this.jobRepository.findOne({ _id: command.jobId, _environmentId: command.environmentId });
    if (!job) {
      throw new PlatformException(`Job with id ${command.jobId} not found`);
    }

    await this.stepRunRepository.create(job, {
      status: JobStatusEnum.RUNNING,
    });

    this.assignLogger(job);

    const { canceled, activeDigestFollower } = await this.delayedEventIsCanceled(job);

    if (canceled && !activeDigestFollower) {
      this.logger.trace({ nv: { canceled } }, `Job ${job._id} that had been delayed has been cancelled`);
      await this.stepRunRepository.create(job, {
        status: JobStatusEnum.CANCELED,
      });

      // Update workflow run delivery lifecycle after job cancellation
      await this.conditionallyUpdateDeliveryLifecycle(job, WorkflowRunStatusEnum.COMPLETED);

      return;
    }

    if (activeDigestFollower) {
      job = this.assignNewDigestExecutor(activeDigestFollower);
      this.assignLogger(job);
    }

    nr.addCustomAttributes({
      transactionId: job.transactionId,
      environmentId: job._environmentId,
      organizationId: job._organizationId,
      jobId: job._id,
      jobType: job.type,
    });

    let shouldQueueNextJob = true;
    let isJobExtendedToSubscriberSchedule = false;
    let error: Error | undefined;

    try {
      const isSubscribersScheduleEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_SUBSCRIBERS_SCHEDULE_ENABLED,
        defaultValue: false,
        organization: { _id: job._organizationId },
        environment: { _id: job._environmentId },
      });

      const notification = await this.notificationRepository.findOne({
        _id: job._notificationId,
        _environmentId: job._environmentId,
      });

      if (!notification) {
        throw new PlatformException(`Notification with id ${job._notificationId} not found`);
      }

      if (isSubscribersScheduleEnabled) {
        const schedule = await this.getSubscriberSchedule.execute(
          GetSubscriberScheduleCommand.create({
            environmentId: job._environmentId,
            organizationId: job._organizationId,
            _subscriberId: job._subscriberId,
          })
        );

        const subscriber = await this.subscriberRepository.findOne(
          {
            _id: job._subscriberId,
            _environmentId: job._environmentId,
            _organizationId: job._organizationId,
          },
          'timezone',
          { readPreference: 'secondaryPreferred' }
        );
        const timezone = subscriber?.timezone;
        const isOutsideSubscriberSchedule = schedule?.isEnabled
          ? !isWithinSchedule(schedule, new Date(), timezone)
          : false;

        if (isOutsideSubscriberSchedule && (await this.shouldExtendToSubscriberSchedule(job, notification))) {
          this.logger.info(
            {
              jobId: job._id,
              subscriberId: job.subscriberId,
              stepType: job.type,
            },
            "The step was extended to the next available time in the subscriber's schedule"
          );

          isJobExtendedToSubscriberSchedule = await this.extendJobToNextAvailableSchedule(job, schedule, timezone);
          if (isJobExtendedToSubscriberSchedule) {
            shouldQueueNextJob = false;
            return;
          }
        }

        if (isOutsideSubscriberSchedule && !this.shouldSkipScheduleCheck(job, notification)) {
          this.logger.info(
            {
              jobId: job._id,
              subscriberId: job.subscriberId,
              stepType: job.type,
            },
            "The step was skipped as it fell outside the subscriber's schedule"
          );

          await this.jobRepository.updateStatus(job._environmentId, job._id, JobStatusEnum.CANCELED);

          await this.stepRunRepository.create(job, {
            status: JobStatusEnum.CANCELED,
          });

          await this.createExecutionDetails.execute(
            CreateExecutionDetailsCommand.create({
              ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
              detail: DetailEnum.SKIPPED_STEP_OUTSIDE_OF_THE_SCHEDULE,
              source: ExecutionDetailsSourceEnum.INTERNAL,
              status: ExecutionDetailsStatusEnum.SUCCESS,
              isTest: false,
              isRetry: false,
              raw: JSON.stringify({
                schedule,
                timezone,
              }),
            })
          );

          // Update workflow run delivery lifecycle after schedule-based cancellation
          await this.conditionallyUpdateDeliveryLifecycle(job, WorkflowRunStatusEnum.COMPLETED);

          return;
        }
      }

      await this.jobRepository.updateStatus(job._environmentId, job._id, JobStatusEnum.RUNNING);

      await this.storageHelperService.getAttachments(job.payload?.attachments);

      if (this.isUnsnoozeJob(job)) {
        await this.processUnsnoozeJob.execute(
          ProcessUnsnoozeJobCommand.create({
            jobId: job._id,
            environmentId: job._environmentId,
            organizationId: job._organizationId,
          })
        );

        return;
      }

      const sendMessageResult = await this.sendMessage.execute(
        SendMessageCommand.create({
          identifier: job.identifier,
          payload: job.payload ?? {},
          overrides: job.overrides ?? {},
          step: job.step,
          transactionId: job.transactionId,
          notificationId: job._notificationId,
          _templateId: job._templateId,
          environmentId: job._environmentId,
          organizationId: job._organizationId,
          userId: job._userId,
          subscriberId: job.subscriberId,
          // backward compatibility - ternary needed to be removed once the queue renewed
          _subscriberId: job._subscriberId ? job._subscriberId : job.subscriberId,
          jobId: job._id,
          events: job.digest?.events,
          job,
          tags: notification.tags || [],
          severity: notification.severity,
          statelessPreferences: job.preferences,
          contextKeys: job.contextKeys,
        })
      );

      // while we sending a message the job can me updated, like in digest case, therefore we want to have the most updated job
      job = sendMessageResult.job ?? job;

      if (sendMessageResult.status === 'success') {
        await this.jobRepository.updateStatus(job._environmentId, job._id, JobStatusEnum.COMPLETED);

        await this.stepRunRepository.create(job, {
          status: JobStatusEnum.COMPLETED,
        });

        // Update workflow run delivery lifecycle after successful step completion
        await this.conditionallyUpdateDeliveryLifecycle(job, WorkflowRunStatusEnum.PROCESSING);
      } else if (sendMessageResult.status === 'failed') {
        await this.jobRepository.update(
          {
            _environmentId: job._environmentId,
            _id: job._id,
          },
          {
            $set: {
              status: JobStatusEnum.FAILED,
              error: sendMessageResult.errorMessage,
            },
          }
        );

        await this.stepRunRepository.create(job, {
          status: JobStatusEnum.FAILED,
          errorCode: 'send_message_failed',
          errorMessage: sendMessageResult.errorMessage,
        });

        // Update workflow run delivery lifecycle after step failure
        await this.conditionallyUpdateDeliveryLifecycle(job, WorkflowRunStatusEnum.COMPLETED);

        if (shouldHaltOnStepFailure(job)) {
          shouldQueueNextJob = false;
          await this.jobRepository.cancelPendingJobs({
            transactionId: job.transactionId,
            _environmentId: job._environmentId,
            _subscriberId: job._subscriberId,
            _templateId: job._templateId,
          });
        }
      } else if (sendMessageResult.status === SendMessageStatus.SKIPPED) {
        await this.jobRepository.updateStatus(
          job._environmentId,
          job._id,
          JobStatusEnum.CANCELED,
          sendMessageResult.deliveryLifecycleState
        );
        await this.stepRunRepository.create(job, {
          status: JobStatusEnum.CANCELED,
        });

        // Update workflow run delivery lifecycle after step skip/cancellation
        await this.conditionallyUpdateDeliveryLifecycle(job, WorkflowRunStatusEnum.PROCESSING);
      }
    } catch (caughtError: unknown) {
      error = caughtError as Error;
      await this.stepRunRepository.create(job, {
        status: JobStatusEnum.FAILED,
        errorCode: 'execution_error',
        errorMessage: error.message,
      });

      if (shouldHaltOnStepFailure(job) && !this.shouldBackoff(error)) {
        await this.jobRepository.cancelPendingJobs({
          transactionId: job.transactionId,
          _environmentId: job._environmentId,
          _subscriberId: job._subscriberId,
          _templateId: job._templateId,
        });
      }

      if (shouldHaltOnStepFailure(job) || this.shouldBackoff(error)) {
        shouldQueueNextJob = false;
      }
      throw caughtError;
    } finally {
      if (shouldQueueNextJob && !isJobExtendedToSubscriberSchedule) {
        await this.tryQueueNextJobs(job);
      } else if (!isJobExtendedToSubscriberSchedule) {
        // Update workflow run status based on step runs when halting on step failure
        await this.workflowRunService.updateDeliveryLifecycle({
          workflowStatus: WorkflowRunStatusEnum.COMPLETED,
          notificationId: job._notificationId,
          environmentId: job._environmentId,
          organizationId: job._organizationId,
          _subscriberId: job._subscriberId,
        });
        // Remove the attachments if the job should not be queued
        await this.storageHelperService.deleteAttachments(job.payload?.attachments);
      }
    }
  }

  private isUnsnoozeJob(job: JobEntity) {
    return job.type === StepTypeEnum.IN_APP && job.delay && job.payload?.unsnooze;
  }

  /**
   * Attempts to queue subsequent jobs in the workflow chain.
   * If queueNextJob.execute returns undefined, we stop the workflow.
   * Otherwise, we continue trying to queue the next job in the chain.
   */
  private async tryQueueNextJobs(job: JobEntity): Promise<void> {
    let currentJob: JobEntity | null = job;
    let nextJob: JobEntity | null = null;
    if (!currentJob) {
      return;
    }

    let shouldContinueQueueNextJob = true;

    while (shouldContinueQueueNextJob) {
      try {
        if (!currentJob) {
          return;
        }

        nextJob = await this.jobRepository.findOne({
          _environmentId: currentJob._environmentId,
          _parentId: currentJob._id,
        });

        if (!nextJob) {
          // Update workflow run status when there is no next job (workflow complete)
          await this.workflowRunService.updateDeliveryLifecycle({
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            notificationId: currentJob._notificationId,
            environmentId: currentJob._environmentId,
            organizationId: currentJob._organizationId,
            _subscriberId: currentJob._subscriberId,
          });
          return;
        }

        const addJobResult = await this.addJobUsecase.execute({
          userId: nextJob._userId,
          environmentId: nextJob._environmentId,
          organizationId: nextJob._organizationId,
          jobId: nextJob._id,
          job: nextJob,
        });

        if (addJobResult.stepStatus === JobStatusEnum.SKIPPED) {
          await this.jobRepository.updateOne(
            {
              _id: nextJob._id,
              _environmentId: nextJob._environmentId,
              _organizationId: nextJob._organizationId,
            },
            { $set: { status: JobStatusEnum.SKIPPED } }
          );

          await this.stepRunRepository.create(nextJob, {
            status: JobStatusEnum.SKIPPED,
          });

          await this.createExecutionDetails.execute(
            CreateExecutionDetailsCommand.create({
              ...CreateExecutionDetailsCommand.getDetailsFromJob(nextJob),
              detail: DetailEnum.SKIPPED_STEP_BY_CONDITIONS,
              source: ExecutionDetailsSourceEnum.INTERNAL,
              status: ExecutionDetailsStatusEnum.SUCCESS,
              isTest: false,
              isRetry: false,
            })
          );

          // Update workflow run delivery lifecycle after step skip
          await this.conditionallyUpdateDeliveryLifecycle(nextJob, WorkflowRunStatusEnum.PROCESSING);

          currentJob = nextJob; // if skipped, continue to the next job
        } else {
          shouldContinueQueueNextJob = false;
        }

        if (addJobResult.workflowStatus === WorkflowRunStatusEnum.COMPLETED) {
          await this.workflowRunService.updateDeliveryLifecycle({
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            notificationId: nextJob._notificationId,
            environmentId: nextJob._environmentId,
            organizationId: nextJob._organizationId,
            _subscriberId: nextJob._subscriberId,
          });
        }
      } catch (error: unknown) {
        if (!nextJob) {
          // Fallback: update workflow run status if nextJob is unexpectedly missing
          // (should not occur due to prior nextJob check in loop)
          await this.workflowRunService.updateDeliveryLifecycle({
            workflowStatus: WorkflowRunStatusEnum.COMPLETED,
            notificationId: currentJob._notificationId,
            environmentId: currentJob._environmentId,
            organizationId: currentJob._organizationId,
            _subscriberId: currentJob._subscriberId,
          });
          return;
        }

        const jobAfterNext: Pick<JobEntity, '_id'> | null = await this.jobRepository.findOne(
          {
            _environmentId: nextJob._environmentId,
            _parentId: nextJob._id,
          },
          '_id'
        );

        const isHaltingWorkflow = shouldHaltOnStepFailure(nextJob) && !this.shouldBackoff(error as Error);
        const isLastJobInWorkflow = !jobAfterNext || isHaltingWorkflow;

        await this.setJobAsFailed.execute(
          SetJobAsFailedCommand.create({
            environmentId: nextJob._environmentId,
            jobId: nextJob._id,
            organizationId: nextJob._organizationId,
            userId: nextJob._userId,
            isLastJobInWorkflow,
          }),
          error as Error
        );

        if (isHaltingWorkflow) {
          await this.jobRepository.cancelPendingJobs({
            transactionId: nextJob.transactionId,
            _environmentId: nextJob._environmentId,
            _subscriberId: nextJob._subscriberId,
            _templateId: nextJob._templateId,
          });
        }

        if (shouldHaltOnStepFailure(nextJob) || this.shouldBackoff(error as Error)) {
          return;
        }

        currentJob = nextJob;
      } finally {
        if (nextJob) {
          await this.storageHelperService.deleteAttachments(nextJob.payload?.attachments);
        }
      }
    }
  }

  private assignLogger(job: JobEntity) {
    try {
      if (this.logger) {
        this.logger.assign({
          transactionId: job.transactionId,
          jobId: job._id,
          environmentId: job._environmentId,
          organizationId: job._organizationId,
        });
      }
    } catch (e) {
      this.logger.error({ err: e }, 'Failed to assign logger');
    }
  }

  /*
   * If the following condition is met,
   * - transactions were merged to the main delayed digest.
   * - the main delayed digest was canceled.
   * that mean that we need to assign a new active digest follower job to replace it.
   * so from now on we will continue the follower transaction as main digest job.
   */
  private assignNewDigestExecutor(activeDigestFollower: JobEntity): JobEntity {
    return activeDigestFollower;
  }

  @Instrument()
  private async delayedEventIsCanceled(
    job: JobEntity
  ): Promise<{ canceled: boolean; activeDigestFollower: JobEntity | null }> {
    let activeDigestFollower: JobEntity | null = null;

    if (job.type !== StepTypeEnum.DIGEST && job.type !== StepTypeEnum.DELAY && job.type !== StepTypeEnum.THROTTLE) {
      return { canceled: false, activeDigestFollower };
    }

    const canceled = job.status === JobStatusEnum.CANCELED;

    if (job.status === JobStatusEnum.CANCELED) {
      activeDigestFollower = await this.activeDigestMainFollowerExist(job);
    }

    return { canceled, activeDigestFollower };
  }

  @Instrument()
  private async activeDigestMainFollowerExist(job: JobEntity): Promise<JobEntity | null> {
    if (job.type !== StepTypeEnum.DIGEST) {
      return null;
    }

    const { digestKey, digestValue } = getJobDigest(job);

    const jobQuery: Partial<JobEntity> & { _environmentId: string } = {
      _environmentId: job._environmentId,
      _organizationId: job._organizationId,
      _mergedDigestId: null,
      status: JobStatusEnum.DELAYED,
      type: StepTypeEnum.DIGEST,
      _subscriberId: job._subscriberId,
      _templateId: job._templateId,
    };

    if (digestKey && digestValue) {
      jobQuery[`payload.${digestKey}`] = digestValue;
    }

    return await this.jobRepository.findOne(jobQuery);
  }

  public shouldBackoff(error: Error): boolean {
    return error?.message?.includes(EXCEPTION_MESSAGE_ON_WEBHOOK_FILTER);
  }

  /**
   * Checks if there are any remaining action steps (delay, digest, throttle) in the workflow
   * we skip updating the delivery lifecycle to avoid unnecessary calculations for workflows that will complete quickly and update only the last step.
   */
  private async hasRemainingActionSteps(job: JobEntity, workflow: SelectedWorkflowFields): Promise<boolean> {
    if (!workflow || !workflow.steps) {
      return false;
    }

    // Find the current step index in the workflow
    const currentStepIndex = workflow.steps.findIndex((step) => step._id === job.step?._id);

    if (currentStepIndex === -1) {
      return false;
    }

    // Check if any remaining steps after the current one are action steps
    const remainingSteps = workflow.steps.slice(currentStepIndex + 1);

    return remainingSteps.some((step) => {
      // Check if step has a template with action step type
      if (step.template?.type) {
        return (
          step.template.type === StepTypeEnum.CUSTOM ||
          step.template.type === StepTypeEnum.DELAY ||
          step.template.type === StepTypeEnum.DIGEST ||
          step.template.type === StepTypeEnum.THROTTLE
        );
      }
      return false;
    });
  }

  /**
   * Checks if the current job step is the last step in the workflow
   */
  private async isLastStepInWorkflow(job: JobEntity, workflow: SelectedWorkflowFields): Promise<boolean> {
    if (!workflow || !workflow.steps) {
      return false;
    }

    // Find the current step index in the workflow
    const currentStepIndex = workflow.steps.findIndex((step) => step._id === job.step?._id);

    if (currentStepIndex === -1) {
      return false;
    }

    // Check if this is the last step in the workflow
    return currentStepIndex === workflow.steps.length - 1;
  }

  /**
   * Conditionally updates the delivery lifecycle only if there are no remaining action steps
   * in the workflow. This optimization avoids unnecessary calculations for workflows that
   * will complete quickly. Also skips updating if the current job itself is an action step.
   * Additionally, skips execution if the current step is the last step in the workflow, because it will be updated as part of the workflow run finalization.
   */
  private async conditionallyUpdateDeliveryLifecycle(
    job: JobEntity,
    workflowStatus: WorkflowRunStatusEnum
  ): Promise<void> {
    this.logger.info({ nv: { job } }, 'Conditionally updating delivery lifecycle');

    if (
      job.type === StepTypeEnum.TRIGGER ||
      job.type === StepTypeEnum.DELAY ||
      job.type === StepTypeEnum.DIGEST ||
      job.type === StepTypeEnum.CUSTOM ||
      job.type === StepTypeEnum.THROTTLE
    ) {
      return;
    }

    const workflow: SelectedWorkflowFields | null = await this.notificationTemplateRepository.findOne(
      {
        _id: job._templateId,
        _environmentId: job._environmentId,
      },
      SELECTED_WORKFLOW_FIELDS_PROJECTION
    );

    if (!workflow || !workflow.steps) {
      return;
    }

    const isLastStep = await this.isLastStepInWorkflow(job, workflow);
    if (isLastStep) {
      this.logger.trace(
        { nv: { jobId: job._id, stepId: job.step?._id } },
        'Skipping delivery lifecycle update for last step in workflow'
      );
      return;
    }

    const hasActionSteps = await this.hasRemainingActionSteps(job, workflow);

    if (hasActionSteps) {
      this.logger.trace(
        { nv: { jobId: job._id, stepId: job.step?._id } },
        'Skipping delivery lifecycle update for step with action type'
      );
      return;
    }

    await this.workflowRunService.updateDeliveryLifecycle({
      workflowStatus,
      notificationId: job._notificationId,
      environmentId: job._environmentId,
      organizationId: job._organizationId,
      _subscriberId: job._subscriberId,
    });
  }

  private shouldSkipScheduleCheck(job: JobEntity, notification: NotificationEntity): boolean {
    // always deliver in-app messages or critical messages
    // let trigger,digest and delay finish their execution
    if (
      job.type === StepTypeEnum.TRIGGER ||
      job.type === StepTypeEnum.IN_APP ||
      job.type === StepTypeEnum.DELAY ||
      job.type === StepTypeEnum.DIGEST ||
      notification.critical
    ) {
      return true;
    }

    return false;
  }

  private async shouldExtendToSubscriberSchedule(job: JobEntity, notification: NotificationEntity): Promise<boolean> {
    // should only extend to schedule for delay and digest when the workflow is not critical
    if ((job.type === StepTypeEnum.DELAY || job.type === StepTypeEnum.DIGEST) && !notification.critical) {
      const bridgeResponse = await this.executeBridgeJob.execute(
        ExecuteBridgeJobCommand.create({
          environmentId: job._environmentId,
          organizationId: job._organizationId,
          userId: job._userId,
          identifier: job.identifier,
          jobId: job._id,
          job: job,
          variables: {},
        })
      );
      const extendToSchedule = bridgeResponse?.outputs?.extendToSchedule as boolean | undefined;
      return extendToSchedule ?? false;
    }

    return false;
  }

  private async extendJobToNextAvailableSchedule(
    job: JobEntity,
    schedule?: Schedule,
    timezone?: string
  ): Promise<boolean> {
    const MAX_EXTENSIONS = 3; // maximum number of schedule extensions allowed
    const currentExtensions = job.scheduleExtensionsCount ?? 0;

    if (currentExtensions >= MAX_EXTENSIONS) {
      this.logger.warn(
        {
          jobId: job._id,
          subscriberId: job.subscriberId,
          stepType: job.type,
          extensions: currentExtensions,
        },
        'Maximum number of schedule extensions reached, sending the message'
      );

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.SKIPPED_STEP_MAX_EXTENSIONS_REACHED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
        })
      );

      return false;
    }

    const nextAvailableTime = calculateNextAvailableTime(schedule, new Date(), timezone);
    const delayMs = Math.max(0, differenceInMilliseconds(nextAvailableTime, new Date()));

    if (delayMs === 0) {
      return false;
    }

    await this.jobRepository.updateOne(
      {
        _id: job._id,
        _environmentId: job._environmentId,
      },
      {
        $set: {
          scheduleExtensionsCount: currentExtensions + 1,
          status: JobStatusEnum.DELAYED,
        },
      }
    );

    const updatedJob = await this.jobRepository.findOne({
      _id: job._id,
      _environmentId: job._environmentId,
    });

    if (!updatedJob) {
      throw new PlatformException(`Job with id ${job._id} not found`);
    }

    await this.stepRunRepository.create(updatedJob, {
      status: JobStatusEnum.DELAYED,
    });

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(updatedJob),
        detail: DetailEnum.STEP_EXTENDED_TO_SCHEDULE,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({
          delayMs,
          nextAvailableTime: timezone
            ? formatInTimeZone(nextAvailableTime, timezone, 'yyyy-MM-dd HH:mm:ss zzz')
            : nextAvailableTime.toISOString(),
          timezone,
          schedule,
          scheduleExtensionsCount: currentExtensions + 1,
          maxScheduleExtensions: MAX_EXTENSIONS,
        }),
      })
    );

    // re-queue the job with the new delay
    await this.addJobUsecase.queueJob({
      job: updatedJob,
      delay: delayMs,
      untilDate: nextAvailableTime,
      timezone,
    });

    this.logger.info(
      {
        jobId: updatedJob._id,
        subscriberId: updatedJob.subscriberId,
        stepType: updatedJob.type,
        delayMs,
        nextAvailableTime: nextAvailableTime.toISOString(),
        scheduleExtensionsCount: currentExtensions + 1,
        maxExtensions: MAX_EXTENSIONS,
      },
      'Step was extended to the next available time in the subscriber schedule'
    );

    return true;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - currentStepIndex(workflow.steps.findIndex((step))
 - remainingSteps(workflow.steps.slice(currentStepIndex + 1);

    return remainingSteps.some((step))
 - currentStepIndex(workflow.steps.findIndex((step))
Declaraciones 'export' encontradas:
- export  type
- export  const
- export class RunJob

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/run-job/schedule-validator.spec.ts
Tamaño: 21778 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Schedule } from '@novu/shared';
import { expect } from 'chai';
import { calculateNextAvailableTime, getDayOfWeek, isWithinSchedule } from './schedule-validator';

describe('ScheduleValidator', () => {
  describe('isWithinSchedule', () => {
    it('should return true when no schedule is configured', () => {
      expect(isWithinSchedule(undefined)).to.be.true;
      expect(isWithinSchedule({ isEnabled: false })).to.be.true;
      expect(isWithinSchedule({ isEnabled: true, weeklySchedule: undefined })).to.be.true;
    });

    it('should handle timezone conversion correctly', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      // Test with UTC time (Monday 10:00 AM UTC)
      const utcTime = new Date('2024-01-01T10:00:00Z');
      expect(isWithinSchedule(schedule, utcTime)).to.be.true;

      // Test with timezone conversion (UTC to EST - should be 5:00 AM EST, outside schedule)
      const estTimezone = 'America/New_York';
      expect(isWithinSchedule(schedule, utcTime, estTimezone)).to.be.false;

      // Test with timezone conversion (UTC to PST - should be 2:00 AM PST, outside schedule)
      const pstTimezone = 'America/Los_Angeles';
      expect(isWithinSchedule(schedule, utcTime, pstTimezone)).to.be.false;

      // Test with timezone conversion (UTC to PST - should be 12:00 AM Poland, in the schedule)
      const polandTimezone = 'Europe/Warsaw';
      expect(isWithinSchedule(schedule, utcTime, polandTimezone)).to.be.true;

      // Test with a time that would be within schedule in EST (Monday 2:00 PM EST = Monday 7:00 PM UTC)
      const utcTimeAfternoon = new Date('2024-01-01T19:00:00Z');
      expect(isWithinSchedule(schedule, utcTimeAfternoon, estTimezone)).to.be.true;
    });

    it('should return false when schedule is enabled but day is disabled', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: false,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      // Test on a Monday
      const monday = new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, monday)).to.be.false;
    });

    it('should return true when current time is within schedule', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      // Test on a Monday at 10:00 AM
      const monday = new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, monday)).to.be.true;
    });

    it('should return false when current time is outside schedule', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      // Test on a Monday at 8:00 AM (before schedule)
      const mondayEarly = new Date('2024-01-01T08:59:59Z'); // Monday 8:59:59 AM UTC
      expect(isWithinSchedule(schedule, mondayEarly)).to.be.false;

      // Test on a Monday at 6:00 PM (after schedule)
      const mondayLate = new Date('2024-01-01T17:01:00Z'); // Monday 5:01:00 PM UTC
      expect(isWithinSchedule(schedule, mondayLate)).to.be.false;
    });

    it('should handle overnight schedules', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '11:00 PM', end: '02:00 AM' }],
          },
        },
      };

      // Test at 11:30 PM (within overnight schedule)
      const mondayNight = new Date('2024-01-01T23:30:00Z'); // Monday 11:30 PM UTC
      expect(isWithinSchedule(schedule, mondayNight)).to.be.true;

      // Test at 1:00 AM next day (within overnight schedule)
      const tuesdayEarly1 = new Date('2024-01-02T01:00:00Z'); // Tuesday 1:00 AM UTC
      expect(isWithinSchedule(schedule, tuesdayEarly1)).to.be.true;

      // Test at 1:00 AM next day (within overnight schedule)
      const tuesdayEarly2 = new Date('2024-01-02T01:00:00Z'); // Tuesday 3:00 AM Europe/Warsaw
      expect(isWithinSchedule(schedule, tuesdayEarly2, 'Europe/Warsaw')).to.be.true;

      // Test at 3:00 AM (outside overnight schedule)
      const tuesdayLate = new Date('2024-01-02T03:00:00Z'); // Tuesday 3:00 AM UTC
      expect(isWithinSchedule(schedule, tuesdayLate)).to.be.false;
    });

    it('should return false when no hours are configured for the day', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [],
          },
        },
      };

      const monday = new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, monday)).to.be.false;
    });

    it('should handle multiple time ranges in a day', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [
              { start: '09:00 AM', end: '12:00 PM' },
              { start: '01:00 PM', end: '05:00 PM' },
            ],
          },
        },
      };

      // Test within first range
      const mondayMorning = new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, mondayMorning)).to.be.true;

      // Test within second range
      const mondayAfternoon = new Date('2024-01-01T15:00:00Z'); // Monday 3:00 PM UTC
      expect(isWithinSchedule(schedule, mondayAfternoon)).to.be.true;

      // Test between ranges (lunch break)
      const mondayLunch = new Date('2024-01-01T12:30:00Z'); // Monday 12:30 PM UTC
      expect(isWithinSchedule(schedule, mondayLunch)).to.be.false;
    });

    it('should handle different days of the week', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
          tuesday: {
            isEnabled: false,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
          wednesday: {
            isEnabled: true,
            hours: [{ start: '10:00 AM', end: '04:00 PM' }],
          },
        },
      };

      // Monday - should be within schedule
      const monday = new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, monday)).to.be.true;

      // Tuesday - should be outside schedule (day disabled)
      const tuesday = new Date('2024-01-02T10:00:00Z'); // Tuesday 10:00 AM UTC
      expect(isWithinSchedule(schedule, tuesday)).to.be.false;

      // Wednesday - should be within schedule
      const wednesday = new Date('2024-01-03T10:00:00Z'); // Wednesday 10:00 AM UTC
      expect(isWithinSchedule(schedule, wednesday)).to.be.true;

      // Wednesday - should be outside schedule (different hours)
      const wednesdayEarly = new Date('2024-01-03T09:00:00Z'); // Wednesday 9:00 AM UTC
      expect(isWithinSchedule(schedule, wednesdayEarly)).to.be.false;
    });

    it('should handle edge cases for time conversion', () => {
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '12:00 PM', end: '01:00 PM' }],
          },
        },
      };

      // Test exactly at start time
      const mondayNoon = new Date('2024-01-01T12:00:00Z'); // Monday 12:00 PM UTC
      expect(isWithinSchedule(schedule, mondayNoon)).to.be.true;

      // Test exactly at end time
      const mondayOne = new Date('2024-01-01T13:00:00Z'); // Monday 1:00 PM UTC
      expect(isWithinSchedule(schedule, mondayOne)).to.be.true;

      // Test just before start time
      const mondayBefore = new Date('2024-01-01T11:59:00Z'); // Monday 11:59 AM UTC
      expect(isWithinSchedule(schedule, mondayBefore)).to.be.false;

      // Test just after end time
      const mondayAfter = new Date('2024-01-01T13:01:00Z'); // Monday 1:01 PM UTC
      expect(isWithinSchedule(schedule, mondayAfter)).to.be.false;
    });
  });

  describe('calculateNextAvailableTime', () => {
    it('should return current time when no schedule is configured', () => {
      const currentTime = new Date('2024-01-15T10:00:00.000Z');

      const result = calculateNextAvailableTime(undefined, currentTime);

      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should return current time when schedule is disabled', () => {
      const currentTime = new Date('2024-01-15T10:00:00.000Z');
      const schedule: Schedule = {
        isEnabled: false,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should return current time when weekly schedule is undefined', () => {
      const currentTime = new Date('2024-01-15T10:00:00.000Z');
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: undefined,
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should return current time when hours are empty', () => {
      const currentTime = new Date('2024-01-15T10:00:00.000Z');
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          [getDayOfWeek(currentTime)]: {
            isEnabled: true,
            hours: [],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should calculate next available time for Monday schedule - same day', () => {
      const currentTime = new Date('2024-01-01T08:00:00.000Z'); // Monday 8:00 AM
      const expectedTime = new Date('2024-01-01T09:00:00.000Z'); // Monday 9:00 AM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on the same day
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should calculate next available time for Monday schedule - same day with minutes, seconds and milliseconds', () => {
      const currentTime = new Date('2024-01-01T08:10:10.100Z'); // Monday 8:10:10.100 AM
      const expectedTime = new Date('2024-01-01T09:00:00.000Z'); // Monday 9:00 AM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on the same day
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should calculate next available time for next day when current time is past schedule', () => {
      const currentTime = new Date('2024-01-01T18:00:00.000Z'); // Monday 6:00 PM (past 5:00 PM schedule)
      const expectedTime = new Date('2024-01-02T09:00:00.000Z'); // Tuesday 9:00 AM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
          tuesday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle overnight schedules correctly - within schedule', () => {
      const currentTime = new Date('2024-01-01T02:00:00.000Z'); // Monday 2:00 AM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          sunday: {
            isEnabled: true,
            hours: [{ start: '11:00 PM', end: '03:00 AM' }], // Overnight schedule
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return current time since we're within the overnight schedule
      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should handle overnight schedules correctly - before schedule', () => {
      const currentTime = new Date('2024-01-01T22:00:00.000Z'); // Monday 10:00 PM
      const expectedTime = new Date('2024-01-07T23:00:00.000Z'); // Sunday 11:00 PM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          sunday: {
            isEnabled: true,
            hours: [{ start: '11:00 PM', end: '03:00 AM' }], // Overnight schedule
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return the start of the overnight schedule (11:00 PM)
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle overnight schedules correctly - after schedule', () => {
      const currentTime = new Date('2024-01-01T05:00:00.000Z'); // Monday 5:00 AM (after 3:00 AM end)
      const expectedTime = new Date('2024-01-01T09:00:00.000Z'); // Monday 9:00 AM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          sunday: {
            isEnabled: true,
            hours: [{ start: '11:00 PM', end: '03:00 AM' }], // Overnight schedule
          },
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on Monday
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle multiple time ranges in a day', () => {
      const currentTime = new Date('2024-01-01T14:00:00.000Z'); // Monday 2:00 PM
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [
              { start: '09:00 AM', end: '12:00 PM' }, // Morning shift
              { start: '02:00 PM', end: '05:00 PM' }, // Afternoon shift
            ],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return 2:00 PM (start of afternoon shift)
      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should skip disabled days', () => {
      const currentTime = new Date('2024-01-01T18:00:00.000Z'); // Monday 6:00 PM UTC
      const expectedTime = new Date('2024-01-02T09:00:00.000Z'); // Tuesday 9:00 AM

      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: false,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
          tuesday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on Tuesday (skip disabled Monday)
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle timezone conversion - EST timezone', () => {
      const currentTime = new Date('2024-01-01T14:00:00.000Z'); // Monday 2:00 PM UTC = 9:00 AM EST
      const expectedTime = new Date('2024-01-01T15:00:00.000Z'); // Monday 3:00 PM UTC
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '10:00 AM', end: '05:00 PM' }], // EST times
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime, 'America/New_York');

      // Should return 10:00 AM EST = 3:00 PM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle timezone conversion - PST timezone', () => {
      const currentTime = new Date('2024-01-01T18:00:00.000Z'); // Monday 6:00 PM UTC = 10:00 AM PST
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }], // PST times
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime, 'America/Los_Angeles');

      // Should return current time since we're within the schedule
      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should handle timezone conversion - Europe/London timezone', () => {
      const currentTime = new Date('2024-01-01T08:00:00.000Z'); // Monday 8:00 AM UTC = 8:00 AM GMT (same in winter)
      const expectedTime = new Date('2024-01-01T09:00:00.000Z'); // Monday 9:00 AM UTC
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }], // GMT times
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime, 'Europe/London');

      // Should return 9:00 AM GMT = 9:00 AM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle timezone conversion - Asia/Tokyo timezone', () => {
      const currentTime = new Date('2024-01-01T00:00:00.000Z'); // Monday 12:00 AM UTC = 9:00 AM JST
      const expectedTime = new Date('2024-01-01T01:00:00.000Z'); // Monday 1:00 AM UTC
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '10:00 AM', end: '05:00 PM' }], // JST times
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime, 'Asia/Tokyo');

      // Should return 10:00 AM JST = 1:00 AM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should handle timezone conversion with overnight schedules', () => {
      const currentTime = new Date('2024-01-01T16:00:00.000Z'); // Monday 4:00 PM UTC = 11:00 PM JST
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '10:00 PM', end: '02:00 AM' }], // Overnight schedule in JST
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime, 'Asia/Tokyo');

      // Should return current time since we're within the schedule
      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should return fallback time when no schedule found in 7 days', () => {
      const currentTime = new Date('2024-01-01T10:00:00.000Z');
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          // No enabled days
          monday: { isEnabled: false, hours: [] },
          tuesday: { isEnabled: false, hours: [] },
          wednesday: { isEnabled: false, hours: [] },
          thursday: { isEnabled: false, hours: [] },
          friday: { isEnabled: false, hours: [] },
          saturday: { isEnabled: false, hours: [] },
          sunday: { isEnabled: false, hours: [] },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should handle edge case - exactly at schedule start time', () => {
      const currentTime = new Date('2024-01-01T09:00:00.000Z'); // Monday exactly 9:00 AM UTC
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return current time since we're exactly at the start
      expect(result.getTime()).to.equal(currentTime.getTime());
    });

    it('should handle edge case - exactly at schedule end time', () => {
      const currentTime = new Date('2024-01-01T17:00:00.000Z'); // Monday exactly 5:00 PM UTC
      const schedule: Schedule = {
        isEnabled: true,
        weeklySchedule: {
          monday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
          tuesday: {
            isEnabled: true,
            hours: [{ start: '09:00 AM', end: '05:00 PM' }],
          },
        },
      };

      const result = calculateNextAvailableTime(schedule, currentTime);

      // Should return next day's start time since we're exactly at the end
      expect(result.getTime()).to.equal(currentTime.getTime());
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - utcTimeAfternoon(new Date('2024-01-01T19:00:00Z');
      expect(isWithinSchedule(schedule, utcTimeAfternoon, estTimez...)
 - monday(new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, mon...)
 - monday(new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, mon...)
 - mondayLate(new Date('2024-01-01T17:01:00Z'); // Monday 5:01:00 PM UTC
      expect(isWithinSchedule(schedule, m...)
 - tuesdayLate(new Date('2024-01-02T03:00:00Z'); // Tuesday 3:00 AM UTC
      expect(isWithinSchedule(schedule, tue...)
 - monday(new Date('2024-01-01T10:00:00Z'); // Monday 10:00 AM UTC
      expect(isWithinSchedule(schedule, mon...)
 - mondayLunch(new Date('2024-01-01T12:30:00Z'); // Monday 12:30 PM UTC
      expect(isWithinSchedule(schedule, mon...)
 - wednesdayEarly(new Date('2024-01-03T09:00:00Z'); // Wednesday 9:00 AM UTC
      expect(isWithinSchedule(schedule, w...)
 - mondayAfter(new Date('2024-01-01T13:01:00Z'); // Monday 1:01 PM UTC
      expect(isWithinSchedule(schedule, mond...)
 - result(calculateNextAvailableTime(undefined, currentTime);

      expect(result.getTime()).to.equal(current...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentT...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentT...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentT...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on the same day
 ...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on the same day
 ...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(expected...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return current time since we're ...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return the start of the overnigh...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on Monday
      e...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return 2:00 PM (start of afterno...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return 9:00 AM on Tuesday (skip ...)
 - EST(3:00 PM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should...)
 - result(calculateNextAvailableTime(schedule, currentTime, 'America/Los_Angeles');

      // Should return cu...)
 - GMT(9:00 AM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should...)
 - JST(1:00 AM UTC
      expect(result.getTime()).to.equal(expectedTime.getTime());
    });

    it('should...)
 - result(calculateNextAvailableTime(schedule, currentTime, 'Asia/Tokyo');

      // Should return current tim...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      expect(result.getTime()).to.equal(currentT...)
 - result(calculateNextAvailableTime(schedule, currentTime);

      // Should return current time since we're ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/run-job/schedule-validator.ts
Tamaño: 7958 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Schedule, TimeRange } from '@novu/shared';
import { addDays, isAfter, isBefore, isEqual, set } from 'date-fns';
import { utcToZonedTime, zonedTimeToUtc } from 'date-fns-tz';

const DAYS_OF_WEEK: Array<keyof NonNullable<Schedule['weeklySchedule']>> = [
  'sunday',
  'monday',
  'tuesday',
  'wednesday',
  'thursday',
  'friday',
  'saturday',
] as const;

export function isWithinSchedule(schedule?: Schedule, currentTime: Date = new Date(), timezone?: string): boolean {
  // If no schedule is configured, allow all messages
  if (!schedule || !schedule.isEnabled || !schedule.weeklySchedule) {
    return true;
  }

  // Convert current time to subscriber's timezone if provided
  const subscriberTime = timezone ? utcToZonedTime(currentTime, timezone) : currentTime;

  const currentDay = getDayOfWeek(subscriberTime);
  const currentTimeString = formatTime(subscriberTime, !!timezone);

  // Check both the current day and the previous day for overnight schedules
  const daysToCheck = [currentDay];

  // For overnight schedules, also check the previous day
  const previousDay = getPreviousDay(currentDay);
  if (previousDay) {
    const previousDaySchedule = schedule.weeklySchedule[previousDay];
    // Only check previous day if it has overnight schedules (end time < start time)
    if (previousDaySchedule?.isEnabled && previousDaySchedule.hours) {
      const hasOvernightSchedule = previousDaySchedule.hours.some((timeRange) => {
        const startInMinutes = timeToMinutes(timeRange.start);
        const endInMinutes = timeToMinutes(timeRange.end);
        return endInMinutes < startInMinutes;
      });

      if (hasOvernightSchedule) {
        daysToCheck.push(previousDay);
      }
    }
  }

  // Check if current time falls within any of the configured time ranges for any of the days
  const result = daysToCheck.some((day) => {
    const daySchedule = schedule.weeklySchedule?.[day];

    // If the day is not enabled, skip it
    if (!daySchedule || !daySchedule.isEnabled) {
      return false;
    }

    // If no hours are configured for the day, skip it
    if (!daySchedule.hours || daySchedule.hours.length === 0) {
      return false;
    }

    // Check if current time falls within any of the configured time ranges
    return daySchedule.hours.some((timeRange) => isTimeInRange(currentTimeString, timeRange));
  });

  return result;
}

/**
 * Gets the day of the week as a string key for the weekly schedule
 */
export function getDayOfWeek(date: Date): keyof NonNullable<Schedule['weeklySchedule']> {
  return DAYS_OF_WEEK[date.getUTCDay()];
}

/**
 * Gets the previous day of the week for overnight schedule checking
 */
function getPreviousDay(
  day: keyof NonNullable<Schedule['weeklySchedule']>
): keyof NonNullable<Schedule['weeklySchedule']> | null {
  const currentIndex = DAYS_OF_WEEK.indexOf(day);
  const previousIndex = (currentIndex - 1 + 7) % 7;
  return DAYS_OF_WEEK[previousIndex];
}

/**
 * Formats a Date object to the time format used in schedules (e.g., "09:00 AM")
 */
function formatTime(date: Date, hasTimezone = false): string {
  const hours = hasTimezone ? date.getHours() : date.getUTCHours();
  const minutes = hasTimezone ? date.getMinutes() : date.getUTCMinutes();

  const period = hours < 12 ? 'AM' : 'PM';
  const displayHours = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;
  const formattedHours = displayHours.toString().padStart(2, '0');
  const formattedMinutes = minutes.toString().padStart(2, '0');

  return `${formattedHours}:${formattedMinutes} ${period}`;
}

/**
 * Checks if a time string falls within a time range
 */
function isTimeInRange(time: string, range: TimeRange): boolean {
  const timeInMinutes = timeToMinutes(time);
  const startInMinutes = timeToMinutes(range.start);
  const endInMinutes = timeToMinutes(range.end);

  // Handle cases where the end time is the next day (e.g., 11:00 PM to 2:00 AM)
  if (endInMinutes < startInMinutes) {
    return timeInMinutes >= startInMinutes || timeInMinutes <= endInMinutes;
  }

  return timeInMinutes >= startInMinutes && timeInMinutes <= endInMinutes;
}

/**
 * Converts a time string (e.g., "09:00 AM") to minutes since midnight
 */
function timeToMinutes(timeString: string): number {
  const [time, period] = timeString.split(' ');
  const [hours, minutes] = time.split(':').map(Number);

  let totalMinutes = hours * 60 + minutes;

  if (period === 'PM' && hours !== 12) {
    totalMinutes += 12 * 60;
  } else if (period === 'AM' && hours === 12) {
    totalMinutes = minutes; // 12:XX AM should be XX minutes past midnight
  }

  return totalMinutes;
}

function isWithinRange(date: Date, start: Date, end: Date) {
  return (isAfter(date, start) || isEqual(date, start)) && (isBefore(date, end) || isEqual(date, end));
}

export function calculateNextAvailableTime(schedule?: Schedule, nowUtc = new Date(), timeZone?: string): Date {
  if (!schedule || !schedule.isEnabled) return nowUtc;

  // "working time" in chosen zone (or UTC if no tz)
  const nowWorking = timeZone ? utcToZonedTime(nowUtc, timeZone) : nowUtc;

  // start from yesterday to handle overnight schedules
  for (let dayOffset = -1; dayOffset <= 7; dayOffset++) {
    const candidateDay = addDays(nowWorking, dayOffset);
    const weekday = getDayOfWeek(candidateDay);

    const daySchedule = schedule.weeklySchedule?.[weekday];
    if (!daySchedule?.isEnabled || !daySchedule?.hours) {
      continue;
    }

    for (const { start, end } of daySchedule.hours) {
      // get hours and minutes
      const startTime = parseTimeString(start);
      const endTime = parseTimeString(end);

      const startZoned = timeZone
        ? set(candidateDay, {
            hours: startTime.hours,
            minutes: startTime.minutes,
            seconds: 0,
            milliseconds: 0,
          })
        : new Date(
            Date.UTC(
              candidateDay.getUTCFullYear(),
              candidateDay.getUTCMonth(),
              candidateDay.getUTCDate(),
              startTime.hours,
              startTime.minutes,
              0,
              0
            )
          );

      let endZoned = timeZone
        ? set(candidateDay, {
            hours: endTime.hours,
            minutes: endTime.minutes,
            seconds: 0,
            milliseconds: 0,
          })
        : new Date(
            Date.UTC(
              candidateDay.getUTCFullYear(),
              candidateDay.getUTCMonth(),
              candidateDay.getUTCDate(),
              endTime.hours,
              endTime.minutes,
              0,
              0
            )
          );

      // handle overnight ranges (if end is before start, push to next day)
      if (isBefore(endZoned, startZoned)) {
        endZoned = addDays(endZoned, 1);
      }

      // if overnight day, and we are within the slot, return current time
      if (dayOffset <= 0 && isWithinRange(nowWorking, startZoned, endZoned)) {
        return nowUtc;
      }

      // if next day after current day, or start is after current time, return start time
      if (dayOffset > 0 || isAfter(startZoned, nowWorking)) {
        return timeZone
          ? zonedTimeToUtc(startZoned, timeZone)
          : new Date(
              Date.UTC(
                startZoned.getUTCFullYear(),
                startZoned.getUTCMonth(),
                startZoned.getUTCDate(),
                startZoned.getUTCHours(),
                startZoned.getUTCMinutes(),
                0,
                0
              )
            );
      }
    }
  }

  return nowUtc;
}

function parseTimeString(timeStr: string): { hours: number; minutes: number } {
  const [time, period] = timeStr.split(' ');
  const [hours, minutes] = time.split(':').map(Number);

  let adjustedHours = hours;
  if (period === 'PM' && hours !== 12) {
    adjustedHours += 12;
  } else if (period === 'AM' && hours === 12) {
    adjustedHours = 0;
  }

  return { hours: adjustedHours, minutes };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isWithinSchedule(schedule?: Schedule, currentTime: Date = new Date()
 - getDayOfWeek(date: Date)
 - getPreviousDay(day: keyof NonNullable<Schedule['weeklySchedule']>)
 - formatTime(date: Date, hasTimezone = false)
 - isTimeInRange(time: string, range: TimeRange)
 - timeToMinutes(timeString: string)
 - isWithinRange(date: Date, start: Date, end: Date)
 - calculateNextAvailableTime(schedule?: Schedule, nowUtc = new Date()
 - parseTimeString(timeStr: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - hasOvernightSchedule(previousDaySchedule.hours.some((timeRange))
 - result(daysToCheck.some((day))
Declaraciones 'export' encontradas:
- export function isWithinSchedule
- export function getDayOfWeek
- export function calculateNextAvailableTime

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/execute-step-custom.usecase.ts
Tamaño: 1052 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { CreateExecutionDetails, InstrumentUsecase } from '@novu/application-generic';
import { JobRepository, MessageRepository } from '@novu/dal';

import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus, SendMessageType } from './send-message-type.usecase';

@Injectable()
export class ExecuteStepCustom extends SendMessageType {
  constructor(
    private jobRepository: JobRepository,
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails
  ) {
    super(messageRepository, createExecutionDetails);
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    await this.jobRepository.updateOne(
      { _id: command.job._id, _environmentId: command.environmentId },
      {
        $set: { stepOutput: command.bridgeData?.outputs },
      }
    );

    return {
      status: SendMessageStatus.SUCCESS,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExecuteStepCustom

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/index.ts
Tamaño: 628 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './digest';
export { SendMessageCommand } from './send-message.command';
export { SendMessage } from './send-message.usecase';
export { SendMessageChannelCommand } from './send-message-channel.command';
export { SendMessageChat } from './send-message-chat.usecase';
export { SendMessageDelay } from './send-message-delay.usecase';
export { SendMessageEmail } from './send-message-email.usecase';
export { SendMessageInApp } from './send-message-in-app.usecase';
export { SendMessagePush } from './send-message-push.usecase';
export { SendMessageSms } from './send-message-sms.usecase';
export * from './throttle';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-channel.command.ts
Tamaño: 854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { SubscriberEntity, TenantEntity } from '@novu/dal';
import type { ContextResolved, ExecuteOutput } from '@novu/framework/internal';
import type { ITriggerPayload, SeverityLevelEnum } from '@novu/shared';
import { IsDefined, IsOptional } from 'class-validator';
import { SendMessageCommand } from './send-message.command';

export class SendMessageChannelCommand extends SendMessageCommand {
  @IsDefined()
  compileContext: {
    payload?: ITriggerPayload;
    subscriber: SubscriberEntity;
    actor?: SubscriberEntity;
    webhook?: Record<string, unknown>;
    tenant?: TenantEntity;
    context?: ContextResolved;
    step: {
      digest: boolean;
      events: any[] | undefined;
      total_count: number | undefined;
    };
  };

  @IsOptional()
  bridgeData: ExecuteOutput | null;

  @IsOptional()
  severity?: SeverityLevelEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendMessageChannelCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-chat.usecase.ts
Tamaño: 28704 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  ChatFactory,
  CompileTemplate,
  CompileTemplateCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  GetNovuProviderCredentials,
  InstrumentUsecase,
  messageWebhookMapper,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
  validateEndpointForType,
} from '@novu/application-generic';
import {
  ChannelConnectionRepository,
  ChannelEndpointEntity,
  ChannelEndpointRepository,
  IntegrationEntity,
  MessageEntity,
  MessageRepository,
  NotificationStepEntity,
  SubscriberRepository,
} from '@novu/dal';
import { ChatOutput } from '@novu/framework/internal';
import {
  ChannelTypeEnum,
  ChatProviderIdEnum,
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  ENDPOINT_TYPES,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IChannelSettings,
  makeResourceKey,
  ProvidersIdEnum,
  RESOURCE,
  WebhookEventEnum,
  WebhookObjectTypeEnum,
} from '@novu/shared';
import { ChannelData, ISendMessageSuccessResponse } from '@novu/stateless';
import { addBreadcrumb } from '@sentry/node';
import { PlatformException } from '../../../shared/utils';
import { SendMessageBase } from './send-message.base';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';

const LOG_CONTEXT = 'SendMessageChat';

type IntegrationChannelData = {
  integrationIdentifier: string;
  providerId: ProvidersIdEnum;
  channelData: ChannelData[];
};

type UnifiedChannel = {
  type: 'new' | 'legacy';
  data: IntegrationChannelData | IChannelSettings;
};

type MessageContext = {
  command: SendMessageChannelCommand;
  step: NotificationStepEntity;
  content: string;
  i18nInstance: unknown;
};

@Injectable()
export class SendMessageChat extends SendMessageBase {
  channelType = ChannelTypeEnum.CHAT;

  constructor(
    protected subscriberRepository: SubscriberRepository,
    protected messageRepository: MessageRepository,
    private compileTemplate: CompileTemplate,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected createExecutionDetails: CreateExecutionDetails,
    protected moduleRef: ModuleRef,
    private sendWebhookMessage: SendWebhookMessage,
    private channelEndpointRepository: ChannelEndpointRepository,
    private channelConnectionRepository: ChannelConnectionRepository
  ) {
    super(
      messageRepository,
      createExecutionDetails,
      subscriberRepository,
      selectIntegration,
      getNovuProviderCredentials,
      selectVariant,
      moduleRef
    );
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    try {
      // Phase 1: Prepare message context (template processing, content compilation)
      const messageContext = await this.prepareMessageContext(command);

      // Phase 2: Resolve all channels into unified format
      const channels = await this.resolveAllChannels(command);

      // Check if there are any active channels
      if (channels.length === 0) {
        await this.createExecutionDetail(
          command,
          DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL,
          ExecutionDetailsStatusEnum.FAILED
        );

        return {
          status: SendMessageStatus.FAILED,
          errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL,
        };
      }

      // Phase 3: Send to all channels using unified pipeline
      const status = await this.sendToAllChannels(channels, messageContext);

      // Phase 4: Finalize and return result
      return await this.finalizeResult(command, status);
    } catch (e) {
      if (e instanceof PlatformException && e.message === DetailEnum.MESSAGE_CONTENT_NOT_GENERATED) {
        return {
          status: SendMessageStatus.FAILED,
          errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
        };
      }
      throw e;
    }
  }

  /**
   * Prepares the message context by handling template processing, variant resolution, and content compilation
   */
  private async prepareMessageContext(command: SendMessageChannelCommand): Promise<MessageContext> {
    addBreadcrumb({
      message: 'Sending Chat',
    });
    const { step } = command;
    if (!step?.template) throw new PlatformException('Chat channel template not found');

    const { subscriber } = command.compileContext;
    const i18nInstance = await this.initiateTranslations(
      command.environmentId,
      command.organizationId,
      subscriber.locale
    );

    const template = await this.processVariants(command);

    if (template) {
      step.template = template;
    }

    const bridgeOutput = command.bridgeData?.outputs as ChatOutput | undefined;
    let content: string = bridgeOutput?.body || '';

    try {
      if (!command.bridgeData) {
        content = await this.compileTemplate.execute(
          CompileTemplateCommand.create({
            template: step.template.content as string,
            data: this.getCompilePayload(command.compileContext),
          }),
          i18nInstance
        );
      }
    } catch (e) {
      await this.sendErrorHandlebars(command.job, e.message);
      throw new PlatformException(DetailEnum.MESSAGE_CONTENT_NOT_GENERATED);
    }

    return { command, step, content, i18nInstance };
  }

  /**
   * Resolves all channels (both new and legacy) into a unified format for processing
   */
  private async resolveAllChannels(command: SendMessageChannelCommand): Promise<UnifiedChannel[]> {
    const integrationChannelGroups = await this.getChannelEndpointGroups(command);
    const legacyChatChannels = this.getLegacyChatChannels(command);

    const unifiedChannels: UnifiedChannel[] = [];

    // Add new integration channel groups
    for (const integrationGroup of integrationChannelGroups) {
      unifiedChannels.push({
        type: 'new',
        data: integrationGroup,
      });
    }

    // Add legacy channels
    for (const legacyChannel of legacyChatChannels) {
      unifiedChannels.push({
        type: 'legacy',
        data: legacyChannel,
      });
    }

    return unifiedChannels;
  }

  /**
   * Processes all unified channels using a single processing pipeline
   */
  private async sendToAllChannels(
    channels: UnifiedChannel[],
    messageContext: MessageContext
  ): Promise<SendMessageStatus> {
    let status: SendMessageStatus = SendMessageStatus.FAILED;

    for (const channel of channels) {
      try {
        let result: SendMessageResult;

        if (channel.type === 'new') {
          result = await this.sendChannelMessage(
            messageContext.command,
            channel.data as IntegrationChannelData,
            messageContext.step,
            messageContext.content
          );
        } else {
          result = await this.sendChannelMessageLegacy(
            messageContext.command,
            channel.data as IChannelSettings,
            messageContext.step,
            messageContext.content
          );
        }

        status = this.updateStatus(status, result.status);
      } catch (e) {
        /*
         * Do nothing, one chat channel failed, perhaps another one succeeds
         * The failed message has been created
         */
        const channelId =
          channel.type === 'new'
            ? (channel.data as IntegrationChannelData).providerId
            : (channel.data as IChannelSettings).providerId;
        Logger.error(e, `Sending chat message to ${channel.type} channel ${channelId} failed`, LOG_CONTEXT);
      }
    }

    return status;
  }

  /**
   * Finalizes the send result by handling final status logic and creating appropriate execution details
   */
  private async finalizeResult(
    command: SendMessageChannelCommand,
    status: SendMessageStatus
  ): Promise<SendMessageResult> {
    if (status === SendMessageStatus.FAILED) {
      await this.createExecutionDetail(command, DetailEnum.CHAT_ALL_CHANNELS_FAILED, ExecutionDetailsStatusEnum.FAILED);

      return {
        status,
        errorMessage: DetailEnum.CHAT_ALL_CHANNELS_FAILED,
      };
    } else if (status === SendMessageStatus.SKIPPED) {
      await this.createExecutionDetail(
        command,
        DetailEnum.CHAT_SOME_CHANNELS_SKIPPED,
        ExecutionDetailsStatusEnum.FAILED
      );

      return {
        status: SendMessageStatus.SKIPPED,
        deliveryLifecycleState: {
          status: DeliveryLifecycleStatusEnum.SKIPPED,
          detail: DeliveryLifecycleDetail.USER_MISSING_CREDENTIALS,
        },
      };
    }

    return {
      status,
    };
  }

  private getLegacyChatChannels(command: SendMessageChannelCommand): IChannelSettings[] {
    const { subscriber } = command.compileContext;

    const chatChannels =
      subscriber.channels?.filter((chan) =>
        Object.values(ChatProviderIdEnum).includes(chan.providerId as ChatProviderIdEnum)
      ) || [];

    // Add WhatsApp Business if subscriber has phone
    if (subscriber.phone) {
      // @ts-expect-error - Adding WhatsApp channel without _integrationId
      chatChannels.push({
        providerId: ChatProviderIdEnum.WhatsAppBusiness,
        credentials: {
          phoneNumber: subscriber.phone,
        },
      });
    }

    return chatChannels;
  }

  /**
   * Sends one message to multiple endpoints per integration (fanout)
   */
  private async sendChannelMessage(
    command: SendMessageChannelCommand,
    integrationChannelData: IntegrationChannelData,
    step: NotificationStepEntity,
    content: string
  ): Promise<SendMessageResult> {
    const { integration, error } = await this.getAndValidateIntegration(
      command,
      integrationChannelData.providerId,
      undefined,
      integrationChannelData.integrationIdentifier
    );
    if (error) return error;

    const message = await this.createMessage(
      command,
      step,
      content,
      integrationChannelData.providerId,
      integration,
      {},
      integrationChannelData.channelData
    );

    let status: SendMessageStatus = SendMessageStatus.FAILED;

    for (const channelData of integrationChannelData.channelData) {
      try {
        const result = await this.sendMessage(channelData, integration, content, message, command);

        if (result.status === SendMessageStatus.SUCCESS) {
          status = SendMessageStatus.SUCCESS;
        }
      } catch (e) {
        Logger.error(e, 'Failed to send chat message', LOG_CONTEXT);
      }
    }

    if (status === SendMessageStatus.SUCCESS) {
      return { status };
    }

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.PROVIDER_ERROR,
    };
  }

  /**
   * @deprecated - this method handles sending to legacy chat channels
   * sends 1 message per integration (no fanout to multiple endpoints)
   */
  private async sendChannelMessageLegacy(
    command: SendMessageChannelCommand,
    subscriberChannel: IChannelSettings,
    step: NotificationStepEntity,
    content: string
  ): Promise<SendMessageResult> {
    /**
     * Current a workaround as chat providers for whatsapp is more similar to sms than to our chat implementation
     */
    const integrationId =
      subscriberChannel.providerId !== ChatProviderIdEnum.WhatsAppBusiness
        ? subscriberChannel._integrationId
        : undefined;

    const { integration, error } = await this.getAndValidateIntegration(
      command,
      subscriberChannel.providerId,
      integrationId,
      undefined
    );
    if (error) return error;

    const combinedOverrides = this.combineOverrides(
      command.bridgeData,
      command.overrides,
      command.step.stepId,
      integration.providerId
    );

    const chatWebhookUrl =
      combinedOverrides?.webhookUrl || command.payload.webhookUrl || subscriberChannel.credentials?.webhookUrl;
    const phoneNumber = subscriberChannel.credentials?.phoneNumber;

    // transform the legacy channel (chatWebhookUrl, phoneNumber, channelSpecification) to new channelData interface
    const channelData = this.buildLegacyChannelData(subscriberChannel, combinedOverrides, command);

    const message = await this.createMessage(
      command,
      step,
      content,
      subscriberChannel.providerId,
      integration,
      {
        chatWebhookUrl,
        phone: phoneNumber,
      },
      channelData ? [channelData] : undefined
    );

    if (channelData) {
      return await this.sendMessage(channelData, integration, content, message, command);
    }

    return await this.sendErrors(chatWebhookUrl, integration, message, command, phoneNumber);
  }

  private buildLegacyChannelData(
    subscriberChannel: IChannelSettings,
    combinedOverrides: Record<string, unknown> | null,
    command: SendMessageChannelCommand
  ): ChannelData | null {
    const chatWebhookUrl =
      combinedOverrides?.webhookUrl || command.payload.webhookUrl || subscriberChannel.credentials?.webhookUrl;

    const phoneNumber = subscriberChannel.credentials?.phoneNumber;
    const channelSpecification = subscriberChannel.credentials?.channel;

    if (chatWebhookUrl) {
      return {
        identifier: '-',
        type: ENDPOINT_TYPES.WEBHOOK,
        endpoint: {
          url: chatWebhookUrl,
          ...(channelSpecification && { channel: channelSpecification }),
        },
      };
    }

    if (phoneNumber) {
      return {
        identifier: '-',
        type: ENDPOINT_TYPES.PHONE,
        endpoint: { phoneNumber },
      };
    }

    return null;
  }

  private async getChannelEndpointGroups(command: SendMessageChannelCommand): Promise<IntegrationChannelData[]> {
    const allChatEndpoints = await this.channelEndpointRepository.find({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      resource: makeResourceKey(RESOURCE.SUBSCRIBER, command.subscriberId),
      channel: ChannelTypeEnum.CHAT,
    });

    if (allChatEndpoints.length === 0) {
      return [];
    }

    // Fetch all needed connections
    const allConnectionIdentifiers = [
      ...new Set(allChatEndpoints.map((endpoint) => endpoint.connectionIdentifier).filter(Boolean)),
    ];

    const allConnections = await this.channelConnectionRepository.find({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      identifier: { $in: allConnectionIdentifiers },
    });

    // Build connection map for O(1) lookups
    const connectionMap = new Map(allConnections.map((conn) => [conn.identifier, conn]));

    // Group endpoints by integration
    const integrationGroups = this.groupEndpointsByIntegration(allChatEndpoints);

    return Object.entries(integrationGroups).map(([integrationIdentifier, endpoints]) => {
      const channelData: ChannelData[] = endpoints.map((endpoint) => {
        const connection = endpoint.connectionIdentifier ? connectionMap.get(endpoint.connectionIdentifier) : undefined;
        const hasToken = connection?.auth && 'accessToken' in connection.auth;

        return {
          identifier: endpoint.identifier,
          type: endpoint.type,
          endpoint: endpoint.endpoint,
          ...(hasToken && { token: connection.auth.accessToken || '' }),
        } as ChannelData;
      });

      return {
        integrationIdentifier,
        providerId: endpoints[0].providerId,
        channelData,
      };
    });
  }

  private groupEndpointsByIntegration(endpoints: ChannelEndpointEntity[]): Record<string, ChannelEndpointEntity[]> {
    return endpoints.reduce(
      (groups, endpoint) => {
        const key = endpoint.integrationIdentifier;
        if (!groups[key]) groups[key] = [];
        groups[key].push(endpoint);
        return groups;
      },
      {} as Record<string, ChannelEndpointEntity[]>
    );
  }

  private async sendErrors(
    chatWebhookUrl: string,
    integration: IntegrationEntity,
    message: MessageEntity,
    command: SendMessageChannelCommand,
    phoneNumber?: string
  ): Promise<SendMessageResult> {
    if (integration?.providerId === ChatProviderIdEnum.WhatsAppBusiness && !phoneNumber) {
      return await this.handleMissingResourceError(
        command,
        message,
        DetailEnum.CHAT_MISSING_PHONE_NUMBER,
        DeliveryLifecycleDetail.USER_MISSING_PHONE,
        'no_subscriber_chat_phone_number',
        'Subscriber does not have phone number specified',
        'Subscriber does not have a phone number for selected integration'
      );
    }

    if (!chatWebhookUrl) {
      return await this.handleMissingResourceError(
        command,
        message,
        DetailEnum.CHAT_WEBHOOK_URL_MISSING,
        DeliveryLifecycleDetail.USER_MISSING_WEBHOOK_URL,
        'no_subscriber_chat_channel_id',
        'Subscriber does not have active chat channel id',
        `webhookUrl for integrationId: ${integration?.identifier} is missing`
      );
    }

    if (!integration) {
      await this.sendErrorStatus(
        message,
        'warning',
        'chat_missing_integration_error',
        'Subscriber does not have an active chat integration',
        command
      );

      await this.createExecutionDetail(
        command,
        DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
        ExecutionDetailsStatusEnum.FAILED,
        message._id,
        'Integration is either deleted or not active'
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.PROVIDER_ERROR,
    };
  }

  private async sendMessage(
    channelData: ChannelData,
    integration: IntegrationEntity,
    content: string,
    message: MessageEntity,
    command: SendMessageChannelCommand
  ): Promise<SendMessageResult> {
    const chatHandler = this.setupChatHandler(integration);
    const overrides = this.buildMessageOverrides(command, integration);

    const combinedOverrides = this.combineOverrides(
      command.bridgeData,
      command.overrides,
      command.step.stepId,
      integration.providerId
    );

    // Apply channel data overrides if present for this specific endpoint
    const overriddenChannelData = this.applyEndpointSpecificOverrides(channelData, combinedOverrides);

    try {
      const result = await chatHandler.send({
        channelData: overriddenChannelData,
        bridgeProviderData: combinedOverrides,
        customData: overrides,
        content,
      });

      return await this.handleMessageSendSuccess(result, message, command, overriddenChannelData);
    } catch (error) {
      return await this.handleMessageSendError(error, message, command, overriddenChannelData);
    }
  }

  private updateStatus(currentStatus: SendMessageStatus, newStatus: SendMessageStatus): SendMessageStatus {
    if (newStatus === SendMessageStatus.SUCCESS) {
      return SendMessageStatus.SUCCESS;
    } else if (newStatus === SendMessageStatus.SKIPPED && currentStatus !== SendMessageStatus.SUCCESS) {
      return SendMessageStatus.SKIPPED;
    }
    return currentStatus;
  }

  private async createMessage(
    command: SendMessageChannelCommand,
    step: NotificationStepEntity,
    content: string,
    providerId: ProvidersIdEnum,
    integration: IntegrationEntity,
    additionalFields: Partial<MessageEntity> = {},
    channelData?: ChannelData[]
  ): Promise<MessageEntity> {
    const message: MessageEntity = await this.messageRepository.create({
      _notificationId: command.notificationId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _subscriberId: command._subscriberId,
      _templateId: command._templateId,
      _messageTemplateId: step.template?._id,
      channel: ChannelTypeEnum.CHAT,
      transactionId: command.transactionId,
      content: this.storeContent() ? content : null,
      providerId,
      _jobId: command.jobId,
      tags: command.tags,
      severity: command.severity,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
      ...(channelData &&
        channelData.length > 0 && { channelData: channelData.map((data) => this.redactChannelData(data)) }),
      ...additionalFields,
    });

    await this.sendSelectedIntegrationExecution(command.job, integration);

    await this.createExecutionDetail(
      command,
      DetailEnum.MESSAGE_CREATED,
      ExecutionDetailsStatusEnum.PENDING,
      message._id,
      this.storeContent() ? content : null
    );

    return message;
  }

  private async getAndValidateIntegration(
    command: SendMessageChannelCommand,
    providerId: ProvidersIdEnum,
    integrationId?: string,
    integrationIdentifier?: string
  ): Promise<{ integration: IntegrationEntity; error?: never } | { integration?: never; error: SendMessageResult }> {
    const getIntegrationParams = {
      organizationId: command.organizationId,
      environmentId: command.environmentId,
      providerId,
      channelType: ChannelTypeEnum.CHAT,
      userId: command.userId,
      filterData: {
        tenant: command.job.tenant,
      },
      ...(integrationId && { id: integrationId }),
      ...(integrationIdentifier && { identifier: integrationIdentifier }),
    };

    const integration = await this.getIntegration(getIntegrationParams);

    if (!integration) {
      const reason = integrationIdentifier
        ? `Integration with integrationIdentifier: ${integrationIdentifier} is either deleted or not active`
        : integrationId
          ? `Integration with integrationId: ${integrationId} is either deleted or not active`
          : `Integration is either deleted or not active`;

      await this.createExecutionDetail(
        command,
        DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
        ExecutionDetailsStatusEnum.FAILED,
        undefined,
        reason
      );

      return {
        error: {
          status: SendMessageStatus.FAILED,
          errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
        },
      };
    }

    return { integration };
  }

  private async createExecutionDetail(
    command: SendMessageChannelCommand,
    detail: DetailEnum,
    status: ExecutionDetailsStatusEnum,
    messageId?: string,
    rawData?: Record<string, unknown> | string | null
  ): Promise<void> {
    const rawValue = rawData ? (typeof rawData === 'string' ? rawData : JSON.stringify(rawData)) : undefined;

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        ...(messageId && { messageId }),
        detail,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status,
        isTest: false,
        isRetry: false,
        ...(rawValue && { raw: rawValue }),
      })
    );
  }

  private redactChannelData(channelData: ChannelData): ChannelData {
    return {
      ...channelData,
      ...('token' in channelData && channelData.token && { token: `${channelData.token.slice(0, 8)}...` }),
    };
  }

  private getErrorMessage(error: unknown): string {
    if (error instanceof Error) {
      return error.message;
    }
    return String(error);
  }

  private getErrorResponseData(error: unknown): Record<string, unknown> {
    if (error && typeof error === 'object' && 'response' in error) {
      const errorWithResponse = error as { response?: { data?: unknown } };
      const responseData = errorWithResponse.response?.data;
      return responseData ? { responseData } : {};
    }
    return {};
  }

  private setupChatHandler(integration: IntegrationEntity) {
    const chatFactory = new ChatFactory();
    const chatHandler = chatFactory.getHandler(integration);

    if (!chatHandler) {
      throw new PlatformException(`Chat handler for provider ${integration.providerId} is  not found`);
    }

    return chatHandler;
  }

  private buildMessageOverrides(command: SendMessageChannelCommand, integration: IntegrationEntity) {
    return {
      ...(command.overrides[integration?.channel] || {}),
      ...(command.overrides[integration?.providerId] || {}),
    };
  }

  private applyEndpointSpecificOverrides<T extends ChannelData>(
    originalChannelData: T,
    combinedOverrides: Record<string, unknown>
  ): T {
    const { identifier, type } = originalChannelData;

    // Early returns for invalid cases
    if (!identifier) return originalChannelData;

    const endpointOverrides = combinedOverrides[identifier];
    if (!endpointOverrides || typeof endpointOverrides !== 'object') {
      return originalChannelData;
    }

    const newEndpoint = (endpointOverrides as Record<string, unknown>).endpoint;
    if (!newEndpoint || typeof newEndpoint !== 'object') {
      return originalChannelData;
    }

    // Validate the new endpoint against the channel type schema
    try {
      validateEndpointForType(type, newEndpoint as Record<string, unknown>);

      return {
        ...originalChannelData,
        endpoint: newEndpoint as T['endpoint'],
      };
    } catch (_error) {
      // ignoring the override since it's invalid
      return originalChannelData;
    }
  }

  private async handleMessageSendSuccess(
    result: ISendMessageSuccessResponse,
    message: MessageEntity,
    command: SendMessageChannelCommand,
    channelData: ChannelData
  ): Promise<SendMessageResult> {
    const redactedChannelData = this.redactChannelData(channelData);

    await this.createExecutionDetail(
      command,
      DetailEnum.MESSAGE_SENT,
      ExecutionDetailsStatusEnum.SUCCESS,
      message._id,
      {
        ...result,
        channelData: redactedChannelData,
      }
    );

    await this.sendWebhookMessage.execute({
      eventType: WebhookEventEnum.MESSAGE_SENT,
      objectType: WebhookObjectTypeEnum.MESSAGE,
      payload: {
        object: messageWebhookMapper(message, command.subscriberId, {
          providerResponseId: result.id,
          // for backwards compatibility
          webhookUrl: channelData.type === ENDPOINT_TYPES.WEBHOOK ? channelData.endpoint.url : undefined,
          channelData: redactedChannelData,
        }),
      },
      organizationId: command.organizationId,
      environmentId: command.environmentId,
    });

    return {
      status: SendMessageStatus.SUCCESS,
    };
  }

  private async handleMessageSendError(
    error: unknown,
    message: MessageEntity,
    command: SendMessageChannelCommand,
    channelData: ChannelData
  ): Promise<SendMessageResult> {
    const redactedChannelData = this.redactChannelData(channelData);

    await this.sendErrorStatus(
      message,
      'error',
      'unexpected_chat_error',
      this.getErrorMessage(error) || 'Un-expect CHAT provider error',
      command,
      error
    );

    await this.createExecutionDetail(
      command,
      DetailEnum.PROVIDER_ERROR,
      ExecutionDetailsStatusEnum.FAILED,
      message._id,
      {
        channelData: redactedChannelData,
        message: this.getErrorMessage(error),
        ...this.getErrorResponseData(error),
      }
    );

    await this.sendWebhookMessage.execute({
      eventType: WebhookEventEnum.MESSAGE_SENT,
      objectType: WebhookObjectTypeEnum.MESSAGE,
      payload: {
        object: messageWebhookMapper(message, command.subscriberId, {
          channelData: redactedChannelData,
        }),
        error: {
          message: this.getErrorMessage(error) || 'Error while sending chat with provider',
        },
      },
      organizationId: command.organizationId,
      environmentId: command.environmentId,
    });

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.PROVIDER_ERROR,
    };
  }

  private async handleMissingResourceError(
    command: SendMessageChannelCommand,
    message: MessageEntity,
    detail: DetailEnum,
    lifecycleDetail: DeliveryLifecycleDetail,
    messageStatusKey: string,
    messageStatusDescription: string,
    reason: string
  ): Promise<SendMessageResult> {
    await this.messageRepository.updateMessageStatus(
      command.environmentId,
      message._id,
      'warning',
      null,
      messageStatusKey,
      messageStatusDescription
    );

    await this.createExecutionDetail(command, detail, ExecutionDetailsStatusEnum.FAILED, message._id, reason);

    return {
      status: SendMessageStatus.SKIPPED,
      deliveryLifecycleState: {
        status: DeliveryLifecycleStatusEnum.SKIPPED,
        detail: lifecycleDetail,
      },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - chatChannels(subscriber.channels?.filter((chan))
 - allConnectionIdentifiers([
      ...new Set(allChatEndpoints.map((endpoint))
 - connectionMap(new Map(allConnections.map((conn))
 - integrationGroups(this.groupEndpointsByIntegration(allChatEndpoints);

    return Object.entries(integrationGroups).ma...)
 - hasToken(connection?.auth && 'accessToken' in connection.auth;

        return {
          identifier: endpoi...)
 - MessageEntity(await this.messageRepository.create({
      _notificationId: command.notificationId,
      _environm...)
Declaraciones 'export' encontradas:
- export class SendMessageChat

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-delay.usecase.ts
Tamaño: 1293 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  InstrumentUsecase,
} from '@novu/application-generic';
import { MessageRepository } from '@novu/dal';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';
import { SendMessageCommand } from './send-message.command';
import { SendMessageResult, SendMessageStatus, SendMessageType } from './send-message-type.usecase';

@Injectable()
export class SendMessageDelay extends SendMessageType {
  constructor(
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails
  ) {
    super(messageRepository, createExecutionDetails);
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageCommand): Promise<SendMessageResult> {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        detail: DetailEnum.DELAY_FINISHED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.SUCCESS,
        isTest: false,
        isRetry: false,
      })
    );

    return {
      status: SendMessageStatus.SUCCESS,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendMessageDelay

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-email.usecase.ts
Tamaño: 22793 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger, Optional } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  CompileEmailTemplate,
  CompileEmailTemplateCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  FeatureFlagsService,
  GetLayoutCommand,
  GetLayoutUseCase as GetLayoutUseCaseV1,
  GetNovuProviderCredentials,
  InstrumentUsecase,
  MailFactory,
  messageWebhookMapper,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
} from '@novu/application-generic';
import {
  EnvironmentEntity,
  EnvironmentRepository,
  IntegrationEntity,
  LayoutRepository,
  MessageEntity,
  MessageRepository,
  OrganizationEntity,
  SubscriberRepository,
  UserEntity,
} from '@novu/dal';
import { EmailOutput } from '@novu/framework/internal';
import {
  ChannelTypeEnum,
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  EmailProviderIdEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  FeatureFlagsKeysEnum,
  IAttachmentOptions,
  IEmailOptions,
  WebhookEventEnum,
  WebhookObjectTypeEnum,
} from '@novu/shared';
import { addBreadcrumb } from '@sentry/node';
import inlineCss from 'inline-css';

import { PlatformException } from '../../../shared/utils';
import { SendMessageBase } from './send-message.base';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';

const LOG_CONTEXT = 'SendMessageEmail';

@Injectable()
export class SendMessageEmail extends SendMessageBase {
  channelType = ChannelTypeEnum.EMAIL;

  constructor(
    protected environmentRepository: EnvironmentRepository,
    protected subscriberRepository: SubscriberRepository,
    protected messageRepository: MessageRepository,
    protected layoutRepository: LayoutRepository,
    protected createExecutionDetails: CreateExecutionDetails,
    private compileEmailTemplateUsecase: CompileEmailTemplate,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected moduleRef: ModuleRef,
    private featureFlagService: FeatureFlagsService,
    private getLayoutUseCaseV1: GetLayoutUseCaseV1,
    private sendWebhookMessage: SendWebhookMessage
  ) {
    super(
      messageRepository,
      createExecutionDetails,
      subscriberRepository,
      selectIntegration,
      getNovuProviderCredentials,
      selectVariant,
      moduleRef
    );
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    let integration: IntegrationEntity | undefined;
    const { subscriber } = command.compileContext;
    const email: string | undefined = command.overrides?.email?.toRecipient || subscriber?.email;

    const overrideSelectedIntegration = command.overrides?.email?.integrationIdentifier;
    try {
      integration = await this.getIntegration({
        organizationId: command.organizationId,
        environmentId: command.environmentId,
        channelType: ChannelTypeEnum.EMAIL,
        userId: command.userId,
        recipientEmail: email,
        identifier: overrideSelectedIntegration as string,
        filterData: {
          tenant: command.job.tenant,
        },
      });
    } catch (e) {
      let detailEnum = DetailEnum.LIMIT_PASSED_NOVU_INTEGRATION;

      if (e.message.includes('does not match the current logged-in user')) {
        detailEnum = DetailEnum.SUBSCRIBER_NOT_MEMBER_OF_ORGANIZATION;
      }

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: detailEnum,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          raw: JSON.stringify({ message: e.message }),
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.LIMIT_PASSED_NOVU_INTEGRATION,
      };
    }

    const { step } = command;

    if (!step) throw new PlatformException('Email channel step not found');
    if (!step.template) throw new PlatformException('Email channel template not found');

    addBreadcrumb({
      message: 'Sending Email',
    });

    if (!integration) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          ...(overrideSelectedIntegration
            ? {
                raw: JSON.stringify({
                  integrationIdentifier: overrideSelectedIntegration,
                }),
              }
            : {}),
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }

    const bridgeOutputs = command.bridgeData?.outputs;
    const [template, overrideLayoutId] = await Promise.all([
      this.processVariants(command),
      this.getOverrideLayoutId(command, !!bridgeOutputs),
      this.sendSelectedIntegrationExecution(command.job, integration),
    ]);

    if (template) {
      step.template = template;
    }

    const overrides: Record<string, any> = {
      ...(command.overrides?.email || {}),
      ...(command.overrides?.[integration?.providerId] || {}),
    };

    let html;
    let subject = (bridgeOutputs as EmailOutput)?.subject || step?.template?.subject || '';
    let content;
    let senderName;

    const payload = {
      senderName: step.template.senderName,
      subject,
      preheader: step.template.preheader,
      content: step.template.content,
      layoutId: overrideLayoutId || (overrideLayoutId === null ? null : step.template._layoutId),
      contentType: step.template.contentType ? step.template.contentType : 'editor',
      payload: this.getCompilePayload(command.compileContext),
    };

    const messagePayload = { ...command.payload };
    delete messagePayload.attachments;

    const message: MessageEntity = await this.messageRepository.create({
      _notificationId: command.notificationId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _subscriberId: command._subscriberId,
      _templateId: command._templateId,
      _messageTemplateId: step.template._id,
      subject,
      channel: ChannelTypeEnum.EMAIL,
      transactionId: command.transactionId,
      email,
      providerId: integration?.providerId,
      payload: messagePayload,
      overrides,
      templateIdentifier: command.identifier,
      _jobId: command.jobId,
      tags: command.tags,
      severity: command.severity,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    });

    let replyToAddress: string | undefined;
    if (command.step.replyCallback?.active) {
      const replyTo = await this.getReplyTo(command, message._id);

      if (replyTo) {
        replyToAddress = replyTo;

        if (payload.payload.step) {
          payload.payload.step.reply_to_address = replyTo;
        }
      }
    }

    try {
      const i18nInstance = await this.initiateTranslations(
        command.environmentId,
        command.organizationId,
        subscriber?.locale
      );

      if (!command.bridgeData) {
        ({ html, content, subject, senderName } = await this.compileEmailTemplateUsecase.execute(
          CompileEmailTemplateCommand.create({
            environmentId: command.environmentId,
            organizationId: command.organizationId,
            userId: command.userId,
            ...payload,
          }),
          i18nInstance
        ));

        // TODO: remove as part of https://linear.app/novu/issue/NV-4117/email-html-content-issue-in-mobile-devices
        const shouldDisableInlineCss = await this.featureFlagService.getFlag({
          key: FeatureFlagsKeysEnum.IS_EMAIL_INLINE_CSS_DISABLED,
          defaultValue: false,
          environment: { _id: command.environmentId } as EnvironmentEntity,
          organization: { _id: command.organizationId } as OrganizationEntity,
          user: { _id: command.userId } as UserEntity,
        });

        if (!shouldDisableInlineCss) {
          // this is causing rendering issues in Gmail (especially when media queries are used), so we are disabling it
          html = await inlineCss(html, {
            // Used for style sheet links that starts with / so should not be needed in our case.
            url: ' ',
          });
        }
      }
    } catch (error) {
      Logger.error(
        { payload, error },
        'Compiling the email template or storing it or inlining it has failed',
        LOG_CONTEXT
      );
      await this.sendErrorHandlebars(command.job, error.message);

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
      };
    }

    if (this.storeContent()) {
      await this.messageRepository.update(
        {
          _id: message._id,
          _environmentId: command.environmentId,
        },
        {
          $set: {
            subject,
            content: (bridgeOutputs as EmailOutput)?.body || content,
          },
        }
      );
    }

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        detail: DetailEnum.MESSAGE_CREATED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        messageId: message._id,
        isTest: false,
        isRetry: false,
        raw: this.storeContent() ? JSON.stringify(payload) : null,
      })
    );

    const attachments = (<IAttachmentOptions[]>command.payload.attachments)?.map(
      (attachment) =>
        <IAttachmentOptions>{
          file: attachment.file,
          mime: attachment.mime,
          name: attachment.name,
          channels: attachment.channels,
          cid: attachment.cid,
          disposition: attachment.disposition,
        }
    );

    if (!email || !integration) {
      return await this.sendErrors(email, integration, message, command);
    }

    const mailData: IEmailOptions = createMailData(
      {
        // @ts-expect-error
        to: email,
        subject,
        html: (bridgeOutputs as EmailOutput)?.body || html,
        from: integration?.credentials.from || 'no-reply@novu.co',
        attachments,
        senderName,
        id: message._id,
        replyTo: replyToAddress,
        notificationDetails: {
          transactionId: command.transactionId,
          workflowIdentifier: command.identifier,
          subscriberId: subscriber.subscriberId,
        },
      },
      overrides || {}
    );

    if (command.overrides?.email?.replyTo) {
      mailData.replyTo = command.overrides?.email?.replyTo as string;
    }

    if (integration.providerId === EmailProviderIdEnum.EmailWebhook) {
      mailData.payloadDetails = payload;
    }

    return await this.sendMessage(integration, mailData, message, command);
  }

  private async getReplyTo(command: SendMessageChannelCommand, messageId: string): Promise<string | null> {
    if (!command.step.replyCallback?.url) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId,
          detail: DetailEnum.REPLY_CALLBACK_MISSING_REPLAY_CALLBACK_URL,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.WARNING,
          isTest: false,
          isRetry: false,
        })
      );

      return null;
    }

    const environment = await this.environmentRepository.findOne({ _id: command.environmentId });
    if (!environment) {
      throw new PlatformException(`Environment ${command.environmentId} is not found`);
    }

    if (environment.dns?.mxRecordConfigured && environment.dns?.inboundParseDomain) {
      return getReplyToAddress(command.transactionId, environment._id, environment?.dns?.inboundParseDomain);
    } else {
      const detailEnum =
        !environment.dns?.mxRecordConfigured && !environment.dns?.inboundParseDomain
          ? DetailEnum.REPLY_CALLBACK_NOT_CONFIGURATION
          : !environment.dns?.mxRecordConfigured
            ? DetailEnum.REPLY_CALLBACK_MISSING_MX_RECORD_CONFIGURATION
            : DetailEnum.REPLY_CALLBACK_MISSING_MX_ROUTE_DOMAIN_CONFIGURATION;

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId,
          detail: detailEnum,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.WARNING,
          isTest: false,
          isRetry: false,
        })
      );

      return null;
    }
  }

  private async sendErrors(
    email: string | undefined,
    integration: IntegrationEntity | undefined,
    message: MessageEntity,
    command: SendMessageChannelCommand
  ): Promise<SendMessageResult> {
    const errorMessage = 'Subscriber does not have an';
    const status = 'warning';
    const errorId = 'mail_unexpected_error';

    if (!email) {
      const mailErrorMessage = `${errorMessage} email address`;

      await this.sendErrorStatus(message, status, errorId, mailErrorMessage, command);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.SUBSCRIBER_MISSING_EMAIL_ADDRESS,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.SKIPPED,
        deliveryLifecycleState: {
          status: DeliveryLifecycleStatusEnum.SKIPPED,
          detail: DeliveryLifecycleDetail.USER_MISSING_EMAIL,
        },
      };
    }

    if (!integration) {
      const integrationError = `${errorMessage} active email integration not found`;

      await this.sendErrorStatus(message, status, errorId, integrationError, command);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.PROVIDER_ERROR,
    };
  }

  private async sendMessage(
    integration: IntegrationEntity,
    mailData: IEmailOptions,
    message: MessageEntity,
    command: SendMessageChannelCommand
  ): Promise<SendMessageResult> {
    const mailFactory = new MailFactory();
    const mailHandler = mailFactory.getHandler(this.buildFactoryIntegration(integration), mailData.from);

    try {
      const result = await mailHandler.send({
        ...mailData,
        bridgeProviderData: this.combineOverrides(
          command.bridgeData,
          command.overrides,
          command.step.stepId,
          integration.providerId
        ),
      });

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_SENT,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId, {
            providerResponseId: result.id,
          }),
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      Logger.verbose({ command }, 'Email message has been sent', LOG_CONTEXT);

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.MESSAGE_SENT,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify(result),
        })
      );

      Logger.verbose({ command }, 'Execution details of sending an email message have been stored', LOG_CONTEXT);

      if (!result?.id) {
        return {
          status: SendMessageStatus.FAILED,
          errorMessage: DetailEnum.PROVIDER_ERROR,
        };
      }

      await this.messageRepository.update(
        { _environmentId: command.environmentId, _id: message._id },
        {
          $set: {
            identifier: result.id,
          },
        }
      );

      return {
        status: SendMessageStatus.SUCCESS,
      };
    } catch (error) {
      await this.sendErrorStatus(
        message,
        'error',
        'mail_unexpected_error',
        error.message || error.name || 'Error while sending email with provider',
        command,
        error
      );

      /*
       * Axios Error, to provide better readability, otherwise stringify ignores response object
       * TODO: Handle this at the handler level globally
       */
      if (error?.isAxiosError && error.response) {
        error = error.response;
      }

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_FAILED,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId),
          error: {
            message: error.message || error.name || 'Error while sending email with provider',
          },
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.PROVIDER_ERROR,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify(error) === '{}' ? JSON.stringify({ message: error.message }) : JSON.stringify(error),
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.PROVIDER_ERROR,
      };
    }
  }

  private async getOverrideLayoutId(command: SendMessageChannelCommand, isBridge: boolean) {
    const { overrides, step } = command;
    let layoutId: string | null | undefined;
    let overrideSource: string | undefined;

    // Step 1: Check step-level override (highest priority)
    const stepId = overrides?.steps?.[step._id ?? ''] ? step._id : step.stepId;
    const stepOverrides = overrides?.steps?.[stepId ?? ''];
    if (stepOverrides?.layoutId !== undefined) {
      layoutId = stepOverrides.layoutId;
      overrideSource = 'step';
    }
    // Step 2: Check channel-level override for email
    else if (overrides?.channels?.email?.layoutId !== undefined) {
      layoutId = overrides.channels.email.layoutId;
      overrideSource = 'channel';
    }
    // Step 3: Check deprecated layoutIdentifier (backward compatibility)
    else if (overrides?.layoutIdentifier) {
      layoutId = overrides.layoutIdentifier;
      overrideSource = 'layoutIdentifier';
    }

    // If no override is specified, return undefined (use step configuration)
    if (layoutId === undefined) {
      return undefined;
    }

    // If explicitly set to null, return null (no layout)
    if (layoutId === null) {
      return null;
    }

    if (isBridge) {
      return layoutId;
    }

    // Look up layout by identifier or MongoDB ObjectId
    try {
      const layout = await this.getLayoutUseCaseV1.execute(
        GetLayoutCommand.create({
          layoutIdOrInternalId: layoutId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
        })
      );

      return layout._id;
    } catch (error) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.LAYOUT_NOT_FOUND,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({
            layoutId,
            overrideSource,
            error: error.message,
          }),
        })
      );
    }
  }

  public buildFactoryIntegration(integration: IntegrationEntity) {
    return {
      ...integration,
      credentials: {
        ...integration.credentials,
      },
      providerId: integration.providerId,
    };
  }
}

export const createMailData = (options: IEmailOptions, overrides: Record<string, any>): IEmailOptions => {
  const filterDuplicate = (prev: string[], current: string) => (prev.includes(current) ? prev : [...prev, current]);

  let to = Array.isArray(options.to) ? options.to : [options.to];
  to = [...to, ...(overrides?.to || [])];
  to = to.reduce(filterDuplicate, []);
  const ipPoolName = overrides?.ipPoolName ? { ipPoolName: overrides?.ipPoolName } : {};

  return {
    ...options,
    to,
    from: overrides?.from || options.from,
    text: overrides?.text,
    html: overrides?.html || overrides?.text || options.html,
    cc: overrides?.cc || [],
    bcc: overrides?.bcc || [],
    ...ipPoolName,
    senderName: overrides?.senderName || options.senderName,
    subject: overrides?.subject || options.subject,
    customData: overrides?.customData || {},
    headers: overrides?.headers || {},
  };
};

export function getReplyToAddress(transactionId: string, environmentId: string, inboundParseDomain: string) {
  const userNamePrefix = 'parse';
  const userNameDelimiter = '-nv-e=';

  return `${userNamePrefix}+${transactionId}${userNameDelimiter}${environmentId}@${inboundParseDomain}`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getReplyToAddress(transactionId: string, environmentId: string, inboundParseDomain: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - attachments(<IAttachmentOptions[]>command.payload.attachments)?.map(
      (attachment))
 - createMailData(options: IEmailOptions, overrides: Record<string, any>): IEmailOptions)
 - filterDuplicate(prev: string[], current: string))
Declaraciones 'export' encontradas:
- export class SendMessageEmail
- export  const
- export function getReplyToAddress

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-in-app.usecase.ts
Tamaño: 11312 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Optional } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  buildFeedKey,
  buildMessageCountKey,
  CompileInAppTemplate,
  CompileInAppTemplateCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  GetNovuProviderCredentials,
  InstrumentUsecase,
  InvalidateCacheService,
  messageWebhookMapper,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
  WebSocketsQueueService,
} from '@novu/application-generic';

import { MessageEntity, MessageRepository, SubscriberRepository } from '@novu/dal';
import { InAppOutput } from '@novu/framework/internal';
import {
  ActorTypeEnum,
  ChannelTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  inAppMessageFromBridgeOutputs,
  WebhookEventEnum,
  WebhookObjectTypeEnum,
  WebSocketEventEnum,
} from '@novu/shared';
import { addBreadcrumb } from '@sentry/node';
import { PlatformException } from '../../../shared/utils';
import { SendMessageBase } from './send-message.base';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';

@Injectable()
export class SendMessageInApp extends SendMessageBase {
  channelType = ChannelTypeEnum.IN_APP;

  constructor(
    private invalidateCache: InvalidateCacheService,
    protected messageRepository: MessageRepository,
    private webSocketsQueueService: WebSocketsQueueService,
    protected createExecutionDetails: CreateExecutionDetails,
    protected subscriberRepository: SubscriberRepository,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected moduleRef: ModuleRef,
    protected compileInAppTemplate: CompileInAppTemplate,
    private sendWebhookMessage: SendWebhookMessage
  ) {
    super(
      messageRepository,
      createExecutionDetails,
      subscriberRepository,
      selectIntegration,
      getNovuProviderCredentials,
      selectVariant,
      moduleRef
    );
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    if (!command.step.template) throw new PlatformException('Template not found');

    addBreadcrumb({
      message: 'Sending In App',
    });

    const integration = await this.getIntegration({
      organizationId: command.organizationId,
      environmentId: command.environmentId,
      channelType: ChannelTypeEnum.IN_APP,
      userId: command.userId,
      filterData: {
        tenant: command.job.tenant,
      },
    });

    if (!integration) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }

    const { step } = command;
    if (!step.template) throw new PlatformException('Template not found');

    let content = '';

    const { actor } = command.step.template;

    const { subscriber } = command.compileContext;
    const template = await this.processVariants(command);

    if (template) {
      step.template = template;
    }

    try {
      if (!command.bridgeData) {
        const i18nInstance = await this.initiateTranslations(
          command.environmentId,
          command.organizationId,
          subscriber.locale
        );

        const compiled = await this.compileInAppTemplate.execute(
          CompileInAppTemplateCommand.create({
            organizationId: command.organizationId,
            environmentId: command.environmentId,
            payload: this.getCompilePayload(command.compileContext),
            content: step.template.content as string,
            cta: step.template.cta,
            userId: command.userId,
          }),
          i18nInstance
        );
        content = compiled.content;

        if (step.template.cta?.data?.url) {
          step.template.cta.data.url = compiled.url;
        }

        if (step.template.cta?.action?.buttons) {
          step.template.cta.action.buttons = compiled.ctaButtons;
        }
      }
    } catch (e) {
      await this.sendErrorHandlebars(command.job, e.message);

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
      };
    }

    const messagePayload = { ...command.payload };
    delete messagePayload.attachments;

    let oldMessage: MessageEntity | null = null;
    /*
     * Only Stateful Workflows have a _templateId and _messageTemplateId, Stateless Workflows don't.
     * MongoDB will NOT throw an error when query attributes are missing, it will simply ignore them.
     * Therefore it's necessary to check for both before attempting to find the old message, otherwise
     * we risk finding a message that shares the other attributes. This is true for Stateless Workflows
     * that contain multiple in-app steps.
     *
     * Both _templateId and _messageTemplateId are actually required attributes of the MessageEntity,
     * however the `messageRepository` typings are currently incorrect, allowing for any attribute
     * to be passed in untyped.
     *
     * TODO: Fix the repository typings to allow for type-safe attribute access.
     *
     * TODO: After typing fixes, apply an approach that normalizes the _templateId and _messageTemplateId
     * for Stateless and Stateful Workflows to the same attribute, so that we can use a single query to
     * find the old message.
     */
    if (command._templateId && step.template._id) {
      oldMessage = await this.messageRepository.findOne({
        _notificationId: command.notificationId,
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        _subscriberId: command._subscriberId,
        _templateId: command._templateId,
        _messageTemplateId: step.template._id,
        templateIdentifier: command.identifier,
        transactionId: command.transactionId,
        providerId: integration.providerId,
        _feedId: step.template._feedId,
        channel: ChannelTypeEnum.IN_APP,
      });
    }

    let message: MessageEntity | null = null;

    await this.invalidateCache.invalidateQuery({
      key: buildFeedKey().invalidate({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    await this.invalidateCache.invalidateQuery({
      key: buildMessageCountKey().invalidate({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    // V2 data
    const bridgeOutputs = command.bridgeData?.outputs as InAppOutput;
    const inAppMessage = inAppMessageFromBridgeOutputs(bridgeOutputs);

    const additionalFields: Partial<
      Pick<MessageEntity, 'content' | 'subject' | 'avatar' | 'payload' | 'cta' | 'tags' | 'data' | 'severity'>
    > = {
      content: (this.storeContent() ? inAppMessage.content || content : null) as string,
      cta: bridgeOutputs ? inAppMessage.cta : step.template.cta,
      subject: inAppMessage.subject,
      avatar: inAppMessage.avatar,
      payload: messagePayload,
      data: inAppMessage.data,
      tags: command.tags,
      severity: command.severity,
    };

    if (!oldMessage) {
      message = await this.messageRepository.create({
        deliveredAt: [new Date()],
        _notificationId: command.notificationId,
        _organizationId: command.organizationId,
        _environmentId: command.environmentId,
        _subscriberId: command._subscriberId,
        _templateId: command._templateId,
        _messageTemplateId: step.template._id,
        templateIdentifier: command.identifier,
        transactionId: command.transactionId,
        providerId: integration.providerId,
        _feedId: step.template._feedId,
        channel: ChannelTypeEnum.IN_APP,
        _jobId: command.jobId,
        ...(command.contextKeys && { contextKeys: command.contextKeys }),
        ...(actor &&
          actor.type !== ActorTypeEnum.NONE && {
            actor,
            _actorId: command.job?._actorId,
          }),
        ...additionalFields,
      });
    }

    if (oldMessage) {
      message = await this.messageRepository.findOneAndUpdate(
        { _environmentId: command.environmentId, _id: oldMessage._id },
        {
          $set: {
            seen: false,
            createdAt: new Date(),
            updatedAt: new Date(),
            ...additionalFields,
          },
        },
        {
          timestamps: false,
          strict: false,
        }
      );
    }

    if (!message) throw new PlatformException('Message not found');

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        messageId: message._id,
        providerId: integration.providerId,
        detail: DetailEnum.MESSAGE_CREATED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: false,
      })
    );

    await this.webSocketsQueueService.add({
      name: 'sendMessage',
      data: {
        event: WebSocketEventEnum.RECEIVED,
        userId: command._subscriberId,
        _environmentId: command.environmentId,
        contextKeys: command.contextKeys,
        payload: {
          messageId: message._id,
        },
      },
      options: {
        removeOnComplete: true,
        removeOnFail: true,
      },
      groupId: command.organizationId,
    });

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        messageId: message._id,
        providerId: integration.providerId,
        detail: DetailEnum.MESSAGE_SENT,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.SUCCESS,
        isTest: false,
        isRetry: false,
      })
    );

    await this.sendWebhookMessage.execute({
      eventType: WebhookEventEnum.MESSAGE_SENT,
      objectType: WebhookObjectTypeEnum.MESSAGE,
      payload: {
        object: messageWebhookMapper(message, command.subscriberId, {
          providerResponseId: message._id,
        }),
      },
      organizationId: command.organizationId,
      environmentId: command.environmentId,
    });

    await this.sendWebhookMessage.execute({
      eventType: WebhookEventEnum.MESSAGE_DELIVERED,
      objectType: WebhookObjectTypeEnum.MESSAGE,
      payload: {
        object: messageWebhookMapper(message, command.subscriberId, {
          providerResponseId: message._id,
        }),
      },
      organizationId: command.organizationId,
      environmentId: command.environmentId,
    });

    return {
      status: SendMessageStatus.SUCCESS,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendMessageInApp

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-push.usecase.ts
Tamaño: 22433 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger, Optional } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  CompileTemplate,
  CompileTemplateCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  GetNovuProviderCredentials,
  InstrumentUsecase,
  IPushHandler,
  messageWebhookMapper,
  PushFactory,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
} from '@novu/application-generic';
import { IntegrationEntity, JobEntity, MessageEntity, MessageRepository, SubscriberRepository } from '@novu/dal';
import { PushOutput } from '@novu/framework/internal';
import {
  ChannelTypeEnum,
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IChannelSettings,
  ProvidersIdEnum,
  PushProviderIdEnum,
  TriggerOverrides,
  WebhookEventEnum,
  WebhookObjectTypeEnum,
} from '@novu/shared';
import { IPushOptions } from '@novu/stateless';
import { addBreadcrumb } from '@sentry/node';
import { merge } from 'lodash';
import { PlatformException } from '../../../shared/utils';
import { SendMessageBase } from './send-message.base';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';

const LOG_CONTEXT = 'SendMessagePush';

interface IPushProviderOverride {
  providerId: PushProviderIdEnum;
  overrides: Record<string, unknown>;
}

@Injectable()
export class SendMessagePush extends SendMessageBase {
  channelType = ChannelTypeEnum.PUSH;
  private pushProviderIds: PushProviderIdEnum[] = Object.values(PushProviderIdEnum);

  constructor(
    protected subscriberRepository: SubscriberRepository,
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails,
    private compileTemplate: CompileTemplate,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected moduleRef: ModuleRef,
    private sendWebhookMessage: SendWebhookMessage
  ) {
    super(
      messageRepository,
      createExecutionDetails,
      subscriberRepository,
      selectIntegration,
      getNovuProviderCredentials,
      selectVariant,
      moduleRef
    );
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    addBreadcrumb({
      message: 'Sending Push',
    });

    const { step } = command;
    const { subscriber, step: stepData } = command.compileContext;

    const template = await this.processVariants(command);
    const i18nInstance = await this.initiateTranslations(
      command.environmentId,
      command.organizationId,
      subscriber.locale
    );

    if (template) {
      step.template = template;
    }

    const data = this.getCompilePayload(command.compileContext);
    let content = '';
    let title = '';

    try {
      if (!command.bridgeData) {
        content = await this.compileTemplate.execute(
          CompileTemplateCommand.create({
            template: step.template?.content as string,
            data,
          }),
          i18nInstance
        );

        title = await this.compileTemplate.execute(
          CompileTemplateCommand.create({
            template: step.template?.title as string,
            data,
          }),
          i18nInstance
        );
      }
    } catch (e) {
      await this.sendErrorHandlebars(command.job, e.message);

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
      };
    }

    const pushChannels =
      subscriber.channels?.filter((chan) =>
        Object.values(PushProviderIdEnum).includes(chan.providerId as PushProviderIdEnum)
      ) || [];

    const pushProviderOverrides = this.getPushProviderOverrides(command.overrides, command.step?.stepId || '');
    const providersWithCredentialOverrides = this.filterProvidersWithCredentialOverrides(pushProviderOverrides);

    const channelsFromOverrides = await this.constructChannelSettingsFromOverrides(
      providersWithCredentialOverrides,
      command
    );
    const existingProviderIds = pushChannels.map((channel) => channel.providerId);
    const uniqueOverrideChannels = channelsFromOverrides.filter(
      (channel) => !existingProviderIds.includes(channel.providerId)
    );
    const allPushChannels = [...pushChannels, ...uniqueOverrideChannels];

    if (!allPushChannels.length) {
      await this.createExecutionDetailsError(DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL, command.job);

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL,
      };
    }

    const messagePayload = { ...command.payload };
    delete messagePayload.attachments;

    let status: SendMessageResult['status'] = SendMessageStatus.FAILED;
    for (const channel of allPushChannels) {
      const { deviceTokens } = channel.credentials || {};

      const isChannelMissingDeviceTokens = await this.isChannelMissingDeviceTokens(channel);
      if (isChannelMissingDeviceTokens) {
        await this.createExecutionDetails.execute(
          CreateExecutionDetailsCommand.create({
            ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
            detail: DetailEnum.PUSH_MISSING_DEVICE_TOKENS,
            source: ExecutionDetailsSourceEnum.INTERNAL,
            status: ExecutionDetailsStatusEnum.FAILED,
            isTest: false,
            isRetry: false,
            providerId: channel.providerId,
            raw: JSON.stringify(channel),
          })
        );

        if (status !== SendMessageStatus.SUCCESS) {
          status = SendMessageStatus.SKIPPED;
        }
      }

      let integration;
      try {
        integration = await this.getSubscriberIntegration(channel, command);
      } catch (error) {
        Logger.error(
          { jobId: command.jobId },
          `Unexpected error while processing channel for jobId ${command.jobId} ${error.message || error.toString()}`,
          LOG_CONTEXT
        );
        continue;
      }

      // We avoid to send a message if subscriber has not an integration or if the subscriber has no device tokens for said integration
      if ((!deviceTokens || !integration || isChannelMissingDeviceTokens) && !uniqueOverrideChannels?.length) {
        continue;
      }

      const overrides = command.overrides[integration.providerId] || {};
      const target = (overrides as { deviceTokens?: string[] }).deviceTokens || deviceTokens;

      await this.sendSelectedIntegrationExecution(command.job, integration);

      /**
       * There are no targets available for the subscriber, but credentials provided in the overrides
       */
      if (!target?.length && uniqueOverrideChannels?.length) {
        const message = await this.createMessage({
          command,
          integration,
          title,
          content,
          deviceTokens: target,
          overrides,
        });

        const result = await this.sendMessage(
          command,
          message,
          subscriber,
          integration,

          // credentials provided in the overrides
          '',
          title,
          content,
          overrides,
          stepData
        );

        if (result.success) {
          status = SendMessageStatus.SUCCESS;
        } else {
          Logger.error(
            { jobId: command.jobId },
            `Error sending push notification for jobId ${command.jobId} ${result.error.message || result.error.toString()}`,
            LOG_CONTEXT
          );
        }

        this.messageRepository.update(
          { _id: message._id, _environmentId: command.environmentId },
          {
            identifier: message._id,
          }
        );

        continue;
      }

      const targetDeviceTokens = target || [];
      for (const deviceToken of targetDeviceTokens) {
        const message = await this.createMessage({
          command,
          integration,
          title,
          content,
          deviceTokens: target,
          overrides,
        });

        const result = await this.sendMessage(
          command,
          message,
          subscriber,
          integration,
          deviceToken,
          title,
          content,
          overrides,
          stepData
        );

        this.messageRepository.update(
          { _id: message._id, _environmentId: command.environmentId },
          {
            identifier: message._id,
          }
        );

        if (result.success) {
          status = SendMessageStatus.SUCCESS;
        } else {
          Logger.error(
            { jobId: command.jobId },
            `Error sending push notification for jobId ${command.jobId} ${result.error.message || result.error.toString()}`,
            LOG_CONTEXT
          );
        }
      }
    }

    if (status === 'skipped') {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.PUSH_SOME_CHANNELS_SKIPPED,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.SKIPPED,
        deliveryLifecycleState: {
          status: DeliveryLifecycleStatusEnum.SKIPPED,
          detail: DeliveryLifecycleDetail.USER_MISSING_PUSH_TOKEN,
        },
      };
    } else if (status === 'failed') {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.NOTIFICATION_ERROR,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status,
        errorMessage: DetailEnum.NOTIFICATION_ERROR,
      };
    }

    return {
      status,
    };
  }

  /**
   * Collects all push provider IDs and their overrides from the TriggerOverrides structure
   */
  private getPushProviderOverrides(overrides: TriggerOverrides, stepId: string): IPushProviderOverride[] {
    if (!overrides) return [];

    const result: IPushProviderOverride[] = [];

    if (overrides.providers) {
      for (const providerId of Object.keys(overrides.providers)) {
        if (this.pushProviderIds.includes(providerId as PushProviderIdEnum)) {
          result.push({
            providerId: providerId as PushProviderIdEnum,
            overrides: {
              ...overrides.providers[providerId as ProvidersIdEnum],
            },
          });
        }
      }
    }

    if (overrides.steps?.[stepId]?.providers) {
      for (const providerId of Object.keys(overrides.steps[stepId].providers)) {
        if (this.pushProviderIds.includes(providerId as PushProviderIdEnum)) {
          const existingIndex = result.findIndex((item) => item.providerId === providerId);

          if (existingIndex >= 0) {
            // Merge with existing overrides, with step overrides taking precedence
            result[existingIndex].overrides = merge(
              {},
              result[existingIndex].overrides,
              overrides.steps[stepId].providers[providerId as ProvidersIdEnum]
            );
          } else {
            // Add new provider overrides
            result.push({
              providerId: providerId as PushProviderIdEnum,
              overrides: {
                ...overrides.steps[stepId].providers[providerId as ProvidersIdEnum],
              },
            });
          }
        }
      }
    }

    return result;
  }

  /**
   * Checks if specific overrides keys exist based on the delivery provider.
   * This solution is not ideal, as we expose provider related concerns in the usecase layer.
   * We will have to revisit this once we have a more flexible way to handle overrides and push providers.
   */
  private hasProviderSpecificOverrides(providerId: PushProviderIdEnum, overrides: Record<string, unknown>): boolean {
    if (!overrides) return false;

    switch (providerId) {
      case PushProviderIdEnum.FCM:
        return 'tokens' in overrides || 'topic' in overrides;
      default:
        return false;
    }
  }

  /**
   * Filters the provided array of push provider overrides and returns only those
   * that contain provider-specific credential keys
   */
  private filterProvidersWithCredentialOverrides(providerOverrides: IPushProviderOverride[]): IPushProviderOverride[] {
    if (!providerOverrides?.length) return [];

    return providerOverrides.filter((override) =>
      this.hasProviderSpecificOverrides(override.providerId, override.overrides)
    );
  }

  private async isChannelMissingDeviceTokens(channel: IChannelSettings): Promise<boolean> {
    const { deviceTokens } = channel.credentials || {};

    return !deviceTokens || (Array.isArray(deviceTokens) && deviceTokens.length === 0);
  }

  private async getSubscriberIntegration(
    channel: IChannelSettings,
    command: SendMessageChannelCommand
  ): Promise<IntegrationEntity | undefined> {
    const integration = await this.getIntegration({
      id: channel._integrationId,
      organizationId: command.organizationId,
      environmentId: command.environmentId,
      channelType: ChannelTypeEnum.PUSH,
      providerId: channel.providerId,
      userId: command.userId,
      filterData: {
        tenant: command.job.tenant,
      },
    });

    if (!integration) {
      await this.createExecutionDetailsError(DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION, command.job);

      return undefined;
    }

    return integration;
  }

  private async createExecutionDetailsError(
    detail: DetailEnum,
    job: JobEntity,
    contextData?: {
      messageId?: string;
      providerId?: ProvidersIdEnum;
      raw?: string;
    }
  ): Promise<void> {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.FAILED,
        isTest: false,
        isRetry: false,
        ...(contextData?.providerId && { providerId: contextData.providerId }),
        ...(contextData?.messageId && { messageId: contextData.messageId }),
        ...(contextData?.raw && { raw: contextData.raw }),
      })
    );
  }

  private async sendMessage(
    command: SendMessageChannelCommand,
    message: MessageEntity,
    subscriber: IPushOptions['subscriber'],
    integration: IntegrationEntity,
    deviceToken: string,
    title: string,
    content: string,
    overrides: object,
    step: IPushOptions['step']
  ): Promise<{ success: false; error: Error } | { success: true; error: undefined }> {
    try {
      Logger.log(
        { jobId: command.jobId, deviceToken, overrides, step },
        `Sending push notification for jobId ${command.jobId}`,
        LOG_CONTEXT
      );
      const pushHandler = this.getIntegrationHandler(integration);
      const bridgeOutputs = command.bridgeData?.outputs;

      Logger.log(
        { jobId: command.jobId, deviceToken, overrides, step },
        `Push handler obtained for jobId ${command.jobId}`,
        LOG_CONTEXT
      );

      const result = await pushHandler.send({
        target: [deviceToken],
        title: (bridgeOutputs as PushOutput)?.subject || title,
        content: (bridgeOutputs as PushOutput)?.body || content,
        payload: { ...command.payload, __nvMessageId: message._id },
        overrides,
        subscriber,
        step,
        bridgeProviderData: this.combineOverrides(
          command.bridgeData,
          command.overrides,
          command.step.stepId,
          integration.providerId
        ),
      });

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.MESSAGE_SENT,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ providerId: integration.providerId, result, deviceToken }),
        })
      );

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_SENT,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId, {
            providerResponseId: result.id,
            deviceToken,
          }),
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      return { success: true, error: undefined };
    } catch (e) {
      Logger.log(
        {
          jobId: command.jobId,
          errorContent: JSON.stringify(e) || e?.message,
          code: e?.code,
          message: e?.message,
          details: e?.details,
        },
        `Failed push delivery for jobId ${command.jobId} ${e.message || e.toString()}`,
        LOG_CONTEXT
      );

      await this.sendErrorStatus(
        message,
        'error',
        'unexpected_push_error',
        e.message || e.name || 'Un-expect Push provider error',
        command,
        e
      );

      const raw = JSON.stringify(e) !== JSON.stringify({}) ? JSON.stringify(e) : JSON.stringify(e.message);

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_SENT,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId),
          error: {
            message: e.message || e.name || 'Error while sending push with provider',
          },
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      try {
        await this.createExecutionDetailsError(DetailEnum.PROVIDER_ERROR, command.job, {
          messageId: message._id,
          raw,
        });
      } catch (err) {
        Logger.error(
          { jobId: command.jobId },
          `Error sending provider error for jobId ${command.jobId} ${err.message || err.toString()}`,
          LOG_CONTEXT
        );
      }

      return { success: false, error: e };
    }
  }

  private async createMessage({
    command,
    integration,
    title,
    content,
    deviceTokens,
    overrides,
  }: {
    command: SendMessageChannelCommand;
    integration: IntegrationEntity;
    title: string;
    content: string;
    deviceTokens?: string[];
    overrides: object;
  }): Promise<MessageEntity> {
    const message = await this.messageRepository.create({
      _notificationId: command.notificationId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _subscriberId: command._subscriberId,
      _templateId: command._templateId,
      _messageTemplateId: command.step?.template?._id,
      channel: ChannelTypeEnum.PUSH,
      transactionId: command.transactionId,
      deviceTokens,
      content: this.storeContent() ? content : null,
      title,
      payload: command.payload as never,
      overrides: overrides as never,
      providerId: integration.providerId,
      _jobId: command.jobId,
      tags: command.tags,
      severity: command.severity,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    });

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        detail: DetailEnum.MESSAGE_CREATED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        messageId: message._id,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({
          providerId: integration.providerId,
          content: this.storeContent() ? JSON.stringify(content) : null,
        }),
      })
    );

    return message;
  }

  private getIntegrationHandler(integration): IPushHandler {
    const pushFactory = new PushFactory();
    const pushHandler = pushFactory.getHandler(integration);

    if (!pushHandler) {
      const message = `Push handler for provider ${integration.providerId} is  not found`;
      throw new PlatformException(message);
    }

    return pushHandler;
  }

  private async constructChannelSettingsFromOverrides(
    providersWithCredentialOverrides: IPushProviderOverride[],
    command: SendMessageChannelCommand
  ): Promise<IChannelSettings[]> {
    const channelSettings: IChannelSettings[] = [];

    for (const providerOverride of providersWithCredentialOverrides) {
      const credentials = this.extractCredentialsFromOverride(providerOverride.providerId, providerOverride.overrides);

      if (!credentials) continue;

      const integration = await this.selectIntegration.execute({
        organizationId: command.organizationId,
        environmentId: command.environmentId,
        channelType: ChannelTypeEnum.PUSH,
        providerId: providerOverride.providerId,
        userId: command.userId,
        filterData: {
          tenant: command.job.tenant,
        },
      });

      if (!integration) continue;

      channelSettings.push({
        _integrationId: integration._id,
        providerId: providerOverride.providerId,
        credentials,
      });
    }

    return channelSettings;
  }

  private extractCredentialsFromOverride(
    providerId: PushProviderIdEnum,
    overrides: Record<string, unknown>
  ): {
    deviceTokens?: string[];
    topic?: string;
  } | null {
    if (!overrides) return null;

    switch (providerId) {
      case PushProviderIdEnum.FCM:
        if (Array.isArray(overrides.tokens)) {
          return {
            deviceTokens: overrides.tokens,
          };
        }

        if (overrides.topic) {
          return {
            topic: overrides.topic as string,
          };
        }

        return null;
      default:
        return null;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - pushChannels(subscriber.channels?.filter((chan))
 - existingProviderIds(pushChannels.map((channel))
 - uniqueOverrideChannels(channelsFromOverrides.filter(
      (channel))
 - existingIndex(result.findIndex((item))
 - overrides(merge(
              {},
              result[existingIndex].overrides,
              overrides.step...)
Declaraciones 'export' encontradas:
- export class SendMessagePush

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-sms.usecase.ts
Tamaño: 13106 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  CompileTemplate,
  CompileTemplateCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  GetNovuProviderCredentials,
  InstrumentUsecase,
  messageWebhookMapper,
  SelectIntegration,
  SelectVariant,
  SendWebhookMessage,
  SmsFactory,
} from '@novu/application-generic';

import { IntegrationEntity, MessageEntity, MessageRepository, SubscriberRepository } from '@novu/dal';
import { SmsOutput } from '@novu/framework/internal';
import {
  ChannelTypeEnum,
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  WebhookEventEnum,
  WebhookObjectTypeEnum,
} from '@novu/shared';
import { addBreadcrumb } from '@sentry/node';
import { PlatformException } from '../../../shared/utils';
import { SendMessageBase } from './send-message.base';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';

@Injectable()
export class SendMessageSms extends SendMessageBase {
  channelType = ChannelTypeEnum.SMS;

  constructor(
    protected subscriberRepository: SubscriberRepository,
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails,
    private compileTemplate: CompileTemplate,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected moduleRef: ModuleRef,
    private sendWebhookMessage: SendWebhookMessage
  ) {
    super(
      messageRepository,
      createExecutionDetails,
      subscriberRepository,
      selectIntegration,
      getNovuProviderCredentials,
      selectVariant,
      moduleRef
    );
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageChannelCommand): Promise<SendMessageResult> {
    const overrideSelectedIntegration = command.overrides?.sms?.integrationIdentifier;

    const integration = await this.getIntegration({
      organizationId: command.organizationId,
      environmentId: command.environmentId,
      channelType: ChannelTypeEnum.SMS,
      userId: command.userId,
      identifier: overrideSelectedIntegration as string,
      filterData: {
        tenant: command.job.tenant,
      },
    });

    addBreadcrumb({
      message: 'Sending SMS',
    });

    const { step } = command;

    if (!step.template) throw new PlatformException(`Unexpected error: SMS template is missing`);

    const { subscriber } = command.compileContext;
    const template = await this.processVariants(command);
    const i18nInstance = await this.initiateTranslations(
      command.environmentId,
      command.organizationId,
      subscriber.locale
    );

    if (template) {
      step.template = template;
    }

    const bridgeOutput = command.bridgeData?.outputs as SmsOutput | undefined;
    let content: string = bridgeOutput?.body || '';

    try {
      if (!command.bridgeData) {
        content = await this.compileTemplate.execute(
          CompileTemplateCommand.create({
            template: step.template.content as string,
            data: this.getCompilePayload(command.compileContext),
          }),
          i18nInstance
        );

        if (!content) {
          throw new PlatformException(`Unexpected error: SMS content is missing`);
        }
      }
    } catch (e) {
      await this.sendErrorHandlebars(command.job, e.message);

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
      };
    }

    const phone = command.payload.phone || subscriber.phone;

    if (!integration) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          ...(overrideSelectedIntegration
            ? {
                raw: JSON.stringify({
                  integrationIdentifier: overrideSelectedIntegration,
                }),
              }
            : {}),
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }

    await this.sendSelectedIntegrationExecution(command.job, integration);

    const overrides = {
      ...(command.overrides[integration?.channel] || {}),
      ...(command.overrides[integration?.providerId] || {}),
    };

    const messagePayload = { ...command.payload };
    delete messagePayload.attachments;

    const message: MessageEntity = await this.messageRepository.create({
      _notificationId: command.notificationId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _subscriberId: command._subscriberId,
      _templateId: command._templateId,
      _messageTemplateId: step.template._id,
      channel: ChannelTypeEnum.SMS,
      transactionId: command.transactionId,
      phone,
      content: this.storeContent() ? content : null,
      providerId: integration?.providerId,
      payload: messagePayload,
      overrides,
      templateIdentifier: command.identifier,
      _jobId: command.jobId,
      tags: command.tags,
      severity: command.severity,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    });

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        detail: DetailEnum.MESSAGE_CREATED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        messageId: message._id,
        isTest: false,
        isRetry: false,
        raw: this.storeContent() ? JSON.stringify(messagePayload) : null,
      })
    );

    if (!phone || !integration) {
      return await this.sendErrors(phone, integration, message, command);
    }

    return await this.sendMessage(phone, integration, content, message, command, overrides);
  }

  private async sendErrors(
    phone,
    integration,
    message: MessageEntity,
    command: SendMessageChannelCommand
  ): Promise<SendMessageResult> {
    if (!phone) {
      await this.messageRepository.updateMessageStatus(
        command.environmentId,
        message._id,
        'warning',
        null,
        'no_subscriber_phone',
        'Subscriber does not have active phone'
      );

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.SUBSCRIBER_MISSING_PHONE_NUMBER,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.SKIPPED,
        deliveryLifecycleState: {
          status: DeliveryLifecycleStatusEnum.SKIPPED,
          detail: DeliveryLifecycleDetail.USER_MISSING_PHONE,
        },
      };
    }
    if (!integration) {
      await this.sendErrorStatus(
        message,
        'warning',
        'sms_missing_integration_error',
        'Subscriber does not have an active sms integration',
        command
      );

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION,
      };
    }
    if (!integration?.credentials?.from) {
      await this.sendErrorStatus(
        message,
        'warning',
        'no_integration_from_phone',
        'Integration does not have from phone configured',
        command
      );

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL,
      };
    }

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.PROVIDER_ERROR,
    };
  }

  private async sendMessage(
    phone: string,
    integration: IntegrationEntity,
    content: string,
    message: MessageEntity,
    command: SendMessageChannelCommand,
    overrides: Record<string, any> = {}
  ): Promise<SendMessageResult> {
    try {
      const bridgeBody = command.bridgeData?.outputs.body;

      const smsFactory = new SmsFactory();
      const smsHandler = smsFactory.getHandler(this.buildFactoryIntegration(integration));
      if (!smsHandler) {
        throw new PlatformException(`Sms handler for provider ${integration.providerId} is  not found`);
      }

      const result = await smsHandler.send({
        to: overrides.to || phone,
        from: overrides.from || integration.credentials.from,
        content: bridgeBody || overrides.content || content,
        id: message._id,
        customData: overrides.customData || {},
        bridgeProviderData: this.combineOverrides(
          command.bridgeData,
          command.overrides,
          command.step.stepId,
          integration.providerId
        ),
      });

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.MESSAGE_SENT,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify(result),
        })
      );

      if (!result?.id) {
        return {
          status: SendMessageStatus.FAILED,
          errorMessage: DetailEnum.PROVIDER_ERROR,
        };
      }

      await this.messageRepository.update(
        { _environmentId: command.environmentId, _id: message._id },
        {
          $set: {
            identifier: result.id,
          },
        }
      );

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_SENT,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId, {
            providerResponseId: result.id,
          }),
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      return {
        status: SendMessageStatus.SUCCESS,
      };
    } catch (e) {
      await this.sendErrorStatus(
        message,
        'error',
        'unexpected_sms_error',
        e.message || e.name || 'Un-expect SMS provider error',
        command,
        e
      );

      await this.sendWebhookMessage.execute({
        eventType: WebhookEventEnum.MESSAGE_FAILED,
        objectType: WebhookObjectTypeEnum.MESSAGE,
        payload: {
          object: messageWebhookMapper(message, command.subscriberId),
          error: {
            message: e.message || e.name || 'Error while sending sms with provider',
          },
        },
        organizationId: command.organizationId,
        environmentId: command.environmentId,
      });

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          messageId: message._id,
          detail: DetailEnum.PROVIDER_ERROR,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ message: e?.response?.data || e.message, name: e.name }),
        })
      );

      return {
        status: SendMessageStatus.FAILED,
        errorMessage: DetailEnum.PROVIDER_ERROR,
      };
    }
  }

  public buildFactoryIntegration(integration: IntegrationEntity, senderName?: string) {
    return {
      ...integration,
      providerId: integration.providerId,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendMessageSms

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message-type.usecase.ts
Tamaño: 2152 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CreateExecutionDetails, DetailEnum } from '@novu/application-generic';
import { DeliveryLifecycleState, JobEntity, MessageEntity, MessageRepository } from '@novu/dal';
import { SendMessageChannelCommand } from './send-message-channel.command';

export enum SendMessageStatus {
  SUCCESS = 'success',
  FAILED = 'failed',
  SKIPPED = 'skipped',
  THROTTLED = 'throttled',
}

export type SendMessageResultPassed = {
  status: SendMessageStatus.SUCCESS;
  extraData?: string;
  job?: JobEntity;
};

export type SendMessageResultSkipped = {
  status: SendMessageStatus.SKIPPED;
  deliveryLifecycleState?: DeliveryLifecycleState;
  extraData?: string;
  job?: JobEntity;
};

export type SendMessageResultFailed = {
  status: SendMessageStatus.FAILED;
  errorMessage: DetailEnum;
  extraData?: string;
  job?: JobEntity;
};

export type SendMessageResultThrottled = {
  status: SendMessageStatus.THROTTLED;
  extraData?: string;
  job?: JobEntity;
};

export type SendMessageResult =
  | SendMessageResultPassed
  | SendMessageResultSkipped
  | SendMessageResultFailed
  | SendMessageResultThrottled;

export abstract class SendMessageType {
  protected constructor(
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails
  ) {}

  public abstract execute(command: SendMessageChannelCommand): Promise<SendMessageResult>;

  protected async sendErrorStatus(
    message: MessageEntity,
    status: 'error' | 'sent' | 'warning',
    errorId: string,
    errorMessageFallback: string,
    command: SendMessageChannelCommand,
    error?: any
  ): Promise<void> {
    const errorString = this.stringifyError(error) || errorMessageFallback;

    await this.messageRepository.updateMessageStatus(
      command.environmentId,
      message._id,
      status,
      null,
      errorId,
      errorString
    );
  }

  private stringifyError(error: any): string {
    if (!error) return '';

    if (typeof error === 'string' || error instanceof String) {
      return error.toString();
    }
    if (Object.keys(error)?.length > 0) {
      return JSON.stringify(error);
    }

    return '';
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export  type
- export  type
- export  type
- export  type
- export  type
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message.base.ts
Tamaño: 7591 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  createProviderSelectedMessage,
  DetailEnum,
  GetNovuProviderCredentials,
  SelectIntegration,
  SelectIntegrationCommand,
  SelectVariant,
  SelectVariantCommand,
} from '@novu/application-generic';
import {
  IntegrationEntity,
  JobEntity,
  MessageRepository,
  MessageTemplateEntity,
  SubscriberRepository,
} from '@novu/dal';
import {
  ChannelTypeEnum,
  ChatProviderIdEnum,
  EmailProviderIdEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  ITenantDefine,
  ProvidersIdEnum,
  providers,
  SmsProviderIdEnum,
  TriggerOverrides,
} from '@novu/shared';
import { format } from 'date-fns';
import i18next from 'i18next';
import { merge } from 'lodash';
import { PlatformException } from '../../../shared/utils';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageResult, SendMessageStatus, SendMessageType } from './send-message-type.usecase';

export abstract class SendMessageBase extends SendMessageType {
  abstract readonly channelType: ChannelTypeEnum;
  protected constructor(
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails,
    protected subscriberRepository: SubscriberRepository,
    protected selectIntegration: SelectIntegration,
    protected getNovuProviderCredentials: GetNovuProviderCredentials,
    protected selectVariant: SelectVariant,
    protected moduleRef: ModuleRef
  ) {
    super(messageRepository, createExecutionDetails);
  }

  protected combineOverrides(
    bridgeData: Record<string, any> | null | undefined,
    overrides: TriggerOverrides | undefined,
    stepId: string | undefined,
    integrationId: string
  ): Record<string, unknown> {
    const bridgeProviderData = bridgeData?.providers?.[integrationId] || {};
    const workflowGlobalProviderOverrides = overrides?.providers?.[integrationId] || {};
    const triggerOverrides = stepId ? overrides?.steps?.[stepId]?.providers?.[integrationId] || {} : {};

    return merge({}, bridgeProviderData, workflowGlobalProviderOverrides, triggerOverrides);
  }

  protected async getIntegration(params: {
    id?: string;
    providerId?: ProvidersIdEnum;
    identifier?: string;
    organizationId: string;
    environmentId: string;
    channelType: ChannelTypeEnum;
    userId: string;
    recipientEmail?: string;
    filterData: {
      tenant: ITenantDefine | undefined;
    };
  }): Promise<IntegrationEntity | undefined> {
    const integration = await this.selectIntegration.execute(SelectIntegrationCommand.create(params));

    if (!integration) {
      return;
    }

    if (
      integration.providerId === EmailProviderIdEnum.Novu ||
      integration.providerId === SmsProviderIdEnum.Novu ||
      integration.providerId === ChatProviderIdEnum.Novu
    ) {
      integration.credentials = await this.getNovuProviderCredentials.execute({
        channelType: integration.channel,
        providerId: integration.providerId,
        environmentId: integration._environmentId,
        organizationId: integration._organizationId,
        userId: params.userId,
        recipientEmail: params.recipientEmail,
      });
    }

    return integration;
  }

  protected storeContent(): boolean {
    return this.channelType === ChannelTypeEnum.IN_APP || process.env.STORE_NOTIFICATION_CONTENT === 'true';
  }

  protected getCompilePayload(compileContext) {
    const { payload, ...rest } = compileContext;

    return { ...payload, ...rest };
  }

  protected async sendErrorHandlebars(job: JobEntity, error: string): Promise<SendMessageResult> {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.FAILED,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({ error }),
      })
    );

    return {
      status: SendMessageStatus.FAILED,
      errorMessage: DetailEnum.MESSAGE_CONTENT_NOT_GENERATED,
    };
  }

  protected async sendSelectedIntegrationExecution(job: JobEntity, integration: IntegrationEntity) {
    const providerDisplayName = providers.find((el) => el.id === integration?.providerId)?.displayName || 'Unknown';

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: createProviderSelectedMessage(providerDisplayName) as DetailEnum,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({
          providerId: integration?.providerId,
          identifier: integration?.identifier,
          name: integration?.name,
          _environmentId: integration?._environmentId,
          _id: integration?._id,
        }),
      })
    );
  }

  protected async processVariants(command: SendMessageChannelCommand): Promise<MessageTemplateEntity> {
    const { messageTemplate, conditions } = await this.selectVariant.execute(
      SelectVariantCommand.create({
        organizationId: command.organizationId,
        environmentId: command.environmentId,
        userId: command.userId,
        step: command.step,
        job: command.job,
        filterData: command.compileContext ?? {},
      })
    );

    if (conditions) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.VARIANT_CHOSEN,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.PENDING,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ conditions }),
        })
      );
    }

    return messageTemplate;
  }

  protected async initiateTranslations(environmentId: string, organizationId: string, locale: string | undefined) {
    try {
      if (process.env.NOVU_ENTERPRISE === 'true' || process.env.CI_EE_TEST === 'true') {
        if (!require('@novu/ee-shared-services')?.TranslationsService) {
          throw new PlatformException('Translation module is not loaded');
        }
        const service = this.moduleRef.get(require('@novu/ee-shared-services')?.TranslationsService, { strict: false });
        const { namespaces, resources, defaultLocale } = await service.getTranslationsList(
          environmentId,
          organizationId
        );

        const instance = i18next.createInstance({
          resources,
          ns: namespaces,
          defaultNS: false,
          nsSeparator: '.',
          lng: locale || 'en',
          compatibilityJSON: 'v2',
          fallbackLng: defaultLocale || 'en',
          interpolation: {
            formatSeparator: ',',
            format(value, formatting, lng) {
              if (value && formatting && !Number.isNaN(Date.parse(value))) {
                return format(new Date(value), formatting);
              }

              return value.toString();
            },
          },
        });

        await instance.init();

        return instance;
      }
    } catch (e) {
      Logger.error(e, `Unexpected error while importing enterprise modules`, 'TranslationsService');
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - providerDisplayName(providers.find((el))
Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message.command.ts
Tamaño: 1061 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import type { JobEntity, NotificationStepEntity } from '@novu/dal';
import type { SeverityLevelEnum, TriggerOverrides, WorkflowPreferences } from '@novu/shared';
import { IsDefined, IsOptional, IsString } from 'class-validator';

export class SendMessageCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsString()
  identifier: string;

  @IsDefined()
  payload: any;

  @IsDefined()
  overrides: TriggerOverrides;

  @IsDefined()
  step: NotificationStepEntity;

  @IsString()
  @IsDefined()
  transactionId: string;

  @IsDefined()
  notificationId: string;

  @IsOptional()
  _templateId?: string;

  @IsDefined()
  subscriberId: string;

  @IsDefined()
  _subscriberId: string;

  @IsDefined()
  jobId: string;

  @IsOptional()
  events?: any[];

  @IsDefined()
  job: JobEntity;

  @IsDefined()
  tags: string[];

  @IsOptional()
  severity?: SeverityLevelEnum;

  @IsOptional()
  statelessPreferences?: WorkflowPreferences;

  @IsOptional()
  contextKeys?: string[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendMessageCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/send-message.usecase.ts
Tamaño: 19145 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  AnalyticsService,
  buildSubscriberKey,
  CachedResponse,
  ConditionsFilter,
  ConditionsFilterCommand,
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  GetPreferences,
  GetSubscriberTemplatePreference,
  GetSubscriberTemplatePreferenceCommand,
  IConditionsFilterResponse,
  IFilterVariables,
  Instrument,
  InstrumentUsecase,
  NormalizeVariables,
  NormalizeVariablesCommand,
  PlatformException,
} from '@novu/application-generic';
import {
  ContextRepository,
  JobEntity,
  NotificationTemplateRepository,
  SubscriberRepository,
  TenantEntity,
  TenantRepository,
} from '@novu/dal';
import { ContextResolved, ExecuteOutput } from '@novu/framework/internal';
import {
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  DigestTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IDigestRegularMetadata,
  IDigestTimedMetadata,
  IPreferenceChannels,
  PreferencesTypeEnum,
  ResourceTypeEnum,
  StepTypeEnum,
} from '@novu/shared';
import { ExecuteBridgeJob } from '../execute-bridge-job';
import { Digest } from './digest';
import { ExecuteStepCustom } from './execute-step-custom.usecase';
import { SendMessageCommand } from './send-message.command';
import { SendMessageChannelCommand } from './send-message-channel.command';
import { SendMessageChat } from './send-message-chat.usecase';
import { SendMessageDelay } from './send-message-delay.usecase';
import { SendMessageEmail } from './send-message-email.usecase';
import { SendMessageInApp } from './send-message-in-app.usecase';
import { SendMessagePush } from './send-message-push.usecase';
import { SendMessageSms } from './send-message-sms.usecase';
import { SendMessageResult, SendMessageStatus } from './send-message-type.usecase';
import { Throttle } from './throttle';

@Injectable()
export class SendMessage {
  constructor(
    private sendMessageEmail: SendMessageEmail,
    private sendMessageSms: SendMessageSms,
    private sendMessageInApp: SendMessageInApp,
    private sendMessageChat: SendMessageChat,
    private sendMessagePush: SendMessagePush,
    private digest: Digest,
    private createExecutionDetails: CreateExecutionDetails,
    private getSubscriberTemplatePreferenceUsecase: GetSubscriberTemplatePreference,
    private notificationTemplateRepository: NotificationTemplateRepository,
    private sendMessageDelay: SendMessageDelay,
    private throttle: Throttle,
    private executeStepCustom: ExecuteStepCustom,
    private conditionsFilter: ConditionsFilter,
    private subscriberRepository: SubscriberRepository,
    private tenantRepository: TenantRepository,
    private analyticsService: AnalyticsService,
    private normalizeVariablesUsecase: NormalizeVariables,
    private contextRepository: ContextRepository,
    private executeBridgeJob: ExecuteBridgeJob
  ) {}

  @InstrumentUsecase()
  public async execute(command: SendMessageCommand): Promise<SendMessageResult> {
    const payload = await this.buildCompileContext(command);

    const variables = await this.normalizeVariablesUsecase.execute(
      NormalizeVariablesCommand.create({
        filters: command.job.step.filters || [],
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        userId: command.userId,
        step: command.step,
        job: command.job,
        variables: payload,
      })
    );

    const stepType = command.step?.template?.type;

    let bridgeResponse: ExecuteOutput | null = null;
    if (isChannelStep(stepType)) {
      bridgeResponse = await this.executeBridgeJob.execute({
        ...command,
        variables,
      });
    }
    const isBridgeSkipped = bridgeResponse?.options?.skip;
    if (isBridgeSkipped) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.SKIPPED_BRIDGE_EXECUTION,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ skip: isBridgeSkipped }),
        })
      );
    }

    const { stepCondition, channelPreference } = await this.evaluateFilters(command, variables);
    if (!command.payload?.$on_boarding_trigger) {
      this.sendProcessStepEvent(
        command,
        isBridgeSkipped,
        stepCondition,
        channelPreference.result,
        !!bridgeResponse?.outputs
      );
    }

    const conditionsShouldRun = stepCondition?.passed;
    const preferenceShouldRun = channelPreference.result;
    const isBridgeSkippedShouldRun = !isBridgeSkipped;

    if (!conditionsShouldRun || !preferenceShouldRun || !isBridgeSkippedShouldRun) {
      return {
        status: SendMessageStatus.SKIPPED,
        deliveryLifecycleState: {
          status: DeliveryLifecycleStatusEnum.SKIPPED,
          detail: !channelPreference.result
            ? DeliveryLifecycleDetail.SUBSCRIBER_PREFERENCE
            : DeliveryLifecycleDetail.USER_STEP_CONDITION,
        },
      };
    }

    let severity = command.severity;
    const { overrides } = command;
    if (stepType !== StepTypeEnum.TRIGGER && overrides?.severity && overrides.severity !== severity) {
      severity = overrides.severity;

      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.MESSAGE_SEVERITY_OVERRIDDEN,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.PENDING,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({
            from: `${command.severity}`,
            to: `${severity}`,
          }),
        })
      );
    }

    const sendMessageChannelCommand = SendMessageChannelCommand.create({
      ...command,
      compileContext: payload,
      bridgeData: bridgeResponse,
      severity,
    });

    switch (stepType) {
      case StepTypeEnum.TRIGGER: {
        return { status: SendMessageStatus.SUCCESS };
      }
      case StepTypeEnum.SMS: {
        return await this.sendMessageSms.execute(sendMessageChannelCommand);
      }
      case StepTypeEnum.IN_APP: {
        return await this.sendMessageInApp.execute(sendMessageChannelCommand);
      }
      case StepTypeEnum.EMAIL: {
        return await this.sendMessageEmail.execute(sendMessageChannelCommand);
      }
      case StepTypeEnum.CHAT: {
        return await this.sendMessageChat.execute(sendMessageChannelCommand);
      }
      case StepTypeEnum.PUSH: {
        return await this.sendMessagePush.execute(sendMessageChannelCommand);
      }
      case StepTypeEnum.DIGEST: {
        return await this.digest.execute(command);
      }
      case StepTypeEnum.DELAY: {
        return await this.sendMessageDelay.execute(command);
      }
      case StepTypeEnum.THROTTLE: {
        return await this.throttle.execute(command);
      }
      case StepTypeEnum.CUSTOM: {
        return await this.executeStepCustom.execute(sendMessageChannelCommand);
      }
      default: {
        throw new Error(`Unsupported step type: ${stepType}`);
      }
    }
  }

  private async evaluateFilters(
    command: SendMessageCommand,
    variables: IFilterVariables
  ): Promise<{
    stepCondition: IConditionsFilterResponse;
    channelPreference: { result: boolean; reason?: DetailEnum };
  }> {
    const [stepCondition, channelPreference] = await Promise.all([
      this.evaluateStepCondition(command, variables),
      this.evaluateChannelPreference(command),
    ]);

    return { stepCondition, channelPreference };
  }

  private async evaluateStepCondition(command: SendMessageCommand, variables: IFilterVariables) {
    const stepCondition = await this.conditionsFilter.filter(
      ConditionsFilterCommand.create({
        filters: command.job.step.filters || [],
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        userId: command.userId,
        step: command.step,
        job: command.job,
        variables,
      })
    );

    if (!stepCondition?.passed) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
          detail: DetailEnum.SKIPPED_STEP_BY_CONDITIONS,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({
            filter: {
              conditions: stepCondition?.conditions,
              passed: stepCondition?.passed,
            },
          }),
        })
      );
    }

    return stepCondition;
  }

  private sendProcessStepEvent(
    command: SendMessageCommand,
    isBridgeSkipped: boolean | undefined,
    filterResult: IConditionsFilterResponse | null,
    preferredResult: boolean | null,
    isBridgeWorkflow: boolean
  ) {
    const usedFilters = filterResult?.conditions?.reduce(ConditionsFilter.sumFilters, {
      filters: [],
      failedFilters: [],
      passedFilters: [],
    });

    const { digest } = command.job;
    let timedInfo: Record<string, unknown> = {};

    if (digest && 'type' in digest && digest.type === DigestTypeEnum.TIMED) {
      const timedDigest = digest as IDigestTimedMetadata;
      if (timedDigest.timed) {
        timedInfo = {
          digestAtTime: timedDigest.timed.atTime,
          digestWeekDays: timedDigest.timed.weekDays,
          digestMonthDays: timedDigest.timed.monthDays,
          digestOrdinal: timedDigest.timed.ordinal,
          digestOrdinalValue: timedDigest.timed.ordinalValue,
        };
      }
    }

    /**
     * userId is empty string due to mixpanel hot shard events.
     * This is intentional, so that mixpanel can automatically reshard it.
     */
    this.analyticsService.mixpanelTrack('Process Workflow Step - [Triggers]', '', {
      workflowType: isBridgeWorkflow ? ResourceTypeEnum.BRIDGE : ResourceTypeEnum.REGULAR,
      _template: command.job._templateId,
      _organization: command.organizationId,
      _environment: command.environmentId,
      _subscriber: command.job?._subscriberId,
      provider: command.job?.providerId,
      delay: command.job?.delay,
      jobType: command.job?.type,
      digestType: digest && 'type' in digest ? digest.type : undefined,
      digestEventsCount: digest?.events?.length,
      digestUnit: digest && 'unit' in digest ? digest.unit : undefined,
      digestAmount: digest && 'amount' in digest ? digest.amount : undefined,
      digestBackoff:
        (digest && 'type' in digest && digest.type === DigestTypeEnum.BACKOFF) ||
        (digest as IDigestRegularMetadata)?.backoff === true,
      ...timedInfo,
      filterPassed: filterResult?.passed,
      preferencesPassed: preferredResult,
      isBridgeSkipped,
      ...(usedFilters || {}),
      source: command.payload.__source || 'api',
    });
  }

  @Instrument()
  private async evaluateChannelPreference(
    command: SendMessageCommand
  ): Promise<{ result: boolean; reason?: DetailEnum }> {
    const { job } = command;

    if (this.isActionStep(job)) {
      return { result: true };
    }

    const workflow = await this.getWorkflow({
      _id: job._templateId,
      environmentId: job._environmentId,
    });

    const subscriber = await this.getSubscriberBySubscriberId({
      _environmentId: job._environmentId,
      subscriberId: job.subscriberId,
    });
    if (!subscriber) throw new PlatformException(`Subscriber not found with id ${job._subscriberId}`);

    let subscriberPreference: { enabled: boolean; channels: IPreferenceChannels };
    let subscriberPreferenceType: PreferencesTypeEnum;
    if (command.statelessPreferences) {
      /*
       * Stateless Workflow executions do not have their definitions stored in the database.
       * Their preferences are available in the command instead.
       *
       * TODO: Refactor the send-message flow to better handle stateless workflows
       */
      const workflowPreference = GetPreferences.mapWorkflowPreferencesToChannelPreferences(
        command.statelessPreferences
      );
      subscriberPreference = {
        enabled: true,
        channels: workflowPreference,
      };
      subscriberPreferenceType = PreferencesTypeEnum.WORKFLOW_RESOURCE;
    } else {
      if (!workflow) {
        throw new PlatformException(`Workflow with id '${job._templateId}' was not found`);
      }

      const { preference, type } = await this.getSubscriberTemplatePreferenceUsecase.execute(
        GetSubscriberTemplatePreferenceCommand.create({
          organizationId: job._organizationId,
          subscriberId: subscriber.subscriberId,
          environmentId: job._environmentId,
          template: workflow,
          subscriber,
          tenant: job.tenant,
          includeInactiveChannels: false,
        })
      );
      subscriberPreference = preference;
      subscriberPreferenceType = type;
    }

    const result = this.stepPreferred(subscriberPreference, job);

    const preferenceDetailFromPreferenceType: Record<PreferencesTypeEnum, DetailEnum> = {
      [PreferencesTypeEnum.WORKFLOW_RESOURCE]: DetailEnum.STEP_FILTERED_BY_WORKFLOW_RESOURCE_PREFERENCES,
      [PreferencesTypeEnum.SUBSCRIBER_WORKFLOW]: DetailEnum.STEP_FILTERED_BY_SUBSCRIBER_WORKFLOW_PREFERENCES,
      [PreferencesTypeEnum.SUBSCRIBER_GLOBAL]: DetailEnum.STEP_FILTERED_BY_SUBSCRIBER_GLOBAL_PREFERENCES,
      [PreferencesTypeEnum.USER_WORKFLOW]: DetailEnum.STEP_FILTERED_BY_USER_WORKFLOW_PREFERENCES,
    };

    const reason = preferenceDetailFromPreferenceType[subscriberPreferenceType];
    if (!result) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: reason,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.SUCCESS,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify(subscriberPreference),
        })
      );
    }

    return { result, reason };
  }

  @Instrument()
  private async buildCompileContext(command: SendMessageCommand): Promise<SendMessageChannelCommand['compileContext']> {
    const [subscriber, actor, tenant, context] = await Promise.all([
      this.getSubscriberBySubscriberId({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
      command.job.actorId &&
        this.getSubscriberBySubscriberId({
          subscriberId: command.job.actorId,
          _environmentId: command.environmentId,
        }),
      this.handleTenantExecution(command.job),
      this.resolveContext(command),
    ]);

    if (!subscriber) throw new PlatformException('Subscriber not found');

    return {
      subscriber,
      payload: command.payload,
      step: {
        digest: !!command.events?.length,
        events: command.events,
        total_count: command.events?.length,
      },
      ...(tenant && { tenant }),
      ...(actor && { actor }),
      ...(context && { context }),
    };
  }

  @Instrument()
  private async resolveContext(command: SendMessageCommand): Promise<ContextResolved> {
    const { contextKeys, environmentId, organizationId } = command;

    if (!contextKeys || contextKeys.length === 0) {
      return {} as ContextResolved;
    }

    const contexts = await this.contextRepository.findByKeys(environmentId, organizationId, contextKeys);

    return contexts.reduce((acc, context) => {
      acc[context.type] = {
        id: context.id,
        data: context.data,
      };
      return acc;
    }, {} as ContextResolved);
  }

  private async getWorkflow({ _id, environmentId }: { _id: string; environmentId: string }) {
    return await this.notificationTemplateRepository.findById(_id, environmentId);
  }

  @CachedResponse({
    builder: (command: { subscriberId: string; _environmentId: string }) =>
      buildSubscriberKey({
        _environmentId: command._environmentId,
        subscriberId: command.subscriberId,
      }),
  })
  public async getSubscriberBySubscriberId({
    subscriberId,
    _environmentId,
  }: {
    subscriberId: string;
    _environmentId: string;
  }) {
    return await this.subscriberRepository.findOne({
      _environmentId,
      subscriberId,
    });
  }

  @Instrument()
  private stepPreferred(preference: { enabled: boolean; channels: IPreferenceChannels }, job: JobEntity) {
    const workflowPreferred = preference.enabled;

    const channelPreferred = Object.keys(preference.channels).some(
      (channelKey) => channelKey === job.type && preference.channels[job.type]
    );

    return workflowPreferred && channelPreferred;
  }

  private isActionStep(job: JobEntity) {
    const channels = [StepTypeEnum.IN_APP, StepTypeEnum.EMAIL, StepTypeEnum.SMS, StepTypeEnum.PUSH, StepTypeEnum.CHAT];

    return !channels.find((channel) => channel === job.type);
  }

  protected async sendSelectedTenantExecution(job: JobEntity, tenant: TenantEntity) {
    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
        detail: DetailEnum.TENANT_CONTEXT_SELECTED,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.PENDING,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify({
          identifier: tenant?.identifier,
          name: tenant?.name,
          data: tenant?.data,
          createdAt: tenant?.createdAt,
          updatedAt: tenant?.updatedAt,
          _environmentId: tenant?._environmentId,
          _id: tenant?._id,
        }),
      })
    );
  }

  protected async handleTenantExecution(job: JobEntity): Promise<TenantEntity | null> {
    const tenantIdentifier = job.tenant?.identifier;

    let tenant: TenantEntity | null = null;
    if (tenantIdentifier) {
      tenant = await this.tenantRepository.findOne({
        _environmentId: job._environmentId,
        identifier: tenantIdentifier,
      });
      if (!tenant) {
        await this.createExecutionDetails.execute(
          CreateExecutionDetailsCommand.create({
            ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
            detail: DetailEnum.TENANT_NOT_FOUND,
            source: ExecutionDetailsSourceEnum.INTERNAL,
            status: ExecutionDetailsStatusEnum.FAILED,
            isTest: false,
            isRetry: false,
            raw: JSON.stringify({
              tenantIdentifier,
            }),
          })
        );

        return null;
      }
      await this.sendSelectedTenantExecution(job, tenant);
    }

    return tenant;
  }
}

function isChannelStep(stepType: StepTypeEnum | undefined) {
  return ![StepTypeEnum.DIGEST, StepTypeEnum.DELAY, StepTypeEnum.TRIGGER].includes(stepType as StepTypeEnum);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isChannelStep(stepType: StepTypeEnum | undefined)
Asignaciones con arrow functions encontradas (posibles funciones):
 - contexts(await this.contextRepository.findByKeys(environmentId, organizationId, contextKeys);

    return con...)
 - channelPreferred(Object.keys(preference.channels).some(
      (channelKey))
 - channels([StepTypeEnum.IN_APP, StepTypeEnum.EMAIL, StepTypeEnum.SMS, StepTypeEnum.PUSH, StepTypeEnum.CHAT];

...)
Declaraciones 'export' encontradas:
- export class SendMessage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/digest-events.command.ts
Tamaño: 280 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseCommand } from '@novu/application-generic';
import { JobEntity } from '@novu/dal';
import { IsDefined } from 'class-validator';

export class DigestEventsCommand extends BaseCommand {
  @IsDefined()
  _subscriberId: string;

  @IsDefined()
  currentJob: JobEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DigestEventsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/digest.usecase.ts
Tamaño: 5214 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  FeatureFlagsService,
} from '@novu/application-generic';
import {
  EnvironmentEntity,
  JobEntity,
  JobRepository,
  JobStatusEnum,
  MessageRepository,
  OrganizationEntity,
  UserEntity,
} from '@novu/dal';
import {
  DigestTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  FeatureFlagsKeysEnum,
  IDigestRegularMetadata,
  StepTypeEnum,
} from '@novu/shared';
import { PlatformException } from '../../../../shared/utils';
import { SendMessageCommand } from '../send-message.command';
import { SendMessageResult, SendMessageStatus, SendMessageType } from '../send-message-type.usecase';
import { DigestEventsCommand } from './digest-events.command';
import { GetDigestEventsBackoff } from './get-digest-events-backoff.usecase';
import { GetDigestEventsRegular } from './get-digest-events-regular.usecase';

const LOG_CONTEXT = 'Digest';

@Injectable()
export class Digest extends SendMessageType {
  constructor(
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails,
    protected jobRepository: JobRepository,
    private getDigestEventsRegular: GetDigestEventsRegular,
    private getDigestEventsBackoff: GetDigestEventsBackoff,
    private featureFlagService: FeatureFlagsService
  ) {
    super(messageRepository, createExecutionDetails);
  }

  public async execute(command: SendMessageCommand): Promise<SendMessageResult> {
    const currentJob = await this.getCurrentJob(command);

    const useMergedDigestIdEnabled = await this.featureFlagService.getFlag({
      key: FeatureFlagsKeysEnum.IS_USE_MERGED_DIGEST_ID_ENABLED,
      defaultValue: false,
      environment: { _id: command.environmentId } as EnvironmentEntity,
      organization: { _id: command.organizationId } as OrganizationEntity,
      user: { _id: command.userId } as UserEntity,
    });

    const getEvents = useMergedDigestIdEnabled
      ? this.getEvents.bind(this)
      : this.backwardCompatibleGetEvents.bind(this);

    const events = await getEvents(command, currentJob);
    const nextJobs = await this.getJobsToUpdate(command);

    await this.createExecutionDetails.execute(
      CreateExecutionDetailsCommand.create({
        ...CreateExecutionDetailsCommand.getDetailsFromJob(command.job),
        detail: DetailEnum.DIGEST_TRIGGERED_EVENTS,
        source: ExecutionDetailsSourceEnum.INTERNAL,
        status: ExecutionDetailsStatusEnum.SUCCESS,
        isTest: false,
        isRetry: false,
        raw: JSON.stringify(events),
      })
    );

    const jobsToUpdate = [...nextJobs.map((job) => job._id), command.job._id];

    await this.jobRepository.update(
      {
        _environmentId: command.environmentId,
        _id: {
          $in: jobsToUpdate,
        },
      },
      {
        $set: {
          'digest.events': events,
        },
      }
    );

    const updatedJob = await this.jobRepository.findOne({
      _id: command.job._id,
      _environmentId: command.environmentId,
    });

    return {
      job: updatedJob ?? undefined,
      status: SendMessageStatus.SUCCESS,
    };
  }

  private async getEvents(command: SendMessageCommand, currentJob: JobEntity) {
    const jobs = await this.jobRepository.find(
      {
        _mergedDigestId: currentJob._id,
        status: JobStatusEnum.MERGED,
        type: StepTypeEnum.DIGEST,
        _environmentId: currentJob._environmentId,
        _subscriberId: command._subscriberId,
      },
      'payload'
    );

    return [currentJob.payload, ...jobs.map((job) => job.payload)];
  }

  private async backwardCompatibleGetEvents(command: SendMessageCommand, currentJob: JobEntity) {
    const digestEventsCommand = DigestEventsCommand.create({
      currentJob,
      _subscriberId: command._subscriberId,
    });

    if (
      (currentJob?.digest && 'type' in currentJob.digest && currentJob.digest.type === DigestTypeEnum.BACKOFF) ||
      (currentJob?.digest as IDigestRegularMetadata)?.backoff
    ) {
      return this.getDigestEventsBackoff.execute(digestEventsCommand);
    }

    return this.getDigestEventsRegular.execute(digestEventsCommand);
  }

  private async getCurrentJob(command: SendMessageCommand) {
    const currentJob = await this.jobRepository.findOne({ _environmentId: command.environmentId, _id: command.jobId });

    if (!currentJob) {
      const message = `Digest job ${command.jobId} is not found`;
      Logger.log(message, LOG_CONTEXT);
      throw new PlatformException(message);
    }

    return currentJob;
  }

  private async getJobsToUpdate(command: SendMessageCommand) {
    const nextJobs = await this.jobRepository.find({
      _environmentId: command.environmentId,
      transactionId: command.transactionId,
      _subscriberId: command._subscriberId,
      _id: {
        $ne: command.jobId,
      },
    });

    return nextJobs.filter((job) => {
      if (job.type === StepTypeEnum.IN_APP && job.status === JobStatusEnum.COMPLETED) {
        return true;
      }

      return job.status !== JobStatusEnum.COMPLETED && job.status !== JobStatusEnum.FAILED;
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - jobsToUpdate([...nextJobs.map((job))
 - jobs(await this.jobRepository.find(
      {
        _mergedDigestId: currentJob._id,
        status: JobS...)
 - nextJobs(await this.jobRepository.find({
      _environmentId: command.environmentId,
      transactionId: co...)
Declaraciones 'export' encontradas:
- export class Digest

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/get-digest-events-backoff.usecase.ts
Tamaño: 1136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { getJobDigest, InstrumentUsecase } from '@novu/application-generic';
import { JobStatusEnum } from '@novu/dal';
import { StepTypeEnum } from '@novu/shared';

import { DigestEventsCommand } from './digest-events.command';
import { GetDigestEvents } from './get-digest-events.usecase';

@Injectable()
export class GetDigestEventsBackoff extends GetDigestEvents {
  @InstrumentUsecase()
  public async execute(command: DigestEventsCommand) {
    const { currentJob } = command;

    const { digestKey, digestMeta, digestValue } = getJobDigest(currentJob);

    const jobs = await this.jobRepository.find(
      {
        createdAt: {
          $gte: currentJob.createdAt,
        },
        _templateId: currentJob._templateId,
        status: JobStatusEnum.COMPLETED,
        type: StepTypeEnum.TRIGGER,
        _environmentId: currentJob._environmentId,
        ...(digestKey && { [`payload.${digestKey}`]: digestValue }),
        _subscriberId: command._subscriberId,
      },
      'payload _id'
    );

    return this.filterJobs(currentJob, currentJob.transactionId, jobs);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetDigestEventsBackoff

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/get-digest-events-regular.usecase.ts
Tamaño: 1513 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { getJobDigest, InstrumentUsecase } from '@novu/application-generic';
import { IDigestBaseMetadata } from '@novu/shared';
import { sub } from 'date-fns';

import { DigestEventsCommand } from './digest-events.command';
import { GetDigestEvents } from './get-digest-events.usecase';

@Injectable()
export class GetDigestEventsRegular extends GetDigestEvents {
  @InstrumentUsecase()
  public async execute(command: DigestEventsCommand) {
    const { currentJob } = command;

    const { digestKey, digestMeta, digestValue } = getJobDigest(currentJob);
    const amount = this.castAmount(digestMeta);
    const unit = digestMeta?.unit;

    const subtractedTime =
      digestMeta && unit
        ? {
            [unit]: amount,
          }
        : {};
    const earliest = sub(new Date(currentJob.createdAt), subtractedTime);

    const jobs = await this.jobRepository.findJobsToDigest(
      earliest,
      currentJob._templateId,
      currentJob._environmentId,
      command._subscriberId,
      digestKey,
      digestValue
    );

    return this.filterJobs(currentJob, currentJob.transactionId, jobs);
  }

  private castAmount(digestMeta: IDigestBaseMetadata | undefined): number | undefined {
    let amount: number | undefined;

    if (typeof digestMeta?.amount === 'number') {
      amount = digestMeta.amount;
    }

    if (typeof digestMeta?.amount === 'string') {
      amount = parseInt(digestMeta.amount, 10);
    }

    return amount;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetDigestEventsRegular

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/get-digest-events.usecase.ts
Tamaño: 2177 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import {
  CreateExecutionDetails,
  CreateExecutionDetailsCommand,
  DetailEnum,
  getNestedValue,
  Instrument,
} from '@novu/application-generic';
import { JobEntity, JobRepository } from '@novu/dal';
import {
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  IDigestBaseMetadata,
  StepTypeEnum,
} from '@novu/shared';

import { PlatformException } from '../../../../shared/utils';

const LOG_CONTEXT = 'GetDigestEvents';

@Injectable()
export abstract class GetDigestEvents {
  constructor(
    protected jobRepository: JobRepository,
    private createExecutionDetails: CreateExecutionDetails
  ) {}

  @Instrument()
  protected async filterJobs(currentJob: JobEntity, transactionId: string, jobs: JobEntity[]) {
    const digestMeta = currentJob?.digest as IDigestBaseMetadata | undefined;
    const batchValue = currentJob?.payload ? getNestedValue(currentJob.payload, digestMeta?.digestKey) : undefined;
    const filteredJobs = jobs.filter((job) => {
      return getNestedValue(job.payload, digestMeta?.digestKey) === batchValue;
    });

    const currentTrigger = (await this.jobRepository.findOne(
      {
        _environmentId: currentJob._environmentId,
        _subscriberId: currentJob._subscriberId,
        transactionId,
        type: StepTypeEnum.TRIGGER,
      },
      '_id'
    )) as Pick<JobEntity, '_id'>;

    if (!currentTrigger) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(currentJob),
          detail: DetailEnum.DIGEST_TRIGGERED_EVENTS,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
        })
      );

      const message = `Trigger job for jobId ${currentJob._id} is not found`;
      Logger.log(message, LOG_CONTEXT);
      throw new PlatformException(message);
    }

    const events = [
      currentJob.payload,
      ...filteredJobs.filter((job) => job._id !== currentTrigger._id).map((job) => job.payload),
    ];

    return events;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - filteredJobs(jobs.filter((job))
 - events([
      currentJob.payload,
      ...filteredJobs.filter((job))
Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/digest/index.ts
Tamaño: 185 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './digest.usecase';
export * from './get-digest-events.usecase';
export * from './get-digest-events-backoff.usecase';
export * from './get-digest-events-regular.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/throttle/index.ts
Tamaño: 36 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './throttle.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/send-message/throttle/throttle.usecase.ts
Tamaño: 795 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { CreateExecutionDetails, InstrumentUsecase } from '@novu/application-generic';
import { MessageRepository } from '@novu/dal';
import { SendMessageCommand } from '../send-message.command';
import { SendMessageResult, SendMessageStatus, SendMessageType } from '../send-message-type.usecase';

@Injectable()
export class Throttle extends SendMessageType {
  constructor(
    protected messageRepository: MessageRepository,
    protected createExecutionDetails: CreateExecutionDetails
  ) {
    super(messageRepository, createExecutionDetails);
  }

  @InstrumentUsecase()
  public async execute(command: SendMessageCommand): Promise<SendMessageResult> {
    return {
      status: SendMessageStatus.SUCCESS,
      job: command.job,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class Throttle

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/store-subscriber-jobs/index.ts
Tamaño: 98 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './store-subscriber-jobs.command';
export * from './store-subscriber-jobs.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/store-subscriber-jobs/store-subscriber-jobs.command.ts
Tamaño: 339 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentCommand } from '@novu/application-generic';
// TODO: Implement a DTO or shared entity
import { JobEntity } from '@novu/dal';
import { IsDefined } from 'class-validator';

export class StoreSubscriberJobsCommand extends EnvironmentCommand {
  @IsDefined()
  jobs: Omit<JobEntity, '_id' | 'createdAt' | 'updatedAt'>[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StoreSubscriberJobsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/store-subscriber-jobs/store-subscriber-jobs.usecase.ts
Tamaño: 1650 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  BulkCreateExecutionDetails,
  BulkCreateExecutionDetailsCommand,
  CreateExecutionDetailsCommand,
  DetailEnum,
  Instrument,
  InstrumentUsecase,
  StepRunRepository,
} from '@novu/application-generic';
import { DalException, JobEntity, JobRepository, JobStatusEnum } from '@novu/dal';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';
import { PlatformException } from '../../../shared/utils';
import { AddJob } from '../add-job';
import { StoreSubscriberJobsCommand } from './store-subscriber-jobs.command';

@Injectable()
export class StoreSubscriberJobs {
  constructor(
    private addJob: AddJob,
    private jobRepository: JobRepository,
    protected bulkCreateExecutionDetails: BulkCreateExecutionDetails,
    private stepRunRepository: StepRunRepository
  ) {}

  @InstrumentUsecase()
  async execute(command: StoreSubscriberJobsCommand) {
    let storedJobs;
    try {
      storedJobs = await this.jobRepository.storeJobs(command.jobs);
    } catch (e) {
      if (e instanceof DalException) {
        throw new PlatformException(e.message);
      }
      throw e;
    }

    await this.stepRunRepository.createMany(storedJobs, { status: JobStatusEnum.QUEUED });
    const firstJob = storedJobs[0];

    const addJobCommand = {
      userId: firstJob._userId,
      environmentId: firstJob._environmentId,
      organizationId: firstJob._organizationId,
      jobId: firstJob._id,
      job: firstJob,
      bridge: firstJob.bridge,
      controlVariables: firstJob.controlVariables,
    };

    await this.addJob.execute(addJobCommand);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StoreSubscriberJobs

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/subscriber-job-bound/subscriber-job-bound.command.ts
Tamaño: 1590 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { SubscriberEntity, TopicEntity } from '@novu/dal';
import { DiscoverWorkflowOutput } from '@novu/framework/internal';
import {
  ISubscribersDefine,
  ITenantDefine,
  StatelessControls,
  SubscriberSourceEnum,
  TriggerOverrides,
  TriggerRequestCategoryEnum,
} from '@novu/shared';
import { IsArray, IsDefined, IsEnum, IsMongoId, IsOptional, IsString, ValidateNested } from 'class-validator';

export class SubscriberJobBoundCommand extends EnvironmentWithUserCommand {
  @IsString()
  @IsDefined()
  transactionId: string;

  // TODO: remove optional flag after all the workers are migrated to use requestId NV-6475
  @IsString()
  @IsOptional()
  requestId?: string;

  @IsDefined()
  payload: any;

  @IsDefined()
  @IsString()
  identifier: string;

  @IsDefined()
  overrides: TriggerOverrides;

  @IsOptional()
  @ValidateNested()
  tenant?: ITenantDefine;

  @IsOptional()
  actor?: SubscriberEntity;

  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  contextKeys?: string[];

  @IsDefined()
  @IsMongoId()
  templateId: string;

  @IsDefined()
  subscriber: ISubscribersDefine;

  @IsOptional()
  topics?: Pick<TopicEntity, '_id' | 'key'>[];

  @IsDefined()
  @IsEnum(SubscriberSourceEnum)
  _subscriberSource: SubscriberSourceEnum;

  @IsOptional()
  @IsEnum(TriggerRequestCategoryEnum)
  requestCategory?: TriggerRequestCategoryEnum;

  bridge?: { url: string; workflow: DiscoverWorkflowOutput };

  controls?: StatelessControls;

  @IsDefined()
  @IsString()
  environmentName: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SubscriberJobBoundCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/subscriber-job-bound/subscriber-job-bound.usecase.ts
Tamaño: 11244 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, Logger } from '@nestjs/common';
import type { EventType, Trace } from '@novu/application-generic';
import {
  AnalyticsService,
  CreateNotificationJobs,
  CreateNotificationJobsCommand,
  CreateOrUpdateSubscriberCommand,
  CreateOrUpdateSubscriberUseCase,
  GetPreferences,
  GetPreferencesCommand,
  Instrument,
  InstrumentUsecase,
  LogRepository,
  mapEventTypeToTitle,
  PinoLogger,
  TraceLogRepository,
} from '@novu/application-generic';
import { IntegrationRepository, NotificationTemplateEntity, NotificationTemplateRepository } from '@novu/dal';
import {
  buildWorkflowPreferences,
  ChannelTypeEnum,
  InAppProviderIdEnum,
  ISubscribersDefine,
  ProvidersIdEnum,
  ResourceTypeEnum,
  SeverityLevelEnum,
  STEP_TYPE_TO_CHANNEL_TYPE,
} from '@novu/shared';
import { StoreSubscriberJobs, StoreSubscriberJobsCommand } from '../store-subscriber-jobs';
import { SubscriberJobBoundCommand } from './subscriber-job-bound.command';

const LOG_CONTEXT = 'SubscriberJobBoundUseCase';

@Injectable()
export class SubscriberJobBound {
  constructor(
    private storeSubscriberJobs: StoreSubscriberJobs,
    private createNotificationJobs: CreateNotificationJobs,
    private createOrUpdateSubscriberUsecase: CreateOrUpdateSubscriberUseCase,
    private integrationRepository: IntegrationRepository,
    private notificationTemplateRepository: NotificationTemplateRepository,
    private logger: PinoLogger,
    private analyticsService: AnalyticsService,
    private traceLogRepository: TraceLogRepository,
    private getPreferences: GetPreferences
  ) {}

  @InstrumentUsecase()
  async execute(command: SubscriberJobBoundCommand) {
    this.logger.assign({
      transactionId: command.transactionId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      contextKeys: command.contextKeys,
    });

    const {
      subscriber,
      templateId,
      environmentId,
      organizationId,
      userId,
      actor,
      tenant,
      identifier,
      _subscriberSource,
      requestCategory,
      environmentName,
      topics,
      contextKeys,
    } = command;

    const template = command.bridge?.workflow
      ? await this.getCodeFirstWorkflow(command)
      : await this.getWorkflow({
          _id: templateId,
          environmentId,
        });

    if (!template) {
      throw new BadRequestException(`Workflow id ${templateId} was not found`);
    }

    const templateProviderIds = await this.getProviderIdsForTemplate(environmentId, template);

    await this.validateSubscriberIdProperty(command, subscriber);

    /**
     * Due to Mixpanel HotSharding, we don't want to pass userId for production volume
     */
    const segmentUserId = ['test-workflow', 'digest-playground', 'dashboard', 'inbox-onboarding'].includes(
      command.payload.__source
    )
      ? userId
      : '';

    this.analyticsService.mixpanelTrack('Notification event trigger - [Triggers]', segmentUserId, {
      name: template.name,
      type: template?.type || ResourceTypeEnum.REGULAR,
      origin: template?.origin,
      transactionId: command.transactionId,
      _template: template._id,
      _organization: command.organizationId,
      channels: template?.steps.map((step) => step.template?.type),
      source: command.payload.__source || 'api',
      subscriberSource: _subscriberSource || null,
      requestCategory: requestCategory || null,
      environmentName,
      statelessWorkflow: !!command.bridge?.url,
    });
    const subscriberProcessed = await this.createOrUpdateSubscriberUsecase.execute(
      CreateOrUpdateSubscriberCommand.create({
        environmentId,
        organizationId,
        subscriberId: subscriber?.subscriberId,
        email: subscriber?.email,
        firstName: subscriber?.firstName,
        lastName: subscriber?.lastName,
        phone: subscriber?.phone,
        avatar: subscriber?.avatar,
        locale: subscriber?.locale,
        data: subscriber?.data,
        channels: subscriber?.channels,
        activeWorkerName: process.env.ACTIVE_WORKER,
      })
    );

    // If no subscriber makes no sense to try to create notification
    if (!subscriberProcessed) {
      Logger.warn(
        `Subscriber ${JSON.stringify(subscriber.subscriberId)} of organization ${
          command.organizationId
        } in transaction ${command.transactionId} was not processed. No jobs are created.`,
        LOG_CONTEXT
      );

      await this.createSubscriberTrace(
        command,
        'subscriber_validation_failed',
        'warning',
        `Subscriber ${subscriber.subscriberId} was not processed, workflow run execution halted.`
      );

      return;
    }

    const severity = command.overrides.severity ?? template.severity ?? SeverityLevelEnum.NONE;

    let critical = false;
    if (command.bridge?.workflow) {
      critical = command.bridge.workflow.preferences?.all?.readOnly ?? false;
    } else {
      const preferences = await this.getPreferences.safeExecute(
        GetPreferencesCommand.create({
          environmentId,
          organizationId,
          subscriberId: subscriberProcessed._id,
          templateId,
        })
      );
      critical = preferences.preferences.all.readOnly;
    }

    const createNotificationJobsCommand: CreateNotificationJobsCommand = {
      environmentId,
      identifier,
      organizationId,
      overrides: command.overrides,
      payload: command.payload,
      subscriber: subscriberProcessed,
      template,
      templateProviderIds,
      to: subscriber,
      transactionId: command.transactionId,
      userId,
      tenant,
      topics,
      bridgeUrl: command.bridge?.url,
      /*
       * Only populate preferences if the command contains a `bridge` property,
       * indicating that the execution is stateless.
       *
       * TODO: refactor the Worker execution to handle both stateless and stateful workflows
       * transparently.
       */
      ...(command.bridge?.workflow && {
        preferences: buildWorkflowPreferences(command.bridge?.workflow?.preferences),
      }),
      severity,
      critical,
      ...(contextKeys && { contextKeys }),
    };

    if (actor) {
      createNotificationJobsCommand.actor = actor;
    }

    const notificationJobs = await this.createNotificationJobs.execute(
      CreateNotificationJobsCommand.create(createNotificationJobsCommand)
    );

    await this.storeSubscriberJobs.execute(
      StoreSubscriberJobsCommand.create({
        environmentId: command.environmentId,
        jobs: notificationJobs,
        organizationId: command.organizationId,
      })
    );
  }

  private async getCodeFirstWorkflow(command: SubscriberJobBoundCommand): Promise<NotificationTemplateEntity | null> {
    const bridgeWorkflow = command.bridge?.workflow;

    if (!bridgeWorkflow) {
      return null;
    }

    const syncedWorkflowId = (
      await this.notificationTemplateRepository.findByTriggerIdentifier(
        command.environmentId,
        bridgeWorkflow.workflowId
      )
    )?._id;

    /*
     * Cast used to convert data type for further processing.
     * todo Needs review for potential data corruption.
     */
    return {
      ...bridgeWorkflow,
      type: ResourceTypeEnum.BRIDGE,
      _id: syncedWorkflowId,
      steps: bridgeWorkflow.steps.map((step) => {
        const stepControlVariables = command.controls?.steps?.[step.stepId];

        return {
          ...step,
          bridgeUrl: command.bridge?.url,
          controlVariables: stepControlVariables,
          active: true,
          template: {
            type: step.type,
          },
        };
      }),
    } as unknown as NotificationTemplateEntity;
  }

  @Instrument()
  private async getProviderId(environmentId: string, channelType: ChannelTypeEnum): Promise<ProvidersIdEnum> {
    const integration = await this.integrationRepository.findOne(
      {
        _environmentId: environmentId,
        active: true,
        channel: channelType,
      },
      'providerId'
    );

    return integration?.providerId as ProvidersIdEnum;
  }

  @Instrument()
  private async validateSubscriberIdProperty(
    command: SubscriberJobBoundCommand,
    subscriber: ISubscribersDefine
  ): Promise<boolean> {
    const subscriberIdExists = typeof subscriber === 'string' ? subscriber : subscriber.subscriberId;

    if (!subscriberIdExists) {
      await this.createSubscriberTrace(
        command,
        'subscriber_validation_failed',
        'warning',
        `Subscriber ${subscriber.subscriberId} is missing a valid subscriberId, workflow run execution halted.`
      );
      throw new BadRequestException(
        'subscriberId under property to is not configured, please make sure all subscribers contains subscriberId property'
      );
    }

    return true;
  }

  private async getWorkflow({ _id, environmentId }: { _id: string; environmentId: string }) {
    return await this.notificationTemplateRepository.findById(_id, environmentId);
  }

  @InstrumentUsecase()
  private async getProviderIdsForTemplate(
    environmentId: string,
    template: NotificationTemplateEntity
  ): Promise<Record<ChannelTypeEnum, ProvidersIdEnum>> {
    const providers = {} as Record<ChannelTypeEnum, ProvidersIdEnum>;

    for (const step of template?.steps) {
      const type = step.template?.type;
      if (!type) continue;

      const channelType = STEP_TYPE_TO_CHANNEL_TYPE.get(type);

      if (!channelType) continue;

      if (providers[channelType] || !channelType) continue;

      if (channelType === ChannelTypeEnum.IN_APP) {
        providers[channelType] = InAppProviderIdEnum.Novu;
      } else {
        const provider = await this.getProviderId(environmentId, channelType);
        if (provider) {
          providers[channelType] = provider;
        }
      }
    }

    return providers;
  }

  private async createSubscriberTrace(
    command: SubscriberJobBoundCommand,
    eventType: EventType,
    status: 'success' | 'error' | 'warning' = 'success',
    message?: string,
    rawData?: any
  ): Promise<void> {
    if (!command.requestId) {
      return;
    }

    try {
      const traceData: Omit<Trace, 'id' | 'expires_at'> = {
        created_at: LogRepository.formatDateTime64(new Date()),
        organization_id: command.organizationId,
        environment_id: command.environmentId,
        user_id: command.userId,
        subscriber_id: null,
        external_subscriber_id: command.subscriber?.subscriberId || null,
        event_type: eventType,
        title: mapEventTypeToTitle(eventType),
        message: message || null,
        raw_data: rawData ? JSON.stringify(rawData) : null,
        status,
        entity_type: 'request',
        entity_id: command.requestId,
        workflow_run_identifier: command.identifier,
      };

      await this.traceLogRepository.createRequest([traceData]);
    } catch (error) {
      this.logger.error(
        {
          error,
          eventType,
          transactionId: command.transactionId,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
        },
        'Failed to create subscriber trace'
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - segmentUserId(['test-workflow', 'digest-playground', 'dashboard', 'inbox-onboarding'].includes(
      command.payl...)
 - syncedWorkflowId(await this.notificationTemplateRepository.findByTriggerIdentifier(
        command.environmentId,
  ...)
Declaraciones 'export' encontradas:
- export class SubscriberJobBound

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/index.ts
Tamaño: 342 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { SetJobAsCommand, SetJobAsFailedCommand } from './set-job-as.command';
export { SetJobAsCompleted } from './set-job-as-completed.usecase';
export { SetJobAsFailed } from './set-job-as-failed.usecase';
export { UpdateJobStatusCommand } from './update-job-status.command';
export { UpdateJobStatus } from './update-job-status.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/set-job-as-completed.usecase.ts
Tamaño: 669 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { JobStatusEnum } from '@novu/dal';

import { SetJobAsCommand } from './set-job-as.command';
import { UpdateJobStatusCommand } from './update-job-status.command';
import { UpdateJobStatus } from './update-job-status.usecase';

@Injectable()
export class SetJobAsCompleted {
  constructor(private updateJobStatus: UpdateJobStatus) {}

  public async execute(command: SetJobAsCommand): Promise<void> {
    await this.updateJobStatus.execute(
      UpdateJobStatusCommand.create({
        environmentId: command.environmentId,
        jobId: command.jobId,
        status: JobStatusEnum.COMPLETED,
      })
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SetJobAsCompleted

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/set-job-as-failed.usecase.ts
Tamaño: 1507 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { InstrumentUsecase, WorkflowRunService, WorkflowRunStatusEnum } from '@novu/application-generic';
import { JobEntity, JobRepository, JobStatusEnum } from '@novu/dal';

import { SetJobAsFailedCommand } from './set-job-as.command';
import { UpdateJobStatusCommand } from './update-job-status.command';
import { UpdateJobStatus } from './update-job-status.usecase';

@Injectable()
export class SetJobAsFailed {
  constructor(
    private updateJobStatus: UpdateJobStatus,
    private jobRepository: JobRepository,
    private workflowRunService: WorkflowRunService
  ) {}

  @InstrumentUsecase()
  public async execute(command: SetJobAsFailedCommand, error: Error): Promise<JobEntity | null> {
    const jobEntity = await this.updateJobStatus.execute(
      UpdateJobStatusCommand.create({
        environmentId: command.environmentId,
        jobId: command.jobId,
        status: JobStatusEnum.FAILED,
      })
    );

    if (!jobEntity) {
      return null;
    }

    await this.jobRepository.setError(command.organizationId, command.jobId, error);

    await this.workflowRunService.updateDeliveryLifecycle({
      notificationId: jobEntity._notificationId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      _subscriberId: jobEntity._subscriberId,
      workflowStatus: command.isLastJobInWorkflow ? WorkflowRunStatusEnum.COMPLETED : WorkflowRunStatusEnum.PROCESSING,
    });

    return jobEntity;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SetJobAsFailed

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/set-job-as.command.ts
Tamaño: 395 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentLevelWithUserCommand } from '@novu/application-generic';
import { IsDefined, IsOptional } from 'class-validator';

export class SetJobAsCommand extends EnvironmentLevelWithUserCommand {
  @IsDefined()
  jobId: string;
}

export class SetJobAsFailedCommand extends SetJobAsCommand {
  @IsDefined()
  organizationId: string;

  @IsOptional()
  isLastJobInWorkflow?: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SetJobAsCommand
- export class SetJobAsFailedCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/update-job-status.command.ts
Tamaño: 347 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentLevelCommand } from '@novu/application-generic';
import { JobStatusEnum } from '@novu/dal';
import { IsDefined, IsOptional } from 'class-validator';

export class UpdateJobStatusCommand extends EnvironmentLevelCommand {
  @IsDefined()
  jobId: string;

  @IsDefined()
  status: JobStatusEnum;

  @IsOptional()
  error?: any;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateJobStatusCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/update-job-status/update-job-status.usecase.ts
Tamaño: 547 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { InstrumentUsecase } from '@novu/application-generic';
import { JobEntity, JobRepository } from '@novu/dal';

import { UpdateJobStatusCommand } from './update-job-status.command';

@Injectable()
export class UpdateJobStatus {
  constructor(private jobRepository: JobRepository) {}

  @InstrumentUsecase()
  public async execute(command: UpdateJobStatusCommand): Promise<JobEntity | null> {
    return this.jobRepository.updateStatus(command.environmentId, command.jobId, command.status);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateJobStatus

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/webhook-filter-backoff-strategy/event-job.dto.ts
Tamaño: 88 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobEntity } from '@novu/dal';

export class EventJobDto {
  data: JobEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class EventJobDto

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/webhook-filter-backoff-strategy/index.ts
Tamaño: 118 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './webhook-filter-backoff-strategy.command';
export * from './webhook-filter-backoff-strategy.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/webhook-filter-backoff-strategy/webhook-filter-backoff-strategy.command.ts
Tamaño: 408 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithUserCommand } from '@novu/application-generic';
import { IsDefined, IsNumber, IsOptional } from 'class-validator';

import { EventJobDto } from './event-job.dto';

export class WebhookFilterBackoffStrategyCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsNumber()
  attemptsMade: number;

  @IsOptional()
  eventError: Error;

  @IsDefined()
  eventJob: EventJobDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebhookFilterBackoffStrategyCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/usecases/webhook-filter-backoff-strategy/webhook-filter-backoff-strategy.usecase.ts
Tamaño: 1449 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { CreateExecutionDetails, CreateExecutionDetailsCommand, DetailEnum } from '@novu/application-generic';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';

import { WebhookFilterBackoffStrategyCommand } from './webhook-filter-backoff-strategy.command';

@Injectable()
export class WebhookFilterBackoffStrategy {
  constructor(private createExecutionDetails: CreateExecutionDetails) {}

  public async execute(command: WebhookFilterBackoffStrategyCommand): Promise<number> {
    const { attemptsMade, eventError: error, eventJob } = command;
    const job = eventJob.data;

    try {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.WEBHOOK_FILTER_FAILED_RETRY,
          source: ExecutionDetailsSourceEnum.WEBHOOK,
          status: ExecutionDetailsStatusEnum.PENDING,
          isTest: false,
          isRetry: true,
          raw: JSON.stringify({ message: JSON.parse(error?.message).message, attempt: attemptsMade }),
        })
      );
    } catch (anotherError) {
      Logger.error(
        anotherError,
        'Failed to create the execution details for backoff strategy',
        'WebhookFilterBackoffStrategy'
      );
    }

    return Math.round(Math.random() * 2 ** attemptsMade * 1000);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebhookFilterBackoffStrategy

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/app/workflow/workers/inbound-parse.worker.service.ts
Tamaño: 1369 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import {
  BullMqService,
  getInboundParseMailWorkerOptions,
  IInboundParseDataDto,
  IInboundParseJobDto,
  WorkerBaseService,
  WorkerOptions,
  WorkflowInMemoryProviderService,
} from '@novu/application-generic';
import { JobTopicNameEnum } from '@novu/shared';
import { InboundEmailParseCommand } from '../usecases/inbound-email-parse/inbound-email-parse.command';
import { InboundEmailParse } from '../usecases/inbound-email-parse/inbound-email-parse.usecase';

const LOG_CONTEXT = 'InboundParseQueueService';

@Injectable()
export class InboundParseWorker extends WorkerBaseService {
  constructor(
    private inboundEmailParseUsecase: InboundEmailParse,
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService
  ) {
    super(JobTopicNameEnum.INBOUND_PARSE_MAIL, new BullMqService(workflowInMemoryProviderService));

    this.createWorker(this.getWorkerProcessor(), this.getWorkerOptions());
  }

  private getWorkerOptions(): WorkerOptions {
    return getInboundParseMailWorkerOptions();
  }

  public getWorkerProcessor() {
    return async ({ data }: { data: IInboundParseDataDto }) => {
      Logger.verbose({ data }, 'Processing the inbound parsed email', LOG_CONTEXT);
      await this.inboundEmailParseUsecase.execute(InboundEmailParseCommand.create({ ...data }));
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('InboundParseQueueService';

@Injectable()
export class InboundParseWorker extends WorkerBaseService...)
Declaraciones 'export' encontradas:
- export class InboundParseWorker

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/config/env.config.ts
Tamaño: 321 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import path from 'node:path';
import { getContextPath, getEnvFileNameForNodeEnv, NovuComponentEnum } from '@novu/shared';
import dotenv from 'dotenv';

dotenv.config({ path: path.join(__dirname, '..', getEnvFileNameForNodeEnv(process.env.NODE_ENV)) });

export const CONTEXT_PATH = getContextPath(NovuComponentEnum.API);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/config/env.validators.ts
Tamaño: 3872 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DEFAULT_NOTIFICATION_RETENTION_DAYS, FeatureFlagsKeysEnum, StringifyEnv } from '@novu/shared';
import { bool, CleanedEnv, cleanEnv, json, makeValidator, num, port, str, url, ValidatorSpec } from 'envalid';

export function validateEnv() {
  return cleanEnv(process.env, envValidators);
}

export type ValidatedEnv = StringifyEnv<CleanedEnv<typeof envValidators>>;
const processEnv = process.env as Record<string, string>; // Hold the initial process.env to avoid circular reference

const str32 = makeValidator((variable) => {
  if (!(typeof variable === 'string') || variable.length !== 32) {
    throw new Error('Expected to be string 32 char long');
  }

  return variable;
});

/**
 * Declare your ENV variables here.
 *
 * Add a new validator to this list when you have a new ENV variable.
 */

export const envValidators = {
  TZ: str({ default: 'UTC' }),
  NODE_ENV: str({ choices: ['dev', 'test', 'production', 'ci', 'local', 'staging'], default: 'local' }),
  PORT: port(),
  STORE_ENCRYPTION_KEY: str32(),
  STORE_NOTIFICATION_CONTENT: bool({ default: false }),
  MAX_NOVU_INTEGRATION_MAIL_REQUESTS: num({ default: 300 }),
  NOVU_EMAIL_INTEGRATION_API_KEY: str({ default: '' }),
  STORAGE_SERVICE: str({ default: undefined }),
  REDIS_HOST: str(),
  REDIS_PORT: port(),
  REDIS_PASSWORD: str({ default: undefined }),
  REDIS_TLS: json({ default: undefined }),
  REDIS_DB_INDEX: num(),
  REDIS_CACHE_SERVICE_HOST: str({ default: undefined }),
  REDIS_CACHE_SERVICE_PORT: str({ default: undefined }),
  REDIS_CACHE_TTL: str({ default: undefined }),
  REDIS_CACHE_PASSWORD: str({ default: undefined }),
  REDIS_CACHE_CONNECTION_TIMEOUT: str({ default: undefined }),
  REDIS_CACHE_KEEP_ALIVE: str({ default: undefined }),
  REDIS_CACHE_FAMILY: str({ default: undefined }),
  REDIS_CACHE_KEY_PREFIX: str({ default: undefined }),
  REDIS_MASTER_HOST: str({ default: '' }),
  REDIS_MASTER_PORT: str({ default: '' }),
  REDIS_SLAVE_HOST: str({ default: '' }),
  REDIS_SLAVE_PORT: str({ default: '' }),
  MONGO_AUTO_CREATE_INDEXES: bool({ default: false }),
  MONGO_MAX_IDLE_TIME_IN_MS: num({ default: 1000 * 30 }),
  MONGO_MAX_POOL_SIZE: num({ default: 50 }),
  MONGO_MIN_POOL_SIZE: num({ default: 10 }),
  MONGO_URL: str(),
  SEGMENT_TOKEN: str({ default: undefined }),
  LAUNCH_DARKLY_SDK_KEY: str({ default: undefined }),
  STRIPE_API_KEY: str({ default: undefined }),
  NOTIFICATION_RETENTION_DAYS: num({ default: DEFAULT_NOTIFICATION_RETENTION_DAYS }),
  API_ROOT_URL: url(),
  SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME: str({ default: '15 days' }),
  SOCKET_WORKER_URL: str({ default: undefined }),
  INTERNAL_SERVICES_API_KEY: str({ default: undefined }),
  // Feature Flags
  ...Object.keys(FeatureFlagsKeysEnum).reduce(
    (acc, key) => {
      return {
        ...acc,
        [key as FeatureFlagsKeysEnum]: bool({ default: false }),
      };
    },
    {} as Record<FeatureFlagsKeysEnum, ValidatorSpec<boolean>>
  ),

  // Azure validators
  ...(processEnv.STORAGE_SERVICE === 'AZURE' && {
    AZURE_ACCOUNT_NAME: str(),
    AZURE_ACCOUNT_KEY: str(),
    AZURE_HOST_NAME: str({ default: `https://${processEnv.AZURE_ACCOUNT_NAME}.blob.core.windows.net` }),
    AZURE_CONTAINER_NAME: str({ default: 'novu' }),
  }),

  // GCS validators
  ...(processEnv.STORAGE_SERVICE === 'GCS' && {
    GCS_BUCKET_NAME: str(),
    GCS_DOMAIN: str(),
  }),

  // AWS validators
  ...(processEnv.STORAGE_SERVICE === 'AWS' && {
    S3_LOCAL_STACK: str({ default: '' }),
    S3_BUCKET_NAME: str(),
    S3_REGION: str(),
  }),

  // Production validators
  ...(['local', 'test'].includes(processEnv.NODE_ENV) && {
    NEW_RELIC_APP_NAME: str({ default: '' }),
    NEW_RELIC_LICENSE_KEY: str({ default: '' }),
    REDIS_CACHE_SERVICE_HOST: str(),
    REDIS_CACHE_SERVICE_PORT: str(),
    REDIS_CACHE_PASSWORD: str(),
  }),
} satisfies Record<string, ValidatorSpec<unknown>>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - validateEnv()
Asignaciones con arrow functions encontradas (posibles funciones):
 - str32(makeValidator((variable))
 - envValidators({
  TZ: str({ default: 'UTC' }),
  NODE_ENV: str({ choices: ['dev', 'test', 'production', 'ci', 'loc...)
Declaraciones 'export' encontradas:
- export function validateEnv
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/config/index.ts
Tamaño: 64 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './env.config';
export * from './env.validators';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/config/worker-init.config.ts
Tamaño: 2639 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Provider } from '@nestjs/common';

import { JobTopicNameEnum } from '@novu/shared';

import { StandardWorker, WorkflowWorker } from '../app/workflow/services';
import { SubscriberProcessWorker } from '../app/workflow/services/subscriber-process.worker';
import { InboundParseWorker } from '../app/workflow/workers/inbound-parse.worker.service';

type WorkerClass =
  | typeof StandardWorker
  | typeof WorkflowWorker
  | typeof SubscriberProcessWorker
  | typeof InboundParseWorker;

type WorkerModuleTree = { workerClass: WorkerClass; queueDependencies: JobTopicNameEnum[] };

type WorkerDepTree = Partial<Record<JobTopicNameEnum, WorkerModuleTree>>;

export const WORKER_MAPPING: WorkerDepTree = {
  [JobTopicNameEnum.STANDARD]: {
    workerClass: StandardWorker,
    queueDependencies: [JobTopicNameEnum.WEB_SOCKETS, JobTopicNameEnum.STANDARD, JobTopicNameEnum.PROCESS_SUBSCRIBER],
  },
  [JobTopicNameEnum.WORKFLOW]: {
    workerClass: WorkflowWorker,
    queueDependencies: [JobTopicNameEnum.PROCESS_SUBSCRIBER, JobTopicNameEnum.STANDARD, JobTopicNameEnum.WEB_SOCKETS],
  },
  [JobTopicNameEnum.PROCESS_SUBSCRIBER]: {
    workerClass: SubscriberProcessWorker,
    queueDependencies: [JobTopicNameEnum.STANDARD, JobTopicNameEnum.WEB_SOCKETS, JobTopicNameEnum.PROCESS_SUBSCRIBER],
  },
  [JobTopicNameEnum.INBOUND_PARSE_MAIL]: {
    workerClass: InboundParseWorker,
    queueDependencies: [],
  },
};

const validQueueEntries = Object.keys(JobTopicNameEnum).map((key) => JobTopicNameEnum[key]);
const isQueueEntry = (queueName: string): queueName is JobTopicNameEnum => {
  return validQueueEntries.includes(queueName);
};

export const workersToProcess =
  process.env.ACTIVE_WORKERS?.split(',')
    .filter((i) => !!i)
    .map((queue) => {
      const queueName = queue.trim();
      if (!isQueueEntry(queueName)) {
        throw new Error(`Invalid queue name ${queueName}`);
      }

      return queueName;
    }) || [];

const WORKER_DEPENDENCIES: JobTopicNameEnum[] = workersToProcess.reduce((history, worker) => {
  const workerDependencies: JobTopicNameEnum[] = WORKER_MAPPING[worker]?.queueDependencies || [];

  return [...history, ...workerDependencies];
}, []);

export const UNIQUE_WORKER_DEPENDENCIES = [...new Set(WORKER_DEPENDENCIES)];

export const ACTIVE_WORKERS: Provider[] | any[] = [];

if (!workersToProcess.length) {
  ACTIVE_WORKERS.push(StandardWorker, WorkflowWorker, SubscriberProcessWorker, InboundParseWorker);
} else {
  workersToProcess.forEach((queue) => {
    const workerClass = WORKER_MAPPING[queue]?.workerClass;
    if (workerClass) {
      ACTIVE_WORKERS.push(workerClass);
    }
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - validQueueEntries(Object.keys(JobTopicNameEnum).map((key))
 - isQueueEntry(queueName: string): queueName is JobTopicNameEnum)
 - workersToProcess(process.env.ACTIVE_WORKERS?.split(',')
    .filter((i))
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/worker/src/types/env.d.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ValidatedEnv } from '../config';

declare global {
  namespace NodeJS {
    interface ProcessEnv extends ValidatedEnv {
      NODE_ENV: 'test' | 'production' | 'dev' | 'ci' | 'local';
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/.gitignore
Tamaño: 367 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# compiled output
/dist
/node_modules

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS
.DS_Store

# Tests
/coverage
/.nyc_output


# IDEs and editors
/.idea
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

# IDE - VSCode
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json


dist


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# compiled output
/dist
/node_modules
# Logs
# OS
# Tests
# IDEs and editors
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/Dockerfile
Tamaño: 1620 bytes
Lenguaje detectado: DOCKERFILE

### CONTENIDO ORIGINAL ###

FROM node:20-alpine3.19 AS dev_base
RUN apk add --no-cache g++ make py3-pip
ENV NX_DAEMON=false

# Install global dependencies
RUN npm --no-update-notifier --no-fund --global install pm2 pnpm@10.16.1&& \
    pnpm --version

# Set non-root user
USER 1000
WORKDIR /usr/src/app

FROM dev_base AS dev
ARG PACKAGE_PATH

COPY --chown=1000:1000 ./meta .
COPY --chown=1000:1000 ./deps .
COPY --chown=1000:1000 ./pkg .

RUN --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && \
    if [ -n "${BULL_MQ_PRO_NPM_TOKEN}" ] ; then echo 'Building with Enterprise Edition of Novu'; rm -f .npmrc ; cp .npmrc-cloud .npmrc ; fi

RUN --mount=type=cache,id=pnpm-store-ws,target=/root/.pnpm-store\
    --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && \
 pnpm install --filter "novuhq" --filter "{${PACKAGE_PATH}}..."\
 --frozen-lockfile\
 --unsafe-perm\
 --reporter=silent

RUN --mount=type=secret,id=BULL_MQ_PRO_NPM_TOKEN,uid=1000 export BULL_MQ_PRO_NPM_TOKEN=$(cat /run/secrets/BULL_MQ_PRO_NPM_TOKEN) && NODE_ENV=production NX_DAEMON=false pnpm build:ws

WORKDIR /usr/src/app/apps/ws

RUN cp src/dotenvcreate.mjs dist/dotenvcreate.mjs
RUN cp src/.example.env dist/.env
RUN cp src/.env.test dist/.env.test
RUN cp src/.env.development dist/.env.development
RUN cp src/.env.production dist/.env.production

ENTRYPOINT [ "sh", "-c", "node dist/dotenvcreate.mjs -s=$SECRET_NAME -r=$NOVU_REGION -e=$NOVU_ENTERPRISE -v=$NODE_ENV -h=$IS_SELF_HOSTED && pm2-runtime start dist/main.js -i max" ]


### ANALISIS AUTOMATICO (ESPAÑOL) ###

FROM node:20-alpine3.19 AS dev_base
RUN apk add --no-cache g++ make py3-pip
ENV NX_DAEMON=false
# Install global dependencies
# Set non-root user
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/nest-cli.json
Tamaño: 626 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "typeCheck": true,
    "deleteOutDir": true,
    "builder": {
      "type": "swc",
      "options": {
        "stripLeadingPaths": true
      }
    },
    "assets": [
      {
        "include": ".env",
        "outDir": "dist"
      },
      {
        "include": ".env.development",
        "outDir": "dist"
      },
      {
        "include": ".env.test",
        "outDir": "dist"
      },
      {
        "include": ".env.production",
        "outDir": "dist"
      }
    ]
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"$schema": "https://json.schemastore.org/nest-cli",
"collection": "@nestjs/schematics",
"sourceRoot": "src",
"compilerOptions": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/package.json
Tamaño: 3290 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ws",
  "version": "3.9.0",
  "description": "",
  "author": "",
  "private": true,
  "license": "UNLICENSED",
  "scripts": {
    "prebuild": "rimraf dist",
    "build": "nest build",
    "docker:build": "pnpm --silent --workspace-root pnpm-context -- apps/ws/Dockerfile | BULL_MQ_PRO_NPM_TOKEN=${BULL_MQ_PRO_NPM_TOKEN} docker buildx build --secret id=BULL_MQ_PRO_NPM_TOKEN --build-arg PACKAGE_PATH=apps/ws - -t novu-ws --load $DOCKER_BUILD_ARGUMENTS",
    "docker:build:depot": "pnpm --silent --workspace-root pnpm-context -- apps/ws/Dockerfile | depot build --build-arg PACKAGE_PATH=apps/ws - -t novu-ws --load",
    "start": "pnpm start:dev",
    "start:dev": "nest start --watch",
    "start:test": "cross-env NODE_ENV=test nest start",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main.js",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file e2e/setup.ts './src/**/*.spec.ts'"
  },
  "dependencies": {
    "@aws-sdk/client-secrets-manager": "^3.716.0",
    "@godaddy/terminus": "^4.3.1",
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/jwt": "10.2.0",
    "@nestjs/platform-express": "10.4.18",
    "@nestjs/platform-socket.io": "10.4.18",
    "@nestjs/serve-static": "4.0.2",
    "@nestjs/swagger": "7.4.0",
    "@nestjs/terminus": "10.2.3",
    "@nestjs/websockets": "10.4.18",
    "@novu/application-generic": "workspace:*",
    "@novu/dal": "workspace:*",
    "@novu/shared": "workspace:*",
    "@novu/testing": "workspace:*",
    "@sentry/browser": "^8.33.1",
    "@sentry/hub": "^7.114.0",
    "@sentry/nestjs": "^8.33.1",
    "@sentry/node": "^8.33.1",
    "@sentry/profiling-node": "^8.33.1",
    "@sentry/tracing": "^7.40.0",
    "@socket.io/admin-ui": "^0.5.1",
    "@socket.io/redis-adapter": "^7.2.0",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "dotenv": "^16.4.5",
    "envalid": "^8.0.0",
    "helmet": "^6.0.1",
    "ioredis": "5.3.2",
    "jsonwebtoken": "9.0.0",
    "lodash": "^4.17.15",
    "nest-raven": "10.1.0",
    "newrelic": "^12.8.1",
    "reflect-metadata": "0.2.2",
    "rimraf": "^3.0.2",
    "rxjs": "7.8.1",
    "sinon": "^9.2.4",
    "socket.io": "^4.7.2"
  },
  "devDependencies": {
    "@nestjs/cli": "10.4.5",
    "@nestjs/schematics": "10.1.4",
    "@nestjs/testing": "10.4.18",
    "@types/chai": "^4.2.11",
    "@types/express": "^4.17.8",
    "@types/jsonwebtoken": "^8.5.9",
    "@types/mocha": "^10.0.2",
    "@types/node": "^20.15.0",
    "@types/socket.io": "^3.0.2",
    "@types/supertest": "^2.0.10",
    "chai": "^4.2.0",
    "cross-env": "^7.0.3",
    "mocha": "^10.2.0",
    "supertest": "^7.0.0",
    "ts-loader": "~9.4.0",
    "ts-node": "~10.9.1",
    "tsconfig-paths": "~4.1.0",
    "typescript": "5.6.2"
  },
  "workspaces": {
    "nohoist": [
      "@nestjs/platform-socket.io",
      "@nestjs/platform-socket.io/**"
    ]
  },
  "nx": {
    "tags": [
      "type:app"
    ],
    "targets": {
      "lint": {
        "executor": "nx:run-commands",
        "options": {
          "command": "npx biome lint apps/ws"
        }
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ws",
"version": "3.9.0",
"description": "",
"author": "",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/tsconfig.build.json
Tamaño: 522 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "declaration": true,
    "esModuleInterop": false,
    "noImplicitAny": false,
    "removeComments": true,
    "allowSyntheticDefaultImports": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es6",
    "sourceMap": true,
    "outDir": "./dist",
    "baseUrl": "./src",
    "types": ["node"]
  },
  "include": ["src/**/*", "src/**/*.d.ts"],
  "exclude": ["node_modules", "**/*.spec.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"module": "commonjs",
"declaration": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/tsconfig.json
Tamaño: 428 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "module": "commonjs",
    "sourceMap": true,
    "allowSyntheticDefaultImports": true,
    "emitDecoratorMetadata": true,
    "types": ["node", "mocha", "chai", "sinon"],
    "target": "es6",
    "allowJs": false,
    "esModuleInterop": true,
    "declarationMap": true,
    "skipLibCheck": true
  },
  "exclude": ["node_modules"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/e2e/setup.ts
Tamaño: 474 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DalService } from '@novu/dal';
import { wsTestServer } from '@novu/testing';

import { bootstrap } from '../src/bootstrap';

const dalService = new DalService();

before(async () => {
  await dalService.connect(String(process.env.MONGO_URL));
  await wsTestServer.create(await bootstrap());
});

after(async () => {
  try {
    await wsTestServer.teardown();

    await dalService.destroy();
  } catch (e) {
    if (e.code !== 12586) {
      throw e;
    }
  }
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - dalService(new DalService();

before(async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/.env.development
Tamaño: 554 bytes
Lenguaje detectado: DEVELOPMENT

### CONTENIDO ORIGINAL ###

NODE_ENV=dev
PORT=3002
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
REDIS_PORT=6379
REDIS_HOST=localhost
REDIS_PREFIX=
REDIS_DB_INDEX=2
JWT_SECRET=TEST_CHANGE9s

GLOBAL_CONTEXT_PATH=
WS_CONTEXT_PATH=

NEW_RELIC_ENABLED=true
NEW_RELIC_APP_NAME="[DEV] - ws"
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
LOG_LEVEL=info

MONGO_AUTO_CREATE_INDEXES=true

SOCKET_IO_ADMIN_USERNAME=admin
# "changeit" encrypted with bcrypt
SOCKET_IO_ADMIN_PASSWORD_HASH=$2b$10$heqvAkYMez.Va6Et2uXInOnkCT6/uQj1brkrbyG3LpopDklcq7ZOS

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=dev
PORT=3002
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
REDIS_PORT=6379
REDIS_HOST=localhost
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/src/.env.production
Tamaño: 442 bytes
Lenguaje detectado: PRODUCTION

### CONTENIDO ORIGINAL ###

NODE_ENV=production
PORT=3002
REDIS_PORT=6379
REDIS_PREFIX=
REDIS_DB_INDEX=2
WIDGET_BASE_URL=https://widget.novu.co

GLOBAL_CONTEXT_PATH=
WS_CONTEXT_PATH=

NEW_RELIC_ENABLED=true
NEW_RELIC_APPLICATION_LOGGING_FORWARDING_ENABLED=true
LOG_LEVEL=info
MONGO_MIN_POOL_SIZE=50

## This value should be set to true if it is the first time you are running the with the database
MONGO_AUTO_CREATE_INDEXES=false

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=production
PORT=3002
REDIS_PORT=6379
REDIS_PREFIX=
REDIS_DB_INDEX=2
## This value should be set to true if it is the first time you are running the with the database
# Launch Darkly
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/src/.env.test
Tamaño: 363 bytes
Lenguaje detectado: TEST

### CONTENIDO ORIGINAL ###

MONGO_URL=mongodb://127.0.0.1:27017/novu-test
REDIS_PORT=6379
REDIS_HOST=localhost
REDIS_DB_INDEX=1
REDIS_PREFIX=
PORT=1340
JWT_SECRET=ASD#asda23DFEFSFHG%fg
NODE_ENV=test

REDIS_CACHE_SERVICE_HOST=127.0.0.1
REDIS_CACHE_SERVICE_PORT=6379

GLOBAL_CONTEXT_PATH=
WS_CONTEXT_PATH=

LOG_LEVEL=info
MONGO_AUTO_CREATE_INDEXES=true

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=


### ANALISIS AUTOMATICO (ESPAÑOL) ###

MONGO_URL=mongodb://127.0.0.1:27017/novu-test
REDIS_PORT=6379
REDIS_HOST=localhost
REDIS_DB_INDEX=1
REDIS_PREFIX=
# Launch Darkly
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/src/.example.env
Tamaño: 312 bytes
Lenguaje detectado: ENV

### CONTENIDO ORIGINAL ###

NODE_ENV=local
PORT=3002
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
MONGO_MAX_POOL_SIZE=500
REDIS_PORT=6379
REDIS_HOST=localhost
REDIS_DB_INDEX=2
REDIS_PREFIX=
JWT_SECRET=LOCAL_ONLY_CHANGE_ME

GLOBAL_CONTEXT_PATH=
WS_CONTEXT_PATH=

NEW_RELIC_ENABLED=false
LOG_LEVEL=info

# Launch Darkly
LAUNCH_DARKLY_SDK_KEY=


### ANALISIS AUTOMATICO (ESPAÑOL) ###

NODE_ENV=local
PORT=3002
MONGO_URL=mongodb://127.0.0.1:27017/novu-db
MONGO_MAX_POOL_SIZE=500
REDIS_PORT=6379
# Launch Darkly
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/apps/ws/src/app.controller.ts
Tamaño: 274 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/app.module.ts
Tamaño: 1409 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { ServeStaticModule } from '@nestjs/serve-static';
import { createNestLoggingModuleOptions, LoggerModule, TracingModule } from '@novu/application-generic';
import { SentryModule } from '@sentry/nestjs/setup';
import { join } from 'path';
import packageJson from '../package.json';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { HealthModule } from './health/health.module';
import { SharedModule } from './shared/shared.module';
import { SocketModule } from './socket/socket.module';

const modules = [
  SharedModule,
  HealthModule,
  TracingModule.register(packageJson.name, packageJson.version),
  SocketModule,
  LoggerModule.forRoot(
    createNestLoggingModuleOptions({
      serviceName: packageJson.name,
      version: packageJson.version,
    })
  ),
];

const providers: any[] = [AppService];

if (process.env.SENTRY_DSN) {
  modules.unshift(SentryModule.forRoot());
}
if (!!process.env.SOCKET_IO_ADMIN_USERNAME && !!process.env.SOCKET_IO_ADMIN_PASSWORD_HASH) {
  modules.push(
    ServeStaticModule.forRoot({
      rootPath: join(__dirname, '../node_modules/@socket.io/admin-ui/ui/dist'),
      serveRoot: '/admin',
      exclude: ['/api/(.*)'],
    })
  );
}

@Module({
  imports: modules,
  exports: [SocketModule],
  controllers: [AppController],
  providers,
})
export class AppModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/app.service.ts
Tamaño: 142 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  getHello(): string {
    return 'Hello World!';
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AppService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/bootstrap.ts
Tamaño: 1410 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './instrument';
import { NestFactory } from '@nestjs/core';
import { BullMqService, getErrorInterceptor, Logger } from '@novu/application-generic';
import helmet from 'helmet';
import { AppModule } from './app.module';
import { CONTEXT_PATH, validateEnv } from './config';
import { InMemoryIoAdapter } from './shared/framework/in-memory-io.adapter';
import { prepareAppInfra, startAppInfra } from './socket/services';

// Validate the ENV variables after launching SENTRY, so missing variables will report to sentry
validateEnv();

export async function bootstrap() {
  BullMqService.haveProInstalled();
  const app = await NestFactory.create(AppModule, { bufferLogs: true });

  const inMemoryAdapter = new InMemoryIoAdapter(app);
  await inMemoryAdapter.connectToInMemoryCluster();

  app.useLogger(app.get(Logger));
  app.flushLogs();

  await prepareAppInfra(app);

  app.useGlobalInterceptors(getErrorInterceptor());

  app.setGlobalPrefix(CONTEXT_PATH);

  app.use(helmet());

  app.enableCors({
    origin: '*',
    preflightContinue: false,
    allowedHeaders: ['Content-Type', 'Authorization'],
    methods: ['GET', 'HEAD', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  });

  app.useWebSocketAdapter(inMemoryAdapter);

  app.enableShutdownHooks();

  await app.init();

  try {
    await startAppInfra(app);
  } catch (e) {
    process.exit(1);
  }

  await app.listen(process.env.PORT as string);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - bootstrap()
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/instrument.ts
Tamaño: 331 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import './config/env.config';
import 'newrelic';
import { init } from '@sentry/nestjs';
import { version } from '../package.json';

if (process.env.SENTRY_DSN) {
  init({
    dsn: process.env.SENTRY_DSN,
    environment: process.env.NODE_ENV,
    release: `v${version}`,
    ignoreErrors: ['Non-Error exception captured'],
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/main.ts
Tamaño: 55 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { bootstrap } from './bootstrap';

bootstrap();


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/config/env.config.ts
Tamaño: 323 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import path from 'node:path';
import { getContextPath, getEnvFileNameForNodeEnv, NovuComponentEnum } from '@novu/shared';
import dotenv from 'dotenv';

dotenv.config({
  path: path.join(__dirname, '..', getEnvFileNameForNodeEnv(process.env.NODE_ENV)),
});

export const CONTEXT_PATH = getContextPath(NovuComponentEnum.WS);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/config/env.validators.ts
Tamaño: 1236 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { StringifyEnv } from '@novu/shared';
import { bool, CleanedEnv, cleanEnv, json, num, port, str, ValidatorSpec } from 'envalid';

export function validateEnv() {
  return cleanEnv(process.env, envValidators);
}

export type ValidatedEnv = StringifyEnv<CleanedEnv<typeof envValidators>>;

export const envValidators = {
  JWT_SECRET: str(),
  MONGO_AUTO_CREATE_INDEXES: bool({ default: false }),
  MONGO_MAX_IDLE_TIME_IN_MS: num({ default: 1000 * 30 }),
  MONGO_MAX_POOL_SIZE: num({ default: 50 }),
  MONGO_MIN_POOL_SIZE: num({ default: 10 }),
  MONGO_URL: str(),
  NODE_ENV: str({ choices: ['dev', 'test', 'production', 'ci', 'local'], default: 'local' }),
  PORT: port(),
  REDIS_HOST: str(),
  REDIS_PORT: port(),
  REDIS_TLS: json({ default: undefined }),
  REDIS_MASTER_HOST: str({ default: '' }),
  REDIS_MASTER_PORT: str({ default: '' }),
  REDIS_SLAVE_HOST: str({ default: '' }),
  REDIS_SLAVE_PORT: str({ default: '' }),
  SENTRY_DSN: str({ default: undefined }),
  TZ: str({ default: 'UTC' }),
  WORKER_DEFAULT_CONCURRENCY: num({ default: undefined }),
  WORKER_DEFAULT_LOCK_DURATION: num({ default: undefined }),
  LAUNCH_DARKLY_SDK_KEY: str({ default: undefined }),
} satisfies Record<string, ValidatorSpec<unknown>>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - validateEnv()
Declaraciones 'export' encontradas:
- export function validateEnv
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/config/index.ts
Tamaño: 64 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './env.config';
export * from './env.validators';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/health/health.controller.ts
Tamaño: 1226 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Controller, Get, Inject } from '@nestjs/common';
import { HealthCheck, HealthCheckResult, HealthCheckService } from '@nestjs/terminus';
import { DalServiceHealthIndicator, IHealthIndicator } from '@novu/application-generic';

import { version } from '../../package.json';
import { WSServerHealthIndicator } from '../socket/services';

@Controller('v1/health-check')
export class HealthController {
  constructor(
    private healthCheckService: HealthCheckService,
    private dalHealthIndicator: DalServiceHealthIndicator,
    private wsServerHealthIndicator: WSServerHealthIndicator,
    @Inject('QUEUE_HEALTH_INDICATORS') private indicators: IHealthIndicator[]
  ) {}

  @Get()
  @HealthCheck()
  async healthCheck(): Promise<HealthCheckResult> {
    const indicatorHealthCheckFunctions = this.indicators.map((indicator) => async () => indicator.isHealthy());

    const result = await this.healthCheckService.check([
      ...indicatorHealthCheckFunctions,
      async () => this.dalHealthIndicator.isHealthy(),
      async () => this.wsServerHealthIndicator.isHealthy(),
      async () => ({
        apiVersion: {
          version,
          status: 'up',
        },
      }),
    ]);

    return result;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - indicatorHealthCheckFunctions(this.indicators.map((indicator))
 - result(await this.healthCheckService.check([
      ...indicatorHealthCheckFunctions,
      async ())
Declaraciones 'export' encontradas:
- export class HealthController

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/health/health.module.ts
Tamaño: 527 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { TerminusModule } from '@nestjs/terminus';
import { SharedModule } from '../shared/shared.module';
import { WSServerHealthIndicator } from '../socket/services';
import { SocketModule } from '../socket/socket.module';
import { HealthController } from './health.controller';

const PROVIDERS = [WSServerHealthIndicator];

@Module({
  imports: [TerminusModule, SharedModule, SocketModule],
  providers: PROVIDERS,
  controllers: [HealthController],
})
export class HealthModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class HealthModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/constants.ts
Tamaño: 41 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const DAL_SERVICE = 'DalService';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/shared.module.ts
Tamaño: 1477 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import {
  AnalyticsService,
  DalServiceHealthIndicator,
  QueuesModule,
  WebSocketsInMemoryProviderService,
} from '@novu/application-generic';
import { DalService, MessageRepository, NotificationRepository, SubscriberRepository } from '@novu/dal';

import { JobTopicNameEnum } from '@novu/shared';
import { SubscriberOnlineService } from './subscriber-online';

const DAL_MODELS = [SubscriberRepository, NotificationRepository, MessageRepository];

const dalService = {
  provide: DalService,
  useFactory: async () => {
    const service = new DalService();
    await service.connect(String(process.env.MONGO_URL));

    return service;
  },
};

const analyticsService = {
  provide: AnalyticsService,
  useFactory: async () => {
    const service = new AnalyticsService(process.env.SEGMENT_TOKEN, 500);
    await service.initialize();

    return service;
  },
};

const PROVIDERS = [
  analyticsService,
  dalService,
  DalServiceHealthIndicator,
  SubscriberOnlineService,
  WebSocketsInMemoryProviderService,
  ...DAL_MODELS,
];

@Module({
  imports: [
    QueuesModule.forRoot([JobTopicNameEnum.WEB_SOCKETS]),
    JwtModule.register({
      secretOrKeyProvider: () => process.env.JWT_SECRET as string,
      signOptions: {
        expiresIn: 360000,
      },
    }),
  ],
  providers: [...PROVIDERS],
  exports: [...PROVIDERS, JwtModule, QueuesModule],
})
export class SharedModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - dalService({
  provide: DalService,
  useFactory: async ())
 - analyticsService({
  provide: AnalyticsService,
  useFactory: async ())
 - PROVIDERS([
  analyticsService,
  dalService,
  DalServiceHealthIndicator,
  SubscriberOnlineService,
  WebSoc...)
Declaraciones 'export' encontradas:
- export class SharedModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/framework/in-memory-io.adapter.ts
Tamaño: 1529 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { IoAdapter } from '@nestjs/platform-socket.io';
import { WebSocketsInMemoryProviderService } from '@novu/application-generic';
import { getRedisPrefix } from '@novu/shared';
import { createAdapter } from '@socket.io/redis-adapter';
import { ServerOptions } from 'socket.io';

export class InMemoryIoAdapter extends IoAdapter {
  private webSocketsInMemoryProviderService: WebSocketsInMemoryProviderService;
  private adapterConstructor: ReturnType<typeof createAdapter>;

  async connectToInMemoryCluster(): Promise<void> {
    // TODO: Pending to inject in the provider instantiation
    const keyPrefix = getRedisPrefix() ? `socket.io#${getRedisPrefix()}` : 'socket.io';

    this.webSocketsInMemoryProviderService = new WebSocketsInMemoryProviderService();
    const pubClient = this.webSocketsInMemoryProviderService.getClient();
    const subClient = pubClient?.duplicate();

    await this.webSocketsInMemoryProviderService.initialize();

    /*
     *  TODO: Might not be needed to connect as we are checking it is initialized already.
     *
     */

    Logger.log(`PubClient status: ${pubClient?.status}`, 'InMemoryIoAdapter');
    Logger.log(`SubClient status: ${subClient?.status}`, 'InMemoryIoAdapter');

    this.adapterConstructor = createAdapter(pubClient, subClient);
  }

  createIOServer(port: number, options?: ServerOptions): any {
    const server = super.createIOServer(port, options);
    server.adapter(this.adapterConstructor);

    return server;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InMemoryIoAdapter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/framework/response.interceptor.ts
Tamaño: 1058 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CallHandler, ExecutionContext, Injectable, NestInterceptor } from '@nestjs/common';
import { instanceToPlain } from 'class-transformer';
import { isArray, isObject } from 'lodash';
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';

export interface Response<T> {
  data: T;
}

@Injectable()
export class ResponseInterceptor<T> implements NestInterceptor<T, Response<T>> {
  intercept(context, next: CallHandler): Observable<Response<T>> {
    if (context.getType() === 'graphql') return next.handle();

    return next.handle().pipe(
      map((data) => {
        return {
          data: isObject(data) ? this.transformResponse(data) : data,
        };
      })
    );
  }

  private transformResponse(response) {
    if (isArray(response)) {
      return response.map((item) => this.transformToPlain(item));
    }

    return this.transformToPlain(response);
  }

  private transformToPlain(plainOrClass) {
    return plainOrClass && plainOrClass.constructor !== Object ? instanceToPlain(plainOrClass) : plainOrClass;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class ResponseInterceptor

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/framework/user.decorator.ts
Tamaño: 1345 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createParamDecorator, UnauthorizedException } from '@nestjs/common';
import jwt from 'jsonwebtoken';

export const UserSession = createParamDecorator((data, ctx) => {
  let req;

  if (ctx.getType() === 'graphql') {
    req = ctx.getArgs()[2].req;
  } else {
    req = ctx.switchToHttp().getRequest();
  }

  if (req.user) return req.user;

  if (req.headers) {
    if (req.headers.authorization) {
      const tokenParts = req.headers.authorization.split(' ');

      if (tokenParts[0] !== 'Bearer') throw new UnauthorizedException('bad_token');
      if (!tokenParts[1]) throw new UnauthorizedException('bad_token');

      const user = jwt.decode(tokenParts[1]);

      return user;
    }
  }

  return null;
});

export const SubscriberSession = createParamDecorator((data, ctx) => {
  let req;

  if (ctx.getType() === 'graphql') {
    req = ctx.getArgs()[2].req;
  } else {
    req = ctx.switchToHttp().getRequest();
  }

  if (req.user) return req.user;
  if (req.headers) {
    if (req.headers.authorization) {
      const tokenParts = req.headers.authorization.split(' ');

      if (tokenParts[0] !== 'Bearer') throw new UnauthorizedException('bad_token');
      if (!tokenParts[1]) throw new UnauthorizedException('bad_token');

      const user = jwt.decode(tokenParts[1]);

      return user;
    }
  }

  return null;
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - UserSession(createParamDecorator((data, ctx))
 - SubscriberSession(createParamDecorator((data, ctx))
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/helpers/regex.service.ts
Tamaño: 136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function escapeRegExp(text: string): string {
  if (!text) return text;

  return text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - escapeRegExp(text: string)
Declaraciones 'export' encontradas:
- export function escapeRegExp

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/subscriber-online/index.ts
Tamaño: 45 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './subscriber-online.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/shared/subscriber-online/subscriber-online.service.ts
Tamaño: 1088 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { SubscriberRepository } from '@novu/dal';
import { ISubscriberJwt } from '@novu/shared';

interface IUpdateSubscriberPayload {
  isOnline: boolean;
  lastOnlineAt?: string;
}

@Injectable()
export class SubscriberOnlineService {
  constructor(private subscriberRepository: SubscriberRepository) {}

  async handleConnection(subscriber: ISubscriberJwt) {
    const isOnline = true;

    await this.updateOnlineStatus(subscriber, { isOnline });
  }

  async handleDisconnection(subscriber: ISubscriberJwt, activeConnections: number) {
    const lastOnlineAt = new Date().toISOString();
    let isOnline = false;

    if (activeConnections > 1) {
      isOnline = true;
    }

    await this.updateOnlineStatus(subscriber, { isOnline, lastOnlineAt });
  }

  private async updateOnlineStatus(subscriber: ISubscriberJwt, updatePayload: IUpdateSubscriberPayload) {
    await this.subscriberRepository.update(
      { _id: subscriber._id, _environmentId: subscriber.environmentId },
      {
        $set: updatePayload,
      }
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SubscriberOnlineService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/socket.module.ts
Tamaño: 1390 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module, OnApplicationShutdown, Provider } from '@nestjs/common';
import { FeatureFlagsService, WorkflowInMemoryProviderService } from '@novu/application-generic';
import { SharedModule } from '../shared/shared.module';
import { WebSocketWorker } from './services';
import { ExternalServicesRoute } from './usecases/external-services-route';
import { WSGateway } from './ws.gateway';

export const featureFlagsService = {
  provide: FeatureFlagsService,
  useFactory: async (): Promise<FeatureFlagsService> => {
    const instance = new FeatureFlagsService();
    await instance.initialize();

    return instance;
  },
};

const USE_CASES: Provider[] = [ExternalServicesRoute, featureFlagsService];

const PROVIDERS: Provider[] = [WSGateway, WebSocketWorker];

const memoryQueueService = {
  provide: WorkflowInMemoryProviderService,
  useFactory: async () => {
    const memoryService = new WorkflowInMemoryProviderService();

    await memoryService.initialize();

    return memoryService;
  },
};

@Module({
  imports: [SharedModule],
  providers: [...PROVIDERS, ...USE_CASES, memoryQueueService],
  exports: [WSGateway],
})
export class SocketModule implements OnApplicationShutdown {
  constructor(private workflowInMemoryProviderService: WorkflowInMemoryProviderService) {}

  async onApplicationShutdown() {
    await this.workflowInMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - featureFlagsService({
  provide: FeatureFlagsService,
  useFactory: async (): Promise<FeatureFlagsService>)
 - memoryQueueService({
  provide: WorkflowInMemoryProviderService,
  useFactory: async ())
Declaraciones 'export' encontradas:
- export  const
- export class SocketModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/ws.gateway.ts
Tamaño: 12955 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { OnGatewayConnection, OnGatewayDisconnect, WebSocketGateway, WebSocketServer } from '@nestjs/websockets';
import { IDestroy } from '@novu/application-generic';
import { ISubscriberJwt, ObservabilityBackgroundTransactionEnum } from '@novu/shared';
import { instrument } from '@socket.io/admin-ui';
import { Server, Socket } from 'socket.io';

import { SubscriberOnlineService } from '../shared/subscriber-online';

const nr = require('newrelic');

const LOG_CONTEXT = 'WSGateway';

@WebSocketGateway()
export class WSGateway implements OnGatewayConnection, OnGatewayDisconnect, IDestroy {
  private isShutdown = false;

  constructor(
    private jwtService: JwtService,
    private subscriberOnlineService: SubscriberOnlineService
  ) {}

  @WebSocketServer()
  server: Server;

  async handleDisconnect(connection: Socket) {
    Logger.log(`New disconnect received from ${connection.id}`, LOG_CONTEXT);

    const _this = this;

    return new Promise((resolve, reject) => {
      nr.startBackgroundTransaction(
        ObservabilityBackgroundTransactionEnum.WS_SOCKET_HANDLE_DISCONNECT,
        'WS Service',
        function processTask() {
          const transaction = nr.getTransaction();

          _this
            .processDisconnectionRequest(connection)
            .then(resolve)
            .catch(reject)
            .finally(() => {
              transaction.end();
            });
        }
      );
    });
  }

  async handleConnection(connection: Socket) {
    Logger.log(`New connection received from ${connection.id}`, LOG_CONTEXT);

    const _this = this;

    return new Promise((resolve, reject) => {
      nr.startBackgroundTransaction(
        ObservabilityBackgroundTransactionEnum.WS_SOCKET_SOCKET_CONNECTION,
        'WS Service',
        function processTask() {
          const transaction = nr.getTransaction();

          _this
            .processConnectionRequest(connection)
            .then(resolve)
            .catch(reject)
            .finally(() => {
              transaction.end();
            });
        }
      );
    });
  }

  private extractToken(connection: Socket): string | undefined {
    return connection.handshake.auth?.token || connection.handshake.query?.token;
  }

  private async getSubscriber(token: string): Promise<ISubscriberJwt | undefined> {
    let subscriber: ISubscriberJwt;

    try {
      subscriber = await this.jwtService.verify(token as string);
      if (subscriber.aud !== 'widget_user') {
        return;
      }

      return subscriber;
    } catch (e) {
      /* empty */
    }
  }

  /*
   * This method is called when a client disconnects from the server.
   * * When a shutdown is in progress, we opt out of updating the subscriber status,
   * assuming that when the current instance goes down, another instance will take its place and handle the subscriber status update.
   */
  private async processDisconnectionRequest(connection: Socket) {
    if (!this.isShutdown) {
      await this.handlerSubscriberDisconnection(connection);
    } else {
      Logger.log(`Skipped disconnect due to shutdown flag for connection ${connection.id}`, LOG_CONTEXT);
    }
  }

  private async handlerSubscriberDisconnection(connection: Socket) {
    const token = this.extractToken(connection);

    if (!token || token === 'null') {
      return;
    }

    const subscriber = await this.getSubscriber(token);
    if (!subscriber) {
      return;
    }

    const activeConnections = await this.getActiveConnections(connection, subscriber._id);

    Logger.log(
      `Disconnect request received from ${subscriber._id}. Active connections: ${activeConnections}`,
      LOG_CONTEXT
    );
    await this.subscriberOnlineService.handleDisconnection(subscriber, activeConnections);
  }

  private async getActiveConnections(socket: Socket, subscriberId: string) {
    const activeSockets = await this.server?.in(subscriberId).fetchSockets();

    return activeSockets?.length || 0;
  }

  private async processConnectionRequest(connection: Socket) {
    const token = this.extractToken(connection);

    if (!token || token === 'null') {
      Logger.warn(`No token was found during counnection process for ${connection.id}`, LOG_CONTEXT);

      return this.disconnect(connection);
    }

    const subscriber = await this.getSubscriber(token);
    if (!subscriber) {
      Logger.warn(`No subscriber was found for specified token ${connection.id}`, LOG_CONTEXT);

      return this.disconnect(connection);
    }

    Logger.log(
      `Connection request received from ${subscriber._id} external id: ${subscriber.subscriberId} organization id: ${subscriber.organizationId}`,
      LOG_CONTEXT
    );

    // Store contexts in socket metadata for filtering
    // undefined = FF OFF, [] = FF ON with no context, ['key'] = FF ON with context
    connection.data.contextKeys = subscriber.contextKeys;

    // Join single user room (no per-context rooms needed)
    await connection.join(subscriber._id);

    const contextDisplay =
      subscriber.contextKeys === undefined
        ? 'FF disabled'
        : subscriber.contextKeys.length === 0
          ? 'no context'
          : subscriber.contextKeys.join(', ');
    Logger.log(
      `Connection ${connection.id} accepted for ${subscriber._id} with contexts: ${contextDisplay}`,
      LOG_CONTEXT
    );

    await this.subscriberOnlineService.handleConnection(subscriber);
  }

  async sendMessage(userId: string, event: string, data: any, contextKeys?: string[]) {
    if (!this.server) {
      Logger.error('No sw server available to send message', LOG_CONTEXT);

      return;
    }

    const sockets = await this.server.in(userId).fetchSockets();

    // FF OFF: message contextKeys is undefined, broadcast to all sockets
    if (contextKeys === undefined) {
      Logger.log(`Sending event ${event} to all ${sockets.length} socket(s) (FF disabled)`, LOG_CONTEXT);
      for (const socket of sockets) {
        socket.emit(event, data);
      }

      return;
    }

    // FF ON: filter by exact context match
    const messageContextKeys = contextKeys;

    Logger.log(
      `Sending event ${event} to ${userId} with message contexts: ${messageContextKeys.length === 0 ? 'none' : messageContextKeys.join(', ')} (${sockets.length} socket(s))`,
      LOG_CONTEXT
    );

    for (const socket of sockets) {
      const inboxContextKeys = socket.data.contextKeys;

      if (this.isExactMatch(messageContextKeys, inboxContextKeys)) {
        socket.emit(event, data);
        Logger.log(
          `Delivered to socket ${socket.id} with inbox contexts: ${inboxContextKeys?.length === 0 ? 'none' : inboxContextKeys?.join(', ')}`,
          LOG_CONTEXT
        );
      } else {
        Logger.log(
          `Skipped socket ${socket.id} - contexts mismatch. Message: [${messageContextKeys.join(', ') || 'none'}], Inbox: [${inboxContextKeys?.join(', ') || 'none'}]`,
          LOG_CONTEXT
        );
      }
    }
  }

  private isExactMatch(messageContextKeys: string[], inboxContextKeys?: string[]): boolean {
    // When FF is OFF, inbox contextKeys will be undefined - should never happen here since we early return above
    // This is just a safety check
    if (inboxContextKeys === undefined) {
      return true;
    }

    if (messageContextKeys.length === 0) {
      return inboxContextKeys.length === 0;
    }

    if (messageContextKeys.length !== inboxContextKeys.length) {
      return false;
    }

    // Order-independent match: all message keys must exist in inbox keys
    return messageContextKeys.every((key) => inboxContextKeys.includes(key));
  }

  async sendUnreadCountToAllConnections(userId: string, environmentId: string, messageRepository: any) {
    if (!this.server) {
      Logger.error('No server available to send unread count', LOG_CONTEXT);

      return;
    }

    const sockets = await this.server.in(userId).fetchSockets();

    Logger.log(`Sending individualized unread counts to ${sockets.length} socket(s) for user ${userId}`, LOG_CONTEXT);

    for (const socket of sockets) {
      // Preserve undefined (FF OFF) vs [] (FF ON, no context)
      const contextKeys = socket.data.contextKeys;

      try {
        const [unreadCount, severityCounts] = await Promise.all([
          messageRepository.getCount(
            environmentId,
            userId,
            'in_app',
            { read: false },
            { limit: 101 },
            contextKeys,
            undefined,
            'primary'
          ),
          messageRepository.getCountBySeverity(
            environmentId,
            userId,
            'in_app',
            { read: false, snoozed: false },
            { limit: 99 },
            contextKeys
          ),
        ]);

        const paginationIndication =
          unreadCount > 100 ? { unreadCount: 100, hasMore: true } : { unreadCount, hasMore: false };

        const counts = {
          total: unreadCount,
          severity: {
            high: 0,
            medium: 0,
            low: 0,
            none: 0,
          },
        };

        for (const { severity, count } of severityCounts) {
          if (severity in counts.severity) {
            counts.severity[severity] = count;
          }
        }

        socket.emit('unread_count_changed', {
          unreadCount: paginationIndication.unreadCount,
          counts,
          hasMore: paginationIndication.hasMore,
        });

        const contextDisplay =
          contextKeys === undefined ? 'FF disabled' : contextKeys.length === 0 ? 'none' : contextKeys.join(', ');

        Logger.log(
          `Sent unread count to socket ${socket.id} with contexts [${contextDisplay}]: ${counts.total}`,
          LOG_CONTEXT
        );
      } catch (error) {
        Logger.error(`Failed to send unread count to socket ${socket.id}: ${error.message}`, LOG_CONTEXT);
      }
    }
  }

  async sendUnseenCountToAllConnections(userId: string, environmentId: string, messageRepository: any) {
    if (!this.server) {
      Logger.error('No server available to send unseen count', LOG_CONTEXT);

      return;
    }

    const sockets = await this.server.in(userId).fetchSockets();

    Logger.log(`Sending individualized unseen counts to ${sockets.length} socket(s) for user ${userId}`, LOG_CONTEXT);

    for (const socket of sockets) {
      // Preserve undefined (FF OFF) vs [] (FF ON, no context)
      const contextKeys = socket.data.contextKeys;

      try {
        const unseenCount = await messageRepository.getCount(
          environmentId,
          userId,
          'in_app',
          { seen: false },
          { limit: 101 },
          contextKeys,
          undefined,
          'primary'
        );

        const paginationIndication =
          unseenCount > 100 ? { unseenCount: 100, hasMore: true } : { unseenCount, hasMore: false };

        socket.emit('unseen_count_changed', {
          unseenCount: paginationIndication.unseenCount,
          hasMore: paginationIndication.hasMore,
        });

        const contextDisplay =
          contextKeys === undefined ? 'FF disabled' : contextKeys.length === 0 ? 'none' : contextKeys.join(', ');

        Logger.log(
          `Sent unseen count to socket ${socket.id} with contexts [${contextDisplay}]: ${unseenCount}`,
          LOG_CONTEXT
        );
      } catch (error) {
        Logger.error(`Failed to send unseen count to socket ${socket.id}: ${error.message}`, LOG_CONTEXT);
      }
    }
  }

  private disconnect(socket: Socket) {
    socket.disconnect();
  }

  async gracefulShutdown(): Promise<void> {
    try {
      if (!this.server) {
        Logger.error('WS server was not initialized while executing shutdown', LOG_CONTEXT);

        return;
      }

      Logger.log('Closing WS server for incoming new connections', LOG_CONTEXT);
      this.server.close();

      Logger.log('Disconnecting active sockets connections', LOG_CONTEXT);
      this.server.sockets.disconnectSockets();
    } catch (e) {
      Logger.error(e, 'Unexpected exception was thrown while graceful shut down was executed', LOG_CONTEXT);
      throw e;
    } finally {
      Logger.log(`Graceful shutdown down has finished`, LOG_CONTEXT);
    }
  }

  async onModuleDestroy(): Promise<void> {
    this.isShutdown = true;
    await this.gracefulShutdown();
  }

  afterInit() {
    if (!!process.env.SOCKET_IO_ADMIN_USERNAME && !!process.env.SOCKET_IO_ADMIN_PASSWORD_HASH) {
      // For more information on how to use the admin UI, see https://socket.io/docs/v4/admin-ui/
      instrument(this.server, {
        auth: {
          type: 'basic',
          username: process.env.SOCKET_IO_ADMIN_USERNAME,
          password: process.env.SOCKET_IO_ADMIN_PASSWORD_HASH,
        },
        mode: process.env.NODE_ENV === 'production' ? 'production' : 'development',
        namespaceName: '/admin',
      });
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - processTask()
 - processTask()
Asignaciones con arrow functions encontradas (posibles funciones):
 - _this(this;

    return new Promise((resolve, reject))
 - transaction(nr.getTransaction();

          _this
            .processDisconnectionRequest(connection)
         ...)
 - _this(this;

    return new Promise((resolve, reject))
 - transaction(nr.getTransaction();

          _this
            .processConnectionRequest(connection)
            ...)
Declaraciones 'export' encontradas:
- export class WSGateway

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/services/cold-start.service.ts
Tamaño: 835 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { INestApplication } from '@nestjs/common';
import { INovuWorker, ReadinessService } from '@novu/application-generic';
import { WebSocketWorker } from './web-socket.worker';

const getWorkers = (app: INestApplication): INovuWorker[] => {
  const webSocketWorker = app.get(WebSocketWorker, { strict: false });

  const workers: INovuWorker[] = [webSocketWorker];

  return workers;
};

export const prepareAppInfra = async (app: INestApplication): Promise<void> => {
  const readinessService = app.get(ReadinessService);
  const workers = getWorkers(app);

  await readinessService.pauseWorkers(workers);
};

export const startAppInfra = async (app: INestApplication): Promise<void> => {
  const readinessService = app.get(ReadinessService);
  const workers = getWorkers(app);
  await readinessService.enableWorkers(workers);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getWorkers(app: INestApplication): INovuWorker[])
 - prepareAppInfra(async (app: INestApplication): Promise<void>)
 - startAppInfra(async (app: INestApplication): Promise<void>)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/services/index.ts
Tamaño: 206 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { prepareAppInfra, startAppInfra } from './cold-start.service';
export { WebSocketWorker } from './web-socket.worker';
export { WSServerHealthIndicator } from './ws-server-health-indicator.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/services/web-socket.worker.spec.ts
Tamaño: 3300 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import {
  IWebSocketDataDto,
  SocketWorkerService,
  WebSocketsQueueService,
  WorkflowInMemoryProviderService,
} from '@novu/application-generic';
import { WebSocketEventEnum } from '@novu/shared';
import { expect } from 'chai';
import { setTimeout } from 'timers/promises';
import { SocketModule } from '../socket.module';
import { ExternalServicesRoute } from '../usecases/external-services-route';
import { WebSocketWorker } from './web-socket.worker';

let webSocketsQueueService: WebSocketsQueueService;
let webSocketWorker: WebSocketWorker;

// Mock SocketWorkerService
const mockSocketWorkerService = {
  isEnabled: async () => false,
  sendMessage: async () => undefined,
} as any;

describe('WebSocket Worker', () => {
  before(async () => {
    process.env.IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

    const moduleRef = await Test.createTestingModule({
      imports: [SocketModule],
    }).compile();

    const externalServicesRoute = moduleRef.get<ExternalServicesRoute>(ExternalServicesRoute);
    const workflowInMemoryProviderService = moduleRef.get<WorkflowInMemoryProviderService>(
      WorkflowInMemoryProviderService
    );

    webSocketWorker = new WebSocketWorker(externalServicesRoute, workflowInMemoryProviderService);

    webSocketsQueueService = new WebSocketsQueueService(workflowInMemoryProviderService, mockSocketWorkerService);
    await webSocketsQueueService.queue.obliterate();
  });

  after(async () => {
    await webSocketsQueueService.queue.drain();
    await webSocketWorker.gracefulShutdown();
  });

  it('should be initialised properly', async () => {
    expect(webSocketWorker).to.be.ok;
    expect(await webSocketWorker.bullMqService.getStatus()).to.deep.equal({
      queueIsPaused: undefined,
      queueName: undefined,
      workerName: 'ws_socket_queue',
      workerIsPaused: false,
      workerIsRunning: true,
    });
    expect(webSocketWorker.worker.opts).to.deep.include({
      concurrency: 400,
      lockDuration: 90000,
    });
  });

  it('should be able to automatically pull a job from the queue', async () => {
    const existingJobs = await webSocketsQueueService.queue.getJobs();
    expect(existingJobs.length).to.equal(0);

    const jobId = 'web-socket-queue-job-id';
    const _environmentId = 'web-socket-queue-environment-id';
    const _organizationId = 'web-socket-queue-organization-id';
    const _userId = 'web-socket-queue-user-id';
    const jobData = {
      event: WebSocketEventEnum.RECEIVED,
      _environmentId,
      _organizationId,
      userId: _userId,
    } as IWebSocketDataDto;

    await webSocketsQueueService.add({ name: jobId, data: jobData, groupId: _organizationId });

    expect(await webSocketsQueueService.queue.getActiveCount()).to.equal(1);
    expect(await webSocketsQueueService.queue.getWaitingCount()).to.equal(0);

    // When we arrive to pull the job it has been already pulled by the worker
    const nextJob = await webSocketWorker.worker.getNextJob(jobId);
    expect(nextJob).to.equal(undefined);

    await setTimeout(100);

    // No jobs left in queue
    const queueJobs = await webSocketsQueueService.queue.getJobs();
    expect(queueJobs.length).to.equal(0);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mockSocketWorkerService({
  isEnabled: async ())
 - webSocketsQueueService(new WebSocketsQueueService(workflowInMemoryProviderService, mockSocketWorkerService);
    await webS...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/services/web-socket.worker.ts
Tamaño: 2154 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';

import {
  BullMqService,
  getWebSocketWorkerOptions,
  IWebSocketDataDto,
  WebSocketsWorkerService,
  WorkerOptions,
  WorkflowInMemoryProviderService,
} from '@novu/application-generic';

import { ObservabilityBackgroundTransactionEnum } from '@novu/shared';
import { ExternalServicesRoute, ExternalServicesRouteCommand } from '../usecases/external-services-route';

const nr = require('newrelic');

const LOG_CONTEXT = 'WebSocketWorker';

@Injectable()
export class WebSocketWorker extends WebSocketsWorkerService {
  constructor(
    private externalServicesRoute: ExternalServicesRoute,
    private workflowInMemoryProviderService: WorkflowInMemoryProviderService
  ) {
    super(new BullMqService(workflowInMemoryProviderService));

    this.initWorker(this.getWorkerProcessor(), this.getWorkerOpts());
  }

  private getWorkerProcessor() {
    return async (job) => {
      return new Promise((resolve, reject) => {
        const _this = this;

        Logger.log(`Job ${job.id} / ${job.data.event} is being processed WebSocketWorker`, LOG_CONTEXT);

        nr.startBackgroundTransaction(ObservabilityBackgroundTransactionEnum.WS_SOCKET_QUEUE, 'WS Service', () => {
          const transaction = nr.getTransaction();
          const { data: jobData } = job;
          const data: IWebSocketDataDto = jobData;

          _this.externalServicesRoute
            .execute(
              ExternalServicesRouteCommand.create({
                userId: data.userId,
                event: data.event,
                payload: data.payload,
                _environmentId: data._environmentId,
                contextKeys: data.contextKeys,
              })
            )
            .then(resolve)
            .catch((error) => {
              Logger.error(error, 'Unexpected exception occurred while handling external services route ', LOG_CONTEXT);

              reject(error);
            })
            .finally(() => {
              transaction.end();
            });
        });
      });
    };
  }

  private getWorkerOpts(): WorkerOptions {
    return getWebSocketWorkerOptions();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('WebSocketWorker';

@Injectable()
export class WebSocketWorker extends WebSocketsWorkerService {
  c...)
 - _this(this;

        Logger.log(`Job ${job.id} / ${job.data.event} is being processed WebSocketWorker`, LO...)
 - IWebSocketDataDto(jobData;

          _this.externalServicesRoute
            .execute(
              ExternalServices...)
Declaraciones 'export' encontradas:
- export class WebSocketWorker

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/services/ws-server-health-indicator.service.ts
Tamaño: 757 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { HealthCheckError, HealthIndicator, HealthIndicatorResult } from '@nestjs/terminus';

import { IHealthIndicator } from '@novu/application-generic';

import { WSGateway } from '../ws.gateway';

@Injectable()
export class WSServerHealthIndicator extends HealthIndicator implements IHealthIndicator {
  private static KEY = 'ws-server';

  constructor(private wsGateway: WSGateway) {
    super();
  }

  async isHealthy(): Promise<HealthIndicatorResult> {
    const isHealthy = !!this.wsGateway.server;
    const result = this.getStatus(WSServerHealthIndicator.KEY, isHealthy);

    if (isHealthy) {
      return result;
    }

    throw new HealthCheckError('WS server health check failed', result);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WSServerHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/usecases/external-services-route/external-services-route.command.ts
Tamaño: 690 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseCommand } from '@novu/application-generic';
import { MessageEntity } from '@novu/dal';
import { IsDefined, IsOptional, IsString } from 'class-validator';

export class ExternalServicesRouteCommand extends BaseCommand {
  @IsDefined()
  @IsString()
  userId: string;

  @IsDefined()
  @IsString()
  event: string;

  @IsOptional()
  payload?: {
    /*
     * TODO: We shouldn't import DAL here but this is temporary as we will remove
     * the ability of send full message
     */
    message?: MessageEntity;
    messageId?: string;
    unreadCount?: number;
    unseenCount?: number;
  };

  @IsString()
  _environmentId: string;

  @IsOptional()
  contextKeys?: string[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExternalServicesRouteCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/usecases/external-services-route/external-services-route.spec.ts
Tamaño: 3257 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageEntity, MessageRepository } from '@novu/dal';
import { WebSocketEventEnum } from '@novu/shared';
import { Types } from 'mongoose';
import sinon from 'sinon';
import { WSGateway } from '../../ws.gateway';
import { ExternalServicesRouteCommand } from './external-services-route.command';
import { ExternalServicesRoute } from './external-services-route.usecase';

const environmentId = new Types.ObjectId().toString();
const messageId = 'message-id-1';
const userId = new Types.ObjectId().toString();

const commandReceivedMessage = ExternalServicesRouteCommand.create({
  event: WebSocketEventEnum.RECEIVED,
  userId,
  _environmentId: environmentId,
  payload: {
    message: {
      _id: messageId,
      _environmentId: environmentId,
      // etc...
    } as MessageEntity,
  },
});

const createWsGatewayStub = (result) => {
  return {
    sendMessage: sinon.stub(),
    server: {
      in: sinon.stub().returns({
        fetchSockets: sinon.stub().resolves(result),
      }),
    },
  } as WSGateway;
};

describe('ExternalServicesRoute', () => {
  let externalServicesRoute: ExternalServicesRoute;
  let wsGatewayStub;
  let findOneStub: sinon.Stub;
  let getCountStub: sinon.Stub;
  const messageRepository = new MessageRepository();

  beforeEach(() => {
    findOneStub = sinon.stub(MessageRepository.prototype, 'findOne');
    getCountStub = sinon.stub(MessageRepository.prototype, 'getCount');
  });

  afterEach(() => {
    findOneStub.restore();
    getCountStub.restore();
  });

  describe('User is not online', () => {
    beforeEach(() => {
      wsGatewayStub = createWsGatewayStub([]);
      externalServicesRoute = new ExternalServicesRoute(wsGatewayStub, messageRepository);
    });

    it('should not send any message to the web socket if user is not online', async () => {
      getCountStub.resolves(Promise.resolve(5));

      await externalServicesRoute.execute(commandReceivedMessage);

      sinon.assert.calledOnceWithExactly(wsGatewayStub.server.in, userId);
      sinon.assert.calledOnceWithExactly(wsGatewayStub.server.in(userId).fetchSockets);
      sinon.assert.notCalled(wsGatewayStub.sendMessage);
    });
  });

  describe('User is online', () => {
    beforeEach(() => {
      wsGatewayStub = createWsGatewayStub([{ id: 'socket-id' }]);
      externalServicesRoute = new ExternalServicesRoute(wsGatewayStub, messageRepository);
      findOneStub.resolves(Promise.resolve({ _id: messageId }));
    });

    it('should send message, unseen count and unread count change when event is received to Socket.io', async () => {
      getCountStub.resolves(Promise.resolve(5));

      await externalServicesRoute.execute(commandReceivedMessage);

      // Verify Socket.io calls
      sinon.assert.calledWithMatch(wsGatewayStub.sendMessage.getCall(0), userId, WebSocketEventEnum.RECEIVED, {
        message: {
          _id: messageId,
        },
      });
      sinon.assert.calledWithMatch(wsGatewayStub.sendMessage.getCall(1), userId, WebSocketEventEnum.UNSEEN, {
        unseenCount: 5,
        hasMore: false,
      });
      sinon.assert.calledWithMatch(wsGatewayStub.sendMessage.getCall(2), userId, WebSocketEventEnum.UNREAD, {
        unreadCount: 5,
        hasMore: false,
      });
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - createWsGatewayStub(result))
 - messageRepository(new MessageRepository();

  beforeEach(())
 - getCountStub(sinon.stub(MessageRepository.prototype, 'getCount');
  });

  afterEach(())
 - externalServicesRoute(new ExternalServicesRoute(wsGatewayStub, messageRepository);
    });

    it('should not send any me...)
 - externalServicesRoute(new ExternalServicesRoute(wsGatewayStub, messageRepository);
      findOneStub.resolves(Promise.reso...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/usecases/external-services-route/external-services-route.usecase.ts
Tamaño: 4888 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { MessageRepository } from '@novu/dal';
import { ChannelTypeEnum, WebSocketEventEnum } from '@novu/shared';
import { WSGateway } from '../../ws.gateway';
import { ExternalServicesRouteCommand } from './external-services-route.command';
import { IUnreadCountPaginationIndication, IUnseenCountPaginationIndication } from './types';

const LOG_CONTEXT = 'ExternalServicesRoute';

@Injectable()
export class ExternalServicesRoute {
  constructor(
    private wsGateway: WSGateway,
    private messageRepository: MessageRepository
  ) {}

  public async execute(command: ExternalServicesRouteCommand) {
    const isOnline = await this.connectionExist(command);

    if (!isOnline) {
      Logger.log(`Connection does not exist, ignoring command for ${command.userId}`, LOG_CONTEXT);

      return;
    }

    if (command.event === WebSocketEventEnum.RECEIVED) {
      await this.processReceivedEvent(command);
    }

    if (command.event === WebSocketEventEnum.UNSEEN) {
      await this.sendUnseenCountChange(command);
    }

    if (command.event === WebSocketEventEnum.UNREAD) {
      await this.sendUnreadCountChange(command);
    }
  }

  private async processReceivedEvent(command: ExternalServicesRouteCommand): Promise<void> {
    const { message, messageId } = command.payload || {};
    // TODO: Retro-compatibility for a bit just in case stalled messages
    if (message) {
      Logger.log('Sending full message in the payload', LOG_CONTEXT);
      await this.wsGateway.sendMessage(command.userId, command.event, command.payload, command.contextKeys);
    } else if (messageId) {
      Logger.log(`Sending messageId: ${messageId} in the payload, we need to retrieve the full message`, LOG_CONTEXT);
      const storedMessage = await this.messageRepository.findOne({
        _id: messageId,
        _environmentId: command._environmentId,
      });
      await this.wsGateway.sendMessage(command.userId, command.event, { message: storedMessage }, command.contextKeys);
    }

    // Only recalculate the counts if we send a messageId/message.
    if (message || messageId) {
      await this.sendUnseenCountChange(command);
      await this.sendUnreadCountChange(command);
    }
  }

  private async sendUnreadCountChange(command: ExternalServicesRouteCommand) {
    if (!command._environmentId) {
      return;
    }

    const [unreadCount, severityCounts] = await Promise.all([
      this.messageRepository.getCount(
        command._environmentId,
        command.userId,
        ChannelTypeEnum.IN_APP,
        { read: false },
        { limit: 101 },
        command.contextKeys,
        undefined,
        'primary'
      ),
      this.messageRepository.getCountBySeverity(
        command._environmentId,
        command.userId,
        ChannelTypeEnum.IN_APP,
        { read: false, snoozed: false },
        { limit: 99 },
        command.contextKeys
      ),
    ]);

    const paginationIndication: IUnreadCountPaginationIndication =
      unreadCount > 100 ? { unreadCount: 100, hasMore: true } : { unreadCount, hasMore: false };

    const counts = {
      total: unreadCount,
      severity: {
        high: 0,
        medium: 0,
        low: 0,
        none: 0,
      },
    };

    for (const { severity, count } of severityCounts) {
      if (severity in counts.severity) {
        counts.severity[severity] = count;
      }
    }

    await this.wsGateway.sendMessage(
      command.userId,
      WebSocketEventEnum.UNREAD,
      {
        unreadCount: paginationIndication.unreadCount,
        counts,
        hasMore: paginationIndication.hasMore,
      },
      command.contextKeys
    );
  }

  private async sendUnseenCountChange(command: ExternalServicesRouteCommand) {
    if (!command._environmentId) {
      Logger.warn('No environmentId found, unable to send unseen count', LOG_CONTEXT);

      return;
    }

    const unseenCount = await this.messageRepository.getCount(
      command._environmentId,
      command.userId,
      ChannelTypeEnum.IN_APP,
      { seen: false },
      { limit: 101 },
      command.contextKeys
    );

    const paginationIndication: IUnseenCountPaginationIndication =
      unseenCount > 100 ? { unseenCount: 100, hasMore: true } : { unseenCount, hasMore: false };

    await this.wsGateway.sendMessage(
      command.userId,
      WebSocketEventEnum.UNSEEN,
      {
        unseenCount: paginationIndication.unseenCount,
        hasMore: paginationIndication.hasMore,
      },
      command.contextKeys
    );
  }

  private async connectionExist(command: ExternalServicesRouteCommand): Promise<boolean | undefined> {
    if (!this.wsGateway.server) {
      Logger.error('No sw server found, unable to check if connection exists', LOG_CONTEXT);

      return;
    }

    return !!(await this.wsGateway.server.in(command.userId).fetchSockets()).length;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExternalServicesRoute

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/usecases/external-services-route/index.ts
Tamaño: 102 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './external-services-route.command';
export * from './external-services-route.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/socket/usecases/external-services-route/types.ts
Tamaño: 195 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IUnseenCountPaginationIndication {
  unseenCount: number;
  hasMore: boolean;
}

export interface IUnreadCountPaginationIndication {
  unreadCount: number;
  hasMore: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/apps/ws/src/types/env.d.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ValidatedEnv } from '../config';

declare global {
  namespace NodeJS {
    interface ProcessEnv extends ValidatedEnv {
      NODE_ENV: 'test' | 'production' | 'dev' | 'ci' | 'local';
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/docker/.env.example
Tamaño: 1685 bytes
Lenguaje detectado: EXAMPLE

### CONTENIDO ORIGINAL ###

# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
# used as a secret to verify the JWT token signature
JWT_SECRET=your-secret
# used to encrypt/decrypt the provider credentials
STORE_ENCRYPTION_KEY=<ENCRYPTION_KEY_MUST_BE_32_LONG>

# Host
HOST_NAME=http://localhost

# General
# available values 'dev', 'test', 'production', 'ci', 'local'
NODE_ENV=local
MONGO_MAX_POOL_SIZE=500
MONGO_MIN_POOL_SIZE=100
DOCKER_MONGO_PORT=27017
# MONGO USER
MONGO_INITDB_ROOT_USERNAME=root
# MONGO PASSWORD
MONGO_INITDB_ROOT_PASSWORD=secret
MONGO_URL=mongodb://root:secret@mongodb:27017/novu-db?authSource=admin
MONGO_AUTO_CREATE_INDEXES=true

REDIS_HOST=redis

DOCKER_REDIS_SERVICE_PORT=6379
REDIS_PASSWORD=
REDIS_CACHE_SERVICE_HOST=

# AWS
S3_LOCAL_STACK=$HOST_NAME:4566
S3_BUCKET_NAME=novu-local
S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test

# Ports
API_PORT=3000
REDIS_PORT=6379
REDIS_CACHE_SERVICE_PORT=6379
WS_PORT=3002

# Root URL
REACT_APP_WS_URL=$HOST_NAME:3002
# Uncomment this one when deploying Novu in the local environment
# as Web app local Dockerfile will have to load this to be used.
# Deployment version doesn't need as we inject it with API_ROOT_URL value.
# REACT_APP_API_URL=http://localhost:3000
API_ROOT_URL=$HOST_NAME:3000
DISABLE_USER_REGISTRATION=false
FRONT_BASE_URL=$HOST_NAME:4200
WIDGET_EMBED_PATH=$HOST_NAME:4701/embed.umd.min.js
WIDGET_URL=$HOST_NAME:4500

# Context Paths
# Only needed for setups with reverse-proxies
GLOBAL_CONTEXT_PATH=
WEB_CONTEXT_PATH=
API_CONTEXT_PATH=
WS_CONTEXT_PATH=
WIDGET_CONTEXT_PATH=

# Analytics
SENTRY_DSN=
# change these values
NEW_RELIC_APP_NAME=
NEW_RELIC_LICENSE_KEY=

DOCKER_LOCALSTACK_PORT=4566


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
# used as a secret to verify the JWT token signature
JWT_SECRET=your-secret
# used to encrypt/decrypt the provider credentials
# Host
# General
# available values 'dev', 'test', 'production', 'ci', 'local'
# MONGO USER
# MONGO PASSWORD
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/Readme.md
Tamaño: 2547 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

Docker is the easiest way to get started with self-hosted Novu,
however if you want to set up the system on docker for local development look [here](local/Readme.md)
or if you want to deploy Novu to Kubernetes using Helm check [here](kubernetes/helm/Readme.md) or using Kustomize check [here](kubernetes/helm/Readme.md).

## Before you begin

You need the following installed in your system:

- [Docker](https://docs.docker.com/engine/install/) and [docker-compose](https://docs.docker.com/compose/install/)
- [Git](https://git-scm.com/downloads)

## Quick Start

### Get the code

Clone the Novu repo and enter the docker directory locally:

```sh
# Get the code
git clone https://github.com/novuhq/novu

# Go to the docker folder
cd novu/docker

# Copy the example env file
cp .env.example ./local/.env

# Start Novu
docker-compose -f ./local/docker-compose.yml up
```

Now visit [http://127.0.0.1:4200](http://127.0.0.1:4200) to start using Novu.

### Managing services

#### Running all services

For local development, you'll typically need to run all dependency services:

```sh
# Start all dependency services (recommended)
docker-compose -f docker/local/docker-compose.yml up -d
```

#### Running specific services

If you only need specific services running (for development or resource management), you can start individual services by specifying their names. This is particularly useful when you already have some services running locally on your system and want to avoid port conflicts or resource duplication:

```sh
# Run only ClickHouse
docker-compose -f docker/local/docker-compose.yml up -d clickhouse
```

### Securing your setup

While we provide you with some example secrets for getting started, you should NEVER deploy your Novu setup using the defaults provided.

### Update Secrets

Update the `.env` file with your own secrets. In particular, these are required:

- `JWT_SECRET`: used by the API to generate JWT keys

### Redis config

Redis TLS can be configured by adding the following variables to the `.env` file and specifying the necessary properties inside:

- `REDIS_TLS={"servername":"localhost"}`
- `REDIS_CACHE_SERVICE_TLS={"servername":"localhost"}`

## Configuration

To keep the setup simple, we made some choices that may not be optimal for production:

- the database is in the same machine as the servers
- the storage uses the filesystem backend instead of S3

We strongly recommend that you decouple your database before deploying.

## Next steps

- Got a question? [Ask here](https://discord.gg/novu).


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Docker is the easiest way to get started with self-hosted Novu,
however if you want to set up the system on docker for local development look [here](local/Readme.md)
or if you want to deploy Novu to Kubernetes using Helm check [here](kubernetes/helm/Readme.md) or using Kustomize check [here](kubernetes/helm/Readme.md).
## Before you begin
## Quick Start
### Get the code
# Get the code
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/community/.env.example
Tamaño: 2071 bytes
Lenguaje detectado: EXAMPLE

### CONTENIDO ORIGINAL ###

# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
# used as a secret to verify the JWT token signature
JWT_SECRET=your-secret
# expressed in seconds or a string describing a time span [zeit/ms](https://github.com/zeit/ms.js).  Eg: 60, "2 days", "10h", "7d"
SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME=15d
# used to encrypt/decrypt the provider credentials
STORE_ENCRYPTION_KEY=<ENCRYPTION_KEY_MUST_BE_32_LONG>

# Random generated secret key.
NOVU_SECRET_KEY=<RANDOM_GENERATED_SECRET_KEY>

# Host
HOST_NAME=http://localhost

# General
# available values 'dev', 'test', 'production', 'ci', 'local'
NODE_ENV=local
MONGO_MAX_POOL_SIZE=10
MONGO_MIN_POOL_SIZE=5

# MONGO USER
MONGO_INITDB_ROOT_USERNAME=root
# MONGO PASSWORD
MONGO_INITDB_ROOT_PASSWORD=secret
MONGO_URL=mongodb://${MONGO_INITDB_ROOT_USERNAME}:${MONGO_INITDB_ROOT_PASSWORD}@mongodb:27017/novu-db?authSource=admin
MONGO_AUTO_CREATE_INDEXES=true

REDIS_HOST=redis

DOCKER_REDIS_SERVICE_PORT=6379
REDIS_PASSWORD=
REDIS_CACHE_SERVICE_HOST=

# AWS
S3_LOCAL_STACK=${HOST_NAME}:4566
S3_BUCKET_NAME=novu-local
S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=test
AWS_SECRET_ACCESS_KEY=test

# Ports
API_PORT=3000
REDIS_PORT=6379
REDIS_CACHE_SERVICE_PORT=6379
WS_PORT=3002

# Root URL
VITE_API_HOSTNAME=${HOST_NAME}:3000
VITE_WEBSOCKET_HOSTNAME=${HOST_NAME}:3002
# The VITE_LEGACY_DASHBOARD_URL must be set to the host and port of your web container.
API_ROOT_URL=${HOST_NAME}:3000
FRONT_BASE_URL=${HOST_NAME}:(4000|4200)
IS_API_IDEMPOTENCY_ENABLED=false
IS_API_RATE_LIMITING_ENABLED=false
IS_NEW_MESSAGES_API_RESPONSE_ENABLED=true
IS_V2_ENABLED=true
IS_CONTROLS_AUTOCOMPLETE_ENABLED=false
IS_WORKFLOW_NODE_PREVIEW_ENABLED=false
IS_ENHANCED_DIGEST_ENABLED=-false
IS_EMAIL_INLINE_CSS_DISABLED=false
IS_USE_MERGED_DIGEST_ID_ENABLED=false


# Analytics
SENTRY_DSN=

# update these values in case you are using New Relic, by default New Relic is disabled
NEW_RELIC_ENABLED=false
NEW_RELIC_APP_NAME="NEW_RELIC_APP_NAME"
NEW_RELIC_LICENSE_KEY="NEW_RELIC_LICENSE_KEY"

BROADCAST_QUEUE_CHUNK_SIZE=100
MULTICAST_QUEUE_CHUNK_SIZE=100


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Secrets
# YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION
# used as a secret to verify the JWT token signature
JWT_SECRET=your-secret
# expressed in seconds or a string describing a time span [zeit/ms](https://github.com/zeit/ms.js).  Eg: 60, "2 days", "10h", "7d"
# used to encrypt/decrypt the provider credentials
# Random generated secret key.
# Host
# General
# available values 'dev', 'test', 'production', 'ci', 'local'
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/community/docker-compose.yml
Tamaño: 5502 bytes
Lenguaje detectado: YAML

### CONTENIDO ORIGINAL ###

name: novu
services:
  redis:
    image: 'redis:alpine'
    container_name: redis
    restart: unless-stopped
    logging:
      driver: 'json-file' # Enabled json-file logging with limits for consistency
      options:
        max-size: '50m'
        max-file: '5'
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  mongodb:
    image: mongo:8.0.3
    container_name: mongodb
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
    environment:
      - PUID=1000
      - PGID=1000
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
    volumes:
      - mongodb:/data/db
    ports:
      - 27017:27017
    healthcheck:
      test: ["CMD", "mongo", "--eval", "db.adminCommand('ping')"]
      interval: 10s
      timeout: 5s
      retries: 5

  api:
    image: 'ghcr.io/novuhq/novu/api:2.3.0'
    depends_on:
      - mongodb
      - redis
    container_name: api
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
    environment:
      NODE_ENV: ${NODE_ENV}
      API_ROOT_URL: ${API_ROOT_URL}
      PORT: ${API_PORT}
      FRONT_BASE_URL: ${FRONT_BASE_URL}
      MONGO_URL: ${MONGO_URL}
      MONGO_MIN_POOL_SIZE: ${MONGO_MIN_POOL_SIZE}
      MONGO_MAX_POOL_SIZE: ${MONGO_MAX_POOL_SIZE}
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      REDIS_DB_INDEX: 2
      REDIS_CACHE_SERVICE_HOST: ${REDIS_CACHE_SERVICE_HOST}
      REDIS_CACHE_SERVICE_PORT: ${REDIS_CACHE_SERVICE_PORT}
      S3_LOCAL_STACK: ${S3_LOCAL_STACK}
      S3_BUCKET_NAME: ${S3_BUCKET_NAME}
      S3_REGION: ${S3_REGION}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      JWT_SECRET: ${JWT_SECRET}
      STORE_ENCRYPTION_KEY: ${STORE_ENCRYPTION_KEY}
      NOVU_SECRET_KEY: ${NOVU_SECRET_KEY}
      SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME: ${SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME}
      SENTRY_DSN: ${SENTRY_DSN}
      NEW_RELIC_ENABLED: ${NEW_RELIC_ENABLED}
      NEW_RELIC_APP_NAME: ${NEW_RELIC_APP_NAME}
      NEW_RELIC_LICENSE_KEY: ${NEW_RELIC_LICENSE_KEY}
      API_CONTEXT_PATH: ${API_CONTEXT_PATH}
      MONGO_AUTO_CREATE_INDEXES: ${MONGO_AUTO_CREATE_INDEXES}
      IS_API_IDEMPOTENCY_ENABLED: ${IS_API_IDEMPOTENCY_ENABLED}
      IS_API_RATE_LIMITING_ENABLED: ${IS_API_RATE_LIMITING_ENABLED}
      IS_NEW_MESSAGES_API_RESPONSE_ENABLED: ${IS_NEW_MESSAGES_API_RESPONSE_ENABLED}
      IS_V2_ENABLED: ${IS_V2_ENABLED}
    ports:
      - ${API_PORT}:${API_PORT}
  
  worker:
    image: 'ghcr.io/novuhq/novu/worker:2.3.0'
    depends_on:
      - mongodb
      - redis
    container_name: worker
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
    environment:
      NODE_ENV: ${NODE_ENV}
      MONGO_URL: ${MONGO_URL}
      MONGO_MAX_POOL_SIZE: ${MONGO_MAX_POOL_SIZE}
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      REDIS_DB_INDEX: 2
      REDIS_CACHE_SERVICE_HOST: ${REDIS_CACHE_SERVICE_HOST}
      REDIS_CACHE_SERVICE_PORT: ${REDIS_CACHE_SERVICE_PORT}
      S3_LOCAL_STACK: ${S3_LOCAL_STACK}
      S3_BUCKET_NAME: ${S3_BUCKET_NAME}
      S3_REGION: ${S3_REGION}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      STORE_ENCRYPTION_KEY: ${STORE_ENCRYPTION_KEY}
      SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME: ${SUBSCRIBER_WIDGET_JWT_EXPIRATION_TIME}
      SENTRY_DSN: ${SENTRY_DSN}
      NEW_RELIC_ENABLED: ${NEW_RELIC_ENABLED}
      NEW_RELIC_APP_NAME: ${NEW_RELIC_APP_NAME}
      NEW_RELIC_LICENSE_KEY: ${NEW_RELIC_LICENSE_KEY}
      BROADCAST_QUEUE_CHUNK_SIZE: ${BROADCAST_QUEUE_CHUNK_SIZE}
      MULTICAST_QUEUE_CHUNK_SIZE: ${MULTICAST_QUEUE_CHUNK_SIZE}
      API_ROOT_URL: http://api:${API_PORT}
      IS_EMAIL_INLINE_CSS_DISABLED: ${IS_EMAIL_INLINE_CSS_DISABLED}
      IS_USE_MERGED_DIGEST_ID_ENABLED: ${IS_USE_MERGED_DIGEST_ID_ENABLED}
  
  ws:
    image: 'ghcr.io/novuhq/novu/ws:2.3.0'
    depends_on:
      - mongodb
      - redis
    container_name: ws
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
    environment:
      PORT: ${WS_PORT}
      NODE_ENV: ${NODE_ENV}
      MONGO_URL: ${MONGO_URL}
      MONGO_MAX_POOL_SIZE: ${MONGO_MAX_POOL_SIZE}
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      WS_CONTEXT_PATH: ${WS_CONTEXT_PATH}
      NEW_RELIC_ENABLED: ${NEW_RELIC_ENABLED}
      NEW_RELIC_APP_NAME: ${NEW_RELIC_APP_NAME}
      NEW_RELIC_LICENSE_KEY: ${NEW_RELIC_LICENSE_KEY}
    ports:
      - ${WS_PORT}:${WS_PORT}

  dashboard:
    image: 'ghcr.io/novuhq/novu/dashboard:2.3.0'
    depends_on:
      - api
      - worker
    container_name: dashboard
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
    environment:
      VITE_API_HOSTNAME: ${VITE_API_HOSTNAME}
      VITE_SELF_HOSTED: true
      VITE_WEBSOCKET_HOSTNAME: ${VITE_WEBSOCKET_HOSTNAME}
      VITE_LEGACY_DASHBOARD_URL: ${VITE_LEGACY_DASHBOARD_URL}
    ports:
      - 4000:4000

volumes:
  mongodb: ~


### ANALISIS AUTOMATICO (ESPAÑOL) ###

name: novu
services:
redis:
image: 'redis:alpine'
container_name: redis
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/local/docker-compose.e2e.yml
Tamaño: 559 bytes
Lenguaje detectado: YAML

### CONTENIDO ORIGINAL ###

version: '3.1'

services:
  localstack:
    container_name: '${LOCALSTACK_DOCKER_NAME-localstack_main}'
    image: 'localstack/localstack:0.14.5'
    network_mode: bridge
    environment:
      - SERVICES=s3
    ports:
      - '${DOCKER_LOCALSTACK_PORT:-4566}:4566'
    volumes:
      - '${TMPDIR:-/tmp/localstack}:/tmp/localstack'
      - '/var/run/docker.sock:/var/run/docker.sock'
    healthcheck:
      test: "bash -c 'AWS_ACCESS_KEY_ID=test AWS_SECRET_ACCESS_KEY=test aws --endpoint-url=http://127.0.0.1:4566 s3 ls'"
      retries: 5
      interval: 10s


### ANALISIS AUTOMATICO (ESPAÑOL) ###

version: '3.1'
services:
localstack:
container_name: '${LOCALSTACK_DOCKER_NAME-localstack_main}'
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/local/docker-compose.local.yml
Tamaño: 540 bytes
Lenguaje detectado: YAML

### CONTENIDO ORIGINAL ###

services:
  api:
    build:
      dockerfile: './apps/api/Dockerfile'
      context: '../../..'
  worker:
    build:
      dockerfile: './apps/worker/Dockerfile'
      context: '../../..'
  web:
    build:
      dockerfile: './apps/web/Dockerfile'
      context: '../../..'
  ws:
    build:
      dockerfile: './apps/ws/Dockerfile'
      context: '../../..'
  widget:
    build:
      dockerfile: './apps/widget/Dockerfile'
      context: '../../..'
  embed:
    build:
      dockerfile: './libs/embed/Dockerfile'
      context: '../../..'


### ANALISIS AUTOMATICO (ESPAÑOL) ###

services:
api:
build:
dockerfile: './apps/api/Dockerfile'
context: '../../..'
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/docker/local/docker-compose.yml
Tamaño: 1611 bytes
Lenguaje detectado: YAML

### CONTENIDO ORIGINAL ###

services:
  localstack:
    container_name: '${LOCALSTACK_DOCKER_NAME-localstack_main}'
    image: 'localstack/localstack:0.14.5'
    network_mode: bridge
    environment:
      - SERVICES=s3
    ports:
      - '${DOCKER_LOCALSTACK_PORT:-4566}:4566'
    volumes:
      - '${TMPDIR:-/tmp/localstack}:/tmp/localstack'
      - '/var/run/docker.sock:/var/run/docker.sock'
    healthcheck:
      test: "bash -c 'AWS_ACCESS_KEY_ID=test AWS_SECRET_ACCESS_KEY=test aws --endpoint-url=http://127.0.0.1:4566 s3 ls'"
      retries: 5
      interval: 10s

  mongo:
    container_name: '${MONGO_DOCKER_NAME-mongo_main}'
    image: mongo:8.0.3
    network_mode: bridge
    ports:
      - '${DOCKER_MONGO_PORT:-27017}:27017'
    volumes:
      - '${TMPDIR:-/tmp/mongo}:/db/data'
    healthcheck:
      test: 'bash -c ''mongo --host 127.0.0.1:27017 --eval "printjson(rs.status())"'''
      retries: 5
      interval: 10s

  redis:
    container_name: '${REDIS_DOCKER_NAME-redis_main}'
    image: redis
    network_mode: bridge
    ports:
      - '${DOCKER_REDIS_SERVICE_PORT:-6379}:6379'
    healthcheck:
      test: "bash -c 'redis-cli ping'"
      retries: 5
      interval: 10s

  clickhouse:
    container_name: '${CLICKHOUSE_DOCKER_NAME-clickhouse_main}'
    image: clickhouse/clickhouse-server:24.3-alpine
    network_mode: bridge
    environment:
      - CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1
    ports:
      - '${DOCKER_CLICKHOUSE_HTTP_PORT:-8123}:8123'
      - '${DOCKER_CLICKHOUSE_NATIVE_PORT:-9000}:9000'
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G


### ANALISIS AUTOMATICO (ESPAÑOL) ###

services:
localstack:
container_name: '${LOCALSTACK_DOCKER_NAME-localstack_main}'
image: 'localstack/localstack:0.14.5'
network_mode: bridge
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/.gitignore
Tamaño: 2056 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.idea
.build
# Runtime data
pids
*.pid
*.seed
*.pid.lock

dist
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov


# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea/**/*/workspace.xml
.idea/**/*/tasks.xml
.idea/**/*/dictionaries
.idea/**/*/shelf

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests

.serverless
newrelic_agent.log


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/package.json
Tamaño: 1143 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-api",
  "version": "2.0.0",
  "private": true,
  "main": "dist/index.js",
  "scripts": {
    "build": "node ./check-ee.mjs",
    "build:esm": "node_modules/.bin/tsc -p tsconfig.json",
    "build:watch": "node_modules/.bin/tsc -w -p tsconfig.json",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "lint": "echo 'skip lint in the ci'"
  },
  "dependencies": {
    "@novu/application-generic": "workspace:*",
    "@novu/dal": "workspace:*",
    "@nestjs/swagger": "7.4.0",
    "@novu/shared": "workspace:*",
    "@novu/stateless": "workspace:*",
    "@types/express": "4.17.17",
    "class-validator": "0.14.1",
    "@novu/testing": "workspace:*",
    "express": "^5.0.1"
  },
  "devDependencies": {
    "@nestjs/testing": "10.4.18",
    "@types/chai": "^4.2.11",
    "@types/mocha": "^10.0.8",
    "@types/node": "^20.15.0",
    "@types/sinon": "^9.0.0",
    "chai": "^4.2.0",
    "mocha": "^10.2.0",
    "rxjs": "7.8.1",
    "sinon": "^9.2.4",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-api",
"version": "2.0.0",
"private": true,
"main": "dist/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/project.json
Tamaño: 625 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-api",
  "sourceRoot": "enterprise/packages/api/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/api"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-api",
"sourceRoot": "enterprise/packages/api/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/src
Tamaño: 24 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/api/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/api/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/tsconfig.build.json
Tamaño: 299 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "module": "commonjs",
    "target": "es6",
    "declaration": true,
    "esModuleInterop": false,
    "outDir": "./dist",
    "rootDir": "./src",
    "types": ["node"]
  },
  "include": ["src/**/*"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/api/tsconfig.json
Tamaño: 503 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "allowSyntheticDefaultImports": true,
    "strictNullChecks": true,
    "noImplicitAny": true,
    "outDir": "dist",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "mocha"],
    "skipLibCheck": true,
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"allowSyntheticDefaultImports": true,
"strictNullChecks": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/.gitignore
Tamaño: 2056 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.idea
.build
# Runtime data
pids
*.pid
*.seed
*.pid.lock

dist
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov


# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea/**/*/workspace.xml
.idea/**/*/tasks.xml
.idea/**/*/dictionaries
.idea/**/*/shelf

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests

.serverless
newrelic_agent.log


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/package.json
Tamaño: 1510 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-auth",
  "version": "2.0.14",
  "private": true,
  "main": "dist/index.js",
  "scripts": {
    "build": "node ./check-ee.mjs",
    "build:esm": "node_modules/.bin/tsc -p tsconfig.json",
    "build:watch": "node_modules/.bin/tsc -w -p tsconfig.json",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test": "echo 'skip test in the ci'",
    "test-ee": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file tests/setup.ts src/**/**/*.spec.ts"
  },
  "dependencies": {
    "@clerk/backend": "^1.25.2",
    "@clerk/express": "^1.3.53",
    "@novu/application-generic": "workspace:*",
    "@novu/dal": "workspace:*",
    "@novu/shared": "workspace:*",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "jwks-rsa": "^3.1.0",
    "mongoose": "^7.8.7",
    "svix": "^1.64.1"
  },
  "devDependencies": {
    "@clerk/types": "^4.6.1",
    "@types/mocha": "^8.0.1",
    "@types/node": "^20.15.0",
    "@types/passport-jwt": "^3.0.3",
    "@types/sinon": "^9.0.0",
    "chai": "^4.2.0",
    "cross-env": "^7.0.3",
    "mocha": "^8.1.1",
    "sinon": "^9.2.4",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/jwt": "10.2.0",
    "@nestjs/passport": "10.0.3",
    "@nestjs/swagger": "7.4.0",
    "passport": "0.7.0",
    "passport-jwt": "^4.0.0"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-auth",
"version": "2.0.14",
"private": true,
"main": "dist/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/project.json
Tamaño: 628 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-auth",
  "sourceRoot": "enterprise/packages/auth/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/auth"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-auth",
"sourceRoot": "enterprise/packages/auth/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/src
Tamaño: 25 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/auth/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/auth/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/tsconfig.json
Tamaño: 446 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "allowSyntheticDefaultImports": true,
    "outDir": "dist",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "mocha"],
    "skipLibCheck": true,
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"allowSyntheticDefaultImports": true,
"outDir": "dist",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/auth/tsconfig.spec.json
Tamaño: 162 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "types": ["mocha", "node"],
    "esModuleInterop": false
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"types": ["mocha", "node"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/.gitignore
Tamaño: 2056 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.idea
.build
# Runtime data
pids
*.pid
*.seed
*.pid.lock

dist
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov


# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea/**/*/workspace.xml
.idea/**/*/tasks.xml
.idea/**/*/dictionaries
.idea/**/*/shelf

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests

.serverless
newrelic_agent.log


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/package.json
Tamaño: 1719 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-billing",
  "version": "2.0.20",
  "private": true,
  "main": "dist/index.js",
  "scripts": {
    "start": "npm run build:watch",
    "build": "node ./check-ee.mjs",
    "build:esm": "node_modules/.bin/tsc -p tsconfig.json",
    "build:watch": "node_modules/.bin/tsc -w -p tsconfig.json",
    "test": "echo 'skip test in the ci'",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test-ee": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file tests/setup.ts src/**/**/*.spec.ts",
    "start:proxy": "ngrok http http://localhost:3000"
  },
  "dependencies": {
    "@date-fns/utc": "^2.1.0",
    "@novu/application-generic": "workspace:*",
    "@novu/ee-dal": "workspace:*",
    "@novu/ee-auth": "workspace:*",
    "@novu/shared": "workspace:*",
    "@novu/notifications": "workspace:*",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "date-fns": "^4.1.0",
    "mongoose": "^7.8.7",
    "rxjs": "7.8.1",
    "shortid": "^2.2.16",
    "stripe": "^11.18.0",
    "stripe-event-types": "^3.1.0"
  },
  "devDependencies": {
    "@types/chai": "^4.2.11",
    "@types/mocha": "^8.0.1",
    "@types/node": "^20.15.0",
    "@types/sinon": "^9.0.0",
    "chai": "^4.2.0",
    "cross-env": "^7.0.3",
    "mocha": "^8.1.1",
    "sinon": "^9.2.4",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/jwt": "10.2.0",
    "@nestjs/platform-express": "10.4.18",
    "@nestjs/swagger": "7.4.0",
    "@nestjs/throttler": "6.2.1",
    "@novu/dal": "workspace:*"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-billing",
"version": "2.0.20",
"private": true,
"main": "dist/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/project.json
Tamaño: 668 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-billing",
  "sourceRoot": "enterprise/packages/billing/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "dependsOn": ["^build"],
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/billing"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-billing",
"sourceRoot": "enterprise/packages/billing/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/src
Tamaño: 28 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/billing/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/billing/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/tsconfig.json
Tamaño: 463 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "allowSyntheticDefaultImports": true,
    "outDir": "dist",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "mocha", "chai", "sinon"],
    "skipLibCheck": true,
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"allowSyntheticDefaultImports": true,
"outDir": "dist",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/billing/tsconfig.spec.json
Tamaño: 162 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "types": ["mocha", "node"],
    "esModuleInterop": false
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"types": ["mocha", "node"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/.dockerignore
Tamaño: 13 bytes
Lenguaje detectado: DOCKERIGNORE

### CONTENIDO ORIGINAL ###

node_modules


### ANALISIS AUTOMATICO (ESPAÑOL) ###

node_modules
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/.gitignore
Tamaño: 1885 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###


### Node template
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea


# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests


### ANALISIS AUTOMATICO (ESPAÑOL) ###

### Node template
# Logs
logs
*.log
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
# Coverage directory used by tools like istanbul
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/package.json
Tamaño: 981 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-dal",
  "version": "2.0.5",
  "description": "",
  "private": true,
  "scripts": {
    "start": "npm run build:watch",
    "afterinstall": "pnpm build",
    "prebuild": "rimraf dist",
    "build": "node ./check-ee.mjs",
    "build:esm": "cross-env node_modules/.bin/tsc -p tsconfig.build.json",
    "build:watch": "cross-env node_modules/.bin/tsc -p tsconfig.build.json -w --preserveWatchOutput",
    "precommit": "lint-staged",
    "test": "echo 'skip test in the ci'",
    "lint": "echo 'skip lint in the ci'"
  },
  "author": "",
  "license": "ISC",
  "main": "dist/index.js",
  "dependencies": {
    "@novu/dal": "workspace:*",
    "@novu/shared": "workspace:*",
    "mongoose": "^7.8.7",
    "mongoose-delete": "^1.0.1",
    "rimraf": "^3.0.2"
  },
  "devDependencies": {
    "@types/node": "^20.15.0",
    "ts-node": "~10.9.1",
    "tsconfig-paths": "~4.1.0",
    "typescript": "5.6.2"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-dal",
"version": "2.0.5",
"description": "",
"private": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/project.json
Tamaño: 656 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-dal",
  "sourceRoot": "enterprise/packages/dal/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "dependsOn": ["^build"],
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/dal"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-dal",
"sourceRoot": "enterprise/packages/dal/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/src
Tamaño: 24 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/dal/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/dal/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/tsconfig.build.json
Tamaño: 299 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "module": "commonjs",
    "target": "es6",
    "declaration": true,
    "esModuleInterop": false,
    "outDir": "./dist",
    "rootDir": "./src",
    "types": ["node"]
  },
  "include": ["src/**/*"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/dal/tsconfig.json
Tamaño: 151 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "types": ["node"],
    "esModuleInterop": true
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"types": ["node"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/.czrc
Tamaño: 42 bytes
Lenguaje detectado: CZRC

### CONTENIDO ORIGINAL ###

{
  "path": "cz-conventional-changelog"
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"path": "cz-conventional-changelog"
}
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/.gitignore
Tamaño: 87 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

.idea/*
.nyc_output
build
node_modules
test
src/**.js
coverage
*.log
package-lock.json


### ANALISIS AUTOMATICO (ESPAÑOL) ###

.idea/*
.nyc_output
build
node_modules
test
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/README.md
Tamaño: 122 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

# Shared services

Generic service used inside of Novu's different services - can not be depended on application-generic.


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Shared services
Generic service used inside of Novu's different services - can not be depended on application-generic.
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/package.json
Tamaño: 1615 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-shared-services",
  "version": "2.0.5",
  "description": "Generic service used inside of Novu's different services - can not be depended on application-generic",
  "main": "build/main/index.js",
  "typings": "build/main/index.d.ts",
  "module": "build/module/index.js",
  "private": true,
  "repository": {
    "url": "https://github.com/novuhq/novu",
    "directory": "packages/nest"
  },
  "license": "MIT",
  "keywords": [],
  "scripts": {
    "start": "npm run build:watch",
    "prebuild": "rimraf build",
    "build": "node ./check-ee.mjs",
    "build:main": "tsc -p tsconfig.json",
    "build:esm": "tsc -p tsconfig.json",
    "build:watch": "tsc -w -p tsconfig.json",
    "fix": "run-s fix:*",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "watch:build": "tsc -p tsconfig.json -w",
    "watch:test": "jest src --watch",
    "reset-hard": "git clean -dfx && git reset --hard && pnpm install",
    "prepare-release": "run-s reset-hard test",
    "test-ee": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file tests/setup.ts src/**/**/*.spec.ts"
  },
  "dependencies": {
    "@handlebars/parser": "^2.1.0",
    "@novu/ee-dal": "workspace:*",
    "@novu/shared": "workspace:*"
  },
  "devDependencies": {
    "@types/node": "^20.15.0",
    "cross-env": "^7.0.3",
    "npm-run-all": "^4.1.5",
    "sinon": "^9.2.4",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@novu/dal": "workspace:*"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-shared-services",
"version": "2.0.5",
"description": "Generic service used inside of Novu's different services - can not be depended on application-generic",
"main": "build/main/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/project.json
Tamaño: 661 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-shared-services",
  "sourceRoot": "enterprise/packages/shared-services/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/build", "{projectRoot}/dist", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/shared-services"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-shared-services",
"sourceRoot": "enterprise/packages/shared-services/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/src
Tamaño: 36 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/shared-services/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/shared-services/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/tsconfig.json
Tamaño: 383 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "allowSyntheticDefaultImports": true,
    "outDir": "build/main",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "jest"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"allowSyntheticDefaultImports": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/shared-services/tsconfig.module.json
Tamaño: 302 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "./tsconfig",
  "compilerOptions": {
    "target": "esnext",
    "outDir": "build/module",
    "module": "esnext",
    "esModuleInterop": true,
    "types": ["node", "jest"],
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "./tsconfig",
"compilerOptions": {
"target": "esnext",
"outDir": "build/module",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/.gitignore
Tamaño: 2056 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.idea
.build
# Runtime data
pids
*.pid
*.seed
*.pid.lock

dist
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov


# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea/**/*/workspace.xml
.idea/**/*/tasks.xml
.idea/**/*/dictionaries
.idea/**/*/shelf

# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests

.serverless
newrelic_agent.log


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
*.log
npm-debug.log*
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/check-ee.mjs
Tamaño: 1421 bytes
Lenguaje detectado: MJS

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';

const dirname = path.dirname(fileURLToPath(import.meta.url));

const ROOT_PATH = path.resolve(dirname);
const ENCODING_TYPE = 'utf8';
const NEW_LINE_CHAR = '\n';

class CliLogs {
  constructor() {
    this._logs = [];
    this.log = this.log.bind(this);
  }

  log(log) {
    const cleanLog = log.trim();
    if (cleanLog.length) {
      this._logs.push(cleanLog);
    }
  }

  get logs() {
    return this._logs;
  }

  get joinedLogs() {
    return this.logs.join(NEW_LINE_CHAR);
  }
}

function pnpmRun(...args) {
  const logData = new CliLogs();
  let pnpmProcess;

  return new Promise((resolve, reject) => {
    const processOptions = {
      cwd: ROOT_PATH,
      env: process.env,
    };

    pnpmProcess = spawn('pnpm', args, processOptions);

    pnpmProcess.stdin.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.setEncoding(ENCODING_TYPE);
    pnpmProcess.stderr.setEncoding(ENCODING_TYPE);
    pnpmProcess.stdout.on('data', logData.log);
    pnpmProcess.stderr.on('data', logData.log);

    pnpmProcess.on('close', (code) => {
      if (code !== 0) {
        reject(logData.joinedLogs);
      } else {
        resolve(logData.joinedLogs);
      }
    });
  });
}

const hasSrcFolder = fs.existsSync(path.resolve(ROOT_PATH, 'src'));
if (hasSrcFolder) {
  await pnpmRun('build:esm');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import fs from 'node:fs';
import spawn from 'cross-spawn';
import path from 'path';
import { fileURLToPath } from 'url';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/package.json
Tamaño: 1652 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-translation",
  "version": "2.0.14",
  "private": true,
  "main": "dist/index.js",
  "scripts": {
    "start": "npm run build:watch",
    "build": "node ./check-ee.mjs",
    "build:esm": "node_modules/.bin/tsc -p tsconfig.json",
    "build:watch": "node_modules/.bin/tsc -w -p tsconfig.json",
    "test": "echo 'skip test in the ci'",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test-ee": "cross-env TS_NODE_COMPILER_OPTIONS='{\"strictNullChecks\": false}' NODE_ENV=test mocha --timeout 10000 --require ts-node/register --exit --file tests/setup.ts src/**/**/*.spec.ts"
  },
  "dependencies": {
    "@handlebars/parser": "^2.1.0",
    "@novu/application-generic": "workspace:*",
    "@novu/ee-auth": "workspace:*",
    "@novu/ee-dal": "workspace:*",
    "@novu/ee-shared-services": "workspace:*",
    "@novu/shared": "workspace:*",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "deep-object-diff": "^1.1.9",
    "i18next": "^23.7.11",
    "lodash": "^4.17.15",
    "multer": "^2.0.0",
    "shortid": "^2.2.16"
  },
  "devDependencies": {
    "@types/chai": "^4.2.11",
    "@types/lodash": "^4.17.7",
    "@types/mocha": "^8.0.1",
    "@types/multer": "^1.4.12",
    "@types/node": "^20.15.0",
    "@types/sinon": "^9.0.0",
    "chai": "^4.2.0",
    "cross-env": "^7.0.3",
    "mocha": "^8.1.1",
    "sinon": "^9.2.4",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2",
    "liquidjs": "^10.20.1"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@nestjs/platform-express": "10.4.18",
    "@nestjs/swagger": "7.4.0",
    "@novu/dal": "workspace:*"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-translation",
"version": "2.0.14",
"private": true,
"main": "dist/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/project.json
Tamaño: 680 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/ee-translation",
  "sourceRoot": "enterprise/packages/translation/src",
  "projectType": "library",
  "targets": {
    "build": {
      "cache": false,
      "dependsOn": ["^build"],
      "inputs": [
        "default",
        "{projectRoot}/**/*",
        "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
        "!{projectRoot}/tsconfig.spec.json",
        "!{projectRoot}/jest.config.[jt]s"
      ],
      "outputs": ["{projectRoot}/dist", "{projectRoot}/build", "{projectRoot}/lib"]
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint enterprise/packages/translation"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/ee-translation",
"sourceRoot": "enterprise/packages/translation/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/src
Tamaño: 32 bytes
Lenguaje detectado: SRC

### CONTENIDO ORIGINAL ###

../../../.source/translation/src

### ANALISIS AUTOMATICO (ESPAÑOL) ###

../../../.source/translation/src
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/tsconfig.json
Tamaño: 463 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "allowSyntheticDefaultImports": true,
    "outDir": "dist",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "mocha", "chai", "sinon"],
    "skipLibCheck": true,
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"allowSyntheticDefaultImports": true,
"outDir": "dist",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/packages/translation/tsconfig.spec.json
Tamaño: 162 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": false,
    "types": ["mocha", "node"],
    "esModuleInterop": false
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": false,
"types": ["mocha", "node"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/.editorconfig
Tamaño: 185 bytes
Lenguaje detectado: EDITORCONFIG

### CONTENIDO ORIGINAL ###

# http://editorconfig.org
root = true

[*]
indent_style = tab
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.yml]
indent_style = space


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# http://editorconfig.org
root = true
[*]
indent_style = tab
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/.gitignore
Tamaño: 2092 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# Logs

logs
_.log
npm-debug.log_
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.pnpm-debug.log*

# Diagnostic reports (https://nodejs.org/api/report.html)

report.[0-9]_.[0-9]_.[0-9]_.[0-9]_.json

# Runtime data

pids
_.pid
_.seed
\*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover

lib-cov

# Coverage directory used by tools like istanbul

coverage
\*.lcov

# nyc test coverage

.nyc_output

# Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)

.grunt

# Bower dependency directory (https://bower.io/)

bower_components

# node-waf configuration

.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)

build/Release

# Dependency directories

node_modules/
jspm_packages/

# Snowpack dependency directory (https://snowpack.dev/)

web_modules/

# TypeScript cache

\*.tsbuildinfo

# Optional npm cache directory

.npm

# Optional stylelint cache

.stylelintcache

# Microbundle cache

.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/

# Optional REPL history

.node_repl_history

# Output of 'npm pack'

\*.tgz

# Yarn Integrity file

.yarn-integrity

# dotenv environment variable files

.env
.env.development.local
.env.test.local
.env.production.local
.env.local

# parcel-bundler cache (https://parceljs.org/)

.cache
.parcel-cache

# Next.js build output

.next
out

# Nuxt.js build / generate output

.nuxt
dist

# Gatsby files

.cache/

# Comment in the public line in if your project uses Gatsby and not Next.js

# https://nextjs.org/blog/next-9-1#public-directory-support

# public

# vuepress build output

.vuepress/dist

# vuepress v2.x temp and cache directory

.temp
.cache

# Docusaurus cache and generated files

.docusaurus

# Serverless directories

.serverless/

# FuseBox cache

.fusebox/

# DynamoDB Local files

.dynamodb/

# TernJS port file

.tern-port

# Stores VSCode versions used for testing VSCode extensions

.vscode-test

# yarn v2

.yarn/cache
.yarn/unplugged
.yarn/build-state.yml
.yarn/install-state.gz
.pnp.\*

# wrangler project

.dev.vars
.wrangler/


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Logs
logs
_.log
npm-debug.log_
# Diagnostic reports (https://nodejs.org/api/report.html)
# Runtime data
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/package.json
Tamaño: 772 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/socket-worker",
  "version": "0.0.1",
  "private": true,
  "scripts": {
    "deploy": "wrangler deploy",
    "dev": "wrangler dev",
    "start": "wrangler dev",
    "cf-typegen": "wrangler types",
    "deploy:staging": "wrangler deploy --env staging",
    "deploy:production-us": "wrangler deploy --env production-us",
    "deploy:production-eu": "wrangler deploy --env production-eu",
    "deploy:local": "wrangler deploy --env local"
  },
  "devDependencies": {
    "@cloudflare/workers-types": "^4.20250620.0",
    "typescript": "^5.5.2",
    "wrangler": "^4.20.5"
  },
  "dependencies": {
    "@tsndr/cloudflare-worker-jwt": "^3.2.0",
    "@types/jsonwebtoken": "^8.5.9",
    "hono": "^4.8.2",
    "jsonwebtoken": "9.0.0",
    "ws": "^8.18.0"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/socket-worker",
"version": "0.0.1",
"private": true,
"scripts": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/tsconfig.json
Tamaño: 1559 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "compilerOptions": {
    /* Visit https://aka.ms/tsconfig.json to read more about this file */

    /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */
    "target": "es2021",
    /* Specify a set of bundled library declaration files that describe the target runtime environment. */
    "lib": ["es2021"],
    /* Specify what JSX code is generated. */
    "jsx": "react-jsx",

    /* Specify what module code is generated. */
    "module": "es2022",
    /* Specify how TypeScript looks up a file from a given module specifier. */
    "moduleResolution": "node",
    /* Enable importing .json files */
    "resolveJsonModule": true,

    /* Allow JavaScript files to be a part of your program. Use the `checkJS` option to get errors from these files. */
    "allowJs": true,
    /* Enable error reporting in type-checked JavaScript files. */
    "checkJs": false,

    /* Disable emitting files from a compilation. */
    "noEmit": true,

    /* Ensure that each file can be safely transpiled without relying on other imports. */
    "isolatedModules": true,
    /* Allow 'import x from y' when a module doesn't have a default export. */
    "allowSyntheticDefaultImports": true,
    /* Ensure that casing is correct in imports. */
    "forceConsistentCasingInFileNames": true,

    /* Enable all strict type-checking options. */
    "strict": true,

    /* Skip type checking all .d.ts files. */
    "skipLibCheck": true,
    "types": ["@cloudflare/workers-types", "./worker-configuration"]
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"compilerOptions": {
/* Visit https://aka.ms/tsconfig.json to read more about this file */
/* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */
/* Specify a set of bundled library declaration files that describe the target runtime environment. */
/* Specify what JSX code is generated. */
/* Specify what module code is generated. */
/* Specify how TypeScript looks up a file from a given module specifier. */
/* Enable importing .json files */
/* Allow JavaScript files to be a part of your program. Use the `checkJS` option to get errors from these files. */
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/worker-configuration.d.ts
Tamaño: 492 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * Cloudflare Workers type augmentation for socket worker
 *
 * This file extends the base Cloudflare Workers types with custom environment bindings.
 * The base types are provided by @cloudflare/workers-types package.
 */

declare namespace Cloudflare {
	interface Env {
		/**
		 * Durable Object namespace for WebSocket rooms
		 */
		WEBSOCKET_ROOM: DurableObjectNamespace<import('./src/index').WebSocketRoom>;

		/**
		 * JWT secret for authentication
		 */
		JWT_SECRET: string;
	}
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/wrangler.jsonc
Tamaño: 2504 bytes
Lenguaje detectado: JSONC

### CONTENIDO ORIGINAL ###

/**
 * For more details on how to configure Wrangler, refer to:
 * https://developers.cloudflare.com/workers/wrangler/configuration/
 */
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "socket-worker",
  "main": "src/index.ts",
  "compatibility_date": "2025-06-20",
  "migrations": [
    {
      "new_sqlite_classes": ["WebSocketRoom"],
      "tag": "v1"
    }
  ],
  "observability": {
    "enabled": true
  },
  "env": {
    "local": {
      "name": "socket-worker-local",
      "workers_dev": true,
      "durable_objects": {
        "bindings": [
          {
            "class_name": "WebSocketRoom",
            "name": "WEBSOCKET_ROOM"
          }
        ]
      },
      "vars": {
        "NODE_ENV": "staging",
        "API_URL": "https://fa3f-46-117-110-24.ngrok-free.app",
        "REGION": "global"
      }
    },
    "staging": {
      "name": "socket-worker-staging",
      "routes": [
        {
          "pattern": "socket.novu-staging.co",
          "custom_domain": true
        }
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "WebSocketRoom",
            "name": "WEBSOCKET_ROOM"
          }
        ]
      },
      "vars": {
        "NODE_ENV": "staging",
        "API_URL": "https://api.novu-staging.co",
        "REGION": "global"
      }
    },
    "production-us": {
      "name": "socket-worker-production-us",
      "routes": [
        {
          "pattern": "socket.novu.co",
          "custom_domain": true
        }
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "WebSocketRoom",
            "name": "WEBSOCKET_ROOM"
          }
        ]
      },
      "vars": {
        "NODE_ENV": "production",
        "API_URL": "https://api.novu.co",
        "REGION": "global"
      }
    },
    "production-eu": {
      "name": "socket-worker-production-eu",
      "routes": [
        {
          "pattern": "eu.socket.novu.co",
          "custom_domain": true
        }
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "WebSocketRoom",
            "name": "WEBSOCKET_ROOM"
          }
        ]
      },
      "vars": {
        "NODE_ENV": "production",
        "API_URL": "https://eu.api.novu.co",
        "REGION": "eu"
      }
    }
  }
  /**
   * Smart Placement
   * Docs: https://developers.cloudflare.com/workers/configuration/smart-placement/#smart-placement
   */
  // "placement": { "mode": "smart" },
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

/**
* For more details on how to configure Wrangler, refer to:
* https://developers.cloudflare.com/workers/wrangler/configuration/
*/
{
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/.vscode/settings.json
Tamaño: 63 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "files.associations": {
    "wrangler.json": "jsonc"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"files.associations": {
"wrangler.json": "jsonc"
}
}
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/index.ts
Tamaño: 809 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Hono } from 'hono';
import { WebSocketRoom } from './durable-objects/websocket-room';
import { handleSendMessage, handleWebSocketUpgrade } from './handlers/websocket';
import { authenticateJWT } from './middleware/auth';
import { authenticateInternalAPI } from './middleware/internal-auth';
import type { IEnv } from './types';

const app = new Hono<{ Bindings: IEnv }>();

app.get('/', authenticateJWT, handleWebSocketUpgrade);

app.post('/send', authenticateInternalAPI, handleSendMessage);

app.get('/health', (context) => context.text('OK'));

app.notFound((context) => context.text('Not found', 404));

app.onError((err, context) => {
  console.error('Application error:', err);

  return context.json({ error: 'Internal server error' }, 500);
});

export { WebSocketRoom };
export default app;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - app(new Hono<{ Bindings: IEnv }>();

app.get('/', authenticateJWT, handleWebSocketUpgrade);

app.post('/...)
Declaraciones 'export' encontradas:
- export
- export default  app

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/durable-objects/websocket-room.ts
Tamaño: 10882 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DurableObject } from 'cloudflare:workers';
import type { IConnectionMetadata, IEnv } from '../types';

/**
 * WebSocket Room Durable Object with Hibernation Support
 * Manages WebSocket connections for subscribers with JWT authentication
 */
export class WebSocketRoom extends DurableObject<IEnv> {
  private static readonly MAX_CONNECTIONS = 100;

  /**
   * Constructor - called when DO is instantiated or wakes from hibernation
   * No need to store JWT tokens in memory as they're persisted with serializeAttachment
   */
  constructor(ctx: DurableObjectState, env: IEnv) {
    super(ctx, env);

    this.ctx.setWebSocketAutoResponse(new WebSocketRequestResponsePair('ping', 'pong'));
  }

  /**
   * Handle incoming HTTP requests (WebSocket upgrades)
   */
  async fetch(request: Request): Promise<Response> {
    if (request.headers.get('Upgrade') !== 'websocket') {
      return new Response('Expected WebSocket upgrade', { status: 426 });
    }

    // Check connection limit before accepting new connections
    const currentConnections = this.ctx.getWebSockets().length;
    if (currentConnections >= WebSocketRoom.MAX_CONNECTIONS) {
      return new Response('WebSocket room at capacity', {
        status: 503,
        headers: {
          'Retry-After': '60',
        },
      });
    }

    const userId = request.headers.get('X-User-Id');
    const environmentId = request.headers.get('X-Environment-Id');
    const jwtToken = request.headers.get('X-JWT-Token');

    if (!userId || !environmentId) {
      return new Response('Missing required user information', { status: 400 });
    }

    if (!jwtToken) {
      return new Response('Missing JWT token', { status: 400 });
    }

    const contextKeys = this.extractContextKeysFromHeader(request);

    const [client, server] = Object.values(new WebSocketPair());

    /*
     * Use hibernation-compatible WebSocket acceptance
     * Store JWT token separately to avoid tag size limitations
     */
    const tags = [`user:${userId}`, `env:${environmentId}`];

    this.ctx.acceptWebSocket(server, tags);

    // Persist JWT token with the WebSocket connection to survive hibernation
    // The attachment is limited to 2KB, but a JWT token is typically < 1KB
    server.serializeAttachment({
      jwtToken,
      connectedAt: Date.now(),
      contextKeys,
    });

    // Use waitUntil to allow hibernation without waiting for API call
    this.ctx.waitUntil(
      this.notifySubscriberOnlineState(userId, environmentId, true, undefined, jwtToken).catch((error) =>
        console.error('Failed to notify subscriber online state:', error)
      )
    );

    return new Response(null, {
      status: 101,
      webSocket: client,
    });
  }

  /**
   * Handle WebSocket messages (called automatically by Cloudflare runtime)
   */
  async webSocketMessage(ws: WebSocket): Promise<void> {
    const metadata = this.getConnectionMetadata(ws);

    if (!metadata) {
      ws.close(1008, 'Connection metadata not found');
    }
  }

  /**
   * Handle WebSocket connection close (called automatically by Cloudflare runtime)
   */
  async webSocketClose(ws: WebSocket, code: number, reason: string): Promise<void> {
    ws.close(code, reason);

    const metadata = this.getConnectionMetadata(ws);

    if (metadata) {
      this.handleSubscriberDisconnection(metadata);
    }

    // No need to delete from connectionTokens - using serializeAttachment instead
  }

  /**
   * Handle WebSocket errors (called automatically by Cloudflare runtime)
   */
  async webSocketError(ws: WebSocket, error: unknown): Promise<void> {
    console.error('WebSocket error:', error);
    const metadata = this.getConnectionMetadata(ws);

    if (metadata) {
      console.log(`WebSocket error for subscriber: ${metadata.userId}`);
    }

    // No need to delete from connectionTokens - using serializeAttachment instead
  }

  /**
   * Send message to a specific user
   */
  async sendToUser(userId: string, event: string, data: unknown, contextKeys?: string[]): Promise<void> {
    const userConnections = this.ctx.getWebSockets(`user:${userId}`);

    if (userConnections.length === 0) {
      return;
    }

    // Pre-serialize the message once to avoid repeated JSON.stringify calls
    const message = JSON.stringify({
      event,
      data,
      timestamp: Date.now(),
    });

    if (this.isFeatureFlagOff(contextKeys)) {
      await this.broadcastToAllSockets(userId, message, userConnections);
    } else {
      await this.sendToMatchingContexts(userId, message, contextKeys, userConnections);
    }
  }

  /**
   * Context matching logic (same as ws.gateway.ts)
   */
  private isExactMatch(messageContextKeys: string[], inboxContextKeys?: string[]): boolean {
    if (inboxContextKeys === undefined) {
      return true;
    }

    if (messageContextKeys.length === 0) {
      return inboxContextKeys.length === 0;
    }

    if (messageContextKeys.length !== inboxContextKeys.length) {
      return false;
    }

    return messageContextKeys.every((key) => inboxContextKeys.includes(key));
  }

  /**
   * Get active connection count for a user
   */
  getActiveConnectionsForUser(userId: string): number {
    return this.ctx.getWebSockets(`user:${userId}`).length;
  }

  /**
   * Get total active connections in this room
   */
  getTotalActiveConnections(): number {
    return this.ctx.getWebSockets().length;
  }

  /**
   * Get connection capacity information
   */
  getConnectionCapacity(): { current: number; max: number; available: number } {
    const current = this.getTotalActiveConnections();
    const max = WebSocketRoom.MAX_CONNECTIONS;
    const available = max - current;

    return { current, max, available };
  }

  /**
   * Notify the API about subscriber online state changes
   */
  private async notifySubscriberOnlineState(
    subscriberId: string,
    environmentId: string,
    isOnline: boolean,
    organizationId?: string,
    jwtToken?: string
  ): Promise<void> {
    const apiUrl = this.env.API_URL;

    if (!apiUrl) {
      console.warn('API_URL not configured, skipping online state notification');

      return;
    }

    if (!jwtToken) {
      console.warn('JWT token not available, skipping online state notification');

      return;
    }

    try {
      const response = await fetch(`${apiUrl}/v1/internal/subscriber-online-state`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${jwtToken}`,
        },
        body: JSON.stringify({
          subscriberId,
          environmentId,
          isOnline,
          organizationId,
          timestamp: Date.now(),
        }),
      });

      if (!response.ok) {
        console.error(`Failed to notify API about subscriber online state: ${response.status} ${response.statusText}`);
      }
    } catch (error) {
      console.error(`Error notifying API about subscriber online state:`, error);
    }
  }

  private getConnectionMetadata(ws: WebSocket): IConnectionMetadata | null {
    const tags = this.ctx.getTags(ws);

    // Retrieve persisted attachment data that survived hibernation
    const attachment = ws.deserializeAttachment();

    if (!attachment || typeof attachment !== 'object' || !('jwtToken' in attachment)) {
      return null;
    }

    let userId: string | undefined;
    let environmentId: string | undefined;

    for (const tag of tags) {
      if (tag.startsWith('user:')) {
        userId = tag.substring(5);
      } else if (tag.startsWith('env:')) {
        environmentId = tag.substring(4);
      }
    }

    if (!userId || !environmentId) {
      return null;
    }

    return {
      userId,
      environmentId,
      connectedAt: attachment.connectedAt || Date.now(),
      jwtToken: attachment.jwtToken,
      contextKeys: attachment.contextKeys,
    };
  }

  private handleSubscriberDisconnection(metadata: IConnectionMetadata): void {
    const activeConnections = this.getActiveConnectionsForUser(metadata.userId);

    const remainingConnections = activeConnections - 1;

    if (remainingConnections <= 0) {
      // Use waitUntil to allow hibernation without waiting for API call
      this.ctx.waitUntil(
        this.notifySubscriberOnlineState(
          metadata.userId,
          metadata.environmentId,
          false,
          undefined,
          metadata.jwtToken
        ).catch((error) => console.error('Failed to notify subscriber offline state:', error))
      );
    }
  }

  private extractContextKeysFromHeader(request: Request): string[] | undefined {
    const contextKeysHeader = request.headers.get('X-Context-Keys');

    if (!contextKeysHeader) {
      return undefined;
    }

    try {
      return JSON.parse(contextKeysHeader);
    } catch (e) {
      console.error('Failed to parse contextKeys:', e);

      return undefined;
    }
  }

  /**
   * Check if feature flag is OFF (contextKeys is undefined)
   */
  private isFeatureFlagOff(contextKeys?: string[]): boolean {
    return contextKeys === undefined;
  }

  /**
   * Broadcast message to all user connections (FF OFF behavior)
   */
  private async broadcastToAllSockets(userId: string, message: string, sockets: WebSocket[]): Promise<void> {
    const sendPromises = sockets.map(async (ws) => {
      try {
        ws.send(message);
      } catch (error) {
        console.error(`Failed to send message to user ${userId}:`, error);
        throw error;
      }
    });

    await Promise.allSettled(sendPromises);
  }

  /**
   * Send message only to sockets with matching contexts (FF ON behavior)
   */
  private async sendToMatchingContexts(
    userId: string,
    message: string,
    messageContextKeys: string[] | undefined,
    sockets: WebSocket[]
  ): Promise<void> {
    if (!messageContextKeys) {
      return;
    }

    const sendPromises = sockets.map(async (ws) => {
      const metadata = this.getConnectionMetadata(ws);

      if (!metadata) {
        return;
      }

      const inboxContextKeys = metadata.contextKeys;

      if (this.shouldDeliverMessage(messageContextKeys, inboxContextKeys)) {
        await this.deliverMessageToSocket(ws, message, userId, inboxContextKeys);
      }
    });

    await Promise.allSettled(sendPromises);
  }

  /**
   * Determine if message should be delivered based on context match
   */
  private shouldDeliverMessage(messageContextKeys: string[], inboxContextKeys?: string[]): boolean {
    return this.isExactMatch(messageContextKeys, inboxContextKeys);
  }

  /**
   * Deliver message to a specific socket
   */
  private async deliverMessageToSocket(
    ws: WebSocket,
    message: string,
    userId: string,
    _inboxContextKeys?: string[]
  ): Promise<void> {
    try {
      ws.send(message);
    } catch (error) {
      console.error(`Failed to send message to user ${userId}:`, error);
      throw error;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - tags([`user:${userId}`, `env:${environmentId}`];

    this.ctx.acceptWebSocket(server, tags);

    // Per...)
 - sendPromises(sockets.map(async (ws))
 - sendPromises(sockets.map(async (ws))
Declaraciones 'export' encontradas:
- export class WebSocketRoom

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/handlers/websocket.ts
Tamaño: 3070 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { Context } from 'hono';

export async function handleWebSocketUpgrade(context: Context) {
  const userId = context.get('userId');
  const subscriberId = context.get('subscriberId');
  const organizationId = context.get('organizationId');
  const environmentId = context.get('environmentId');
  const contextKeys = context.get('contextKeys');

  // Extract JWT token from query parameter
  const jwtToken = context.req.query('token');

  const roomId = `${environmentId}:${userId}`;

  // Apply EU jurisdiction if REGION is set to "eu"
  const region = context.env.REGION;
  const namespace = region === 'eu' ? context.env.WEBSOCKET_ROOM.jurisdiction('eu') : context.env.WEBSOCKET_ROOM;

  const id = namespace.idFromName(roomId);
  const stub = namespace.get(id);

  // Forward the request to the Durable Object with user info and JWT token
  const requestWithUserInfo = new Request(context.req.raw.url, {
    method: context.req.method,
    headers: {
      ...Object.fromEntries(context.req.raw.headers.entries()),
      'X-User-Id': userId,
      'X-Subscriber-Id': subscriberId,
      'X-Organization-Id': organizationId,
      'X-Environment-Id': environmentId,
      'X-JWT-Token': jwtToken || '',
      'X-Context-Keys': contextKeys !== undefined ? JSON.stringify(contextKeys) : '',
    },
    body: context.req.raw.body,
  });

  return stub.fetch(requestWithUserInfo);
}

// Send message handler - Protected by internal API key authentication
export async function handleSendMessage(context: Context) {
  try {
    const { userId, event, data, environmentId, contextKeys } = await context.req.json();

    // Validate required fields
    if (!userId || !event) {
      return context.json({ error: 'Missing required fields: userId and event' }, 400);
    }

    if (!environmentId) {
      return context.json({ error: 'Missing required field: environmentId' }, 400);
    }

    // Validate field types
    if (typeof userId !== 'string' || typeof event !== 'string' || typeof environmentId !== 'string') {
      return context.json({ error: 'Invalid field types: userId, event, and environmentId must be strings' }, 400);
    }

    // Create room ID based on environment and user
    const roomId = `${environmentId}:${userId}`;

    console.log(
      `[Internal API] Routing message to room: ${roomId} for user: ${userId}, event: ${event}, contextKeys: ${contextKeys}`
    );

    /*
     * Get the Durable Object instance for the appropriate room
     * Apply EU jurisdiction if REGION is set to "eu"
     */
    const region = context.env.REGION;
    const namespace = region === 'eu' ? context.env.WEBSOCKET_ROOM.jurisdiction('eu') : context.env.WEBSOCKET_ROOM;

    const id = namespace.idFromName(roomId);
    const stub = namespace.get(id);

    await stub.sendToUser(userId, event, data, contextKeys);

    return context.json({ success: true, roomId, timestamp: new Date().toISOString() });
  } catch (error) {
    console.error('Error sending message:', error);

    return context.json({ error: 'Internal server error' }, 500);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - handleWebSocketUpgrade(context: Context)
 - handleSendMessage(context: Context)
Declaraciones 'export' encontradas:
- export  async
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/middleware/auth.ts
Tamaño: 1951 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import jwt from '@tsndr/cloudflare-worker-jwt';
import type { Context, Next } from 'hono';

export async function verifyJWT(token: string, secret: string): Promise<boolean> {
  try {
    const result = await jwt.verify(token, secret);

    return !!result;
  } catch {
    return false;
  }
}

export function decodeJWT(token: string): any {
  try {
    return jwt.decode(token);
  } catch {
    return null;
  }
}

export async function authenticateJWT(context: Context, next: Next) {
  const token = context.req.query('token');

  if (!token) {
    return context.json({ error: 'Unauthorized: Missing token query parameter' }, 401);
  }

  try {
    const isValid = await verifyJWT(token, context.env.JWT_SECRET);
    if (!isValid) {
      return context.json({ error: 'Unauthorized: Invalid JWT token' }, 401);
    }

    const payload = decodeJWT(token);
    if (!payload || !payload.payload) {
      return context.json({ error: 'Unauthorized: Invalid JWT payload' }, 401);
    }

    // Extract user information from JWT payload
    const userPayload = payload.payload;
    const userId = userPayload._id;
    const subscriberId = userPayload.subscriberId || userId;
    const { organizationId, environmentId } = userPayload;
    const contextKeys = userPayload.contextKeys;

    if (!userId || !subscriberId || !organizationId || !environmentId) {
      return context.json({ error: 'Unauthorized: Missing required user information in JWT' }, 401);
    }

    // Store user info in context
    context.set('userPayload', userPayload);
    context.set('userId', userId);
    context.set('subscriberId', subscriberId);
    context.set('organizationId', organizationId);
    context.set('environmentId', environmentId);
    context.set('contextKeys', contextKeys);

    await next();
  } catch (error) {
    console.error('JWT verification failed:', error);

    return context.json({ error: 'Unauthorized: JWT verification failed' }, 401);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - verifyJWT(token: string, secret: string)
 - decodeJWT(token: string)
 - authenticateJWT(context: Context, next: Next)
Declaraciones 'export' encontradas:
- export  async
- export function decodeJWT
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/middleware/internal-auth.ts
Tamaño: 1034 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { Context, Next } from 'hono';

export async function authenticateInternalAPI(context: Context, next: Next) {
  const authHeader = context.req.header('Authorization');

  const providedKey = authHeader?.replace('Bearer ', '');

  if (!providedKey) {
    return context.json({ error: 'Unauthorized: Missing API key' }, 401);
  }

  const validApiKey = context.env.INTERNAL_API_KEY;
  if (!validApiKey) {
    console.error('INTERNAL_API_KEY environment variable not configured');

    return context.json({ error: 'Server configuration error' }, 500);
  }

  // Use constant-time comparison to prevent timing attacks
  if (!constantTimeEquals(providedKey, validApiKey)) {
    return context.json({ error: 'Unauthorized: Invalid API key' }, 401);
  }

  await next();
}

function constantTimeEquals(a: string, b: string): boolean {
  if (a.length !== b.length) {
    return false;
  }

  let result = 0;
  for (let i = 0; i < a.length; i += 1) {
    result |= a.charCodeAt(i) ^ b.charCodeAt(i);
  }

  return result === 0;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - authenticateInternalAPI(context: Context, next: Next)
 - constantTimeEquals(a: string, b: string)
Declaraciones 'export' encontradas:
- export  async

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/enterprise/workers/socket/src/types/index.ts
Tamaño: 621 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IEnv {
  WEBSOCKET_ROOM: DurableObjectNamespace;
  JWT_SECRET: string;
  INTERNAL_API_KEY: string;
  API_URL?: string;
  REGION?: string;
}

export interface IConnectionMetadata {
  userId: string;
  environmentId: string;
  connectedAt: number;
  jwtToken: string;
  contextKeys?: string[];
}

export interface IWebSocketRoom {
  sendToUser(userId: string, event: string, data: unknown, contextKeys?: string[]): Promise<void>;
  getActiveConnectionsForUser(userId: string): number;
  getTotalActiveConnections(): number;
  getConnectionCapacity(): { current: number; max: number; available: number };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/.czrc
Tamaño: 42 bytes
Lenguaje detectado: CZRC

### CONTENIDO ORIGINAL ###

{
  "path": "cz-conventional-changelog"
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"path": "cz-conventional-changelog"
}
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/.gitignore
Tamaño: 87 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

.idea/*
.nyc_output
build
node_modules
test
src/**.js
coverage
*.log
package-lock.json


### ANALISIS AUTOMATICO (ESPAÑOL) ###

.idea/*
.nyc_output
build
node_modules
test
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/README.md
Tamaño: 85 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

# Application generic

Generic backend code used inside of Novu's different services


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Application generic
Generic backend code used inside of Novu's different services
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/jest.config.js
Tamaño: 237 bytes
Lenguaje detectado: JavaScript

### CONTENIDO ORIGINAL ###

/** @type {import('ts-jest/dist/types').InitialOptionsTsJest} */
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  moduleNameMapper: {
    axios: 'axios/dist/node/axios.cjs',
  },
  setupFiles: ['./jest.setup.js'],
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/jest.setup.js
Tamaño: 55 bytes
Lenguaje detectado: JavaScript

### CONTENIDO ORIGINAL ###

require('dotenv').config({ path: './src/.env.test' });


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/package.json
Tamaño: 4497 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/application-generic",
  "version": "2.0.14",
  "description": "Generic backend code used inside of Novu's different services",
  "main": "build/main/index.js",
  "typings": "build/main/index.d.ts",
  "module": "build/module/index.js",
  "private": true,
  "license": "MIT",
  "keywords": [],
  "scripts": {
    "start": "npm run watch:build",
    "prebuild": "rimraf build",
    "build": "run-p build:*",
    "build:main": "tsc -p tsconfig.json",
    "build:copy-template": "cpx \"src/**/*.handlebars\" build/main",
    "fix": "run-s fix:*",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "watch:build": "tsc -p tsconfig.json -w",
    "watch:test": "jest src --watch",
    "reset-hard": "git clean -dfx && git reset --hard && pnpm install"
  },
  "engines": {
    "node": ">=10"
  },
  "peerDependencies": {
    "@nestjs/common": "10.4.18",
    "@nestjs/core": "10.4.18",
    "@nestjs/jwt": "10.2.0",
    "@nestjs/passport": "10.0.3",
    "@nestjs/swagger": "7.4.0",
    "@nestjs/terminus": "10.2.3",
    "@nestjs/testing": "10.4.18",
    "jsonwebtoken": "9.0.0",
    "newrelic": "^12.8.1",
    "reflect-metadata": "0.2.2"
  },
  "dependencies": {
    "@aws-sdk/client-s3": "^3.567.0",
    "@aws-sdk/s3-request-presigner": "^3.567.0",
    "@azure/storage-blob": "^12.11.0",
    "@clickhouse/client": "^1.11.2",
    "@google-cloud/storage": "^6.2.3",
    "@hokify/agenda": "^6.3.0",
    "@launchdarkly/node-server-sdk": "^9.7.3",
    "@maily-to/render": "github:novuhq/maily.to#release/v0.1.3-novu.8-render&path:/packages/render",
    "@novu/dal": "workspace:*",
    "@novu/framework": "workspace:*",
    "@novu/providers": "workspace:*",
    "@novu/shared": "workspace:*",
    "@novu/stateless": "workspace:*",
    "@novu/testing": "workspace:*",
    "@opentelemetry/api": "^1.9.0",
    "@opentelemetry/auto-instrumentations-node": "^0.60.0",
    "@opentelemetry/context-async-hooks": "~1.19.0",
    "@opentelemetry/core": "~1.19.0",
    "@opentelemetry/exporter-collector": "^0.25.0",
    "@opentelemetry/exporter-jaeger": "~1.19.0",
    "@opentelemetry/exporter-prometheus": "^0.46.0",
    "@opentelemetry/exporter-trace-otlp-http": "^0.49.1",
    "@opentelemetry/instrumentation": "^0.46.0",
    "@opentelemetry/propagator-b3": "~1.19.0",
    "@opentelemetry/propagator-jaeger": "~1.19.0",
    "@opentelemetry/resources": "~1.19.0",
    "@opentelemetry/sdk-node": "^0.46.0",
    "@opentelemetry/sdk-trace-base": "~1.19.0",
    "@opentelemetry/sdk-trace-node": "~1.19.0",
    "@opentelemetry/semantic-conventions": "~1.19.0",
    "@segment/analytics-node": "^1.1.4",
    "@sentry/node": "^8.33.1",
    "@team-plain/typescript-sdk": "5.8.0",
    "@tufjs/canonical-json": "^2.0.0",
    "axios": "^1.9.0",
    "bullmq": "^3.10.2",
    "class-transformer": "0.5.1",
    "class-validator": "0.14.1",
    "clickhouse-schema": "^2.0.1",
    "cron-parser": "^4.9.0",
    "date-fns": "^2.29.2",
    "date-fns-tz": "^3.2.0",
    "es-toolkit": "^1.39.10",
    "got": "^11.8.6",
    "handlebars": "^4.7.7",
    "i18next": "^23.7.6",
    "ioredis": "^5.2.4",
    "jsonwebtoken": "9.0.0",
    "lodash": "^4.17.15",
    "mixpanel": "^0.17.0",
    "nanoid": "^3.1.20",
    "nestjs-otel": "6.1.1",
    "nestjs-pino": "4.2.0",
    "node-fetch": "^3.2.10",
    "pino-http": "^8.3.3",
    "pino-pretty": "^9.4.0",
    "recursive-diff": "^1.0.8",
    "rrule": "^2.7.2",
    "rxjs": "7.8.1",
    "sanitize-html": "^2.4.0",
    "shortid": "^2.2.16",
    "svix": "^1.64.1",
    "zod": "^3.23.8",
    "zod-to-json-schema": "^3.23.3"
  },
  "optionalDependencies": {
    "@novu/ee-shared-services": "workspace:*",
    "@taskforcesh/bullmq-pro": "6.11.0"
  },
  "devDependencies": {
    "@istanbuljs/nyc-config-typescript": "^1.0.1",
    "@types/got": "^9.6.12",
    "@types/jest": "29.5.2",
    "@types/newrelic": "^9.14.6",
    "@types/sanitize-html": "^2.11.0",
    "@types/sinon": "^9.0.0",
    "chai": "^4.2.0",
    "codecov": "^3.5.0",
    "cpx": "^1.5.0",
    "dotenv": "^16.4.5",
    "jest": "^27.1.0",
    "npm-run-all": "^4.1.5",
    "nyc": "^15.1.0",
    "rimraf": "^3.0.2",
    "sinon": "^9.2.4",
    "ts-jest": "^27.0.5",
    "ts-node": "~10.9.1",
    "typescript": "5.6.2",
    "vitest": "^2.1.9"
  },
  "files": [
    "build/main",
    "build/module",
    "!**/*.spec.*",
    "!**/*.json",
    "CHANGELOG.md",
    "LICENSE",
    "README.md"
  ],
  "nyc": {
    "extends": "@istanbuljs/nyc-config-typescript",
    "exclude": [
      "**/*.spec.js"
    ]
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/application-generic",
"version": "2.0.14",
"description": "Generic backend code used inside of Novu's different services",
"main": "build/main/index.js",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/tsconfig.json
Tamaño: 476 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "sourceMap": true,
    "strictNullChecks": false,
    "allowSyntheticDefaultImports": true,
    "outDir": "build/main",
    "module": "commonjs",
    "target": "es6",
    "esModuleInterop": true,
    "rootDir": "src",
    "strict": true,
    "types": ["node", "jest"],
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"sourceMap": true,
"strictNullChecks": false,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/tsconfig.module.json
Tamaño: 325 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "./tsconfig",
  "compilerOptions": {
    "sourceMap": true,
    "target": "esnext",
    "outDir": "build/module",
    "module": "esnext",
    "esModuleInterop": true,
    "types": ["jest", "node"],
    "typeRoots": ["./node_modules/@types", "../../node_modules/@types"]
  },
  "exclude": ["node_modules/**"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "./tsconfig",
"compilerOptions": {
"sourceMap": true,
"target": "esnext",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/src/index.ts
Tamaño: 736 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './commands/index';
export * from './config';
export * from './custom-providers';
export * from './decorators';
export * from './dtos';
export * from './encryption/index';
export * from './factories/index';
export * from './health/index';
export * from './http';
export * from './instrumentation/index';
export * from './logging/index';
export * from './modules';
export * from './pipes';
export * from './resilience';
export * from './schemas/channel-endpoint';
export * from './schemas/control';
export * from './services';
export * from './services/resource-validator.service';
export * from './tracing';
export * from './usecases';
export * from './utils';
export * from './value-objects';
export * from './webhooks';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/authenticated.command.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsNotEmpty } from 'class-validator';
import { BaseCommand } from './base.command';

export abstract class AuthenticatedCommand extends BaseCommand {
  @IsNotEmpty()
  public readonly userId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/base.command.spec.ts
Tamaño: 1797 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import * as Sentry from '@sentry/node';
import { IsDefined, IsEmail, IsNotEmpty } from 'class-validator';
import sinon from 'sinon';

import { BaseCommand } from './base.command';

export class TestCommand extends BaseCommand {
  @IsDefined()
  @IsNotEmpty()
  @IsEmail()
  email: string;

  @IsDefined()
  password: string;
}

describe('BaseCommand', () => {
  beforeAll(() => {
    sinon.stub(Sentry, 'addBreadcrumb');
  });

  it('should throw BadRequestException with error messages when field values are not valid', async () => {
    try {
      TestCommand.create({ email: undefined, password: undefined });
      expect(false).toBeTruthy();
    } catch (e) {
      expect((e as BadRequestException).getResponse()).toEqual({
        statusCode: 400,
        error: 'Bad Request',
        message: [
          'email should not be null or undefined',
          'email must be an email',
          'email should not be empty',
          'password should not be null or undefined',
        ],
      });
    }
  });

  it('should throw BadRequestException with error message when only one field is not valid', async () => {
    try {
      TestCommand.create({ email: 'test@test.com', password: undefined });
      expect(false).toBeTruthy();
    } catch (e) {
      expect((e as BadRequestException).getResponse()).toEqual({
        statusCode: 400,
        error: 'Bad Request',
        message: ['password should not be null or undefined'],
      });
    }
  });

  it('should return object of type that extends the base', async () => {
    const obj = { email: 'test@test.com', password: 'P@ssw0rd' };
    const res = TestCommand.create(obj);

    expect(res instanceof TestCommand).toBeTruthy();
    expect(res).toEqual(obj);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TestCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/base.command.ts
Tamaño: 2972 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import { ApiProperty } from '@nestjs/swagger';
import { plainToInstance } from 'class-transformer';
import { ValidationError, validateSync } from 'class-validator';

// biome-ignore lint/complexity/noStaticOnlyClass: Base class pattern for command validation
export abstract class BaseCommand {
  static create<T extends BaseCommand>(this: new (...args: unknown[]) => T, data: T): T {
    // biome-ignore lint/complexity/noThisInStatic: Biome linter is configured to newer JS/TS version than the compiler
    const convertedObject = plainToInstance<T, unknown>(this, {
      ...data,
    });

    const errors = validateSync(convertedObject);
    const flattenedErrors = flattenErrors(errors);
    if (Object.keys(flattenedErrors).length > 0) {
      // biome-ignore lint/complexity/noThisInStatic: Biome linter is configured to newer JS/TS version than the compiler
      throw new CommandValidationException(this.name, flattenedErrors);
    }

    return convertedObject;
  }
}

export class ConstraintValidation {
  @ApiProperty({
    type: 'array',
    items: { type: 'string' },
    description: 'List of validation error messages',
    example: ['Field is required', 'Invalid format'],
  })
  messages: string[];

  @ApiProperty({
    required: false,
    description: 'Value that failed validation',
    oneOf: [
      { type: 'string', nullable: true },
      { type: 'number' },
      { type: 'boolean' },
      { type: 'object' },
      {
        type: 'array',
        items: {
          anyOf: [
            { type: 'string', nullable: true },
            { type: 'number' },
            { type: 'boolean' },
            { type: 'object', additionalProperties: true },
          ],
        },
      },
    ],
    example: 'xx xx xx ',
  })
  value?: string | number | boolean | object | object[] | null;
}
function flattenErrors(errors: ValidationError[], prefix: string = ''): Record<string, ConstraintValidation> {
  const result: Record<string, ConstraintValidation> = {};

  for (const error of errors) {
    const currentKey = prefix ? `${prefix}.${error.property}` : error.property;

    if (error.constraints) {
      result[currentKey] = {
        messages: Object.values(error.constraints),
        value: error.value,
      };
    }

    if (error.children && error.children.length > 0) {
      const childErrors = flattenErrors(error.children, currentKey);
      for (const [key, value] of Object.entries(childErrors)) {
        if (result[key]) {
          result[key].messages = result[key].messages.concat(value.messages);
        } else {
          result[key] = value;
        }
      }
    }
  }

  return result;
}
export class CommandValidationException extends BadRequestException {
  constructor(
    public className: string,
    public constraintsViolated: Record<string, ConstraintValidation>
  ) {
    super({ message: 'Validation failed', className, constraintsViolated });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - flattenErrors(errors: ValidationError[], prefix: string = '')
Declaraciones 'export' encontradas:
- export  abstract
- export class ConstraintValidation
- export class CommandValidationException

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/commandValidationException.ts
Tamaño: 0 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###



### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/index.ts
Tamaño: 148 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './authenticated.command';
export * from './base.command';
export * from './organization.command';
export * from './project.command';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/organization.command.ts
Tamaño: 237 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsNotEmpty } from 'class-validator';
import { AuthenticatedCommand } from './authenticated.command';

export abstract class OrganizationCommand extends AuthenticatedCommand {
  @IsNotEmpty()
  readonly organizationId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/commands/project.command.ts
Tamaño: 2368 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum, KeysOfT, UserSessionData } from '@novu/shared';
import { IsDefined, IsEnum, IsNotEmpty, IsNumber, IsOptional, IsString, Max, Min } from 'class-validator';

import { BaseCommand } from './base.command';

export abstract class EnvironmentLevelCommand extends BaseCommand {
  @IsNotEmpty()
  readonly environmentId: string;

  readonly organizationId?: string;
}

export abstract class EnvironmentLevelWithUserCommand extends BaseCommand {
  @IsNotEmpty()
  readonly environmentId: string;

  readonly organizationId?: string;

  @IsNotEmpty()
  readonly userId: string;
}

export abstract class OrganizationLevelCommand extends BaseCommand {
  readonly environmentId?: string;

  @IsNotEmpty()
  readonly organizationId: string;
}

export abstract class OrganizationLevelWithUserCommand extends BaseCommand {
  readonly environmentId?: string;

  @IsNotEmpty()
  readonly organizationId: string;

  @IsNotEmpty()
  readonly userId: string;
}

export abstract class EnvironmentWithUserCommand extends BaseCommand {
  @IsNotEmpty()
  readonly environmentId: string;

  @IsNotEmpty()
  readonly organizationId: string;

  @IsNotEmpty()
  readonly userId: string;
}

export abstract class EnvironmentWithUserObjectCommand extends BaseCommand {
  @IsNotEmpty()
  user: UserSessionData;
}

export abstract class PaginatedListCommand extends EnvironmentWithUserObjectCommand {
  @IsDefined()
  @IsNumber()
  offset: number;

  @IsDefined()
  @IsNumber()
  limit: number;

  @IsDefined()
  @IsEnum(DirectionEnum)
  orderDirection: DirectionEnum;

  @IsDefined()
  @IsString()
  orderBy: string;
}

export abstract class EnvironmentWithSubscriber extends BaseCommand {
  @IsNotEmpty()
  readonly environmentId: string;

  @IsNotEmpty()
  readonly organizationId: string;

  @IsNotEmpty()
  readonly subscriberId: string;
}

export abstract class EnvironmentCommand extends BaseCommand {
  @IsNotEmpty()
  readonly environmentId: string;

  @IsNotEmpty()
  readonly organizationId: string;
}
export abstract class CursorBasedPaginatedCommand<T, K extends KeysOfT<T>> extends EnvironmentWithUserObjectCommand {
  @IsDefined()
  @IsNumber()
  @Min(1)
  @Max(100)
  limit: number;

  @IsString()
  @IsOptional()
  after?: string;

  @IsString()
  @IsOptional()
  before?: string;

  orderBy: K;
  orderDirection?: DirectionEnum;

  includeCursor?: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/config/index.ts
Tamaño: 27 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './workers';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/config/workers.config.spec.ts
Tamaño: 3634 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  getInboundParseMailWorkerOptions,
  getStandardWorkerOptions,
  getSubscriberProcessWorkerOptions,
  getWebSocketWorkerOptions,
  getWorkflowWorkerOptions,
} from './workers';

describe('Workers Config', () => {
  describe('Inbound Parse Mail Worker', () => {
    it('should have the default values when no environment variable set', () => {
      expect(getInboundParseMailWorkerOptions()).toEqual({
        concurrency: 200,
        lockDuration: 90000,
      });
    });

    it('should have the values passed through the environment variables', () => {
      process.env.WORKER_DEFAULT_CONCURRENCY = '100';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '10';

      expect(getInboundParseMailWorkerOptions()).toEqual({
        concurrency: 100,
        lockDuration: 10,
      });

      process.env.WORKER_DEFAULT_CONCURRENCY = '';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '';
    });
  });

  describe('Standard Worker', () => {
    it('should have the default values when no environment variable set', () => {
      expect(getStandardWorkerOptions()).toEqual({
        concurrency: 200,
        lockDuration: 90000,
      });
    });

    it('should have the values passed through the environment variables', () => {
      process.env.WORKER_DEFAULT_CONCURRENCY = '100';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '10';

      expect(getStandardWorkerOptions()).toEqual({
        concurrency: 100,
        lockDuration: 10,
      });

      process.env.WORKER_DEFAULT_CONCURRENCY = '';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '';
    });
  });

  describe('Subscriber Process Worker', () => {
    it('should have the default values when no environment variable set', () => {
      expect(getSubscriberProcessWorkerOptions()).toEqual({
        concurrency: 200,
        lockDuration: 90000,
      });
    });

    it('should have the values passed through the environment variables', () => {
      process.env.WORKER_DEFAULT_CONCURRENCY = '100';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '10';

      expect(getSubscriberProcessWorkerOptions()).toEqual({
        concurrency: 100,
        lockDuration: 10,
      });

      process.env.WORKER_DEFAULT_CONCURRENCY = '';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '';
    });
  });

  describe('Web Socket Worker', () => {
    it('should have the default values when no environment variable set', () => {
      expect(getWebSocketWorkerOptions()).toEqual({
        concurrency: 400,
        lockDuration: 90000,
      });
    });

    it('should have the values passed through the environment variables', () => {
      process.env.WORKER_DEFAULT_CONCURRENCY = '100';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '10';

      expect(getWebSocketWorkerOptions()).toEqual({
        concurrency: 100,
        lockDuration: 10,
      });

      process.env.WORKER_DEFAULT_CONCURRENCY = '';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '';
    });
  });

  describe('Workflow Worker', () => {
    it('should have the default values when no environment variable set', () => {
      expect(getWorkflowWorkerOptions()).toEqual({
        concurrency: 200,
        lockDuration: 90000,
      });
    });

    it('should have the values passed through the environment variables', () => {
      process.env.WORKER_DEFAULT_CONCURRENCY = '100';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '10';

      expect(getWorkflowWorkerOptions()).toEqual({
        concurrency: 100,
        lockDuration: 10,
      });

      process.env.WORKER_DEFAULT_CONCURRENCY = '';
      process.env.WORKER_DEFAULT_LOCK_DURATION = '';
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - WORKER_DEFAULT_LOCK_DURATION('';
    });
  });

  describe('Standard Worker', ())
 - WORKER_DEFAULT_LOCK_DURATION('';
    });
  });

  describe('Subscriber Process Worker', ())
 - WORKER_DEFAULT_LOCK_DURATION('';
    });
  });

  describe('Web Socket Worker', ())
 - WORKER_DEFAULT_LOCK_DURATION('';
    });
  });

  describe('Workflow Worker', ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/config/workers.ts
Tamaño: 1906 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

enum WorkerEnum {
  INBOUND_PARSE_MAIL = 'InboundParseMailWorker',
  SUBSCRIBER_PROCESS = 'SubscriberProcessWorker',
  STANDARD = 'StandardWorker',
  WEB_SOCKET = 'WebSocketWorker',
  WORKFLOW = 'WorkflowWorker',
}

interface IWorkerConfig {
  concurrency: number;
  lockDuration: number;
}

const getDefaultConcurrency = () =>
  process.env.WORKER_DEFAULT_CONCURRENCY ? Number(process.env.WORKER_DEFAULT_CONCURRENCY) : undefined;

const getDefaultLockDuration = () =>
  process.env.WORKER_DEFAULT_LOCK_DURATION ? Number(process.env.WORKER_DEFAULT_LOCK_DURATION) : undefined;

const getWorkerConfig = (worker: WorkerEnum): IWorkerConfig => {
  const workersConfig = {
    [WorkerEnum.INBOUND_PARSE_MAIL]: {
      concurrency: getDefaultConcurrency() ?? 200,
      lockDuration: getDefaultLockDuration() ?? 90000,
    },
    [WorkerEnum.SUBSCRIBER_PROCESS]: {
      concurrency: getDefaultConcurrency() ?? 200,
      lockDuration: getDefaultLockDuration() ?? 90000,
    },
    [WorkerEnum.STANDARD]: {
      concurrency: getDefaultConcurrency() ?? 200,
      lockDuration: getDefaultLockDuration() ?? 90000,
    },
    [WorkerEnum.WEB_SOCKET]: {
      concurrency: getDefaultConcurrency() ?? 400,
      lockDuration: getDefaultLockDuration() ?? 90000,
    },
    [WorkerEnum.WORKFLOW]: {
      concurrency: getDefaultConcurrency() ?? 200,
      lockDuration: getDefaultLockDuration() ?? 90000,
    },
  };

  return workersConfig[worker];
};

export const getInboundParseMailWorkerOptions = () => getWorkerConfig(WorkerEnum.INBOUND_PARSE_MAIL);

export const getSubscriberProcessWorkerOptions = () => getWorkerConfig(WorkerEnum.SUBSCRIBER_PROCESS);

export const getStandardWorkerOptions = () => getWorkerConfig(WorkerEnum.STANDARD);

export const getWebSocketWorkerOptions = () => getWorkerConfig(WorkerEnum.WEB_SOCKET);

export const getWorkflowWorkerOptions = () => getWorkerConfig(WorkerEnum.WORKFLOW);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getDefaultConcurrency())
 - getDefaultLockDuration())
 - getWorkerConfig(worker: WorkerEnum): IWorkerConfig)
 - getInboundParseMailWorkerOptions())
 - getSubscriberProcessWorkerOptions())
 - getStandardWorkerOptions())
 - getWebSocketWorkerOptions())
 - getWorkflowWorkerOptions())
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/custom-providers/index.ts
Tamaño: 1661 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef } from '@nestjs/common';
import { DalService } from '@novu/dal';
import { PinoLogger } from 'nestjs-pino';
import {
  AnalyticsService,
  CacheInMemoryProviderService,
  CacheService,
  ClickHouseService,
  FeatureFlagsService,
} from '../services';

export const featureFlagsService = {
  provide: FeatureFlagsService,
  useFactory: async (): Promise<FeatureFlagsService> => {
    const instance = new FeatureFlagsService();
    await instance.initialize();

    return instance;
  },
};

export const cacheInMemoryProviderService = {
  provide: CacheInMemoryProviderService,
  useFactory: (): CacheInMemoryProviderService => {
    return new CacheInMemoryProviderService();
  },
};

export const cacheService = {
  provide: CacheService,
  useFactory: async (): Promise<CacheService> => {
    const factoryCacheInMemoryProviderService = cacheInMemoryProviderService.useFactory();

    const service = new CacheService(factoryCacheInMemoryProviderService);

    await service.initialize();

    return service;
  },
};

export const dalService = {
  provide: DalService,
  useFactory: async () => {
    const service = new DalService();
    await service.connect(String(process.env.MONGO_URL));

    return service;
  },
};

export const analyticsService = {
  provide: AnalyticsService,
  useFactory: async () => {
    const service = new AnalyticsService(process.env.SEGMENT_TOKEN);
    await service.initialize();

    return service;
  },
};

export const clickHouseService = {
  provide: ClickHouseService,
  useFactory: async () => {
    const service = new ClickHouseService();
    await service.init();

    return service;
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - featureFlagsService({
  provide: FeatureFlagsService,
  useFactory: async (): Promise<FeatureFlagsService>)
 - cacheInMemoryProviderService({
  provide: CacheInMemoryProviderService,
  useFactory: (): CacheInMemoryProviderService)
 - cacheService({
  provide: CacheService,
  useFactory: async (): Promise<CacheService>)
 - dalService({
  provide: DalService,
  useFactory: async ())
 - analyticsService({
  provide: AnalyticsService,
  useFactory: async ())
 - clickHouseService({
  provide: ClickHouseService,
  useFactory: async ())
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/external-api.decorator.ts
Tamaño: 388 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { applyDecorators, SetMetadata } from '@nestjs/common';
import { ApiSecurity } from '@nestjs/swagger';

export const API_KEY_SWAGGER_SECURITY_NAME = 'secretKey';
export const BEARER_SWAGGER_SECURITY_NAME = 'bearerAuth';

export function ExternalApiAccessible() {
  return applyDecorators(SetMetadata('external_api_accessible', true), ApiSecurity(API_KEY_SWAGGER_SECURITY_NAME));
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - ExternalApiAccessible()
Declaraciones 'export' encontradas:
- export  const
- export  const
- export function ExternalApiAccessible

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/index.ts
Tamaño: 360 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './external-api.decorator';
export * from './is-valid-context-payload.decorator';
export * from './is-valid-locale.decorator';
export * from './permissions.decorator';
export * from './product-feature.decorator';
export * from './resource-category.decorator';
export * from './retry-on-error-decorator';
export * from './user-session.decorator';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/is-valid-context-payload.decorator.ts
Tamaño: 5058 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ContextPayload, ContextValue, isValidContextPayload } from '@novu/shared';
import { registerDecorator, ValidationOptions } from 'class-validator';

const MAX_SIZE_KB = 64;

export interface ContextPayloadValidationOptions extends ValidationOptions {
  maxCount?: number;
}

export interface ContextDataValidationOptions extends ValidationOptions {
  maxSizeKB?: number;
}

export interface ContextPayloadValidationResult {
  isValid: boolean;
  error?: string;
}

function calculateDataSize(data: unknown, maxSizeKB = MAX_SIZE_KB): ContextPayloadValidationResult {
  if (!data) return { isValid: true };

  try {
    const jsonString = JSON.stringify(data);
    const sizeInBytes = Buffer.byteLength(jsonString, 'utf8');
    const maxSizeBytes = maxSizeKB * 1024;

    if (sizeInBytes > maxSizeBytes) {
      const currentSizeKB = Math.round(sizeInBytes / 1024);
      return {
        isValid: false,
        error: `Data is too large: ${currentSizeKB}KB exceeds ${maxSizeKB}KB limit`,
      };
    }

    return { isValid: true };
  } catch {
    return {
      isValid: false,
      error: 'Data is invalid: cannot serialize to JSON',
    };
  }
}

function validateContextCount(contextObj: Record<string, unknown>, maxCount?: number): ContextPayloadValidationResult {
  if (!maxCount) return { isValid: true };

  const contextCount = Object.keys(contextObj).length;
  if (contextCount > maxCount) {
    return {
      isValid: false,
      error: `Too many contexts: ${contextCount} provided, maximum allowed is ${maxCount}`,
    };
  }

  return { isValid: true };
}

function validateContextDataSizes(contextObj: Record<string, unknown>): ContextPayloadValidationResult {
  for (const [contextType, contextValue] of Object.entries(contextObj)) {
    const result = validateSingleContextData(contextType, contextValue);
    if (!result.isValid) return result;
  }

  return { isValid: true };
}

function validateSingleContextData(contextType: string, contextValue: unknown): ContextPayloadValidationResult {
  if (typeof contextValue !== 'object' || contextValue === null || !('data' in contextValue)) {
    return { isValid: true }; // No data to validate
  }

  const data = (contextValue as ContextValue & { data?: unknown }).data;
  const result = calculateDataSize(data);

  if (!result.isValid) {
    return {
      isValid: false,
      error: `Context '${contextType}' ${result.error}`,
    };
  }

  return { isValid: true };
}

// Main validation functions
export function validateContextPayloadWithDetails(value: unknown, maxCount?: number): ContextPayloadValidationResult {
  // Handle null/undefined
  if (value == null) return { isValid: true };

  // Validate structure
  if (!isValidContextPayload(value)) {
    return {
      isValid: false,
      error:
        'Invalid context payload structure. Expected object with context types as keys and string IDs or {id, data} objects as values',
    };
  }

  const contextObj = value as ContextPayload;

  // Validate count
  const countResult = validateContextCount(contextObj, maxCount);
  if (!countResult.isValid) return countResult;

  // Validate data sizes
  return validateContextDataSizes(contextObj);
}

export function validateContextPayload(value: unknown, maxCount?: number): boolean {
  return validateContextPayloadWithDetails(value, maxCount).isValid;
}

export function validateContextDataWithDetails(value: unknown, maxSizeKB?: number): ContextPayloadValidationResult {
  if (value == null) return { isValid: true };

  // Must be an object
  if (typeof value !== 'object' || Array.isArray(value)) {
    return {
      isValid: false,
      error: 'Context data must be an object',
    };
  }

  return calculateDataSize(value, maxSizeKB);
}

function createValidationDecorator<T extends ValidationOptions>(
  name: string,
  validationFn: (value: unknown, options?: T) => ContextPayloadValidationResult,
  defaultMessage: string
) {
  return (validationOptions?: T) => {
    return (object: object, propertyName: string) => {
      let lastValidationError: string | undefined;

      registerDecorator({
        name,
        target: object.constructor,
        propertyName: propertyName,
        options: validationOptions,
        validator: {
          validate(value: unknown) {
            const result = validationFn(value, validationOptions);
            lastValidationError = result.error;
            return result.isValid;
          },
          defaultMessage() {
            return lastValidationError || defaultMessage;
          },
        },
      });
    };
  };
}

// Decorators
export const IsValidContextPayload = createValidationDecorator<ContextPayloadValidationOptions>(
  'isValidContextPayload',
  (value, options) => validateContextPayloadWithDetails(value, options?.maxCount),
  'Invalid context payload'
);

export const IsValidContextData = createValidationDecorator<ContextDataValidationOptions>(
  'isValidContextData',
  (value, options) => validateContextDataWithDetails(value, options?.maxSizeKB),
  'Invalid context data'
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - calculateDataSize(data: unknown, maxSizeKB = MAX_SIZE_KB)
 - validateContextCount(contextObj: Record<string, unknown>, maxCount?: number)
 - validateContextDataSizes(contextObj: Record<string, unknown>)
 - validateSingleContextData(contextType: string, contextValue: unknown)
 - validateContextPayloadWithDetails(value: unknown, maxCount?: number)
 - validateContextPayload(value: unknown, maxCount?: number)
 - validateContextDataWithDetails(value: unknown, maxSizeKB?: number)
Asignaciones con arrow functions encontradas (posibles funciones):
 - IsValidContextPayload(createValidationDecorator<ContextPayloadValidationOptions>(
  'isValidContextPayload',
  (value, opt...)
 - IsValidContextData(createValidationDecorator<ContextDataValidationOptions>(
  'isValidContextData',
  (value, options))
Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export function validateContextPayloadWithDetails
- export function validateContextPayload
- export function validateContextDataWithDetails
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/is-valid-locale.decorator.ts
Tamaño: 836 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { validateLocale } from '@novu/shared';
import { registerDecorator, ValidationArguments, ValidationOptions } from 'class-validator';

export function IsValidLocale(validationOptions?: ValidationOptions) {
  return (object: any, propertyName: string) => {
    registerDecorator({
      name: 'isValidLocale',
      target: object.constructor,
      propertyName,
      options: validationOptions,
      validator: {
        validate(value: unknown, args: ValidationArguments) {
          const result = validateLocale(value, args.property);

          return result.isValid;
        },
        defaultMessage(args: ValidationArguments) {
          const result = validateLocale(args.value, args.property);

          return result.errorMessage || `${args.property} must be a valid locale code`;
        },
      },
    });
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - IsValidLocale(validationOptions?: ValidationOptions)
Declaraciones 'export' encontradas:
- export function IsValidLocale

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/permissions.decorator.ts
Tamaño: 428 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SetMetadata } from '@nestjs/common';
import { PermissionsEnum } from '@novu/shared';

export const PERMISSIONS_KEY = 'permissions';
export const RequirePermissions = (...permissions: PermissionsEnum[]) => {
  return SetMetadata(PERMISSIONS_KEY, permissions);
};

export const NO_PERMISSIONS_KEY = 'no_permissions_required';
export const SkipPermissionsCheck = () => {
  return SetMetadata(NO_PERMISSIONS_KEY, true);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - RequirePermissions(...permissions: PermissionsEnum[]))
 - SkipPermissionsCheck())
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/product-feature.decorator.ts
Tamaño: 179 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Reflector } from '@nestjs/core';
import { ProductFeatureKeyEnum } from '@novu/shared';

export const ProductFeature = Reflector.createDecorator<ProductFeatureKeyEnum>();


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/resource-category.decorator.ts
Tamaño: 163 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Reflector } from '@nestjs/core';
import { ResourceEnum } from '@novu/shared';

export const ResourceCategory = Reflector.createDecorator<ResourceEnum>();


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/retry-on-error-decorator.spec.ts
Tamaño: 2948 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { RetryOnError, RetryOptions } from './retry-on-error-decorator';

// Mock console.warn to verify logging
const mockConsoleWarn = jest.spyOn(console, 'warn');
class CustomError extends Error {}
class TestService {
  private attempts = 0;

  @RetryOnError('CustomError', { maxRetries: 3, delay: 10 })
  async riskyMethod(shouldFail: boolean = true): Promise<string> {
    this.attempts++;

    if (shouldFail && this.attempts < 3) {
      const error = new CustomError('Operation failed');
      error.name = 'CustomError';
      throw error;
    }

    return 'Success';
  }
}

describe('RetryOnError Decorator', () => {
  let service: TestService;

  beforeEach(() => {
    service = new TestService();
    mockConsoleWarn.mockClear();
  });

  it('should retry on specified error and eventually succeed', async () => {
    const result = await service.riskyMethod();

    expect(result).toBe('Success');
    expect(mockConsoleWarn).toHaveBeenCalledTimes(2); // Should log 3 warning messages
  });

  it('should throw error after max retries', async () => {
    // Create a service with a method that always fails
    class AlwaysFailService {
      @RetryOnError('CustomError', { maxRetries: 2, delay: 10 })
      async alwaysFailMethod(): Promise<string> {
        const error = new Error('Always failing');
        error.name = 'CustomError';
        throw error;
      }
    }

    const alwaysFailService = new AlwaysFailService();

    await expect(alwaysFailService.alwaysFailMethod()).rejects.toThrow('Always failing');

    // Check that warnings were logged
    expect(mockConsoleWarn).toHaveBeenCalledTimes(2);
  });

  it('should not retry on different error types', async () => {
    class DifferentErrorService {
      @RetryOnError('CustomError')
      async methodWithDifferentError(): Promise<string> {
        throw new Error('Different Error');
      }
    }

    const differentErrorService = new DifferentErrorService();

    await expect(differentErrorService.methodWithDifferentError()).rejects.toThrow('Different Error');

    // No warnings should be logged
    expect(mockConsoleWarn).toHaveBeenCalledTimes(0);
  });

  it('should support custom retry options', async () => {
    const customOptions: RetryOptions = {
      maxRetries: 2,
      delay: 50,
      exponentialBackoff: false,
    };

    class CustomOptionsService {
      private attempts = 0;

      @RetryOnError('CustomError', customOptions)
      async methodWithCustomOptions(): Promise<string> {
        this.attempts++;

        if (this.attempts < 2) {
          const error = new Error('Operation failed');
          error.name = 'CustomError';
          throw error;
        }

        return 'Success';
      }
    }

    const customService = new CustomOptionsService();
    const result = await customService.methodWithCustomOptions();

    expect(result).toBe('Success');
    expect(mockConsoleWarn).toHaveBeenCalledTimes(1);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - name('CustomError';
      throw error;
    }

    return 'Success';
  }
}

describe('RetryOnError Decorat...)
 - service(new TestService();
    mockConsoleWarn.mockClear();
  });

  it('should retry on specified error and...)
 - result(await service.riskyMethod();

    expect(result).toBe('Success');
    expect(mockConsoleWarn).toHave...)
 - alwaysFailService(new AlwaysFailService();

    await expect(alwaysFailService.alwaysFailMethod()).rejects.toThrow('Al...)
 - differentErrorService(new DifferentErrorService();

    await expect(differentErrorService.methodWithDifferentError()).rej...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/retry-on-error-decorator.ts
Tamaño: 2518 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { parseErrorInformation } from '../logging/error-util';

export class RetryOptions {
  maxRetries?: number;
  delay?: number;
  exponentialBackoff?: boolean;
  // Allow custom error filtering
  shouldRetry?: (error: Error) => boolean;
  // Optional custom logger
  logger?: {
    warn: (message: string) => void;
    error: (message: string) => void;
  };
}

export function RetryOnError(errorName: string, options: RetryOptions = {}) {
  return (target: unknown, propertyKey: string, descriptor: PropertyDescriptor) => {
    const originalMethod = descriptor.value;

    descriptor.value = async function (this: unknown, ...args: unknown[]) {
      const {
        maxRetries = 3,
        delay = 100,
        exponentialBackoff = true,
        shouldRetry = (error: Error) => error instanceof Error && 'name' in error && error.name === errorName,
        logger = console,
      } = options;

      let retries = 0;

      const getErrorString = (message: string, error: Error) => {
        return JSON.stringify({
          message,
          errorType: 'RetryOnError',
          className: this.constructor.name,
          functionName: propertyKey,
          retryAttempt: `${retries}/${maxRetries}`,
          errorDetails: {
            name: errorName,
            information: parseErrorInformation(error),
          },
          arguments: args,
        });
      };

      do {
        try {
          return await originalMethod.apply(this, args);
        } catch (error) {
          // Use custom error filtering
          if (!shouldRetry(error as Error)) {
            throw error; // Rethrow non-matching errors
          }

          retries += 1;

          // Log warning
          logger.warn(getErrorString('RetryOnError Retrying', error as Error));

          // Calculate delay with exponential backoff
          const currentDelay = exponentialBackoff ? delay * 2 ** (retries - 1) : delay;

          // Wait before retrying
          await new Promise<void>((resolve) => {
            setTimeout(resolve, currentDelay);
          });

          // If max retries reached, log and throw
          if (retries >= maxRetries) {
            logger.error(getErrorString('RetryOnError Max Retries Reached throwing error', error as Error));
            throw error;
          }
        }
      } while (retries < maxRetries);

      // This line should never be reached, but TypeScript requires a return
      throw new Error('Unexpected retry failure');
    };

    return descriptor;
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - RetryOnError(errorName: string, options: RetryOptions = {})
Asignaciones con arrow functions encontradas (posibles funciones):
 - RetryOptions({}) {
  return (target: unknown, propertyKey: string, descriptor: PropertyDescriptor))
 - shouldRetry(error: Error))
 - getErrorString(message: string, error: Error))
 - currentDelay(exponentialBackoff ? delay * 2 ** (retries - 1) : delay;

          // Wait before retrying
        ...)
Declaraciones 'export' encontradas:
- export class RetryOptions
- export function RetryOnError

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/decorators/user-session.decorator.ts
Tamaño: 541 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createParamDecorator, InternalServerErrorException, Logger } from '@nestjs/common';

export const UserSession = createParamDecorator((data, ctx) => {
  let req;
  if (ctx.getType() === 'graphql') {
    req = ctx.getArgs()[2].req;
  } else {
    req = ctx.switchToHttp().getRequest();
  }

  if (req.user) {
    return req.user;
  }

  Logger.error(
    'Attempted to access user session without a user in the request. You probably forgot to add the AuthGuard',
    'UserSession'
  );
  throw new InternalServerErrorException();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - UserSession(createParamDecorator((data, ctx))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/inbound-parse-job.dto.ts
Tamaño: 1741 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IBulkJobParams, IJobParams } from '../services/queues/queue-base.service';

export interface IInboundParseDataDto {
  html: string;
  text: string;
  headers: IHeaders;
  subject: string;
  messageId: string;
  priority: string;
  from: IFrom[];
  to: ITo[];
  date: Date;
  dkim: string;
  spf: string;
  spamScore: number;
  language: string;
  cc: any[];
  attachments?: any[];
  connection: IConnection;
  envelopeFrom: IEnvelopeFrom;
  envelopeTo: IEnvelopeTo[];
}

export interface IHeaders {
  'content-type': string;
  from: string;
  to: string;
  subject: string;
  'message-id': string;
  date: string;
  'mime-version': string;
}

export interface IFrom {
  address: string;
  name: string;
}

export interface ITo {
  address: string;
  name: string;
}

export interface ITlsOptions {
  name: string;
  standardName: string;
  version: string;
}

export interface IMailFrom {
  address: string;
  args: boolean;
}

export interface IRcptTo {
  address: string;
  args: boolean;
}

export interface IEnvelope {
  mailFrom: IMailFrom;
  rcptTo: IRcptTo[];
}

export interface IConnection {
  id: string;
  remoteAddress: string;
  remotePort: number;
  clientHostname: string;
  openingCommand: string;
  hostNameAppearsAs: string;
  xClient: any;
  xForward: any;
  transmissionType: string;
  tlsOptions: ITlsOptions;
  envelope: IEnvelope;
  transaction: number;
  mailPath: string;
}

export interface IEnvelopeFrom {
  address: string;
  args: boolean;
}

export interface IEnvelopeTo {
  address: string;
  args: boolean;
}

export interface IInboundParseJobDto extends IJobParams {
  data?: IInboundParseDataDto;
}

export interface IInboundParseBulkJobDto extends IBulkJobParams {
  data: IInboundParseDataDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/index.ts
Tamaño: 198 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './inbound-parse-job.dto';
export * from './process-subscriber-job.dto';
export * from './standard-job.dto';
export * from './web-sockets-job.dto';
export * from './workflow-job.dto';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/process-subscriber-job.dto.ts
Tamaño: 1215 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity, TopicEntity } from '@novu/dal';
import { DiscoverWorkflowOutput } from '@novu/framework/internal';
import {
  ISubscribersDefine,
  ITenantDefine,
  StatelessControls,
  SubscriberSourceEnum,
  TriggerOverrides,
  TriggerRequestCategoryEnum,
} from '@novu/shared';

import { IBulkJobParams, IJobParams } from '../services/queues/queue-base.service';

export interface IProcessSubscriberDataDto {
  environmentId: string;
  environmentName: string;
  organizationId: string;
  userId: string;
  transactionId: string;
  requestId: string;
  identifier: string;
  payload: any;
  overrides: TriggerOverrides;
  tenant?: ITenantDefine;
  actor?: SubscriberEntity;
  contextKeys?: string[];
  subscriber: ISubscribersDefine;
  templateId: string;
  _subscriberSource: SubscriberSourceEnum;
  topics?: Pick<TopicEntity, '_id' | 'key'>[];
  requestCategory?: TriggerRequestCategoryEnum;
  bridge?: { url: string; workflow: DiscoverWorkflowOutput };
  controls?: StatelessControls;
}

export interface IProcessSubscriberJobDto extends IJobParams {
  data?: IProcessSubscriberDataDto;
}

export interface IProcessSubscriberBulkJobDto extends IBulkJobParams {
  data: IProcessSubscriberDataDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/standard-job.dto.ts
Tamaño: 659 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IJobParams } from '../services/queues/queue-base.service';

export class IStandardDataDto {
  _userId: string;
  _environmentId: string;
  _organizationId: string;
  _id: string;
  /*
   * payload is deprecated - todo remove 'payload' once the queue renewed
   * payload was added due backwards compatibility, the legacy use is in standard-worker
   */
  payload?: {
    message: {
      _jobId: string;
      _environmentId: string;
      _organizationId: string;
    };
  };
}

export interface IStandardJobDto extends IJobParams {
  data?: IStandardDataDto;
}

export interface IStandardBulkJobDto extends IJobParams {
  data: IStandardDataDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class IStandardDataDto
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/web-sockets-job.dto.ts
Tamaño: 723 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { WebSocketEventEnum } from '@novu/shared';
import { JobsOptions } from '../services/bull-mq';
import { IBulkJobParams, IJobParams } from '../services/queues/queue-base.service';

export interface IWebSocketDataDto {
  event: WebSocketEventEnum;
  userId: string;
  _environmentId: string;
  _organizationId?: string;
  subscriberId?: string;
  payload?: { messageId: string };
  contextKeys?: string[];
}

export interface IWebSocketJob extends IJobParams {
  name: string;
  data: any;
  groupId?: string;
  options?: JobsOptions;
}

export interface IWebSocketJobDto extends IWebSocketJob {
  data: IWebSocketDataDto;
}

export interface IWebSocketBulkJobDto extends IBulkJobParams {
  data: IWebSocketDataDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/dtos/workflow-job.dto.ts
Tamaño: 1406 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DiscoverWorkflowOutput } from '@novu/framework/internal';
import {
  AddressingTypeEnum,
  ContextPayload,
  StatelessControls,
  TriggerOverrides,
  TriggerRecipientSubscriber,
  TriggerRecipientsPayload,
  TriggerRequestCategoryEnum,
  TriggerTenantContext,
} from '@novu/shared';
import { IBulkJobParams, IJobParams } from '../services/queues/queue-base.service';

export type AddressingBroadcast = {
  addressingType: AddressingTypeEnum.BROADCAST;
};

export type AddressingMulticast = {
  to: TriggerRecipientsPayload;
  addressingType: AddressingTypeEnum.MULTICAST;
};

type Addressing = AddressingBroadcast | AddressingMulticast;

export type IWorkflowDataDto = {
  environmentId: string;
  organizationId: string;
  userId: string;
  // TODO: remove optional flag after all the workers are migrated to use requestId NV-6475
  requestId?: string;
  identifier: string;
  payload: any;
  overrides: TriggerOverrides;
  transactionId: string;
  actor?: TriggerRecipientSubscriber | null;
  tenant?: TriggerTenantContext | null;
  context?: ContextPayload;
  requestCategory?: TriggerRequestCategoryEnum;
  bridgeUrl?: string;
  bridgeWorkflow?: DiscoverWorkflowOutput;
  controls?: StatelessControls;
} & Addressing;

export interface IWorkflowJobDto extends IJobParams {
  data?: IWorkflowDataDto;
}

export interface IWorkflowBulkJobDto extends IBulkJobParams {
  data: IWorkflowDataDto;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/encryption/cipher.spec.ts
Tamaño: 508 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { decrypt, encrypt } from './cipher';

describe('Encrypt secret', () => {
  it('should encrypt a credential', async () => {
    const password = '123';
    const encrypted = encrypt(password);

    expect(encrypted).not.toEqual(password);
    expect(encrypted.length).toEqual(65);
  });

  it('should decrypt a credential', async () => {
    const password = '123';
    const encrypted = encrypt(password);
    const decrypted = decrypt(encrypted);

    expect(decrypted).toEqual(password);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - encrypted(encrypt(password);

    expect(encrypted).not.toEqual(password);
    expect(encrypted.length).toEqua...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/encryption/cipher.ts
Tamaño: 976 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createCipheriv, createDecipheriv, randomBytes } from 'crypto';

const IV_LENGTH = 16;
const CIPHER_ALGO = 'aes-256-cbc';

export function encrypt(text) {
  const ENCRYPTION_KEY = process.env.STORE_ENCRYPTION_KEY;
  const iv = randomBytes(IV_LENGTH);
  const cipher = createCipheriv(CIPHER_ALGO, Buffer.from(ENCRYPTION_KEY), iv);
  let encrypted = cipher.update(text);

  encrypted = Buffer.concat([encrypted, cipher.final()]);

  return `${iv.toString('hex')}:${encrypted.toString('hex')}`;
}

export function decrypt(text) {
  const ENCRYPTION_KEY = process.env.STORE_ENCRYPTION_KEY;
  const textParts = text.split(':');
  const iv = Buffer.from(textParts.shift(), 'hex');
  const encryptedText = Buffer.from(textParts.join(':'), 'hex');
  const decipher = createDecipheriv(CIPHER_ALGO, Buffer.from(ENCRYPTION_KEY), iv);
  let decrypted = decipher.update(encryptedText);

  decrypted = Buffer.concat([decrypted, decipher.final()]);

  return decrypted.toString();
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - encrypt(text)
 - decrypt(text)
Declaraciones 'export' encontradas:
- export function encrypt
- export function decrypt

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/encryption/encrypt-provider.spec.ts
Tamaño: 2018 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ICredentialsDto } from '@novu/shared';
import { decryptCredentials, decryptSecret, encryptCredentials, encryptSecret } from './encrypt-provider';

describe('Encrypt provider secrets', () => {
  const novuSubMask = 'nvsk.';

  it('should encrypt provider secret', async () => {
    const password = '1234';
    const encrypted = encryptSecret(password);

    expect(encrypted).toContain(novuSubMask);
    expect(encrypted).not.toEqual(password);
    expect(encrypted.length).toEqual(70);
  });

  it('should decrypt provider secret', async () => {
    const password = '123';
    const encrypted = encryptSecret(password);
    const decrypted = decryptSecret(encrypted);

    expect(decrypted).toEqual(password);
  });
});

describe('Encrypt provider credentials', () => {
  const novuSubMask = 'nvsk.';

  it('should encrypt provider credentials', async () => {
    const credentials: ICredentialsDto = {
      apiKey: 'api_123',
      user: 'Jock Wick',
      secretKey: 'secret_coins',
      domain: 'hollywood',
    };

    const encrypted = encryptCredentials(credentials);

    expect(encrypted.apiKey).toContain(novuSubMask);
    expect(encrypted.apiKey).not.toEqual(credentials.apiKey);
    expect(encrypted.user).toEqual(credentials.user);
    expect(encrypted.secretKey).toContain(novuSubMask);
    expect(encrypted.secretKey).not.toEqual(credentials.secretKey);
    expect(encrypted.domain).toEqual(credentials.domain);
  });

  it('should decrypt provider credentials', async () => {
    const credentials: ICredentialsDto = {
      apiKey: 'api_123',
      user: 'Jock Wick',
      secretKey: 'secret_coins',
      domain: 'hollywood',
    };

    const encrypted = encryptCredentials(credentials);
    const decrypted = decryptCredentials(encrypted);

    expect(decrypted.apiKey).toEqual(credentials.apiKey);
    expect(decrypted.user).toEqual(credentials.user);
    expect(decrypted.secretKey).toEqual(credentials.secretKey);
    expect(decrypted.domain).toEqual(credentials.domain);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - novuSubMask('nvsk.';

  it('should encrypt provider secret', async ())
 - encrypted(encryptSecret(password);

    expect(encrypted).toContain(novuSubMask);
    expect(encrypted).not.to...)
 - decrypted(decryptSecret(encrypted);

    expect(decrypted).toEqual(password);
  });
});

describe('Encrypt pro...)
 - novuSubMask('nvsk.';

  it('should encrypt provider credentials', async ())
 - encrypted(encryptCredentials(credentials);

    expect(encrypted.apiKey).toContain(novuSubMask);
    expect(en...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/encryption/encrypt-provider.ts
Tamaño: 1854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EncryptedSecret, ICredentialsDto, NOVU_ENCRYPTION_SUB_MASK, secureCredentials } from '@novu/shared';

import { decrypt, encrypt } from './cipher';

export function encryptSecret(text: string): EncryptedSecret {
  const encrypted = encrypt(text);

  return `${NOVU_ENCRYPTION_SUB_MASK}${encrypted}`;
}

export function decryptSecret(text: string | EncryptedSecret): string {
  let encryptedSecret = text;

  if (isNovuEncrypted(text)) {
    encryptedSecret = text.slice(NOVU_ENCRYPTION_SUB_MASK.length);
  }

  return decrypt(encryptedSecret);
}

export function encryptCredentials(credentials: ICredentialsDto): ICredentialsDto {
  const encryptedCredentials: ICredentialsDto = {};

  for (const key in credentials) {
    encryptedCredentials[key] = isCredentialEncryptionRequired(key)
      ? encryptSecret(credentials[key])
      : credentials[key];
  }

  return encryptedCredentials;
}

export function decryptCredentials(credentials: ICredentialsDto): ICredentialsDto {
  const decryptedCredentials: ICredentialsDto = {};

  for (const key in credentials) {
    decryptedCredentials[key] =
      typeof credentials[key] === 'string' && isNovuEncrypted(credentials[key])
        ? decryptSecret(credentials[key])
        : credentials[key];
  }

  return decryptedCredentials;
}

export function encryptApiKey(apiKey: string): EncryptedSecret {
  if (isNovuEncrypted(apiKey)) {
    return apiKey;
  }

  return encryptSecret(apiKey);
}

export function decryptApiKey(apiKey: string): string {
  if (isNovuEncrypted(apiKey)) {
    return decryptSecret(apiKey);
  }

  return apiKey;
}

function isNovuEncrypted(text: string): text is EncryptedSecret {
  return text.startsWith(NOVU_ENCRYPTION_SUB_MASK);
}

function isCredentialEncryptionRequired(key: string): boolean {
  return secureCredentials.some((secureCred) => secureCred === key);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - encryptSecret(text: string)
 - decryptSecret(text: string | EncryptedSecret)
 - encryptCredentials(credentials: ICredentialsDto)
 - decryptCredentials(credentials: ICredentialsDto)
 - encryptApiKey(apiKey: string)
 - decryptApiKey(apiKey: string)
 - isNovuEncrypted(text: string)
 - isCredentialEncryptionRequired(key: string)
Declaraciones 'export' encontradas:
- export function encryptSecret
- export function decryptSecret
- export function encryptCredentials
- export function decryptCredentials
- export function encryptApiKey
- export function decryptApiKey

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/encryption/index.ts
Tamaño: 36 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './encrypt-provider';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/channel.factory.ts
Tamaño: 2511 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, NotFoundException } from '@nestjs/common';
import { IntegrationEntity } from '@novu/dal';
import { ChatFactory } from './chat/chat.factory';
import { IChatHandler } from './chat/interfaces';
import { IMailHandler } from './mail/interfaces';
import { MailFactory } from './mail/mail.factory';
import { IPushHandler } from './push/interfaces';
import { PushFactory } from './push/push.factory';
import { ISmsHandler } from './sms/interfaces';
import { SmsFactory } from './sms/sms.factory';

export type ChannelHandler = IMailHandler | ISmsHandler | IChatHandler | IPushHandler;

export interface IChannelHandlerOptions {
  from?: string;
}

export interface IChannelFactory {
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>,
    channelType: 'email' | 'sms' | 'chat' | 'push',
    options?: IChannelHandlerOptions
  ): ChannelHandler;
}

@Injectable()
export class ChannelFactory implements IChannelFactory {
  private readonly mailFactory: MailFactory;
  private readonly smsFactory: SmsFactory;
  private readonly chatFactory: ChatFactory;
  private readonly pushFactory: PushFactory;

  constructor() {
    this.mailFactory = new MailFactory();
    this.smsFactory = new SmsFactory();
    this.chatFactory = new ChatFactory();
    this.pushFactory = new PushFactory();
  }

  // Each getHandler call creates a new provider instance
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>,
    channelType: 'email' | 'sms' | 'chat' | 'push',
    options: IChannelHandlerOptions = {}
  ): ChannelHandler {
    let handler: ChannelHandler | null = null;

    switch (channelType) {
      case 'email': {
        handler = this.mailFactory.getHandler(integration, options.from);
        break;
      }
      case 'sms': {
        handler = this.smsFactory.getHandler(integration);
        break;
      }
      case 'chat': {
        handler = this.chatFactory.getHandler(integration);
        break;
      }
      case 'push': {
        handler = this.pushFactory.getHandler(integration);
        break;
      }
      default: {
        throw new BadRequestException(`Channel type '${channelType}' is not supported`);
      }
    }

    if (!handler) {
      throw new NotFoundException(
        `Handler for integration provider '${integration.providerId}' in channel '${channelType}' was not found`
      );
    }

    return handler;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  interface
- export  interface
- export class ChannelFactory

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/index.ts
Tamaño: 308 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './channel.factory';
export * from './chat/chat.factory';
export * from './mail/interfaces';
export * from './mail/mail.factory';
export * from './push/interfaces/push.handler.interface';
export * from './push/push.factory';
export * from './sms/interfaces';
export * from './sms/sms.factory';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/chat.factory.ts
Tamaño: 1687 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import { ChatWebhookHandler } from './handlers/chat-webhook.handler';
import { DiscordHandler } from './handlers/discord.handler';
import { GetstreamChatHandler } from './handlers/getstream.handler';
import { GrafanaOnCallHandler } from './handlers/grafana-on-call.handler';
import { MattermostHandler } from './handlers/mattermost.handler';
import { MSTeamsHandler } from './handlers/msteams.handler';
import { NovuSlackHandler } from './handlers/novu-slack.handler';
import { RocketChatHandler } from './handlers/rocket-chat.handler';
import { RyverHandler } from './handlers/ryver.handler';
import { SlackHandler } from './handlers/slack.handler';
import { WhatsAppBusinessHandler } from './handlers/whatsapp-business.handler';
import { ZulipHandler } from './handlers/zulip.handler';
import { IChatFactory, IChatHandler } from './interfaces';

export class ChatFactory implements IChatFactory {
  handlers: IChatHandler[] = [
    new ChatWebhookHandler(),
    new SlackHandler(),
    new NovuSlackHandler(),
    new DiscordHandler(),
    new MSTeamsHandler(),
    new MattermostHandler(),
    new RyverHandler(),
    new ZulipHandler(),
    new GrafanaOnCallHandler(),
    new GetstreamChatHandler(),
    new RocketChatHandler(),
    new WhatsAppBusinessHandler(),
  ];

  getHandler(integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>) {
    const handler =
      this.handlers.find((handlerItem) => handlerItem.canHandle(integration.providerId, integration.channel)) ?? null;

    if (!handler) return null;

    handler.buildProvider(integration.credentials);

    return handler;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - handler(this.handlers.find((handlerItem))
Declaraciones 'export' encontradas:
- export class ChatFactory

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/base.handler.ts
Tamaño: 762 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChatProviderIdEnum } from '@novu/shared';
import { IChatOptions, IChatProvider } from '@novu/stateless';
import { BaseHandler } from '../../shared/interfaces';
import { IChatHandler } from '../interfaces';

export abstract class BaseChatHandler extends BaseHandler<IChatProvider> implements IChatHandler {
  protected provider: IChatProvider;

  protected constructor(providerId: ChatProviderIdEnum, channelType: string) {
    super(providerId, channelType);
  }

  abstract buildProvider(credentials);

  async send(chatContent: IChatOptions) {
    if (process.env.NODE_ENV === 'test') {
      return {};
    }

    const { bridgeProviderData, ...content } = chatContent;

    return await this.provider.sendMessage(content, bridgeProviderData);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/chat-webhook.handler.ts
Tamaño: 546 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChatWebhookProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';

import { BaseChatHandler } from './base.handler';

export class ChatWebhookHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.ChatWebhook, ChannelTypeEnum.CHAT);
  }

  buildProvider(credentials: ICredentials) {
    const config = {
      hmacSecretKey: credentials.secretKey,
    };

    this.provider = new ChatWebhookProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChatWebhookHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/discord.handler.ts
Tamaño: 453 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DiscordProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class DiscordHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Discord, ChannelTypeEnum.CHAT);
  }

  buildProvider(_credentials: ICredentials) {
    this.provider = new DiscordProvider({});
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DiscordHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/getstream.handler.ts
Tamaño: 580 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { GetstreamChatProvider } from '@novu/providers';

import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class GetstreamChatHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.GetStream, ChannelTypeEnum.CHAT);
  }

  buildProvider(credentials: ICredentials) {
    const config: {
      apiKey: string;
    } = {
      apiKey: credentials.apiKey as string,
    };
    this.provider = new GetstreamChatProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetstreamChatHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/grafana-on-call.handler.ts
Tamaño: 494 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { GrafanaOnCallChatProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';

import { BaseChatHandler } from './base.handler';

export class GrafanaOnCallHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.GrafanaOnCall, ChannelTypeEnum.CHAT);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new GrafanaOnCallChatProvider(credentials);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GrafanaOnCallHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/mattermost.handler.ts
Tamaño: 463 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MattermostProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class MattermostHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Mattermost, ChannelTypeEnum.CHAT);
  }

  buildProvider(_credentials: ICredentials) {
    this.provider = new MattermostProvider();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MattermostHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/msteams.handler.ts
Tamaño: 453 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MsTeamsProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class MSTeamsHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.MsTeams, ChannelTypeEnum.CHAT);
  }

  buildProvider(_credentials: ICredentials) {
    this.provider = new MsTeamsProvider({});
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MSTeamsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/novu-slack.handler.ts
Tamaño: 373 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SlackProvider } from '@novu/providers';
import { ChannelTypeEnum, ChatProviderIdEnum } from '@novu/shared';

import { BaseChatHandler } from './base.handler';

export class NovuSlackHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Novu, ChannelTypeEnum.CHAT);
  }

  buildProvider() {
    this.provider = new SlackProvider();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NovuSlackHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/rocket-chat.handler.ts
Tamaño: 611 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { RocketChatProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class RocketChatHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.RocketChat, ChannelTypeEnum.CHAT);
  }

  buildProvider(credentials: ICredentials) {
    const config: { token: string; user: string } = {
      token: credentials.token as string,
      user: credentials.user as string,
    };
    this.provider = new RocketChatProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RocketChatHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/ryver.handler.ts
Tamaño: 451 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { RyverChatProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class RyverHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Ryver, ChannelTypeEnum.CHAT);
  }

  buildProvider(_credentials: ICredentials) {
    this.provider = new RyverChatProvider();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RyverHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/slack.handler.ts
Tamaño: 433 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SlackProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';

import { BaseChatHandler } from './base.handler';

export class SlackHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Slack, ChannelTypeEnum.CHAT);
  }

  buildProvider(_: ICredentials) {
    this.provider = new SlackProvider();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SlackHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/whatsapp-business.handler.ts
Tamaño: 580 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { WhatsappBusinessChatProvider } from '@novu/providers';
import { ChannelTypeEnum, ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseChatHandler } from './base.handler';

export class WhatsAppBusinessHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.WhatsAppBusiness, ChannelTypeEnum.CHAT);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new WhatsappBusinessChatProvider({
      accessToken: credentials.apiToken,
      phoneNumberIdentification: credentials.phoneNumberIdentification,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WhatsAppBusinessHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/handlers/zulip.handler.ts
Tamaño: 445 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ZulipProvider } from '@novu/providers';
import { ChatProviderIdEnum, ICredentials } from '@novu/shared';
import { ChannelTypeEnum } from '@novu/stateless';
import { BaseChatHandler } from './base.handler';

export class ZulipHandler extends BaseChatHandler {
  constructor() {
    super(ChatProviderIdEnum.Zulip, ChannelTypeEnum.CHAT);
  }

  buildProvider(_credentials: ICredentials) {
    this.provider = new ZulipProvider({});
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ZulipHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/chat/interfaces/index.ts
Tamaño: 644 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import { ChannelTypeEnum, ICredentials } from '@novu/shared';
import { IChatOptions, ISendMessageSuccessResponse } from '@novu/stateless';
import { IHandler } from '../../shared/interfaces';

export interface IChatHandler extends IHandler {
  canHandle(providerId: string, channelType: ChannelTypeEnum);
  buildProvider(credentials: ICredentials);
  send(chatData: IChatOptions): Promise<ISendMessageSuccessResponse>;
}

export interface IChatFactory {
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>
  ): IChatHandler | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/mail.factory.ts
Tamaño: 1649 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import {
  BrazeEmailHandler,
  EmailJsHandler,
  EmailWebhookHandler,
  InfobipEmailHandler,
  MailerSendHandler,
  MailgunHandler,
  MailjetHandler,
  MailtrapHandler,
  MandrillHandler,
  NetCoreHandler,
  NodemailerHandler,
  NovuEmailHandler,
  Outlook365Handler,
  PlunkHandler,
  PostmarkHandler,
  ResendHandler,
  SESHandler,
  SendgridHandler,
  SendinblueHandler,
  SparkPostHandler,
} from './handlers';
import { IMailFactory, IMailHandler } from './interfaces';

export class MailFactory implements IMailFactory {
  handlers: IMailHandler[] = [
    new SendgridHandler(),
    new MailgunHandler(),
    new NetCoreHandler(),
    new EmailJsHandler(),
    new MailjetHandler(),
    new MailtrapHandler(),
    new MandrillHandler(),
    new NodemailerHandler(),
    new PostmarkHandler(),
    new SendinblueHandler(),
    new SESHandler(),
    new InfobipEmailHandler(),
    new MailerSendHandler(),
    new Outlook365Handler(),
    new ResendHandler(),
    new PlunkHandler(),
    new SparkPostHandler(),
    new EmailWebhookHandler(),
    new NovuEmailHandler(),
    new BrazeEmailHandler(),
  ];

  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>,
    from?: string
  ): IMailHandler {
    const handler =
      this.handlers.find((handlerItem) => handlerItem.canHandle(integration.providerId, integration.channel)) ?? null;

    if (!handler) throw new Error('Handler for provider was not found');

    handler.buildProvider({ ...integration.credentials, ...integration.configurations }, from);

    return handler;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - handler(this.handlers.find((handlerItem))
Declaraciones 'export' encontradas:
- export class MailFactory

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/base.handler.ts
Tamaño: 2485 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EmailProviderIdEnum } from '@novu/shared';
import { IEmailEventBody, IEmailOptions, IEmailProvider } from '@novu/stateless';
import { PlatformException } from '../../../utils/exceptions';
import { BaseHandler } from '../../shared/interfaces';
import { IMailHandler } from '../interfaces';

export abstract class BaseEmailHandler extends BaseHandler<IEmailProvider> implements IMailHandler {
  protected provider: IEmailProvider;

  protected constructor(providerId: EmailProviderIdEnum, channelType: string) {
    super(providerId, channelType);
  }

  abstract buildProvider(credentials, options);

  async send(mailData: IEmailOptions) {
    if (process.env.NODE_ENV === 'test') {
      return {};
    }

    const { bridgeProviderData, ...otherOptions } = mailData;

    return await this.provider.sendMessage(otherOptions, bridgeProviderData);
  }

  public getProvider(): IEmailProvider {
    return this.provider;
  }

  public inboundWebhookEnabled(): boolean {
    return !!(this.provider.getMessageId && this.provider.parseEventBody);
  }

  public getMessageId(body: any): string[] {
    if (!this.provider.getMessageId) {
      return [];
    }

    return this.provider.getMessageId(body);
  }

  async verifySignature({
    body,
    headers,
    rawBody,
  }: {
    rawBody: any;
    body: any;
    headers: Record<string, string>;
  }): Promise<{
    success: boolean;
    message?: string;
  }> {
    if (!this.provider.verifySignature) {
      // in case verifySignature is not implemented, we return true
      return { success: true };
    }

    return this.provider.verifySignature({ body, headers, rawBody });
  }

  public parseEventBody(body: any, identifier: string): IEmailEventBody | undefined {
    if (!this.provider.parseEventBody) {
      return undefined;
    }

    return this.provider.parseEventBody(body, identifier);
  }

  async check() {
    const mailData: IEmailOptions = {
      html: '<div>checking integration</div>',
      subject: 'Checking Integration',
      to: ['no-reply@novu.co'],
    };

    const { message, success, code } = await this.provider.checkIntegration(mailData);

    if (!success) {
      throw new PlatformException(
        JSON.stringify({
          success,
          code,
          message: message || 'Something went wrong! Please double check your account details(Email/API key)',
        })
      );
    }

    return {
      success,
      code,
      message: 'Integration successful',
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/braze.handler.ts
Tamaño: 666 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BrazeEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class BrazeEmailHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Braze, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials) {
    const config: {
      apiKey: string;
      apiURL: string;
      appID: string;
    } = {
      apiKey: credentials.apiKey as string,
      apiURL: credentials.apiURL as string,
      appID: credentials.appID as string,
    };

    this.provider = new BrazeEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BrazeEmailHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/email-webhook.handler.ts
Tamaño: 720 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EmailWebhookProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class EmailWebhookHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.EmailWebhook, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials, from: string) {
    const config: {
      from: string;
      webhookUrl: string;
      hmacSecretKey?: string;
    } = {
      from: credentials.from as string,
      webhookUrl: credentials.webhookUrl as string,
      hmacSecretKey: credentials.secretKey as string,
    };
    this.provider = new EmailWebhookProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class EmailWebhookHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/emailjs.handler.ts
Tamaño: 891 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EmailJsProvider, IEmailJsConfig } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

/**
 * DEPRECATED:
 * This provider has been deprecated and will be removed in future version.
 * See: https://github.com/novuhq/novu/issues/2315
 */
export class EmailJsHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.EmailJS, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config: IEmailJsConfig = {
      from: from as string,
      host: credentials.host as string,
      port: Number(credentials.port),
      secure: credentials.secure as boolean,
      user: credentials.user as string,
      password: credentials.password as string,
    };

    this.provider = new EmailJsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class EmailJsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/index.ts
Tamaño: 712 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './braze.handler';
export * from './email-webhook.handler';
export * from './emailjs.handler';
export * from './infobip.handler';
export * from './mailersend.handler';
export * from './mailgun.handler';
export * from './mailjet.handler';
export * from './mailtrap.handler';
export * from './mandrill.handler';
export * from './netcore.handler';
export * from './nodemailer.handler';
export * from './novu.handler';
export * from './outlook365.handler';
export * from './plunk.handler';
export * from './postmark.handler';
export * from './resend.handler';
export * from './sendgrid.handler';
export * from './sendinblue.handler';
export * from './ses.handler';
export * from './sparkpost.handler';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/infobip.handler.ts
Tamaño: 665 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { InfobipEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class InfobipEmailHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Infobip, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials) {
    const config: {
      baseUrl: string;
      apiKey: string;
      from?: string;
    } = {
      baseUrl: credentials.baseUrl as string,
      apiKey: credentials.apiKey as string,
      from: credentials.from,
    };

    this.provider = new InfobipEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InfobipEmailHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/mailersend.handler.ts
Tamaño: 580 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MailersendEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';

import { BaseEmailHandler } from './base.handler';

export class MailerSendHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.MailerSend, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials, from?: string) {
    this.provider = new MailersendEmailProvider({
      apiKey: credentials.apiKey as string,
      from: from as string,
      senderName: credentials.senderName,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MailerSendHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/mailgun.handler.ts
Tamaño: 968 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MailgunEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, IConfigurations, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class MailgunHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Mailgun, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials & IConfigurations, from?: string) {
    const config: {
      apiKey: string;
      username: string;
      domain: string;
      from: string;
      baseUrl?: string;
      senderName: string;
      webhookSigningKey?: string;
    } = {
      apiKey: credentials.apiKey,
      username: credentials.user,
      domain: credentials.domain,
      baseUrl: credentials.baseUrl,
      senderName: credentials.senderName,
      webhookSigningKey: credentials.inboundWebhookSigningKey,
      from: from as string,
    };

    this.provider = new MailgunEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MailgunHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/mailjet.handler.ts
Tamaño: 756 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MailjetEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class MailjetHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Mailjet, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config: {
      apiKey: string;
      apiSecret: string;
      from: string;
      senderName: string;
    } = {
      from: from as string,
      apiKey: credentials.apiKey as string,
      apiSecret: credentials.secretKey as string,
      senderName: credentials.senderName as string,
    };

    this.provider = new MailjetEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MailjetHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/mailtrap.handler.ts
Tamaño: 590 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MailtrapEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class MailtrapHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Mailtrap, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials, from: string) {
    const config: { apiKey: string; from: string } = {
      from: from as string,
      apiKey: credentials.apiKey as string,
    };

    this.provider = new MailtrapEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MailtrapHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/mandrill.handler.ts
Tamaño: 652 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MandrillProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class MandrillHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Mandrill, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config: { apiKey: string; from: string; senderName: string } = {
      from: from as string,
      apiKey: credentials.apiKey as string,
      senderName: credentials.senderName as string,
    };

    this.provider = new MandrillProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MandrillHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/netcore.handler.ts
Tamaño: 629 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NetCoreProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class NetCoreHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.NetCore, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials, from?: string) {
    const config: { apiKey: string; from: string; senderName: string } = {
      apiKey: credentials.apiKey,
      from: from as string,
      senderName: credentials.senderName,
    };

    this.provider = new NetCoreProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NetCoreHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/nodemailer.handler.ts
Tamaño: 953 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NodemailerProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class NodemailerHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.CustomSMTP, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    this.provider = new NodemailerProvider({
      from,
      host: credentials.host,
      port: Number(credentials.port),
      secure: credentials.secure,
      user: credentials.user,
      password: credentials.password,
      requireTls: credentials.requireTls,
      ignoreTls: credentials.ignoreTls,
      tlsOptions: credentials.tlsOptions,
      dkim: {
        domainName: credentials.domain,
        keySelector: credentials.accountSid,
        privateKey: credentials.secretKey,
      },
      senderName: credentials.senderName,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NodemailerHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/novu.handler.ts
Tamaño: 557 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SendgridEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum } from '@novu/shared';

import { BaseEmailHandler } from './base.handler';

export class NovuEmailHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Novu, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials, from?: string) {
    this.provider = new SendgridEmailProvider({
      apiKey: credentials.apiKey,
      from,
      senderName: credentials.senderName,
      ipPoolName: credentials.ipPoolName,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NovuEmailHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/outlook365.handler.ts
Tamaño: 686 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Outlook365Provider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class Outlook365Handler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Outlook365, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials) {
    const config: {
      from: string;
      senderName: string;
      password: string;
    } = {
      from: credentials.from as string,
      senderName: credentials.senderName as string,
      password: credentials.password as string,
    };
    this.provider = new Outlook365Provider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class Outlook365Handler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/plunk.handler.ts
Tamaño: 574 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PlunkEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class PlunkHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Plunk, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials) {
    const config: { apiKey: string; senderName: string } = {
      apiKey: credentials.apiKey,
      senderName: credentials.senderName,
    };

    this.provider = new PlunkEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PlunkHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/postmark.handler.ts
Tamaño: 590 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PostmarkEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class PostmarkHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Postmark, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config: { apiKey: string; from: string } = {
      from: from as string,
      apiKey: credentials.apiKey as string,
    };

    this.provider = new PostmarkEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PostmarkHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/resend.handler.ts
Tamaño: 660 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ResendEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, IConfigurations, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class ResendHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Resend, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials & IConfigurations, from?: string) {
    this.provider = new ResendEmailProvider({
      from: from as string,
      apiKey: credentials.apiKey as string,
      senderName: credentials.senderName,
      webhookSigningKey: credentials.inboundWebhookSigningKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ResendHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/sendgrid.handler.ts
Tamaño: 685 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SendgridEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, IConfigurations, ICredentials } from '@novu/shared';

import { BaseEmailHandler } from './base.handler';

export class SendgridHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.SendGrid, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials & IConfigurations, from?: string) {
    this.provider = new SendgridEmailProvider({
      apiKey: credentials.apiKey,
      from,
      senderName: credentials.senderName,
      ipPoolName: credentials.ipPoolName,
      webhookPublicKey: credentials.inboundWebhookSigningKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendgridHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/sendinblue.handler.ts
Tamaño: 660 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BrevoEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class SendinblueHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.Sendinblue, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config: { apiKey: string; from: string; senderName: string } = {
      apiKey: credentials.apiKey as string,
      from: from as string,
      senderName: credentials.senderName as string,
    };

    this.provider = new BrevoEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendinblueHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/ses.handler.ts
Tamaño: 817 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SESConfig, SESEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, IConfigurations, ICredentials } from '@novu/shared';
import { BaseEmailHandler } from './base.handler';

export class SESHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.SES, ChannelTypeEnum.EMAIL);
  }

  buildProvider(credentials: ICredentials & IConfigurations, from?: string) {
    const config: SESConfig = {
      region: credentials.region as string,
      accessKeyId: credentials.apiKey as string,
      secretAccessKey: credentials.secretKey as string,
      senderName: credentials.senderName ?? 'no-reply',
      from: from as string,
      configurationSetName: credentials.configurationSetName,
    };

    this.provider = new SESEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SESHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/handlers/sparkpost.handler.ts
Tamaño: 657 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SparkPostEmailProvider } from '@novu/providers';
import { ChannelTypeEnum, EmailProviderIdEnum, ICredentials } from '@novu/shared';

import { BaseEmailHandler } from './base.handler';

export class SparkPostHandler extends BaseEmailHandler {
  constructor() {
    super(EmailProviderIdEnum.SparkPost, ChannelTypeEnum.EMAIL);
  }
  buildProvider(credentials: ICredentials, from?: string) {
    const config = {
      from: from as string,
      apiKey: credentials.apiKey as string,
      region: credentials.region as string,
      senderName: credentials.senderName as string,
    };

    this.provider = new SparkPostEmailProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SparkPostHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/mail/interfaces/index.ts
Tamaño: 823 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import { ChannelTypeEnum, IConfigurations, ICredentials, IEmailOptions } from '@novu/shared';
import { ICheckIntegrationResponse, IEmailProvider, ISendMessageSuccessResponse } from '@novu/stateless';
import { IHandler } from '../../shared/interfaces';

export interface IMailHandler extends IHandler {
  canHandle(providerId: string, channelType: ChannelTypeEnum);

  buildProvider(credentials: ICredentials & IConfigurations, from?: string);

  send(mailData: IEmailOptions): Promise<ISendMessageSuccessResponse>;

  getProvider(): IEmailProvider;

  check(): Promise<ICheckIntegrationResponse>;
}

export interface IMailFactory {
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>
  ): IMailHandler | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/push.factory.ts
Tamaño: 919 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import {
  APNSHandler,
  ExpoHandler,
  FCMHandler,
  OneSignalHandler,
  PusherBeamsHandler,
  PushpadHandler,
  PushWebhookHandler,
} from './handlers';
import { IPushFactory, IPushHandler } from './interfaces';

export class PushFactory implements IPushFactory {
  handlers: IPushHandler[] = [
    new FCMHandler(),
    new ExpoHandler(),
    new APNSHandler(),
    new OneSignalHandler(),
    new PushpadHandler(),
    new PushWebhookHandler(),
    new PusherBeamsHandler(),
  ];

  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>
  ): IPushHandler {
    const handler =
      this.handlers.find((handlerItem) => handlerItem.canHandle(integration.providerId, integration.channel)) ?? null;
    if (!handler) return null;

    handler.buildProvider(integration.credentials);

    return handler;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - handler(this.handlers.find((handlerItem))
Declaraciones 'export' encontradas:
- export class PushFactory

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/apns.handler.ts
Tamaño: 771 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { APNSPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class APNSHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.APNS, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.secretKey || !credentials.apiKey || !credentials.projectName) {
      throw new Error('Config is not valid for apns');
    }
    this.provider = new APNSPushProvider({
      key: credentials.secretKey,
      keyId: credentials.apiKey,
      teamId: credentials.projectName,
      bundleId: credentials.applicationId as string,
      production: credentials.secure ?? false,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class APNSHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/base.handler.ts
Tamaño: 792 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ICredentials, PushProviderIdEnum } from '@novu/shared';
import { IPushOptions, IPushProvider } from '@novu/stateless';
import { BaseHandler } from '../../shared/interfaces';
import { IPushHandler } from '../interfaces';

export abstract class BasePushHandler extends BaseHandler<IPushProvider> implements IPushHandler {
  protected provider: IPushProvider;

  protected constructor(providerId: PushProviderIdEnum, channelType: string) {
    super(providerId, channelType);
  }

  async send(options: IPushOptions) {
    if (process.env.NODE_ENV === 'test') {
      return {};
    }

    const { bridgeProviderData, ...otherOptions } = options;

    return await this.provider.sendMessage(otherOptions, bridgeProviderData);
  }

  abstract buildProvider(credentials: ICredentials);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/expo.handler.ts
Tamaño: 547 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExpoPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class ExpoHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.EXPO, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.apiKey) {
      throw Error('Config is not valid for expo');
    }

    this.provider = new ExpoPushProvider({
      accessToken: credentials.apiKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExpoHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/fcm.handler.ts
Tamaño: 1001 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FcmPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class FCMHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.FCM, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    const credentialConfig: IFcmConfig = {
      user: credentials.user,
      serviceAccount: credentials.serviceAccount,
    };

    const updatedCredentials = credentialConfig.serviceAccount
      ? credentialConfig.serviceAccount
      : credentialConfig.user;

    if (!updatedCredentials) {
      throw new Error('Config is not valid for fcm');
    }

    const config = JSON.parse(updatedCredentials);
    this.provider = new FcmPushProvider({
      projectId: config.project_id,
      email: config.client_email,
      secretKey: config.private_key,
    });
  }
}

interface IFcmConfig {
  user?: string;
  serviceAccount?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FCMHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/index.ts
Tamaño: 248 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './apns.handler';
export * from './expo.handler';
export * from './fcm.handler';
export * from './one-signal.handler';
export * from './push-webhook.handler';
export * from './pusher-beams.handler';
export * from './pushpad.handler';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/one-signal.handler.ts
Tamaño: 718 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { OneSignalPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class OneSignalHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.OneSignal, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.apiKey || !credentials.applicationId) {
      throw Error('Config is not valid for OneSignal');
    }

    this.provider = new OneSignalPushProvider({
      appId: credentials.applicationId,
      apiKey: credentials.apiKey,
      apiVersion: credentials.apiVersion as 'externalId' | 'playerModel' | null,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class OneSignalHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/push-webhook.handler.ts
Tamaño: 669 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PushWebhookPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class PushWebhookHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.PushWebhook, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.webhookUrl || !credentials.secretKey) {
      throw Error('Config is not valid for push-webhook provider');
    }

    this.provider = new PushWebhookPushProvider({
      webhookUrl: credentials.webhookUrl,
      hmacSecretKey: credentials.secretKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PushWebhookHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/pusher-beams.handler.ts
Tamaño: 656 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PusherBeamsPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class PusherBeamsHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.PusherBeams, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.instanceId || !credentials.secretKey) {
      throw Error('Config is not valid for Pusher Beams');
    }

    this.provider = new PusherBeamsPushProvider({
      instanceId: credentials.instanceId,
      secretKey: credentials.secretKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PusherBeamsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/handlers/pushpad.handler.ts
Tamaño: 627 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PushpadPushProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, PushProviderIdEnum } from '@novu/shared';
import { BasePushHandler } from './base.handler';

export class PushpadHandler extends BasePushHandler {
  constructor() {
    super(PushProviderIdEnum.Pushpad, ChannelTypeEnum.PUSH);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.apiKey || !credentials.applicationId) {
      throw Error('Config is not valid for Pushpad');
    }

    this.provider = new PushpadPushProvider({
      appId: credentials.applicationId,
      apiKey: credentials.apiKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PushpadHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/interfaces/index.ts
Tamaño: 84 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './push.factory.interface';
export * from './push.handler.interface';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/interfaces/push.factory.interface.ts
Tamaño: 281 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import { IPushHandler } from './push.handler.interface';

export interface IPushFactory {
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>
  ): IPushHandler | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/push/interfaces/push.handler.interface.ts
Tamaño: 424 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, ICredentials } from '@novu/shared';
import { IPushOptions, ISendMessageSuccessResponse } from '@novu/stateless';
import { IHandler } from '../../shared/interfaces';

export interface IPushHandler extends IHandler {
  canHandle(providerId: string, channelType: ChannelTypeEnum);

  buildProvider(credentials: ICredentials);

  send(smsOptions: IPushOptions): Promise<ISendMessageSuccessResponse>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/shared/interfaces.ts
Tamaño: 3068 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, IConfigurations } from '@novu/shared';
import { ChannelProvider, IEmailEventBody, ISMSEventBody } from '@novu/stateless';

export interface IHandler {
  inboundWebhookEnabled(): boolean;

  getMessageId: (body: unknown | unknown[]) => string[];

  parseEventBody: (body: unknown | unknown[], identifier: string) => IEmailEventBody | ISMSEventBody | undefined;

  verifySignature: ({
    body,
    headers,
    rawBody,
  }: {
    body: Record<string, unknown>;
    headers: Record<string, string>;
    rawBody: unknown;
  }) => Promise<{ success: boolean; message?: string }>;

  autoConfigureInboundWebhook: (configurations: { webhookUrl: string }) => Promise<{
    success: boolean;
    message?: string;
    configurations?: IConfigurations;
  }>;
}

export abstract class BaseHandler<T extends ChannelProvider = ChannelProvider> implements IHandler {
  protected provider: T;
  protected providerId: string;
  protected channelType: string;

  protected constructor(providerId?: string, channelType?: string) {
    this.providerId = providerId;
    this.channelType = channelType;
  }

  canHandle(providerId: string, channelType: ChannelTypeEnum): boolean {
    return providerId === this.providerId && channelType === this.channelType;
  }

  public getProvider(): T {
    return this.provider;
  }

  public inboundWebhookEnabled(): boolean {
    return !!(this.provider?.getMessageId && this.provider?.parseEventBody);
  }

  public getMessageId(body: unknown | unknown[]): string[] {
    if (!this.provider?.getMessageId) {
      return [];
    }

    return this.provider.getMessageId(body);
  }

  public parseEventBody(body: unknown | unknown[], identifier: string): IEmailEventBody | ISMSEventBody | undefined {
    if (!this.provider?.parseEventBody) {
      return undefined;
    }

    const result = this.provider.parseEventBody(body, identifier);

    return result && typeof result === 'object' ? (result as IEmailEventBody | ISMSEventBody) : undefined;
  }

  public async verifySignature({
    rawBody,
    headers,
    body,
  }: {
    rawBody: unknown;
    headers?: Record<string, string>;
    body?: Record<string, unknown>;
  }): Promise<{ success: boolean; message?: string }> {
    if (!this.provider?.verifySignature) {
      // in case verifySignature is not implemented, we return true
      return { success: true, message: 'A support of signature verification is not implemented by provider' };
    }

    return this.provider.verifySignature({ rawBody, headers, body });
  }

  public async autoConfigureInboundWebhook(configurations: { webhookUrl: string }): Promise<{
    success: boolean;
    message?: string;
    configurations?: IConfigurations;
  }> {
    if (!this.provider?.autoConfigureInboundWebhook) {
      return Promise.resolve({
        success: false,
        message:
          'A support of auto-configuration of inbound webhook is not implemented by provider, manual configuration is required',
      });
    }

    return this.provider.autoConfigureInboundWebhook(configurations);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/sms.factory.ts
Tamaño: 2332 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import {
  AfricasTalkingSmsHandler,
  AfroSmsHandler,
  AzureSmsHandler,
  BandwidthHandler,
  BrevoSmsHandler,
  BulkSmsHandler,
  BurstSmsHandler,
  ClickatellHandler,
  ClicksendSmsHandler,
  EazySmsHandler,
  FiretextSmsHandler,
  FortySixElksHandler,
  GenericSmsHandler,
  GupshupSmsHandler,
  IMediaHandler,
  InfobipSmsHandler,
  ISendSmsHandler,
  KannelSmsHandler,
  MaqsamHandler,
  MessageBirdHandler,
  MobishastraHandler,
  NexmoHandler,
  NovuSmsHandler,
  PlivoHandler,
  RingCentralHandler,
  SendchampSmsHandler,
  SimpletextingSmsHandler,
  SinchHandler,
  Sms77Handler,
  SmsCentralHandler,
  SnsHandler,
  TelnyxHandler,
  TermiiSmsHandler,
  TwilioHandler,
  UnifonicHandler,
} from './handlers';
import { SmsmodeHandler } from './handlers/smsmode.handler';
import { ISmsFactory, ISmsHandler } from './interfaces';

export class SmsFactory implements ISmsFactory {
  handlers: ISmsHandler[] = [
    new SnsHandler(),
    new TelnyxHandler(),
    new TwilioHandler(),
    new Sms77Handler(),
    new TermiiSmsHandler(),
    new PlivoHandler(),
    new ClickatellHandler(),
    new GupshupSmsHandler(),
    new FiretextSmsHandler(),
    new IMediaHandler(),
    new InfobipSmsHandler(),
    new BurstSmsHandler(),
    new FortySixElksHandler(),
    new KannelSmsHandler(),
    new MaqsamHandler(),
    new SmsCentralHandler(),
    new AfricasTalkingSmsHandler(),
    new SendchampSmsHandler(),
    new ClicksendSmsHandler(),
    new SimpletextingSmsHandler(),
    new SinchHandler(),
    new BandwidthHandler(),
    new GenericSmsHandler(),
    new MessageBirdHandler(),
    new AzureSmsHandler(),
    new NovuSmsHandler(),
    new NexmoHandler(),
    new ISendSmsHandler(),
    new RingCentralHandler(),
    new BrevoSmsHandler(),
    new EazySmsHandler(),
    new MobishastraHandler(),
    new AfroSmsHandler(),
    new UnifonicHandler(),
    new SmsmodeHandler(),
    new BulkSmsHandler(),
  ];

  getHandler(integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>) {
    const handler =
      this.handlers.find((handlerItem) => handlerItem.canHandle(integration.providerId, integration.channel)) ?? null;

    if (!handler) return null;

    handler.buildProvider(integration.credentials);

    return handler;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - handler(this.handlers.find((handlerItem))
Declaraciones 'export' encontradas:
- export class SmsFactory

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/africas-talking.handler.ts
Tamaño: 703 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AfricasTalkingSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class AfricasTalkingSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.AfricasTalking, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.user || !credentials.apiKey || !credentials.from) {
      throw Error('Invalid credentials');
    }

    const config = {
      apiKey: credentials.apiKey,
      username: credentials.user,
      from: credentials.from,
    };

    this.provider = new AfricasTalkingSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AfricasTalkingSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/afro-sms.handler.ts
Tamaño: 524 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AfroSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class AfroSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.AfroSms, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new AfroSmsProvider({
      apiKey: credentials.apiKey,
      senderName: credentials.senderName,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AfroSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/azure-sms.handler.ts
Tamaño: 587 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AzureSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class AzureSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.AzureSms, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.accessKey) {
      throw new Error('Access key is undefined');
    }
    const config = {
      connectionString: credentials.accessKey,
    };

    this.provider = new AzureSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class AzureSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/bandwidth.handler.ts
Tamaño: 573 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BandwidthSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class BandwidthHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Bandwidth, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = {
      username: credentials.user,
      password: credentials.password,
      accountId: credentials.accountSid,
    };

    this.provider = new BandwidthSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BandwidthHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/base.handler.ts
Tamaño: 923 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { ISmsOptions, ISmsProvider } from '@novu/stateless';
import { BaseHandler } from '../../shared/interfaces';
import { ISmsHandler } from '../interfaces';

export abstract class BaseSmsHandler extends BaseHandler<ISmsProvider> implements ISmsHandler {
  protected provider: ISmsProvider;

  protected constructor(providerId: SmsProviderIdEnum, channelType: string) {
    super(providerId, channelType);
  }

  public getProvider(): ISmsProvider {
    return this.provider;
  }

  async send(options: ISmsOptions) {
    if (process.env.NODE_ENV === 'test') {
      throw new Error('Currently 3rd-party packages test are not support on test env');
    }

    const { bridgeProviderData, ...otherOptions } = options;

    return await this.provider.sendMessage(otherOptions, bridgeProviderData);
  }

  abstract buildProvider(credentials: ICredentials);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/brevo-sms.handler.ts
Tamaño: 614 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BrevoSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class BrevoSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.BrevoSms, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    if (!credentials.apiKey || !credentials.from) {
      throw Error('Invalid credentials');
    }

    const config = {
      apiKey: credentials.apiKey,
      from: credentials.from,
    };

    this.provider = new BrevoSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BrevoSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/bulk-sms.handler.ts
Tamaño: 512 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BulkSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class BulkSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.BulkSms, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    const config = {
      apiToken: credentials.apiToken,
      from: credentials.from,
    };
    this.provider = new BulkSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BulkSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/burst-sms.handler.ts
Tamaño: 495 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BurstSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class BurstSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.BurstSms, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new BurstSmsProvider({
      apiKey: credentials.apiKey,
      secretKey: credentials.secretKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BurstSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/clickatell.handler.ts
Tamaño: 458 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClickatellSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class ClickatellHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Clickatell, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new ClickatellSmsProvider({ apiKey: credentials.apiKey });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ClickatellHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/clicksend.handler.ts
Tamaño: 531 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClicksendSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class ClicksendSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Clicksend, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = {
      username: credentials.user,
      apiKey: credentials.apiKey,
    };

    this.provider = new ClicksendSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ClicksendSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/eazy-sms.handler.ts
Tamaño: 519 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EazySmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class EazySmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.EazySms, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = {
      apiKey: credentials.apiKey,
      channelId: credentials.channelId,
    };
    this.provider = new EazySmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class EazySmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/firetext.handler.ts
Tamaño: 495 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FiretextSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class FiretextSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Firetext, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new FiretextSmsProvider({
      apiKey: credentials.apiKey,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FiretextSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/forty-six-elks.handler.ts
Tamaño: 541 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FortySixElksSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class FortySixElksHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.FortySixElks, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new FortySixElksSmsProvider({
      user: credentials.user,
      password: credentials.password,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FortySixElksHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/generic-sms.handler.ts
Tamaño: 928 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { GenericSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class GenericSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.GenericSms, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new GenericSmsProvider({
      baseUrl: credentials.baseUrl,
      apiKey: credentials.apiKey,
      secretKey: credentials.secretKey,
      from: credentials.from,
      apiKeyRequestHeader: credentials.apiKeyRequestHeader,
      secretKeyRequestHeader: credentials.secretKeyRequestHeader,
      idPath: credentials.idPath,
      datePath: credentials.datePath,
      domain: credentials.domain,
      authenticateByToken: credentials.authenticateByToken,
      authenticationTokenKey: credentials.authenticationTokenKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GenericSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/gupshup.handler.ts
Tamaño: 497 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { GupshupSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class GupshupSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Gupshup, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new GupshupSmsProvider({
      userId: credentials.user,
      password: credentials.password,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GupshupSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/imedia.handler.ts
Tamaño: 482 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IMediaSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class IMediaHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.IMedia, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new IMediaSmsProvider({
      token: credentials.token,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class IMediaHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/index.ts
Tamaño: 1268 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './africas-talking.handler';
export * from './afro-sms.handler';
export * from './azure-sms.handler';
export * from './bandwidth.handler';
export * from './brevo-sms.handler';
export * from './bulk-sms.handler';
export * from './burst-sms.handler';
export * from './clickatell.handler';
export * from './clicksend.handler';
export * from './eazy-sms.handler';
export * from './firetext.handler';
export * from './forty-six-elks.handler';
export * from './generic-sms.handler';
export * from './gupshup.handler';
export * from './imedia.handler';
export * from './infobip.handler';
export * from './isend-sms.handler';
export * from './kannel.handler';
export * from './maqsam.handler';
export * from './messagebird.handler';
export * from './mobishastra.handler';
export * from './nexmo.handler';
export * from './novu.handler';
export * from './plivo.handler';
export * from './ring-central.handler';
export * from './sendchamp.handler';
export * from './simpletexting.handler';
export * from './sinch.handler';
export * from './sms-central.handler';
export * from './sms77.handler';
export * from './sns.handler';
export * from './telnyx.handler';
export * from './termii.handler';
export * from './twilio.handler';
export * from './unifonic.handler';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/infobip.handler.ts
Tamaño: 526 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { InfobipSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class InfobipSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Infobip, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new InfobipSmsProvider({
      baseUrl: credentials.baseUrl,
      apiKey: credentials.apiKey,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InfobipSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/isend-sms.handler.ts
Tamaño: 549 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ISendSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class ISendSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.ISendSms, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config: {
      apiToken: string;
    } = {
      apiToken: credentials.apiToken ?? '',
      ...credentials,
    };

    this.provider = new ISendSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ISendSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/kannel.handler.ts
Tamaño: 750 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { KannelSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class KannelSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Kannel, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config: {
      host: string;
      port: string;
      from: string;
      username?: string;
      password?: string;
    } = {
      host: credentials.host || '',
      port: credentials.port || '',
      from: credentials.from || '',
      username: credentials.user,
      password: credentials.password,
    };

    this.provider = new KannelSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class KannelSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/maqsam.handler.ts
Tamaño: 531 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MaqsamSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class MaqsamHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Maqsam, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new MaqsamSmsProvider({
      accessKeyId: credentials.apiKey,
      accessSecret: credentials.secretKey,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MaqsamHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/messagebird.handler.ts
Tamaño: 480 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageBirdSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class MessageBirdHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.MessageBird, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new MessageBirdSmsProvider({
      access_key: credentials.accessKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MessageBirdHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/mobishastra.handler.ts
Tamaño: 572 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MobishastraProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class MobishastraHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Mobishastra, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new MobishastraProvider({
      baseUrl: credentials.baseUrl,
      username: credentials.user,
      password: credentials.password,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MobishastraHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/nexmo.handler.ts
Tamaño: 520 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NexmoSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class NexmoHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Nexmo, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new NexmoSmsProvider({
      apiKey: credentials.apiKey,
      from: credentials.from,
      apiSecret: credentials.secretKey,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NexmoHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/novu.handler.ts
Tamaño: 526 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TwilioSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class NovuSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Novu, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new TwilioSmsProvider({
      accountSid: credentials.accountSid,
      authToken: credentials.token,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NovuSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/plivo.handler.ts
Tamaño: 523 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PlivoSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class PlivoHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Plivo, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new PlivoSmsProvider({
      accountSid: credentials.accountSid,
      authToken: credentials.token,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PlivoHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/ring-central.handler.ts
Tamaño: 782 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { RingCentralSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class RingCentralHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.RingCentral, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    if (!credentials.clientId || !credentials.secretKey || !credentials.token || !credentials.from) {
      throw Error('Invalid credentials');
    }

    this.provider = new RingCentralSmsProvider({
      clientId: credentials.clientId,
      clientSecret: credentials.secretKey,
      isSandBox: credentials.secure || false,
      jwtToken: credentials.token,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RingCentralHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/sendchamp.handler.ts
Tamaño: 628 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SendchampSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SendchampSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Sendchamp, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    if (!credentials.apiKey || !credentials.from) {
      throw Error('Invalid credentials');
    }

    const config = {
      apiKey: credentials.apiKey,
      from: credentials.from,
    };

    this.provider = new SendchampSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendchampSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/simpletexting.handler.ts
Tamaño: 551 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SimpletextingSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SimpletextingSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Simpletexting, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = {
      apiKey: credentials.apiKey,
      accountPhone: credentials.from,
    };

    this.provider = new SimpletextingSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SimpletextingSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/sinch.handler.ts
Tamaño: 604 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SinchSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SinchHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Sinch, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = credentials as Record<string, string>;
    this.provider = new SinchSmsProvider({
      servicePlanId: config.servicePlanId,
      apiToken: config.apiToken,
      from: config.from,
      region: config.region,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SinchHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/sms-central.handler.ts
Tamaño: 725 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SmsCentralSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SmsCentralHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.SmsCentral, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    if (!credentials.user || !credentials.password || !credentials.from) {
      throw Error('Invalid credentials');
    }

    const config = {
      username: credentials.user,
      password: credentials.password,
      from: credentials.from,
      baseUrl: credentials.baseUrl,
    };

    this.provider = new SmsCentralSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SmsCentralHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/sms77.handler.ts
Tamaño: 479 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Sms77SmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class Sms77Handler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Sms77, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new Sms77SmsProvider({
      apiKey: credentials.apiKey,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class Sms77Handler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/smsmode.handler.ts
Tamaño: 499 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SmsmodeSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SmsmodeHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Smsmode, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    const config = { apiKey: credentials.apiKey, from: credentials.from };

    this.provider = new SmsmodeSmsProvider(config);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SmsmodeHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/sns.handler.ts
Tamaño: 537 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SNSConfig, SNSSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class SnsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.SNS, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new SNSSmsProvider({
      accessKeyId: credentials.apiKey,
      secretAccessKey: credentials.secretKey,
      region: credentials.region,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SnsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/telnyx.handler.ts
Tamaño: 538 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TelnyxSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class TelnyxHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Telnyx, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new TelnyxSmsProvider({
      apiKey: credentials.apiKey,
      from: credentials.from,
      messageProfileId: credentials.messageProfileId,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TelnyxHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/termii.handler.ts
Tamaño: 487 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TermiiSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class TermiiSmsHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Termii, ChannelTypeEnum.SMS);
  }

  buildProvider(credentials: ICredentials) {
    this.provider = new TermiiSmsProvider({
      apiKey: credentials.apiKey,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TermiiSmsHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/twilio.handler.ts
Tamaño: 527 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TwilioSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class TwilioHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Twilio, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new TwilioSmsProvider({
      accountSid: credentials.accountSid,
      authToken: credentials.token,
      from: credentials.from,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TwilioHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/handlers/unifonic.handler.ts
Tamaño: 499 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { UnifonicSmsProvider } from '@novu/providers';
import { ChannelTypeEnum, ICredentials, SmsProviderIdEnum } from '@novu/shared';
import { BaseSmsHandler } from './base.handler';

export class UnifonicHandler extends BaseSmsHandler {
  constructor() {
    super(SmsProviderIdEnum.Unifonic, ChannelTypeEnum.SMS);
  }
  buildProvider(credentials: ICredentials) {
    this.provider = new UnifonicSmsProvider({
      appSid: credentials.appSid,
      senderId: credentials.senderId,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UnifonicHandler

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/interfaces/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './sms.factory.interface';
export * from './sms.handler.interface';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/interfaces/sms.factory.interface.ts
Tamaño: 277 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IntegrationEntity } from '@novu/dal';
import { ISmsHandler } from './sms.handler.interface';

export interface ISmsFactory {
  getHandler(
    integration: Pick<IntegrationEntity, 'credentials' | 'channel' | 'providerId' | 'configurations'>
  ): ISmsHandler | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/factories/sms/interfaces/sms.handler.interface.ts
Tamaño: 467 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, ICredentials } from '@novu/shared';
import { ISendMessageSuccessResponse, ISmsOptions, ISmsProvider } from '@novu/stateless';
import { IHandler } from '../../shared/interfaces';

export interface ISmsHandler extends IHandler {
  canHandle(providerId: string, channelType: ChannelTypeEnum);

  buildProvider(credentials: ICredentials);

  send(smsOptions: ISmsOptions): Promise<ISendMessageSuccessResponse>;

  getProvider(): ISmsProvider;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/active-jobs-metric-queue.health-indicator.ts
Tamaño: 630 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { ActiveJobsMetricQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'ActiveJobsMetricQueueServiceHealthIndicator';
const INDICATOR_KEY = 'activeJobsMetricQueue';
const SERVICE_NAME = 'ActiveJobsMetricQueueService';

@Injectable()
export class ActiveJobsMetricQueueServiceHealthIndicator extends QueueHealthIndicator {
  constructor(private activeJobsMetricQueueService: ActiveJobsMetricQueueService) {
    super(activeJobsMetricQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ActiveJobsMetricQueueServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/cache.health-indicator.ts
Tamaño: 694 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { HealthCheckError, HealthIndicator, HealthIndicatorResult } from '@nestjs/terminus';
import { CacheService } from '../services/cache';

@Injectable()
export class CacheServiceHealthIndicator extends HealthIndicator {
  private static KEY = 'cacheService';

  constructor(private cacheService: CacheService) {
    super();
  }

  async isHealthy(): Promise<HealthIndicatorResult> {
    const isHealthy = this.cacheService.cacheEnabled();
    const result = this.getStatus(CacheServiceHealthIndicator.KEY, isHealthy);

    if (isHealthy) {
      return result;
    }

    throw new HealthCheckError('Cache health check failed', result);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CacheServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/dal.health-indicator.ts
Tamaño: 768 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { HealthCheckError, HealthIndicator, HealthIndicatorResult } from '@nestjs/terminus';
import { DalService } from '@novu/dal';
import { IHealthIndicator } from './health-indicator.interface';

@Injectable()
export class DalServiceHealthIndicator extends HealthIndicator implements IHealthIndicator {
  private static KEY = 'db';

  constructor(private dalService: DalService) {
    super();
  }

  async isHealthy(): Promise<HealthIndicatorResult> {
    const isHealthy = this.dalService.connection.readyState === 1;
    const result = this.getStatus(DalServiceHealthIndicator.KEY, isHealthy);

    if (isHealthy) {
      return result;
    }

    throw new HealthCheckError('DAL health check failed', result);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DalServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/health-indicator.interface.ts
Tamaño: 144 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { HealthIndicatorResult } from '@nestjs/terminus';

export interface IHealthIndicator {
  isHealthy(): Promise<HealthIndicatorResult>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/inbound-parse-queue.health-indicator.ts
Tamaño: 605 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { InboundParseQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'InboundParseQueueServiceHealthIndicator';
const INDICATOR_KEY = 'inboundParseQueueService';
const SERVICE_NAME = 'InboundParseQueueService';

@Injectable()
export class InboundParseQueueServiceHealthIndicator extends QueueHealthIndicator {
  constructor(private inboundParseQueueService: InboundParseQueueService) {
    super(inboundParseQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InboundParseQueueServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/index.ts
Tamaño: 512 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './active-jobs-metric-queue.health-indicator';
export * from './cache.health-indicator';
export * from './dal.health-indicator';
export * from './health-indicator.interface';
export * from './inbound-parse-queue.health-indicator';
export * from './queue-health-indicator.service';
export * from './standard-queue.health-indicator';
export * from './subscriber-process-queue.health-indicator';
export * from './web-sockets-queue.health-indicator';
export * from './workflow-queue.health-indicator';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/queue-health-indicator.service.ts
Tamaño: 960 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { HealthCheckError, HealthIndicator, HealthIndicatorResult } from '@nestjs/terminus';

import { QueueBaseService } from '../services/queues/queue-base.service';
import { IHealthIndicator } from './health-indicator.interface';

@Injectable()
export abstract class QueueHealthIndicator extends HealthIndicator implements IHealthIndicator {
  constructor(
    private queueService: QueueBaseService,
    private indicatorKey: string,
    private serviceName: string,
    private logContext: string
  ) {
    super();
  }

  async isHealthy(): Promise<HealthIndicatorResult> {
    return await this.handleHealthCheck();
  }

  async handleHealthCheck() {
    const isReady = this.queueService.isReady();
    const result = this.getStatus(this.indicatorKey, isReady);

    if (isReady) {
      return result;
    }

    throw new HealthCheckError(`${this.serviceName} Health is not ready`, result);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/standard-queue.health-indicator.ts
Tamaño: 566 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { StandardQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'StandardQueueServiceHealthIndicator';
const INDICATOR_KEY = 'standardQueue';
const SERVICE_NAME = 'StandardQueueService';

@Injectable()
export class StandardQueueServiceHealthIndicator extends QueueHealthIndicator {
  constructor(private standardQueueService: StandardQueueService) {
    super(standardQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StandardQueueServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/subscriber-process-queue.health-indicator.ts
Tamaño: 737 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { ObservabilityBackgroundTransactionEnum } from '@novu/shared';
import { SubscriberProcessQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'SubscriberProcessQueueHealthIndicator';
const INDICATOR_KEY = ObservabilityBackgroundTransactionEnum.SUBSCRIBER_PROCESSING_QUEUE;
const SERVICE_NAME = 'SubscriberProcessQueueService';

@Injectable()
export class SubscriberProcessQueueHealthIndicator extends QueueHealthIndicator {
  constructor(private subscriberProcessQueueService: SubscriberProcessQueueService) {
    super(subscriberProcessQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SubscriberProcessQueueHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/web-sockets-queue.health-indicator.ts
Tamaño: 582 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { WebSocketsQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'WebSocketsQueueServiceHealthIndicator';
const INDICATOR_KEY = 'webSocketsQueue';
const SERVICE_NAME = 'WebSocketsQueueService';

@Injectable()
export class WebSocketsQueueServiceHealthIndicator extends QueueHealthIndicator {
  constructor(private webSocketsQueueService: WebSocketsQueueService) {
    super(webSocketsQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebSocketsQueueServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/health/workflow-queue.health-indicator.ts
Tamaño: 566 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { WorkflowQueueService } from '../services/queues';
import { QueueHealthIndicator } from './queue-health-indicator.service';

const LOG_CONTEXT = 'WorkflowQueueServiceHealthIndicator';
const INDICATOR_KEY = 'workflowQueue';
const SERVICE_NAME = 'WorkflowQueueService';

@Injectable()
export class WorkflowQueueServiceHealthIndicator extends QueueHealthIndicator {
  constructor(private workflowQueueService: WorkflowQueueService) {
    super(workflowQueueService, INDICATOR_KEY, SERVICE_NAME, LOG_CONTEXT);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowQueueServiceHealthIndicator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/http/headers.types.ts
Tamaño: 1299 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiHeaderOptions } from '@nestjs/swagger';
import { testHttpHeaderEnumValidity, WithRequired } from './utils.types';

export enum HttpRequestHeaderKeysEnum {
  AUTHORIZATION = 'Authorization',
  USER_AGENT = 'User-Agent',
  CONTENT_TYPE = 'Content-Type',
  SENTRY_TRACE = 'Sentry-Trace',
  BAGGAGE = 'Baggage',
  NOVU_ENVIRONMENT_ID = 'Novu-Environment-Id',
  NOVU_API_VERSION = 'Novu-API-Version',
  NOVU_USER_AGENT = 'Novu-User-Agent',
  BYPASS_TUNNEL_REMINDER = 'Bypass-Tunnel-Reminder',
  IDEMPOTENCY_KEY = 'Idempotency-Key',
  NOVU_APPLICATION_IDENTIFIER = 'Novu-Application-Identifier',
}
testHttpHeaderEnumValidity(HttpRequestHeaderKeysEnum);

export enum HttpResponseHeaderKeysEnum {
  CONTENT_TYPE = 'Content-Type',
  RATELIMIT_REMAINING = 'RateLimit-Remaining',
  RATELIMIT_LIMIT = 'RateLimit-Limit',
  RATELIMIT_RESET = 'RateLimit-Reset',
  RATELIMIT_POLICY = 'RateLimit-Policy',
  RETRY_AFTER = 'Retry-After',
  IDEMPOTENCY_KEY = 'Idempotency-Key',
  IDEMPOTENCY_REPLAY = 'Idempotency-Replay',
  LINK = 'Link',
}
testHttpHeaderEnumValidity(HttpResponseHeaderKeysEnum);

export type HeaderObject = WithRequired<
  Omit<ApiHeaderOptions, 'name'>,
  'required' | 'description' | 'schema' | 'example'
>;
export type HeaderObjects = Record<HttpResponseHeaderKeysEnum, HeaderObject>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export  enum
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/http/index.ts
Tamaño: 68 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './headers.types';
export * from './responses.types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/http/responses.types.ts
Tamaño: 173 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import * as nestSwagger from '@nestjs/swagger';

type NestJsExport = keyof typeof nestSwagger;
export type ApiResponseDecoratorName = NestJsExport & `Api${string}Response`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/http/utils.types.spec.ts
Tamaño: 3701 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/* cSpell:enableCompoundWords */
import { describe, expect, it } from 'vitest';
import { ConvertToConstantCase, testHttpHeaderEnumValidity, ValidateHttpHeaderCase, WithRequired } from './utils.types';

describe('HTTP headers', () => {
  /**
   * This describe block resolves the Jest error of a test suite not having any tests.
   * It has no other purpose.
   */
  it('tests the Typescript compiler errors below', () => {
    expect(true).toEqual(true);
  });
});

/**
 * WithRequired tests
 */
type TestWithRequired = {
  optional?: string;
  required: number;
};
// Valid
export const validTestType: WithRequired<TestWithRequired, 'optional'> = {
  optional: 'test',
  required: 1,
};

// @ts-expect-error - Missing 'optional' property
export const invalidTestType: WithRequired<TestWithRequired, 'optional'> = {
  required: 1,
};

/**
 * ConvertToConstantCase tests
 */
// Valid
export const validConstantSingleString: ConvertToConstantCase<'Single'> = 'SINGLE';
export const validConstantSingleSingleString: ConvertToConstantCase<'Double-String'> = 'DOUBLE_STRING';
export const validConstantDoubleSingleString: ConvertToConstantCase<'DoubleWord-String'> = 'DOUBLEWORD_STRING';

// @ts-expect-error - Incorrect case - should be 'SINGLE'
export const invalidConstantSingleString: ConvertToConstantCase<'Single'> = 'single';

/**
 * ValidateHttpHeaderCase tests
 */
// Valid
export const validHttpHeaderSingleString: ValidateHttpHeaderCase<'Single'> = 'Single';
export const validHttpHeaderSingleSingleString: ValidateHttpHeaderCase<'Double-String'> = 'Double-String';
export const validHttpHeaderDoubleSingleString: ValidateHttpHeaderCase<'DoubleWord-String'> = 'DoubleWord-String';
export const validHttpHeaderUnion1String: ValidateHttpHeaderCase<'First-String' | 'Second-String'> = 'First-String';
export const validHttpHeaderUnion2String: ValidateHttpHeaderCase<'First-String' | 'Second-String'> = 'Second-String';
enum TestCapitalHeaderEnum {
  SINGLE = 'Single',
  INVALID = 'invalid-string',
  DOUBLE_STRING = 'Double-String',
  DOUBLEWORD_STRING = 'DoubleWord-String',
}
export const validHttpHeaderSingleEnum: ValidateHttpHeaderCase<TestCapitalHeaderEnum.SINGLE> = 'Single';
export const validHttpHeaderSingleSingleEnum: ValidateHttpHeaderCase<TestCapitalHeaderEnum.DOUBLE_STRING> =
  'Double-String';
export const validHttpHeaderDoubleSingleEnum: ValidateHttpHeaderCase<TestCapitalHeaderEnum.DOUBLEWORD_STRING> =
  'DoubleWord-String';

// @ts-expect-error - Incorrect case - 'invalid-string' literal type is not Capital-Case
export const invalidHttpHeaderSingleString: ValidateHttpHeaderCase<'invalid-string'> = 'Invalid';
// @ts-expect-error - Incorrect case - 'invalid-string' union type is not Capital-Case
export const invalidHttpHeaderUnionString: ValidateHttpHeaderCase<'First-String' | 'invalid-string'> = 'invalid-string';
// @ts-expect-error - Incorrect case - 'invalid-string' enum is not Capital-Case
export const invalidHttpHeaderEnumString: ValidateHttpHeaderCase<TestCapitalHeaderEnum.INVALID> = 'invalid';

/**
 * testHeaderEnumValidity Tests
 */
// Valid
enum ValidHeaderEnum {
  SINGLE = 'Single',
  DOUBLE_STRING = 'Double-String',
  DOUBLEWORD_STRING = 'DoubleWord-String',
}
testHttpHeaderEnumValidity(ValidHeaderEnum);

// Invalid
enum InvalidKeyHeaderEnum {
  SINGLE = 'Single',
  Invalid_Key = 'Invalid-Key',
}
// @ts-expect-error - Invalid key - Invalid_Key should be 'INVALID_KEY'
testHttpHeaderEnumValidity(InvalidKeyHeaderEnum);

enum InvalidValueHeaderEnum {
  SINGLE = 'Single',
  INVALID_VALUE = 'invalid-key',
}
// @ts-expect-error - Invalid value - 'another-test-header' should be 'Another-Test-Header'
testHttpHeaderEnumValidity(InvalidValueHeaderEnum);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/http/utils.types.ts
Tamaño: 3101 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import * as nestSwagger from '@nestjs/swagger';
import { ApiHeaderOptions } from '@nestjs/swagger';

export enum HttpResponseHeaderKeysEnum {
  CONTENT_TYPE = 'Content-Type',
  RATELIMIT_REMAINING = 'RateLimit-Remaining',
  RATELIMIT_LIMIT = 'RateLimit-Limit',
  RATELIMIT_RESET = 'RateLimit-Reset',
  RATELIMIT_POLICY = 'RateLimit-Policy',
  RETRY_AFTER = 'Retry-After',
  IDEMPOTENCY_KEY = 'Idempotency-Key',
  IDEMPOTENCY_REPLAY = 'Idempotency-Replay',
  LINK = 'Link',
}
testHttpHeaderEnumValidity(HttpResponseHeaderKeysEnum);

export type HeaderObject = WithRequired<
  Omit<ApiHeaderOptions, 'name'>,
  'required' | 'description' | 'schema' | 'example'
>;
export type HeaderObjects = Record<HttpResponseHeaderKeysEnum, HeaderObject>;

type NestJsExport = keyof typeof nestSwagger;
export type ApiResponseDecoratorName = NestJsExport & `Api${string}Response`;

/* cSpell:enableCompoundWords */
/**
 * Make properties K in T required.
 */
export type WithRequired<T, K extends keyof T> = T & { [P in K]-?: T[P] };

/**
 * Recursively make all properties of type `T` required.
 */
export type DeepRequired<T> = T extends object
  ? {
      [P in keyof T]-?: DeepRequired<T[P]>;
    }
  : T;

/**
 * Transform S to CONSTANT_CASE.
 */
export type ConvertToConstantCase<S extends string> = S extends `${infer T}-${infer U}`
  ? `${Uppercase<T>}_${ConvertToConstantCase<U>}`
  : Uppercase<S>;

/**
 * Validate that S is in Http-Header-Case, and return S if valid, otherwise never.
 */
export type ValidateHttpHeaderCase<S extends string> = S extends `${infer U}-${infer V}`
  ? U extends Capitalize<U>
    ? `${U}-${ValidateHttpHeaderCase<V>}`
    : never
  : S extends Capitalize<S>
    ? `${S}` // necessary to cast to string literal type for non-hyphenated enum validation
    : never;

/**
 * Helper function to test that Header enum keys and values match correct format.
 *
 * - The enum keys must be in CONSTANT_CASE
 * - The enum values must be in Http-Header-Case.
 * - The enum values must be the CONSTANT_CASED version of the Http-Header-Cased value.
 *
 * If the test fails, you should review your `enum` to verify that the conditions above are met.
 *
 * @example
 * // Correct format:
 * enum TestEnum {
 *   HEADER = 'Header',
 *   HYPHENATED_HEADER = 'Hyphenated-Header',
 *   DOUBLEWORD_Header = 'DoubleWord-Header',
 * }
 *
 * @example
 * // Incorrect format:
 * enum TestEnum {
 *   Single = 'Single', // incorrect key case (Single should be SINGLE)
 *   SINGLE = 'single', // incorrect value case ('single' should be 'Single')
 *   // extra underscore in key (DOUBLE_WORD_HEADER should be DOUBLEWORD_HEADER)
 *   DOUBLE_WORD_HEADER = 'DoubleWord-Header',
 * }
 *
 * @param testEnum - the Enum to type check
 */
export function testHttpHeaderEnumValidity<
  TEnum extends IConstants,
  TValue extends TEnum[keyof TEnum] & string,
  IConstants = Record<ConvertToConstantCase<TValue>, ValidateHttpHeaderCase<TValue>>,
>(
  testEnum: TEnum &
    Record<
      Exclude<keyof TEnum, keyof IConstants>,
      ['Key must be the CONSTANT_CASED version of the Capital-Cased value']
    >
) {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export  type
- export  type
- export  type
- export  type
- export  type
- export  type
- export  type
- export function testHttpHeaderEnumValidity

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/instrumentation/index.ts
Tamaño: 45 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './instrumentation.decorator';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/instrumentation/instrumentation.decorator.ts
Tamaño: 2653 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import 'reflect-metadata';

function copyMetadata(source: any, target: any): void {
  const result = Reflect.getMetadataKeys(source);

  for (const key of result) {
    Reflect.defineMetadata(key, Reflect.getMetadata(key, source), target);
  }
}

type InstrumentationOptions = {
  transactionName?: string;
  buildTransactionIdSuffix?: (...args: any[]) => string;
};

export const InstrumentUsecase = ({
  transactionName = '',
  buildTransactionIdSuffix,
}: InstrumentationOptions = {}): any =>
  instrumentationWrapper({
    transactionName,
    instrumentationType: 'Usecase',
    buildTransactionIdSuffix,
  });

export const Instrument = ({ transactionName = '', buildTransactionIdSuffix }: InstrumentationOptions = {}): any =>
  instrumentationWrapper({
    transactionName,
    instrumentationType: 'Function',
    buildTransactionIdSuffix,
  });

function instrumentationWrapper({
  transactionName = '',
  instrumentationType = 'Function',
  buildTransactionIdSuffix,
}: InstrumentationOptions & { instrumentationType: string }): any {
  return (target: any, key: any, descriptor: PropertyDescriptor): any => {
    const method = descriptor.value;
    const methodName = transactionName || key;

    const transactionIdentifierBase = `${instrumentationType}/${target?.constructor?.name}/${methodName}`;

    let nr: any = null;
    try {
      // Dynamically load newrelic
      nr = require('newrelic');
    } catch {
      return descriptor;
    }

    if (nr) {
      const isAsync = method.constructor.name === 'AsyncFunction';

      if (!isAsync) {
        descriptor.value = function instrumentedMethod(...args: unknown[]) {
          const transactionIdentifier = buildTransactionId(transactionIdentifierBase, buildTransactionIdSuffix, args);

          return nr.startSegment(transactionIdentifier, true, () => {
            return method.apply(this, args);
          });
        };
      } else {
        descriptor.value = async function instrumentedAsyncMethod(...args: unknown[]) {
          const transactionIdentifier = buildTransactionId(transactionIdentifierBase, buildTransactionIdSuffix, args);

          return nr.startSegment(transactionIdentifier, true, async () => {
            return await method.apply(this, args);
          });
        };
      }

      copyMetadata(method, descriptor.value);
    }

    return descriptor;
  };
}

const buildTransactionId = (
  transactionIdentifierBase: string,
  buildSuffix: InstrumentationOptions['buildTransactionIdSuffix'],
  args: unknown[]
): string => {
  const suffix = buildSuffix ? `:${buildSuffix(...args)}` : '';

  return `${transactionIdentifierBase}${suffix}`;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - copyMetadata(source: any, target: any)
 - instrumentationWrapper({
  transactionName = '',
  instrumentationType = 'Function',
  buildTransactionIdSuffix,
}: InstrumentationOptions & { instrumentationType: string })
 - instrumentedMethod(...args: unknown[])
 - instrumentedAsyncMethod(...args: unknown[])
Asignaciones con arrow functions encontradas (posibles funciones):
 - InstrumentationOptions({
  transactionName?: string;
  buildTransactionIdSuffix?: (...args: any[]))
 - InstrumentationOptions({}): any)
 - InstrumentationOptions({}): any)
 - instrumentationType('Function',
  buildTransactionIdSuffix,
}: InstrumentationOptions & { instrumentationType: string })...)
 - transactionIdentifier(buildTransactionId(transactionIdentifierBase, buildTransactionIdSuffix, args);

          return nr....)
 - transactionIdentifier(buildTransactionId(transactionIdentifierBase, buildTransactionIdSuffix, args);

          return nr....)
 - buildTransactionId(transactionIdentifierBase: string,
  buildSuffix: InstrumentationOptions['buildTransactionIdSuffix']...)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/logging/LogDecorator.ts
Tamaño: 1287 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger, LoggerService } from '@nestjs/common';

export type Transform = (data: any) => any;

export interface IOptions {
  logger?: LoggerService;
  transform?: Transform;
  timestamp?: boolean;
}

const DEFAULT_OPTIONS: IOptions = {
  timestamp: true,
};

export const LogDecorator = (options = DEFAULT_OPTIONS) => {
  return (target: any, propertyName: string, descriptor: TypedPropertyDescriptor<any>): void => {
    const logger = options?.logger || new Logger(target?.constructor?.name);
    const method = descriptor?.value;

    descriptor.value = async function <T>(...args: unknown[]): Promise<T> {
      const currentTime = Date.now();
      logger.debug(
        {
          input: {
            ...((options?.transform ? options?.transform(args) : args) || {}),
          },
        },
        `"${target?.constructor?.name}.${propertyName}" invoke`
      );

      const data = await method.apply(this, args);

      const executeTime = options?.timestamp ? `${Date.now() - currentTime}` : '';

      logger.debug(
        {
          executionTimeMs: executeTime,
          result: { ...(options?.transform ? options?.transform(data) : data) },
        },
        `"${target?.constructor?.name}.${propertyName}" result`
      );

      return data;
    };
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - Transform(data: any))
 - options(DEFAULT_OPTIONS))
Declaraciones 'export' encontradas:
- export  type
- export  interface
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/logging/error-util.ts
Tamaño: 2625 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

class ErrorContext {
  timestamp: string;
  service: string;
  environment: string;
  traceId?: string;
}

export function parseErrorInformation(
  error: unknown,
  context?: Partial<ErrorContext>
): {
  level: string;
  message: string;
  error: Record<string, any>;
  context?: ErrorContext;
} {
  try {
    // Prepare default context
    const defaultContext: ErrorContext = {
      timestamp: new Date().toISOString(),
      service: process.env.SERVICE_NAME || 'unknown-service',
      environment: process.env.NODE_ENV || 'unknown-env',
    };

    // Merge provided context with default
    const fullContext = { ...defaultContext, ...context };

    // Handle Error objects
    if (error instanceof Error) {
      const errorDetails: Record<string, any> = {
        message: error.message,
        name: error.name,
        type: 'Error',
        // Optional additional properties
        ...('cause' in error && error.cause && { cause: error.cause }),
        ...((error as any).code && { code: (error as any).code }),
        ...((error as any).details && { details: (error as any).details }),
        stack: error.stack?.split('\n').slice(0, 5),
      };

      return {
        level: 'error',
        message: `Error in ${fullContext.service}: ${error.message}`,
        error: errorDetails,
        context: fullContext,
      };
    }

    // Handle string errors
    if (typeof error === 'string') {
      return {
        level: 'error',
        message: `String Error in ${fullContext.service}: ${error}`,
        error: {
          type: 'string',
          value: error,
        },
        context: fullContext,
      };
    }

    // Handle other types of errors
    if (error !== null && error !== undefined) {
      return {
        level: 'error',
        message: `Unknown Error in ${fullContext.service}`,
        error: {
          type: typeof error,
          value: JSON.stringify(error, null, 2),
        },
        context: fullContext,
      };
    }

    // Handle null or undefined
    return {
      level: 'warn',
      message: `No error information available in ${fullContext.service}`,
      error: {
        type: 'null_or_undefined',
      },
      context: fullContext,
    };
  } catch (formatingError) {
    // Fallback in case of formatting error
    return {
      level: 'critical',
      message: 'Critical error in error formatting',
      error: {
        type: 'format_error',
        details: String(formatingError),
      },
      context: {
        timestamp: new Date().toISOString(),
        service: 'error-formatter',
        environment: '',
      },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - parseErrorInformation(error: unknown,
  context?: Partial<ErrorContext>)
Declaraciones 'export' encontradas:
- export function parseErrorInformation

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/logging/index.ts
Tamaño: 3306 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NestInterceptor, RequestMethod } from '@nestjs/common';
import { getLoggerToken, Logger, LoggerErrorInterceptor, LoggerModule, Params, PinoLogger } from 'nestjs-pino';
import { Store, storage } from 'nestjs-pino/storage';
import { sensitiveFields } from './masking';

export * from './LogDecorator';
export { getLoggerToken, Logger, LoggerModule, PinoLogger, storage, Store };

export function getErrorInterceptor(): NestInterceptor {
  return new LoggerErrorInterceptor();
}

const loggingLevelSet = {
  trace: 10,
  debug: 20,
  info: 30,
  warn: 40,
  error: 50,
  fatal: 60,
  none: 70,
};
const loggingLevelArr = Object.keys(loggingLevelSet);

export function getLogLevel() {
  let logLevel = null;

  if (process.env.LOGGING_LEVEL || process.env.LOG_LEVEL) {
    logLevel = process.env.LOGGING_LEVEL || process.env.LOG_LEVEL;
  } else {
    console.log(`Environment variable LOG_LEVEL is not set. Falling back to info level.`);
    logLevel = 'info';
  }

  if (!loggingLevelArr.includes(logLevel)) {
    console.log(`${logLevel}is not a valid log level of ${loggingLevelArr}. Falling back to info level.`);

    return 'info';
  }

  return logLevel;
}

export function createNestLoggingModuleOptions(settings: {
  serviceName: string;
  version: string;
  silent?: boolean;
}): Params {
  let redactFields: string[] = sensitiveFields;
  redactFields.push('req.headers.authorization');
  const baseWildCards = '*.';
  const baseArrayWildCards = '*[*].';
  for (let i = 1; i <= 6; i += 1) {
    redactFields = redactFields.concat(sensitiveFields.map((val) => baseWildCards.repeat(i) + val));
    redactFields = redactFields.concat(sensitiveFields.map((val) => baseArrayWildCards.repeat(i) + val));
  }

  const configSet = {
    transport: ['local', 'test', 'debug'].includes(process.env.NODE_ENV) ? { target: 'pino-pretty' } : undefined,
    platform: process.env.HOSTING_PLATFORM ?? 'Docker',
    tenant: process.env.TENANT ?? 'OS',
    level: getLogLevel(),
    levels: loggingLevelSet,
  };

  if (!settings.silent) {
    console.log('Logging Configuration:', {
      level: configSet.level,
      environment: process.env.NODE_ENV,
      transport: !configSet.transport ? 'None' : 'pino-pretty',
      platform: configSet.platform,
      tenant: configSet.tenant,
      levels: JSON.stringify(configSet.levels),
    });
  }

  return {
    exclude: [
      { path: '*/health-check', method: RequestMethod.GET },
      { path: '/v1/internal/subscriber-online-state', method: RequestMethod.POST }
    ],
    assignResponse: true,
    pinoHttp: {
      useOnlyCustomLevels: true,
      customLevels: configSet.levels,
      level: configSet.level,
      redact: {
        paths: redactFields,
        censor() {
          /**
           * This makes sure that the redact doesn't mutate the original object
           * And only does it on the object that is being logged,
           * It's strange but it works. No return value needed.
           */
        },
      },
      base: {
        pid: process.pid,
        serviceName: settings.serviceName,
        serviceVersion: settings.version,
        platform: configSet.platform,
        tenant: configSet.tenant,
      },
      transport: configSet.transport,
      autoLogging: !['test'].includes(process.env.NODE_ENV),
    },
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getErrorInterceptor()
 - getLogLevel()
 - createNestLoggingModuleOptions(settings: {
  serviceName: string;
  version: string;
  silent?: boolean;
})
Asignaciones con arrow functions encontradas (posibles funciones):
 - redactFields(redactFields.concat(sensitiveFields.map((val))
 - redactFields(redactFields.concat(sensitiveFields.map((val))
Declaraciones 'export' encontradas:
- export
- export
- export function getErrorInterceptor
- export function getLogLevel
- export function createNestLoggingModuleOptions

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/logging/masking.ts
Tamaño: 696 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

const cardFields = ['credit', 'debit', 'creditCard', 'debitCard'];

const emailFields = ['primaryEmail', 'secondaryEmail', 'email'];

const passwordFields = [
  'password',
  'token',
  'apiKey',
  'apiKeys',
  'secretKey',
  'firstName',
  'lastName',
  'organizationName',
  'senderName',
  'username',
];

const phoneFields = ['homePhone', 'workPhone', 'phone'];

const addressFields = ['addressLine1', 'addressLine2', 'address', 'cardAddress'];

const httpFields = ['webhookUrl', 'avatar', 'avatar_url', 'payload', 'to'];

const uuidFields = [];

export const sensitiveFields = cardFields.concat(
  emailFields,
  passwordFields,
  phoneFields,
  addressFields,
  uuidFields,
  httpFields
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/modules/cron.module.ts
Tamaño: 2672 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Agenda } from '@hokify/agenda';
import { DynamicModule, Module, Provider } from '@nestjs/common';
import { DalService } from '@novu/dal';
import { JobCronNameEnum, JobTopicNameEnum } from '@novu/shared';
import os from 'os';
import { dalService as customDalService } from '../custom-providers';
import { ACTIVE_CRON_JOBS_TOKEN, AgendaCronService, CronService, MetricsService } from '../services';
import { MetricsModule } from './metrics.module';

/**
 * This map is a little uncomfortable because it depends on the Job topic name, coupling the Cron jobs to the
 * queue names that are injected via the environment variable `ACTIVE_WORKERS`.
 *
 * Moving forward, we should consider specifying an enum for Workers to decouple the Worker names from
 * the job names. This would allow us to specify the cron jobs in a more explicit way for each worker.
 */
const cronJobsFromWorkers: Partial<Record<JobTopicNameEnum, Array<JobCronNameEnum>>> = {
  [JobTopicNameEnum.STANDARD]: [JobCronNameEnum.CREATE_BILLING_USAGE_RECORDS, JobCronNameEnum.SEND_CRON_METRICS],
};

export const cronService = {
  provide: CronService,
  useFactory: async (metricsService: MetricsService, activeCronJobs: JobCronNameEnum[], dalService: DalService) => {
    const agenda = new Agenda({
      mongo: dalService.connection.getClient().db() as any,
      /**
       * Sets the hostname for the Job. Used to debug last host to run the job via
       * the collection's `lastModifiedBy` attribute.
       *
       * @see https://github.com/agenda/agenda/tree/master?tab=readme-ov-file#namename
       */
      name: `${os.hostname}-${process.pid}`,
    });
    const service = new AgendaCronService(metricsService, activeCronJobs, agenda);

    return service;
  },
  inject: [MetricsService, ACTIVE_CRON_JOBS_TOKEN, DalService],
};

const PROVIDERS: Provider[] = [cronService, MetricsService, customDalService];

@Module({})
export class CronModule {
  static forRoot(activeWorkers?: JobTopicNameEnum[]): DynamicModule {
    return {
      imports: [MetricsModule],
      module: CronModule,
      providers: [
        {
          provide: ACTIVE_CRON_JOBS_TOKEN,
          useFactory: async () => {
            const activeJobs: JobCronNameEnum[] = activeWorkers.reduce((acc, worker) => {
              if (cronJobsFromWorkers[worker]) {
                return [...acc, ...cronJobsFromWorkers[worker]];
              }

              return acc;
            }, [] as JobCronNameEnum[]);

            const uniqueActiveJobs = [...new Set(activeJobs)];

            return uniqueActiveJobs;
          },
        },
        ...PROVIDERS,
      ],
      exports: [...PROVIDERS],
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - cronService({
  provide: CronService,
  useFactory: async (metricsService: MetricsService, activeCronJobs: JobCr...)
Declaraciones 'export' encontradas:
- export  const
- export class CronModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/modules/index.ts
Tamaño: 159 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './cron.module';
export * from './interfaces';
export { MetricsModule } from './metrics.module';
export { QueuesModule } from './queues.module';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/modules/interfaces.ts
Tamaño: 112 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IDestroy {
  gracefulShutdown?: () => Promise<void>;
  onModuleDestroy: () => Promise<void>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/modules/metrics.module.ts
Tamaño: 396 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Module, Provider } from '@nestjs/common';
import { MetricsService, metricsServiceList } from '../services/metrics';
import { NewRelicMetricsService } from '../services/metrics/metrics.service';

const PROVIDERS: Provider[] = [MetricsService, NewRelicMetricsService, metricsServiceList];

@Module({
  providers: [...PROVIDERS],
  exports: [...PROVIDERS],
})
export class MetricsModule {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MetricsModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/modules/queues.module.ts
Tamaño: 4352 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DynamicModule, Module, OnApplicationShutdown, Provider } from '@nestjs/common';
import { MessageRepository } from '@novu/dal';
import { JobTopicNameEnum } from '@novu/shared';
import { featureFlagsService } from '../custom-providers';
import {
  ActiveJobsMetricQueueServiceHealthIndicator,
  InboundParseQueueServiceHealthIndicator,
  StandardQueueServiceHealthIndicator,
  SubscriberProcessQueueHealthIndicator,
  WebSocketsQueueServiceHealthIndicator,
  WorkflowQueueServiceHealthIndicator,
} from '../health';
import { ReadinessService, SocketWorkerService, WorkflowInMemoryProviderService } from '../services';
import {
  ActiveJobsMetricQueueService,
  InboundParseQueueService,
  StandardQueueService,
  SubscriberProcessQueueService,
  WebSocketsQueueService,
  WorkflowQueueService,
} from '../services/queues';
import { ActiveJobsMetricWorkerService } from '../services/workers';

const memoryQueueService = {
  provide: WorkflowInMemoryProviderService,
  useFactory: async () => {
    const memoryService = new WorkflowInMemoryProviderService();

    await memoryService.initialize();

    return memoryService;
  },
};

const INTERNAL_MODULE_PROVIDERS = [memoryQueueService, featureFlagsService];
const BASE_PROVIDERS: Provider[] = [ReadinessService];

@Module({
  providers: [],
  exports: [],
})
export class QueuesModule implements OnApplicationShutdown {
  static forRoot(entities: JobTopicNameEnum[] = []): DynamicModule {
    if (!entities.length) {
      entities = Object.values(JobTopicNameEnum);
    }

    const healthIndicators = [];
    const tokenList = [];
    const DYNAMIC_PROVIDERS = [...BASE_PROVIDERS];

    for (const entity of entities) {
      switch (entity) {
        case JobTopicNameEnum.INBOUND_PARSE_MAIL:
          healthIndicators.push(InboundParseQueueServiceHealthIndicator);
          tokenList.push(InboundParseQueueService);
          DYNAMIC_PROVIDERS.push(InboundParseQueueService, InboundParseQueueServiceHealthIndicator);
          break;
        case JobTopicNameEnum.WORKFLOW:
          healthIndicators.push(WorkflowQueueServiceHealthIndicator);
          tokenList.push(WorkflowQueueService);
          DYNAMIC_PROVIDERS.push(WorkflowQueueService, WorkflowQueueServiceHealthIndicator);
          break;
        case JobTopicNameEnum.WEB_SOCKETS:
          healthIndicators.push(WebSocketsQueueServiceHealthIndicator);
          tokenList.push(WebSocketsQueueService);
          DYNAMIC_PROVIDERS.push(
            MessageRepository,
            SocketWorkerService,
            WebSocketsQueueService,
            WebSocketsQueueServiceHealthIndicator
          );
          break;
        case JobTopicNameEnum.STANDARD:
          healthIndicators.push(StandardQueueServiceHealthIndicator);
          tokenList.push(StandardQueueService);
          DYNAMIC_PROVIDERS.push(StandardQueueService, StandardQueueServiceHealthIndicator);
          break;
        case JobTopicNameEnum.PROCESS_SUBSCRIBER:
          healthIndicators.push(SubscriberProcessQueueHealthIndicator);
          tokenList.push(SubscriberProcessQueueService);
          DYNAMIC_PROVIDERS.push(SubscriberProcessQueueService, SubscriberProcessQueueHealthIndicator);
          break;
        case JobTopicNameEnum.ACTIVE_JOBS_METRIC:
          healthIndicators.push(ActiveJobsMetricQueueServiceHealthIndicator);
          tokenList.push(ActiveJobsMetricQueueService);
          DYNAMIC_PROVIDERS.push(
            ActiveJobsMetricQueueService,
            ActiveJobsMetricQueueServiceHealthIndicator,
            ActiveJobsMetricWorkerService
          );
          break;
        default:
          break;
      }
    }

    DYNAMIC_PROVIDERS.push({
      provide: 'BULLMQ_LIST',
      useFactory: (...args: any[]) => {
        return args;
      },
      inject: tokenList,
    });

    DYNAMIC_PROVIDERS.push({
      provide: 'QUEUE_HEALTH_INDICATORS',
      useFactory: (...args: any[]) => {
        return args;
      },
      inject: healthIndicators,
    });

    return {
      module: QueuesModule,
      providers: [...DYNAMIC_PROVIDERS, ...INTERNAL_MODULE_PROVIDERS],
      exports: [...DYNAMIC_PROVIDERS],
    };
  }

  constructor(private workflowInMemoryProviderService: WorkflowInMemoryProviderService) {}

  async onApplicationShutdown() {
    await this.workflowInMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - memoryQueueService({
  provide: WorkflowInMemoryProviderService,
  useFactory: async ())
 - DYNAMIC_PROVIDERS([...BASE_PROVIDERS];

    for (const entity of entities) {
      switch (entity) {
        case JobT...)
Declaraciones 'export' encontradas:
- export class QueuesModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/index.ts
Tamaño: 113 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './parse-slug-env-id.pipe';
export * from './parse-slug-id';
export * from './parse-slug-id.pipe';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/parse-slug-env-id.pipe.spec.ts
Tamaño: 8660 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ArgumentMetadata } from '@nestjs/common';
import { ApiAuthSchemeEnum, MemberRoleEnum, PermissionsEnum, UserSessionData } from '@novu/shared';
import { expect } from 'chai';

import { encodeBase62 } from '../utils/base62';
import { ParseSlugEnvironmentIdPipe } from './parse-slug-env-id.pipe';

describe('ParseSlugEnvironmentIdPipe', () => {
  let pipe: ParseSlugEnvironmentIdPipe;

  beforeEach(() => {
    pipe = new ParseSlugEnvironmentIdPipe();
  });

  function createUserSession(environmentId: string): UserSessionData {
    return {
      environmentId,
      _id: 'user-id',
      organizationId: 'org-id',
      roles: [],
      permissions: [],
      scheme: ApiAuthSchemeEnum.BEARER,
    };
  }

  describe('MongoDB ObjectIds', () => {
    it('should return MongoDB ObjectIds unchanged', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const userSession = createUserSession(internalId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });

    it('should handle ObjectIds with leading zeros', () => {
      const internalId = '0615943e7ace93b0540ae377';
      const userSession = createUserSession(internalId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });
  });

  describe('Short environment identifiers', () => {
    it('should return short environment identifiers unchanged', () => {
      const identifier = 'production';
      const userSession = createUserSession(identifier);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(identifier);
    });

    it('should return development environment identifiers unchanged', () => {
      const identifier = 'development';
      const userSession = createUserSession(identifier);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(identifier);
    });

    it('should return staging environment identifiers unchanged', () => {
      const identifier = 'staging';
      const userSession = createUserSession(identifier);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(identifier);
    });

    it('should handle environment identifiers exactly at length boundary', () => {
      const identifier = 'my-environment-1'; // 16 characters
      const userSession = createUserSession(identifier);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(identifier);
    });
  });

  describe('Environment slug IDs', () => {
    it('should decode production environment slug IDs', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const slugId = `production_env_${encodedId}`;
      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });

    it('should decode development environment slug IDs', () => {
      const internalId = '507f1f77bcf86cd799439011';
      const encodedId = encodeBase62(internalId);
      const slugId = `development_env_${encodedId}`;
      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });

    it('should decode staging environment slug IDs', () => {
      const internalId = '507f191e810c19729de860ea';
      const encodedId = encodeBase62(internalId);
      const slugId = `staging-env_stg_${encodedId}`;
      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });

    it('should decode environment slug IDs with any prefix format', () => {
      const internalId = '65f1234567890abcdef12345';
      const encodedId = encodeBase62(internalId);
      const slugId = `custom-environment_custom_${encodedId}`;
      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });
  });

  describe('Environment IDs with leading zeros in slug format', () => {
    it('should handle decoded environment IDs with leading zeros', () => {
      const internalIds = ['6615943e7ace93b0540ae377', '0615943e7ace93b0540ae377', '0015943e7ace93b0540ae377'];

      internalIds.forEach((internalId) => {
        const encodedId = encodeBase62(internalId);
        const slugId = `env_prefix_${encodedId}`;
        const userSession = createUserSession(slugId);
        const result = pipe.transform(userSession, {} as ArgumentMetadata);
        expect(result.environmentId).to.equal(internalId);
      });
    });
  });

  describe('Invalid or malformed inputs', () => {
    it('should return invalid encoded environment IDs unchanged', () => {
      const invalidEncodedId = 'invalidEncoding123';
      const envSlug = `my-env_env_${invalidEncodedId}`;
      const userSession = createUserSession(envSlug);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(envSlug);
    });

    it('should return malformed environment slug IDs unchanged', () => {
      const malformedSlugId = 'environment_bad_encoding123';
      const userSession = createUserSession(malformedSlugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(malformedSlugId);
    });

    it('should handle empty environment IDs', () => {
      const userSession = createUserSession('');
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal('');
    });
  });

  describe('User session preservation', () => {
    it('should preserve all other user session properties', () => {
      const originalSession: UserSessionData = {
        environmentId: 'production_env_1A2B3C4D5E6F7890',
        _id: 'user-123',
        organizationId: 'org-456',
        roles: [MemberRoleEnum.ADMIN, MemberRoleEnum.AUTHOR],
        permissions: [PermissionsEnum.WORKFLOW_READ, PermissionsEnum.WORKFLOW_WRITE],
        scheme: ApiAuthSchemeEnum.BEARER,
      };

      const result = pipe.transform(originalSession, {} as ArgumentMetadata);

      expect(result._id).to.equal(originalSession._id);
      expect(result.organizationId).to.equal(originalSession.organizationId);
      expect(result.roles).to.deep.equal(originalSession.roles);
      expect(result.permissions).to.deep.equal(originalSession.permissions);
      expect(result.scheme).to.equal(originalSession.scheme);
      // environmentId should be transformed, but others should remain the same
    });

    it('should only transform the environmentId property', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const slugId = `production_env_${encodedId}`;

      const originalSession = createUserSession(slugId);
      const result = pipe.transform(originalSession, {} as ArgumentMetadata);

      expect(result.environmentId).to.equal(internalId);
      expect(result._id).to.equal(originalSession._id);
      expect(result.organizationId).to.equal(originalSession.organizationId);
    });
  });

  describe('Edge cases', () => {
    it('should handle very long environment names in slug format', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const longEnvName = 'very-long-environment-name-that-exceeds-normal-length';
      const slugId = `${longEnvName}_env_${encodedId}`;

      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });

    it('should handle environment names with special characters', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const specialEnvName = 'env-with-dashes_and_underscores';
      const slugId = `${specialEnvName}_env_${encodedId}`;

      const userSession = createUserSession(slugId);
      const result = pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(internalId);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createUserSession(environmentId: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - pipe(new ParseSlugEnvironmentIdPipe();
  });

  function createUserSession(environmentId: string): UserSe...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(ide...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(ide...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(ide...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(ide...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)
 - internalIds(['6615943e7ace93b0540ae377', '0615943e7ace93b0540ae377', '0015943e7ace93b0540ae377'];

      interna...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
        expect(result.environmentId).to.equal(i...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(env...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(mal...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal('')...)
 - result(pipe.transform(originalSession, {} as ArgumentMetadata);

      expect(result._id).to.equal(original...)
 - result(pipe.transform(originalSession, {} as ArgumentMetadata);

      expect(result.environmentId).to.equa...)
 - result(pipe.transform(userSession, {} as ArgumentMetadata);
      expect(result.environmentId).to.equal(int...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/parse-slug-env-id.pipe.ts
Tamaño: 576 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ArgumentMetadata, Injectable, PipeTransform } from '@nestjs/common';
import { UserSessionData } from '@novu/shared';
import { parseSlugId } from './parse-slug-id';

@Injectable()
export class ParseSlugEnvironmentIdPipe implements PipeTransform<UserSessionData, UserSessionData> {
  transform(value: UserSessionData, metadata: ArgumentMetadata): UserSessionData {
    const { environmentId, ...userSession } = value;
    const parsedEnvironmentId = parseSlugId(environmentId);

    return {
      ...userSession,
      environmentId: parsedEnvironmentId,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ParseSlugEnvironmentIdPipe

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/parse-slug-id.pipe.spec.ts
Tamaño: 5907 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ArgumentMetadata } from '@nestjs/common';
import { expect } from 'chai';
import { encodeBase62 } from '../utils/base62';
import { ParseSlugIdPipe } from './parse-slug-id.pipe';

describe('ParseSlugIdPipe', () => {
  let pipe: ParseSlugIdPipe;

  beforeEach(() => {
    pipe = new ParseSlugIdPipe();
  });

  describe('MongoDB ObjectIds', () => {
    it('should return MongoDB ObjectIds unchanged', () => {
      const internalId = '6615943e7ace93b0540ae377';
      expect(pipe.transform(internalId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should handle ObjectIds with leading zeros', () => {
      const internalId = '0615943e7ace93b0540ae377';
      expect(pipe.transform(internalId, {} as ArgumentMetadata)).to.equal(internalId);
    });
  });

  describe('Short resource identifiers', () => {
    it('should return short workflow identifiers unchanged', () => {
      const identifier = 'welcome-email';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifier);
    });

    it('should return short template identifiers unchanged', () => {
      const identifier = 'email-template';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifier);
    });

    it('should return short topic identifiers unchanged', () => {
      const identifier = 'newsletter';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifier);
    });

    it('should return short integration identifiers unchanged', () => {
      const identifier = 'sendgrid-prod';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifier);
    });
  });

  describe('Slug IDs with various prefixes', () => {
    it('should decode workflow slug IDs', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const slugId = `welcome-email_wf_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should decode template slug IDs', () => {
      const internalId = '507f1f77bcf86cd799439011';
      const encodedId = encodeBase62(internalId);
      const slugId = `email-template_et_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should decode topic slug IDs', () => {
      const internalId = '507f191e810c19729de860ea';
      const encodedId = encodeBase62(internalId);
      const slugId = `newsletter-subscribers_tp_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should decode integration slug IDs', () => {
      const internalId = '65f1234567890abcdef12345';
      const encodedId = encodeBase62(internalId);
      const slugId = `sendgrid-production_ig_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should decode slug IDs with any prefix format', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const slugId = `my-custom-resource_cr_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });
  });

  describe('Internal IDs with leading zeros in slug format', () => {
    it('should handle decoded IDs with leading zeros', () => {
      const internalIds = ['6615943e7ace93b0540ae377', '0615943e7ace93b0540ae377', '0015943e7ace93b0540ae377'];

      internalIds.forEach((internalId) => {
        const encodedId = encodeBase62(internalId);
        const slugId = `resource_prefix_${encodedId}`;
        expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
      });
    });
  });

  describe('Invalid or malformed inputs', () => {
    it('should return invalid slug IDs unchanged', () => {
      const invalidSlugId = 'my-resource_invalidEncoding';
      expect(pipe.transform(invalidSlugId, {} as ArgumentMetadata)).to.equal(invalidSlugId);
    });

    it('should return malformed slug IDs unchanged', () => {
      const malformedSlugId = 'resource_bad_encoding123';
      expect(pipe.transform(malformedSlugId, {} as ArgumentMetadata)).to.equal(malformedSlugId);
    });

    it('should handle empty strings', () => {
      expect(pipe.transform('', {} as ArgumentMetadata)).to.equal('');
    });

    it('should handle undefined values', () => {
      expect(pipe.transform(undefined as any, {} as ArgumentMetadata)).to.equal(undefined);
    });

    it('should handle null values', () => {
      expect(pipe.transform(null as any, {} as ArgumentMetadata)).to.equal(null);
    });
  });

  describe('Edge cases', () => {
    it('should handle very long resource names in slug format', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const longResourceName = 'very-long-resource-name-that-exceeds-normal-length';
      const slugId = `${longResourceName}_prefix_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should handle resource names with special characters', () => {
      const internalId = '6615943e7ace93b0540ae377';
      const encodedId = encodeBase62(internalId);
      const specialResourceName = 'resource-with-dashes_and_underscores';
      const slugId = `${specialResourceName}_prefix_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.equal(internalId);
    });

    it('should prioritize exact matches over decoding attempts', () => {
      // If a value looks like it could be decoded but is actually a valid short identifier
      const shortIdentifier = 'exactly-15-chars'; // 15 characters, less than ENCODED_ID_LENGTH
      expect(pipe.transform(shortIdentifier, {} as ArgumentMetadata)).to.equal(shortIdentifier);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - pipe(new ParseSlugIdPipe();
  });

  describe('MongoDB ObjectIds', ())
 - internalId('6615943e7ace93b0540ae377';
      expect(pipe.transform(internalId, {} as ArgumentMetadata)).to.equa...)
 - internalId('0615943e7ace93b0540ae377';
      expect(pipe.transform(internalId, {} as ArgumentMetadata)).to.equa...)
 - identifier('welcome-email';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifie...)
 - identifier('email-template';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifi...)
 - identifier('newsletter';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifier);...)
 - identifier('sendgrid-prod';
      expect(pipe.transform(identifier, {} as ArgumentMetadata)).to.equal(identifie...)
 - slugId(`welcome-email_wf_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.eq...)
 - slugId(`email-template_et_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.e...)
 - slugId(`newsletter-subscribers_tp_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadat...)
 - slugId(`sendgrid-production_ig_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata))...)
 - slugId(`my-custom-resource_cr_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetadata))....)
 - internalIds(['6615943e7ace93b0540ae377', '0615943e7ace93b0540ae377', '0015943e7ace93b0540ae377'];

      interna...)
 - slugId(`resource_prefix_${encodedId}`;
        expect(pipe.transform(slugId, {} as ArgumentMetadata)).to.eq...)
 - invalidSlugId('my-resource_invalidEncoding';
      expect(pipe.transform(invalidSlugId, {} as ArgumentMetadata)).t...)
 - malformedSlugId('resource_bad_encoding123';
      expect(pipe.transform(malformedSlugId, {} as ArgumentMetadata)).to...)
 - slugId(`${longResourceName}_prefix_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMetada...)
 - slugId(`${specialResourceName}_prefix_${encodedId}`;

      expect(pipe.transform(slugId, {} as ArgumentMet...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/parse-slug-id.pipe.ts
Tamaño: 334 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ArgumentMetadata, Injectable, PipeTransform } from '@nestjs/common';
import { InternalId, parseSlugId } from './parse-slug-id';

@Injectable()
export class ParseSlugIdPipe implements PipeTransform<string, InternalId> {
  transform(value: string, metadata: ArgumentMetadata): InternalId {
    return parseSlugId(value);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ParseSlugIdPipe

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/pipes/parse-slug-id.ts
Tamaño: 2434 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseRepository } from '@novu/dal';
import { decodeBase62 } from '../utils/base62';

export type InternalId = string;
const INTERNAL_ID_LENGTH = 24;
const ENCODED_ID_LENGTH = 16;

/**
 * Checks if the value is a short resource identifier (less than encoded ID length)
 * Examples: 'welcome-email', 'my-template', 'newsletter-topic'
 */
function isShortResourceIdentifier(value: string): boolean {
  return value.length < ENCODED_ID_LENGTH;
}

/**
 * Checks if the value is a MongoDB internal ID (24 character ObjectId)
 * Examples: '6615943e7ace93b0540ae377', '507f1f77bcf86cd799439011'
 */
function isInternalId(value: string): boolean {
  return BaseRepository.isInternalId(value) && value.length === INTERNAL_ID_LENGTH;
}

/**
 * Determines if the value is a valid resource identifier
 * Returns the value if it's either an internal ID or short identifier, null otherwise
 */
function lookoutForResourceId(value: string): string | null {
  if (isInternalId(value)) {
    return value;
  }

  if (isShortResourceIdentifier(value)) {
    return value;
  }

  return null;
}

/**
 * Parses a slug ID and returns the internal resource ID
 *
 * Handles multiple input formats:
 * - MongoDB ObjectId: '6615943e7ace93b0540ae377' → '6615943e7ace93b0540ae377'
 * - Short identifier: 'welcome-email' → 'welcome-email'
 * - Slug format: 'welcome-email_wf_1A2B3C4D5E6F7890' → '6615943e7ace93b0540ae377' (decoded)
 * - Invalid format: 'invalid-slug_bad_encoding' → 'invalid-slug_bad_encoding' (unchanged)
 *
 * @param value - The input value to parse
 * @returns The parsed internal ID or original value if parsing fails
 */
export function parseSlugId(value: string): InternalId {
  if (!value) {
    return value;
  }

  // Check if it's already a valid resource identifier
  const validId = lookoutForResourceId(value);
  if (validId) {
    return validId;
  }

  // Try to extract and decode the base62 encoded part from the end
  const encodedValue = value.slice(-ENCODED_ID_LENGTH);
  let decodedValue: string;

  try {
    decodedValue = decodeBase62(encodedValue);
  } catch (error) {
    // If decoding fails, return the original value
    return value;
  }

  // Check if the decoded value is a valid resource identifier
  const validDecodedId = lookoutForResourceId(decodedValue);
  if (validDecodedId) {
    return validDecodedId;
  }

  // If decoded value is not valid, return the original value
  return value;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isShortResourceIdentifier(value: string)
 - isInternalId(value: string)
 - lookoutForResourceId(value: string)
 - parseSlugId(value: string)
Declaraciones 'export' encontradas:
- export  type
- export function parseSlugId

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/resilience/delay.ts
Tamaño: 1758 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * This function takes in a time amount and a percentage for the variance for the jitter.
 * For example, if a time for 10 minutes  is passed in then with a variance of .1 percent
 * then the time that this function will return would be between [9m, 11m).
 * @param time the base amount of time that we need to add some jitter to.
 * @param variance a percentage that sets the size of the range of possibilities based off of the time attribute. Default is 0.1.
 */
export function addJitter(time, variance = 0.1): number {
  const variant = variance * time * Math.random();

  return Math.floor(time - (variance * time) / 2 + variant);
}

/**
 * This method uses an exponential function to get the amount
 * to delay by from the number of retries upto a specified limit
 * @param numOfRetries the number of retries that have been attempted so far
 * @param limit Default 300 seconds. Limit in seconds that this function is allowed to produce.
 */

export function getDelay(numOfRetries, limit = 300): number {
  return Math.max(limit, Math.min(1, Math.E ** (2.5 * numOfRetries)));
}

/**
 * This method uses an exponential function to get the amount
 * to delay by from the number of retries upto a specified limit,
 * then applies jitter to the delay generated.
 * @param numOfRetries the number of retries that have been attempted so far
 * @param limit Default 300 seconds. Limit in seconds that this function is allowed to produce.
 * @param variance a percentage that sets the size of the range of possibilities based off of the time attribute. Default is 0.1.
 */

export function getDelayWithJitter(numOfRetries, limit = 300, variance = 0.1): number {
  const baseDelay = getDelay(numOfRetries, limit);

  return addJitter(baseDelay, variance);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - addJitter(time, variance = 0.1)
 - getDelay(numOfRetries, limit = 300)
 - getDelayWithJitter(numOfRetries, limit = 300, variance = 0.1)
Declaraciones 'export' encontradas:
- export function addJitter
- export function getDelay
- export function getDelayWithJitter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/resilience/index.ts
Tamaño: 25 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './delay';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/channel-endpoint/channel-endpoint.schema.ts
Tamaño: 2625 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import { ChannelEndpointType, ENDPOINT_TYPES } from '@novu/shared';

// Centralized schema definition
export const CHANNEL_ENDPOINT_SCHEMAS = {
  [ENDPOINT_TYPES.SLACK_CHANNEL]: {
    description: 'Slack Channel Endpoint',
    properties: { channelId: { type: 'string' as const } },
    required: ['channelId'],
    validate: (endpoint: Record<string, unknown>) =>
      typeof endpoint.channelId === 'string' && Object.keys(endpoint).length === 1,
  },
  [ENDPOINT_TYPES.SLACK_USER]: {
    description: 'Slack User Endpoint',
    properties: { userId: { type: 'string' as const } },
    required: ['userId'],
    validate: (endpoint: Record<string, unknown>) =>
      typeof endpoint.userId === 'string' && Object.keys(endpoint).length === 1,
  },
  [ENDPOINT_TYPES.WEBHOOK]: {
    description: 'Webhook Endpoint (with optional channel)',
    properties: { url: { type: 'string' as const }, channel: { type: 'string' as const } },
    required: ['url'],
    validate: (endpoint: Record<string, unknown>) =>
      typeof endpoint.url === 'string' && Object.keys(endpoint).length === 1,
  },
  [ENDPOINT_TYPES.PHONE]: {
    description: 'Phone Endpoint',
    properties: { phoneNumber: { type: 'string' as const } },
    required: ['phoneNumber'],
    validate: (endpoint: Record<string, unknown>) =>
      typeof endpoint.phoneNumber === 'string' && Object.keys(endpoint).length === 1,
  },
} as const;

// Generate API property examples automatically
export function getApiPropertyExamples() {
  return Object.entries(CHANNEL_ENDPOINT_SCHEMAS).map(([, schema]) => ({
    properties: schema.properties,
    description: schema.description,
  }));
}

// Generate validator function automatically
export function validateEndpointForTypeFromSchema(
  type: ChannelEndpointType,
  endpoint: Record<string, unknown>
): boolean {
  const schema = CHANNEL_ENDPOINT_SCHEMAS[type];
  return schema ? schema.validate(endpoint) : false;
}

// Convenience function that throws exception
export function validateEndpointForType(type: ChannelEndpointType, endpoint: Record<string, unknown>): void {
  if (!validateEndpointForTypeFromSchema(type, endpoint)) {
    throw new BadRequestException(`Endpoint must match the required format for type "${type}"`);
  }
}

// Compile-time exhaustiveness check: this will cause a TypeScript error if any ENDPOINT_TYPE is missing from schemas
function _assertExhaustiveSchemas(): void {
  const _check: Record<ChannelEndpointType, unknown> = CHANNEL_ENDPOINT_SCHEMAS;
  // If compilation fails here, you're missing a schema for an ENDPOINT_TYPE
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getApiPropertyExamples()
 - validateEndpointForTypeFromSchema(type: ChannelEndpointType,
  endpoint: Record<string, unknown>)
 - validateEndpointForType(type: ChannelEndpointType, endpoint: Record<string, unknown>)
 - _assertExhaustiveSchemas()
Asignaciones con arrow functions encontradas (posibles funciones):
 - CHANNEL_ENDPOINT_SCHEMAS({
  [ENDPOINT_TYPES.SLACK_CHANNEL]: {
    description: 'Slack Channel Endpoint',
    properties: { c...)
Declaraciones 'export' encontradas:
- export  const
- export function getApiPropertyExamples
- export function validateEndpointForTypeFromSchema
- export function validateEndpointForType

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/channel-endpoint/index.ts
Tamaño: 43 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './channel-endpoint.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/channel-endpoint/__tests__/channel-endpoint.schema.spec.ts
Tamaño: 1847 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ENDPOINT_TYPES } from '@novu/shared';
import {
  CHANNEL_ENDPOINT_SCHEMAS,
  getApiPropertyExamples,
  validateEndpointForTypeFromSchema,
} from '../channel-endpoint.schema';

describe('ChannelEndpointSchema', () => {
  // This test will FAIL if you add a new ENDPOINT_TYPE but forget to add it to CHANNEL_ENDPOINT_SCHEMAS
  it('should have schema definitions for all ENDPOINT_TYPES', () => {
    const endpointTypes = Object.values(ENDPOINT_TYPES);
    const schemaKeys = Object.keys(CHANNEL_ENDPOINT_SCHEMAS);

    expect(schemaKeys.sort()).toEqual(endpointTypes.sort());
  });

  it('should generate API property examples for all types', () => {
    const examples = getApiPropertyExamples();
    const endpointTypesCount = Object.keys(ENDPOINT_TYPES).length;

    expect(examples).toHaveLength(endpointTypesCount);
    expect(examples.every((ex) => ex.properties && ex.description)).toBe(true);
  });

  it('should validate endpoints correctly', () => {
    // Valid cases
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.SLACK_CHANNEL, { channelId: 'C123' })).toBe(true);
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.SLACK_USER, { userId: 'U123' })).toBe(true);
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.WEBHOOK, { url: 'https://example.com' })).toBe(true);

    // Invalid cases
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.SLACK_CHANNEL, { userId: 'U123' })).toBe(false);
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.SLACK_USER, { channelId: 'C123' })).toBe(false);
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.WEBHOOK, { url: 'not-a-url' })).toBe(false);

    // Extra properties should fail
    expect(validateEndpointForTypeFromSchema(ENDPOINT_TYPES.SLACK_CHANNEL, { channelId: 'C123', extra: 'prop' })).toBe(
      false
    );
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - schemaKeys(Object.keys(CHANNEL_ENDPOINT_SCHEMAS);

    expect(schemaKeys.sort()).toEqual(endpointTypes.sort());...)
 - endpointTypesCount(Object.keys(ENDPOINT_TYPES).length;

    expect(examples).toHaveLength(endpointTypesCount);
    expe...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/chat-control.schema.ts
Tamaño: 776 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

export const chatControlZodSchema = z
  .object({
    skip: skipZodSchema,
    body: z.string(),
  })
  .strict();

export type ChatControlType = z.infer<typeof chatControlZodSchema>;

export const chatControlSchema = zodToJsonSchema(chatControlZodSchema, defaultOptions) as JSONSchemaEntity;
export const chatUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.CHAT,
  properties: {
    body: {
      component: UiComponentEnum.CHAT_BODY,
    },
    skip: skipStepUiSchema.properties.skip,
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/delay-control.schema.ts
Tamaño: 2352 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import {
  DelayTypeEnum,
  DigestUnitEnum,
  TimeUnitEnum,
  UiComponentEnum,
  UiSchema,
  UiSchemaGroupEnum,
} from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

const delayRegularControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.literal(DelayTypeEnum.REGULAR),
    amount: z.number().min(1),
    unit: z.nativeEnum(TimeUnitEnum),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

const delayTimedControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.literal(DelayTypeEnum.TIMED),
    cron: z.string().min(1),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

const delayDynamicControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.literal(DelayTypeEnum.DYNAMIC),
    dynamicKey: z.string().min(1),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

export const delayControlZodSchema = z.discriminatedUnion('type', [
  delayRegularControlZodSchema,
  delayTimedControlZodSchema,
  delayDynamicControlZodSchema,
]);

export type DelayRegularControlType = z.infer<typeof delayRegularControlZodSchema>;
export type DelayTimedControlType = z.infer<typeof delayTimedControlZodSchema>;
export type DelayDynamicControlType = z.infer<typeof delayDynamicControlZodSchema>;
export type DelayControlType = z.infer<typeof delayControlZodSchema>;

export const delayControlSchema = zodToJsonSchema(delayControlZodSchema, defaultOptions) as JSONSchemaEntity;

export const delayUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.DELAY,
  properties: {
    skip: skipStepUiSchema.properties.skip,
    amount: {
      component: UiComponentEnum.DELAY_AMOUNT,
      placeholder: null,
    },
    unit: {
      component: UiComponentEnum.DELAY_UNIT,
      placeholder: DigestUnitEnum.SECONDS,
    },
    cron: {
      component: UiComponentEnum.DELAY_CRON,
      placeholder: '',
    },
    dynamicKey: {
      component: UiComponentEnum.DELAY_DYNAMIC_KEY,
      placeholder: '',
    },
    type: {
      component: UiComponentEnum.DELAY_TYPE,
      placeholder: 'regular',
    },
    extendToSchedule: {
      component: UiComponentEnum.EXTEND_TO_SCHEDULE,
      placeholder: false,
    },
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  type
- export  type
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/digest-control.schema.ts
Tamaño: 2939 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import {
  DigestTypeEnum,
  DigestUnitEnum,
  TimeUnitEnum,
  UiComponentEnum,
  UiSchema,
  UiSchemaGroupEnum,
} from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

const lookBackWindowZodSchema = z
  .object({
    amount: z.number().min(1),
    unit: z.nativeEnum(TimeUnitEnum),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

const digestRegularControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.enum([DigestTypeEnum.REGULAR]).optional(),
    amount: z.number().min(1),
    unit: z.nativeEnum(TimeUnitEnum),
    digestKey: z.string().optional(),
    lookBackWindow: lookBackWindowZodSchema.optional(),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

const digestTimedControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.enum([DigestTypeEnum.TIMED]).optional(),
    cron: z.string().min(1),
    digestKey: z.string().optional(),
    extendToSchedule: z.boolean().optional(),
  })
  .strict();

export type LookBackWindowType = z.infer<typeof lookBackWindowZodSchema>;
export type DigestRegularControlType = z.infer<typeof digestRegularControlZodSchema>;
export type DigestTimedControlType = z.infer<typeof digestTimedControlZodSchema>;
export type DigestControlSchemaType = z.infer<typeof digestControlZodSchema>;

export const digestControlZodSchema = z.union([digestRegularControlZodSchema, digestTimedControlZodSchema]);
export const digestControlSchema = zodToJsonSchema(digestControlZodSchema, defaultOptions) as JSONSchemaEntity;

export function isDigestRegularControl(data: unknown): data is DigestRegularControlType {
  const result = digestRegularControlZodSchema.safeParse(data);

  return result.success;
}

export function isDigestTimedControl(data: unknown): data is DigestTimedControlType {
  const result = digestTimedControlZodSchema.safeParse(data);

  return result.success;
}

export function isDigestControl(data: unknown): data is DigestControlSchemaType {
  const result = digestControlZodSchema.safeParse(data);

  return result.success;
}

export const digestUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.DIGEST,
  properties: {
    amount: {
      component: UiComponentEnum.DIGEST_AMOUNT,
      placeholder: '',
    },
    unit: {
      component: UiComponentEnum.DIGEST_UNIT,
      placeholder: DigestUnitEnum.SECONDS,
    },
    digestKey: {
      component: UiComponentEnum.DIGEST_KEY,
      placeholder: '',
    },
    cron: {
      component: UiComponentEnum.DIGEST_CRON,
      placeholder: '',
    },
    type: {
      component: UiComponentEnum.DIGEST_TYPE,
      placeholder: 'regular',
    },
    extendToSchedule: {
      component: UiComponentEnum.EXTEND_TO_SCHEDULE,
      placeholder: false,
    },
    skip: skipStepUiSchema.properties.skip,
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isDigestRegularControl(data: unknown)
 - isDigestTimedControl(data: unknown)
 - isDigestControl(data: unknown)
Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type
- export  type
- export  const
- export  const
- export function isDigestRegularControl
- export function isDigestTimedControl
- export function isDigestControl
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/email-control.schema.ts
Tamaño: 1434 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

export const emailControlZodSchema = z
  .object({
    skip: skipZodSchema,
    body: z.string().optional().default(''),
    editorType: z.enum(['block', 'html']).optional().default('block'),
    subject: z.string().min(1),
    disableOutputSanitization: z.boolean().optional(),
    layoutId: z.string().nullish(),
  })
  .strict();

export type EmailControlType = Omit<z.infer<typeof emailControlZodSchema>, 'layoutId'> & {
  layoutId?: string | null;
};

export const emailControlSchema = zodToJsonSchema(emailControlZodSchema, defaultOptions) as JSONSchemaEntity;

export const emailUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.EMAIL,
  properties: {
    body: {
      component: UiComponentEnum.EMAIL_BODY,
    },
    subject: {
      component: UiComponentEnum.TEXT_INLINE_LABEL,
    },
    skip: skipStepUiSchema.properties.skip,
    editorType: {
      component: UiComponentEnum.EMAIL_EDITOR_SELECT,
      placeholder: 'block',
    },
    disableOutputSanitization: {
      component: UiComponentEnum.DISABLE_SANITIZATION_SWITCH,
      placeholder: false,
    },
    layoutId: {
      component: UiComponentEnum.LAYOUT_SELECT,
    },
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/in-app-control.schema.ts
Tamaño: 3821 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

/**
 * Regex pattern for validating URLs with template variables. Matches three cases:
 *
 * 1. URLs that start with template variables like {{variable}}
 *    - Example: {{variable}}, {{variable}}/path
 *
 * 2. Full URLs that may contain template variables
 *    - Excludes mailto: links
 *    - Example: https://example.com, https://example.com/{{variable}}, https://{{variable}}.com
 *
 * 3. Paths starting with / that may contain template variables
 *    - Example: /path/to/page, /path/{{variable}}/page
 *
 * Pattern is optimized to prevent exponential backtracking while maintaining all functionality
 */
const redirectUrlRegex =
  /^(?:\{\{[^}]*\}\}.*|(?!mailto:)(?:https?:\/\/[^\s/$.?#][^\s]*(?:\{\{[^}]*\}\})*[^\s]*)|\/[^\s]*(?:\{\{[^}]*\}\})*[^\s]*)$/;

const redirectZodSchema = z.object({
  url: z.string().regex(redirectUrlRegex),
  target: z.enum(['_self', '_blank', '_parent', '_top', '_unfencedTop']),
});

const actionZodSchema = z
  .object({
    label: z.string(),
    redirect: redirectZodSchema.optional(),
  })
  .optional();

// First, define the common properties that both schema variants will share
const commonInAppProperties = {
  skip: skipZodSchema,
  disableOutputSanitization: z.boolean().optional(),
  avatar: z.string().regex(redirectUrlRegex).optional(),
  primaryAction: actionZodSchema,
  secondaryAction: actionZodSchema,
  data: z.object({}).catchall(z.unknown()).optional(),
  redirect: redirectZodSchema.optional(),
};

const subjectRequiredSchema = z.object({
  subject: z.string().min(1),
  body: z.string().optional(),
  ...commonInAppProperties,
});

const bodyRequiredSchema = z.object({
  subject: z.string().optional(),
  body: z.string().min(1),
  ...commonInAppProperties,
});

// Write it this way because of how translation from zod to json schema works
export const inAppControlZodSchema = z.union([subjectRequiredSchema, bodyRequiredSchema]);

export type InAppRedirectType = z.infer<typeof redirectZodSchema>;
export type InAppActionType = z.infer<typeof actionZodSchema>;
export type InAppControlType = z.infer<typeof inAppControlZodSchema>;

export const inAppRedirectSchema = zodToJsonSchema(redirectZodSchema, defaultOptions) as JSONSchemaEntity;
export const inAppActionSchema = zodToJsonSchema(actionZodSchema, defaultOptions) as JSONSchemaEntity;
export const inAppControlSchema = zodToJsonSchema(inAppControlZodSchema, defaultOptions) as JSONSchemaEntity;

const redirectPlaceholder = {
  url: {
    placeholder: '',
  },
  target: {
    placeholder: '_self',
  },
};

export const inAppUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.IN_APP,
  properties: {
    body: {
      component: UiComponentEnum.IN_APP_BODY,
      placeholder: '',
    },
    avatar: {
      component: UiComponentEnum.IN_APP_AVATAR,
      placeholder: 'https://dashboard.novu.co/images/info.svg',
    },
    subject: {
      component: UiComponentEnum.IN_APP_SUBJECT,
      placeholder: '',
    },
    primaryAction: {
      component: UiComponentEnum.IN_APP_BUTTON_DROPDOWN,
      placeholder: null,
    },
    secondaryAction: {
      component: UiComponentEnum.IN_APP_BUTTON_DROPDOWN,
      placeholder: null,
    },
    redirect: {
      component: UiComponentEnum.URL_TEXT_BOX,
      placeholder: redirectPlaceholder,
    },
    skip: skipStepUiSchema.properties.skip,
    disableOutputSanitization: {
      component: UiComponentEnum.IN_APP_DISABLE_SANITIZATION_SWITCH,
      placeholder: false,
    },
    data: {
      component: UiComponentEnum.DATA,
      placeholder: null,
    },
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  type
- export  type
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/index.ts
Tamaño: 362 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './chat-control.schema';
export * from './delay-control.schema';
export * from './digest-control.schema';
export * from './email-control.schema';
export * from './in-app-control.schema';
export * from './layout-control.schema';
export * from './push-control.schema';
export * from './sms-control.schema';
export * from './throttle-control.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/layout-control.schema.ts
Tamaño: 1097 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions } from './shared';

// email layout schema is a subset of the email control schema
const layoutZodSchema = z.object({
  email: z
    .object({
      body: z.string().min(1),
      editorType: z.enum(['block', 'html']).optional().default('block'),
    })
    .optional(),
});

export type LayoutControlType = z.infer<typeof layoutZodSchema>;

export const layoutUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.LAYOUT,
  properties: {
    email: {
      component: UiComponentEnum.LAYOUT_EMAIL,
      properties: {
        body: {
          component: UiComponentEnum.EMAIL_BODY,
          placeholder: '',
        },
        editorType: {
          component: UiComponentEnum.EMAIL_EDITOR_SELECT,
          placeholder: 'block',
        },
      },
    },
  },
};

export const layoutControlSchema = zodToJsonSchema(layoutZodSchema, defaultOptions) as JSONSchemaEntity;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/push-control.schema.ts
Tamaño: 870 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

export const pushControlZodSchema = z
  .object({
    skip: skipZodSchema,
    subject: z.string(),
    body: z.string(),
  })
  .strict();

export type PushControlType = z.infer<typeof pushControlZodSchema>;

export const pushControlSchema = zodToJsonSchema(pushControlZodSchema, defaultOptions) as JSONSchemaEntity;
export const pushUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.PUSH,
  properties: {
    subject: {
      component: UiComponentEnum.PUSH_SUBJECT,
    },
    body: {
      component: UiComponentEnum.PUSH_BODY,
    },
    skip: skipStepUiSchema.properties.skip,
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/shared.ts
Tamaño: 498 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { Options, Targets } from 'zod-to-json-schema';

export const defaultOptions: Partial<Options<Targets>> = {
  $refStrategy: 'none',
};

export const skipZodSchema = z.object({}).catchall(z.unknown()).optional();

export const skipStepUiSchema = {
  group: UiSchemaGroupEnum.SKIP,
  properties: {
    skip: {
      component: UiComponentEnum.QUERY_EDITOR,
    },
  },
} satisfies UiSchema;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/sms-control.schema.ts
Tamaño: 768 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

export const smsControlZodSchema = z
  .object({
    skip: skipZodSchema,
    body: z.string(),
  })
  .strict();

export type SmsControlType = z.infer<typeof smsControlZodSchema>;

export const smsControlSchema = zodToJsonSchema(smsControlZodSchema, defaultOptions) as JSONSchemaEntity;
export const smsUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.SMS,
  properties: {
    body: {
      component: UiComponentEnum.SMS_BODY,
    },
    skip: skipStepUiSchema.properties.skip,
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/schemas/control/throttle-control.schema.ts
Tamaño: 2673 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchemaEntity } from '@novu/dal';
import { TimeUnitEnum, UiComponentEnum, UiSchema, UiSchemaGroupEnum } from '@novu/shared';
import { z } from 'zod';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { defaultOptions, skipStepUiSchema, skipZodSchema } from './shared';

// Throttle-specific time units (excluding seconds for performance reasons)
const ThrottleTimeUnitEnum = {
  MINUTES: TimeUnitEnum.MINUTES,
  HOURS: TimeUnitEnum.HOURS,
  DAYS: TimeUnitEnum.DAYS,
} as const;

// Throttle type enum
const ThrottleTypeEnum = {
  FIXED: 'fixed',
  DYNAMIC: 'dynamic',
} as const;

// Base throttle schema with all possible fields
export const throttleControlZodSchema = z
  .object({
    skip: skipZodSchema,
    type: z.enum([ThrottleTypeEnum.FIXED, ThrottleTypeEnum.DYNAMIC]).default(ThrottleTypeEnum.FIXED),
    // Fixed throttle fields
    amount: z.number().min(1).optional(),
    unit: z.nativeEnum(ThrottleTimeUnitEnum).optional(),
    // Dynamic throttle fields
    dynamicKey: z.string().min(1).optional(),
    // Common fields
    threshold: z.number().min(1).optional(),
    throttleKey: z.string().optional(),
  })
  .strict()
  .refine(
    (data) => {
      // If type is 'fixed', require amount and unit
      if (data.type === ThrottleTypeEnum.FIXED) {
        return data.amount !== undefined && data.unit !== undefined;
      }
      // If type is 'dynamic', require dynamicKey
      if (data.type === ThrottleTypeEnum.DYNAMIC) {
        return data.dynamicKey !== undefined && data.dynamicKey.length > 0;
      }
      return true;
    },
    {
      message: "Fixed throttle requires 'amount' and 'unit', dynamic throttle requires 'dynamicKey'",
    }
  );

export type ThrottleControlType = z.infer<typeof throttleControlZodSchema>;

export const throttleControlSchema = zodToJsonSchema(throttleControlZodSchema, defaultOptions) as JSONSchemaEntity;

export const throttleUiSchema: UiSchema = {
  group: UiSchemaGroupEnum.THROTTLE,
  properties: {
    skip: skipStepUiSchema.properties.skip,
    type: {
      component: UiComponentEnum.THROTTLE_TYPE,
      placeholder: ThrottleTypeEnum.FIXED,
    },
    amount: {
      component: UiComponentEnum.THROTTLE_WINDOW,
      placeholder: null,
    },
    unit: {
      component: UiComponentEnum.THROTTLE_UNIT,
      placeholder: TimeUnitEnum.MINUTES,
    },
    dynamicKey: {
      component: UiComponentEnum.THROTTLE_DYNAMIC_KEY,
      placeholder: 'payload.timestamp',
    },
    threshold: {
      component: UiComponentEnum.THROTTLE_THRESHOLD,
      placeholder: 1,
    },
    throttleKey: {
      component: UiComponentEnum.THROTTLE_KEY,
      placeholder: '',
    },
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - throttleControlZodSchema(z
  .object({
    skip: skipZodSchema,
    type: z.enum([ThrottleTypeEnum.FIXED, ThrottleTypeEnum.DY...)
Declaraciones 'export' encontradas:
- export  const
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytics.service.ts
Tamaño: 4663 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { IOrganizationEntity } from '@novu/shared';
import { Analytics } from '@segment/analytics-node';
import Mixpanel from 'mixpanel';

interface IUser {
  _id?: string | null;
  firstName?: string | null;
  lastName?: string | null;
  email?: string | null;
  profilePicture?: string | null;
  createdAt?: string | null;
}

const LOG_CONTEXT = 'AnalyticsService';

export class AnalyticsService {
  private segment: Analytics;
  private mixpanel: Mixpanel.Mixpanel;
  constructor(
    private segmentToken?: string | null,
    private batchSize = 100
  ) {}

  async initialize() {
    if (this.segmentToken) {
      this.segment = new Analytics({
        writeKey: this.segmentToken,
        maxEventsInBatch: this.batchSize,
      });
    }

    if (process.env.MIXPANEL_TOKEN) {
      this.mixpanel = Mixpanel.init(process.env.MIXPANEL_TOKEN);
    }
  }

  upsertGroup(organizationId: string, organization: IOrganizationEntity, user?: IUser) {
    if (!this.segmentEnabled) {
      return;
    }

    const traits: Record<string, string | string[]> = {
      _organization: organizationId,
      id: organizationId,
      name: organization.name,
      createdAt: this.convertToIsoDate(organization.createdAt),
      domain: organization.domain || user?.email?.split('@')[1] || '',
    };

    if (organization.productUseCases) {
      const productUseCases: string[] = [];

      for (const key in organization.productUseCases) {
        if (organization.productUseCases[key]) {
          productUseCases.push(key);
        }
      }
      traits.productUseCases = productUseCases;
    }

    this.segment.group({
      userId: user?._id as any,
      groupId: organizationId,
      traits,
    });
  }

  updateGroup(userId: string, groupId: string, traits: Record<string, string | string[]>) {
    if (!this.segmentEnabled) {
      return;
    }

    this.segment.group({
      userId,
      groupId,
      traits,
    });
  }

  alias(distinctId: string, userId: string) {
    if (!this.segmentEnabled) {
      return;
    }

    this.segment.alias({
      previousId: distinctId,
      userId,
    });
  }

  upsertUser(user: IUser, distinctId: string, traits: Record<string, string | string[]> = {}) {
    if (!this.segmentEnabled) {
      return;
    }

    const githubToken = (user as any).tokens?.find((token) => token.provider === 'github');

    this.segment.identify({
      userId: distinctId,
      traits: {
        firstName: user.firstName,
        lastName: user.lastName,
        name: `${user.firstName || ''} ${user.lastName || ''}`.trim(),
        email: user.email,
        avatar: user.profilePicture,
        createdAt: this.convertToIsoDate(user.createdAt),
        // For segment auto mapping
        created: this.convertToIsoDate(user.createdAt),
        githubProfile: githubToken?.username,
        ...traits,
      },
    });
  }

  setValue(userId: string, propertyName: string, value: string | number) {
    if (!this.segmentEnabled) {
      return;
    }

    this.segment.identify({
      userId,
      traits: {
        [propertyName]: value,
      },
    });
  }

  track(name: string, userId: string, data: Record<string, unknown> = {}) {
    if (!this.segmentEnabled) {
      return;
    }

    try {
      this.segment.track({
        anonymousId: userId,
        userId,
        event: name,
        properties: data,
      });
    } catch (error: any) {
      Logger.error(
        {
          eventName: name,
          usedId: userId,
          message: error.message,
        },
        'There has been an error when tracking',
        LOG_CONTEXT
      );
    }
  }

  mixpanelTrack(name: string, userId: string, data: Record<string, unknown> = {}) {
    if (!this.mixpanelEnabled) {
      return;
    }

    try {
      this.mixpanel.track(name, {
        distinct_id: userId,
        ...data,
      });
    } catch (error: any) {
      Logger.error(
        {
          eventName: name,
          usedId: userId,
          message: error?.message,
        },
        'There has been an error when tracking mixpanel',
        LOG_CONTEXT
      );
    }
  }

  private get segmentEnabled() {
    return process.env.NODE_ENV !== 'test' && this.segment;
  }

  private get mixpanelEnabled() {
    return process.env.NODE_ENV !== 'test' && this.mixpanel;
  }

  private convertToIsoDate(createdAt: string | number | null): string {
    const createdAtNumber = Number(createdAt);
    const isEpochValidNumber = !Number.isNaN(createdAtNumber);

    if (isEpochValidNumber) {
      return new Date(createdAtNumber).toISOString();
    }

    return String(createdAt);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - githubToken(user as any).tokens?.find((token))
Declaraciones 'export' encontradas:
- export class AnalyticsService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/content.service.ts
Tamaño: 7333 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import {
  DelayTypeEnum,
  FilterParts,
  FilterPartTypeEnum,
  getTemplateVariables,
  IFieldFilterPart,
  IMustacheVariable,
  ITriggerReservedVariable,
  ReservedVariablesMap,
  StepTypeEnum,
  TemplateSystemVariables,
  TemplateVariableTypeEnum,
  TriggerContextTypeEnum,
  TriggerReservedVariables,
} from '@novu/shared';
import Handlebars from 'handlebars';
import { NotificationStep } from '../value-objects';

export class ContentService {
  replaceVariables(content: string, variables: { [key: string]: string }) {
    if (!content) return content;
    let modifiedContent = content;

    for (const key in variables) {
      if (!variables.hasOwnProperty(key)) continue;
      modifiedContent = modifiedContent.replace(new RegExp(`{{${this.escapeForRegExp(key)}}}`, 'g'), variables[key]);
    }

    return modifiedContent;
  }

  extractVariables(content: string): IMustacheVariable[] {
    if (!content) return [];

    try {
      const ast: hbs.AST.Program = Handlebars.parseWithoutProcessing(content);

      return getTemplateVariables(ast.body);
    } catch (e) {
      throw new BadRequestException('Failed to extract variables');
    }
  }

  extractMessageVariables(messages: NotificationStep[]): {
    variables: IMustacheVariable[];
    reservedVariables: ITriggerReservedVariable[];
  } {
    const variables: IMustacheVariable[] = [];
    const reservedVariables: ITriggerReservedVariable[] = [];

    for (const text of this.messagesTextIterator(messages)) {
      const extractedVariables = this.extractVariables(text);
      const extractedReservedVariables = this.extractReservedVariables(extractedVariables);

      reservedVariables.push(...extractedReservedVariables);
      variables.push(...extractedVariables);
    }

    variables.push(...this.extractStepVariables(messages));

    return {
      variables: [
        ...new Map(
          variables.filter((item) => !this.isSystemVariable(item.name)).map((item) => [item.name, item])
        ).values(),
      ],
      reservedVariables: [...new Map(reservedVariables.map((item) => [item.type, item])).values()],
    };
  }

  extractStepVariables(messages: NotificationStep[]): IMustacheVariable[] {
    const variables: IMustacheVariable[] = [];

    for (const message of messages) {
      if (message.filters) {
        const filters = Array.isArray(message.filters) ? message.filters : [];
        const filteredVariables = filters.flatMap((filter) => {
          const filteredChildren = this.filterChildren(filter.children);

          const mappedChildren = filteredChildren.map((item: IFieldFilterPart) => {
            return {
              name: item.field,
              type: TemplateVariableTypeEnum.STRING,
            };
          });

          return mappedChildren;
        });

        variables.push(...filteredVariables);
      }

      if (
        message.metadata &&
        'type' in message.metadata &&
        message.metadata.type === DelayTypeEnum.SCHEDULED &&
        'delayPath' in message.metadata &&
        message.metadata.delayPath
      ) {
        variables.push({
          name: message.metadata.delayPath,
          type: TemplateVariableTypeEnum.STRING,
        });
      }

      if (message.template?.type === StepTypeEnum.DIGEST) {
        if (message.metadata && 'digestKey' in message.metadata && message.metadata.digestKey) {
          variables.push({
            name: message.metadata.digestKey,
            type: TemplateVariableTypeEnum.STRING,
          });
        }
      }
    }

    return variables;
  }

  extractReservedVariables(variables: IMustacheVariable[]): ITriggerReservedVariable[] {
    const reservedVariables: ITriggerReservedVariable[] = [];

    const reservedVariableTypes = variables
      .filter((item) => this.isReservedVariable(item.name))
      .map((item) => this.getVariableNamePrefix(item.name));

    const triggerContextTypes = Array.from(new Set(reservedVariableTypes)) as TriggerContextTypeEnum[];

    triggerContextTypes.forEach((variable) => {
      reservedVariables.push({
        type: variable,
        variables: ReservedVariablesMap[variable],
      });
    });

    return reservedVariables;
  }

  extractSubscriberMessageVariables(messages: NotificationStep[]): string[] {
    const variables: string[] = [];

    const hasSmsMessage = !!messages.find((i) => i.template?.type === StepTypeEnum.SMS);
    if (hasSmsMessage) {
      variables.push('phone');
    }

    const hasEmailMessage = !!messages.find((i) => i.template?.type === StepTypeEnum.EMAIL);
    if (hasEmailMessage) {
      variables.push('email');
    }

    return Array.from(new Set(variables));
  }

  private *messagesTextIterator(messages: NotificationStep[]): Generator<string> {
    for (const message of messages) {
      if (!message.template) continue;

      if (message.template?.type === StepTypeEnum.IN_APP) {
        yield message.template.content as string;

        if (message?.template.cta?.data?.url) {
          yield message.template.cta.data.url;
        }
      } else if (message.template?.type === StepTypeEnum.SMS) {
        yield message.template.content as string;
      } else if (message.template?.type === StepTypeEnum.PUSH) {
        yield message.template.content as string;
        yield message.template.title as string;
      } else if (Array.isArray(message.template?.content)) {
        yield message.template.subject || '';

        for (const block of message.template.content) {
          yield block.url || '';
          yield block.content;
        }
      } else if (typeof message.template.content === 'string') {
        yield message.template.content;
      }
    }
  }

  private isSystemVariable(variableName: string): boolean {
    return TemplateSystemVariables.includes(this.getVariableNamePrefix(variableName));
  }

  private getVariableNamePrefix(variableName: string): string {
    return variableName.includes('.') ? variableName.split('.')[0] : variableName;
  }

  private isReservedVariable(variableName: string): boolean {
    return TriggerReservedVariables.includes(this.getVariableNamePrefix(variableName));
  }

  private escapeForRegExp(content: string) {
    return content.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
  }

  buildMessageVariables(commandPayload: any, subscriberPayload): { [key: string]: any } {
    const messageVariables: { [key: string]: any } = { ...commandPayload };

    return this.combineObjects(messageVariables, subscriberPayload, 'subscriber');
  }

  private combineObjects(
    messageVariables: { [key: string]: any },
    subscriberPayload,
    subscriberString = ''
  ): { [key: string]: any } {
    const newMessageVariables: { [key: string]: any } = { ...messageVariables };

    Object.keys(subscriberPayload).forEach((key) => {
      const newKey = subscriberString === '' ? key : `${subscriberString}.${key}`;
      newMessageVariables[newKey] = subscriberPayload[key];
    });

    return newMessageVariables;
  }

  private isIFieldFilterPart(item: FilterParts): item is IFieldFilterPart {
    return item.on === FilterPartTypeEnum.PAYLOAD;
  }
  private filterChildren(children: FilterParts[]): IFieldFilterPart[] {
    return (children || []).filter(this.isIFieldFilterPart);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - extractedReservedVariables(this.extractReservedVariables(extractedVariables);

      reservedVariables.push(...extractedReserve...)
 - filteredVariables(filters.flatMap((filter))
 - mappedChildren(filteredChildren.map((item: IFieldFilterPart))
 - reservedVariableTypes(variables
      .filter((item))
 - triggerContextTypes(Array.from(new Set(reservedVariableTypes)) as TriggerContextTypeEnum[];

    triggerContextTypes.for...)
 - hasSmsMessage(!!messages.find((i))
 - hasEmailMessage(!!messages.find((i))
Declaraciones 'export' encontradas:
- export class ContentService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/index.ts
Tamaño: 1097 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './analytic-logs';
export { AnalyticsService } from './analytics.service';
export * from './auth';
export {
  BullMqConnectionOptions,
  BullMqService,
  Job,
  JobsOptions,
  Processor,
  Queue,
  QueueBaseOptions,
  QueueOptions,
  Worker,
  WorkerOptions,
} from './bull-mq';
export * from './cache';
export * from './calculate-delay';
export * from './content.service';
export * from './cron';
export * from './feature-flags';
export * from './in-memory-provider';
export {
  MessageInteractionResult,
  MessageInteractionService,
  MessageInteractionTrace,
} from './message-interaction.service';
export * from './metrics';
export * from './queues';
export { INovuWorker, ReadinessService } from './readiness';
export * from './sanitize/sanitizer.service';
export * from './sanitize/sanitizer-v0.service';
export * from './socket-worker';
export * from './storage';
export { SupportService } from './support.service';
export * from './throttle';
export { VerifyPayloadService } from './verify-payload.service';
export * from './workers';
export * from './workflow-run.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/message-interaction.service.ts
Tamaño: 4375 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { DeliveryLifecycleDetail, DeliveryLifecycleStatusEnum } from '@novu/shared';
import { PinoLogger } from 'nestjs-pino';
import { Trace, TraceLogRepository } from './analytic-logs/trace-log';
import { WorkflowRunService } from './workflow-run.service';
import { WorkflowRunStatusEnum } from './analytic-logs';

export interface MessageInteractionResult {
  success: boolean;
  processedTraceCount: number;
  error?: string;
}

export type MessageInteractionTrace = Omit<Trace, 'id' | 'expires_at'> & {
  _notificationId: string;
};

@Injectable()
export class MessageInteractionService {
  constructor(
    private traceLogRepository: TraceLogRepository,
    private workflowRunService: WorkflowRunService,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  async trace(
    interactionsTraces: MessageInteractionTrace[],
    deliveryLifecycleStatus: DeliveryLifecycleStatusEnum | null,
    deliveryLifecycleDetail?: DeliveryLifecycleDetail
  ): Promise<MessageInteractionResult> {
    try {
      if (interactionsTraces.length > 0) {
        await this.traceLogRepository.createStepRun(
          interactionsTraces.map(
            (trace) =>
              ({
                organization_id: trace.organization_id,
                environment_id: trace.environment_id,
                user_id: trace.user_id,
                entity_id: trace.entity_id,
                event_type: trace.event_type,
                created_at: trace.created_at,
                external_subscriber_id: trace.external_subscriber_id,
                subscriber_id: trace.subscriber_id,
                title: trace.title,
                message: trace.message,
                step_run_type: trace.step_run_type,
                raw_data: trace.raw_data,
                status: trace.status,
                workflow_run_identifier: trace.workflow_run_identifier,
              }) satisfies Omit<Trace, 'id' | 'expires_at' | 'entity_type'>
          )
        );

        this.logger.debug(
          {
            traceCount: interactionsTraces.length,
            organizationId: interactionsTraces[0]?.organization_id,
            environmentId: interactionsTraces[0]?.environment_id,
          },
          `Successfully logged ${interactionsTraces.length} message interaction traces`
        );

        await this.updateDeliveryLifecycle({
          traces: interactionsTraces,
          deliveryLifecycleStatus,
          deliveryLifecycleDetail,
        });
      }

      return {
        success: true,
        processedTraceCount: interactionsTraces.length,
      };
    } catch (error) {
      this.logger.warn(
        {
          err: error,
          traceCount: interactionsTraces.length,
          organizationId: interactionsTraces[0]?.organization_id,
          environmentId: interactionsTraces[0]?.environment_id,
        },
        `Failed to process message interaction traces`
      );

      return {
        success: false,
        processedTraceCount: 0,
        error: error instanceof Error ? error.message : 'Unknown error',
      };
    }
  }

  private async updateDeliveryLifecycle({
    traces,
    deliveryLifecycleStatus,
    deliveryLifecycleDetail,
  }: {
    traces: MessageInteractionTrace[];
    deliveryLifecycleStatus: DeliveryLifecycleStatusEnum;
    deliveryLifecycleDetail?: DeliveryLifecycleDetail;
  }) {
    const tracesByNotificationId = traces.reduce<Record<string, MessageInteractionTrace[]>>((acc, trace) => {
      if (!acc[trace._notificationId]) acc[trace._notificationId] = [];
      acc[trace._notificationId].push(trace);
      return acc;
    }, {});

    for (const notificationId in tracesByNotificationId) {
      // for each workflow run, we need to update the delivery lifecycle as interacted, we do not care how exactly or how many times
      const trace = tracesByNotificationId[notificationId][0];

      await this.workflowRunService.updateDeliveryLifecycle({
        workflowStatus: WorkflowRunStatusEnum.COMPLETED,
        notificationId: trace._notificationId,
        environmentId: trace.environment_id,
        organizationId: trace.organization_id,
        _subscriberId: trace.subscriber_id,
        deliveryLifecycleStatus,
        ...(deliveryLifecycleDetail && { deliveryLifecycleDetail }),
      });
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - MessageInteractionTrace(Omit<Trace, 'id' | 'expires_at'> & {
  _notificationId: string;
};

@Injectable()
export class Messa...)
 - tracesByNotificationId(traces.reduce<Record<string, MessageInteractionTrace[]>>((acc, trace))
Declaraciones 'export' encontradas:
- export  interface
- export  type
- export class MessageInteractionService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/resource-validator.service.ts
Tamaño: 7761 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, HttpException, HttpStatus, Injectable } from '@nestjs/common';
import {
  CommunityOrganizationRepository,
  EnvironmentEntity,
  EnvironmentRepository,
  LayoutRepository,
  NotificationTemplateRepository,
  OrganizationEntity,
} from '@novu/dal';
import {
  ApiServiceLevelEnum,
  FeatureFlagsKeysEnum,
  FeatureNameEnum,
  getFeatureForTierAsBoolean,
  getFeatureForTierAsNumber,
  ResourceOriginEnum,
  ResourceTypeEnum,
  UNLIMITED_VALUE,
} from '@novu/shared';
import { NotificationStep } from '../value-objects/notification.step';
import { FeatureFlagsService } from './feature-flags';

export const DAY_IN_MS = 24 * 60 * 60 * 1000;
const DEMO_WORKFLOWS_IDENTIFIER = [
  'demo-apartment-review',
  'a-new-member-joining-the-team',
  'demo-verify-otp',
  'demo-password-reset',
  'demo-recent-login',
  'demo-comment-on-task',
];

/* The absolute maximum values allowed by the system */
export const SYSTEM_LIMITS = {
  WORKFLOWS: 100,
  LAYOUTS: 100,
  STEPS_PER_WORKFLOW: 20,
  DEFER_DURATION_MS: 180 * DAY_IN_MS,
  ENVIRONMENTS: 10,
} as const;

/* The threshold below which validation is skipped */
export const MIN_VALIDATION_LIMITS = {
  WORKFLOWS: 20,
  LAYOUTS: 1,
  STEPS_PER_WORKFLOW: 20,
  DEFER_DURATION_MS: DAY_IN_MS,
} as const;

@Injectable()
export class ResourceValidatorService {
  constructor(
    private notificationTemplateRepository: NotificationTemplateRepository,
    private organizationRepository: CommunityOrganizationRepository,
    private environmentRepository: EnvironmentRepository,
    private featureFlagService: FeatureFlagsService,
    private layoutRepository: LayoutRepository
  ) {}

  async validateStepsLimit(environmentId: string, organizationId: string, steps: NotificationStep[]): Promise<void> {
    if (steps.length < MIN_VALIDATION_LIMITS.STEPS_PER_WORKFLOW) {
      return;
    }

    const organization = await this.getOrganization(organizationId);

    const maxStepsPerWorkflowNumber = await this.featureFlagService.getFlag({
      key: FeatureFlagsKeysEnum.MAX_STEPS_PER_WORKFLOW_LIMIT_NUMBER,
      environment: { _id: environmentId },
      organization,
      defaultValue: SYSTEM_LIMITS.STEPS_PER_WORKFLOW,
    });

    if (steps.length > maxStepsPerWorkflowNumber) {
      throw new BadRequestException({
        message: `Workflow steps limit exceeded. Maximum allowed steps is ${maxStepsPerWorkflowNumber}, but got ${steps.length} steps.`,
        providedStepsCount: steps.length,
        maxSteps: maxStepsPerWorkflowNumber,
      });
    }
  }

  async validateWorkflowLimit(environmentId: string): Promise<void> {
    const workflowsCount = await this.notificationTemplateRepository.count({
      _environmentId: environmentId,
      'triggers.identifier': { $nin: DEMO_WORKFLOWS_IDENTIFIER },
    });

    if (workflowsCount < MIN_VALIDATION_LIMITS.WORKFLOWS) {
      return;
    }

    const environment = await this.getEnvironment(environmentId);
    const organization = await this.getOrganization(environment._organizationId);
    const maxWorkflowLimit = await this.getWorkflowLimit(environment, organization);

    if (workflowsCount >= maxWorkflowLimit) {
      throw new BadRequestException({
        message: 'Workflow limit exceeded. Please contact us to support more workflows.',
        currentCount: workflowsCount,
        limit: maxWorkflowLimit,
      });
    }
  }

  private async getWorkflowLimit(environment: EnvironmentEntity, organization: OrganizationEntity) {
    const systemLimitMaxWorkflow = await this.getMaxWorkflowSystemLimit(environment, organization);

    // If the system limit is not the default, we need to use it as the absolute limit for special cases instead of the tier limit
    const isSpecialLimit = systemLimitMaxWorkflow !== SYSTEM_LIMITS.WORKFLOWS;
    if (isSpecialLimit) {
      return systemLimitMaxWorkflow;
    }

    const maxWorkflowsTierLimit = await this.getMaxWorkflowsTierLimit(environment, organization);

    return Math.min(systemLimitMaxWorkflow, maxWorkflowsTierLimit);
  }

  private async getMaxWorkflowsTierLimit(environment, organization) {
    if (process.env.IS_SELF_HOSTED === 'true') {
      return UNLIMITED_VALUE; // Use existing constant for unlimited
    }

    return getFeatureForTierAsNumber(
      FeatureNameEnum.PLATFORM_MAX_WORKFLOWS,
      organization.apiServiceLevel || ApiServiceLevelEnum.FREE,
      false
    );
  }

  private async getMaxWorkflowSystemLimit(environment, organization) {
    return await this.featureFlagService.getFlag({
      key: FeatureFlagsKeysEnum.MAX_WORKFLOW_LIMIT_NUMBER,
      defaultValue: SYSTEM_LIMITS.WORKFLOWS,
      environment,
      organization,
    });
  }

  async validateLayoutsLimit(environmentId: string, isV2Layout: boolean): Promise<void> {
    let layoutsCount = 0;
    if (isV2Layout) {
      layoutsCount = await this.layoutRepository.count({
        _environmentId: environmentId,
        type: ResourceTypeEnum.BRIDGE,
        origin: ResourceOriginEnum.NOVU_CLOUD,
      });
    } else {
      layoutsCount = await this.layoutRepository.count({
        _environmentId: environmentId,
        type: { $exists: false },
        origin: { $exists: false },
      });
    }

    if (layoutsCount < MIN_VALIDATION_LIMITS.LAYOUTS) {
      return;
    }

    const environment = await this.getEnvironment(environmentId);
    const organization = await this.getOrganization(environment._organizationId);
    const maxLayoutsLimit = await this.getLayoutLimit(environment, organization, layoutsCount);

    if (layoutsCount >= maxLayoutsLimit) {
      throw new BadRequestException({
        message: 'Layout limit exceeded. Please contact us to support more layouts.',
        currentCount: layoutsCount,
        limit: maxLayoutsLimit,
      });
    }
  }

  private async getLayoutLimit(environment: EnvironmentEntity, organization: OrganizationEntity, layoutsCount: number) {
    const maxLayoutsTierLimit = await this.getMaxLayoutsTierLimit(organization);
    if (layoutsCount >= maxLayoutsTierLimit && organization.apiServiceLevel === ApiServiceLevelEnum.FREE) {
      return maxLayoutsTierLimit;
    }

    const systemLimitMaxLayouts = await this.getMaxLayoutsSystemLimit(environment, organization);
    // If the system limit is not the default, we need to use it as the absolute limit for special cases instead of the tier limit
    const isSpecialLimit = systemLimitMaxLayouts !== SYSTEM_LIMITS.LAYOUTS;
    if (isSpecialLimit) {
      return systemLimitMaxLayouts;
    }

    return Math.min(systemLimitMaxLayouts, maxLayoutsTierLimit);
  }

  private async getMaxLayoutsSystemLimit(environment, organization) {
    return await this.featureFlagService.getFlag({
      key: FeatureFlagsKeysEnum.MAX_LAYOUT_LIMIT_NUMBER,
      defaultValue: SYSTEM_LIMITS.LAYOUTS,
      environment,
      organization,
    });
  }

  private async getMaxLayoutsTierLimit(organization) {
    if (process.env.IS_SELF_HOSTED === 'true') {
      return UNLIMITED_VALUE;
    }

    return getFeatureForTierAsNumber(
      FeatureNameEnum.PLATFORM_MAX_LAYOUTS,
      organization.apiServiceLevel || ApiServiceLevelEnum.FREE,
      false
    );
  }

  private async getEnvironment(environmentId: string) {
    const environment = await this.environmentRepository.findOne({ _id: environmentId });

    if (!environment) {
      throw new BadRequestException({
        message: 'Environment not found',
      });
    }

    return environment;
  }

  private async getOrganization(organizationId: string) {
    const organization = await this.organizationRepository.findById(organizationId);

    if (!organization) {
      throw new BadRequestException({
        message: 'Organization not found',
      });
    }

    return organization;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export class ResourceValidatorService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/support.service.ts
Tamaño: 1857 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { PlainClient, UpsertResult } from '@team-plain/typescript-sdk';

const LOG_CONTEXT = 'SupportService';

export class SupportService {
  private plainClient: PlainClient;
  private readonly plainKey: string;
  constructor() {
    this.plainKey = process.env.PLAIN_SUPPORT_KEY;
    if (this.plainKey) {
      this.plainClient = new PlainClient({ apiKey: this.plainKey });
      Logger.log(`Initialized PlainClient`, LOG_CONTEXT);
    } else {
      Logger.log('Skipping PlainClient initialization', LOG_CONTEXT);
    }
  }

  async upsertCustomer({ emailAddress, fullName, novuUserId }) {
    const res = await this.plainClient?.upsertCustomer({
      identifier: {
        emailAddress,
      },
      onCreate: {
        email: {
          email: emailAddress,
          isVerified: true,
        },
        externalId: novuUserId,
        fullName,
      },
      onUpdate: {
        externalId: { value: novuUserId },
        email: {
          email: emailAddress,
          isVerified: true,
        },
        fullName: {
          value: fullName,
        },
      },
    });
    if (res.error) {
      Logger.error({ emailAddress, fullName, error: res.error }, res.error.message, LOG_CONTEXT);
      throw new Error(res.error.message);
    } else {
      return res;
    }
  }

  async createThread({ plainCustomerId, threadText }) {
    const res = await this.plainClient?.createThread({
      customerIdentifier: {
        customerId: plainCustomerId,
      },
      components: [
        {
          componentText: {
            text: threadText,
          },
        },
      ],
    });

    if (res.error) {
      Logger.error({ plainCustomerId, threadText, error: res.error }, res.error.message, LOG_CONTEXT);
      throw new Error(res.error.message);
    } else {
      return res;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SupportService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/verify-payload.service.ts
Tamaño: 2630 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException } from '@nestjs/common';
import { ITemplateVariable, TemplateSystemVariables } from '@novu/shared';

export class VerifyPayloadService {
  checkRequired(variables: ITemplateVariable[], payload: Record<string, unknown>): string[] {
    const invalidKeys: string[] = [];

    for (const variable of variables.filter((vari) => vari.required && !this.isSystemVariable(vari.name))) {
      let value;

      try {
        value = variable.name.split('.').reduce((a: any, b) => a[b], payload);
      } catch (e) {
        value = null;
      }

      const variableTypeHumanize = {
        String: 'Value',
        Array: 'Array',
        Boolean: 'Boolean',
      }[variable.type];

      const variableErrorHumanize = `${variable.name} (${variableTypeHumanize})`;

      switch (variable.type) {
        case 'Array':
          if (!Array.isArray(value)) invalidKeys.push(variableErrorHumanize);
          break;
        case 'Boolean':
          if (value !== true && value !== false) invalidKeys.push(variableErrorHumanize);
          break;
        case 'String':
          if (!['string', 'number'].includes(typeof value)) invalidKeys.push(variableErrorHumanize);
          break;
        default:
          if (value === null || value === undefined) invalidKeys.push(variableErrorHumanize);
      }
    }

    return invalidKeys;
  }

  fillDefaults(variables: ITemplateVariable[]): Record<string, unknown> {
    const payload = {};

    for (const variable of variables.filter(
      (elem) => elem.defaultValue !== undefined && elem.defaultValue !== null && !this.isSystemVariable(elem.name)
    )) {
      this.setNestedKey(payload, variable.name.split('.'), variable.defaultValue);
    }

    return payload;
  }

  private setNestedKey(obj, path, value) {
    if (path.length === 1) {
      if (value !== '') {
        obj[path[0]] = value;
      }

      return;
    }

    if (!obj[path[0]]) {
      obj[path[0]] = {};
    }

    return this.setNestedKey(obj[path[0]], path.slice(1), value);
  }

  isSystemVariable(variableName: string): boolean {
    return TemplateSystemVariables.includes(variableName.includes('.') ? variableName.split('.')[0] : variableName);
  }

  verifyPayload(variables: ITemplateVariable[], payload: Record<string, unknown>): Record<string, unknown> {
    const invalidKeys: string[] = [];
    invalidKeys.push(...this.checkRequired(variables || [], payload));
    if (invalidKeys.length) {
      throw new BadRequestException(`payload is missing required key(s) and type(s): ${invalidKeys.join(', ')}`);
    }

    return this.fillDefaults(variables || []);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - value(variable.name.split('.').reduce((a: any, b))
 - payload({};

    for (const variable of variables.filter(
      (elem))
Declaraciones 'export' encontradas:
- export class VerifyPayloadService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workflow-run.service.ts
Tamaño: 12097 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { JobEntity, JobRepository, JobStatusEnum, MessageEntity, MessageRepository } from '@novu/dal';
import { DeliveryLifecycleDetail, DeliveryLifecycleStatusEnum } from '@novu/shared';
import { PinoLogger } from '../logging';
import { WorkflowRunRepository, WorkflowRunStatusEnum } from './analytic-logs';

interface WorkflowStatusUpdateParams {
  workflowStatus: WorkflowRunStatusEnum;
  notificationId: string;
  environmentId: string;
  organizationId: string;
  _subscriberId: string;
  deliveryLifecycleStatus?: DeliveryLifecycleStatusEnum;
  deliveryLifecycleDetail?: DeliveryLifecycleDetail;
}

type JobResult = Pick<JobEntity, 'type' | 'status' | 'deliveryLifecycleState' | '_id'>;
type MessageResult = Pick<
  MessageEntity,
  'seen' | 'read' | 'snoozedUntil' | 'archived' | 'channel' | 'deliveredAt' | '_jobId'
>;

type ProjectionFromPick<T> = {
  [K in keyof T]: 1;
};

const jobResultProjection: ProjectionFromPick<JobResult> = {
  _id: 1,
  type: 1,
  status: 1,
  deliveryLifecycleState: 1,
};

const messageResultProjection: ProjectionFromPick<MessageResult> = {
  seen: 1,
  read: 1,
  snoozedUntil: 1,
  archived: 1,
  channel: 1,
  deliveredAt: 1,
  _jobId: 1,
};

@Injectable()
export class WorkflowRunService {
  constructor(
    private jobRepository: JobRepository,
    private messageRepository: MessageRepository,
    private workflowRunRepository: WorkflowRunRepository,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  async updateDeliveryLifecycle({
    notificationId,
    environmentId,
    organizationId,
    _subscriberId,
    workflowStatus,
    deliveryLifecycleStatus: providedStatus,
    deliveryLifecycleDetail: providedDetail,
  }: WorkflowStatusUpdateParams): Promise<void> {
    try {
      let deliveryLifecycleStatus: DeliveryLifecycleStatusEnum;
      let deliveryLifecycleDetail: DeliveryLifecycleDetail | undefined;

      if (providedStatus) {
        deliveryLifecycleStatus = providedStatus;
        deliveryLifecycleDetail = providedDetail;
      } else {
        const result = await this.getDeliveryLifecycle({
          workflowStatus,
          notificationId,
          environmentId,
          organizationId,
          _subscriberId,
        });
        deliveryLifecycleStatus = result.deliveryLifecycleStatus;
        deliveryLifecycleDetail = result.deliveryLifecycleDetail;
      }

      if (deliveryLifecycleStatus === DeliveryLifecycleStatusEnum.PENDING) {
        // Optimization: Skip workflow run updates when delivery lifecycle is pending
        // since the workflow run should already be in the expected pending state
        return;
      }

      await this.workflowRunRepository.updateWorkflowRunState(
        notificationId,
        workflowStatus,
        {
          organizationId,
          environmentId,
        },
        deliveryLifecycleStatus,
        deliveryLifecycleDetail
      );

      this.logger.debug(
        {
          notificationId,
          organizationId,
          environmentId,
          deliveryLifecycleStatus,
          deliveryLifecycleDetail,
        },
        `Updated workflow run delivery lifecycle to ${deliveryLifecycleStatus}${deliveryLifecycleDetail ? ` with reason: ${deliveryLifecycleDetail}` : ''}`
      );
    } catch (error) {
      this.logger.error(
        {
          error: error instanceof Error ? error.message : 'Unknown error',
          notificationId,
        },
        'Failed to update workflow run delivery lifecycle based on jobs'
      );
    }
  }

  async getDeliveryLifecycle({
    notificationId,
    environmentId,
    organizationId,
    _subscriberId,
  }: WorkflowStatusUpdateParams): Promise<{
    deliveryLifecycleStatus: DeliveryLifecycleStatusEnum;
    deliveryLifecycleDetail?: DeliveryLifecycleDetail;
  }> {
    try {
      const [jobs, messages] = await Promise.all([
        this.getJobsForWorkflowRun(notificationId, environmentId, organizationId, _subscriberId),
        this.getMessagesForWorkflowRun(notificationId, environmentId, organizationId, _subscriberId),
      ]);

      return this.buildDeliveryLifecycle(jobs, messages);
    } catch (error) {
      this.logger.error(
        {
          error: error instanceof Error ? error.message : 'Unknown error',
          notificationId,
        },
        'Failed to get workflow run delivery lifecycle'
      );
    }
  }

  private async getJobsForWorkflowRun(
    notificationId: string,
    environmentId: string,
    organizationId: string,
    _subscriberId: string
  ): Promise<JobResult[]> {
    const jobs = await this.jobRepository.find(
      {
        _notificationId: notificationId,
        _environmentId: environmentId,
        _organizationId: organizationId,
        _subscriberId,
      },
      jobResultProjection,
      {
        limit: 100, // Should be enough for most workflows
        sort: { updatedAt: 1 },
      }
    );

    return jobs;
  }

  private async getMessagesForWorkflowRun(
    notificationId: string,
    environmentId: string,
    organizationId: string,
    _subscriberId: string
  ): Promise<MessageResult[]> {
    const messages = await this.messageRepository.find(
      {
        _notificationId: notificationId,
        _environmentId: environmentId,
        _organizationId: organizationId,
        _subscriberId,
      },
      messageResultProjection,
      {
        limit: 50, // Should be enough for most workflows
        sort: { updatedAt: 1 },
      }
    );

    return messages;
  }

  /**
   * Maps workflow run delivery lifecycle based on jobs and messages using priority-based business logic.
   *
   * Priority Order (highest → lowest):
   * 1. INTERACTED - If any message has seen/read/snoozedUntil/archived as true
   * 2. DELIVERED - If any message has been delivered (has deliveredAt) and no interaction found
   * 3. SENT - If any step has COMPLETED status and has a message created for it
   * 4. SKIPPED - If all steps finish processing AND at least one step has SKIPPED status
   *    - Detail Priority: SUBSCRIBER_PREFERENCE > USER_STEP_CONDITION > other details
   * 5. CANCELED - If any step has CANCELED status (only if no SKIPPED found)
   * 6. ERRORED - Workflow Run will not be sent due to failure in all steps
   * 7. MERGED - If all steps are MERGED
   * 8. PENDING - If any step has PENDING, QUEUED, RUNNING, or DELAYED status
   */
  private buildDeliveryLifecycle(
    jobs: JobResult[],
    messages: MessageResult[]
  ): {
    deliveryLifecycleStatus: DeliveryLifecycleStatusEnum;
    deliveryLifecycleDetail?: DeliveryLifecycleDetail;
  } {
    // Filter for channel jobs (exclude non-channel jobs like trigger, delay, digest, custom)
    const channelJobs = jobs.filter((job) => job.type && ['in_app', 'email', 'sms', 'chat', 'push'].includes(job.type));

    if (channelJobs.length === 0) {
      return {
        deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.ERRORED,
        deliveryLifecycleDetail: DeliveryLifecycleDetail.WORKFLOW_MISSING_CHANNEL_STEP,
      };
    }

    // Priority 1: INTERACTED - If any message has seen/read/snoozedUntil/archived as true
    const hasInteractedMessage = messages.some(
      (message) => message.seen || message.read || message.snoozedUntil || message.archived
    );

    if (hasInteractedMessage) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.INTERACTED };
    }

    // Priority 2: DELIVERED - If any message has been delivered (has deliveredAt) and no interaction found
    if (messages.some((message) => !!message.deliveredAt)) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.DELIVERED };
    }

    // Priority 3: SENT - If any step is COMPLETED and has a message created for it
    const messageSent = channelJobs.some((job) => {
      if (job.status !== JobStatusEnum.COMPLETED) return false;
      return messages.some((message) => message._jobId === job._id);
    });
    if (messageSent) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.SENT };
    }

    // Priority 4: SKIPPED - Only when all steps finish processing AND at least one job is SKIPPED
    const finishedStatuses = [
      JobStatusEnum.COMPLETED,
      JobStatusEnum.FAILED,
      JobStatusEnum.CANCELED,
      JobStatusEnum.MERGED,
      JobStatusEnum.SKIPPED,
    ];
    const allStepsFinished = channelJobs.every((job) => finishedStatuses.includes(job.status));
    const skippedJobs = channelJobs.filter(
      (job) => job.deliveryLifecycleState?.status && job.deliveryLifecycleState.status === 'skipped'
    );
    if (allStepsFinished && skippedJobs.length > 0) {
      // Priority order for delivery lifecycle details (highest → lowest):
      // 1. SUBSCRIBER_PREFERENCE - User preference settings
      // 2. USER_STEP_CONDITION - Step condition evaluation
      // 3. All other details (missing credentials, phone, email, etc.)
      const priorityOrder = [
        DeliveryLifecycleDetail.SUBSCRIBER_PREFERENCE,
        DeliveryLifecycleDetail.USER_STEP_CONDITION,
        DeliveryLifecycleDetail.USER_MISSING_EMAIL,
        DeliveryLifecycleDetail.USER_MISSING_PHONE,
        DeliveryLifecycleDetail.USER_MISSING_PUSH_TOKEN,
        DeliveryLifecycleDetail.USER_MISSING_WEBHOOK_URL,
        DeliveryLifecycleDetail.USER_MISSING_CREDENTIALS,
      ];

      // Find the highest priority detail among skipped jobs
      let selectedDetail: DeliveryLifecycleDetail | undefined;
      for (const detail of priorityOrder) {
        const jobWithDetail = skippedJobs.find((job) => job.deliveryLifecycleState?.detail === detail);
        if (jobWithDetail) {
          selectedDetail = detail;
          break;
        }
      }

      // Fallback to first skipped job's detail if no prioritized detail found
      if (!selectedDetail) {
        selectedDetail = skippedJobs[0].deliveryLifecycleState?.detail;
      }

      return {
        deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.SKIPPED,
        deliveryLifecycleDetail: selectedDetail,
      };
    }

    // Priority 5: CANCELED - Any job with CANCELED status (only if no SKIPPED found)
    const hasUserCanceled = channelJobs.some(
      (job) => isJobCancelled(job) || job.deliveryLifecycleState?.status === DeliveryLifecycleStatusEnum.CANCELED
    );
    if (hasUserCanceled) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.CANCELED };
    }

    // Priority 6: ERRORED - If all steps have failed
    const allStepsFailed = channelJobs.every((job) => job.status === JobStatusEnum.FAILED);

    if (allStepsFailed) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.ERRORED };
    }

    // Priority 7: MERGED - If all steps are merged
    const allStepsMerged = channelJobs.every((job) => job.status === JobStatusEnum.MERGED);
    if (allStepsMerged) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.MERGED };
    }

    // Priority 8: PENDING - If any step is pending (pending, queued, delayed)
    const hasPendingSteps = channelJobs.some(
      (job) =>
        job.status === JobStatusEnum.PENDING ||
        job.status === JobStatusEnum.QUEUED ||
        job.status === JobStatusEnum.DELAYED
    );
    if (hasPendingSteps) {
      return { deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.PENDING };
    }

    this.logger.warn(
      {
        jobIds: channelJobs.map((job) => job._id),
        statuses: channelJobs.map((job) => ({
          status: job.status,
          deliveryLifecycleState: job.deliveryLifecycleState,
        })),
      },
      'No matching delivery lifecycle found for jobs, falling back to ERRORED'
    );

    return {
      deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.ERRORED,
      deliveryLifecycleDetail: DeliveryLifecycleDetail.UNKNOWN_ERROR,
    };
  }
}

// backward compatibility - will be removed once the database is updated with the deliveryLifecycleState field
function isJobCancelled(job: JobResult): boolean {
  return job.status === JobStatusEnum.CANCELED && !job.deliveryLifecycleState?.status;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isJobCancelled(job: JobResult)
Asignaciones con arrow functions encontradas (posibles funciones):
 - channelJobs(jobs.filter((job))
 - hasInteractedMessage(messages.some(
      (message))
 - messageSent(channelJobs.some((job))
 - allStepsFinished(channelJobs.every((job))
 - skippedJobs(channelJobs.filter(
      (job))
 - jobWithDetail(skippedJobs.find((job))
 - hasUserCanceled(channelJobs.some(
      (job))
 - allStepsFailed(channelJobs.every((job))
 - allStepsMerged(channelJobs.every((job))
 - hasPendingSteps(channelJobs.some(
      (job))
Declaraciones 'export' encontradas:
- export class WorkflowRunService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/clickhouse.service.ts
Tamaño: 3854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClickHouseClient, ClickHouseSettings, createClient, PingResult } from '@clickhouse/client';
import { Injectable, OnModuleDestroy } from '@nestjs/common';

export { ClickHouseClient };

export type InsertOptions = {
  asyncInsert?: boolean;
  waitForAsyncInsert?: boolean;
};

@Injectable()
export class ClickHouseService implements OnModuleDestroy {
  private _client: ClickHouseClient | undefined;

  async init() {
    if (!process.env.CLICK_HOUSE_URL || !process.env.CLICK_HOUSE_DATABASE) {
      /*
       * this.logger.warn(
       *   'ClickHouse client is not initialized due to missing environment configuration. ' +
       *     'Please provide CLICK_HOUSE_URL and CLICK_HOUSE_DATABASE.'
       * );
       */
      this._client = undefined;

      return;
    }

    if (process.env.NODE_ENV === 'local' || process.env.NODE_ENV === 'test') {
      const defaultClient = createClient({
        host: 'http://localhost:8123',
        username: 'default',
        password: '',
        database: 'default',
      });

      try {
        await defaultClient.query({
          query: `CREATE DATABASE IF NOT EXISTS \`${process.env.CLICK_HOUSE_DATABASE}\``,
        });
        console.log(`Database "${process.env.CLICK_HOUSE_DATABASE}" ensured.`);
      } catch (error) {
        console.error(`Failed to create database ${process.env.CLICK_HOUSE_DATABASE}:`, error);
      }
    }

    this._client = createClient({
      url: process.env.CLICK_HOUSE_URL,
      username: process.env.CLICK_HOUSE_USER,
      password: process.env.CLICK_HOUSE_PASSWORD,
      database: process.env.CLICK_HOUSE_DATABASE,
      max_open_connections: process.env.CLICK_HOUSE_MAX_OPEN_CONNECTIONS
        ? parseInt(process.env.CLICK_HOUSE_MAX_OPEN_CONNECTIONS, 10)
        : 10,
    });
  }

  get client(): ClickHouseClient | undefined {
    return this._client;
  }

  async onModuleDestroy() {
    if (!this._client) {
      return;
    }
    await this._client.close();
    // this.logger.info('ClickHouse client closed');
  }

  async ping(): Promise<PingResult> {
    if (!this._client) {
      return { success: false, error: new Error('Ping failed: ClickHouse client not initialized') };
    }

    try {
      const isAlive = await this._client.ping();
      // this.logger.info('ClickHouse server ping successful');

      return isAlive;
    } catch (error) {
      // this.logger.error('ClickHouse server ping failed', error);
      throw error;
    }
  }

  async query<T>({
    query,
    params,
  }: {
    query: string;
    params: Record<string, unknown>;
  }): Promise<{ data: T[]; rows: number }> {
    if (!this._client) {
      throw new Error('Query failed: ClickHouse client not initialized');
    }

    const resultSet = await this._client.query({
      query,
      query_params: params,
      format: 'JSON',
    });

    const data = (await resultSet.json()) as {
      data: T[];
      rows: number;
    };

    return data;
  }

  public async insert<T extends Record<string, unknown>>(
    table: string,
    values: T[],
    clickhouseSettings?: InsertOptions
  ) {
    if (!this._client) {
      return;
    }

    const settings: ClickHouseSettings = {};
    if (clickhouseSettings?.asyncInsert !== undefined) {
      settings.async_insert = clickhouseSettings.asyncInsert ? 1 : 0;
    }
    if (clickhouseSettings?.waitForAsyncInsert !== undefined) {
      settings.wait_for_async_insert = clickhouseSettings.waitForAsyncInsert ? 1 : 0;
    }

    await this._client.insert({
      table,
      values,
      format: 'JSONEachRow',
      clickhouse_settings: settings,
    });
  }

  public async exec({ query, params }: { query: string; params?: Record<string, unknown> }): Promise<void> {
    if (!this._client) {
      return;
    }

    await this._client.exec({
      query,
      query_params: params,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export  type
- export class ClickHouseService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/index.ts
Tamaño: 541 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { createClient as createClickHouseClient } from '@clickhouse/client';
export * from './clickhouse.service';
export * from './log.repository';
export * from './request-log';
export { StepRun, StepRunFinalStatus, StepRunNonFinalStatus, StepRunRepository, StepRunStatus } from './step-run';
export { EventType, mapEventTypeToTitle, Trace, TraceLogRepository, TraceStatus, traceLogSchema } from './trace-log';
export { StepType } from './types';
export { WorkflowRun, WorkflowRunRepository, WorkflowRunStatusEnum } from './workflow-run';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/log.repository.ts
Tamaño: 26290 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FeatureFlagsKeysEnum } from '@novu/shared';
import { ClickhouseSchema, InferClickhouseSchemaType } from 'clickhouse-schema';
import { addDays } from 'date-fns';
import { PinoLogger } from 'nestjs-pino';
import { generateObjectId } from '../../utils/generate-id';
import { Prettify } from '../../utils/prettify.type';
import { FeatureFlagsService } from '../feature-flags/feature-flags.service';
import { ClickHouseService, InsertOptions } from './clickhouse.service';

// Define operators as const assertion to maintain literal types
const CLICKHOUSE_OPERATORS = [
  '=',
  '==',
  '!=',
  '<>',
  '<=',
  '>=',
  '<',
  '>',
  'LIKE',
  'NOT LIKE',
  'ILIKE',
  'IN',
  'NOT IN',
  'GLOBAL IN',
  'GLOBAL NOT IN',
  'IS NULL',
  'IS NOT NULL',
  'has',
  'hasAny',
  'hasAll',
] as const;

// Define array operators that require array values
type ArrayOperators = 'IN' | 'NOT IN' | 'GLOBAL IN' | 'GLOBAL NOT IN' | 'hasAny' | 'hasAll';

// Define null operators that don't require values
type NullOperators = 'IS NULL' | 'IS NOT NULL';

// Generate the type from the const array - this ensures single source of truth
export type ClickhouseOperator = (typeof CLICKHOUSE_OPERATORS)[number];

// Export the array for runtime validation
export const ALLOWED_OPERATORS: readonly ClickhouseOperator[] = CLICKHOUSE_OPERATORS;

const LIMIT_MAX_THRESHOLD = 1000;
export const ORDER_DIRECTION = ['ASC', 'DESC'];

export type OrCondition<T> = {
  $or: WhereCondition<T>[];
};

export type EnforcedContext = {
  environmentId: string;
};

type ConditionValue<T, K extends keyof T, O extends ClickhouseOperator> = O extends NullOperators
  ? never
  : O extends ArrayOperators
    ? T[K][]
    : T[K];

export type FieldCondition<T, K extends keyof T, O extends ClickhouseOperator> = O extends NullOperators
  ? {
      field: K;
      operator: O;
    }
  : {
      field: K;
      operator: O;
      value: ConditionValue<T, K, O>;
    };

type WhereCondition<T> = FieldCondition<T, keyof T, ClickhouseOperator> | OrCondition<T>;

export interface EnforcedWhere<T> {
  enforced: EnforcedContext;
  conditions?: WhereCondition<T>[];
}

// For system operations that need to bypass tenant enforcement (logged for monitoring)
export interface UnsafeWhere<T> {
  conditions: WhereCondition<T>[];
  __unsafe: true; // Explicit opt-in to bypass enforcement
}

export type Where<T> = EnforcedWhere<T> | UnsafeWhere<T>;

// eslint-disable-next-line @typescript-eslint/no-explicit-any
export type SchemaKeys<T extends ClickhouseSchema<any>> = keyof InferClickhouseSchemaType<T>;

// eslint-disable-next-line @typescript-eslint/no-explicit-any
export abstract class LogRepository<TSchema extends ClickhouseSchema<any>, TEnhancedType> {
  readonly table: string;
  readonly identifierPrefix: string;

  constructor(
    protected readonly clickhouseService: ClickHouseService,
    protected readonly logger: PinoLogger,
    protected readonly schema: TSchema,
    protected readonly schemaOrderBy: SchemaKeys<TSchema>[],
    protected readonly featureFlagsService: FeatureFlagsService
  ) {
    this.initialize();
  }

  private async initialize() {
    if (process.env.NODE_ENV !== 'local' && process.env.NODE_ENV !== 'test') {
      return;
    }

    const query = this.schema.GetCreateTableQuery();

    try {
      await this.clickhouseService.exec({ query });
      console.log('Table created', this.table);
    } catch (error) {
      this.logger.error('Failed to create ClickHouse table', error);
    }
  }

  private getColumnType(column: string): string {
    return this.schema.schema[column]?.type?.toString() || 'String';
  }

  private isArrayColumn(column: string): boolean {
    const typeString = this.getColumnType(column);
    return typeString.startsWith('Array(');
  }

  private validateColumnName(columnName: SchemaKeys<TSchema>): void {
    if (!columnName || typeof columnName !== 'string') {
      throw new Error('Invalid column name: must be a non-empty string');
    }

    if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(columnName)) {
      throw new Error(`Invalid column name format: ${columnName}`);
    }

    if (!this.schema.schema[columnName]) {
      throw new Error(`Column '${columnName}' does not exist in schema`);
    }
  }

  private validateOperator(operator: ClickhouseOperator): void {
    if (!ALLOWED_OPERATORS.includes(operator)) {
      throw new Error(`Invalid operator: ${operator}. Allowed operators: ${ALLOWED_OPERATORS.join(', ')}`);
    }
  }

  protected async getExpirationDate(context?: {
    organizationId?: string;
    environmentId?: string;
    userId?: string;
  }): Promise<Date> {
    try {
      const expirationDays = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.LOG_EXPIRATION_DAYS_NUMBER,
        defaultValue: 100,
        organization: context?.organizationId ? { _id: context.organizationId } : undefined,
        environment: context?.environmentId ? { _id: context.environmentId } : undefined,
        user: context?.userId ? { _id: context.userId } : undefined,
      });

      return addDays(new Date(), expirationDays);
    } catch (error) {
      this.logger.warn(
        { error: error instanceof Error ? error.message : 'Unknown error' },
        'Failed to fetch log expiration days from LaunchDarkly, falling back to 100 days'
      );

      return addDays(new Date(), 100);
    }
  }

  protected buildWhereClause(where: Where<TEnhancedType>): {
    clause: string;
    params: Record<string, unknown>;
  } {
    // Cast enhanced type to raw schema type only at this lowest level
    const rawWhere = where as unknown as Where<InferClickhouseSchemaType<TSchema>>;
    let allConditions: WhereCondition<InferClickhouseSchemaType<TSchema>>[] = [];

    if ('__unsafe' in rawWhere) {
      // Unsafe mode - log for monitoring but allow
      this.logger.warn('Using unsafe WHERE clause without tenant enforcement', {
        table: this.table,
        conditionsCount: rawWhere.conditions.length,
      });
      allConditions = rawWhere.conditions;
    } else {
      // Safe mode - enforce tenant context
      const enforcedConditions = this.buildEnforcedConditions(rawWhere.enforced);
      allConditions = [...enforcedConditions, ...(rawWhere.conditions || [])];
    }

    return this.buildWhereClauseFromConditions(allConditions);
  }

  private buildEnforcedConditions(enforced: EnforcedContext): WhereCondition<InferClickhouseSchemaType<TSchema>>[] {
    const condition = {
      field: 'environment_id' as keyof InferClickhouseSchemaType<TSchema>,
      operator: '=' as const,
      value: enforced.environmentId,
    };

    const conditions: WhereCondition<InferClickhouseSchemaType<TSchema>>[] = [condition];

    return conditions;
  }

  private buildWhereClauseFromConditions(conditions: WhereCondition<InferClickhouseSchemaType<TSchema>>[]): {
    clause: string;
    params: Record<string, unknown>;
  } {
    const params: Record<string, unknown> = {};
    let paramIndex = 0;

    const buildSingleCondition = (condition: WhereCondition<InferClickhouseSchemaType<TSchema>>): string => {
      // Handle OR conditions
      if ('$or' in condition) {
        if (!Array.isArray(condition.$or)) {
          throw new Error('$or condition must contain an array of conditions');
        }

        const orClauses = condition.$or.map((orCondition) => buildSingleCondition(orCondition));
        return `(${orClauses.join(' OR ')})`;
      }

      // Handle structured conditions {field, operator, value}
      if (!('field' in condition) || !('operator' in condition)) {
        throw new Error('Each condition must have field and operator properties');
      }

      const { field, operator } = condition;
      const value = 'value' in condition ? condition.value : undefined;
      this.validateColumnName(field as SchemaKeys<TSchema>);
      this.validateOperator(operator);

      // NULL operators don't need values
      const nullOperators: NullOperators[] = ['IS NULL', 'IS NOT NULL'];
      if (nullOperators.includes(operator as NullOperators)) {
        return `${String(field)} ${operator}`;
      }

      // For non-NULL operators, value is required
      if (!nullOperators.includes(operator as NullOperators) && (value === null || value === undefined)) {
        throw new Error(`Invalid value for column '${String(field)}': value cannot be null or undefined`);
      }

      const paramName = `param_${paramIndex}_${String(field).replace(/[^a-zA-Z0-9]/g, '')}`;
      paramIndex++;
      params[paramName] = value;

      let paramType = this.getColumnType(String(field));
      const arrayOperators: ArrayOperators[] = ['IN', 'NOT IN', 'GLOBAL IN', 'GLOBAL NOT IN', 'hasAny', 'hasAll'];
      const arrayFunctionOperators = ['has', 'hasAny', 'hasAll'];

      // For array operators with array values, wrap non-array columns with Array()
      // Array columns (e.g., context_keys: Array(String)) should not be double-wrapped
      if (arrayOperators.includes(operator as ArrayOperators) && Array.isArray(value)) {
        if (!this.isArrayColumn(String(field))) {
          paramType = `Array(${paramType})`;
        }
      }

      // ClickHouse array functions use function syntax: has(array, value)
      if (arrayFunctionOperators.includes(operator)) {
        return `${operator}(${String(field)}, {${paramName}:${paramType}})`;
      }

      return `${String(field)} ${operator} {${paramName}:${paramType}}`;
    };

    const clauses = conditions.map((condition) => buildSingleCondition(condition)).join(' AND ');

    return { clause: clauses ? `WHERE ${clauses}` : '', params };
  }

  protected async insert(
    data: Omit<TEnhancedType, 'id' | 'expires_at'> & { id?: string },
    context: {
      organizationId?: string;
      environmentId?: string;
      userId?: string;
    },
    options: InsertOptions
  ): Promise<void> {
    // Use provided id (e.g., ID for request entities), otherwise generate a new unique id
    const id: string = data?.id || `${this.identifierPrefix}${generateObjectId()}`;
    const expirationDate = await this.getExpirationDate(context);
    const expiresAt = LogRepository.formatDateTime64(expirationDate);

    await this.clickhouseService.insert(this.table, [{ ...data, id, expires_at: expiresAt }], options);
  }

  protected async insertMany(
    data: Omit<TEnhancedType, 'id' | 'expires_at'>[],
    context: {
      organizationId?: string;
      environmentId?: string;
      userId?: string;
    },
    options: InsertOptions
  ): Promise<void> {
    const ids = data.map((_item) => `${this.identifierPrefix}${generateObjectId()}`);
    const expirationDate = await this.getExpirationDate(context);
    const expiresAt = LogRepository.formatDateTime64(expirationDate);

    await this.clickhouseService.insert(
      this.table,
      data.map((item, index) => ({ ...item, id: ids[index], expires_at: expiresAt })),
      options
    );
  }

  // Overload for column array selection
  async find<T extends readonly (keyof InferClickhouseSchemaType<TSchema>)[]>(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data: Prettify<Pick<TEnhancedType, T[number]>>[];
    rows: number;
  }>;

  // Overload for "*" all columns selection
  async find(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: '*';
  }): Promise<{
    data: TEnhancedType[];
    rows: number;
  }>;

  // Implementation
  async find<T extends readonly (keyof InferClickhouseSchemaType<TSchema>)[] | '*'>(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data:
      | TEnhancedType[]
      | Prettify<Pick<TEnhancedType, T extends readonly (keyof TEnhancedType)[] ? T[number] : never>>[];
    rows: number;
  }> {
    const { where, limit = 100, offset = 0, orderBy, orderDirection = 'DESC', useFinal = false, select } = options;

    if (limit < 0 || limit > LIMIT_MAX_THRESHOLD) {
      throw new Error(`Limit must be between 0 and ${LIMIT_MAX_THRESHOLD}`);
    }
    if (offset < 0) {
      throw new Error('Offset must be non-negative');
    }

    const { clause, params } = this.buildWhereClause(where);

    if (orderBy) {
      this.validateColumnName(String(orderBy));

      if (!this.schemaOrderBy.includes(orderBy)) {
        this.logger.warn(
          {
            orderBy,
            schemaOrderBy: this.schemaOrderBy,
          },
          `Column '${orderBy as string}' cannot be used for ordering. Available columns: ${this.schemaOrderBy.join(', ')}`
        );
      }
    }

    if (orderDirection && !ORDER_DIRECTION.includes(orderDirection)) {
      throw new Error(`Invalid order direction: ${orderDirection}. Allowed directions: ${ORDER_DIRECTION.join(', ')}`);
    }

    // Build SELECT clause - use provided columns or all columns if "*" is specified
    const selectClause = select === '*' ? '*' : (select as readonly string[]).join(', ');

    const finalModifier = useFinal ? ' FINAL' : '';
    const query = `
      SELECT ${selectClause}
      FROM ${this.table}${finalModifier}
      ${clause}
      ${orderBy ? `ORDER BY ${String(orderBy)} ${orderDirection}` : ''}
      LIMIT ${limit}
      OFFSET ${offset}
    `;

    const result = await this.clickhouseService.query({
      query,
      params,
    });

    return result as {
      data: TEnhancedType[] | Pick<TEnhancedType, T extends readonly (keyof TEnhancedType)[] ? T[number] : never>[];
      rows: number;
    };
  }

  // Overload for column array selection
  async findOne<T extends readonly (keyof InferClickhouseSchemaType<TSchema>)[]>(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data: Pick<TEnhancedType, T[number]>;
    rows: number;
  }>;

  // Overload for "*" all columns selection
  async findOne(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: '*';
  }): Promise<{
    data: TEnhancedType;
    rows: number;
  }>;

  // Implementation
  async findOne<T extends readonly (keyof InferClickhouseSchemaType<TSchema>)[] | '*'>(options: {
    where: Where<TEnhancedType>;
    limit?: number;
    offset?: number;
    orderBy?: SchemaKeys<TSchema>;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data: TEnhancedType | Pick<TEnhancedType, T extends readonly (keyof TEnhancedType)[] ? T[number] : never>;
    rows: number;
  }> {
    // Handle the "*" case explicitly
    if (options.select === '*') {
      const result = await this.find({
        ...options,
        limit: 1,
        select: '*',
      } as Parameters<typeof this.find>[0]);
      return { data: result.data[0], rows: result.rows };
    }

    // Handle the array case
    const result = await this.find({
      ...options,
      limit: 1,
      select: options.select as T extends readonly (keyof InferClickhouseSchemaType<TSchema>)[] ? T : never,
    } as Parameters<typeof this.find>[0]);

    return { data: result.data[0], rows: result.rows };
  }

  async count(options: { where: Where<TEnhancedType>; useFinal?: boolean }): Promise<number> {
    const { where, useFinal = false } = options;
    const finalModifier = useFinal ? ' FINAL' : '';

    const { clause, params } = this.buildWhereClause(where);

    const query = `
      SELECT toInt64(count()) as total
      FROM ${this.table}${finalModifier}
      ${clause}
    `;

    const result = await this.clickhouseService.query<{ total: number | string }>({
      query,
      params,
    });

    const total = result.data[0]?.total;

    return Number(total || 0);
  }

  static formatDateTime64(date: Date) {
    // Use toISOString() to get UTC time, then format for ClickHouse
    const isoString = date.toISOString();

    // Remove the 'Z' suffix since ClickHouse DateTime64 with UTC timezone handles it
    return isoString.slice(0, -1) as unknown as Date;
  }
}

/**
 * Optional fluent query builder for better ergonomics
 *
 * @example Basic usage with OR conditions:
 * ```typescript
 * // Using the fluent callback approach
 * const query1 = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
 *   .whereEquals('organization_id', 'org456')
 *   .whereIn('status', ['pending', 'running'])
 *   .or(builder => {
 *     builder
 *       .whereLike('channels', '%email%')
 *       .whereLike('channels', '%sms%');
 *   })
 *   .build();
 *
 * // Using the direct array approach
 * const query2 = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
 *   .whereEquals('organization_id', 'org456')
 *   .orWhere([
 *     { field: 'priority', operator: '=', value: 'high' },
 *     { field: 'urgent', operator: '=', value: true }
 *   ])
 *   .build();
 *
 * // Both generate ClickHouse SQL with proper parameter binding:
 * // query1: WHERE environment_id = 'env123' AND organization_id = 'org456'
 * //           AND status IN ['pending', 'running']
 * //           AND (channels LIKE '%email%' OR channels LIKE '%sms%')
 * // query2: WHERE environment_id = 'env123' AND organization_id = 'org456'
 * //           AND (priority = 'high' OR urgent = true)
 * ```
 *
 * @example Real-world usage (from GetWorkflowRuns use case):
 * ```typescript
 * const queryBuilder = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
 *   .whereEquals('organization_id', 'org456')
 *   .whereIn('status', ['completed', 'failed'])
 *   .whereGreaterThanOrEqual('created_at', new Date('2024-01-01'))
 *   .orWhere(
 *     channels.map(channel => ({
 *       field: 'channels',
 *       operator: 'LIKE',
 *       value: `%"${channel}"%`
 *     }))
 *   );
 *
 * const where = queryBuilder.build();
 * const result = await repository.find({ where, limit: 100 });
 *
 * // Generates SQL:
 * // WHERE environment_id = 'env123'
 * //   AND organization_id = 'org456'
 * //   AND status IN ['completed', 'failed']
 * //   AND created_at >= '2024-01-01T00:00:00.000'
 * //   AND (channels LIKE '%"email"%' OR channels LIKE '%"sms"%' OR channels LIKE '%"push"%')
 * ```
 */
export class QueryBuilder<T> {
  private conditions: WhereCondition<T>[] = [];

  constructor(private enforced: EnforcedContext) {}

  where<K extends keyof T, O extends ClickhouseOperator>(
    field: K,
    operator: O,
    value: O extends ArrayOperators ? T[K][] : T[K]
  ): this {
    this.conditions.push({ field, operator, value } as WhereCondition<T>);

    return this;
  }

  whereEquals<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, '=', value);
  }

  whereIn<K extends keyof T>(field: K, values: T[K][]): this {
    return this.where(field, 'IN', values);
  }

  whereNotIn<K extends keyof T>(field: K, values: T[K][]): this {
    return this.where(field, 'NOT IN', values);
  }

  whereLike<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, 'LIKE', value);
  }

  whereGreaterThan<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, '>', value);
  }

  whereGreaterThanOrEqual<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, '>=', value);
  }

  whereLessThan<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, '<', value);
  }

  whereLessThanOrEqual<K extends keyof T>(field: K, value: T[K]): this {
    return this.where(field, '<=', value);
  }

  whereBetween<K extends keyof T>(field: K, min: T[K], max: T[K]): this {
    this.where(field, '>=', min);
    this.where(field, '<=', max);

    return this;
  }

  /**
   * Check if an array field contains a specific value using ClickHouse has() function
   *
   * @param field Array field to check
   * @param value Single value to look for in the array
   *
   * @example
   * ```typescript
   * // Check if context_keys array contains 'tenant:org-123'
   * queryBuilder.whereHas('context_keys', 'tenant:org-123')
   *
   * // Generates SQL: WHERE has(context_keys, 'tenant:org-123')
   * ```
   */
  whereHas<K extends keyof T>(field: K, value: T[K] extends readonly (infer U)[] ? U : T[K]): this {
    return this.where(field, 'has', value as T[K]);
  }

  /**
   * Check if an array field contains any of the specified values using ClickHouse hasAny() function
   *
   * @param field Array field to check
   * @param values Array of values to look for (OR logic)
   *
   * @example
   * ```typescript
   * // Check if context_keys contains any of these values
   * queryBuilder.whereHasAny('context_keys', ['tenant:org-123', 'region:us-east-1'])
   *
   * // Generates SQL: WHERE hasAny(context_keys, ['tenant:org-123', 'region:us-east-1'])
   * ```
   */
  whereHasAny<K extends keyof T>(field: K, values: T[K]): this {
    // Type assertion needed because where() expects T[K][] for ArrayOperators,
    // but for array fields T[K] is already an array (e.g., string[])
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    return this.where(field, 'hasAny', values as any);
  }

  /**
   * Check if an array field contains all of the specified values using ClickHouse hasAll() function
   *
   * @param field Array field to check
   * @param values Array of values that must all be present (AND logic)
   *
   * @example
   * ```typescript
   * // Check if context_keys contains all of these values
   * queryBuilder.whereHasAll('context_keys', ['tenant:org-123', 'region:us-east-1'])
   *
   * // Generates SQL: WHERE hasAll(context_keys, ['tenant:org-123', 'region:us-east-1'])
   * ```
   */
  whereHasAll<K extends keyof T>(field: K, values: T[K]): this {
    // Type assertion needed because where() expects T[K][] for ArrayOperators,
    // but for array fields T[K] is already an array (e.g., string[])
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    return this.where(field, 'hasAll', values as any);
  }

  /**
   * Add an OR condition using a callback to build the OR conditions
   *
   * **Use this when:** You need complex, mixed condition types or want to use different
   * query builder methods (whereEquals, whereLike, whereIn, etc.) within the OR group.
   *
   * @param callback Function that receives a new QueryBuilder instance to build OR conditions
   *
   * @example
   * ```typescript
   * const query = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .whereEquals('status', 'active')
   *   .or(builder => {
   *     builder
   *       .whereEquals('priority', 'high')
   *       .whereIn('status', ['failed', 'timeout'])
   *       .whereLike('error_message', '%timeout%');
   *   })
   *   .build();
   *
   * // Generates SQL:
   * // WHERE environment_id = 'env123'
   * //   AND status = 'active'
   * //   AND (priority = 'high' OR status IN ['failed', 'timeout'] OR error_message LIKE '%timeout%')
   * ```
   */
  or(callback: (builder: Omit<QueryBuilder<T>, 'build' | 'or'>) => void): this {
    const orBuilder = new QueryBuilder<T>(this.enforced);
    callback(orBuilder);

    if (orBuilder.conditions.length > 0) {
      const orCondition: OrCondition<T> = {
        $or: orBuilder.conditions,
      };
      this.conditions.push(orCondition);
    }

    return this;
  }

  /**
   * Add a simple OR condition with field, operator, and value
   *
   * **Use this when:** You have simple, uniform OR conditions that can be mapped from an array.
   * More performant than or() for simple cases like filtering by multiple channel types.
   *
   * @param orConditions Array of OR conditions to add
   *
   * @example Simple filtering (recommended approach):
   * ```typescript
   * // Filtering by multiple channels
   * const query = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .whereEquals('organization_id', 'org456')
   *   .orWhere(
   *     channels.map(channel => ({
   *       field: 'channels',
   *       operator: 'LIKE',
   *       value: `%"${channel}"%`
   *     }))
   *   )
   *   .build();
   * ```
   *
   * @example Multiple status filtering:
   * ```typescript
   * const query = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .whereEquals('organization_id', 'org456')
   *   .orWhere([
   *     { field: 'status', operator: '=', value: 'completed' },
   *     { field: 'status', operator: '=', value: 'failed' }
   *   ])
   *   .build();
   *
   * // Generates SQL:
   * // WHERE environment_id = 'env123'
   * //   AND organization_id = 'org456'
   * //   AND (status = 'completed' OR status = 'failed')
   * ```
   *
   * @example Array operators (IN, NOT IN):
   * ```typescript
   * const query = new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .orWhere([
   *     { field: 'workflow_id', operator: 'IN', value: ['wf1', 'wf2'] },
   *     { field: 'status', operator: '=', value: 'urgent' }
   *   ])
   *   .build();
   *
   * // Generates SQL:
   * // WHERE environment_id = 'env123'
   * //   AND (workflow_id IN ['wf1', 'wf2'] OR status = 'urgent')
   * ```
   */
  orWhere(orConditions: Array<FieldCondition<T, keyof T, ClickhouseOperator>>): this {
    if (orConditions.length > 0) {
      const conditions: WhereCondition<T>[] = orConditions.map((condition) =>
        'value' in condition
          ? ({
              field: condition.field,
              operator: condition.operator,
              value: condition.value,
            } as WhereCondition<T>)
          : ({
              field: condition.field,
              operator: condition.operator,
            } as WhereCondition<T>)
      );

      const orCondition: OrCondition<T> = {
        $or: conditions,
      };
      this.conditions.push(orCondition);
    }

    return this;
  }

  build(): EnforcedWhere<T> {
    return {
      enforced: this.enforced,
      conditions: this.conditions,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildSingleCondition(condition: WhereCondition<InferClickhouseSchemaType<TSchema>>): string)
 - orClauses(condition.$or.map((orCondition))
 - clauses(conditions.map((condition))
 - ids(data.map((_item))
 - expiresAt(LogRepository.formatDateTime64(expirationDate);

    await this.clickhouseService.insert(
      this...)
 - query1(new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
 *   .whereEquals('organization_id', 'org...)
 - queryBuilder(new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
 *   .whereEquals('organization_id', 'org...)
 - query(new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .whereEquals('status', 'active')
 ...)
 - priority('high' OR status IN ['failed', 'timeout'] OR error_message LIKE '%timeout%')
   * ```
   */
  or(cal...)
 - query(new QueryBuilder<WorkflowRun>({ environmentId: 'env123' })
   *   .whereEquals('organization_id', 'o...)
Declaraciones 'export' encontradas:
- export  type
- export  const
- export  const
- export  type
- export  type
- export  type
- export  interface
- export  interface
- export  type
- export  type
- export  abstract
- export class QueryBuilder

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/shared.ts
Tamaño: 889 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { InsertOptions } from './clickhouse.service';

/*
 * Default:
 * asyncInsert=true (false in test environment),
 * waitForAsyncInsert=false (true in test environment)
 *
 * Note: waitForAsyncInsert is ignored when asyncInsert=false (synchronous inserts)
 */
export const getInsertOptions = (asyncInsertVariable: string, waitForAsyncInsertVariable: string): InsertOptions => {
  return {
    asyncInsert: (() => {
      if (process.env.NODE_ENV === 'test') {
        return false;
      }
      if (asyncInsertVariable !== undefined) {
        return asyncInsertVariable === 'true';
      }

      return true;
    })(),
    waitForAsyncInsert: (() => {
      if (process.env.NODE_ENV === 'test') {
        return true;
      }
      if (waitForAsyncInsertVariable !== undefined) {
        return waitForAsyncInsertVariable === 'true';
      }

      return false;
    })(),
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getInsertOptions(asyncInsertVariable: string, waitForAsyncInsertVariable: string): InsertOptions)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/request-log/index.ts
Tamaño: 80 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './request-log.repository';
export * from './request-log.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/request-log/request-log.repository.ts
Tamaño: 1658 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { PinoLogger } from 'nestjs-pino';
import { FeatureFlagsService } from '../../feature-flags/feature-flags.service';
import { ClickHouseService, InsertOptions } from '../clickhouse.service';
import { LogRepository } from '../log.repository';
import { getInsertOptions } from '../shared';
import { ORDER_BY, RequestLog, requestLogSchema, TABLE_NAME } from './request-log.schema';

const REQUEST_LOG_INSERT_OPTIONS: InsertOptions = getInsertOptions(
  process.env.REQUEST_LOGS_ASYNC_INSERT,
  process.env.REQUEST_LOGS_WAIT_ASYNC_INSERT
);

@Injectable()
export class RequestLogRepository extends LogRepository<typeof requestLogSchema, RequestLog> {
  public readonly table = TABLE_NAME;
  public readonly identifierPrefix = 'req_';

  constructor(
    protected readonly clickhouseService: ClickHouseService,
    protected readonly logger: PinoLogger,
    protected readonly featureFlagsService: FeatureFlagsService
  ) {
    super(clickhouseService, logger, requestLogSchema, ORDER_BY, featureFlagsService);
    this.logger.setContext(this.constructor.name);
  }

  public async create(
    data: Omit<RequestLog, 'expires_at'>,
    context: {
      organizationId?: string;
      environmentId?: string;
      userId?: string;
    }
  ): Promise<void> {
    await super.insert(data, context, REQUEST_LOG_INSERT_OPTIONS);
  }

  public async createMany(
    data: Omit<RequestLog, 'id' | 'expires_at'>[],
    context: {
      organizationId?: string;
      environmentId?: string;
      userId?: string;
    }
  ): Promise<void> {
    await super.insertMany(data, context, REQUEST_LOG_INSERT_OPTIONS);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RequestLogRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/request-log/request-log.schema.ts
Tamaño: 1659 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  CHDateTime64,
  CHLowCardinality,
  CHString,
  CHUInt16,
  CHUInt32,
  ClickhouseSchema,
  InferClickhouseSchemaType,
} from 'clickhouse-schema';
import { Prettify } from '../../../utils/prettify.type';

export const TABLE_NAME = 'requests';

const schemaDefinition = {
  id: { type: CHString() },
  created_at: { type: CHDateTime64(3, 'UTC') },
  path: { type: CHString() },
  url: { type: CHString() },
  url_pattern: { type: CHString() },
  hostname: { type: CHString() },
  status_code: { type: CHUInt16() },
  method: { type: CHLowCardinality(CHString()) },
  transaction_id: { type: CHString() },
  ip: { type: CHString() },
  user_agent: { type: CHString() },
  request_body: { type: CHString() },
  response_body: { type: CHString() },
  user_id: { type: CHString() },
  organization_id: { type: CHString() },
  environment_id: { type: CHString() },
  auth_type: { type: CHString() },
  duration_ms: { type: CHUInt32() },
  expires_at: { type: CHDateTime64(3, 'UTC') },
};

export const ORDER_BY: (keyof typeof schemaDefinition)[] = [
  'organization_id',
  'environment_id',
  'transaction_id',
  'created_at',
];

export const TTL: keyof typeof schemaDefinition = 'expires_at';

const clickhouseSchemaOptions = {
  table_name: TABLE_NAME,
  engine: 'MergeTree',
  order_by: `(${ORDER_BY.join(', ')})` as any,
  additional_options: ['PARTITION BY toYYYYMM(created_at)', `TTL toDateTime(${TTL})`],
};

export const requestLogSchema = new ClickhouseSchema(schemaDefinition, clickhouseSchemaOptions);

export type RequestLogComplex = InferClickhouseSchemaType<typeof requestLogSchema>;

export type RequestLog = Prettify<RequestLogComplex>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/step-run/index.ts
Tamaño: 74 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './step-run.repository';
export * from './step-run.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/step-run/step-run.repository.ts
Tamaño: 14028 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { JobEntity, JobStatusEnum, MessageEntity } from '@novu/dal';
import { FeatureFlagsKeysEnum, StepTypeEnum } from '@novu/shared';
import { PinoLogger } from 'nestjs-pino';
import { FeatureFlagsService } from '../../feature-flags/feature-flags.service';
import { StepType } from '..';
import { ClickHouseService, InsertOptions } from '../clickhouse.service';
import { LogRepository, SchemaKeys } from '../log.repository';
import { getInsertOptions } from '../shared';
import { ORDER_BY, StepRun, stepRunSchema, TABLE_NAME } from './step-run.schema';

type StepRunInsertData = Omit<StepRun, 'id' | 'expires_at'>;

const STEP_RUN_INSERT_OPTIONS: InsertOptions = getInsertOptions(
  process.env.STEP_RUNS_ASYNC_INSERT,
  process.env.STEP_RUNS_WAIT_ASYNC_INSERT
);

type StepOptions = {
  status?: JobStatusEnum;
  message?: MessageEntity;
  errorCode?: string;
  errorMessage?: string;
};

@Injectable()
export class StepRunRepository extends LogRepository<typeof stepRunSchema, StepRun> {
  public readonly table = TABLE_NAME;
  public readonly schema = stepRunSchema;
  public readonly schemaOrderBy: SchemaKeys<typeof stepRunSchema>[] = ORDER_BY;
  public readonly identifierPrefix = 'sr_';

  constructor(
    protected readonly clickhouseService: ClickHouseService,
    protected readonly logger: PinoLogger,
    protected readonly featureFlagsService: FeatureFlagsService
  ) {
    super(clickhouseService, logger, stepRunSchema, ORDER_BY, featureFlagsService);
    this.logger.setContext(this.constructor.name);
  }

  private mapStepTypeEnumToStepType(stepType: StepTypeEnum | undefined): StepType | null {
    switch (stepType) {
      case StepTypeEnum.EMAIL:
        return 'email';
      case StepTypeEnum.SMS:
        return 'sms';
      case StepTypeEnum.IN_APP:
        return 'in_app';
      case StepTypeEnum.PUSH:
        return 'push';
      case StepTypeEnum.CHAT:
        return 'chat';
      case StepTypeEnum.DIGEST:
        return 'digest';
      case StepTypeEnum.THROTTLE:
        return 'throttle';
      case StepTypeEnum.TRIGGER:
        return 'trigger';
      case StepTypeEnum.DELAY:
        return 'delay';
      case StepTypeEnum.CUSTOM:
        return 'custom';
      default:
        return null;
    }
  }

  async create(job: JobEntity, options: StepOptions = {}): Promise<void> {
    try {
      const isEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_STEP_RUN_LOGS_WRITE_ENABLED,
        organization: { _id: job._organizationId },
        environment: { _id: job._environmentId },
        user: { _id: job._userId },
        defaultValue: false,
      });

      if (!isEnabled) {
        return;
      }

      const stepRunData = this.mapJobToStepRun(job, options);
      await super.insert(
        stepRunData,
        {
          organizationId: job._organizationId,
          environmentId: job._environmentId,
          userId: job._userId,
        },
        STEP_RUN_INSERT_OPTIONS
      );

      this.logger.debug(
        {
          stepRunId: job._id,
          status: job.status,
          ...(options.errorCode && { errorCode: options.errorCode }),
          ...(options.errorMessage && { errorMessage: options.errorMessage }),
        },
        `Step run ${job.status}`
      );
    } catch (error) {
      this.logger.error({ err: error, jobId: job._id, status: job.status }, `Failed to log step ${job.status}`);
    }
  }

  async createMany(jobs: JobEntity[], options: StepOptions = {}): Promise<void> {
    if (jobs.length === 0) {
      return;
    }

    try {
      const firstJob = jobs[0];
      const isEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_STEP_RUN_LOGS_WRITE_ENABLED,
        organization: { _id: String(firstJob._organizationId) },
        environment: { _id: String(firstJob._environmentId) },
        defaultValue: false,
      });

      if (!isEnabled) {
        return;
      }

      const stepRunDataArray: StepRunInsertData[] = [];

      for (const job of jobs) {
        const stepRunData = this.mapJobToStepRun(job, options);
        stepRunDataArray.push(stepRunData);
      }

      await super.insertMany(
        stepRunDataArray,
        {
          organizationId: firstJob._organizationId,
          environmentId: firstJob._environmentId,
          userId: firstJob._userId,
        },
        STEP_RUN_INSERT_OPTIONS
      );

      this.logger.debug(
        {
          count: jobs.length,
          stepRunIds: jobs.map((job) => job._id),
          status: options.status,
          ...(options.errorCode && { errorCode: options.errorCode }),
          ...(options.errorMessage && { errorMessage: options.errorMessage }),
        },
        `Step runs ${options.status || 'processed'} in batch`
      );
    } catch (error) {
      this.logger.error(
        {
          err: error,
          jobIds: jobs.map((job) => job._id),
          status: options.status,
        },
        `Failed to log step runs ${options.status || 'processing'} in batch`
      );
    }
  }

  async getDeliveryTrendData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ date: string; step_type: string; count: string }>> {
    // Use ClickHouse aggregation query to get counts by date and step_type
    const query = `
      SELECT 
        toDate(created_at) as date,
        step_type,
        count(*) as count
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
      GROUP BY date, step_type
      ORDER BY date, step_type
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      date: string;
      step_type: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }

  async getMessagesDeliveredData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date,
    previousStartDate: Date,
    previousEndDate: Date
  ): Promise<{ currentPeriod: number; previousPeriod: number }> {
    // Query for current period
    const currentPeriodQuery = `
      SELECT count(*) as count
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
    `;

    // Query for previous period
    const previousPeriodQuery = `
      SELECT count(*) as count
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {previousStartDate:DateTime64(3)}
        AND created_at <= {previousEndDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
    `;

    const baseParams = {
      environmentId,
      organizationId,
    };

    const [currentResult, previousResult] = await Promise.all([
      this.clickhouseService.query<{ count: string }>({
        query: currentPeriodQuery,
        params: {
          ...baseParams,
          startDate: LogRepository.formatDateTime64(startDate),
          endDate: LogRepository.formatDateTime64(endDate),
        },
      }),
      this.clickhouseService.query<{ count: string }>({
        query: previousPeriodQuery,
        params: {
          ...baseParams,
          previousStartDate: LogRepository.formatDateTime64(previousStartDate),
          previousEndDate: LogRepository.formatDateTime64(previousEndDate),
        },
      }),
    ]);

    const currentPeriod = parseInt(currentResult.data[0]?.count || '0', 10);
    const previousPeriod = parseInt(previousResult.data[0]?.count || '0', 10);

    return {
      currentPeriod,
      previousPeriod,
    };
  }

  async getAvgMessagesPerSubscriberData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date,
    previousStartDate: Date,
    previousEndDate: Date
  ): Promise<{ currentPeriod: number; previousPeriod: number }> {
    // Query for current period average
    const currentPeriodQuery = `
      SELECT 
        count(*) as total_step_runs,
        count(DISTINCT external_subscriber_id) as unique_subscribers
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
    `;

    // Query for previous period average
    const previousPeriodQuery = `
      SELECT 
        count(*) as total_step_runs,
        count(DISTINCT external_subscriber_id) as unique_subscribers
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {previousStartDate:DateTime64(3)}
        AND created_at <= {previousEndDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
    `;

    const baseParams = {
      environmentId,
      organizationId,
    };

    const [currentResult, previousResult] = await Promise.all([
      this.clickhouseService.query<{ total_step_runs: string; unique_subscribers: string }>({
        query: currentPeriodQuery,
        params: {
          ...baseParams,
          startDate: LogRepository.formatDateTime64(startDate),
          endDate: LogRepository.formatDateTime64(endDate),
        },
      }),
      this.clickhouseService.query<{ total_step_runs: string; unique_subscribers: string }>({
        query: previousPeriodQuery,
        params: {
          ...baseParams,
          previousStartDate: LogRepository.formatDateTime64(previousStartDate),
          previousEndDate: LogRepository.formatDateTime64(previousEndDate),
        },
      }),
    ]);

    const currentTotalStepRuns = parseInt(currentResult.data[0]?.total_step_runs || '0', 10);
    const currentUniqueSubscribers = parseInt(currentResult.data[0]?.unique_subscribers || '0', 10);
    const previousTotalStepRuns = parseInt(previousResult.data[0]?.total_step_runs || '0', 10);
    const previousUniqueSubscribers = parseInt(previousResult.data[0]?.unique_subscribers || '0', 10);

    // Calculate averages (handle division by zero)
    const currentPeriod = currentUniqueSubscribers > 0 ? currentTotalStepRuns / currentUniqueSubscribers : 0;
    const previousPeriod = previousUniqueSubscribers > 0 ? previousTotalStepRuns / previousUniqueSubscribers : 0;

    return {
      currentPeriod: Math.round(currentPeriod * 100) / 100, // Round to 2 decimal places
      previousPeriod: Math.round(previousPeriod * 100) / 100, // Round to 2 decimal places
    };
  }

  async getProviderVolumeData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ provider_id: string; count: string }>> {
    const query = `
      SELECT 
        provider_id,
        count(*) as count
      FROM step_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
        AND step_type IN ('in_app', 'email', 'sms', 'chat', 'push')
        AND status = 'completed'
      GROUP BY provider_id
      ORDER BY count DESC
      LIMIT 5
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      provider_id: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }

  private mapJobToStepRun(job: JobEntity, options?: StepOptions): StepRunInsertData {
    const now = new Date();
    const stepType = this.mapStepTypeEnumToStepType(job.type || job.step.template?.type);

    return {
      created_at: LogRepository.formatDateTime64(new Date(job.createdAt)),
      updated_at: LogRepository.formatDateTime64(now),

      // Core step run identification
      step_run_id: job._id,
      step_id: job.step._id || job.step.stepId || job._id,
      workflow_run_id: job._notificationId,

      // Context
      organization_id: job._organizationId,
      environment_id: job._environmentId,
      user_id: job._userId,
      subscriber_id: job._subscriberId,
      external_subscriber_id: job.subscriberId,
      message_id: options?.message?._id || null,
      context_keys: job.contextKeys || [],

      // Step metadata
      step_type: stepType,
      step_name: null, // todo remove this parameter because we do not have step name at this stage.
      provider_id: job.providerId || null,

      // Execution details
      status: options?.status || job.status,

      // Digest data
      digest: job.digest ? JSON.stringify(job.digest) : null,

      // Error handling
      error_code: options?.errorCode || null,
      error_message: options?.errorMessage || null,

      // Correlation
      transaction_id: job.transactionId,

      // Schedule extensions count
      schedule_extensions_count: job?.scheduleExtensionsCount || 0,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - stepRunData(this.mapJobToStepRun(job, options);
        stepRunDataArray.push(stepRunData);
      }

      await...)
Declaraciones 'export' encontradas:
- export class StepRunRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/step-run/step-run.schema.ts
Tamaño: 2932 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  CHArray,
  CHDateTime64,
  CHLowCardinality,
  CHNullable,
  CHString,
  CHUInt8,
  ClickhouseSchema,
  InferClickhouseSchemaType,
} from 'clickhouse-schema';
import { Prettify } from '../../../utils/prettify.type';
import { StepType } from '..';

export const TABLE_NAME = 'step_runs';

const schemaDefinition = {
  id: { type: CHString() },
  created_at: { type: CHDateTime64(3, 'UTC') },
  updated_at: { type: CHDateTime64(3, 'UTC') },

  // Core step run identification
  step_run_id: { type: CHString() }, // Maps to JobEntity._id
  step_id: { type: CHString() }, // Maps to messageTemplate._id
  workflow_run_id: { type: CHNullable(CHString()) }, // Maps to NotificationEntity._id

  // Context
  organization_id: { type: CHString() },
  environment_id: { type: CHString() },
  user_id: { type: CHString() },
  subscriber_id: { type: CHString() },
  external_subscriber_id: { type: CHNullable(CHString()) },
  message_id: { type: CHNullable(CHString()) }, // Links to MessageEntity
  context_keys: { type: CHArray(CHString(), []) }, // Array of context keys (type:identifier)

  // Step metadata
  step_type: { type: CHLowCardinality(CHString()) }, // email, sms, in_app, push, etc.
  step_name: { type: CHNullable(CHString()) }, // todo remove this parameter because we do not have step name at this stage.
  provider_id: { type: CHNullable(CHString()) },

  // Execution details
  status: { type: CHLowCardinality(CHString()) }, // pending, queued, running, completed, failed, skipped, cancelled

  // Digest data
  digest: { type: CHNullable(CHString()) }, // JSON string of digest metadata

  // Error handling
  error_code: { type: CHNullable(CHString()) },
  error_message: { type: CHNullable(CHString()) },

  // Correlation
  transaction_id: { type: CHString() },

  // Data retention
  expires_at: { type: CHDateTime64(3, 'UTC') },

  // Schedule extensions count
  schedule_extensions_count: { type: CHUInt8(0) },
};

export const ORDER_BY: (keyof typeof schemaDefinition)[] = ['organization_id', 'step_run_id'];

export const TTL: keyof typeof schemaDefinition = 'expires_at';

const clickhouseSchemaOptions = {
  table_name: TABLE_NAME,
  engine: 'ReplacingMergeTree(updated_at)',
  order_by: `(${ORDER_BY.join(', ')})` as any,
  additional_options: ['PARTITION BY toYYYYMM(created_at)', `TTL toDateTime(${TTL})`],
};

export const stepRunSchema = new ClickhouseSchema(schemaDefinition, clickhouseSchemaOptions);

export type StepRunNonFinalStatus = 'pending' | 'queued' | 'running' | 'delayed';
export type StepRunFinalStatus = 'completed' | 'failed' | 'canceled' | 'merged' | 'skipped';
export type StepRunStatus = StepRunNonFinalStatus | StepRunFinalStatus;

type NativeStepRun = InferClickhouseSchemaType<typeof stepRunSchema>;

type StepRunComplex = Omit<NativeStepRun, 'status' | 'step_type'> & {
  status: StepRunStatus;
  step_type: StepType;
};

export type StepRun = Prettify<StepRunComplex>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  type
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/trace-log/index.ts
Tamaño: 76 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './trace-log.repository';
export * from './trace-log.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/trace-log/trace-log.repository.ts
Tamaño: 15128 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { FeatureFlagsKeysEnum } from '@novu/shared';
import { PinoLogger } from 'nestjs-pino';
import { FeatureFlagsService } from '../../feature-flags/feature-flags.service';
import { ClickHouseService, InsertOptions } from '../clickhouse.service';
import { LogRepository } from '../log.repository';
import { getInsertOptions } from '../shared';
import { EventType, ORDER_BY, TABLE_NAME, Trace, traceLogSchema } from './trace-log.schema';

const TRACE_INSERT_OPTIONS: InsertOptions = getInsertOptions(
  process.env.TRACES_ASYNC_INSERT,
  process.env.TRACES_WAIT_ASYNC_INSERT
);

@Injectable()
export class TraceLogRepository extends LogRepository<typeof traceLogSchema, Trace> {
  public readonly table = TABLE_NAME;
  public readonly identifierPrefix = 'trc_';

  constructor(
    protected readonly clickhouseService: ClickHouseService,
    protected readonly logger: PinoLogger,
    protected readonly featureFlagsService: FeatureFlagsService
  ) {
    super(clickhouseService, logger, traceLogSchema, ORDER_BY, featureFlagsService);
    this.logger.setContext(this.constructor.name);
  }

  private async createMany(traceDataArray: Omit<Trace, 'id' | 'expires_at'>[]): Promise<void> {
    if (traceDataArray.length === 0) {
      return;
    }

    try {
      const firstTraceData = traceDataArray[0];
      const isTraceLogsEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_TRACE_LOGS_ENABLED,
        defaultValue: false,
        organization: { _id: firstTraceData.organization_id },
        user: { _id: firstTraceData.user_id },
        environment: { _id: firstTraceData.environment_id },
      });

      if (!isTraceLogsEnabled) {
        return;
      }

      await this.insertMany(
        traceDataArray,
        {
          organizationId: firstTraceData.organization_id,
          environmentId: firstTraceData.environment_id,
          userId: firstTraceData.user_id,
        },
        TRACE_INSERT_OPTIONS
      );

      this.logger.debug(
        {
          count: traceDataArray.length,
          entityIds: traceDataArray.map((trace) => trace.entity_id),
          entityTypes: [...new Set(traceDataArray.map((trace) => trace.entity_type))],
          eventTypes: [...new Set(traceDataArray.map((trace) => trace.event_type))],
        },
        'Trace events logged'
      );
    } catch (error) {
      this.logger.error(
        {
          err: error,
          count: traceDataArray.length,
          entityIds: traceDataArray.map((trace) => trace.entity_id),
          entityTypes: [...new Set(traceDataArray.map((trace) => trace.entity_type))],
          eventTypes: [...new Set(traceDataArray.map((trace) => trace.event_type))],
          errorMessage: error instanceof Error ? error.message : 'Unknown error',
          errorStack: error instanceof Error ? error.stack : undefined,
        },
        'Failed to log trace events'
      );
    }
  }

  async createStepRun(traceData: Omit<Trace, 'id' | 'expires_at' | 'entity_type'>[]): Promise<void> {
    return this.createMany(
      traceData.map((trace) => ({
        ...trace,
        entity_type: 'step_run',
      }))
    );
  }

  async createRequest(traceData: Omit<Trace, 'id' | 'expires_at' | 'entity_type'>[]): Promise<void> {
    return this.createMany(
      traceData.map((trace) => ({
        ...trace,
        entity_type: 'request',
      }))
    );
  }

  async getInteractionTrendData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ date: string; event_type: string; count: string }>> {
    const query = `
      SELECT 
        toDate(traces.created_at) as date,
        traces.event_type,
        count(*) as count
      FROM traces
      WHERE 
        traces.environment_id = {environmentId:String} 
        AND traces.organization_id = {organizationId:String}
        AND traces.entity_type = 'step_run'
        AND traces.created_at >= {startDate:DateTime64(3)}
        AND traces.created_at <= {endDate:DateTime64(3)}
        AND traces.event_type IN ('message_seen', 'message_read', 'message_snoozed', 'message_archived')
      GROUP BY date, traces.event_type
      ORDER BY date, traces.event_type
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      date: string;
      event_type: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }

  async getTotalInteractionsData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date,
    previousStartDate: Date,
    previousEndDate: Date
  ): Promise<{ currentPeriod: number; previousPeriod: number }> {
    const currentQuery = `
      SELECT count(*) as count
      FROM traces
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
        AND entity_type = 'step_run'
        AND event_type IN ('message_seen', 'message_read', 'message_snoozed', 'message_archived')
    `;

    const previousQuery = `
      SELECT count(*) as count
      FROM traces
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {previousStartDate:DateTime64(3)}
        AND created_at <= {previousEndDate:DateTime64(3)}
        AND entity_type = 'step_run'
        AND event_type IN ('message_seen', 'message_read', 'message_snoozed', 'message_archived')
    `;

    const currentParams = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const previousParams = {
      environmentId,
      organizationId,
      previousStartDate: LogRepository.formatDateTime64(previousStartDate),
      previousEndDate: LogRepository.formatDateTime64(previousEndDate),
    };

    const [currentResult, previousResult] = await Promise.all([
      this.clickhouseService.query<{ count: string }>({
        query: currentQuery,
        params: currentParams,
      }),
      this.clickhouseService.query<{ count: string }>({
        query: previousQuery,
        params: previousParams,
      }),
    ]);

    const currentPeriod = parseInt(currentResult.data[0]?.count || '0', 10);
    const previousPeriod = parseInt(previousResult.data[0]?.count || '0', 10);

    return {
      currentPeriod,
      previousPeriod,
    };
  }
}

export function mapEventTypeToTitle(eventType: EventType): string {
  switch (eventType) {
    // Step events
    case 'step_created':
      return 'Step created';
    case 'step_queued':
      return 'Step queued';
    case 'step_delayed':
      return 'Step delayed';
    case 'step_digested':
      return 'Step digested';
    case 'step_filtered':
      return 'Step filtered';
    case 'step_filter_processing':
      return 'Step filter processing';
    case 'step_filter_failed':
      return 'Step filter failed';
    case 'step_completed':
      return 'Step completed';
    case 'step_canceled':
      return 'Step canceled';
    case 'step_throttled':
      return 'Step throttled';

    // Message events
    case 'message_created':
      return 'Message created';
    case 'message_sent':
      return 'Message sent';
    case 'message_seen':
      return 'Message seen';
    case 'message_unseen':
      return 'Message unseen';
    case 'message_read':
      return 'Message read';
    case 'message_unread':
      return 'Message unread';
    case 'message_archived':
      return 'Message archived';
    case 'message_unarchived':
      return 'Message unarchived';
    case 'message_snoozed':
      return 'Message snoozed';
    case 'message_unsnoozed':
      return 'Message unsnoozed';
    case 'message_unsnooze_failed':
      return 'Message unsnooze failed';
    case 'message_content_failed':
      return 'Message content failed';
    case 'message_sending_started':
      return 'Message sending started';
    case 'message_severity_overridden':
      return 'Severity for the message was overridden';
    case 'message_clicked':
      return 'Message clicked';
    case 'message_spam':
      return 'Message spam';
    case 'message_bounced':
      return 'Message bounced';
    case 'message_dropped':
      return 'Message dropped';
    case 'message_deferred':
      return 'Message deferred';
    case 'message_unsubscribed':
      return 'Message unsubscribed';
    case 'message_delayed':
      return 'Message delayed';
    case 'message_deleted':
      return 'Message deleted';
    case 'message_complaint':
      return 'Message complaint';
    case 'message_delivered':
      return 'Message delivered';
    case 'message_rejected':
      return 'Message rejected';
    case 'message_blocked':
      return 'Message blocked';

    // Subscriber events
    case 'subscriber_integration_missing':
      return 'Subscriber integration missing';
    case 'subscriber_channel_missing':
      return 'Subscriber channel missing';
    case 'subscriber_validation_failed':
      return 'Subscriber validation failed';
    case 'subscriber_missing_email_address':
      return 'Subscriber missing email address';
    case 'subscriber_missing_phone_number':
      return 'Subscriber missing phone number';

    // Throttle events
    case 'throttle_limit_exceeded':
      return 'Throttle limit exceeded';
    case 'throttle_window_in_past':
      return 'Throttle window in past';

    // Provider events
    case 'provider_error':
      return 'Provider error';
    case 'provider_limit_exceeded':
      return 'Provider limit exceeded';

    // Digest events
    case 'digest_merged':
      return 'Digest merged';
    case 'digest_skipped':
      return 'Digest skipped';
    case 'digest_triggered':
      return 'Digest triggered';
    case 'digest_started':
      return 'Digest started';

    // Delay events
    case 'delay_completed':
      return 'Delay completed';
    case 'delay_misconfigured':
      return 'Delay misconfigured';
    case 'delay_limit_exceeded':
      return 'Delay limit exceeded';

    // Bridge events
    case 'bridge_response_received':
      return 'Bridge response received';
    case 'bridge_execution_failed':
      return 'Bridge execution failed';
    case 'bridge_execution_skipped':
      return 'Bridge execution skipped';

    // Webhook events
    case 'webhook_filter_retrying':
      return 'Webhook filter retrying';
    case 'webhook_filter_failed':
      return 'Webhook filter failed';

    // Integration events
    case 'integration_selected':
      return 'Integration selected';

    // Layout events
    case 'layout_not_found':
      return 'Layout not found';
    case 'layout_selected':
      return 'Layout selected';

    // Tenant events
    case 'tenant_selected':
      return 'Tenant selected';
    case 'tenant_not_found':
      return 'Tenant not found';

    // Variant events
    case 'variant_selected':
      return 'Variant selected';

    // Notification events
    case 'notification_error':
      return 'Notification error';

    // Chat events
    case 'chat_webhook_missing':
      return 'Chat webhook missing';
    case 'chat_all_channels_failed':
      return 'Chat all channels failed';
    case 'chat_phone_missing':
      return 'Chat phone missing';
    case 'chat_some_channels_skipped':
      return 'Chat some channels skipped';

    // Push events
    case 'push_tokens_missing':
      return 'Push tokens missing';
    case 'push_some_channels_skipped':
      return 'Push some channels skipped';

    // Reply events
    case 'reply_callback_missing':
      return 'Reply callback missing';
    case 'reply_callback_misconfigured':
      return 'Reply callback misconfigured';
    case 'reply_mx_record_missing':
      return 'Reply MX record missing';
    case 'reply_mx_domain_missing':
      return 'Reply MX domain missing';

    // Execution events
    case 'execution_detail':
      return 'Execution detail';

    // Request events
    case 'request_received':
      return 'Request received';
    case 'request_queued':
      return 'Request queued';
    case 'request_failed':
      return 'Request failed';
    case 'request_organization_not_found':
      return 'Organization not found';
    case 'request_environment_not_found':
      return 'Environment not found';
    case 'request_workflow_not_found':
      return 'Workflow not found';
    case 'request_invalid_recipients':
      return 'Invalid recipients';
    case 'request_payload_validation_failed':
      return 'Payload validation failed';

    // Workflow events
    case 'workflow_execution_started':
      return 'Workflow execution started';
    case 'workflow_environment_not_found':
      return 'Workflow environment not found';
    case 'workflow_template_not_found':
      return 'Workflow template not found';
    case 'workflow_template_found':
      return 'Workflow template found';
    case 'workflow_tenant_processing_started':
      return 'Workflow tenant processing started';
    case 'workflow_tenant_processing_failed':
      return 'Workflow tenant processing failed';
    case 'workflow_tenant_processing_completed':
      return 'Workflow tenant processing completed';
    case 'workflow_actor_processing_started':
      return 'Workflow actor processing started';
    case 'workflow_actor_processing_completed':
      return 'Workflow actor processing completed';
    case 'workflow_execution_failed':
      return 'Workflow execution failed';
    case 'workflow_actor_processing_failed':
      return 'Workflow actor processing failed';
    case 'workflow_context_resolution_completed':
      return 'Workflow context resolution completed';
    case 'workflow_context_resolution_failed':
      return 'Workflow context resolution failed';
    case 'workflow_context_not_found':
      return 'Workflow context not found';

    // Request fan-out events
    case 'request_subscriber_processing_completed':
      return 'Request subscriber processing completed';

    // Topic events
    case 'topic_not_found':
      return 'Topic not found';

    // Step skipped events
    case 'step_skipped':
      return 'Step skipped';
    case 'step_skipped_outside_of_the_schedule':
      return "The step was skipped as it fell outside the subscriber's schedule";
    case 'step_extended_to_schedule':
      return 'Step was extended to the next available time in the subscriber schedule';
    case 'step_skipped_max_extensions_reached':
      return 'Step was executed due to maximum number of subscriber schedule extensions reached';

    default: {
      // Exhaustive check - this will cause a compile error if we miss any TraceEvent cases
      const _exhaustiveCheck: never = eventType;

      return _exhaustiveCheck;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - mapEventTypeToTitle(eventType: EventType)
Asignaciones con arrow functions encontradas (posibles funciones):
 - isTraceLogsEnabled(await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_TRACE_LOGS_ENABLED,
  ...)
Declaraciones 'export' encontradas:
- export class TraceLogRepository
- export function mapEventTypeToTitle

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/trace-log/trace-log.schema.ts
Tamaño: 5432 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  CHArray,
  CHDateTime64,
  CHLowCardinality,
  CHNullable,
  CHString,
  ClickhouseSchema,
  InferClickhouseSchemaType,
} from 'clickhouse-schema';
import { Prettify } from '../../../utils/prettify.type';
import { StepType } from '..';

export const TABLE_NAME = 'traces';

const schemaDefinition = {
  id: { type: CHString() },
  created_at: { type: CHDateTime64(3, 'UTC') },

  // Context
  organization_id: { type: CHString() },
  environment_id: { type: CHString() },
  user_id: { type: CHNullable(CHString()) },
  external_subscriber_id: { type: CHNullable(CHString()) },
  subscriber_id: { type: CHNullable(CHString()) },

  // Trace metadata
  event_type: { type: CHLowCardinality(CHString()) }, // e.g., "message:seen", "step_run:start", "step_run:end"
  title: { type: CHString() }, // Human readable message
  message: { type: CHNullable(CHString()) },
  raw_data: { type: CHNullable(CHString()) },

  status: { type: CHLowCardinality(CHString()) },

  // Correlation, Hierarchy context
  entity_type: { type: CHLowCardinality(CHString()) }, // request, step_run
  entity_id: { type: CHString() }, // ID of the related entity, request-> request.id, step_run-> job._id

  // Data retention
  expires_at: { type: CHDateTime64(3, 'UTC') },

  // Step run metadata
  step_run_type: { type: CHString('') }, // default value is empty string

  // Workflow run metadata
  workflow_run_identifier: { type: CHString('') }, // default value is empty string
};

export const ORDER_BY: (keyof typeof schemaDefinition)[] = [
  'entity_type',
  'organization_id',
  'entity_id',
  'created_at',
];

export const TTL: keyof typeof schemaDefinition = 'expires_at';

const clickhouseSchemaOptions = {
  table_name: TABLE_NAME,
  engine: 'MergeTree',
  order_by: `(${ORDER_BY.join(', ')})` as any,
  additional_options: ['PARTITION BY toYYYYMM(created_at)', `TTL toDateTime(${TTL})`],
};

export const traceLogSchema = new ClickhouseSchema(schemaDefinition, clickhouseSchemaOptions);

export type EventType =
  | 'message_seen'
  | 'message_unseen'
  | 'message_clicked'
  | 'message_read'
  | 'message_unread'
  | 'message_archived'
  | 'message_unarchived'
  | 'message_snoozed'
  | 'message_unsnoozed'
  | 'message_created'
  | 'message_sent'
  | 'message_spam'
  | 'message_bounced'
  | 'message_dropped'
  | 'message_deferred'
  | 'message_unsubscribed'
  | 'message_delayed'
  | 'message_deleted'
  | 'message_complaint'
  | 'message_delivered'
  | 'message_rejected'
  | 'message_blocked'
  | 'message_snoozed'
  | 'message_unsnoozed'
  | 'message_unsnooze_failed'
  | 'message_content_failed'
  | 'message_sending_started'
  | 'message_severity_overridden'
  | 'step_created'
  | 'step_queued'
  | 'step_delayed'
  | 'step_digested'
  | 'step_filtered'
  | 'step_filter_processing'
  | 'step_filter_failed'
  | 'subscriber_integration_missing'
  | 'subscriber_channel_missing'
  | 'subscriber_validation_failed'
  | 'topic_not_found'
  | 'provider_error'
  | 'provider_limit_exceeded'
  | 'digest_merged'
  | 'digest_skipped'
  | 'digest_triggered'
  | 'digest_started'
  | 'delay_completed'
  | 'delay_misconfigured'
  | 'delay_limit_exceeded'
  | 'step_throttled'
  | 'throttle_limit_exceeded'
  | 'throttle_window_in_past'
  | 'bridge_response_received'
  | 'bridge_execution_failed'
  | 'bridge_execution_skipped'
  | 'webhook_filter_retrying'
  | 'webhook_filter_failed'
  | 'integration_selected'
  | 'layout_not_found'
  | 'layout_selected'
  | 'tenant_selected'
  | 'tenant_not_found'
  | 'chat_webhook_missing'
  | 'chat_all_channels_failed'
  | 'chat_phone_missing'
  | 'push_tokens_missing'
  | 'chat_some_channels_skipped'
  | 'push_tokens_missing'
  | 'push_some_channels_skipped'
  | 'subscriber_missing_email_address'
  | 'subscriber_missing_phone_number'
  | 'reply_callback_missing'
  | 'reply_callback_misconfigured'
  | 'reply_mx_record_missing'
  | 'reply_mx_domain_missing'
  | 'variant_selected'
  | 'notification_error'
  | 'execution_detail'
  | 'step_completed'
  | 'step_canceled'
  | 'request_received'
  | 'request_queued'
  | 'request_failed'
  | 'request_organization_not_found'
  | 'request_environment_not_found'
  | 'request_workflow_not_found'
  | 'request_invalid_recipients'
  | 'request_payload_validation_failed'
  | 'request_subscriber_processing_completed'
  | 'workflow_execution_started'
  | 'workflow_environment_not_found'
  | 'workflow_template_not_found'
  | 'workflow_template_found'
  | 'workflow_tenant_processing_started'
  | 'workflow_tenant_processing_failed'
  | 'workflow_tenant_processing_completed'
  | 'workflow_actor_processing_started'
  | 'workflow_actor_processing_failed'
  | 'workflow_actor_processing_completed'
  | 'workflow_context_resolution_failed'
  | 'workflow_context_resolution_completed'
  | 'workflow_context_not_found'
  | 'workflow_execution_failed'
  | 'step_skipped'
  | 'step_skipped_outside_of_the_schedule'
  | 'step_extended_to_schedule'
  | 'step_skipped_max_extensions_reached';

export type EntityType = 'request' | 'step_run';

export type TraceStatus = 'success' | 'error' | 'warning' | 'pending';

type NativeTrace = InferClickhouseSchemaType<typeof traceLogSchema>;

export type TraceLogComplex = Omit<NativeTrace, 'event_type' | 'entity_type' | 'status' | 'step_run_type'> & {
  event_type: EventType;
  entity_type: EntityType;
  status: TraceStatus;
  step_run_type?: StepType;
};

export type Trace = Prettify<TraceLogComplex>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  type
- export  type
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/types/index.ts
Tamaño: 148 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type StepType =
  | 'email'
  | 'sms'
  | 'in_app'
  | 'push'
  | 'chat'
  | 'digest'
  | 'trigger'
  | 'delay'
  | 'custom'
  | 'throttle';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/workflow-run/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './workflow-run.repository';
export * from './workflow-run.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/workflow-run/workflow-run.repository.ts
Tamaño: 23032 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  NotificationEntity,
  NotificationRepository,
  NotificationTemplateEntity,
  NotificationTemplateRepository,
} from '@novu/dal';
import {
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  FeatureFlagsKeysEnum,
  SeverityLevelEnum,
} from '@novu/shared';
import { InferClickhouseSchemaType } from 'clickhouse-schema';
import { PinoLogger } from 'nestjs-pino';
import { FeatureFlagsService } from '../../feature-flags/feature-flags.service';
import { ClickHouseService, InsertOptions } from '../clickhouse.service';
import { LogRepository, SchemaKeys, Where } from '../log.repository';
import { getInsertOptions } from '../shared';
import { ORDER_BY, TABLE_NAME, WorkflowRun, WorkflowRunStatusEnum, workflowRunSchema } from './workflow-run.schema';

type WorkflowRunInsertData = Omit<WorkflowRun, 'id' | 'expires_at'>;
type QueryNotificationEntity = Pick<
  NotificationEntity,
  | '_id'
  | '_templateId'
  | '_organizationId'
  | '_environmentId'
  | '_subscriberId'
  | 'transactionId'
  | 'channels'
  | 'to'
  | 'payload'
  | 'controls'
  | 'topics'
  | '_digestedNotificationId'
  | 'createdAt'
  | 'severity'
  | 'critical'
  | 'contextKeys'
>;

interface IWorkflowRunOptions {
  status?: WorkflowRunStatusEnum;
  userId?: string;
  externalSubscriberId?: string;
  deliveryLifecycleStatus?: DeliveryLifecycleStatusEnum;
  deliveryLifecycleDetail?: DeliveryLifecycleDetail;
}

// Type for selected columns from the workflow run schema
type WorkflowRunColumns = keyof InferClickhouseSchemaType<typeof workflowRunSchema>;

// Utility type to create partial WorkflowRun based on selected columns
type SelectedWorkflowRun<T extends readonly WorkflowRunColumns[]> = Pick<WorkflowRun, T[number]>;

const WORKFLOW_RUN_INSERT_OPTIONS: InsertOptions = getInsertOptions(
  process.env.WORKFLOW_RUNS_ASYNC_INSERT,
  process.env.WORKFLOW_RUNS_WAIT_ASYNC_INSERT
);

@Injectable()
export class WorkflowRunRepository extends LogRepository<typeof workflowRunSchema, WorkflowRun> {
  public readonly table = TABLE_NAME;
  public readonly schema = workflowRunSchema;
  public readonly schemaOrderBy: SchemaKeys<typeof workflowRunSchema>[] = ORDER_BY;
  public readonly identifierPrefix = 'wr_';

  constructor(
    protected readonly clickhouseService: ClickHouseService,
    protected readonly logger: PinoLogger,
    protected readonly featureFlagsService: FeatureFlagsService,
    private readonly notificationRepository: NotificationRepository,
    private readonly notificationTemplateRepository: NotificationTemplateRepository
  ) {
    super(clickhouseService, logger, workflowRunSchema, ORDER_BY, featureFlagsService);
    this.logger.setContext(this.constructor.name);
  }

  async create(
    notification: NotificationEntity,
    workflow: NotificationTemplateEntity,
    options: IWorkflowRunOptions = {}
  ): Promise<void> {
    try {
      const isEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_WORKFLOW_RUN_LOGS_WRITE_ENABLED,
        organization: { _id: String(notification._organizationId) },
        environment: { _id: String(notification._environmentId) },
        user: { _id: String(options.userId) },
        defaultValue: false,
      });

      if (!isEnabled) {
        return;
      }

      const workflowRunData = this.mapNotificationToWorkflowRun(notification, workflow, options);

      await this.insert(
        workflowRunData,
        {
          organizationId: notification._organizationId,
          environmentId: notification._environmentId,
          userId: options.userId,
        },
        WORKFLOW_RUN_INSERT_OPTIONS
      );
    } catch (error) {
      this.logger.error(
        {
          err: error,
          workflowRunId: notification._id,
          workflowId: notification._templateId,
          errorMessage: error instanceof Error ? error.message : 'Unknown error',
        },
        'Failed to create workflow run'
      );
    }
  }

  async createWorkflowRunBatch(
    notifications: Array<{
      notification: NotificationEntity;
      workflow: NotificationTemplateEntity;
      options?: IWorkflowRunOptions;
    }>
  ): Promise<void> {
    if (notifications.length === 0) return;

    try {
      const firstNotification = notifications[0].notification;

      const isEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_WORKFLOW_RUN_LOGS_WRITE_ENABLED,
        organization: { _id: firstNotification._organizationId },
        environment: { _id: firstNotification._environmentId },
        user: { _id: notifications[0].options?.userId },
        defaultValue: false,
      });

      if (!isEnabled) {
        return;
      }

      const workflowRunsData = notifications.map(({ notification, workflow: template, options = {} }) =>
        this.mapNotificationToWorkflowRun(notification, template, options)
      );

      await this.insertMany(
        workflowRunsData,
        {
          organizationId: firstNotification._organizationId,
          environmentId: firstNotification._environmentId,
          userId: notifications[0].options?.userId,
        },
        WORKFLOW_RUN_INSERT_OPTIONS
      );

      this.logger.debug(
        {
          batchSize: notifications.length,
          organizationId: firstNotification._organizationId,
          environmentId: firstNotification._environmentId,
        },
        'Workflow run batch created for observability'
      );
    } catch (error) {
      this.logger.error(
        {
          err: error,
          batchSize: notifications.length,
          errorMessage: error instanceof Error ? error.message : 'Unknown error',
        },
        'Failed to create workflow run batch'
      );
      // Don't rethrow to avoid breaking the main flow
    }
  }

  /**
   * Updates the status of a workflow run in ClickHouse.
   *
   * Note: ClickHouse doesn't support traditional updates.
   * We'll need to insert a new record with updated status.
   * ReplacingMergeTree will handle deduplication based on workflow_run_id.
   */
  async updateWorkflowRunState(
    workflowRunId: string,
    status: WorkflowRunStatusEnum,
    context: {
      organizationId: string;
      environmentId: string;
    },
    deliveryLifecycleStatus?: DeliveryLifecycleStatusEnum,
    deliveryLifecycleDetail?: DeliveryLifecycleDetail
  ): Promise<void> {
    try {
      const isEnabled = await this.featureFlagsService.getFlag({
        key: FeatureFlagsKeysEnum.IS_WORKFLOW_RUN_LOGS_WRITE_ENABLED,
        organization: { _id: context.organizationId },
        environment: { _id: context.environmentId },
        user: { _id: null },
        defaultValue: false,
      });

      if (!isEnabled) {
        return;
      }

      const notification: QueryNotificationEntity | null = await this.notificationRepository.findOne(
        {
          _id: workflowRunId,
          _organizationId: context.organizationId,
          _environmentId: context.environmentId,
        },
        {
          _id: 1,
          _templateId: 1,
          _organizationId: 1,
          _environmentId: 1,
          _subscriberId: 1,
          transactionId: 1,
          channels: 1,
          to: 1,
          payload: 1,
          controls: 1,
          topics: 1,
          _digestedNotificationId: 1,
          createdAt: 1,
          severity: 1,
          critical: 1,
          contextKeys: 1,
        }
      );

      if (!notification) {
        this.logger.warn(
          {
            workflowRunId,
            organizationId: context.organizationId,
            environmentId: context.environmentId,
          },
          'Notification not found for workflow run status update'
        );
        return;
      }

      const workflow = await this.notificationTemplateRepository.findOne(
        {
          _id: notification._templateId,
          _environmentId: context.environmentId,
        },
        {
          name: 1,
          triggers: 1,
        }
      );

      if (!workflow) {
        this.logger.warn(
          {
            workflowRunId,
            templateId: notification._templateId,
            environmentId: context.environmentId,
          },
          'Notification template not found for workflow run status update'
        );
        return;
      }

      const workflowRunData = this.mapNotificationToWorkflowRun(notification, workflow, {
        status,
        deliveryLifecycleStatus,
        deliveryLifecycleDetail,
        userId: null,
        externalSubscriberId: notification.to?.subscriberId || null,
      });

      await this.insert(workflowRunData, context, WORKFLOW_RUN_INSERT_OPTIONS);

      this.logger.debug(
        {
          workflowRunId,
          status,
          organizationId: context.organizationId,
          environmentId: context.environmentId,
        },
        'Workflow run status updated'
      );
    } catch (error) {
      this.logger.error(
        {
          err: error,
          workflowRunId,
          status,
          organizationId: context.organizationId,
          environmentId: context.environmentId,
          errorMessage: error instanceof Error ? error.message : 'Unknown error',
        },
        'Failed to update workflow run status'
      );
    }
  }

  // Overload for column array selection
  async findWithCursor<T extends readonly WorkflowRunColumns[]>(options: {
    where: Where<WorkflowRun>;
    cursor?: {
      created_at: string;
      workflow_run_id: string;
    };
    limit?: number;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data: SelectedWorkflowRun<T>[];
    rows: number;
  }>;

  // Overload for "*" all columns selection
  async findWithCursor(options: {
    where: Where<WorkflowRun>;
    cursor?: {
      created_at: string;
      workflow_run_id: string;
    };
    limit?: number;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: '*';
  }): Promise<{
    data: WorkflowRun[];
    rows: number;
  }>;

  /**
   * Compound cursor-based pagination for workflow runs with automatic tenant enforcement.
   * Handles timestamp collisions by using both created_at and workflow_run_id.
   * All queries are secure by default with mandatory tenant isolation.
   */
  async findWithCursor<T extends readonly WorkflowRunColumns[] | '*'>(options: {
    where: Where<WorkflowRun>;
    cursor?: {
      created_at: string;
      workflow_run_id: string;
    };
    limit?: number;
    orderDirection?: 'ASC' | 'DESC';
    useFinal?: boolean;
    select: T;
  }): Promise<{
    data: WorkflowRun[] | SelectedWorkflowRun<T extends readonly WorkflowRunColumns[] ? T : never>[];
    rows: number;
  }> {
    const { where, cursor, limit = 100, orderDirection = 'DESC', useFinal = false, select } = options;
    const isBoundaryCase = cursor?.workflow_run_id === '1';

    if (limit < 0 || limit > 1000) {
      throw new Error('Limit must be between 0 and 1000');
    }

    // Build the base WHERE clause with automatic tenant enforcement
    const { clause: baseClause, params: baseParams } = this.buildWhereClause(where);

    let whereClause = baseClause || 'WHERE 1=1';
    const params = { ...baseParams };

    // Add compound cursor conditions if cursor is provided
    if (cursor) {
      const cursorTimestamp = new Date(cursor.created_at);
      const cursorId = cursor.workflow_run_id;

      const timestampParam = 'cursor_timestamp';
      const timestampEqualParam = 'cursor_timestamp_eq';
      const idParam = 'cursor_id';

      const timeOperator = orderDirection === 'DESC' ? '<' : '>';
      const idOperator = orderDirection === 'DESC' ? '<' : '>';

      if (!isBoundaryCase) {
        params[timestampParam] = cursorTimestamp;
        params[timestampEqualParam] = cursorTimestamp;
        params[idParam] = cursorId;
      } else {
        params[timestampParam] = timeOperator === '>' ? new Date(0) : new Date('2099-12-31T23:59:59.999Z');
        params[timestampEqualParam] = timeOperator === '>' ? new Date(0) : new Date('2099-12-31T23:59:59.999Z');
        params[idParam] = timeOperator === '>' ? '1' : '9999999999999999999999999999999999999999';
      }

      const cursorCondition = `
        (created_at ${timeOperator} {${timestampParam}:DateTime64(3, 'UTC')})
        OR (
          created_at = {${timestampEqualParam}:DateTime64(3, 'UTC')} 
          AND workflow_run_id ${idOperator} {${idParam}:String}
        )
      `;

      if (whereClause && whereClause !== 'WHERE 1=1') {
        whereClause = `${whereClause} AND (${cursorCondition})`;
      } else {
        whereClause = `WHERE ${cursorCondition}`;
      }
    }

    const finalModifier = useFinal ? ' FINAL' : '';
    const orderByClause = `ORDER BY created_at ${orderDirection}, workflow_run_id ${orderDirection}`;

    // Build SELECT clause - use provided columns or all columns if "*" is specified
    const selectClause = select === '*' ? '*' : (select as readonly string[]).join(', ');

    const query = `
      SELECT ${selectClause}
      FROM ${this.table}${finalModifier}
      ${whereClause}
      ${orderByClause}
      LIMIT ${limit}
    `;

    this.logger.debug('Executing compound cursor query with tenant enforcement', {
      query: query.replace(/\s+/g, ' ').trim(),
      cursor: cursor ? 'present' : 'none',
      selectedColumns: select === '*' ? 'all' : (select as readonly string[]).length,
      tenantEnforcement: '__unsafe' in where ? 'bypassed' : 'enforced',
    });

    const result = await this.clickhouseService.query({
      query,
      params,
    });

    return result as {
      data: WorkflowRun[] | SelectedWorkflowRun<T extends readonly WorkflowRunColumns[] ? T : never>[];
      rows: number;
    };
  }

  private mapNotificationToWorkflowRun(
    notification: QueryNotificationEntity,
    workflow: NotificationTemplateEntity,
    options: IWorkflowRunOptions
  ): WorkflowRunInsertData {
    const now = new Date();

    return {
      created_at: LogRepository.formatDateTime64(new Date(notification.createdAt)),
      updated_at: LogRepository.formatDateTime64(now),

      // Core workflow run identification
      workflow_run_id: notification._id,
      workflow_id: notification._templateId,
      workflow_name: workflow.name,

      // Context
      organization_id: notification._organizationId,
      environment_id: notification._environmentId,
      user_id: options.userId || null,
      subscriber_id: notification._subscriberId,
      external_subscriber_id: options.externalSubscriberId || null,

      // Execution metadata
      status: options.status || WorkflowRunStatusEnum.PROCESSING,
      trigger_identifier: this.getTriggerIdentifier(workflow),

      // Correlation and grouping
      transaction_id: notification.transactionId,
      channels: JSON.stringify(notification.channels || []),

      // Subscriber context
      subscriber_to: notification.to ? JSON.stringify(notification.to) : null,
      payload: notification.payload ? JSON.stringify(notification.payload) : null,
      control_values: notification.controls ? JSON.stringify(notification.controls) : null,

      // Topic information
      topics: notification.topics ? JSON.stringify(notification.topics) : null,

      // Digest information
      is_digest: notification._digestedNotificationId ? 'true' : 'false',
      digested_workflow_run_id: notification._digestedNotificationId || null,

      // Delivery lifecycle
      ...(options.deliveryLifecycleStatus && { delivery_lifecycle_status: options.deliveryLifecycleStatus }),
      ...(options.deliveryLifecycleDetail && { delivery_lifecycle_detail: options.deliveryLifecycleDetail }),

      severity: notification.severity || SeverityLevelEnum.NONE,
      critical: notification.critical || false,
      context_keys: notification.contextKeys || [],
    };
  }

  private getTriggerIdentifier(template: NotificationTemplateEntity): string {
    if (template.triggers && template.triggers.length > 0) {
      return template.triggers[0].identifier;
    }

    return template.name.toLowerCase().replace(/\s+/g, '_');
  }

  async getWorkflowVolumeData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ workflow_name: string; count: string }>> {
    const query = `
      SELECT 
        workflow_name,
        count(*) as count
      FROM workflow_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
      GROUP BY workflow_name
      ORDER BY count DESC
      LIMIT 5
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      workflow_name: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }

  async getActiveSubscribersData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date,
    previousStartDate: Date,
    previousEndDate: Date
  ): Promise<{ currentPeriod: number; previousPeriod: number }> {
    // Query for current period
    const currentPeriodQuery = `
      SELECT count(DISTINCT external_subscriber_id) as count
      FROM workflow_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
    `;

    // Query for previous period
    const previousPeriodQuery = `
      SELECT count(DISTINCT external_subscriber_id) as count
      FROM workflow_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {previousStartDate:DateTime64(3)}
        AND created_at <= {previousEndDate:DateTime64(3)}
    `;

    const baseParams = {
      environmentId,
      organizationId,
    };

    const [currentResult, previousResult] = await Promise.all([
      this.clickhouseService.query<{ count: string }>({
        query: currentPeriodQuery,
        params: {
          ...baseParams,
          startDate: LogRepository.formatDateTime64(startDate),
          endDate: LogRepository.formatDateTime64(endDate),
        },
      }),
      this.clickhouseService.query<{ count: string }>({
        query: previousPeriodQuery,
        params: {
          ...baseParams,
          previousStartDate: LogRepository.formatDateTime64(previousStartDate),
          previousEndDate: LogRepository.formatDateTime64(previousEndDate),
        },
      }),
    ]);

    const currentPeriod = parseInt(currentResult.data[0]?.count || '0', 10);
    const previousPeriod = parseInt(previousResult.data[0]?.count || '0', 10);

    return {
      currentPeriod,
      previousPeriod,
    };
  }

  async getWorkflowRunsMetricData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date,
    previousStartDate: Date,
    previousEndDate: Date
  ): Promise<{ currentPeriod: number; previousPeriod: number }> {
    // Query for current period
    const currentPeriodQuery = `
      SELECT count(*) as count
      FROM workflow_runs FINAL
      WHERE
        environment_id = {environmentId:String}
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
    `;

    // Query for previous period
    const previousPeriodQuery = `
      SELECT count(*) as count
      FROM workflow_runs FINAL
      WHERE
        environment_id = {environmentId:String}
        AND organization_id = {organizationId:String}
        AND created_at >= {previousStartDate:DateTime64(3)}
        AND created_at <= {previousEndDate:DateTime64(3)}
    `;

    const baseParams = {
      environmentId,
      organizationId,
    };

    const [currentResult, previousResult] = await Promise.all([
      this.clickhouseService.query<{ count: string }>({
        query: currentPeriodQuery,
        params: {
          ...baseParams,
          startDate: LogRepository.formatDateTime64(startDate),
          endDate: LogRepository.formatDateTime64(endDate),
        },
      }),
      this.clickhouseService.query<{ count: string }>({
        query: previousPeriodQuery,
        params: {
          ...baseParams,
          previousStartDate: LogRepository.formatDateTime64(previousStartDate),
          previousEndDate: LogRepository.formatDateTime64(previousEndDate),
        },
      }),
    ]);

    const currentPeriod = parseInt(currentResult.data[0]?.count || '0', 10);
    const previousPeriod = parseInt(previousResult.data[0]?.count || '0', 10);

    return {
      currentPeriod,
      previousPeriod,
    };
  }

  async getWorkflowRunsTrendData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ date: string; status: string; count: string }>> {
    const query = `
      SELECT 
        toDate(created_at) as date,
        status,
        count(*) as count
      FROM workflow_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
      GROUP BY date, status
      ORDER BY date, status
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      date: string;
      status: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }

  async getActiveSubscribersTrendData(
    environmentId: string,
    organizationId: string,
    startDate: Date,
    endDate: Date
  ): Promise<Array<{ date: string; count: string }>> {
    const query = `
      SELECT 
        toDate(created_at) as date,
        count(DISTINCT external_subscriber_id) as count
      FROM workflow_runs FINAL
      WHERE 
        environment_id = {environmentId:String} 
        AND organization_id = {organizationId:String}
        AND created_at >= {startDate:DateTime64(3)}
        AND created_at <= {endDate:DateTime64(3)}
      GROUP BY date
      ORDER BY date
    `;

    const params = {
      environmentId,
      organizationId,
      startDate: LogRepository.formatDateTime64(startDate),
      endDate: LogRepository.formatDateTime64(endDate),
    };

    const result = await this.clickhouseService.query<{
      date: string;
      count: string;
    }>({
      query,
      params,
    });

    return result.data;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - options({} }))
Declaraciones 'export' encontradas:
- export class WorkflowRunRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/analytic-logs/workflow-run/workflow-run.schema.ts
Tamaño: 3631 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DeliveryLifecycleStatusEnum, SeverityLevelEnum } from '@novu/shared';
import {
  CHArray,
  CHBoolean,
  CHDateTime64,
  CHLowCardinality,
  CHNullable,
  CHString,
  ClickhouseSchema,
  InferClickhouseSchemaType,
} from 'clickhouse-schema';
import { Prettify } from '../../../utils/prettify.type';

export const TABLE_NAME = 'workflow_runs';

const schemaDefinition = {
  id: { type: CHString() },
  created_at: { type: CHDateTime64(3, 'UTC') },

  // todo: redundant, remove this field
  updated_at: { type: CHDateTime64(3, 'UTC') },

  // Core workflow run identification
  workflow_run_id: { type: CHString() }, // Maps to NotificationEntity._id
  workflow_id: { type: CHString() }, // Maps to NotificationTemplateEntity._id
  workflow_name: { type: CHString() }, // Maps to NotificationTemplateEntity.name

  // Context
  organization_id: { type: CHString() },
  environment_id: { type: CHString() },
  user_id: { type: CHNullable(CHString()) },
  subscriber_id: { type: CHString() },
  external_subscriber_id: { type: CHNullable(CHString()) },
  context_keys: { type: CHArray(CHString(), []) }, // Array of context keys (type:identifier)

  // Execution metadata
  status: { type: CHLowCardinality(CHString()) }, // processing, error, completed
  delivery_lifecycle_status: { type: CHLowCardinality(CHString('')) },
  delivery_lifecycle_detail: { type: CHString('') },
  trigger_identifier: { type: CHString() }, // The event identifier that triggered the workflow

  // Correlation and grouping
  transaction_id: { type: CHString() },
  channels: { type: CHString() }, // JSON array of channels: ["email", "sms", "push"]

  // Subscriber context
  subscriber_to: { type: CHNullable(CHString()) }, // JSON representation of the 'to' field
  payload: { type: CHNullable(CHString()) }, // JSON representation of the payload
  control_values: { type: CHNullable(CHString()) }, // JSON representation of controls

  // Topic information
  topics: { type: CHNullable(CHString()) }, // JSON array of topics

  // Digest information
  is_digest: { type: CHLowCardinality(CHString()) }, // 'true' or 'false'
  digested_workflow_run_id: { type: CHNullable(CHString()) }, // Reference to parent digest if this is a digested notification

  // Data retention
  expires_at: { type: CHDateTime64(3, 'UTC') },

  severity: { type: CHLowCardinality(CHString(SeverityLevelEnum.NONE)) }, // severity of the workflow run
  critical: { type: CHBoolean(false) }, // critical flag of the workflow run
};

export const ORDER_BY: (keyof typeof schemaDefinition)[] = ['organization_id', 'workflow_run_id'];

export const TTL: keyof typeof schemaDefinition = 'expires_at';

const clickhouseSchemaOptions = {
  table_name: TABLE_NAME,
  engine: 'ReplacingMergeTree(updated_at)',
  order_by: `(${ORDER_BY.join(', ')})` as any,
  additional_options: ['PARTITION BY toYYYYMM(created_at)', `TTL toDateTime(${TTL})`],
};

export const workflowRunSchema = new ClickhouseSchema(schemaDefinition, clickhouseSchemaOptions);

export enum WorkflowRunStatusEnum {
  /**
   * @deprecated please use processing instead nv-6562
   */
  PENDING = 'pending',
  PROCESSING = 'processing',
  /**
   * @deprecated please use COMPLETED instead nv-6562
   */
  SUCCESS = 'success',
  COMPLETED = 'completed',
  ERROR = 'error',
}

type NativeWorkflowRun = InferClickhouseSchemaType<typeof workflowRunSchema>;

export type WorkflowRun = Prettify<
  Omit<NativeWorkflowRun, 'status' | 'delivery_lifecycle_status' | 'severity'> & {
    status: WorkflowRunStatusEnum;
    delivery_lifecycle_status: DeliveryLifecycleStatusEnum;
    severity: SeverityLevelEnum;
  }
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  enum
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/auth/auth.service.interface.ts
Tamaño: 1272 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MemberEntity, SubscriberEntity, UserEntity } from '@novu/dal';
import { AuthenticateContext, AuthProviderEnum, ISubscriberJwt, UserSessionData } from '@novu/shared';

export interface IAuthService {
  authenticate(
    authProvider: AuthProviderEnum,
    accessToken: string,
    refreshToken: string,
    profile: {
      name: string;
      login: string;
      email: string;
      avatar_url: string;
      id: string;
    },
    distinctId: string,
    additionalContext?: AuthenticateContext
  ): Promise<{ newUser: boolean; token: string }>;
  refreshToken(userId: string): Promise<string>;
  isAuthenticatedForOrganization(userId: string, organizationId: string): Promise<boolean>;
  getUserByApiKey(apiKey: string): Promise<UserSessionData>;
  getSubscriberWidgetToken(subscriber: SubscriberEntity, contextKeys?: string[]): Promise<string>;
  generateUserToken(user: UserEntity): Promise<string>;
  getSignedToken(
    user: UserEntity,
    organizationId?: string,
    member?: MemberEntity,
    environmentId?: string
  ): Promise<string>;

  validateUser(payload: UserSessionData): Promise<UserEntity>;
  validateSubscriber(payload: ISubscriberJwt): Promise<SubscriberEntity | null>;
  isRootEnvironment(payload: UserSessionData): Promise<boolean>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/auth/index.ts
Tamaño: 68 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './auth.service.interface';
export * from './shared';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/auth/shared.ts
Tamaño: 1455 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const buildOauthRedirectUrl = (request): string => {
  let url = `${process.env.FRONT_BASE_URL}/auth/login`;

  if (!request.user || !request.user.token) {
    return `${url}?error=AuthenticationError`;
  }

  const { redirectUrl } = JSON.parse(request.query.state);

  /**
   * Make sure we only allow localhost redirects for CLI use and our own success route
   * https://github.com/novuhq/novu/security/code-scanning/3
   */
  if (redirectUrl && redirectUrl.startsWith('http://127.0.0.1:') && !redirectUrl.includes('@')) {
    url = redirectUrl;
  }

  url += `?token=${request.user.token}`;

  if (request.user.newUser) {
    url += '&newUser=true';
  }

  /**
   * partnerCode, next and configurationId are required during external partners integration
   * such as vercel integration etc
   */
  const { partnerCode } = JSON.parse(request.query.state);
  if (partnerCode) {
    url += `&code=${partnerCode}`;
  }

  const { next } = JSON.parse(request.query.state);
  if (next) {
    url += `&next=${next}`;
  }

  const { configurationId } = JSON.parse(request.query.state);
  if (configurationId) {
    url += `&configurationId=${configurationId}`;
  }

  const { invitationToken } = JSON.parse(request.query.state);
  if (invitationToken) {
    url += `&invitationToken=${invitationToken}`;
  }
  const { isLoginPage } = JSON.parse(request.query.state);
  if (isLoginPage) {
    url += `&isLoginPage=${isLoginPage}`;
  }

  return url;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildOauthRedirectUrl(request): string)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/bull-mq/bull-mq.service.spec.ts
Tamaño: 3419 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobTopicNameEnum } from '@novu/shared';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { BullMqService, QueueBaseOptions, WorkerOptions } from './bull-mq.service';

let bullMqService: BullMqService;

describe('BullMQ Service', () => {
  describe('Non cluster mode', () => {
    beforeEach(async () => {
      process.env.IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

      bullMqService = new BullMqService(new WorkflowInMemoryProviderService());
    });

    afterEach(async () => {
      await bullMqService.gracefulShutdown();
    });

    describe('Set up', () => {
      it('should be able to instantiate it correctly', async () => {
        expect(bullMqService.queue).toBeUndefined();
        expect(bullMqService.worker).toBeUndefined();
        expect(BullMqService.haveProInstalled()).toBeFalsy();
        expect(await bullMqService.getStatus()).toEqual({
          queueIsPaused: undefined,
          queueName: undefined,
          workerIsPaused: undefined,
          workerIsRunning: undefined,
          workerName: undefined,
        });
      });

      it('should create a queue properly with the default configuration', async () => {
        const queueName = JobTopicNameEnum.ACTIVE_JOBS_METRIC;
        const queueOptions: QueueBaseOptions = {};
        await bullMqService.createQueue(queueName, queueOptions);

        expect(bullMqService.queue.name).toEqual(queueName);

        expect(await bullMqService.getStatus()).toEqual({
          queueIsPaused: false,
          queueName,
          workerIsPaused: undefined,
          workerIsRunning: undefined,
          workerName: undefined,
        });
      });

      it('should create a worker properly with the default configuration', async () => {
        const workerName = JobTopicNameEnum.ACTIVE_JOBS_METRIC;
        await bullMqService.createWorker(workerName, undefined, {});

        expect(bullMqService.worker.name).toEqual(workerName);
      });
    });
  });

  describe('Prefix functionality', () => {
    it('should use prefix if any Cluster provider enabled', async () => {
      process.env.MEMORY_DB_CLUSTER_SERVICE_HOST = 'localhost';
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      bullMqService = new BullMqService(new WorkflowInMemoryProviderService());
      const queue = bullMqService.createQueue(JobTopicNameEnum.ACTIVE_JOBS_METRIC, {});
      expect(queue.opts.prefix).toEqual('{metric-active-jobs}');
    });

    it('should not use prefix if a Redis provider is used and not in Cluster mode', async () => {
      process.env.MEMORY_DB_CLUSTER_SERVICE_HOST = '';
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

      bullMqService = new BullMqService(new WorkflowInMemoryProviderService());
      const queue = bullMqService.createQueue(JobTopicNameEnum.ACTIVE_JOBS_METRIC, {});
      expect(queue.opts.prefix).toEqual('bull');
    });

    it('should use prefix if in Cluster mode in Redis', async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';
      process.env.MEMORY_DB_CLUSTER_SERVICE_HOST = '';

      bullMqService = new BullMqService(new WorkflowInMemoryProviderService());
      const queue = bullMqService.createQueue(JobTopicNameEnum.ACTIVE_JOBS_METRIC, {});
      expect(queue.opts.prefix).toEqual('{metric-active-jobs}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - bullMqService(new BullMqService(new WorkflowInMemoryProviderService());
    });

    afterEach(async ())
 - QueueBaseOptions({};
        await bullMqService.createQueue(queueName, queueOptions);

        expect(bullMqService....)
 - workerName(JobTopicNameEnum.ACTIVE_JOBS_METRIC;
        await bullMqService.createWorker(workerName, undefined,...)
 - queue(bullMqService.createQueue(JobTopicNameEnum.ACTIVE_JOBS_METRIC, {});
      expect(queue.opts.prefix)....)
 - queue(bullMqService.createQueue(JobTopicNameEnum.ACTIVE_JOBS_METRIC, {});
      expect(queue.opts.prefix)....)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/bull-mq/bull-mq.service.ts
Tamaño: 7405 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { IEventJobData, IJobData, JobTopicNameEnum } from '@novu/shared';
import {
  BulkJobOptions,
  Job,
  JobsOptions,
  Metrics,
  MetricsTime,
  Processor,
  Queue,
  QueueBaseOptions,
  QueueOptions,
  ConnectionOptions as RedisConnectionOptions,
  Worker,
  WorkerOptions,
} from 'bullmq';

import { WorkflowInMemoryProviderService } from '../in-memory-provider';

interface IQueueMetrics {
  completed: Metrics;
  failed: Metrics;
}

type BullMqJobData = undefined | IJobData | IEventJobData;

const LOG_CONTEXT = 'BullMqService';

export {
  Job,
  JobsOptions,
  Processor,
  Queue,
  QueueBaseOptions,
  QueueOptions,
  RedisConnectionOptions as BullMqConnectionOptions,
  Worker,
  WorkerOptions,
  BulkJobOptions,
};

export class BullMqService {
  private _queue: Queue;
  private _worker: Worker;

  public static readonly pro: boolean = process.env.NOVU_MANAGED_SERVICE !== undefined;

  constructor(private workflowInMemoryProviderService: WorkflowInMemoryProviderService) {}

  public get worker(): Worker {
    return this._worker;
  }

  public get queue(): Queue {
    return this._queue;
  }

  public get queuePrefix(): string {
    return this._queue.opts.prefix;
  }

  public get workerPrefix(): string {
    return this._worker.opts.prefix;
  }

  public static haveProInstalled(): boolean {
    if (!BullMqService.pro) {
      return false;
    }

    require('@taskforcesh/bullmq-pro');

    return true;
  }

  private runningWithProQueue(): boolean {
    return BullMqService.pro && BullMqService.haveProInstalled();
  }

  /**
   * To avoid going crazy not understanding why jobs are not processed in cluster mode
   * Reference:
   * https://github.com/taskforcesh/bullmq/issues/560
   * https://github.com/taskforcesh/bullmq/issues/1219
   *
   * For retro-compatibility instances of the BullMqService must use prefix
   * but in one single case:
   * - Only Redis instances that are not in Cluster mode can't use prefix.
   *
   */
  private generatePrefix(prefix: JobTopicNameEnum): string {
    if (this.workflowInMemoryProviderService.providerInUseIsInClusterMode()) {
      return `{${prefix}}`;
    }

    return undefined;
  }

  public createQueue(topic: JobTopicNameEnum, queueOptions: QueueOptions) {
    const config = {
      connection: this.workflowInMemoryProviderService.getClient(),
      ...(queueOptions?.defaultJobOptions && {
        defaultJobOptions: {
          ...queueOptions.defaultJobOptions,
        },
      }),
    };

    const QueueClass = !BullMqService.pro ? Queue : require('@taskforcesh/bullmq-pro').QueuePro;

    Logger.log(
      `Creating queue ${topic}. BullMQ pro is ${this.runningWithProQueue() ? 'Enabled' : 'Disabled'}`,
      LOG_CONTEXT
    );

    const prefix = this.generatePrefix(topic);
    this._queue = new QueueClass(topic, {
      ...config,
      ...(prefix && { prefix }),
    });

    return this._queue;
  }

  public createWorker(
    topic: JobTopicNameEnum,
    processor?: string | Processor<any, unknown | void, string>,
    workerOptions?: WorkerOptions
  ) {
    const WorkerClass = !BullMqService.pro ? Worker : require('@taskforcesh/bullmq-pro').WorkerPro;

    const { concurrency, connection, lockDuration, settings } = workerOptions;

    const config = {
      connection: this.workflowInMemoryProviderService.getClient(),
      ...(concurrency && { concurrency }),
      ...(lockDuration && { lockDuration }),
      ...(settings && { settings }),
      metrics: { maxDataPoints: MetricsTime.ONE_MONTH },
      ...(BullMqService.pro
        ? {
            group: {},
          }
        : {}),
    };

    Logger.log(
      `Creating worker ${topic}. BullMQ pro is ${this.runningWithProQueue() ? 'Enabled' : 'Disabled'}`,
      LOG_CONTEXT
    );

    const prefix = this.generatePrefix(topic);
    this._worker = new WorkerClass(topic, processor, {
      ...config,
      ...(prefix && { prefix }),
    });

    return this._worker;
  }

  public add(name: string, data: BullMqJobData, options: JobsOptions = {}, groupId?: string) {
    this._queue.add(name, data, {
      ...options,
      ...(BullMqService.pro && groupId
        ? {
            group: {
              id: groupId,
            },
          }
        : {}),
    });
  }

  public async addBulk(
    data: {
      name: string;
      data: BullMqJobData;
      options?: BulkJobOptions;
      groupId?: string;
    }[]
  ) {
    const jobs = data.map((job) => {
      const jobOptions = {
        removeOnComplete: true,
        removeOnFail: true,
        ...job?.options,
      };

      if (BullMqService.pro && job?.groupId) {
        // BulkJobOptions.group is not defined in BullMQ types, it is defined in BullMQ Pro

        // @ts-ignore
        jobOptions.group = {
          id: job.groupId,
        };
      }

      const jobResult: {
        name: string;
        data: any;
        opts?: BulkJobOptions;
      } = { name: job.name, data: job.data, opts: jobOptions };

      return jobResult;
    });

    await this._queue.addBulk(jobs);
  }

  public async gracefulShutdown(): Promise<void> {
    Logger.log('Shutting the BullMQ service down', LOG_CONTEXT);

    if (this._queue) {
      await this._queue.close();
    }
    if (this._worker) {
      await this._worker.close();
    }

    Logger.log('Shutting down the BullMQ service has finished', LOG_CONTEXT);
  }

  public async getStatus(): Promise<{
    queueIsPaused: boolean | undefined;
    queueName: string | undefined;
    workerIsPaused: boolean | undefined;
    workerIsRunning: boolean | undefined;
    workerName: string | undefined;
  }> {
    const [queueIsPaused, workerIsPaused, workerIsRunning] = await Promise.all([
      this.isQueuePaused(),
      this.isWorkerPaused(),
      this.isWorkerRunning(),
    ]);

    return {
      queueIsPaused,
      queueName: this._queue?.name,
      workerIsPaused,
      workerIsRunning,
      workerName: this._worker?.name,
    };
  }

  public isClientReady(): boolean {
    return this.workflowInMemoryProviderService.isReady();
  }

  public async isQueuePaused(): Promise<boolean> {
    return await this._queue?.isPaused();
  }

  public async isWorkerPaused(): Promise<boolean> {
    return await this._worker?.isPaused();
  }

  public async isWorkerRunning(): Promise<boolean> {
    return await this._worker?.isRunning();
  }

  public async pauseWorker(): Promise<void> {
    if (this._worker) {
      try {
        /**
         * We will only execute this in the cold start, therefore we will
         * expect jobs not being processed in the Worker.
         * Reference: https://api.docs.bullmq.io/classes/v4.Worker.html#pause.pause-1
         */
        const doNotWaitActive = true;

        await this._worker.pause(doNotWaitActive);
        Logger.verbose(`Worker ${this._worker.name} pause succeeded`, LOG_CONTEXT);
      } catch (error) {
        Logger.error(error, `Worker ${this._worker.name} pause failed`, LOG_CONTEXT);

        throw error;
      }
    }
  }

  public async resumeWorker(): Promise<void> {
    if (this._worker) {
      try {
        await this._worker.resume();
        Logger.verbose(`Worker ${this._worker.name} resume succeeded`, LOG_CONTEXT);
      } catch (error) {
        Logger.error(error, `Worker ${this._worker.name} resume failed`, LOG_CONTEXT);

        throw error;
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - jobs(data.map((job))
Declaraciones 'export' encontradas:
- export
- export class BullMqService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/bull-mq/index.ts
Tamaño: 35 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './bull-mq.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/cache-service.mock.ts
Tamaño: 2001 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Redis } from 'ioredis';
import { CachingConfig, ICacheService } from './cache.service';

export const MockCacheService = {
  createClient(mockClient?: Partial<Redis>): ICacheService {
    const data = {};

    return {
      incrIfExistsAtomic(key: string): Promise<number> {
        const newValue = (data[key] || 0) + 1;
        data[key] = newValue;

        return newValue;
      },
      incr(key: string): Promise<number> {
        const newValue = (data[key] || 0) + 1;
        data[key] = newValue;

        return newValue;
      },
      set(key: string, value: string, options?: CachingConfig) {
        data[key] = value;
      },
      get(key: string) {
        return data[key];
      },
      del(key: string) {
        delete data[key];
      },
      delByPattern(pattern?: string) {
        const preFixSuffixTuple = pattern?.split('*');

        if (!preFixSuffixTuple) return;

        for (const key in data) {
          if (key.startsWith(preFixSuffixTuple[0]) && key.endsWith(preFixSuffixTuple[1])) delete data[key];
        }
      },
      keys(pattern?: string) {
        return Object.keys(data);
      },
      getStatus() {
        return 'ready';
      },
      cacheEnabled() {
        return true;
      },
      async sadd(key, ...members) {
        const dataVal = data[key];
        if (dataVal && !Array.isArray(dataVal)) {
          throw new Error('Wrong operation against a key holding the wrong kind of value');
        }

        const newVal = new Set(data[key]);

        let addCount = 0;
        members.forEach((member) => {
          if (!newVal.has(member)) {
            newVal.add(member);
            addCount += 1;
          }
        });
        data[key] = Array.from(newVal);

        return addCount;
      },
      async eval<TData = unknown>(script: string, keys: string[], args: (string | Buffer | number)[]): Promise<TData> {
        return mockClient.eval(script, keys.length, ...keys, ...args) as TData;
      },
    };
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - addCount(0;
        members.forEach((member))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/cache-service.spec.ts
Tamaño: 7886 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import sinon from 'sinon';
import { CacheInMemoryProviderService } from '../in-memory-provider';
import { CacheService, CachingConfig, ICacheService, splitKey } from './cache.service';
import { MockCacheService } from './cache-service.mock';

/**
 * TODO: Maybe create a Test single Redis instance to be able to run it in the
 * pipeline. Local wise they work
 */
describe.skip('Cache Service - Redis Instance - Non Cluster Mode', () => {
  let cacheService: CacheService;
  let cacheInMemoryProviderService: CacheInMemoryProviderService;

  beforeAll(async () => {
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

    cacheInMemoryProviderService = new CacheInMemoryProviderService();
    expect(cacheInMemoryProviderService.isCluster).toBe(false);

    cacheService = new CacheService(cacheInMemoryProviderService);
    await cacheService.initialize();
  });

  afterAll(async () => {
    await cacheInMemoryProviderService.shutdown();
  });

  it('should be instantiated properly', async () => {
    expect(cacheService.getStatus()).toEqual('ready');
    expect(cacheService.getTtl()).toEqual(7200);
    expect(cacheService.cacheEnabled()).toEqual(true);
  });

  it('should be able to add a key / value in the instance', async () => {
    const result = await cacheService.set('instance-key1', 'value1');
    expect(result).toBe('OK');
    const value = await cacheService.get('instance-key1');
    expect(value).toBe('value1');
  });

  it('should be able to delete a key / value in the instance', async () => {
    const result = await cacheService.del('instance-key1');
    expect(result).toBe(1);
    const value = await cacheService.get('instance-key1');
    expect(value).toBe(null);
  });

  it('should be able to add a compound key in the instance', async () => {
    const compoundKey = '{entity:notification_template:e=64b34d4908c2e563cccc20aa:i=64b34d4908c2e563cccc2b2f}';
    const result = await cacheService.set(compoundKey, 'whatever');
    expect(result).toBe('OK');
    const value = await cacheService.get(compoundKey);
    expect(value).toBe('whatever');
  });

  it('should be able to delete a compound key in the instance', async () => {
    const compoundKey = '{entity:notification_template:e=64b34d4908c2e563cccc20aa:i=64b34d4908c2e563cccc2b2f}';
    const result = await cacheService.del(compoundKey);
    expect(result).toBe(1);
    const value = await cacheService.get(compoundKey);
    expect(value).toBe(null);
  });
});

describe('Cache Service - Cluster Mode', () => {
  let cacheService: CacheService;
  let cacheInMemoryProviderService: CacheInMemoryProviderService;

  beforeAll(async () => {
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

    cacheInMemoryProviderService = new CacheInMemoryProviderService();
    expect(cacheInMemoryProviderService.isCluster).toBe(true);

    cacheService = new CacheService(cacheInMemoryProviderService);
    await cacheService.initialize();
  });

  afterAll(async () => {
    await cacheInMemoryProviderService.shutdown();
  });

  it('should be instantiated properly', async () => {
    expect(cacheService.getStatus()).toEqual('ready');
    expect(cacheService.getTtl()).toEqual(7200);
    expect(cacheService.cacheEnabled()).toEqual(true);
  });

  it('should be able to add a key / value in the Redis Cluster', async () => {
    const result = await cacheService.set('key1', 'value1');
    expect(result).toBe('OK');
    const value = await cacheService.get('key1');
    expect(value).toBe('value1');
  });

  it('should be able to add a key / value in the Redis Cluster if key not exist', async () => {
    const result = await cacheService.setIfNotExist('key1-not-exist', 'value1');
    expect(result).toBeDefined();
    const result1 = await cacheService.setIfNotExist('key1-not-exist', 'value1');
    expect(result1).toBeFalsy();
  });

  it('should be able to delete a key / value in the Redis Cluster', async () => {
    const result = await cacheService.del('key1');
    expect(result).toBe(1);
    const value = await cacheService.get('key1');
    expect(value).toBe(null);
  });

  it('should be able to add a compound key in the Redis Cluster', async () => {
    const compoundKey = '{entity:notification_template:e=64b34d4908c2e563cccc19dd:i=64b34d4908c2e563cccc1a1f}';
    const result = await cacheService.set(compoundKey, 'whatever');
    expect(result).toBe('OK');
    const value = await cacheService.get(compoundKey);
    expect(value).toBe('whatever');
  });

  it('should be able to delete a compound key in the Redis Cluster', async () => {
    const compoundKey = '{entity:notification_template:e=64b34d4908c2e563cccc19dd:i=64b34d4908c2e563cccc1a1f}';
    const result = await cacheService.del(compoundKey);
    expect(result).toBe(1);
    const value = await cacheService.get(compoundKey);
    expect(value).toBe(null);
  });
});

describe('cache-service', () => {
  let cacheService: ICacheService;

  beforeEach(() => {
    cacheService = MockCacheService.createClient();
  });

  afterEach((done) => {
    cacheService.delByPattern('*');
    done();
  });

  it('should store data in cache', async () => {
    const key = '123:456';
    const dataString = JSON.stringify({ array: [1, 2, 3] });
    cacheService.set(key, dataString);
    const res = cacheService.get(key);

    expect(dataString).toEqual(res);
  });

  it('should delete by pattern', async () => {
    cacheService.set('feed:123:456', 'random data');
    cacheService.set('feed:123:457', 'random data');
    cacheService.set('feed:query:123:457', 'random data');

    cacheService.delByPattern('feed*:123:457');

    const res1 = cacheService.get('feed:123:456');
    const res2 = cacheService.get('feed:123:457');
    const res3 = cacheService.get('feed:query:123:457');

    expect(res1).toEqual('random data');
    expect(res2).toEqual(undefined);
    expect(res3).toEqual(undefined);
  });

  it('should invoke the SADD method correctly', async () => {
    const key = '123:456';
    const data = [1, 2, 3];
    const res = await cacheService.sadd(key, ...data);
    const res2 = await cacheService.sadd(key, ...data);

    expect(res).toEqual(3);
    expect(res2).toEqual(0);
  });

  it('should invoke the EVAL function correctly', async () => {
    const dataString = JSON.stringify({ array: [1, 2, 3] });
    const evalMock = sinon.mock().resolves(dataString);
    cacheService = MockCacheService.createClient({ eval: evalMock });

    const script = 'return redis.call("get", KEYS[1])';
    const key = '123:456';
    const args = ['arg1', 'arg2'];
    cacheService.set(key, dataString);
    const res = await cacheService.eval(script, [key], args);

    expect(res).toEqual(dataString);
    expect(evalMock.calledWith(script, 1, key, 'arg1', 'arg2')).toEqual(true);
  });

  describe('splitKey', () => {
    it('should split the key into credentials and query parts', () => {
      const key =
        'query:integration:e=642578cea9684e9ebea5b04c:#query#={\\"channelType\\":\\"email\\",\\"findOne\\":true}';
      const result = splitKey(key);
      expect(result.credentials).toEqual('query:integration:e=642578cea9684e9ebea5b04c');
      expect(result.query).toEqual('{\\"channelType\\":\\"email\\",\\"findOne\\":true}');
    });

    it('should handle keys without a query part', () => {
      const key = 'query:integration:e=642578cea9684e9ebea5b04c:#query#=';
      const result = splitKey(key);
      expect(result.credentials).toEqual('query:integration:e=642578cea9684e9ebea5b04c');
      expect(result.query).toEqual('');
    });

    it('should handle keys without a credentials part', () => {
      const key = ':#query#={\\"channelType\\":\\"email\\",\\"findOne\\":true}';
      const result = splitKey(key);
      expect(result.credentials).toEqual('');
      expect(result.query).toEqual('{\\"channelType\\":\\"email\\",\\"findOne\\":true}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - cacheService(new CacheService(cacheInMemoryProviderService);
    await cacheService.initialize();
  });

  afterA...)
 - value(await cacheService.get('instance-key1');
    expect(value).toBe('value1');
  });

  it('should be ab...)
 - value(await cacheService.get('instance-key1');
    expect(value).toBe(null);
  });

  it('should be able t...)
 - value(await cacheService.get(compoundKey);
    expect(value).toBe('whatever');
  });

  it('should be able...)
 - value(await cacheService.get(compoundKey);
    expect(value).toBe(null);
  });
});

describe('Cache Servic...)
 - cacheService(new CacheService(cacheInMemoryProviderService);
    await cacheService.initialize();
  });

  afterA...)
 - value(await cacheService.get('key1');
    expect(value).toBe('value1');
  });

  it('should be able to add...)
 - result1(await cacheService.setIfNotExist('key1-not-exist', 'value1');
    expect(result1).toBeFalsy();
  });...)
 - value(await cacheService.get('key1');
    expect(value).toBe(null);
  });

  it('should be able to add a c...)
 - value(await cacheService.get(compoundKey);
    expect(value).toBe('whatever');
  });

  it('should be able...)
 - value(await cacheService.get(compoundKey);
    expect(value).toBe(null);
  });
});

describe('cache-servic...)
 - cacheService(MockCacheService.createClient();
  });

  afterEach((done))
 - res(cacheService.get(key);

    expect(dataString).toEqual(res);
  });

  it('should delete by pattern',...)
 - res3(cacheService.get('feed:query:123:457');

    expect(res1).toEqual('random data');
    expect(res2).t...)
 - res2(await cacheService.sadd(key, ...data);

    expect(res).toEqual(3);
    expect(res2).toEqual(0);
  }...)
 - res(await cacheService.eval(script, [key], args);

    expect(res).toEqual(dataString);
    expect(evalM...)
 - e(642578cea9684e9ebea5b04c');
      expect(result.query).toEqual('{\\"channelType\\":\\"email\\",\\"fi...)
 - e(642578cea9684e9ebea5b04c');
      expect(result.query).toEqual('');
    });

    it('should handle k...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/cache.service.ts
Tamaño: 6511 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { addJitter } from '../../resilience';
import { CacheInMemoryProviderService, InMemoryProviderClient, Pipeline } from '../in-memory-provider';
import { QUERY_PREFIX } from './key-builders';

const LOG_CONTEXT = 'CacheService';

enum CacheServiceActionsEnum {
  DEL_QUERY = 'delQuery',
  SET_QUERY = 'setQuery',
}

export interface ICacheService {
  set(key: string, value: string, options?: CachingConfig);
  get(key: string);
  del(key: string);
  incrIfExistsAtomic(key: string, incrementBy?: number): Promise<number | null>;
  delByPattern(pattern: string);
  keys(pattern?: string);
  getStatus();
  cacheEnabled();
  sadd(key: string, ...members: (string | number | Buffer)[]): Promise<number>;
  eval<TData = unknown>(script: string, keys: string[], args: (string | number | Buffer)[]): Promise<TData>;
  incr(key: string): Promise<number>;
}

export type CachingConfig = {
  ttl?: number;
};

export class CacheService implements ICacheService {
  private cacheTtl: number;
  private readonly TTL_VARIANT_PERCENTAGE = 0.1;

  constructor(private cacheInMemoryProviderService: CacheInMemoryProviderService) {}

  public async initialize(): Promise<void> {
    Logger.log('Initiated cache service', LOG_CONTEXT);

    await this.cacheInMemoryProviderService.initialize();

    this.cacheTtl = this.cacheInMemoryProviderService.getTtl();
  }

  public get client(): InMemoryProviderClient {
    return this.cacheInMemoryProviderService.getClient();
  }

  public getStatus(): string {
    return this.cacheInMemoryProviderService.getClientStatus();
  }

  public getTtl(): number {
    return this.cacheTtl;
  }

  public cacheEnabled(): boolean {
    const isEnabled = this.cacheInMemoryProviderService.isReady();
    if (!isEnabled) {
      Logger.log('Cache service is not enabled', LOG_CONTEXT);
    }

    return isEnabled;
  }

  public async set(key: string, value: string | number, options?: CachingConfig): Promise<string | null> {
    const result = await this.client?.set(key, value, 'EX', this.getTtlInSeconds(options));

    if (result === null) {
      Logger.error(`Set operation for key ${key} was not performed`, LOG_CONTEXT);
    }

    return result;
  }

  public async setIfNotExist(key: string, value: string, options?: CachingConfig): Promise<string | null> {
    const result = await this.client?.set(key, value, 'EX', this.getTtlInSeconds(options), 'NX');

    return result;
  }

  public async setQuery(key: string, value: string, options?: CachingConfig): Promise<void | unknown[]> {
    if (this.client) {
      const { credentials, query } = splitKey(key);

      const pipeline = this.client.pipeline();

      pipeline.sadd(credentials, query);
      pipeline.expire(credentials, this.cacheInMemoryProviderService.getTtl() + this.getTtlInSeconds(options));

      pipeline.set(key, value, 'EX', this.getTtlInSeconds(options));

      return await this.capturedExec(pipeline, CacheServiceActionsEnum.SET_QUERY, key);
    }
  }

  public async keys(pattern?: string): Promise<string[]> {
    const ALL_KEYS = '*';
    const queryPattern = pattern ?? ALL_KEYS;

    return this.client?.keys(queryPattern);
  }

  public async get(key: string): Promise<string> {
    return this.client?.get(key);
  }

  public async del(key: string | string[]): Promise<number> {
    const keys = Array.isArray(key) ? key : [key];

    return this.client?.del(keys);
  }

  // @deprecated This method is maintained solely for backward compatibility with quota throttling tests.
  // Use incrIfExistsAtomic() for new implementations to ensure proper TTL handling.
  public async incr(key: string): Promise<number> {
    return this.client?.incr(key);
  }

  public async incrIfExistsAtomic(key: string, incrementBy = 1): Promise<number | null> {
    if (!this.client) {
      return null;
    }

    const luaScript = `
      if redis.call('exists', KEYS[1]) == 1 then
        return redis.call('incrby', KEYS[1], ARGV[1])
      else
        return nil
      end
    `;

    const result = await this.eval<number | null>(luaScript, [key], [incrementBy]);

    return result;
  }

  public async delQuery(key: string): Promise<void | unknown[]> {
    if (this.client) {
      const queries = await this.client.smembers(key);

      if (queries.length === 0) return;

      const pipeline = this.client.pipeline();
      // invalidate queries
      queries.forEach((query) => {
        const fullKey = `${key}:${QUERY_PREFIX}=${query}`;
        pipeline.del(fullKey);
      });
      // invalidate queries set
      pipeline.del(key);

      return await this.capturedExec(pipeline, CacheServiceActionsEnum.DEL_QUERY, key);
    }
  }

  private async capturedExec(pipeline: Pipeline, action: CacheServiceActionsEnum, key: string): Promise<unknown[]> {
    try {
      return await pipeline.exec();
    } catch (error) {
      Logger.error(error, `Failed to execute pipeline action ${action} for key ${key}`, LOG_CONTEXT);
      throw error;
    }
  }

  public delByPattern(pattern: string): Promise<unknown> {
    const { client } = this;

    if (client) {
      return new Promise((resolve, reject) => {
        const stream = this.cacheInMemoryProviderService.inMemoryScan(pattern);

        stream.on('data', (keys) => {
          if (keys.length) {
            const pipeline = client.pipeline();
            keys.forEach((key) => {
              pipeline.del(key);
            });
            pipeline.exec().then(resolve).catch(reject);
          }
        });
        stream.on('end', () => {
          resolve(undefined);
        });
        stream.on('error', (err) => {
          reject(err);
        });
      });
    }
  }

  private getTtlInSeconds(options?: CachingConfig): number {
    const seconds = options?.ttl || this.cacheTtl;
    const number = addJitter(seconds, this.TTL_VARIANT_PERCENTAGE);

    return number;
  }

  public async sadd(key: string, ...members: (string | number | Buffer)[]): Promise<number> {
    return this.client?.sadd(key, ...members);
  }

  public async eval<TData = unknown>(
    script: string,
    keys: string[],
    args: (string | number | Buffer)[]
  ): Promise<TData> {
    return this.client?.eval(script, keys.length, ...keys, ...args) as Promise<TData>;
  }
}

export function splitKey(key: string) {
  const keyDelimiter = `:${QUERY_PREFIX}=`;
  const keyParts = key.split(keyDelimiter);
  const credentials = keyParts[0];
  const query = keyParts[1];

  return { credentials, query };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - splitKey(key: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - pipeline(this.client.pipeline();
      // invalidate queries
      queries.forEach((query))
 - stream(this.cacheInMemoryProviderService.inMemoryScan(pattern);

        stream.on('data', (keys))
 - pipeline(client.pipeline();
            keys.forEach((key))
Declaraciones 'export' encontradas:
- export  interface
- export  type
- export class CacheService
- export function splitKey

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/index.ts
Tamaño: 198 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './cache.service';
export { MockCacheService } from './cache-service.mock';
export * from './interceptors';
export * from './invalidate-cache.service';
export * from './key-builders';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/invalidate-cache.service.ts
Tamaño: 1889 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { CacheService } from './cache.service';
import { buildKey, CacheInterceptorTypeEnum } from './interceptors/shared-cache';
import { CacheKeyPrefixEnum } from './key-builders';

const LOG_CONTEXT = 'InvalidateCache';

@Injectable()
export class InvalidateCacheService {
  constructor(@Inject(CacheService) private cacheService: CacheService) {}

  public async invalidateByKey({ key }: { key: string }): Promise<number> {
    if (!this.cacheService?.cacheEnabled()) return;

    try {
      return await this.cacheService.del(key);
    } catch (err) {
      Logger.error(err, `An error has occurred when deleting "key: ${key}",`, LOG_CONTEXT);
    }
  }

  public async invalidateQuery({ key }: { key: string }): Promise<void | unknown[]> {
    if (!this.cacheService?.cacheEnabled()) return;

    try {
      return await this.cacheService.delQuery(key);
    } catch (err) {
      Logger.error(err, `An error has occurred when deleting by query "key: ${key}",`, LOG_CONTEXT);
    }
  }

  private async clearByPattern(
    storeKeyPrefix: CacheKeyPrefixEnum,
    credentials: Record<string, unknown>
  ): Promise<unknown | undefined> {
    Logger.verbose(`Removing keys with prefix: ${storeKeyPrefix}`);
    Logger.debug(`storeKeyPrefix is: ${storeKeyPrefix}`);

    const cacheKey = buildKey(storeKeyPrefix, credentials, CacheInterceptorTypeEnum.INVALIDATE);

    if (!cacheKey) {
      Logger.warn('Cache key does not exist', LOG_CONTEXT);

      return;
    }

    try {
      Logger.verbose('Awaiting cache delete by pattern');
      const result = await this.cacheService.delByPattern(cacheKey);
      Logger.verbose('Finished cache delete by pattern');

      return result;
    } catch (err) {
      Logger.error(err, `An error has occurred when clearing by pattern "key: ${cacheKey}",`, LOG_CONTEXT);
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InvalidateCacheService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/cached-query.interceptor.ts
Tamaño: 1497 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Logger } from '@nestjs/common';

import { CacheService } from '../cache.service';

const LOG_CONTEXT = 'CachedQueryInterceptor';

export function CachedQuery({ builder }: { builder: (...args) => string }) {
  const injectCache = Inject(CacheService);

  return (target: any, key: string, descriptor: any) => {
    const originalMethod = descriptor.value;
    const methodName = key;
    injectCache(target, 'cacheService');

    descriptor.value = async function (...args: any[]) {
      if (!this.cacheService?.cacheEnabled()) return await originalMethod.apply(this, args);

      const cacheService = this.cacheService as CacheService;

      const cacheKey = builder(...args);

      if (!cacheKey) {
        return await originalMethod.apply(this, args);
      }

      try {
        const value = await cacheService.get(cacheKey);
        if (value) {
          return JSON.parse(value);
        }
      } catch (err) {
        Logger.error(
          err,
          `An error has occurred when extracting "key: ${cacheKey}" in "method: ${methodName}"`,
          LOG_CONTEXT
        );
      }

      const response = await originalMethod.apply(this, args);

      try {
        await cacheService.setQuery(cacheKey, JSON.stringify(response));
      } catch (err) {
        Logger.error(
          err,
          `An error has occurred when inserting key: ${cacheKey} in method: ${methodName}`,
          LOG_CONTEXT
        );
      }

      return response;
    };
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - CachedQuery({ builder }: { builder: (...args)
Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('CachedQueryInterceptor';

export function CachedQuery({ builder }: { builder: (...args))
 - injectCache(Inject(CacheService);

  return (target: any, key: string, descriptor: any))
Declaraciones 'export' encontradas:
- export function CachedQuery

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/cached-response.decorator.spec.ts
Tamaño: 3720 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test, TestingModule } from '@nestjs/testing';
import { CacheService } from '../cache.service';
import { CachedResponse } from './cached-response.decorator';

// Mock class to demonstrate the decorator
class TestClass {
  @CachedResponse({
    builder: (...args) => `test-key-${args[0]}`,
    options: {
      skipCache: (arg) => arg === 'skip',
      skipSaveToCache: (response) => response === null,
    },
  })
  async testMethod(input: string): Promise<string | null> {
    return input === 'null' ? null : `processed-${input}`;
  }
}

describe('CachedResponse Decorator', () => {
  let testInstance: TestClass;
  let mockCacheService: {
    cacheEnabled: jest.Mock;
    get: jest.Mock;
    set: jest.Mock;
  };

  beforeEach(async () => {
    // Create mock for CacheService
    mockCacheService = {
      cacheEnabled: jest.fn().mockReturnValue(true),
      get: jest.fn(),
      set: jest.fn(),
    };

    // Create testing module
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        TestClass,
        {
          provide: CacheService,
          useValue: mockCacheService,
        },
      ],
    }).compile();

    // Get the test instance
    testInstance = module.get(TestClass);
  });

  it('should execute original method when cache is disabled', async () => {
    // Arrange
    mockCacheService.cacheEnabled.mockReturnValue(false);
    const spy = jest.spyOn(testInstance, 'testMethod');

    // Act
    const result = await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('processed-test');
    expect(spy).toHaveBeenCalledWith('test');
    expect(mockCacheService.get).not.toHaveBeenCalled();
  });

  it('should skip cache when skipCache condition is met', async () => {
    // Arrange
    const spy = jest.spyOn(testInstance, 'testMethod');

    // Act
    const result = await testInstance.testMethod('skip');

    // Assert
    expect(result).toBe('processed-skip');
    expect(spy).toHaveBeenCalledWith('skip');
    expect(mockCacheService.get).not.toHaveBeenCalled();
  });

  it('should retrieve from cache when value exists', async () => {
    // Arrange
    mockCacheService.get.mockResolvedValue('cached-value');

    // Act
    const result = await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('cached-value');
    expect(mockCacheService.get).toHaveBeenCalledWith('test-key-test');
    expect(mockCacheService.set).not.toHaveBeenCalled();
  });

  it('should save to cache when value not found', async () => {
    // Arrange
    mockCacheService.get.mockResolvedValue(null);

    // Act
    const result = await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('processed-test');
    expect(mockCacheService.get).toHaveBeenCalledWith('test-key-test');
    expect(mockCacheService.set).toHaveBeenCalledWith('test-key-test', 'processed-test', expect.any(Object));
  });

  it('should skip saving to cache when skipSaveToCache returns true', async () => {
    // Arrange
    mockCacheService.get.mockResolvedValue(null);

    // Act
    const result = await testInstance.testMethod('null');

    // Assert
    expect(result).toBeNull();
    expect(mockCacheService.get).toHaveBeenCalledWith('test-key-null');
    expect(mockCacheService.set).not.toHaveBeenCalled();
  });

  it('should handle cache retrieval errors gracefully', async () => {
    // Arrange
    mockCacheService.get.mockRejectedValue(new Error('Cache error'));
    const spy = jest.spyOn(testInstance, 'testMethod');

    // Act
    const result = await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('processed-test');
    expect(spy).toHaveBeenCalledWith('test');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - testInstance(module.get(TestClass);
  });

  it('should execute original method when cache is disabled', async ())
 - result(await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('processed-test');
   ...)
 - result(await testInstance.testMethod('skip');

    // Assert
    expect(result).toBe('processed-skip');
   ...)
 - result(await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('cached-value');
    e...)
 - result(await testInstance.testMethod('test');

    // Assert
    expect(result).toBe('processed-test');
   ...)
 - result(await testInstance.testMethod('null');

    // Assert
    expect(result).toBeNull();
    expect(mock...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/cached-response.decorator.ts
Tamaño: 2625 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject } from '@nestjs/common';
import { CacheService, CachingConfig } from '../cache.service';

type CachedEntityOptions<T_Output, T_Args extends any[]> = CachingConfig & {
  skipCache?: (...args: T_Args) => boolean;
  skipSaveToCache?: (response: T_Output) => boolean;
};

export function CachedResponse<T_Output = any, T_Args extends any[] = any[]>({
  builder,
  options,
}: {
  builder: (...args: T_Args) => string;
  options?: CachedEntityOptions<T_Output, T_Args>;
}) {
  const injectCache = Inject(CacheService);

  return (target: any, key: string, descriptor: PropertyDescriptor) => {
    const originalMethod = descriptor.value as (...args: T_Args) => Promise<T_Output>;
    const methodName = key;
    injectCache(target, 'cacheService');

    descriptor.value = async function (this: any, ...args: T_Args): Promise<T_Output> {
      const cacheService = this.cacheService as CacheService;

      // Check if cache is disabled
      if (!cacheService?.cacheEnabled()) {
        return await originalMethod.apply(this, args);
      }

      // Check if we should skip caching based on input arguments
      if (options?.skipCache && options.skipCache(...args)) {
        return await originalMethod.apply(this, args);
      }

      const cacheKey = builder(...args);
      if (!cacheKey) {
        return await originalMethod.apply(this, args);
      }

      try {
        const value = await cacheService.get(cacheKey);

        if (value) {
          const parsedValue = parseValueFromCache(value);

          return parsedValue as T_Output;
        }
      } catch (err) {
        // Silently handle cache retrieval error
      }

      const response: T_Output = await originalMethod.apply(this, args);

      try {
        if (!options?.skipSaveToCache?.(response)) {
          const valueToCache = isPrimitive(response) ? String(response) : JSON.stringify(response);
          await cacheService.set(cacheKey, valueToCache, options);
        }

        return response;
      } catch {
        // Silently handle cache insertion error
        return response;
      }
    };

    return descriptor;
  };
}

function parseValueFromCache(value: string): unknown {
  if (value === 'null') return null;
  if (value === 'true') return true;
  if (value === 'false') return false;

  const numValue = Number(value);
  if (!Number.isNaN(numValue)) return numValue;

  try {
    return JSON.parse(value);
  } catch {
    return value;
  }
}

function isPrimitive(value: unknown): boolean {
  return value === null || typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean';
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - parseValueFromCache(value: string)
 - isPrimitive(value: unknown)
Asignaciones con arrow functions encontradas (posibles funciones):
 - injectCache(Inject(CacheService);

  return (target: any, key: string, descriptor: PropertyDescriptor))
 - originalMethod(descriptor.value as (...args: T_Args))
Declaraciones 'export' encontradas:
- export function CachedResponse

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/index.ts
Tamaño: 121 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './cached-query.interceptor';
export * from './cached-response.decorator';
export * from './shared-cache';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/shared-cache.spec.ts
Tamaño: 16601 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CacheKeyPrefixEnum } from '../key-builders';
import {
  buildCachedQuery,
  buildCredentialsKeyPart,
  buildKey,
  buildQueryKeyPart,
  CacheInterceptorTypeEnum,
  getCredentialsKeys,
  getCredentialWithContext,
  getEnvironment,
  getIdentifier,
  getInvalidateQuery,
  getQueryParams,
  validateCredentials,
} from './shared-cache';

describe('shared cache', () => {
  describe('validateCredentials', () => {
    it('should validate the credentials for Message entity', () => {
      const keyPrefix = CacheKeyPrefixEnum.FEED;
      let credentials: string;
      let res: boolean;

      credentials = ':123:456';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(true);

      credentials = '';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);

      credentials = ':456';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);

      credentials = ':123:456:789';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);
    });
    it('should validate the credentials for not Message entity', () => {
      const keyPrefix = CacheKeyPrefixEnum.USER;
      let credentials: string;
      let res: boolean;

      credentials = ':123';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(true);

      credentials = ':123:456';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);

      credentials = ':123:456:789';
      res = validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);
    });
  });

  describe('getIdentifier', () => {
    it('should retrieve identifier _subscriber from Message query', async () => {
      const keyPrefix = CacheKeyPrefixEnum.FEED;
      let query: Record<string, unknown>;
      let res: { key: string; value: string };

      query = { _id: '123', _subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('456');

      query = { _id: '123', subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('456');

      query = { id: '123', _subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('456');

      query = { id: '123', subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('456');

      query = { dummyKey: '123' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual(undefined);
    });

    it('should retrieve identifier _id from not Message query', async () => {
      const keyPrefix = 'Subscriber';
      let query: Record<string, unknown>;
      let res: { key: string; value: string };

      query = { _id: '123', _subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('123');

      query = { _id: '123', subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('123');

      query = { id: '123', _subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('123');

      query = { id: '123', subscriberId: '456' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual('123');

      query = { dummyKey: '123' };
      res = getIdentifier(keyPrefix, query);
      expect(res.value).toEqual(undefined);
    });
  });

  describe('buildCredentialsKeyPart', () => {
    it('should build key part for Message entity', async () => {
      const keyPrefix = CacheKeyPrefixEnum.FEED;
      let query: Record<string, unknown>;
      let res: string;

      query = { id: '123', subscriberId: '456', _environmentId: '789' };
      res = buildCredentialsKeyPart(keyPrefix, query);
      expect(res).toEqual(':s=456:e=789');

      query = { id: '123', subscriberId: '456' };
      res = buildCredentialsKeyPart(keyPrefix, query);
      expect(res).toEqual(':s=456');
    });

    it('should build key part for not Message entity', async () => {
      const keyPrefix = 'Subscriber';

      const query = { id: '123', subscriberId: '456', _environmentId: '789' };
      const res = buildCredentialsKeyPart(keyPrefix, query);
      expect(res).toEqual(':i=123:e=789');
    });
  });

  describe('getEnvironment', () => {
    it('should return environment from query', async () => {
      let res: { key: string; value: string };
      let query: Record<string, unknown>;

      query = { id: '123', subscriberId: '456', _environmentId: '789' };
      res = getEnvironment(query);
      expect(res.key).toEqual('_environmentId');
      expect(res.value).toEqual('789');

      query = { id: '123', subscriberId: '456', environmentId: '789' };
      res = getEnvironment(query);
      expect(res.key).toEqual('environmentId');
      expect(res.value).toEqual('789');

      query = {
        id: '123',
        subscriberId: '456',
        environmentId: '789',
        _environmentId: '777',
      };
      res = getEnvironment(query);
      expect(res.key).toEqual('_environmentId');
      expect(res.value).toEqual('777');

      query = { id: '123', subscriberId: '456' };
      res = getEnvironment(query);
      expect(res?.key).toEqual(undefined);
      expect(res?.value).toEqual(undefined);
    });
  });

  describe('getCredentialWithContext', () => {
    it('should return credential with context', async () => {
      let key: string;
      let value: string;
      let res: string;

      key = 'id';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('i=123');

      key = '_id';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('i=123');

      key = 'subscriberId';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('s=123');

      key = '_subscriberId';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('s=123');

      key = 'environmentId';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('e=123');

      key = '_environmentId';
      value = '123';
      res = getCredentialWithContext(key, value);
      expect(res).toEqual('e=123');
    });
  });

  describe('buildKey', () => {
    it('should build cache key with only id for environment query by api', () => {
      const interceptorType = CacheInterceptorTypeEnum.CACHED;
      const prefixKey = CacheKeyPrefixEnum.ENVIRONMENT_BY_API_KEY;
      const keyConfig = { _id: '123' };
      const res = buildKey(prefixKey, keyConfig, interceptorType);

      expect(res).toEqual('environment_by_api_key:i=123');
    });

    it('should build cache key from prefix with config', async () => {
      const interceptorType = CacheInterceptorTypeEnum.CACHED;
      let prefixKey: CacheKeyPrefixEnum;
      let keyConfig: Record<string, unknown>;
      let res: string;

      prefixKey = CacheKeyPrefixEnum.FEED;
      keyConfig = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('feed:limit=10:s=333:e=456');

      prefixKey = CacheKeyPrefixEnum.SUBSCRIBER;
      keyConfig = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('subscriber:limit=10:i=123:e=456');

      keyConfig = { _environmentId: '456', limit: 10 };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('');
    });

    it('should build invalidate key from prefix with config', async () => {
      const interceptorType = CacheInterceptorTypeEnum.INVALIDATE;
      let prefixKey: CacheKeyPrefixEnum;
      let keyConfig: Record<string, unknown>;
      let res: string;

      prefixKey = CacheKeyPrefixEnum.FEED;
      keyConfig = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('feed*:s=333:e=456');

      prefixKey = CacheKeyPrefixEnum.SUBSCRIBER;
      keyConfig = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('subscriber*:i=123:e=456');

      keyConfig = { _id: '123', subscriberId: '333', limit: 10 };
      res = buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('');
    });
  });

  describe('getQueryParams', () => {
    it('should get query param from object', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        seen: true,
      };
      const res = getQueryParams(query);
      expect(res).toEqual(':limit=10:seen=true');
    });

    it('should filter credentials from query param from object', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        seen: true,
      };
      const res = getQueryParams(query);
      expect(res).not.toContain('id');
      expect(res).not.toContain('environmentId');
      expect(res).not.toContain('subscriberId');
      expect(res).toContain('limit');
      expect(res).toContain('seen');
    });

    it('should exclude undefined params from query object', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: null,
        seen: undefined,
      };
      const res = getQueryParams(query);
      expect(res).not.toContain('id');
      expect(res).not.toContain('environmentId');
      expect(res).not.toContain('subscriberId');
      expect(res).not.toContain('limit');
      expect(res).not.toContain('seen');
    });

    it('should stringify nested object in query object', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        options: { limit: 10, filter: true },
      };
      const res = getQueryParams(query);
      expect(res).toContain('options');
      expect(res).toEqual(':limit=10:options={"limit":10,"filter":true}');
    });

    it('should return {key=value} format separated with delimiter :', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        options: { limit: 10, filter: true },
      };
      const res = getQueryParams(query);
      expect(res).toContain(':limit=10');
      expect(res).toContain(':options={"limit":10,"filter":true}');
    });

    it('should return key with find prefix', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      const res = getQueryParams(query);
      expect(res).toEqual(':limit=10');
    });

    it('should return key with findOne prefix', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      const findOneRes = getQueryParams(query);
      expect(findOneRes).toEqual(':limit=10');

      const findByIdRes = getQueryParams(query);
      expect(findByIdRes).toEqual(':limit=10');
    });

    it('should return key without method name prefix', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
      };
      const findOneRes = getQueryParams(query);
      expect(findOneRes).toEqual(':limit=10');

      const findByIdRes = getQueryParams(query);
      expect(findByIdRes).toEqual(':limit=10');
    });
  });

  describe('getCredentialsKeys', () => {
    it('should return credentials with and without underline', async () => {
      const credentials = getCredentialsKeys();
      let tmp: string;

      tmp = credentials.filter((cred) => cred === 'id')[0];
      expect(tmp).toEqual('id');

      tmp = credentials.filter((cred) => cred === '_id')[0];
      expect(tmp).toEqual('_id');

      tmp = credentials.filter((cred) => cred === 'subscriberId')[0];
      expect(tmp).toEqual('subscriberId');

      tmp = credentials.filter((cred) => cred === '_subscriberId')[0];
      expect(tmp).toEqual('_subscriberId');

      tmp = credentials.filter((cred) => cred === 'environmentId')[0];
      expect(tmp).toEqual('environmentId');

      tmp = credentials.filter((cred) => cred === '_environmentId')[0];
      expect(tmp).toEqual('_environmentId');

      tmp = credentials.filter((cred) => cred === 'organizationId')[0];
      expect(tmp).toEqual('organizationId');

      tmp = credentials.filter((cred) => cred === '_organizationId')[0];
      expect(tmp).toEqual('_organizationId');
    });
  });

  describe('buildCachedQuery', () => {
    it('should return query object from object list', async () => {
      const queryArgs = [
        {
          query: {
            _id: '123',
            subscriberId: '333',
            _environmentId: '456',
            limit: '10',
          },
        },
        { options: { limit: '10', filter: true } },
      ];

      const credentials = buildCachedQuery(queryArgs) as {
        query: {
          _id: string;
          subscriberId: string;
          _environmentId: string;
          limit: string;
        };
        options: { limit: string; filter: string };
      };

      expect(credentials.query._id).toEqual('123');
      expect(credentials.query.subscriberId).toEqual('333');
      expect(credentials.query._environmentId).toEqual('456');
      expect(credentials.query.limit).toEqual('10');
      expect(credentials.options.limit).toEqual('10');
      expect(credentials.options.filter).toEqual(true);
    });

    it('should return query object from string list', async () => {
      const queryArgs = ['123', '456'];

      const credentials = buildCachedQuery(queryArgs) as Record<string, string>;

      expect(credentials.id).toEqual('123');
      expect(credentials.environmentId).toEqual('456');
    });
  });

  describe('getInvalidateQuery', () => {
    it('should create object after create method with its response (createResponse)', async () => {
      const createResponse = {
        _id: 'createResponse_123',
        subscriberId: 'createResponse_333',
        _environmentId: 'createResponse_456',
        data: 'createResponse_random response',
      };

      const queryArgs = [
        { _id: '123', subscriberId: '333' },
        { limit: '10', filter: true },
      ];

      const credentials = getInvalidateQuery('Create', createResponse, queryArgs);

      expect(credentials._id).toEqual('createResponse_123');
      expect(credentials.subscriberId).toEqual('createResponse_333');
    });

    it('should create object after update method with args object (queryArgs) first element', async () => {
      const createResponse = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        data: 'random response',
      };

      const queryArgs = [
        {
          _id: 'queryArgs_123',
          subscriberId: 'queryArgs_333',
        },
        { options: { limit: '10', filter: true } },
      ];

      const credentials = getInvalidateQuery('update', createResponse, queryArgs);

      expect(credentials._id).toEqual('queryArgs_123');
      expect(credentials.subscriberId).toEqual('queryArgs_333');
    });
  });

  describe('buildQueryKeyPart', () => {
    it('should build query key part for cached interceptor', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        seen: true,
      };
      const res = buildQueryKeyPart(CacheKeyPrefixEnum.MESSAGE_COUNT, CacheInterceptorTypeEnum.CACHED, query);

      expect(res).toEqual(':limit=10:seen=true');
    });

    it('should build query key part for invalidate interceptor', async () => {
      const query = {
        _id: '123',
        subscriberId: '333',
        _environmentId: '456',
        limit: 10,
        seen: true,
      };
      const res = buildQueryKeyPart(CacheKeyPrefixEnum.MESSAGE_COUNT, CacheInterceptorTypeEnum.INVALIDATE, query);

      expect(res).toEqual('*');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - res(validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);
    });
    it('shoul...)
 - res(validateCredentials(keyPrefix, credentials);
      expect(res).toEqual(false);
    });
  });

  desc...)
 - res(getIdentifier(keyPrefix, query);
      expect(res.value).toEqual(undefined);
    });

    it('should...)
 - res(getIdentifier(keyPrefix, query);
      expect(res.value).toEqual(undefined);
    });
  });

  descri...)
 - s(456');
    });

    it('should build key part for not Message entity', async ())
 - e(789');
    });
  });

  describe('getEnvironment', ())
 - res(getEnvironment(query);
      expect(res?.key).toEqual(undefined);
      expect(res?.value).toEqual(u...)
 - e(123');
    });
  });

  describe('buildKey', ())
 - i(123');
    });

    it('should build cache key from prefix with config', async ())
 - res(buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('');
    });

    it('sho...)
 - res(buildKey(prefixKey, keyConfig, interceptorType);
      expect(res).toEqual('');
    });
  });

  des...)
 - seen(true');
    });

    it('should filter credentials from query param from object', async ())
 - res(getQueryParams(query);
      expect(res).not.toContain('id');
      expect(res).not.toContain('envir...)
 - res(getQueryParams(query);
      expect(res).not.toContain('id');
      expect(res).not.toContain('envir...)
 - key(value} format separated with delimiter :', async ())
 - options({"limit":10,"filter":true}');
    });

    it('should return key with find prefix', async ())
 - limit(10');
    });

    it('should return key with findOne prefix', async ())
 - limit(10');
    });

    it('should return key without method name prefix', async ())
 - limit(10');
    });
  });

  describe('getCredentialsKeys', ())
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - tmp(credentials.filter((cred))
 - credentials(buildCachedQuery(queryArgs) as {
        query: {
          _id: string;
          subscriberId: str...)
 - credentials(buildCachedQuery(queryArgs) as Record<string, string>;

      expect(credentials.id).toEqual('123');...)
 - credentials(getInvalidateQuery('Create', createResponse, queryArgs);

      expect(credentials._id).toEqual('cre...)
 - credentials(getInvalidateQuery('update', createResponse, queryArgs);

      expect(credentials._id).toEqual('que...)
 - seen(true');
    });

    it('should build query key part for invalidate interceptor', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/interceptors/shared-cache.ts
Tamaño: 5209 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CacheKeyPrefixEnum } from '../key-builders';

export function validateCredentials(keyPrefix: CacheKeyPrefixEnum, credentials: string) {
  const entitiesEnvironmentLevel = [
    CacheKeyPrefixEnum.USER,
    CacheKeyPrefixEnum.INTEGRATION,
    CacheKeyPrefixEnum.ENVIRONMENT_BY_API_KEY,
  ];
  const splitCredentials = credentials?.split(':').filter((possibleKey) => possibleKey?.length > 0);

  return entitiesEnvironmentLevel.some((cacheKey) => cacheKey === keyPrefix)
    ? splitCredentials.length === 1
    : splitCredentials.length === 2;
}

/**
 * The data related to the messages stored by the subscriberId
 * therefore in order to keep the stored data fresh we need to build the key with subscriberId first.
 * @param key
 * @param keyConfig
 */
export function getIdentifier(
  key: string,
  keyConfig: Record<string, unknown>
): { key: string | undefined; value: string } {
  const entitiesSubscriberPreferred = [CacheKeyPrefixEnum.MESSAGE_COUNT, CacheKeyPrefixEnum.FEED];
  const subscriberPreferredKeys = ['subscriberId', '_subscriberId', '_id', 'id'];
  const idPreferredKeys = ['_id', 'id', '_subscriberId', 'subscriberId'];

  const subscriberPrefKey = subscriberPreferredKeys.find((prefKey) => keyConfig[prefKey]);
  const subscriberPreferred = {
    key: subscriberPrefKey,
    value: keyConfig[subscriberPrefKey as string] as string,
  };

  const idPrefKey = idPreferredKeys.find((prefKey) => keyConfig[prefKey]);
  const idPreferred = {
    key: idPrefKey,
    value: keyConfig[idPrefKey as string] as string,
  };

  return entitiesSubscriberPreferred.some((entity) => key.startsWith(entity)) ? subscriberPreferred : idPreferred;
}

export function getEnvironment(keyConfig: Record<string, unknown>): { key: string; value: string } | undefined {
  return keyConfig._environmentId
    ? { key: '_environmentId', value: keyConfig._environmentId as string }
    : keyConfig.environmentId
      ? { key: 'environmentId', value: keyConfig.environmentId as string }
      : undefined;
}

export function buildCredentialsKeyPart(key: string, keyConfig: Record<string, unknown>): string {
  let credentialsResult = '';
  const identifier = getIdentifier(key, keyConfig);

  if (identifier?.key) {
    credentialsResult += `:${getCredentialWithContext(identifier.key, identifier.value)}`;
  }

  const environment = getEnvironment(keyConfig);

  if (environment?.key) {
    credentialsResult += `:${getCredentialWithContext(environment.key, environment.value)}`;
  }

  return credentialsResult;
}

export function getCredentialWithContext(credentialKey: string, credentialValue: string): string {
  const context = credentialKey.replace('_', '')[0];

  return `${context}=${credentialValue}`;
}

export enum CacheInterceptorTypeEnum {
  CACHED = 'cached',
  INVALIDATE = 'invalidate',
}

export function buildKey(
  prefix: CacheKeyPrefixEnum,
  keyConfig: Record<string, unknown>,
  interceptorType: CacheInterceptorTypeEnum
): string {
  let cacheKey = prefix as string;

  cacheKey += buildQueryKeyPart(prefix, interceptorType, keyConfig);

  const credentials = buildCredentialsKeyPart(cacheKey, keyConfig);

  return validateCredentials(prefix, credentials) ? cacheKey + credentials : '';
}

export function getQueryParams(keysConfig: Record<string, unknown>): string {
  let result = '';

  const keysToExclude = [...getCredentialsKeys()];

  const filteredContextKeys = Object.fromEntries(
    Object.entries(keysConfig).filter(([key, value]) => {
      return !keysToExclude.some((element) => element === key);
    })
  );

  for (const [key, value] of Object.entries(filteredContextKeys)) {
    if (value == null) continue;

    const elementValue = typeof value === 'object' ? JSON.stringify(value) : value;

    const elementKey = `${key}=${elementValue as string}`;

    if (elementKey) {
      result += `:${elementKey}`;
    }
  }

  return result;
}

export function getCredentialsKeys() {
  return ['id', 'subscriberId', 'environmentId', 'organizationId'].flatMap((cred) => [cred, `_${cred}`]);
}

/**
 * typeof args[0] === 'string' - is true only on cases where the method params are not object
 * that occurs only in method 'findById'
 * @param args
 */
export function buildCachedQuery(args: unknown[]): Record<string, unknown> {
  const fromStringArray = { id: args[0], environmentId: args[1] };
  const fromObjectArray = args.reduce<Record<string, unknown>>((obj, item) => Object.assign(obj, item), {});

  return typeof args[0] === 'string' ? fromStringArray : fromObjectArray;
}

/**
 * on create request the _id is available after collection creation,
 * therefore we need to build it from the storage response
 * @param methodName
 * @param res
 * @param args
 */
export function getInvalidateQuery(
  methodName: string,
  res: Record<string, unknown>,
  args: Record<string, unknown>[]
): Record<string, unknown> {
  return methodName.startsWith('Create') ? res : args[0];
}

export function buildQueryKeyPart(
  prefix: CacheKeyPrefixEnum,
  interceptorType: CacheInterceptorTypeEnum,
  keyConfig: Record<string, unknown>
) {
  const WILD_CARD = '*';

  return interceptorType === CacheInterceptorTypeEnum.INVALIDATE ? WILD_CARD : getQueryParams(keyConfig);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - validateCredentials(keyPrefix: CacheKeyPrefixEnum, credentials: string)
 - getIdentifier(key: string,
  keyConfig: Record<string, unknown>)
 - getEnvironment(keyConfig: Record<string, unknown>)
 - buildCredentialsKeyPart(key: string, keyConfig: Record<string, unknown>)
 - getCredentialWithContext(credentialKey: string, credentialValue: string)
 - buildKey(prefix: CacheKeyPrefixEnum,
  keyConfig: Record<string, unknown>,
  interceptorType: CacheInterceptorTypeEnum)
 - getQueryParams(keysConfig: Record<string, unknown>)
 - getCredentialsKeys()
 - buildCachedQuery(args: unknown[])
 - getInvalidateQuery(methodName: string,
  res: Record<string, unknown>,
  args: Record<string, unknown>[])
 - buildQueryKeyPart(prefix: CacheKeyPrefixEnum,
  interceptorType: CacheInterceptorTypeEnum,
  keyConfig: Record<string, unknown>)
Asignaciones con arrow functions encontradas (posibles funciones):
 - splitCredentials(credentials?.split(':').filter((possibleKey))
 - subscriberPrefKey(subscriberPreferredKeys.find((prefKey))
 - idPrefKey(idPreferredKeys.find((prefKey))
 - idPreferred({
    key: idPrefKey,
    value: keyConfig[idPrefKey as string] as string,
  };

  return entitiesSu...)
 - filteredContextKeys(Object.fromEntries(
    Object.entries(keysConfig).filter(([key, value]))
 - fromObjectArray(args.reduce<Record<string, unknown>>((obj, item))
Declaraciones 'export' encontradas:
- export function validateCredentials
- export function getIdentifier
- export function getEnvironment
- export function buildCredentialsKeyPart
- export function getCredentialWithContext
- export  enum
- export function buildKey
- export function getQueryParams
- export function getCredentialsKeys
- export function buildCachedQuery
- export function getInvalidateQuery
- export function buildQueryKeyPart

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/builder.base.ts
Tamaño: 2184 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CacheKeyPrefixEnum, CacheKeyTypeEnum, IdentifierPrefixEnum, OrgScopePrefixEnum } from './identifiers';

/**
 * Wraps the entire prefix string with curly braces. This has the effect of ensuring
 * that the entire prefix string is treated as a single key part by Redis.
 *
 * This must be revisited as the Redis Cluster deployment moves beyond a single shard
 * to ensure that the key-space is distributed evenly.
 *
 * @see https://redis.io/docs/latest/operate/oss_and_stack/reference/cluster-spec/#hash-tags
 *
 * @param prefixString The prefix string to wrap.
 * @returns The prefix string wrapped with curly braces.
 */
export function prefixWrapper(prefixString: string) {
  return `{${prefixString}}`;
}

/**
 * Use this to build a key for entities that are scoped to an environment or organization
 * and have their own unique identifier.
 *
 * These keys take the shape:
 * `type:keyEntity:parentIdPrefix=parentId:identifierPrefix=identifier`
 */
export const buildParentScopedKeyById = ({
  type,
  keyEntity,
  parentIdPrefix,
  parentId,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  parentIdPrefix: OrgScopePrefixEnum;
  parentId: string;
  identifierPrefix: IdentifierPrefixEnum;
  identifier: string;
}): string => prefixWrapper(`${type}:${keyEntity}:${parentIdPrefix}=${parentId}:${identifierPrefix}=${identifier}`);

/**
 * Use this to build a key for entities that are scoped to an environment or organization
 */
export const buildScopedKey = ({
  type,
  keyEntity,
  scopedIdPrefix,
  scopedId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  scopedIdPrefix: OrgScopePrefixEnum;
  scopedId: string;
}): string => prefixWrapper(`${type}:${keyEntity}:${scopedIdPrefix}=${scopedId}`);

/**
 * Use this to build a key for entities that are unscoped (do not belong to a hierarchy)
 */
export const buildUnscopedKey = ({
  type,
  keyEntity,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  identifierPrefix: IdentifierPrefixEnum;
  identifier: string;
}): string => prefixWrapper(`${type}:${keyEntity}:${identifierPrefix}=${identifier}`);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - prefixWrapper(prefixString: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - buildParentScopedKeyById({
  type,
  keyEntity,
  parentIdPrefix,
  parentId,
  identifierPrefix,
  identifier,
}: {
  type: ...)
 - buildScopedKey({
  type,
  keyEntity,
  scopedIdPrefix,
  scopedId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: Cac...)
 - buildUnscopedKey({
  type,
  keyEntity,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeEnum;
  keyEntity:...)
Declaraciones 'export' encontradas:
- export function prefixWrapper
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/builder.scoped.ts
Tamaño: 2698 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { buildParentScopedKeyById, buildScopedKey, buildUnscopedKey } from './builder.base';
import {
  CacheKeyPrefixEnum,
  CacheKeyTypeEnum,
  IdentifierPrefixEnum,
  OrgScopePrefixEnum,
  ServiceConfigIdentifierEnum,
} from './identifiers';

/**
 *
 * Use this to build a key for entities that are scoped to an environment
 * and have their own unique identifier.
 */
export const buildEnvironmentScopedKeyById = ({
  type,
  keyEntity,
  environmentId,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  environmentId: string;
  identifierPrefix: IdentifierPrefixEnum;
  identifier: string;
}): string =>
  buildParentScopedKeyById({
    type,
    keyEntity,
    parentIdPrefix: OrgScopePrefixEnum.ENVIRONMENT_ID,
    parentId: environmentId,
    identifierPrefix,
    identifier,
  });

/**
 * Use this to build a key for entities that are scoped to an organization
 * and have their own unique identifier.
 */
export const buildOrganizationScopedKeyById = ({
  type,
  keyEntity,
  organizationId,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  organizationId: string;
  identifierPrefix: IdentifierPrefixEnum;
  identifier: string;
}): string =>
  buildParentScopedKeyById({
    type,
    keyEntity,
    parentIdPrefix: OrgScopePrefixEnum.ORGANIZATION_ID,
    parentId: organizationId,
    identifierPrefix,
    identifier,
  });

/**
 * Use this to build a key for entities that are scoped to an environment
 */
export const buildEnvironmentScopedKey = ({
  type,
  keyEntity,
  environmentId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  environmentId: string;
}): string =>
  buildScopedKey({
    type,
    keyEntity,
    scopedIdPrefix: OrgScopePrefixEnum.ENVIRONMENT_ID,
    scopedId: environmentId,
  });

/**
 * Use this to build a key for entities that are scoped to an organization
 */
export const buildOrganizationScopedKey = ({
  type,
  keyEntity,
  organizationId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  organizationId: string;
}): string =>
  buildScopedKey({
    type,
    keyEntity,
    scopedIdPrefix: OrgScopePrefixEnum.ORGANIZATION_ID,
    scopedId: organizationId,
  });

/**
 * Use this to build a key for service configs that are unscoped (do not belong to a hierarchy).
 * An example of a service config is the maximum API rate limit.
 */
export const buildServiceConfigKey = (identifier: ServiceConfigIdentifierEnum): string =>
  buildUnscopedKey({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.SERVICE_CONFIG,
    identifierPrefix: IdentifierPrefixEnum.SERVICE_CONFIG,
    identifier,
  });


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildEnvironmentScopedKeyById({
  type,
  keyEntity,
  environmentId,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyTypeE...)
 - buildOrganizationScopedKeyById({
  type,
  keyEntity,
  organizationId,
  identifierPrefix,
  identifier,
}: {
  type: CacheKeyType...)
 - buildEnvironmentScopedKey({
  type,
  keyEntity,
  environmentId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEn...)
 - buildOrganizationScopedKey({
  type,
  keyEntity,
  organizationId,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixE...)
 - buildServiceConfigKey(identifier: ServiceConfigIdentifierEnum): string)
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/crypto.ts
Tamaño: 207 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createHash as createHashCrypto } from 'crypto';

export const createHash = (str: string): string => {
  const hash = createHashCrypto('sha256');
  hash.update(str);

  return hash.digest('hex');
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - createHash(str: string): string)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/entities.spec.ts
Tamaño: 1712 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { buildUnscopedKey } from './builder.base';
import { buildSubscriberKey, buildUserKey } from './entities';
import { CacheKeyPrefixEnum, CacheKeyTypeEnum, IdentifierPrefixEnum, OrgScopePrefixEnum } from './identifiers';

describe('Key builder for entities', () => {
  describe('buildSubscriberKey', () => {
    it('should build a subscriber key with the given subscriberId and environmentId', () => {
      const subscriberId = '123';
      const environmentId = 'test-env';
      const expectedKey = `{${CacheKeyTypeEnum.ENTITY}:${CacheKeyPrefixEnum.SUBSCRIBER}:e=${environmentId}:s=${subscriberId}}`;
      const actualKey = buildSubscriberKey({
        subscriberId,
        _environmentId: environmentId,
      });
      expect(actualKey).toEqual(expectedKey);
    });
  });

  describe('buildUserKey', () => {
    it('should build a user key with the given _id', () => {
      const _id = '123';
      const expectedKey = `{${CacheKeyTypeEnum.ENTITY}:${CacheKeyPrefixEnum.USER}:${IdentifierPrefixEnum.ID}=${_id}}`;
      const actualKey = buildUserKey({ _id });
      expect(actualKey).toEqual(expectedKey);
    });
  });

  describe('buildKeyById', () => {
    it('should build a key with the given parameters', () => {
      const type = CacheKeyTypeEnum.ENTITY;
      const keyEntity = CacheKeyPrefixEnum.SUBSCRIBER;
      const identifierPrefix = IdentifierPrefixEnum.SUBSCRIBER_ID;
      const identifier = '123';
      const expectedKey = `{${type}:${keyEntity}:${identifierPrefix}=${identifier}}`;
      const actualKey = buildUnscopedKey({
        type,
        keyEntity,
        identifierPrefix,
        identifier,
      });
      expect(actualKey).toEqual(expectedKey);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - actualKey(buildSubscriberKey({
        subscriberId,
        _environmentId: environmentId,
      });
      ex...)
 - actualKey(buildUserKey({ _id });
      expect(actualKey).toEqual(expectedKey);
    });
  });

  describe('buil...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/entities.ts
Tamaño: 4298 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ResourceEnum } from '@novu/shared';
import { buildUnscopedKey } from './builder.base';
import {
  buildEnvironmentScopedKey,
  buildEnvironmentScopedKeyById,
  buildOrganizationScopedKey,
  buildOrganizationScopedKeyById,
} from './builder.scoped';
import { createHash } from './crypto';
import { BLUEPRINT_IDENTIFIER, CacheKeyPrefixEnum, CacheKeyTypeEnum, IdentifierPrefixEnum } from './identifiers';

export const buildSubscriberKey = ({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.SUBSCRIBER,
    environmentId: _environmentId,
    identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
    identifier: subscriberId,
  });
export const buildDedupSubscriberKey = ({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.SUBSCRIBER_DEDUP,
    environmentId: _environmentId,
    identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
    identifier: subscriberId,
  });

export const buildVariablesKey = ({
  _environmentId,
  _organizationId,
}: {
  _environmentId: string;
  _organizationId: string;
}): string =>
  buildEnvironmentScopedKey({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.WORKFLOW_VARIABLES,
    environmentId: _environmentId,
  });

export const buildUserKey = ({ _id }: { _id: string }): string =>
  buildUnscopedKey({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.USER,
    identifier: _id,
    identifierPrefix: IdentifierPrefixEnum.ID,
  });

export const buildGroupedBlueprintsKey = (environmentId: string): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.GROUPED_BLUEPRINTS,
    environmentId,
    identifierPrefix: IdentifierPrefixEnum.GROUPED_BLUEPRINT,
    identifier: BLUEPRINT_IDENTIFIER,
  });

export const buildAuthServiceKey = ({ apiKey }: { apiKey: string }): string => {
  const apiKeyHash = createHash(apiKey);

  return buildUnscopedKey({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.AUTH_SERVICE,
    identifier: apiKeyHash,
    identifierPrefix: IdentifierPrefixEnum.API_KEY,
  });
};

export const buildMaximumApiRateLimitKey = ({
  apiRateLimitCategory,
  _environmentId,
}: {
  apiRateLimitCategory: string;
  _environmentId: string;
}): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.MAXIMUM_API_RATE_LIMIT,
    environmentId: _environmentId,
    identifierPrefix: IdentifierPrefixEnum.API_RATE_LIMIT_CATEGORY,
    identifier: apiRateLimitCategory,
  });

export const buildEvaluateApiRateLimitKey = ({
  apiRateLimitCategory,
  _environmentId,
}: {
  apiRateLimitCategory: string;
  _environmentId: string;
}): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.EVALUATE_API_RATE_LIMIT,
    environmentId: _environmentId,
    identifierPrefix: IdentifierPrefixEnum.API_RATE_LIMIT_CATEGORY,
    identifier: apiRateLimitCategory,
  });

export const buildUsageKey = ({
  _organizationId,
  resourceType,
}: {
  _organizationId: string;
  resourceType: ResourceEnum;
}): string => {
  return buildOrganizationScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.USAGE,
    organizationId: _organizationId,
    identifierPrefix: IdentifierPrefixEnum.RESOURCE_TYPE,
    identifier: resourceType,
  });
};

export const buildSubscriptionKey = ({ organizationId }: { organizationId: string }): string =>
  buildOrganizationScopedKey({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.SUBSCRIPTION,
    organizationId,
  });

export const buildSubscriberTopicsKey = ({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): string =>
  buildEnvironmentScopedKeyById({
    type: CacheKeyTypeEnum.ENTITY,
    keyEntity: CacheKeyPrefixEnum.SUBSCRIBER_TOPICS,
    environmentId: _environmentId,
    identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
    identifier: subscriberId,
  });


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildSubscriberKey({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): strin...)
 - buildDedupSubscriberKey({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): strin...)
 - buildVariablesKey({
  _environmentId,
  _organizationId,
}: {
  _environmentId: string;
  _organizationId: string;
}):...)
 - buildUserKey({ _id }: { _id: string }): string)
 - buildGroupedBlueprintsKey(environmentId: string): string)
 - buildAuthServiceKey({ apiKey }: { apiKey: string }): string)
 - buildMaximumApiRateLimitKey({
  apiRateLimitCategory,
  _environmentId,
}: {
  apiRateLimitCategory: string;
  _environmentId: s...)
 - buildEvaluateApiRateLimitKey({
  apiRateLimitCategory,
  _environmentId,
}: {
  apiRateLimitCategory: string;
  _environmentId: s...)
 - buildUsageKey({
  _organizationId,
  resourceType,
}: {
  _organizationId: string;
  resourceType: ResourceEnum;
}...)
 - buildSubscriptionKey({ organizationId }: { organizationId: string }): string)
 - buildSubscriberTopicsKey({
  subscriberId,
  _environmentId,
}: {
  subscriberId: string;
  _environmentId: string;
}): strin...)
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/identifiers.ts
Tamaño: 2205 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 ***************************************
 *       KEY BUILDER IDENTIFIERS
 ***************************************
 */

/**
 * The prefix used to identify a query key.
 */
export const QUERY_PREFIX = '#query#';

/**
 * Add an entry to this enum when you have a new entity that needs to be cached.
 */
export enum CacheKeyPrefixEnum {
  AUTH_SERVICE = 'auth_service',
  ENVIRONMENT_BY_API_KEY = 'environment_by_api_key',
  EVALUATE_API_RATE_LIMIT = 'evaluate_api_rate_limit',
  FEED = 'feed',
  GROUPED_BLUEPRINTS = 'grouped-blueprints',
  HAS_NOTIFICATION = 'has_notification',
  INTEGRATION = 'integration',
  MAXIMUM_API_RATE_LIMIT = 'maximum_api_rate_limit',
  MESSAGE_COUNT = 'message_count',
  NOTIFICATION_TEMPLATE = 'notification_template',
  SERVICE_CONFIG = 'service_config',
  SUBSCRIBER = 'subscriber',
  SUBSCRIBER_DEDUP = 'subscriber_deduplication',
  SUBSCRIBER_TOPICS = 'subscriber_topics',
  SUBSCRIPTION = 'subscription',
  USAGE = 'usage',
  USER = 'user',
  WORKFLOW_VARIABLES = 'workflow_variables',
}

/**
 * The type of cache key. This is used to differentiate between different types of cache keys.
 * Add an entry to this enum when you have a new type of cache key.
 */
export enum CacheKeyTypeEnum {
  ENTITY = 'entity',
  QUERY = 'query',
}

/**
 * Add an entry to this enum when you have a new entity that has it's own unique identifier.
 */
export enum IdentifierPrefixEnum {
  ID = 'i',
  SUBSCRIBER_ID = 's',
  TEMPLATE_IDENTIFIER = 't_i',
  API_KEY = 'a_k',
  GROUPED_BLUEPRINT = 'g_b',
  API_RATE_LIMIT_CATEGORY = 'a_r_l_c',
  SERVICE_CONFIG = 's_c',
  RESOURCE_TYPE = 'r_t',
}

/**
 * Add an entry to this enum when you have a new service config that needs to be cached.
 */
export enum ServiceConfigIdentifierEnum {
  API_RATE_LIMIT_SERVICE_MAXIMUM = 'api_rate_limit_service_maximum',
}

/**
 * The list of prefixes aligned to top-level Novu domains.
 * This is used to scope cache keys to a specific environment or organization.
 */
export enum OrgScopePrefixEnum {
  ENVIRONMENT_ID = 'e',
  ORGANIZATION_ID = 'o',
}

/**
 * The identifier for the blueprint used to group entities by category.
 */
export const BLUEPRINT_IDENTIFIER = 'blueprints/group-by-category';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  enum
- export  enum
- export  enum
- export  enum
- export  enum
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/index.ts
Tamaño: 86 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './entities';
export * from './identifiers';
export * from './queries';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/queries.spec.ts
Tamaño: 2165 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CacheKeyPrefixEnum, CacheKeyTypeEnum, QUERY_PREFIX } from './identifiers';
import { buildFeedKey, buildMessageCountKey } from './queries';

describe('Key builder for queries', () => {
  describe('buildFeedKey', () => {
    it('should return the correct cache key for GetNotificationsFeedCommand', () => {
      const command = {
        environmentId: 'env123',
        subscriberId: 'sub456',
        someOtherParam: 'value',
      };
      const expectedKey = `{${CacheKeyTypeEnum.QUERY}:${CacheKeyPrefixEnum.FEED}:e=${command.environmentId}:s=${
        command.subscriberId
      }}:${QUERY_PREFIX}=${JSON.stringify(command)}`;
      expect(buildFeedKey().cache(command)).toEqual(expectedKey);
    });

    it('should return the correct invalidation key', () => {
      const subscriberId = 'sub789';
      const environmentId = 'env456';
      const expectedKey = `{${CacheKeyTypeEnum.QUERY}:${CacheKeyPrefixEnum.FEED}:e=${environmentId}:s=${subscriberId}}`;
      expect(
        buildFeedKey().invalidate({
          subscriberId,
          _environmentId: environmentId,
        })
      ).toEqual(expectedKey);
    });
  });

  describe('buildMessageCountKey', () => {
    it('should return the correct cache key for GetNotificationsFeedCommand', () => {
      const command = {
        environmentId: 'env123',
        subscriberId: 'sub456',
        someOtherParam: 'value',
      };

      const expectedKey = `{${CacheKeyTypeEnum.QUERY}:${
        CacheKeyPrefixEnum.MESSAGE_COUNT
      }:e=${command.environmentId}:s=${command.subscriberId}}:${QUERY_PREFIX}=${JSON.stringify(command)}`;
      expect(buildMessageCountKey().cache(command)).toEqual(expectedKey);
    });

    it('should return the correct invalidation key for GetFeedCountCommand', () => {
      const subscriberId = 'sub789';
      const environmentId = 'env456';
      const expectedKey = `{${CacheKeyTypeEnum.QUERY}:${CacheKeyPrefixEnum.MESSAGE_COUNT}:e=${environmentId}:s=${subscriberId}}`;
      expect(
        buildMessageCountKey().invalidate({
          subscriberId,
          _environmentId: environmentId,
        })
      ).toEqual(expectedKey);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - s(${subscriberId}}`;
      expect(
        buildFeedKey().invalidate({
          subscriberId,
       ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cache/key-builders/queries.ts
Tamaño: 3654 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { buildEnvironmentScopedKeyById, buildOrganizationScopedKey } from './builder.scoped';
import { CacheKeyPrefixEnum, CacheKeyTypeEnum, IdentifierPrefixEnum, QUERY_PREFIX } from './identifiers';

export const buildFeedKey = () => {
  const cache = (
    command: Record<string, unknown> & {
      environmentId: string;
      subscriberId: string;
    }
  ): string =>
    buildQueryKey({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.FEED,
      environmentId: command.environmentId,
      identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
      identifier: command.subscriberId,
      query: command,
    });

  const invalidate = ({ subscriberId, _environmentId }: { subscriberId: string; _environmentId: string }): string =>
    buildEnvironmentScopedKeyById({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.FEED,
      environmentId: _environmentId,
      identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
      identifier: subscriberId,
    });

  return {
    cache,
    invalidate,
  };
};

export const buildMessageCountKey = () => {
  const cache = (
    command: Record<string, unknown> & {
      environmentId: string;
      subscriberId: string;
    }
  ): string =>
    buildQueryKey({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.MESSAGE_COUNT,
      environmentId: command.environmentId,
      identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
      identifier: command.subscriberId,
      query: command,
    });

  const invalidate = ({ subscriberId, _environmentId }: { subscriberId: string; _environmentId: string }): string =>
    buildEnvironmentScopedKeyById({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.MESSAGE_COUNT,
      environmentId: _environmentId,
      identifierPrefix: IdentifierPrefixEnum.SUBSCRIBER_ID,
      identifier: subscriberId,
    });

  return {
    cache,
    invalidate,
  };
};

export const buildIntegrationKey = () => {
  const cache = (command: Record<string, unknown> & { _organizationId: string }): string =>
    buildQueryByOrganizationKey({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.INTEGRATION,
      organizationId: command._organizationId,
      query: command,
    });

  const invalidate = ({ _organizationId }: { _organizationId: string }): string =>
    buildOrganizationScopedKey({
      type: CacheKeyTypeEnum.QUERY,
      keyEntity: CacheKeyPrefixEnum.INTEGRATION,
      organizationId: _organizationId,
    });

  return {
    cache,
    invalidate,
  };
};

export const buildQueryKey = ({
  type,
  keyEntity,
  environmentId,
  identifierPrefix = IdentifierPrefixEnum.ID,
  identifier,
  query,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  environmentId: string;
  identifierPrefix?: IdentifierPrefixEnum;
  identifier: string;
  query: Record<string, unknown>;
}): string =>
  `${buildEnvironmentScopedKeyById({
    type,
    keyEntity,
    environmentId,
    identifierPrefix,
    identifier,
  })}:${QUERY_PREFIX}=${JSON.stringify(query)}`;

export const buildQueryByOrganizationKey = ({
  type,
  keyEntity,
  organizationId,
  query,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKeyPrefixEnum;
  organizationId: string;
  query: Record<string, unknown>;
}): string =>
  `${buildOrganizationScopedKey({
    type,
    keyEntity,
    organizationId,
  })}:${QUERY_PREFIX}=${JSON.stringify(query)}`;

export interface IBuildNotificationTemplateByIdentifier {
  _environmentId: string;
  identifiers: ({ id: string } & { triggerIdentifier?: string }) | ({ id?: string } & { triggerIdentifier: string });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildFeedKey())
 - cache(command: Record<string, unknown> & {
      environmentId: string;
      subscriberId: string;
    }
...)
 - invalidate({ subscriberId, _environmentId }: { subscriberId: string; _environmentId: string }): string)
 - buildMessageCountKey())
 - cache(command: Record<string, unknown> & {
      environmentId: string;
      subscriberId: string;
    }
...)
 - invalidate({ subscriberId, _environmentId }: { subscriberId: string; _environmentId: string }): string)
 - buildIntegrationKey())
 - cache(command: Record<string, unknown> & { _organizationId: string }): string)
 - invalidate({ _organizationId }: { _organizationId: string }): string)
 - identifierPrefix(IdentifierPrefixEnum.ID,
  identifier,
  query,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheKey...)
 - buildQueryByOrganizationKey({
  type,
  keyEntity,
  organizationId,
  query,
}: {
  type: CacheKeyTypeEnum;
  keyEntity: CacheK...)
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/calculate-delay/compute-job-wait-duration.service.spec.ts
Tamaño: 5377 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DelayTypeEnum, DigestUnitEnum } from '@novu/shared';
import { addSeconds } from 'date-fns';
import { ComputeJobWaitDurationService } from './compute-job-wait-duration.service';

describe('Compute Job Wait Duration Service', () => {
  const computeJobWaitDurationService = new ComputeJobWaitDurationService();

  describe('toMilliseconds', () => {
    it('should convert seconds to milliseconds', () => {
      const result = (computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.SECONDS);
      expect(result).toEqual(5000);
    });

    it('should convert minutes to milliseconds', () => {
      const result = (computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.MINUTES);
      expect(result).toEqual(300000);
    });

    it('should convert hours to milliseconds', () => {
      const result = (computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.HOURS);
      expect(result).toEqual(18000000);
    });

    it('should convert days to milliseconds', () => {
      const result = (computeJobWaitDurationService as any).toMilliseconds(1, DigestUnitEnum.DAYS);
      expect(result).toEqual(86400000);
    });
  });

  describe('calculateDelay - Dynamic Delay', () => {
    it('should calculate delay from ISO-8601 timestamp in payload', () => {
      const futureTime = addSeconds(new Date(), 10);
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.scheduledTime',
      } as const;
      const payload = {
        scheduledTime: futureTime.toISOString(),
      };

      const delay = computeJobWaitDurationService.calculateDelay({
        stepMetadata,
        payload,
        overrides: {},
      });

      expect(delay).toBeGreaterThan(9000);
      expect(delay).toBeLessThan(11000);
    });

    it('should calculate delay from duration object in payload', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.delayWindow',
      } as const;
      const payload = {
        delayWindow: {
          amount: 5,
          unit: 'minutes',
        },
      };

      const delay = computeJobWaitDurationService.calculateDelay({
        stepMetadata,
        payload,
        overrides: {},
      });

      expect(delay).toEqual(300000);
    });

    it('should throw error when dynamic key is not found in payload', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.missingKey',
      } as const;
      const payload = {
        otherField: 'value',
      };

      expect(() => {
        computeJobWaitDurationService.calculateDelay({
          stepMetadata,
          payload,
          overrides: {},
        });
      }).toThrow('not found in payload');
    });

    it('should throw error when timestamp is in the past', () => {
      const pastTime = addSeconds(new Date(), -10);
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.scheduledTime',
      } as const;
      const payload = {
        scheduledTime: pastTime.toISOString(),
      };

      expect(() => {
        computeJobWaitDurationService.calculateDelay({
          stepMetadata,
          payload,
          overrides: {},
        });
      }).toThrow('must be a future date');
    });

    it('should throw error for invalid timestamp format', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.scheduledTime',
      } as const;
      const payload = {
        scheduledTime: 'invalid-timestamp',
      };

      expect(() => {
        computeJobWaitDurationService.calculateDelay({
          stepMetadata,
          payload,
          overrides: {},
        });
      }).toThrow('not a valid format');
    });

    it('should throw error for invalid duration object', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.delayWindow',
      } as const;
      const payload = {
        delayWindow: {
          amount: 5,
          unit: 'invalid-unit',
        },
      };

      expect(() => {
        computeJobWaitDurationService.calculateDelay({
          stepMetadata,
          payload,
          overrides: {},
        });
      }).toThrow('Invalid time unit');
    });

    it('should throw error for negative amount in duration object', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.delayWindow',
      } as const;
      const payload = {
        delayWindow: {
          amount: -5,
          unit: 'minutes',
        },
      };

      expect(() => {
        computeJobWaitDurationService.calculateDelay({
          stepMetadata,
          payload,
          overrides: {},
        });
      }).toThrow('Invalid amount');
    });

    it('should support nested payload keys', () => {
      const stepMetadata = {
        type: DelayTypeEnum.DYNAMIC,
        dynamicKey: 'payload.config.delaySettings',
      } as const;
      const payload = {
        config: {
          delaySettings: {
            amount: 3,
            unit: 'hours',
          },
        },
      };

      const delay = computeJobWaitDurationService.calculateDelay({
        stepMetadata,
        payload,
        overrides: {},
      });

      expect(delay).toEqual(10800000);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - computeJobWaitDurationService(new ComputeJobWaitDurationService();

  describe('toMilliseconds', ())
 - result(computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.SECONDS);
      expect(result...)
 - result(computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.MINUTES);
      expect(result...)
 - result(computeJobWaitDurationService as any).toMilliseconds(5, DigestUnitEnum.HOURS);
      expect(result)....)
 - result(computeJobWaitDurationService as any).toMilliseconds(1, DigestUnitEnum.DAYS);
      expect(result).t...)
 - delay(computeJobWaitDurationService.calculateDelay({
        stepMetadata,
        payload,
        overri...)
 - delay(computeJobWaitDurationService.calculateDelay({
        stepMetadata,
        payload,
        overri...)
 - payload({
        otherField: 'value',
      };

      expect(())
 - payload({
        scheduledTime: pastTime.toISOString(),
      };

      expect(())
 - payload({
        scheduledTime: 'invalid-timestamp',
      };

      expect(())
 - payload({
        delayWindow: {
          amount: 5,
          unit: 'invalid-unit',
        },
      };

 ...)
 - payload({
        delayWindow: {
          amount: -5,
          unit: 'minutes',
        },
      };

     ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/calculate-delay/compute-job-wait-duration.service.ts
Tamaño: 5561 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Logger } from '@nestjs/common';
import {
  DelayTypeEnum,
  DigestTypeEnum,
  DigestUnitEnum,
  IDelayDynamicMetadata,
  IDelayRegularMetadata,
  IDelayScheduledMetadata,
  IDigestRegularMetadata,
  IDigestTimedMetadata,
  IWorkflowStepMetadata,
} from '@novu/shared';
import { differenceInMilliseconds } from 'date-fns';
import { getNestedValue } from '../../utils';
import { isRegularDigest } from '../../utils/digest';
import { DurationUtils } from '../../utils/duration-utils';
import { TimedDigestDelayService } from './timed-digest-delay.service';

export class ComputeJobWaitDurationService {
  calculateDelay({
    stepMetadata,
    payload,
    overrides,
    timezone,
  }: {
    stepMetadata?: IWorkflowStepMetadata;
    payload: any;
    overrides: any;
    timezone?: string;
  }): number {
    if (!stepMetadata) {
      throw new BadRequestException(`Step metadata not found`);
    }

    const digestType = 'type' in stepMetadata ? stepMetadata.type : null;

    if (digestType === DelayTypeEnum.SCHEDULED) {
      const { delayPath } = stepMetadata as IDelayScheduledMetadata;
      if (!delayPath) throw new BadRequestException(`Delay path not found`);

      const delayDate = payload[delayPath];
      const delay = differenceInMilliseconds(new Date(delayDate), new Date());

      if (delay < 0) {
        throw new BadRequestException({
          message: `Delay date at path must be a future date`,
          delayPath,
        });
      }

      return delay;
    } else if (digestType === DelayTypeEnum.DYNAMIC) {
      const { dynamicKey } = stepMetadata as IDelayDynamicMetadata;
      if (!dynamicKey) throw new BadRequestException(`Dynamic delay key not found`);

      const value = getNestedValue({ payload }, dynamicKey);

      if (!value) {
        throw new BadRequestException(`Dynamic delay key '${dynamicKey}' not found in payload`);
      }

      if (typeof value === 'string' && DurationUtils.isISO8601(value)) {
        const targetTime = new Date(value).getTime();
        const now = Date.now();
        const delay = targetTime - now;

        if (delay < 0) {
          throw new BadRequestException(`Dynamic delay timestamp '${value}' must be a future date`);
        }

        return delay;
      }

      if (typeof value === 'object' && value !== null && 'unit' in value && 'amount' in value) {
        const durationObj = value as { unit: string; amount: number };

        if (typeof durationObj.amount !== 'number' || durationObj.amount < 0) {
          throw new BadRequestException(`Invalid amount '${durationObj.amount}' in dynamic delay`);
        }

        try {
          return DurationUtils.convertToMilliseconds(durationObj.amount, durationObj.unit);
        } catch {
          throw new BadRequestException(`Invalid time unit '${durationObj.unit}' in dynamic delay`);
        }
      }

      throw new BadRequestException(
        `Dynamic delay value '${JSON.stringify(value)}' is not a valid format. Expected ISO-8601 timestamp or duration object { amount: number, unit: string }`
      );
    } else if (
      digestType &&
      (digestType === DigestTypeEnum.REGULAR ||
        digestType === DigestTypeEnum.BACKOFF ||
        digestType === DelayTypeEnum.REGULAR) &&
      isRegularDigest(digestType)
    ) {
      if (this.isValidDelayOverride(overrides)) {
        return this.toMilliseconds(overrides.delay.amount as number, overrides.delay.unit as DigestUnitEnum);
      }

      const regularDigestMeta = stepMetadata as IDigestRegularMetadata;

      return this.toMilliseconds(regularDigestMeta.amount, regularDigestMeta.unit);
    } else if (digestType === DigestTypeEnum.TIMED) {
      const timedDigestMeta = stepMetadata as IDigestTimedMetadata;

      return TimedDigestDelayService.calculate({
        unit: timedDigestMeta.unit,
        amount: timedDigestMeta.amount,
        timeConfig: {
          ...timedDigestMeta.timed,
        },
        timezone,
      });
    } else if ((stepMetadata as IDelayRegularMetadata)?.unit && (stepMetadata as IDelayRegularMetadata)?.amount) {
      if (this.isValidDelayOverride(overrides)) {
        return this.toMilliseconds(overrides.delay.amount as number, overrides.delay.unit as DigestUnitEnum);
      }

      const regularDigestMeta = stepMetadata as IDelayRegularMetadata;

      return this.toMilliseconds(regularDigestMeta.amount, regularDigestMeta.unit);
    }

    return 0;
  }

  private toMilliseconds(amount: number, unit: DigestUnitEnum): number {
    Logger.debug(`Amount is: ${amount}`);
    Logger.debug(`Unit is: ${unit}`);
    Logger.verbose('Converting to milliseconds');

    let delay = 1000 * amount;
    if (unit === DigestUnitEnum.MONTHS) {
      delay *= 60 * 60 * 24 * 30;
    }
    if (unit === DigestUnitEnum.WEEKS) {
      delay *= 60 * 60 * 24 * 7;
    }
    if (unit === DigestUnitEnum.DAYS) {
      delay *= 60 * 60 * 24;
    }
    if (unit === DigestUnitEnum.HOURS) {
      delay *= 60 * 60;
    }
    if (unit === DigestUnitEnum.MINUTES) {
      delay *= 60;
    }

    Logger.verbose(`Amount of delay is: ${delay}ms.`);

    return delay;
  }

  private isValidDelayOverride(overrides: any): boolean {
    if (!overrides?.delay) {
      return false;
    }

    const isDelayAmountANumber = typeof overrides.delay.amount === 'number';
    const digestUnits = Object.values(DigestUnitEnum);
    const includesValidDelayUnit = digestUnits.includes(overrides.delay.unit as unknown as DigestUnitEnum);

    return isDelayAmountANumber && includesValidDelayUnit;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ComputeJobWaitDurationService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/calculate-delay/index.ts
Tamaño: 53 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './compute-job-wait-duration.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/calculate-delay/timed-digest-delay.service.spec.ts
Tamaño: 14788 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DaysEnum, DigestUnitEnum, MonthlyTypeEnum, OrdinalEnum, OrdinalValueEnum } from '@novu/shared';
import { differenceInMilliseconds } from 'date-fns';

import { TimedDigestDelayService } from './timed-digest-delay.service';

describe('TimedDigestDelayService', () => {
  describe('calculate', () => {
    let clock: typeof jest;

    beforeEach(() => {
      const date = new Date('2023-05-04T12:00:00Z');
      clock = jest.useFakeTimers('modern' as FakeTimersConfig);
      clock.setSystemTime(date.getTime());
    });

    afterEach(() => {
      clock.clearAllTimers();
    });

    describe('minutely schedule', () => {
      it('delay timeout for next minute', () => {
        const result = TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.MINUTES,
          amount: 1,
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-04T12:01:00Z'), new Date()));
      });

      it('delay timeout for next 7 minutes', () => {
        const result = TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.MINUTES,
          amount: 7,
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-04T12:07:00Z'), new Date()));
      });
    });

    describe('hourly schedule', () => {
      it('delay timeout for next hour', () => {
        const result = TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.HOURS,
          amount: 1,
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-04T13:00:00Z'), new Date()));
      });

      it('delay timeout for next 10 hours', () => {
        const result = TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.HOURS,
          amount: 10,
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-04T22:00:00Z'), new Date()));
      });
    });

    describe('daily schedule', () => {
      it('delay timeout for next day', () => {
        const dateStart = new Date();
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.DAYS,
          amount: 1,
          timeConfig: {
            atTime: '01:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-05T01:00:00.000Z'), new Date()));
      });

      it('delay timeout for next 4 days', () => {
        const dateStart = new Date();
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.DAYS,
          amount: 4,
          timeConfig: {
            atTime: '01:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-08T01:00:00.000Z'), new Date()));
      });
    });

    describe('weekly schedule', () => {
      it('delay timeout for next weekly when days are not specified', () => {
        const dateStart = new Date('2023-05-04T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
          amount: 2,
          timeConfig: {
            atTime: '09:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-04T09:00:00.000Z'), new Date()));
      });

      it('delay timeout for next weekly when the time is after the "at time"', () => {
        const dateStart = new Date('2023-05-04T10:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
          amount: 2,
          timeConfig: {
            atTime: '09:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-18T09:00:00.000Z'), new Date()));
      });

      it('delay timeout for next scheduled weekly on monday', () => {
        const dateStart = new Date('2023-05-01T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
          amount: 2,
          timeConfig: {
            atTime: '09:00:00',
            weekDays: [DaysEnum.MONDAY, DaysEnum.WEDNESDAY],
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-01T09:00:00.000Z'), new Date()));
      });

      it('delay timeout for next scheduled weekly on wednesday', () => {
        const dateStart = new Date('2023-05-02T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
          amount: 2,
          timeConfig: {
            atTime: '09:00:00',
            weekDays: [DaysEnum.MONDAY, DaysEnum.WEDNESDAY],
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-03T09:00:00.000Z'), new Date()));
      });
    });

    describe('monthly schedule', () => {
      it('delay timeout for next month when month days are not provided', () => {
        const dateStart = new Date('2023-05-03T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
          amount: 3,
          timeConfig: {
            atTime: '12:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-03T12:00:00.000Z'), new Date()));
      });

      it('delay timeout for next month when the time is after the "at time"', () => {
        const dateStart = new Date('2023-05-03T13:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
          amount: 3,
          timeConfig: {
            atTime: '12:00:00',
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-08-03T12:00:00.000Z'), new Date()));
      });

      it('delay timeout for next month first day', () => {
        const dateStart = new Date('2023-05-01T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
          amount: 3,
          timeConfig: {
            atTime: '12:00:00',
            monthDays: [1, 15],
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-01T12:00:00.000Z'), new Date()));
      });

      it('delay timeout for next month fifteenth day', () => {
        const dateStart = new Date('2023-05-03T00:00:00.000Z');
        const result = TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
          amount: 3,
          timeConfig: {
            atTime: '12:00:00',
            monthDays: [1, 15],
          },
        });

        expect(result).toEqual(differenceInMilliseconds(new Date('2023-05-15T12:00:00.000Z'), new Date()));
      });

      describe('with "on the" fields', () => {
        describe('ordinal value "day"', () => {
          it('delay timeout for the first day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.FIRST,
                ordinalValue: OrdinalValueEnum.DAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-01T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the second day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.SECOND,
                ordinalValue: OrdinalValueEnum.DAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-02T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the last day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.LAST,
                ordinalValue: OrdinalValueEnum.DAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-30T12:00:00.000Z'), new Date()));
          });
        });

        describe('ordinal value "weekday"', () => {
          it('delay timeout for the first weekday of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.FIRST,
                ordinalValue: OrdinalValueEnum.WEEKDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-07-03T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the second weekday of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.SECOND,
                ordinalValue: OrdinalValueEnum.WEEKDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-07-04T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the last weekday of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.LAST,
                ordinalValue: OrdinalValueEnum.WEEKDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-07-31T12:00:00.000Z'), new Date()));
          });
        });

        describe('ordinal value "weekend day"', () => {
          it('delay timeout for the first weekend day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.FIRST,
                ordinalValue: OrdinalValueEnum.WEEKEND,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-03T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the second weekend day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.SECOND,
                ordinalValue: OrdinalValueEnum.WEEKEND,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-04T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the last weekend day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.LAST,
                ordinalValue: OrdinalValueEnum.WEEKEND,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-25T12:00:00.000Z'), new Date()));
          });
        });

        describe('ordinal value "specific week day"', () => {
          it('delay timeout for the first wednesday of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.FIRST,
                ordinalValue: OrdinalValueEnum.WEDNESDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-07T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the second sunday of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.SECOND,
                ordinalValue: OrdinalValueEnum.SUNDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-11T12:00:00.000Z'), new Date()));
          });

          it('delay timeout for the last weekend day of the month', () => {
            const result = TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
              unit: DigestUnitEnum.MONTHS,
              amount: 1,
              timeConfig: {
                atTime: '12:00:00',
                ordinal: OrdinalEnum.LAST,
                ordinalValue: OrdinalValueEnum.SATURDAY,
                monthlyType: MonthlyTypeEnum.ON,
              },
            });

            expect(result).toEqual(differenceInMilliseconds(new Date('2023-06-24T12:00:00.000Z'), new Date()));
          });
        });
      });
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - clock(jest.useFakeTimers('modern' as FakeTimersConfig);
      clock.setSystemTime(date.getTime());
    });...)
 - result(TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.MINUTES,
          amount: 1,
   ...)
 - result(TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.MINUTES,
          amount: 7,
   ...)
 - result(TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.HOURS,
          amount: 1,
     ...)
 - result(TimedDigestDelayService.calculate({
          unit: DigestUnitEnum.HOURS,
          amount: 10,
    ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.DAYS,
      ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.DAYS,
      ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
     ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
     ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
     ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.WEEKS,
     ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
    ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
    ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
    ...)
 - result(TimedDigestDelayService.calculate({
          dateStart,
          unit: DigestUnitEnum.MONTHS,
    ...)
 - result(TimedDigestDelayService.calculate({
              unit: DigestUnitEnum.MONTHS,
              amount:...)
 - result(TimedDigestDelayService.calculate({
              unit: DigestUnitEnum.MONTHS,
              amount:...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-07-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)
 - result(TimedDigestDelayService.calculate({
              dateStart: new Date('2023-06-01T12:00:00.000Z'),
 ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/calculate-delay/timed-digest-delay.service.ts
Tamaño: 5397 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

// cSpell:ignore RRULE, BYSETPOS, BYMONTHDAY, bysetpos, byweekday, bymonthday, byhour, byminute, bysecond, dtstart

import { DaysEnum, DigestUnitEnum, ITimedConfig, MonthlyTypeEnum, OrdinalEnum, OrdinalValueEnum } from '@novu/shared';
import { addDays, addHours, addMinutes, addMonths, addWeeks, differenceInMilliseconds } from 'date-fns';
import { fromZonedTime, toZonedTime } from 'date-fns-tz';
import { Frequency, RRule, Weekday } from 'rrule';

const UNIT_TO_RRULE_FREQUENCY = {
  [DigestUnitEnum.MINUTES]: Frequency.MINUTELY,
  [DigestUnitEnum.HOURS]: Frequency.HOURLY,
  [DigestUnitEnum.DAYS]: Frequency.DAILY,
  [DigestUnitEnum.WEEKS]: Frequency.WEEKLY,
  [DigestUnitEnum.MONTHS]: Frequency.MONTHLY,
};

const DAY_OF_WEEK_TO_RRULE_DAY = {
  [DaysEnum.MONDAY]: RRule.MO,
  [DaysEnum.TUESDAY]: RRule.TU,
  [DaysEnum.WEDNESDAY]: RRule.WE,
  [DaysEnum.THURSDAY]: RRule.TH,
  [DaysEnum.FRIDAY]: RRule.FR,
  [DaysEnum.SATURDAY]: RRule.SA,
  [DaysEnum.SUNDAY]: RRule.SU,
};

const ORDINAL_TO_RRULE_BYSETPOS = {
  [OrdinalEnum.FIRST]: 1,
  [OrdinalEnum.SECOND]: 2,
  [OrdinalEnum.THIRD]: 3,
  [OrdinalEnum.FOURTH]: 4,
  [OrdinalEnum.FIFTH]: 5,
  [OrdinalEnum.LAST]: -1,
};

const ORDINAL_VALUE_TO_RRULE_RRULE_DAY = {
  [OrdinalValueEnum.MONDAY]: RRule.MO,
  [OrdinalValueEnum.TUESDAY]: RRule.TU,
  [OrdinalValueEnum.WEDNESDAY]: RRule.WE,
  [OrdinalValueEnum.THURSDAY]: RRule.TH,
  [OrdinalValueEnum.FRIDAY]: RRule.FR,
  [OrdinalValueEnum.SATURDAY]: RRule.SA,
  [OrdinalValueEnum.SUNDAY]: RRule.SU,
};

const ORDINAL_TO_RRULE_BYMONTHDAY = {
  [OrdinalEnum.FIRST]: 1,
  [OrdinalEnum.SECOND]: 2,
  [OrdinalEnum.THIRD]: 3,
  [OrdinalEnum.FOURTH]: 4,
  [OrdinalEnum.FIFTH]: 5,
  [OrdinalEnum.LAST]: -1,
};

interface ICalculateArgs {
  dateStart?: Date;
  unit: DigestUnitEnum;
  amount: number;
  timeConfig?: ITimedConfig;
  timezone?: string;
}

export class TimedDigestDelayService {
  /**
   * Calculates the delay time in milliseconds between the time for the next schedule and current time
   * @returns the delay time in milliseconds
   */
  public static calculate({
    dateStart = new Date(),
    unit = DigestUnitEnum.MINUTES,
    amount,
    timeConfig: { atTime, weekDays, monthDays, monthlyType = MonthlyTypeEnum.EACH, ordinal, ordinalValue } = {},
    timezone,
  }: ICalculateArgs): number {
    const [hours, minutes, seconds] = atTime ? atTime.split(':').map((part) => parseInt(part, 10)) : [];
    const dateStartTz = timezone ? toZonedTime(dateStart, timezone) : dateStart;
    const currentTimeTz = timezone ? toZonedTime(new Date(), timezone) : new Date();

    const { bysetpos, byweekday, bymonthday } = TimedDigestDelayService.calculateByFields({
      weekDays,
      monthDays,
      monthlyType,
      ordinal,
      ordinalValue,
    });

    const rule = new RRule({
      dtstart: dateStartTz,
      until: TimedDigestDelayService.getUntilDate(dateStartTz, unit, amount, timezone),
      freq: UNIT_TO_RRULE_FREQUENCY[unit],
      interval: amount,
      bysetpos,
      byweekday,
      bymonthday,
      byhour: hours,
      byminute: minutes,
      bysecond: seconds,
    });

    const next = rule.after(dateStartTz);

    if (next === null) {
      throw new Error('Delay for next digest could not be calculated');
    }

    const nextUtc = timezone ? fromZonedTime(next, timezone) : next;
    const currentUtc = timezone ? fromZonedTime(currentTimeTz, timezone) : currentTimeTz;

    return differenceInMilliseconds(nextUtc, currentUtc);
  }

  private static calculateByFields({ weekDays, monthDays, monthlyType, ordinal, ordinalValue }: ITimedConfig) {
    let byweekday: Weekday[] | undefined;
    let bymonthday: number | number[] | undefined;

    if (monthlyType === MonthlyTypeEnum.EACH) {
      byweekday = weekDays?.map((el) => DAY_OF_WEEK_TO_RRULE_DAY[el]);
      bymonthday = monthDays;

      return { byweekday, bymonthday };
    }

    switch (ordinalValue) {
      case OrdinalValueEnum.DAY: {
        return { bymonthday: ORDINAL_TO_RRULE_BYMONTHDAY[ordinal] };
      }
      case OrdinalValueEnum.WEEKDAY: {
        return {
          bysetpos: ORDINAL_TO_RRULE_BYSETPOS[ordinal],
          byweekday: [RRule.MO, RRule.TU, RRule.WE, RRule.TH, RRule.FR],
        };
      }
      case OrdinalValueEnum.WEEKEND: {
        return {
          bysetpos: ORDINAL_TO_RRULE_BYSETPOS[ordinal],
          byweekday: [RRule.SA, RRule.SU],
        };
      }
      default: {
        return {
          bysetpos: ORDINAL_TO_RRULE_BYSETPOS[ordinal],
          byweekday: ORDINAL_VALUE_TO_RRULE_RRULE_DAY[ordinalValue],
        };
      }
    }
  }

  private static getUntilDate(dateStart: Date, unit: DigestUnitEnum, amount: number, timezone?: string): Date {
    let untilDate: Date;

    switch (unit) {
      case DigestUnitEnum.MINUTES:
        untilDate = addMinutes(dateStart, amount);
        break;
      case DigestUnitEnum.HOURS:
        untilDate = addHours(dateStart, amount);
        break;
      case DigestUnitEnum.DAYS:
        untilDate = addDays(dateStart, amount);
        break;
      case DigestUnitEnum.WEEKS:
        untilDate = addWeeks(dateStart, amount);
        break;
      case DigestUnitEnum.MONTHS:
        untilDate = addMonths(dateStart, amount);
        break;
      default:
        untilDate = addMonths(dateStart, amount);
        break;
    }

    return timezone ? fromZonedTime(untilDate, timezone) : untilDate;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - byweekday(weekDays?.map((el))
Declaraciones 'export' encontradas:
- export class TimedDigestDelayService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cron/agenda-cron.service.ts
Tamaño: 1760 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Agenda } from '@hokify/agenda';
import { JobCronNameEnum } from '@novu/shared';
import { MetricsService } from '../metrics';
import { CronService } from './cron.service';
import { CronJobProcessor, CronMetrics, CronOptions } from './cron.types';

export class AgendaCronService extends CronService {
  cronServiceName = 'AgendaCronService';

  constructor(
    metricsService: MetricsService,
    activeJobs: JobCronNameEnum[],
    private agenda: Agenda
  ) {
    super(metricsService, activeJobs);
  }

  protected async addJob<TData>(
    jobName: JobCronNameEnum,
    processor: CronJobProcessor<TData>,
    interval: string,
    options: CronOptions
  ) {
    this.agenda.define(
      jobName,
      async (job) => {
        await processor({
          name: jobName,
          startedAt: job.attrs.lastRunAt,
          data: job.attrs.data as TData,
        });
      },
      {
        lockLifetime: options.lockLifetime,
        lockLimit: options.lockLimit,
        concurrency: options.concurrency,
        priority: options.priority,
      }
    );

    await this.agenda.every(interval, jobName, {
      timezone: options.timezone,
    });
  }

  protected async removeJob(jobName: string) {
    await this.agenda.cancel({ name: jobName });
  }

  protected async initialize() {
    await this.agenda.start();
  }

  protected async shutdown() {
    await this.agenda.stop();
  }

  protected async getMetrics() {
    const stats = await this.agenda.getRunningStats();

    const metrics = Object.entries(stats.jobStatus).reduce((acc, [jobName, status]) => {
      acc[jobName] = {
        active: status.running ?? 0,
        waiting: status.locked ?? 0,
      };

      return acc;
    }, {} as CronMetrics);

    return metrics;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - cronServiceName('AgendaCronService';

  constructor(
    metricsService: MetricsService,
    activeJobs: JobCronName...)
 - metrics(Object.entries(stats.jobStatus).reduce((acc, [jobName, status]))
Declaraciones 'export' encontradas:
- export class AgendaCronService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cron/cron.constants.ts
Tamaño: 58 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const ACTIVE_CRON_JOBS_TOKEN = 'ACTIVE_CRON_JOBS';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cron/cron.service.ts
Tamaño: 8593 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger, OnApplicationBootstrap, OnApplicationShutdown } from '@nestjs/common';
import {
  CronExpressionEnum,
  JobCronNameEnum,
  ObservabilityBackgroundTransactionEnum,
  TimezoneEnum,
} from '@novu/shared';
import { captureException } from '@sentry/node';
import { MetricsService } from '../metrics';
import { CronJobData, CronJobProcessor, CronMetrics, CronMetricsEventEnum, CronOptions } from './cron.types';

const nr = require('newrelic');

const LOG_CONTEXT = 'CronService';
const DEFAULT_CRON_OPTIONS: CronOptions = {
  lockLimit: 1,
  lockLifetime: 10000,
  priority: 0,
  concurrency: 1,
  timezone: TimezoneEnum.ETC_UTC,
};
const CRON_STARTUP_TIMEOUT = 2000; // 2 seconds in milliseconds
const CRON_STARTUP_RETRIES = 3;

const METRICS_CRON_INTERVAL = CronExpressionEnum.EVERY_10_SECONDS;
const METRICS_JOB_NAME = JobCronNameEnum.SEND_CRON_METRICS;
const METRICS_JOB_CONCURRENCY = 1;
const METRICS_JOB_LOCK_LIFETIME = 1 * 60 * 1000; // 1 minute in milliseconds

@Injectable()
export abstract class CronService implements OnApplicationBootstrap, OnApplicationShutdown {
  private deploymentName = process.env.FLEET_NAME ?? 'default';
  protected abstract cronServiceName: string;

  constructor(
    private metricsService: MetricsService,
    private activeJobs: JobCronNameEnum[]
  ) {}

  protected abstract addJob<TData = unknown>(
    jobName: JobCronNameEnum,
    processor: CronJobProcessor<TData>,
    interval: string,
    options: CronOptions
  ): Promise<void>;

  protected abstract removeJob(jobName: JobCronNameEnum): Promise<void>;

  protected abstract getMetrics(): Promise<CronMetrics>;

  protected abstract initialize(): Promise<void>;

  protected abstract shutdown(): Promise<void>;

  /**
   * This method is called when the application has fully started up.
   * It ensures that all relevant jobs are added to the CRON service before starting up.
   */
  async onApplicationBootstrap() {
    if (!this.activeJobs || this.activeJobs.length === 0) {
      Logger.verbose(
        `The '${this.cronServiceName}' CRON service has no active jobs and will not start up`,
        LOG_CONTEXT
      );

      return;
    } else {
      Logger.log(`Active CRON jobs found for ${this.cronServiceName}: [${this.activeJobs.join(', ')}]`, LOG_CONTEXT);
    }

    try {
      Logger.log(`Starting the '${this.cronServiceName}' CRON service up`, LOG_CONTEXT);
      let retries = CRON_STARTUP_RETRIES;
      const createTimeoutPromise = () =>
        new Promise((resolve, reject) => {
          setTimeout(
            () => reject(`Timed out while starting the ${this.cronServiceName} CRON service`),
            CRON_STARTUP_TIMEOUT
          );
        });

      while (retries > 0) {
        try {
          await Promise.race([this.initialize(), createTimeoutPromise()]);
          break; // If the promise is resolved, break the loop
        } catch (error) {
          retries -= 1;
          if (retries === 0) throw error; // If it's the last retry, throw the error
          Logger.warn(
            `Attempt ${CRON_STARTUP_RETRIES - retries} to start the '${
              this.cronServiceName
            }' CRON service failed. Retrying...`,
            LOG_CONTEXT
          );
        }
      }
      await this.createSendCronMetricsJob();
      Logger.log(`Starting up the '${this.cronServiceName}' CRON service has finished`, LOG_CONTEXT);
    } catch (error) {
      Logger.error(
        `Failed to start the '${this.cronServiceName}' CRON service after ${CRON_STARTUP_RETRIES} retries`,
        error,
        LOG_CONTEXT
      );
    }
  }

  /**
   * This method is called when the application is shutting down.
   * It ensures that all relevant jobs are removed from the CRON service before shutting down.
   */
  async onApplicationShutdown() {
    if (!this.activeJobs || this.activeJobs.length === 0) {
      Logger.verbose(
        `The '${this.cronServiceName}' CRON service has no active jobs and will not shut down`,
        LOG_CONTEXT
      );

      return;
    }

    try {
      Logger.log(`Shutting the '${this.cronServiceName}' CRON service down`, LOG_CONTEXT);
      await this.shutdown();
      Logger.log(`Shutting down the '${this.cronServiceName}' CRON service has finished`, LOG_CONTEXT);
    } catch (error) {
      Logger.error(`Failed to shut down the '${this.cronServiceName}' CRON service`, error, LOG_CONTEXT);
    }
  }

  private isActiveJob(jobName: JobCronNameEnum): boolean {
    return this.activeJobs.includes(jobName);
  }

  public async add<TData = unknown>(
    jobName: JobCronNameEnum,
    processor: (job: CronJobData<TData>) => Promise<void>,
    interval: string,
    options: CronOptions
  ): Promise<void> {
    if (!this.isActiveJob(jobName)) {
      Logger.verbose(`The '${jobName}' job is not active and will not be added to the CRON service`, LOG_CONTEXT);

      return;
    }

    const combinedOptions = {
      ...DEFAULT_CRON_OPTIONS,
      ...options,
    };
    this.handleJobOutcome(jobName, CronMetricsEventEnum.CREATE_STARTED);
    try {
      const _this = this;
      this.addJob(
        jobName,
        async function runCronJob(job) {
          nr.startBackgroundTransaction(
            ObservabilityBackgroundTransactionEnum.CRON_JOB_QUEUE,
            `cron-${jobName}`,
            function transactionHandler() {
              return new Promise<void>(async (resolve, reject) => {
                const transaction = nr.getTransaction();
                try {
                  _this.handleJobOutcome(jobName, CronMetricsEventEnum.STARTED);
                  await processor({
                    name: jobName,
                    startedAt: job.startedAt,
                    data: job.data as TData,
                  });
                  _this.handleJobOutcome(jobName, CronMetricsEventEnum.COMPLETED);
                  resolve();
                } catch (error) {
                  _this.handleJobOutcome(jobName, CronMetricsEventEnum.FAILED, error);
                  reject(error);
                } finally {
                  transaction.end();
                }
              });
            }
          );
        },
        interval,
        {
          lockLifetime: combinedOptions.lockLifetime,
          lockLimit: combinedOptions.lockLimit,
          concurrency: combinedOptions.concurrency,
          priority: combinedOptions.priority,
        }
      );
      this.handleJobOutcome(jobName, CronMetricsEventEnum.CREATE_COMPLETED);
    } catch (error) {
      this.handleJobOutcome(jobName, CronMetricsEventEnum.CREATE_FAILED, error);
      throw error;
    }
  }

  public async remove(jobName: JobCronNameEnum) {
    this.handleJobOutcome(jobName, CronMetricsEventEnum.CANCEL_STARTED);
    try {
      await this.removeJob(jobName);
      this.handleJobOutcome(jobName, CronMetricsEventEnum.CANCEL_COMPLETED);
    } catch (error) {
      this.handleJobOutcome(jobName, CronMetricsEventEnum.CANCEL_FAILED, error);
      throw error;
    }
  }

  private async createSendCronMetricsJob() {
    await this.add(
      METRICS_JOB_NAME,
      async () => {
        await this.sendCronMetrics();
      },
      METRICS_CRON_INTERVAL,
      {
        concurrency: METRICS_JOB_CONCURRENCY,
        lockLifetime: METRICS_JOB_LOCK_LIFETIME,
      }
    );
  }

  private async sendCronMetrics() {
    const metrics = await this.getMetrics();

    Object.entries(metrics).forEach(([jobName, jobMetrics]) => {
      this.metricsService.recordMetric(
        `Cron/${this.deploymentName}/${jobName}/${CronMetricsEventEnum.ACTIVE}`,
        jobMetrics.active
      );
      this.metricsService.recordMetric(
        `Cron/${this.deploymentName}/${jobName}/${CronMetricsEventEnum.WAITING}`,
        jobMetrics.waiting
      );
    });
  }

  private handleJobOutcome(jobName: JobCronNameEnum, event: CronMetricsEventEnum, error?: unknown) {
    const outcomeMessage = `Cron/${this.deploymentName}/${jobName}/${event}`;
    this.metricsService.recordMetric(outcomeMessage, 1);

    const eventName = this.kebabToSentenceCase(event);
    const logMessage = `${eventName}: '${jobName}' job`;

    if (error) {
      if (process.env.SENTRY_DSN) {
        captureException(error, { tags: { jobName, event, eventName } });
      }
      Logger.error(logMessage, error, LOG_CONTEXT);
    } else {
      Logger.verbose(logMessage, LOG_CONTEXT);
    }
  }

  private kebabToSentenceCase(kebabCaseString: string): string {
    return kebabCaseString
      .split('-')
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - runCronJob(job)
 - transactionHandler()
Asignaciones con arrow functions encontradas (posibles funciones):
 - createTimeoutPromise())
 - TData(unknown>(
    jobName: JobCronNameEnum,
    processor: (job: CronJobData<TData>))
 - _this(this;
      this.addJob(
        jobName,
        async function runCronJob(job) {
          nr.star...)
 - transaction(nr.getTransaction();
                try {
                  _this.handleJobOutcome(jobName, CronMet...)
 - metrics(await this.getMetrics();

    Object.entries(metrics).forEach(([jobName, jobMetrics]))
 - logMessage(`${eventName}: '${jobName}' job`;

    if (error) {
      if (process.env.SENTRY_DSN) {
        capt...)
Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cron/cron.types.ts
Tamaño: 1485 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobCronNameEnum, Timezone } from '@novu/shared';

export type CronOptions = {
  /** Max number of locked jobs of this kind */
  lockLimit?: number;
  /** Lock lifetime in milliseconds */
  lockLifetime?: number;
  /** Higher priority jobs will run first. */
  priority?: number;
  /** How many jobs of this kind can run in parallel/simultaneously per Cron instance */
  concurrency?: number;
  /**
   * The IANA timezone that the job should be run in.
   * @see https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
   */
  timezone?: Timezone;
};

export type CronJobData<TData> = {
  /** The name of the job */
  name: JobCronNameEnum;
  /** The time the job was scheduled to start at */
  startedAt: Date;
  /** The custom data provided for the job run */
  data: TData;
};

export type CronJobProcessor<TData> = (job: CronJobData<TData>) => Promise<void>;

export type CronMetrics = Record<
  JobCronNameEnum,
  {
    /** The number of jobs that are currently running */
    active: number;
    /** The number of jobs that are currently waiting to be run */
    waiting: number;
  }
>;

export enum CronMetricsEventEnum {
  ACTIVE = 'active',
  WAITING = 'waiting',
  STARTED = 'started',
  COMPLETED = 'completed',
  FAILED = 'failed',
  CREATE_STARTED = 'create-started',
  CREATE_COMPLETED = 'create-completed',
  CREATE_FAILED = 'create-failed',
  CANCEL_STARTED = 'cancel-started',
  CANCEL_COMPLETED = 'cancel-completed',
  CANCEL_FAILED = 'cancel-failed',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type
- export  type
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/cron/index.ts
Tamaño: 135 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './agenda-cron.service';
export * from './cron.constants';
export * from './cron.service';
export * from './cron.types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/feature-flags/feature-flags.service.ts
Tamaño: 1541 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { LaunchDarklyFeatureFlagsService } from './launch-darkly.service';
import { ProcessEnvFeatureFlagsService } from './process-env.service';

import { FeatureFlagContext, IFeatureFlagsService } from './types';

const LOG_CONTEXT = 'FeatureFlagsService';

@Injectable()
export class FeatureFlagsService {
  public service: IFeatureFlagsService;

  public async initialize(): Promise<void> {
    const Service = process.env.LAUNCH_DARKLY_SDK_KEY ? LaunchDarklyFeatureFlagsService : ProcessEnvFeatureFlagsService;

    this.service = new Service();

    try {
      await this.service.initialize();
      Logger.log(`Feature Flags service (${Service.name}) has been successfully initialized.`, LOG_CONTEXT);
    } catch (error) {
      Logger.error(
        `Feature Flags service (${Service.name}) failed to initialize.`,
        (error as Error).stack || (error as Error).message,
        LOG_CONTEXT
      );
    }
  }

  public async gracefullyShutdown(): Promise<void> {
    try {
      await this.service.gracefullyShutdown();
      Logger.verbose('Feature Flags service has been gracefully shut down', LOG_CONTEXT);
    } catch (error) {
      Logger.error(error, 'Feature Flags service has failed when shut down', LOG_CONTEXT);
    }
  }
  // the T_Result is inferred from the usage within the context.defaultValue in FeatureFlagContext
  public async getFlag<T_Result>(context: FeatureFlagContext<T_Result>): Promise<T_Result> {
    return this.service.getFlag(context);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FeatureFlagsService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/feature-flags/index.ts
Tamaño: 41 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './feature-flags.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/feature-flags/launch-darkly.service.ts
Tamaño: 2546 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { init, LDClient, LDMultiKindContext } from '@launchdarkly/node-server-sdk';
import { Injectable } from '@nestjs/common';
import type { FeatureFlagContext, FeatureFlagContextBase, IFeatureFlagsService } from './types';

@Injectable()
export class LaunchDarklyFeatureFlagsService implements IFeatureFlagsService {
  private client: LDClient;
  public isEnabled: boolean;

  public async initialize(): Promise<void> {
    const launchDarklySdkKey = process.env.LAUNCH_DARKLY_SDK_KEY;
    if (!launchDarklySdkKey) {
      throw new Error('Missing Launch Darkly SDK key');
    }
    this.client = init(launchDarklySdkKey);
    await this.client.waitForInitialization({ timeout: 10000 });
    this.isEnabled = true;
  }

  public async gracefullyShutdown(): Promise<void> {
    if (this.client) {
      await this.client.flush();
      this.client.close();
    }
  }

  async getFlag<T_Result>({
    key,
    defaultValue,
    environment,
    organization,
    user,
  }: FeatureFlagContext<T_Result>): Promise<T_Result> {
    const context = this.buildLDContext({ user, organization, environment });
    const newVar = await this.client.variation(key, context, defaultValue);

    return newVar;
  }

  private buildLDContext({ user, organization, environment }: FeatureFlagContextBase): LDMultiKindContext {
    const mappedContext: LDMultiKindContext = {
      kind: 'multi',
    };

    if (environment?._id) {
      mappedContext.environment = {
        key: environment._id,
        createdAt: environment.createdAt,
        updatedAt: environment.updatedAt,
      };
    }

    if (organization?._id) {
      mappedContext.organization = {
        key: organization._id,
        createdAt: organization.createdAt,
        updatedAt: organization.updatedAt,
        externalId: organization.externalId,
        apiServiceLevel: organization.apiServiceLevel,
      };
    }

    if (user?._id) {
      mappedContext.user = {
        key: user._id,
        createdAt: user.createdAt,
        updatedAt: user.updatedAt,
        externalId: user.externalId,
      };
    }

    /*
     * LaunchDarkly requires at least one context kind in multi-kind contexts
     * Add a fallback global context to prevent "A multi-kind context must contain at least one kind" error
     */
    const hasAnyContext = mappedContext.environment || mappedContext.organization || mappedContext.user;
    if (!hasAnyContext) {
      mappedContext.global = {
        key: 'global-context',
        anonymous: true,
      };
    }

    return mappedContext;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LaunchDarklyFeatureFlagsService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/feature-flags/process-env.service.ts
Tamaño: 963 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import type { FeatureFlagContext, IFeatureFlagsService } from './types';

@Injectable()
export class ProcessEnvFeatureFlagsService implements IFeatureFlagsService {
  public isEnabled: boolean = true;

  async initialize() {
    this.isEnabled = true;
  }
  async gracefullyShutdown() {
    this.isEnabled = false;
  }

  async getFlag<T_Result>(context: FeatureFlagContext<T_Result>): Promise<T_Result> {
    const processEnvValue = process.env[context.key];
    if (!processEnvValue) {
      return context.defaultValue as T_Result;
    }

    if (typeof context.defaultValue === 'number') {
      return Number(processEnvValue) as T_Result;
    }

    if (typeof context.defaultValue === 'boolean') {
      return (processEnvValue === 'true') as T_Result;
    }

    if (typeof context.defaultValue === 'string') {
      return processEnvValue as T_Result;
    }

    return context.defaultValue as T_Result;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ProcessEnvFeatureFlagsService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/feature-flags/types.ts
Tamaño: 1066 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentEntity, OrganizationEntity, UserEntity } from '@novu/dal';
import { FeatureFlagsKeysEnum } from '@novu/shared';

type PartialWithId<T> = Partial<T> & { _id: string };

export type FeatureFlagContextBase =
  | {
      environment: PartialWithId<EnvironmentEntity>;
      organization?: PartialWithId<OrganizationEntity>;
      user?: PartialWithId<UserEntity>;
    }
  | {
      environment?: PartialWithId<EnvironmentEntity>;
      organization: PartialWithId<OrganizationEntity>;
      user?: PartialWithId<UserEntity>;
    }
  | {
      environment?: PartialWithId<EnvironmentEntity>;
      organization?: PartialWithId<OrganizationEntity>;
      user: PartialWithId<UserEntity>;
    };

export type FeatureFlagContext<T_Result> = FeatureFlagContextBase & {
  key: FeatureFlagsKeysEnum;
  defaultValue: T_Result;
};
export interface IFeatureFlagsService {
  isEnabled: boolean;

  initialize: () => Promise<void>;

  gracefullyShutdown: () => Promise<void>;

  getFlag: <T_Result>(context: FeatureFlagContext<T_Result>) => Promise<T_Result>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/cache-in-memory-provider.service.ts
Tamaño: 2907 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { InMemoryProviderService } from './in-memory-provider.service';
import { InMemoryProviderClient, InMemoryProviderEnum, ScanStream } from './types';
import { isClusterModeEnabled } from './utils';

const LOG_CONTEXT = 'CacheInMemoryProviderService';

export class CacheInMemoryProviderService {
  public inMemoryProviderService: InMemoryProviderService;
  public isCluster: boolean;

  constructor() {
    const provider = this.selectProvider();
    this.isCluster = this.isClusterMode();

    const enableAutoPipelining = process.env.REDIS_CACHE_ENABLE_AUTOPIPELINING === 'true';

    this.inMemoryProviderService = new InMemoryProviderService(provider, this.isCluster, enableAutoPipelining);
  }

  /**
   * Rules for the provider selection:
   * - For self hosted non-enterprise users we use a single node Redis instance.
   * - For self hosted enterprise users we use Redis Master-Slave architecture.
   * - For Novu cloud we use Elasticache. We fallback to a Redis Cluster configuration
   * if Elasticache not configured properly. That's happening in the provider
   * mapping in the /in-memory-provider/providers/index.ts
   */
  private selectProvider(): InMemoryProviderEnum {
    if (process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'false') {
      return InMemoryProviderEnum.REDIS;
    }

    if (process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'true') {
      return InMemoryProviderEnum.REDIS_MASTER_SLAVE;
    }

    return InMemoryProviderEnum.ELASTICACHE;
  }

  private descriptiveLogMessage(message) {
    return `[Provider: ${this.selectProvider()}] ${message}`;
  }

  private isClusterMode(): boolean {
    const isEnabled = isClusterModeEnabled();

    Logger.log(
      this.descriptiveLogMessage(`Cluster mode ${isEnabled ? 'IS' : 'IS NOT'} enabled for ${LOG_CONTEXT}`),
      LOG_CONTEXT
    );

    return isEnabled;
  }

  public async initialize(): Promise<void> {
    await this.inMemoryProviderService.delayUntilReadiness();
  }

  public getClient(): InMemoryProviderClient {
    return this.inMemoryProviderService.inMemoryProviderClient;
  }

  public getClientStatus(): string {
    return this.getClient()?.status || 'disconnected';
  }

  public getTtl(): number {
    return this.inMemoryProviderService.inMemoryProviderConfig.ttl;
  }

  public inMemoryScan(pattern: string): ScanStream {
    return this.inMemoryProviderService.inMemoryScan(pattern);
  }

  public isReady(): boolean {
    return this.inMemoryProviderService.isClientReady();
  }

  public providerInUseIsInClusterMode(): boolean {
    const providerConfigured = this.inMemoryProviderService.getProvider.configured;

    return this.isCluster || providerConfigured !== InMemoryProviderEnum.REDIS;
  }

  public async shutdown(): Promise<void> {
    await this.inMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CacheInMemoryProviderService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/in-memory-provider.service.spec.ts
Tamaño: 6291 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { InMemoryProviderService } from './in-memory-provider.service';
import { InMemoryProviderEnum } from './types';

let inMemoryProviderService: InMemoryProviderService;

describe('In-memory Provider Service', () => {
  describe('Non cluster mode', () => {
    beforeEach(async () => {
      inMemoryProviderService = new InMemoryProviderService(InMemoryProviderEnum.REDIS, false);

      await inMemoryProviderService.delayUntilReadiness();

      expect(inMemoryProviderService.getStatus()).toEqual('ready');
    });

    afterEach(async () => {
      await inMemoryProviderService.shutdown();
    });

    describe('Set up', () => {
      it('should have the right config', () => {
        const { inMemoryProviderConfig } = inMemoryProviderService;

        expect(inMemoryProviderConfig.host).toEqual(process.env.REDIS_CACHE_SERVICE_HOST);

        if ('port' in inMemoryProviderConfig) {
          expect(inMemoryProviderConfig.port).toEqual(Number(process.env.REDIS_CACHE_SERVICE_PORT));
        }

        expect(inMemoryProviderConfig.connectTimeout).toEqual(50_000);
        expect(inMemoryProviderConfig.family).toEqual(4);
        expect(inMemoryProviderConfig.keepAlive).toEqual(30_000);
        expect(inMemoryProviderConfig.keyPrefix).toEqual('');
        expect(inMemoryProviderConfig.password).toEqual(undefined);
        expect(inMemoryProviderConfig.ttl).toEqual(7_200);
        expect(inMemoryProviderConfig.tls).toEqual(undefined);
      });

      it('should instantiate the provider properly', async () => {
        const { inMemoryProviderClient } = inMemoryProviderService;

        expect(inMemoryProviderClient.status).toEqual('ready');
        expect(inMemoryProviderClient.isCluster).toEqual(false);

        const options = inMemoryProviderService.getOptions();

        expect(options?.host).toEqual(process.env.REDIS_CACHE_SERVICE_HOST);
        expect(options?.port).toEqual(Number(process.env.REDIS_CACHE_SERVICE_PORT));
        expect(options?.role).toEqual('master');
        expect(options?.username).toEqual(null);
        expect(options?.password).toEqual(null);
        expect(options?.db).toEqual(1);
      });

      it('should we able to operate in the in-memory database', async () => {
        const pingCommandResult = await inMemoryProviderService.inMemoryProviderClient.ping();
        expect(pingCommandResult).toEqual('PONG');

        const valueToStore = 'non cluster mode';
        await inMemoryProviderService.inMemoryProviderClient.set('novu', valueToStore);
        const value = await inMemoryProviderService.inMemoryProviderClient.get('novu');
        expect(value).toEqual('non cluster mode');
      });
    });
  });

  describe('Cluster mode', () => {
    beforeEach(async () => {
      inMemoryProviderService = new InMemoryProviderService(InMemoryProviderEnum.REDIS, true);
      await inMemoryProviderService.delayUntilReadiness();

      expect(inMemoryProviderService.getStatus()).toEqual('ready');
    });

    afterEach(async () => {
      await inMemoryProviderService.shutdown();
    });

    describe('TEMP: Check if enableAutoPipelining true is set properly in Cluster', () => {
      it('enableAutoPipelining is enabled', async () => {
        const clusterWithPipelining = new InMemoryProviderService(InMemoryProviderEnum.REDIS, true, true);
        await clusterWithPipelining.delayUntilReadiness();

        expect(clusterWithPipelining.getStatus()).toEqual('ready');
        expect(clusterWithPipelining.inMemoryProviderClient.options.enableAutoPipelining).toEqual(true);
      });
    });

    describe('Set up', () => {
      it('should have the right config', () => {
        const { inMemoryProviderConfig } = inMemoryProviderService;

        expect(inMemoryProviderConfig.host).toEqual(process.env.REDIS_CLUSTER_SERVICE_HOST);
        if ('ports' in inMemoryProviderConfig) {
          const ports = process.env.REDIS_CLUSTER_SERVICE_PORTS && JSON.parse(process.env.REDIS_CLUSTER_SERVICE_PORTS);
          expect(inMemoryProviderConfig.ports).toEqual(ports);
        }

        const instances =
          process.env.REDIS_CLUSTER_SERVICE_PORTS &&
          JSON.parse(process.env.REDIS_CLUSTER_SERVICE_PORTS).map((port) => ({
            host: process.env.REDIS_CLUSTER_SERVICE_HOST,
            port,
          }));
        if ('instances' in inMemoryProviderConfig) {
          expect(inMemoryProviderConfig.instances).toEqual(instances);
        }

        expect(inMemoryProviderConfig.connectTimeout).toEqual(50_000);
        expect(inMemoryProviderConfig.family).toEqual(4);
        expect(inMemoryProviderConfig.keepAlive).toEqual(30_000);
        expect(inMemoryProviderConfig.keyPrefix).toEqual('');
        expect(inMemoryProviderConfig.password).toEqual('');
        expect(inMemoryProviderConfig.ttl).toEqual(7_200);
      });

      it('should instantiate the provider properly', async () => {
        const { inMemoryProviderClient } = inMemoryProviderService;

        expect(inMemoryProviderClient.status).toEqual('ready');
        expect(inMemoryProviderClient.isCluster).toEqual(true);
        expect(inMemoryProviderClient.options.enableAutoPipelining).toEqual(false);

        const options = inMemoryProviderService.getOptions();
        expect(options).toEqual(undefined);

        const clusterOptions = await inMemoryProviderService.getClusterOptions();
        expect(clusterOptions.enableOfflineQueue).toEqual(false);
        expect(clusterOptions.enableReadyCheck).toEqual(true);
        expect(clusterOptions.maxRedirections).toEqual(16);
        expect(clusterOptions.retryDelayOnClusterDown).toEqual(100);
        expect(clusterOptions.retryDelayOnFailover).toEqual(100);
        expect(clusterOptions.retryDelayOnTryAgain).toEqual(100);
      });

      it('should we able to operate in the in-memory database', async () => {
        const pingCommandResult = await inMemoryProviderService.inMemoryProviderClient.ping();
        expect(pingCommandResult).toEqual('PONG');

        const valueToStore = 'cluster mode';
        await inMemoryProviderService.inMemoryProviderClient.set('novu', valueToStore);
        const value = await inMemoryProviderService.inMemoryProviderClient.get('novu');
        expect(value).toEqual('cluster mode');
      });
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - inMemoryProviderService(new InMemoryProviderService(InMemoryProviderEnum.REDIS, false);

      await inMemoryProviderService...)
 - options(inMemoryProviderService.getOptions();

        expect(options?.host).toEqual(process.env.REDIS_CACHE...)
 - value(await inMemoryProviderService.inMemoryProviderClient.get('novu');
        expect(value).toEqual('non...)
 - inMemoryProviderService(new InMemoryProviderService(InMemoryProviderEnum.REDIS, true);
      await inMemoryProviderService.d...)
 - clusterWithPipelining(new InMemoryProviderService(InMemoryProviderEnum.REDIS, true, true);
        await clusterWithPipeli...)
 - instances(process.env.REDIS_CLUSTER_SERVICE_PORTS &&
          JSON.parse(process.env.REDIS_CLUSTER_SERVICE_PO...)
 - clusterOptions(await inMemoryProviderService.getClusterOptions();
        expect(clusterOptions.enableOfflineQueue)...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/in-memory-provider.service.ts
Tamaño: 8271 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { setTimeout } from 'timers/promises';

import { getClientAndConfig, getClientAndConfigForCluster, InMemoryProviderConfig } from './providers';
import {
  Cluster,
  ClusterOptions,
  InMemoryProviderClient,
  InMemoryProviderEnum,
  Redis,
  RedisOptions,
  ScanStream,
} from './types';

const LOG_CONTEXT = 'InMemoryProviderService';

export class InMemoryProviderService {
  public inMemoryProviderClient: InMemoryProviderClient;
  public inMemoryProviderConfig: InMemoryProviderConfig;

  public isProviderClientReady: (string) => boolean;

  constructor(
    private provider: InMemoryProviderEnum,
    private isCluster: boolean,
    private enableAutoPipelining?: boolean
  ) {
    Logger.log(this.descriptiveLogMessage('In-memory provider service initialized'), LOG_CONTEXT);
    this.inMemoryProviderClient = this.buildClient(provider);
  }

  public get getProvider(): {
    selected: InMemoryProviderEnum;
    configured: InMemoryProviderEnum;
  } {
    const config = this.isCluster ? getClientAndConfigForCluster(this.provider) : getClientAndConfig();

    return {
      selected: this.provider,
      configured: config.provider,
    };
  }

  protected descriptiveLogMessage(message) {
    return `[Provider: ${this.provider}] ${message}`;
  }

  private buildClient(provider: InMemoryProviderEnum): InMemoryProviderClient {
    return this.isCluster ? this.inMemoryClusterProviderSetup(provider) : this.inMemoryProviderSetup();
  }

  public async delayUntilReadiness(): Promise<void> {
    let times = 0;
    const retries = process.env.IN_MEMORY_PROVIDER_SERVICE_READINESS_TIMEOUT_RETRIES
      ? Number(process.env.IN_MEMORY_PROVIDER_SERVICE_READINESS_TIMEOUT_RETRIES)
      : 10;
    const timeout = process.env.IN_MEMORY_PROVIDER_SERVICE_READINESS_TIMEOUT
      ? Number(process.env.IN_MEMORY_PROVIDER_SERVICE_READINESS_TIMEOUT)
      : 100;

    while (times <= retries && !this.isClientReady()) {
      times += 1;
      await setTimeout(timeout);
    }

    if (this.isClientReady()) {
      Logger.warn(
        this.descriptiveLogMessage(
          `In-memory provider service is ready! It was delayed ${times} times up to a total of ${retries}.`
        ),
        LOG_CONTEXT
      );
    } else {
      Logger.error(
        this.descriptiveLogMessage(
          'In-memory provider service is not ready! It reached the limit of retries waiting for readiness.'
        ),
        LOG_CONTEXT
      );
    }
  }

  public getStatus(): string | unknown {
    if (this.inMemoryProviderClient) {
      return this.inMemoryProviderClient.status;
    }
  }

  public isClientReady(): boolean {
    return this.isProviderClientReady(this.getStatus());
  }

  public getClusterOptions(): ClusterOptions | undefined {
    if (this.inMemoryProviderClient && this.isCluster) {
      return this.inMemoryProviderClient.options;
    }
  }

  public getOptions(): RedisOptions | undefined {
    if (this.inMemoryProviderClient) {
      if (!this.isCluster) {
        const { options } = this.inMemoryProviderClient;

        return options;
      } else {
        const clusterOptions: ClusterOptions = this.inMemoryProviderClient.options;

        return clusterOptions.redisOptions;
      }
    }
  }

  private inMemoryClusterProviderSetup(provider): Cluster | undefined {
    Logger.verbose(this.descriptiveLogMessage(`In-memory cluster service set up`), LOG_CONTEXT);

    const { getConfig, getClient, isClientReady } = getClientAndConfigForCluster(provider);

    this.isProviderClientReady = isClientReady;
    this.inMemoryProviderConfig = getConfig();
    const { host, ttl } = getConfig();

    if (!host) {
      Logger.warn(this.descriptiveLogMessage(`Missing host for in-memory cluster for`), LOG_CONTEXT);
    }

    const inMemoryProviderClient = getClient(this.enableAutoPipelining);
    if (host && inMemoryProviderClient) {
      Logger.log(this.descriptiveLogMessage(`Connecting to cluster at ${host}`), LOG_CONTEXT);

      inMemoryProviderClient.on('connect', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster connected`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('connecting', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster connecting`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('reconnecting', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster reconnecting`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('close', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster closing`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('end', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster end`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('error', (error) => {
        Logger.error(
          error,
          this.descriptiveLogMessage(`There has been an error in the In-memory Cluster provider client`),
          LOG_CONTEXT
        );
      });

      inMemoryProviderClient.on('ready', () => {
        Logger.log(this.descriptiveLogMessage(`In-memory cluster ready`), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('wait', () => {
        Logger.verbose(this.descriptiveLogMessage(`In-memory cluster waiting`), LOG_CONTEXT);
      });

      return inMemoryProviderClient;
    }
  }

  private inMemoryProviderSetup(): Redis | undefined {
    Logger.verbose(this.descriptiveLogMessage('In-memory service set up'), LOG_CONTEXT);

    const { getClient, getConfig, isClientReady } = getClientAndConfig();

    this.isProviderClientReady = isClientReady;
    this.inMemoryProviderConfig = getConfig();
    const { host, port, ttl } = getConfig();

    if (!host) {
      Logger.warn(this.descriptiveLogMessage('Missing host for in-memory provider'), LOG_CONTEXT);
    }

    const inMemoryProviderClient = getClient();
    if (host && inMemoryProviderClient) {
      Logger.log(this.descriptiveLogMessage(`Connecting to ${host}:${port}`), LOG_CONTEXT);

      inMemoryProviderClient.on('connect', () => {
        Logger.verbose(this.descriptiveLogMessage('REDIS CONNECTED'), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('reconnecting', () => {
        Logger.verbose(this.descriptiveLogMessage('Redis reconnecting'), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('close', () => {
        Logger.verbose(this.descriptiveLogMessage('Redis close'), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('end', () => {
        Logger.verbose(this.descriptiveLogMessage('Redis end'), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('error', (error) => {
        Logger.error(
          error,
          this.descriptiveLogMessage('There has been an error in the InMemory provider client'),
          LOG_CONTEXT
        );
      });

      inMemoryProviderClient.on('ready', () => {
        Logger.log(this.descriptiveLogMessage('Redis ready'), LOG_CONTEXT);
      });

      inMemoryProviderClient.on('wait', () => {
        Logger.verbose(this.descriptiveLogMessage('Redis wait'), LOG_CONTEXT);
      });

      return inMemoryProviderClient;
    }
  }

  public inMemoryScan(pattern: string): ScanStream {
    if (this.isCluster) {
      const client = this.inMemoryProviderClient as Cluster;

      return client.sscanStream(pattern);
    }

    const client = this.inMemoryProviderClient as Redis;

    return client.scanStream({ match: pattern });
  }

  public async shutdown(): Promise<void> {
    if (this.inMemoryProviderClient) {
      try {
        await this.inMemoryProviderClient.quit();
        Logger.verbose(this.descriptiveLogMessage(`In-memory provider service shutdown`), LOG_CONTEXT);
      } catch (error) {
        Logger.error(error, this.descriptiveLogMessage(`In-memory provider service shutdown has failed`), LOG_CONTEXT);
      }
    }
  }

  /**
   * This Nest.js hook allows us to execute logic on termination after signal.
   * https://docs.nestjs.com/fundamentals/lifecycle-events#application-shutdown
   *
   * Enabled by:
   *   app.enableShutdownHooks();
   *
   * in /apps/api/src/bootstrap.ts
   */
  public async onApplicationShutdown(signal): Promise<void> {
    await this.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('InMemoryProviderService';

export class InMemoryProviderService {
  public inMemoryProviderClient: ...)
 - inMemoryProviderClient(getClient(this.enableAutoPipelining);
    if (host && inMemoryProviderClient) {
      Logger.log(thi...)
 - inMemoryProviderClient(getClient();
    if (host && inMemoryProviderClient) {
      Logger.log(this.descriptiveLogMessage(`...)
Declaraciones 'export' encontradas:
- export class InMemoryProviderService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/index.ts
Tamaño: 236 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './cache-in-memory-provider.service';
export * from './in-memory-provider.service';
export * from './types';
export * from './web-sockets-in-memory-provider.service';
export * from './workflow-in-memory-provider.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/types.ts
Tamaño: 524 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChainableCommander, Cluster, ClusterOptions, Redis, RedisOptions, ScanStream } from 'ioredis';

export { Cluster, ClusterOptions, Redis, RedisOptions, ScanStream };

export type InMemoryProviderClient = Redis | Cluster | undefined;

export enum InMemoryProviderEnum {
  AZURE_CACHE_FOR_REDIS = 'AzureCacheForRedis',
  ELASTICACHE = 'Elasticache',
  MEMORY_DB = 'MemoryDB',
  REDIS = 'Redis',
  REDIS_CLUSTER = 'RedisCluster',
  REDIS_MASTER_SLAVE = 'RedisMasterSlave',
}

export type Pipeline = ChainableCommander;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export  type
- export  enum
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/utils.ts
Tamaño: 203 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export function isClusterModeEnabled(): boolean {
  return (
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED === 'true' ||
    process.env.IN_MEMORY_CLUSTER_MODE_ENABLED === 'true' ||
    false
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isClusterModeEnabled()
Declaraciones 'export' encontradas:
- export function isClusterModeEnabled

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/web-sockets-in-memory-provider.service.ts
Tamaño: 2584 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { InMemoryProviderService } from './in-memory-provider.service';
import { InMemoryProviderClient, InMemoryProviderEnum, ScanStream } from './types';
import { isClusterModeEnabled } from './utils';

const LOG_CONTEXT = 'WebSocketsInMemoryProviderService';

export class WebSocketsInMemoryProviderService {
  public inMemoryProviderService: InMemoryProviderService;
  public isCluster: boolean;

  constructor() {
    const provider = this.selectProvider();
    this.isCluster = this.isClusterMode();

    this.inMemoryProviderService = new InMemoryProviderService(provider, this.isCluster);
  }

  /**
   * Rules for the provider selection:
   * - For our self hosted users we assume all of them have a single node Redis
   * instance.
   * - For Novu we will use Elasticache. We fallback to a Redis Cluster configuration
   * if Elasticache not configured properly. That's happening in the provider
   * mapping in the /in-memory-provider/providers/index.ts
   */
  private selectProvider(): InMemoryProviderEnum {
    if (process.env.IS_SELF_HOSTED === 'true' && process.env.NOVU_ENTERPRISE === 'false') {
      return InMemoryProviderEnum.REDIS;
    }

    return InMemoryProviderEnum.ELASTICACHE;
  }

  private descriptiveLogMessage(message) {
    return `[Provider: ${this.selectProvider()}] ${message}`;
  }

  private isClusterMode(): boolean {
    const isEnabled = isClusterModeEnabled();

    Logger.log(
      this.descriptiveLogMessage(`Cluster mode ${isEnabled ? 'IS' : 'IS NOT'} enabled for ${LOG_CONTEXT}`),
      LOG_CONTEXT
    );

    return isEnabled;
  }

  public async initialize(): Promise<void> {
    await this.inMemoryProviderService.delayUntilReadiness();
  }

  public getClient(): InMemoryProviderClient {
    return this.inMemoryProviderService.inMemoryProviderClient;
  }

  public getClientStatus(): string {
    return this.getClient()?.status || 'disconnected';
  }

  public getTtl(): number {
    return this.inMemoryProviderService.inMemoryProviderConfig.ttl;
  }

  public inMemoryScan(pattern: string): ScanStream {
    return this.inMemoryProviderService.inMemoryScan(pattern);
  }

  public isReady(): boolean {
    return this.inMemoryProviderService.isClientReady();
  }

  public providerInUseIsInClusterMode(): boolean {
    const providerConfigured = this.inMemoryProviderService.getProvider.configured;

    return this.isCluster || providerConfigured !== InMemoryProviderEnum.REDIS;
  }

  public async shutdown(): Promise<void> {
    await this.inMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebSocketsInMemoryProviderService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/workflow-in-memory-provider.service.ts
Tamaño: 2337 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';

import { InMemoryProviderService } from './in-memory-provider.service';
import { InMemoryProviderClient, InMemoryProviderEnum } from './types';
import { isClusterModeEnabled } from './utils';

const LOG_CONTEXT = 'WorkflowInMemoryProviderService';

export class WorkflowInMemoryProviderService {
  public inMemoryProviderService: InMemoryProviderService;
  public isCluster: boolean;

  constructor() {
    const provider = this.selectProvider();
    this.isCluster = this.isClusterMode();

    this.inMemoryProviderService = new InMemoryProviderService(provider, this.isCluster, false);
  }

  /**
   * Rules for the provider selection:
   * - For ALL self hosted users (enterprise and non-enterprise) we use a single 
   * node Redis instance for BullMQ queues. This is simpler and more reliable 
   * for queue operations which are write-heavy and sequential.
   * - For Novu cloud we use MemoryDB. We fallback to a Redis Cluster configuration
   * if MemoryDB not configured properly. That's happening in the provider
   * mapping in the /in-memory-provider/providers/index.ts
   */
  private selectProvider(): InMemoryProviderEnum {
    if (process.env.IS_SELF_HOSTED === 'true') {
      return InMemoryProviderEnum.REDIS;
    }

    return InMemoryProviderEnum.MEMORY_DB;
  }

  private descriptiveLogMessage(message) {
    return `[Provider: ${this.selectProvider()}] ${message}`;
  }

  private isClusterMode(): boolean {
    const isEnabled = isClusterModeEnabled();

    Logger.log(
      this.descriptiveLogMessage(`Cluster mode ${isEnabled ? 'is' : 'is not'} enabled for ${LOG_CONTEXT}`),
      LOG_CONTEXT
    );

    return isEnabled;
  }

  public async initialize(): Promise<void> {
    await this.inMemoryProviderService.delayUntilReadiness();
  }

  public getClient(): InMemoryProviderClient {
    return this.inMemoryProviderService.inMemoryProviderClient;
  }

  public isReady(): boolean {
    return this.inMemoryProviderService.isClientReady();
  }

  public providerInUseIsInClusterMode(): boolean {
    const providerConfigured = this.inMemoryProviderService.getProvider.configured;

    return this.isCluster || providerConfigured !== InMemoryProviderEnum.REDIS;
  }

  public async shutdown(): Promise<void> {
    await this.inMemoryProviderService.shutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowInMemoryProviderService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/azure-cache-for-redis-cluster-provider.ts
Tamaño: 4427 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import Redis, { Cluster, ClusterNode, ClusterOptions, NodeRole } from 'ioredis';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { Cluster, ClusterOptions };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_FAMILY = 4;
const DEFAULT_KEY_PREFIX = '';
const TTL_VARIANT_PERCENTAGE = 0.1;

interface IAzureCacheForRedisClusterConfig {
  connectTimeout?: string;
  family?: string;
  host?: string;
  keepAlive?: string;
  keyPrefix?: string;
  username?: string;
  password?: string;
  port?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IAzureCacheForRedisClusterProviderConfig {
  connectTimeout: number;
  family: number;
  host?: string;
  instances?: ClusterNode[];
  keepAlive: number;
  keyPrefix: string;
  username?: string;
  password?: string;
  port?: number;
  tls?: ConnectionOptions;
  ttl: number;
}

export const getAzureCacheForRedisClusterProviderConfig = (): IAzureCacheForRedisClusterProviderConfig => {
  const redisClusterConfig: IAzureCacheForRedisClusterConfig = {
    host: convertStringValues(process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_HOST),
    port: convertStringValues(process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_PORT),
    ttl: convertStringValues(process.env.REDIS_CLUSTER_TTL),
    username: convertStringValues(process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_USERNAME),
    password: convertStringValues(process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_PASSWORD),
    connectTimeout: convertStringValues(process.env.REDIS_CLUSTER_CONNECTION_TIMEOUT),
    keepAlive: convertStringValues(process.env.REDIS_CLUSTER_KEEP_ALIVE),
    family: convertStringValues(process.env.REDIS_CLUSTER_FAMILY),
    keyPrefix: convertStringValues(process.env.REDIS_CLUSTER_KEY_PREFIX),
    tls: (process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_TLS as ConnectionOptions)
      ? {
          servername: convertStringValues(process.env.AZURE_CACHE_FOR_REDIS_CLUSTER_SERVICE_HOST),
        }
      : {},
  };

  const { host } = redisClusterConfig;
  const port = redisClusterConfig.port ? Number(redisClusterConfig.port) : undefined;
  const { username } = redisClusterConfig;
  const { password } = redisClusterConfig;
  const connectTimeout = redisClusterConfig.connectTimeout
    ? Number(redisClusterConfig.connectTimeout)
    : DEFAULT_CONNECT_TIMEOUT;
  const family = redisClusterConfig.family ? Number(redisClusterConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisClusterConfig.keepAlive ? Number(redisClusterConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisClusterConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisClusterConfig.ttl ? Number(redisClusterConfig.ttl) : DEFAULT_TTL_SECONDS;

  const instances: ClusterNode[] = [{ host, port }];

  return {
    host,
    port,
    instances,
    username,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
    tls: redisClusterConfig.tls,
  };
};

export const getAzureCacheForRedisCluster = (enableAutoPipelining?: boolean): Cluster | undefined => {
  const { instances, password, tls, username } = getAzureCacheForRedisClusterProviderConfig();

  const options: ClusterOptions = {
    dnsLookup: (address, callback) => callback(null, address),
    enableAutoPipelining: enableAutoPipelining ?? false,
    enableOfflineQueue: false,
    redisOptions: {
      tls,
      connectTimeout: 10000,
      ...(password && { password }),
      ...(username && { username }),
    },
    scaleReads: 'slave',
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
    slotsRefreshTimeout: 10000,
  };

  Logger.log(
    `Initializing Azure Cache For Redis Cluster Provider with ${instances?.length} instances and auto-pipelining as ${options.enableAutoPipelining}`
  );

  if (instances && instances.length > 0) {
    return new Redis.Cluster(instances, options);
  }

  return undefined;
};

export const validateAzureCacheForRedisClusterProviderConfig = (): boolean => {
  const config = getAzureCacheForRedisClusterProviderConfig();

  return !!config.host && !!config.port;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getAzureCacheForRedisClusterProviderConfig(): IAzureCacheForRedisClusterProviderConfig)
 - getAzureCacheForRedisCluster(enableAutoPipelining?: boolean): Cluster | undefined)
 - ClusterOptions({
    dnsLookup: (address, callback))
 - validateAzureCacheForRedisClusterProviderConfig(): boolean)
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/elasticache-cluster-provider.ts
Tamaño: 4077 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import Redis, { Cluster, ClusterNode, ClusterOptions, NodeRole } from 'ioredis';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { Cluster, ClusterOptions };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_FAMILY = 4;
const DEFAULT_KEY_PREFIX = '';
const TTL_VARIANT_PERCENTAGE = 0.1;

interface IElasticacheClusterConfig {
  connectTimeout?: string;
  family?: string;
  host?: string;
  keepAlive?: string;
  keyPrefix?: string;
  password?: string;
  port?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IElasticacheClusterProviderConfig {
  connectTimeout: number;
  family: number;
  host?: string;
  instances?: ClusterNode[];
  keepAlive: number;
  keyPrefix: string;
  password?: string;
  port?: number;
  tls?: ConnectionOptions;
  ttl: number;
}

export const getElasticacheClusterProviderConfig = (): IElasticacheClusterProviderConfig => {
  const redisClusterConfig: IElasticacheClusterConfig = {
    host: convertStringValues(process.env.ELASTICACHE_CLUSTER_SERVICE_HOST),
    port: convertStringValues(process.env.ELASTICACHE_CLUSTER_SERVICE_PORT),
    ttl: convertStringValues(process.env.REDIS_CLUSTER_TTL),
    password: convertStringValues(process.env.REDIS_CLUSTER_PASSWORD),
    connectTimeout: convertStringValues(process.env.REDIS_CLUSTER_CONNECTION_TIMEOUT),
    keepAlive: convertStringValues(process.env.REDIS_CLUSTER_KEEP_ALIVE),
    family: convertStringValues(process.env.REDIS_CLUSTER_FAMILY),
    keyPrefix: convertStringValues(process.env.REDIS_CLUSTER_KEY_PREFIX),
    tls: (process.env.ELASTICACHE_CLUSTER_SERVICE_TLS as ConnectionOptions)
      ? {
          servername: convertStringValues(process.env.ELASTICACHE_CLUSTER_SERVICE_HOST),
        }
      : {},
  };

  const { host } = redisClusterConfig;
  const port = redisClusterConfig.port ? Number(redisClusterConfig.port) : undefined;
  const { password } = redisClusterConfig;
  const connectTimeout = redisClusterConfig.connectTimeout
    ? Number(redisClusterConfig.connectTimeout)
    : DEFAULT_CONNECT_TIMEOUT;
  const family = redisClusterConfig.family ? Number(redisClusterConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisClusterConfig.keepAlive ? Number(redisClusterConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisClusterConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisClusterConfig.ttl ? Number(redisClusterConfig.ttl) : DEFAULT_TTL_SECONDS;

  const instances: ClusterNode[] = [{ host, port }];

  return {
    host,
    port,
    instances,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
    tls: redisClusterConfig.tls,
  };
};

export const getElasticacheCluster = (enableAutoPipelining?: boolean): Cluster | undefined => {
  const { instances, password, tls } = getElasticacheClusterProviderConfig();

  const options: ClusterOptions = {
    dnsLookup: (address, callback) => callback(null, address),
    enableAutoPipelining: enableAutoPipelining ?? false,
    enableOfflineQueue: false,
    enableReadyCheck: true,
    redisOptions: {
      tls,
      ...(password && { password }),
      connectTimeout: 10000,
    },
    scaleReads: 'slave',
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
    slotsRefreshTimeout: 10000,
  };

  Logger.log(
    `Initializing Elasticache Cluster Provider with ${instances?.length} instances and auto-pipelining as ${options.enableAutoPipelining}`
  );

  if (instances && instances.length > 0) {
    return new Redis.Cluster(instances, options);
  }

  return undefined;
};

export const validateElasticacheClusterProviderConfig = (): boolean => {
  const config = getElasticacheClusterProviderConfig();

  return !!config.host && !!config.port;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getElasticacheClusterProviderConfig(): IElasticacheClusterProviderConfig)
 - getElasticacheCluster(enableAutoPipelining?: boolean): Cluster | undefined)
 - ClusterOptions({
    dnsLookup: (address, callback))
 - validateElasticacheClusterProviderConfig(): boolean)
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/index.ts
Tamaño: 4619 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { PlatformException } from '../../../utils/exceptions';
import { InMemoryProviderEnum, Redis } from '../types';
import {
  getAzureCacheForRedisCluster,
  getAzureCacheForRedisClusterProviderConfig,
  IAzureCacheForRedisClusterProviderConfig,
  isClientReady as isAzureCacheForRedisClientReady,
  validateAzureCacheForRedisClusterProviderConfig,
} from './azure-cache-for-redis-cluster-provider';
import {
  getElasticacheCluster,
  getElasticacheClusterProviderConfig,
  IElasticacheClusterProviderConfig,
  isClientReady as isElasticacheClientReady,
  validateElasticacheClusterProviderConfig,
} from './elasticache-cluster-provider';
import {
  getMemoryDbCluster,
  getMemoryDbClusterProviderConfig,
  IMemoryDbClusterProviderConfig,
  isClientReady as isMemoryDbClientReady,
  validateMemoryDbClusterProviderConfig,
} from './memory-db-cluster-provider';
import {
  Cluster,
  getRedisCluster,
  getRedisClusterProviderConfig,
  IRedisClusterProviderConfig,
  isClientReady as isRedisClusterClientReady,
  validateRedisClusterProviderConfig
} from './redis-cluster-provider';
import {
  getRedisMasterSlaveCluster,
  getRedisMasterSlaveProviderConfig,
  IRedisMasterSlaveProviderConfig,
  isClientReady as isRedisMasterSlaveClientReady,
  validateRedisMasterSlaveProviderConfig,
} from './redis-master-slave-provider';


import {
  getRedisInstance,
  getRedisProviderConfig,
  IRedisProviderConfig,
  isClientReady as isRedisClientReady,
  validateRedisProviderConfig,
} from './redis-provider';

export type InMemoryProviderConfig =
  | IAzureCacheForRedisClusterProviderConfig
  | IElasticacheClusterProviderConfig
  | IMemoryDbClusterProviderConfig
  | IRedisProviderConfig
  | IRedisClusterProviderConfig
  | IRedisMasterSlaveProviderConfig;

const LOG_CONTEXT = 'InMemoryProviders';

export const getClientAndConfig = (): {
  getClient: () => Redis | undefined;
  getConfig: () => IRedisProviderConfig;
  isClientReady: (string) => boolean;
  provider: InMemoryProviderEnum;
  validate: () => boolean;
} => {
  return {
    getClient: getRedisInstance,
    getConfig: getRedisProviderConfig,
    isClientReady: isRedisClientReady,
    provider: InMemoryProviderEnum.REDIS,
    validate: validateRedisProviderConfig,
  };
};

export const getClientAndConfigForCluster = (
  providerId: InMemoryProviderEnum
): {
  getClient: (enableAutoPipelining?: boolean) => Cluster | undefined;
  getConfig: () => InMemoryProviderConfig;
  isClientReady: (string) => boolean;
  provider: InMemoryProviderEnum;
  validate: () => boolean;
} => {
  const clusterProviders = {
    [InMemoryProviderEnum.AZURE_CACHE_FOR_REDIS]: {
      getClient: getAzureCacheForRedisCluster,
      getConfig: getAzureCacheForRedisClusterProviderConfig,
      isClientReady: isAzureCacheForRedisClientReady,
      provider: InMemoryProviderEnum.AZURE_CACHE_FOR_REDIS,
      validate: validateAzureCacheForRedisClusterProviderConfig,
    },
    [InMemoryProviderEnum.ELASTICACHE]: {
      getClient: getElasticacheCluster,
      getConfig: getElasticacheClusterProviderConfig,
      isClientReady: isElasticacheClientReady,
      provider: InMemoryProviderEnum.ELASTICACHE,
      validate: validateElasticacheClusterProviderConfig,
    },
    [InMemoryProviderEnum.MEMORY_DB]: {
      getClient: getMemoryDbCluster,
      getConfig: getMemoryDbClusterProviderConfig,
      isClientReady: isMemoryDbClientReady,
      provider: InMemoryProviderEnum.MEMORY_DB,
      validate: validateMemoryDbClusterProviderConfig,
    },
    [InMemoryProviderEnum.REDIS_CLUSTER]: {
      getClient: getRedisCluster,
      getConfig: getRedisClusterProviderConfig,
      isClientReady: isRedisClusterClientReady,
      provider: InMemoryProviderEnum.REDIS_CLUSTER,
      validate: validateRedisClusterProviderConfig,
    },
    [InMemoryProviderEnum.REDIS_MASTER_SLAVE]: {
      getClient: getRedisMasterSlaveCluster,
      getConfig: getRedisMasterSlaveProviderConfig,
      isClientReady: isRedisMasterSlaveClientReady,
      provider: InMemoryProviderEnum.REDIS_MASTER_SLAVE,
      validate: validateRedisMasterSlaveProviderConfig,
    },
  };

  const provider = clusterProviders[providerId];

  if (!provider || !provider.validate()) {
    const defaultProvider = clusterProviders[InMemoryProviderEnum.REDIS_CLUSTER];
    if (!defaultProvider.validate()) {
      const message = `Provider ${providerId} is not properly configured in the environment variables`;
      Logger.error(message, LOG_CONTEXT);
      throw new PlatformException(message);
    }

    return defaultProvider;
  }

  return provider;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getClientAndConfig(): {
  getClient: ())
 - getClientAndConfigForCluster(providerId: InMemoryProviderEnum
): {
  getClient: (enableAutoPipelining?: boolean))
Declaraciones 'export' encontradas:
- export  type
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/memory-db-cluster-provider.ts
Tamaño: 4465 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import Redis, { Cluster, ClusterNode, ClusterOptions, NodeRole } from 'ioredis';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { Cluster, ClusterOptions };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_FAMILY = 4;
const DEFAULT_KEY_PREFIX = '';
const TTL_VARIANT_PERCENTAGE = 0.1;

interface IMemoryDbClusterConfig {
  connectTimeout?: string;
  family?: string;
  host?: string;
  keepAlive?: string;
  keyPrefix?: string;
  username?: string;
  password?: string;
  port?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IMemoryDbClusterProviderConfig {
  connectTimeout: number;
  family: number;
  host?: string;
  instances?: ClusterNode[];
  keepAlive: number;
  keyPrefix: string;
  username?: string;
  password?: string;
  port?: number;
  tls?: ConnectionOptions;
  ttl: number;
}

export const getMemoryDbClusterProviderConfig = (): IMemoryDbClusterProviderConfig => {
  const redisClusterConfig: IMemoryDbClusterConfig = {
    host: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_HOST),
    port: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_PORT),
    ttl: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_TTL),
    username: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_USERNAME),
    password: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_PASSWORD),
    connectTimeout: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_CONNECTION_TIMEOUT),
    keepAlive: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_KEEP_ALIVE),
    family: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_FAMILY),
    keyPrefix: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_KEY_PREFIX),
    tls: (process.env.MEMORY_DB_CLUSTER_SERVICE_TLS as ConnectionOptions)
      ? {
          servername: convertStringValues(process.env.MEMORY_DB_CLUSTER_SERVICE_HOST),
        }
      : {},
  };

  const { host } = redisClusterConfig;
  const port = redisClusterConfig.port ? Number(redisClusterConfig.port) : undefined;
  const { username } = redisClusterConfig;
  const { password } = redisClusterConfig;
  const connectTimeout = redisClusterConfig.connectTimeout
    ? Number(redisClusterConfig.connectTimeout)
    : DEFAULT_CONNECT_TIMEOUT;
  const family = redisClusterConfig.family ? Number(redisClusterConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisClusterConfig.keepAlive ? Number(redisClusterConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisClusterConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisClusterConfig.ttl ? Number(redisClusterConfig.ttl) : DEFAULT_TTL_SECONDS;

  const instances: ClusterNode[] = [{ host, port }];

  return {
    host,
    port,
    instances,
    username,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
    tls: redisClusterConfig.tls,
  };
};

export const getMemoryDbCluster = (enableAutoPipelining?: boolean): Cluster | undefined => {
  const { instances, password, username, tls } = getMemoryDbClusterProviderConfig();

  const options: ClusterOptions = {
    dnsLookup: (address, callback) => callback(null, address),
    enableAutoPipelining: enableAutoPipelining ?? false,
    enableOfflineQueue: false,
    redisOptions: {
      maxRetriesPerRequest: null,
      tls,
      connectTimeout: 10000,

      ...(password && { password }),
      ...(username && { username }),
    },
    clusterRetryStrategy: (times: number) => {
      return Math.max(Math.min(Math.exp(times), 20000), 1000);
    },
    scaleReads: 'master',
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
    slotsRefreshTimeout: 10000,
  };

  Logger.log(
    `Initializing MemoryDb Cluster Provider with ${instances?.length} instances and auto-pipelining as ${options.enableAutoPipelining}`
  );

  if (instances && instances.length > 0) {
    return new Redis.Cluster(instances, options);
  }

  return undefined;
};

export const validateMemoryDbClusterProviderConfig = (): boolean => {
  const config = getMemoryDbClusterProviderConfig();

  return !!config.host && !!config.port;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getMemoryDbClusterProviderConfig(): IMemoryDbClusterProviderConfig)
 - getMemoryDbCluster(enableAutoPipelining?: boolean): Cluster | undefined)
 - ClusterOptions({
    dnsLookup: (address, callback))
 - validateMemoryDbClusterProviderConfig(): boolean)
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/providers.spec.ts
Tamaño: 4625 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { InMemoryProviderEnum } from '../types';
import { IElasticacheClusterProviderConfig } from './elasticache-cluster-provider';
import { getClientAndConfigForCluster } from './index';
import { IMemoryDbClusterProviderConfig } from './memory-db-cluster-provider';
import { IRedisClusterProviderConfig } from './redis-cluster-provider';

describe('Client and config for cluster', () => {
  const elasticacheUrl = 'http://elasticache.com';
  const elasticachePort = '10000';
  const memoryDbUrl = 'http://memory-db.com';
  const memoryDbPort = '10001';
  const redisClusterUrl = 'http://redis.com';
  const redisClusterPorts = JSON.stringify([9991, 9992, 9993, 9994, 9995, 9996]);

  it('should return Elasticache config after validating it', () => {
    process.env.ELASTICACHE_CLUSTER_SERVICE_HOST = elasticacheUrl;
    process.env.ELASTICACHE_CLUSTER_SERVICE_PORT = elasticachePort;
    process.env.REDIS_CLUSTER_SERVICE_HOST = redisClusterUrl;
    process.env.REDIS_CLUSTER_SERVICE_PORTS = redisClusterPorts;

    const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.ELASTICACHE);
    const config: IElasticacheClusterProviderConfig = getConfig();
    expect(config.host).toEqual(elasticacheUrl);
    expect(config.port).toEqual(Number(elasticachePort));
    expect(config.ttl).toEqual(7200);
  });

  it('should return MemoryDB config after validating it', () => {
    process.env.MEMORY_DB_CLUSTER_SERVICE_HOST = memoryDbUrl;
    process.env.MEMORY_DB_CLUSTER_SERVICE_PORT = memoryDbPort;
    process.env.REDIS_CLUSTER_SERVICE_HOST = redisClusterUrl;
    process.env.REDIS_CLUSTER_SERVICE_PORTS = redisClusterPorts;

    const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.MEMORY_DB);
    const config: IMemoryDbClusterProviderConfig = getConfig();
    expect(config.host).toEqual(memoryDbUrl);
    expect(config.port).toEqual(Number(memoryDbPort));
    expect(config.ttl).toEqual(7200);
  });

  it('should return Redis Cluster config after validating Elasticache faulty URL config', () => {
    process.env.ELASTICACHE_CLUSTER_SERVICE_HOST = '';
    process.env.ELASTICACHE_CLUSTER_SERVICE_PORT = elasticachePort;
    process.env.REDIS_CLUSTER_SERVICE_HOST = redisClusterUrl;
    process.env.REDIS_CLUSTER_SERVICE_PORTS = redisClusterPorts;

    const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.ELASTICACHE);
    const config: IRedisClusterProviderConfig = getConfig();
    expect(config.host).toEqual(redisClusterUrl);
    expect(config.ports).toEqual(JSON.parse(redisClusterPorts));
    expect(config.ttl).toEqual(7200);
  });

  it('should return Redis Cluster config after validating Elasticache faulty port config', () => {
    process.env.ELASTICACHE_CLUSTER_SERVICE_HOST = elasticacheUrl;
    process.env.ELASTICACHE_CLUSTER_SERVICE_PORT = '';
    process.env.REDIS_CLUSTER_SERVICE_HOST = redisClusterUrl;
    process.env.REDIS_CLUSTER_SERVICE_PORTS = redisClusterPorts;

    const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.ELASTICACHE);

    const config: IRedisClusterProviderConfig = getConfig();
    expect(config.host).toEqual(redisClusterUrl);
    expect(config.ports).toEqual(JSON.parse(redisClusterPorts));
    expect(config.ttl).toEqual(7200);
  });

  it('should throw an error if Redis Cluster config has faulty URL config', () => {
    process.env.ELASTICACHE_CLUSTER_SERVICE_HOST = '';
    process.env.ELASTICACHE_CLUSTER_SERVICE_PORT = '';
    process.env.REDIS_CLUSTER_SERVICE_HOST = '';
    process.env.REDIS_CLUSTER_SERVICE_PORTS = redisClusterPorts;

    try {
      const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.ELASTICACHE);

      fail('should not reach here');
    } catch (error) {
      expect(error).toBeInstanceOf(Error);
      const { message } = error as Error;
      expect(message).toEqual('Provider Elasticache is not properly configured in the environment variables');
    }
  });

  it('should throw an error if Redis Cluster config has faulty port config', () => {
    process.env.ELASTICACHE_CLUSTER_SERVICE_HOST = '';
    process.env.ELASTICACHE_CLUSTER_SERVICE_PORT = '';
    process.env.REDIS_CLUSTER_SERVICE_HOST = redisClusterUrl;
    process.env.REDIS_CLUSTER_SERVICE_PORTS = '';

    try {
      const { getConfig } = getClientAndConfigForCluster(InMemoryProviderEnum.ELASTICACHE);

      fail('should not reach here');
    } catch (error) {
      expect(error).toBeInstanceOf(Error);
      const { message } = error as Error;
      expect(message).toEqual('Provider Elasticache is not properly configured in the environment variables');
    }
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - redisClusterPorts(JSON.stringify([9991, 9992, 9993, 9994, 9995, 9996]);

  it('should return Elasticache config after ...)
 - IElasticacheClusterProviderConfig(getConfig();
    expect(config.host).toEqual(elasticacheUrl);
    expect(config.port).toEqual(Number...)
 - IMemoryDbClusterProviderConfig(getConfig();
    expect(config.host).toEqual(memoryDbUrl);
    expect(config.port).toEqual(Number(me...)
 - IRedisClusterProviderConfig(getConfig();
    expect(config.host).toEqual(redisClusterUrl);
    expect(config.ports).toEqual(JSON...)
 - IRedisClusterProviderConfig(getConfig();
    expect(config.host).toEqual(redisClusterUrl);
    expect(config.ports).toEqual(JSON...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/redis-cluster-provider.ts
Tamaño: 3862 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import Redis, { ChainableCommander, Cluster, ClusterNode, ClusterOptions } from 'ioredis';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { ChainableCommander, Cluster, ClusterOptions };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_FAMILY = 4;
const DEFAULT_KEY_PREFIX = '';
const TTL_VARIANT_PERCENTAGE = 0.1;

interface IRedisClusterConfig {
  connectTimeout?: string;
  family?: string;
  host?: string;
  keepAlive?: string;
  keyPrefix?: string;
  password?: string;
  ports?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IRedisClusterProviderConfig {
  connectTimeout: number;
  family: number;
  host?: string;
  instances?: ClusterNode[];
  keepAlive: number;
  keyPrefix: string;
  password?: string;
  ports?: number[];
  tls?: ConnectionOptions;
  ttl: number;
}

export const getRedisClusterProviderConfig = (): IRedisClusterProviderConfig => {
  const redisClusterConfig: IRedisClusterConfig = {
    host: convertStringValues(process.env.REDIS_CLUSTER_SERVICE_HOST),
    ports: convertStringValues(process.env.REDIS_CLUSTER_SERVICE_PORTS),
    ttl: convertStringValues(process.env.REDIS_CLUSTER_TTL),
    password: convertStringValues(process.env.REDIS_CLUSTER_PASSWORD),
    connectTimeout: convertStringValues(process.env.REDIS_CLUSTER_CONNECTION_TIMEOUT),
    keepAlive: convertStringValues(process.env.REDIS_CLUSTER_KEEP_ALIVE),
    family: convertStringValues(process.env.REDIS_CLUSTER_FAMILY),
    keyPrefix: convertStringValues(process.env.REDIS_CLUSTER_KEY_PREFIX),
    tls: process.env.REDIS_CLUSTER_TLS as ConnectionOptions,
  };

  const { host } = redisClusterConfig;
  const ports = redisClusterConfig.ports ? JSON.parse(redisClusterConfig.ports) : [];
  const { password } = redisClusterConfig;
  const connectTimeout = redisClusterConfig.connectTimeout
    ? Number(redisClusterConfig.connectTimeout)
    : DEFAULT_CONNECT_TIMEOUT;
  const family = redisClusterConfig.family ? Number(redisClusterConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisClusterConfig.keepAlive ? Number(redisClusterConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisClusterConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisClusterConfig.ttl ? Number(redisClusterConfig.ttl) : DEFAULT_TTL_SECONDS;

  const instances: ClusterNode[] = ports.map((port: number): ClusterNode => ({ host, port }));

  return {
    host,
    ports,
    instances,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
  };
};

export const getRedisCluster = (enableAutoPipelining?: boolean): Cluster | undefined => {
  const { instances } = getRedisClusterProviderConfig();

  const options: ClusterOptions = {
    enableAutoPipelining: enableAutoPipelining ?? false,
    enableOfflineQueue: false,
    enableReadyCheck: true,
    scaleReads: 'slave',
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
    slotsRefreshTimeout: 2000,
  };

  Logger.log(
    `Initializing Redis Cluster Provider with ${instances?.length} instances and auto-pipelining as ${options.enableAutoPipelining}`
  );

  if (instances && instances.length > 0) {
    return new Redis.Cluster(instances, options);
  }

  return undefined;
};

export const validateRedisClusterProviderConfig = (): boolean => {
  const config = getRedisClusterProviderConfig();

  const validPorts =
    config.ports && config.ports.length > 0 && config.ports.every((port: number) => Number.isInteger(port));

  return !!config.host && !!validPorts;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getRedisClusterProviderConfig(): IRedisClusterProviderConfig)
 - getRedisCluster(enableAutoPipelining?: boolean): Cluster | undefined)
 - validateRedisClusterProviderConfig(): boolean)
 - validPorts(config.ports && config.ports.length > 0 && config.ports.every((port: number))
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/redis-master-slave-provider.ts
Tamaño: 5651 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import Redis, { Cluster, ClusterNode, ClusterOptions, NodeRole } from 'ioredis';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { Cluster, ClusterOptions };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_FAMILY = 4;
const DEFAULT_KEY_PREFIX = '';

interface IRedisMasterSlaveConfig {
  connectTimeout?: string;
  family?: string;
  masterHost?: string;
  masterPort?: string;
  slaveHost?: string;
  slavePort?: string;
  keepAlive?: string;
  keyPrefix?: string;
  password?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IRedisMasterSlaveProviderConfig {
  connectTimeout: number;
  family: number;
  host?: string; // Master host (for compatibility with generic provider interface)
  port?: number; // Master port (for compatibility with generic provider interface)
  masterHost?: string;
  masterPort?: number;
  slaveHost?: string;
  slavePort?: number;
  instances?: ClusterNode[];
  keepAlive: number;
  keyPrefix: string;
  password?: string;
  username?: string;
  tls?: ConnectionOptions;
  ttl: number;
}

export const getRedisMasterSlaveProviderConfig = (): IRedisMasterSlaveProviderConfig => {
  const redisMasterSlaveConfig: IRedisMasterSlaveConfig = {
    masterHost: convertStringValues(process.env.REDIS_MASTER_HOST),
    masterPort: convertStringValues(process.env.REDIS_MASTER_PORT),
    slaveHost: convertStringValues(process.env.REDIS_SLAVE_HOST),
    slavePort: convertStringValues(process.env.REDIS_SLAVE_PORT),
    ttl: convertStringValues(process.env.REDIS_CLUSTER_TTL),
    password: convertStringValues(process.env.REDIS_CLUSTER_PASSWORD),
    connectTimeout: convertStringValues(process.env.REDIS_CLUSTER_CONNECTION_TIMEOUT),
    keepAlive: convertStringValues(process.env.REDIS_CLUSTER_KEEP_ALIVE),
    family: convertStringValues(process.env.REDIS_CLUSTER_FAMILY),
    keyPrefix: convertStringValues(process.env.REDIS_CLUSTER_KEY_PREFIX),
    tls: process.env.REDIS_CLUSTER_TLS
      ? {
          servername: convertStringValues(process.env.REDIS_MASTER_HOST),
        }
      : undefined,
  };

  const { masterHost, slaveHost } = redisMasterSlaveConfig;
  const masterPort = redisMasterSlaveConfig.masterPort ? Number(redisMasterSlaveConfig.masterPort) : 6379;
  // If slave port not specified, default to 6379 or same as master port if master port is custom
  let slavePort = 6379;
  if (redisMasterSlaveConfig.slavePort) {
    slavePort = Number(redisMasterSlaveConfig.slavePort);
  } else if (redisMasterSlaveConfig.masterPort) {
    slavePort = masterPort;
  }
  const { password } = redisMasterSlaveConfig;
  const connectTimeout = redisMasterSlaveConfig.connectTimeout
    ? Number(redisMasterSlaveConfig.connectTimeout)
    : DEFAULT_CONNECT_TIMEOUT;
  const family = redisMasterSlaveConfig.family ? Number(redisMasterSlaveConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisMasterSlaveConfig.keepAlive ? Number(redisMasterSlaveConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisMasterSlaveConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisMasterSlaveConfig.ttl ? Number(redisMasterSlaveConfig.ttl) : DEFAULT_TTL_SECONDS;

  // Create instances array with master and slave nodes
  const instances: ClusterNode[] = [];

  // Master is required
  if (masterHost && masterPort) {
    instances.push({ host: masterHost, port: masterPort });
  }

  // Slave is optional - if not provided, will work as single master
  if (slaveHost && slavePort) {
    instances.push({ host: slaveHost, port: slavePort });
  }

  return {
    host: masterHost, // Alias for masterHost (for compatibility)
    port: masterPort, // Alias for masterPort (for compatibility)
    masterHost,
    masterPort,
    slaveHost,
    slavePort,
    instances,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
    tls: redisMasterSlaveConfig.tls,
  };
};

export const getRedisMasterSlaveCluster = (enableAutoPipelining?: boolean): Cluster | undefined => {
  const { instances, password, tls } = getRedisMasterSlaveProviderConfig();

  const options: ClusterOptions = {
    enableAutoPipelining: enableAutoPipelining ?? false,
    enableOfflineQueue: false,
    enableReadyCheck: true,
    redisOptions: {
      tls,
      ...(password && { password }),
      connectTimeout: 10000,
    },
    // Scale reads to slave nodes for better performance
    scaleReads: 'slave',
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
    slotsRefreshTimeout: 10000,
  };

  Logger.log(
    `Initializing Redis Master-Slave Provider with ${instances?.length} instances ` +
      `(master-slave setup) and auto-pipelining as ${options.enableAutoPipelining}`
  );

  if (instances && instances.length > 0) {
    return new Redis.Cluster(instances, options);
  }

  return undefined;
};

export const validateRedisMasterSlaveProviderConfig = (): boolean => {
  const config = getRedisMasterSlaveProviderConfig();

  // Only master host is required, everything else has sensible defaults
  const hasMaster = !!config.masterHost;
  const hasSlave = !!config.slaveHost;

  Logger.log(
    `Redis Master-Slave validation: Master ${hasMaster ? 'configured' : 'missing'}, ` +
      `Slave ${hasSlave ? 'configured' : 'not configured (will use master-only mode)'}`
  );

  return hasMaster;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getRedisMasterSlaveProviderConfig(): IRedisMasterSlaveProviderConfig)
 - getRedisMasterSlaveCluster(enableAutoPipelining?: boolean): Cluster | undefined)
 - validateRedisMasterSlaveProviderConfig(): boolean)
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/redis-provider.ts
Tamaño: 3573 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import Redis, { RedisOptions, ScanStream } from 'ioredis';
import newrelic from 'newrelic';
import { ConnectionOptions } from 'tls';

import { convertStringValues } from './variable-mappers';

export { Redis, RedisOptions, ScanStream };

export const CLIENT_READY = 'ready';
const DEFAULT_TTL_SECONDS = 60 * 60 * 2;
const DEFAULT_CONNECT_TIMEOUT = 50000;
const DEFAULT_HOST = 'localhost';
const DEFAULT_KEEP_ALIVE = 30000;
const DEFAULT_KEY_PREFIX = '';
const DEFAULT_FAMILY = 4;
const DEFAULT_PORT = 6379;

interface IRedisConfig {
  db?: string;
  connectTimeout?: string;
  family?: string;
  host?: string;
  keepAlive?: string;
  keyPrefix?: string;
  password?: string;
  port?: string;
  tls?: ConnectionOptions;
  ttl?: string;
}

export interface IRedisProviderConfig {
  db?: number;
  connectTimeout: number;
  family: number;
  host?: string;
  keepAlive: number;
  keyPrefix: string;
  password?: string;
  username?: string;
  port?: number;
  tls?: ConnectionOptions;
  ttl: number;
}

export const getRedisProviderConfig = (): IRedisProviderConfig => {
  const redisConfig: IRedisConfig = {
    db: convertStringValues(process.env.REDIS_DB_INDEX),
    host: convertStringValues(process.env.REDIS_HOST),
    port: convertStringValues(process.env.REDIS_PORT),
    ttl: convertStringValues(process.env.REDIS_TTL),
    password: convertStringValues(process.env.REDIS_PASSWORD),
    connectTimeout: convertStringValues(process.env.REDIS_CONNECT_TIMEOUT),
    keepAlive: convertStringValues(process.env.REDIS_KEEP_ALIVE),
    family: convertStringValues(process.env.REDIS_FAMILY),
    keyPrefix: convertStringValues(process.env.REDIS_PREFIX),
    tls: process.env.REDIS_TLS as ConnectionOptions,
  };

  const db = redisConfig.db ? Number(redisConfig.db) : undefined;
  const port = redisConfig.port ? Number(redisConfig.port) : DEFAULT_PORT;
  const host = redisConfig.host || DEFAULT_HOST;
  const { password } = redisConfig;
  const connectTimeout = redisConfig.connectTimeout ? Number(redisConfig.connectTimeout) : DEFAULT_CONNECT_TIMEOUT;
  const family = redisConfig.family ? Number(redisConfig.family) : DEFAULT_FAMILY;
  const keepAlive = redisConfig.keepAlive ? Number(redisConfig.keepAlive) : DEFAULT_KEEP_ALIVE;
  const keyPrefix = redisConfig.keyPrefix ?? DEFAULT_KEY_PREFIX;
  const ttl = redisConfig.ttl ? Number(redisConfig.ttl) : DEFAULT_TTL_SECONDS;
  const { tls } = redisConfig;

  return {
    db,
    host,
    port,
    password,
    connectTimeout,
    family,
    keepAlive,
    keyPrefix,
    ttl,
    tls,
  };
};

export const getRedisInstance = (): Redis | undefined => {
  const { port, host, ...configOptions } = getRedisProviderConfig();

  const options = {
    ...configOptions,
    maxRetriesPerRequest: null,
    /*
     *  Disabled in Prod as affects performance
     */
    showFriendlyErrorStack: process.env.NODE_ENV !== 'production',
  };

  if (port && host) {
    const redisInstance = new Redis(port, host, options);
    const isNewRelicEnabled = typeof newrelic !== 'undefined' && newrelic.instrumentDatastore;
    const isNewRelicEnvSet = process.env.NEW_RELIC_LICENSE_KEY && process.env.NEW_RELIC_APP_NAME;

    if (isNewRelicEnabled && isNewRelicEnvSet) {
      newrelic.instrumentDatastore('Redis', () => redisInstance);
    }

    return redisInstance;
  }

  return undefined;
};

export const validateRedisProviderConfig = (): boolean => {
  const config = getRedisProviderConfig();

  return !!config.host && !!config.port;
};

export const isClientReady = (status: string): boolean => status === CLIENT_READY;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getRedisProviderConfig(): IRedisProviderConfig)
 - getRedisInstance(): Redis | undefined)
 - isNewRelicEnvSet(process.env.NEW_RELIC_LICENSE_KEY && process.env.NEW_RELIC_APP_NAME;

    if (isNewRelicEnabled && i...)
 - validateRedisProviderConfig(): boolean)
 - isClientReady(status: string): boolean)
Declaraciones 'export' encontradas:
- export
- export  const
- export  interface
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/in-memory-provider/providers/variable-mappers.ts
Tamaño: 544 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * Due some problems with Azure Redis DB that doesn't allow for certain
 * configuration values to be empty or have an empty string and as we don't
 * want to process them in our provider configuration files, we implement
 * this mapper function to be able to overcome that limitation in Azure
 * temporarily while we find a better solution
 */
export const convertStringValues = (value: string | undefined): string | undefined => {
  if (!value || value === 'undefined' || value === 'null') {
    return undefined;
  }

  return value;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - convertStringValues(value: string | undefined): string | undefined)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/metrics/index.ts
Tamaño: 481 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MetricsService, NewRelicMetricsService } from './metrics.service';

export const metricsServiceList = {
  provide: 'MetricsServices',
  useFactory: (newRelicMetricsService: NewRelicMetricsService) => {
    const allMetricsServices = [newRelicMetricsService];

    const activeMetricsServices = allMetricsServices.filter((service) => service.isActive(process.env));

    return activeMetricsServices;
  },
  inject: [NewRelicMetricsService],
};

export { MetricsService };


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - metricsServiceList({
  provide: 'MetricsServices',
  useFactory: (newRelicMetricsService: NewRelicMetricsService))
 - activeMetricsServices(allMetricsServices.filter((service))
Declaraciones 'export' encontradas:
- export  const
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/metrics/metrics.interface.ts
Tamaño: 147 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IMetricsService {
  recordMetric(name: string, value: number): Promise<void>;
  isActive(env: Record<string, string>): boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/metrics/metrics.service.spec.ts
Tamaño: 1975 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test, TestingModule } from '@nestjs/testing';
import { metricsServiceList } from './index';
import { IMetricsService } from './metrics.interface';
import { MetricsService, NewRelicMetricsService } from './metrics.service';

describe('MetricsService', () => {
  let service: MetricsService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        MetricsService,
        NewRelicMetricsService,
        {
          provide: 'MetricsServices',
          useFactory: (newRelicMetricsService: NewRelicMetricsService) => [newRelicMetricsService],
          inject: [NewRelicMetricsService],
        },
      ],
    }).compile();

    service = module.get<MetricsService>(MetricsService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });

  describe('recordMetric', () => {
    it('should call recordMetric on all services', () => {
      const metricName = 'testMetric';
      const metricValue = 123;

      const spyNewRelic = jest.spyOn(NewRelicMetricsService.prototype, 'recordMetric');
      service.recordMetric(metricName, metricValue);

      expect(spyNewRelic).toHaveBeenCalledWith(metricName, metricValue);
    });
  });

  describe('metricsServiceList', () => {
    const createServices = async () =>
      (
        (await Test.createTestingModule({
          providers: [metricsServiceList, MetricsService, NewRelicMetricsService],
        }).compile()) as TestingModule
      ).get<IMetricsService[]>('MetricsServices');

    describe('NewRelic', () => {
      it('should contain NewRelicMetricsService if NEW_RELIC_LICENSE_KEY is set', async () => {
        process.env.NEW_RELIC_LICENSE_KEY = 'test';
        const metricsServices = await createServices();

        expect(metricsServices.some((metricsService) => metricsService instanceof NewRelicMetricsService)).toBe(true);
        delete process.env.NEW_RELIC_LICENSE_KEY;
      });
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - TestingModule(await Test.createTestingModule({
      providers: [
        MetricsService,
        NewRelicMetricsS...)
 - service(module.get<MetricsService>(MetricsService);
  });

  it('should be defined', ())
 - spyNewRelic(jest.spyOn(NewRelicMetricsService.prototype, 'recordMetric');
      service.recordMetric(metricName,...)
 - createServices(async ())
 - metricsServices(await createServices();

        expect(metricsServices.some((metricsService))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/metrics/metrics.service.ts
Tamaño: 1252 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { IMetricsService } from './metrics.interface';

const nr = require('newrelic');

const LOG_CONTEXT = 'MetricsService';

@Injectable()
export class MetricsService {
  constructor(@Inject('MetricsServices') private services: IMetricsService[]) {
    Logger.log(
      `MetricsService running with: [${this.services
        .map((metricService) => metricService.constructor.name)
        .join(', ')}]`,
      LOG_CONTEXT
    );
  }

  recordMetric(name: string, value: number): void {
    Logger.verbose(`Recording metric ${name} with value ${value}`, LOG_CONTEXT);
    const proms = this.services.map((service) => {
      return service.recordMetric(name, value).catch((e) => {
        Logger.error(
          `Failed to record metric ${name} with value ${value} for service ${service.constructor.name}.\nError: ${e}`,
          LOG_CONTEXT
        );
      });
    });

    Promise.all(proms);
  }
}

@Injectable()
export class NewRelicMetricsService implements IMetricsService {
  async recordMetric(name: string, value: number): Promise<void> {
    nr.recordMetric(name, value);
  }

  isActive(env: Record<string, string>): boolean {
    return !!env.NEW_RELIC_LICENSE_KEY;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('MetricsService';

@Injectable()
export class MetricsService {
  constructor(@Inject('MetricsService...)
 - proms(this.services.map((service))
Declaraciones 'export' encontradas:
- export class MetricsService
- export class NewRelicMetricsService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/active-jobs-metric-queue.service.spec.ts
Tamaño: 2664 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { ActiveJobsMetricQueueService } from './active-jobs-metric-queue.service';

let activeJobsMetricQueueService: ActiveJobsMetricQueueService;

describe('Job metrics Queue service', () => {
  describe('General', () => {
    beforeAll(async () => {
      activeJobsMetricQueueService = new ActiveJobsMetricQueueService(new WorkflowInMemoryProviderService());
      await activeJobsMetricQueueService.queue.drain();
    });

    beforeEach(async () => {
      await activeJobsMetricQueueService.queue.drain();
    });

    afterEach(async () => {
      await activeJobsMetricQueueService.queue.drain();
    });

    afterAll(async () => {
      await activeJobsMetricQueueService.gracefulShutdown();
    });

    it('should be initialised properly', async () => {
      expect(activeJobsMetricQueueService).toBeDefined();
      expect(Object.keys(activeJobsMetricQueueService)).toEqual(
        expect.arrayContaining(['topic', 'DEFAULT_ATTEMPTS', 'instance', 'queue'])
      );
      expect(activeJobsMetricQueueService.DEFAULT_ATTEMPTS).toEqual(3);
      expect(activeJobsMetricQueueService.topic).toEqual('metric-active-jobs');
      expect(await activeJobsMetricQueueService.getStatus()).toEqual({
        queueIsPaused: false,
        queueName: 'metric-active-jobs',
        workerName: undefined,
        workerIsPaused: undefined,
        workerIsRunning: undefined,
      });
      expect(await activeJobsMetricQueueService.isPaused()).toEqual(false);
      expect(activeJobsMetricQueueService.queue).toMatchObject(
        expect.objectContaining({
          _events: {},
          _eventsCount: 0,
          _maxListeners: undefined,
          name: 'metric-active-jobs',
          jobsOpts: {
            removeOnComplete: true,
          },
        })
      );
      expect(activeJobsMetricQueueService.queue.opts.prefix).toEqual('bull');
    });
  });

  describe('Cluster mode', () => {
    beforeAll(async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      activeJobsMetricQueueService = new ActiveJobsMetricQueueService(new WorkflowInMemoryProviderService());
      await activeJobsMetricQueueService.queue.obliterate();
    });

    afterAll(async () => {
      await activeJobsMetricQueueService.gracefulShutdown();
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    });

    it('should have prefix in cluster mode', async () => {
      expect(activeJobsMetricQueueService.queue.opts.prefix).toEqual('{metric-active-jobs}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - activeJobsMetricQueueService(new ActiveJobsMetricQueueService(new WorkflowInMemoryProviderService());
      await activeJobsMetri...)
 - activeJobsMetricQueueService(new ActiveJobsMetricQueueService(new WorkflowInMemoryProviderService());
      await activeJobsMetri...)
 - IS_IN_MEMORY_CLUSTER_MODE_ENABLED('false';
    });

    it('should have prefix in cluster mode', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/active-jobs-metric-queue.service.ts
Tamaño: 703 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { QueueBaseService } from './queue-base.service';

const LOG_CONTEXT = 'ActiveJobsMetricQueueService';

@Injectable()
export class ActiveJobsMetricQueueService extends QueueBaseService {
  constructor(public workflowInMemoryProviderService: WorkflowInMemoryProviderService) {
    super(JobTopicNameEnum.ACTIVE_JOBS_METRIC, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, LOG_CONTEXT);

    this.createQueue();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ActiveJobsMetricQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/inbound-parse-queue.service.spec.ts
Tamaño: 4829 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { IHeaders, IInboundParseJobDto } from '../../dtos';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { InboundParseQueueService } from './inbound-parse-queue.service';

let inboundParseQueueService: InboundParseQueueService;

describe('Inbound Parse Queue service', () => {
  describe('General', () => {
    beforeAll(async () => {
      inboundParseQueueService = new InboundParseQueueService(new WorkflowInMemoryProviderService());
      await inboundParseQueueService.queue.obliterate();
    });

    beforeEach(async () => {
      await inboundParseQueueService.queue.drain();
    });

    afterAll(async () => {
      await inboundParseQueueService.gracefulShutdown();
    });

    it('should be initialised properly', async () => {
      expect(inboundParseQueueService).toBeDefined();
      expect(Object.keys(inboundParseQueueService)).toEqual(
        expect.arrayContaining(['topic', 'DEFAULT_ATTEMPTS', 'instance', 'queue'])
      );
      expect(inboundParseQueueService.DEFAULT_ATTEMPTS).toEqual(3);
      expect(inboundParseQueueService.topic).toEqual('inbound-parse-mail');
      expect(await inboundParseQueueService.getStatus()).toEqual({
        queueIsPaused: false,
        queueName: 'inbound-parse-mail',
        workerName: undefined,
        workerIsPaused: undefined,
        workerIsRunning: undefined,
      });
      expect(await inboundParseQueueService.isPaused()).toEqual(false);
      expect(inboundParseQueueService.queue).toMatchObject(
        expect.objectContaining({
          _events: {},
          _eventsCount: 0,
          _maxListeners: undefined,
          name: 'inbound-parse-mail',
          jobsOpts: {
            removeOnComplete: true,
          },
        })
      );
      expect(inboundParseQueueService.queue.opts.prefix).toEqual('bull');
    });

    it('should add a job in the queue', async () => {
      const jobId = 'inbound-parse-mail-job-id';
      const _organizationId = 'inbound-parse-mail-organization-id';
      const jobData = {
        html: '<>Hello World</>',
        text: 'text',
        subject: 'subject',
        messageId: '123',
      };

      await inboundParseQueueService.add({
        name: jobId,
        data: jobData as any,
        groupId: _organizationId,
      });

      expect(await inboundParseQueueService.queue.getActiveCount()).toEqual(0);
      expect(await inboundParseQueueService.queue.getWaitingCount()).toEqual(1);

      const inboundParseQueueJobs = await inboundParseQueueService.queue.getJobs();
      expect(inboundParseQueueJobs.length).toEqual(1);
      const [inboundParseQueueJob] = inboundParseQueueJobs;
      expect(inboundParseQueueJob).toMatchObject(
        expect.objectContaining({
          id: '1',
          name: jobId,
          data: jobData,
          attemptsMade: 0,
        })
      );
    });

    it('should add a minimal job in the queue', async () => {
      const jobId = 'inbound-parse-mail-job-id-2';
      const _environmentId = 'inbound-parse-mail-environment-id';
      const _organizationId = 'inbound-parse-mail-organization-id';
      const _userId = 'inbound-parse-mail-user-id';
      const jobData = {
        html: '<>Hello World</>',
        text: 'text',
        subject: 'subject',
        messageId: '123',
      };

      await inboundParseQueueService.add({
        name: jobId,
        data: jobData as any,
        groupId: _organizationId,
      });

      expect(await inboundParseQueueService.queue.getActiveCount()).toEqual(0);
      expect(await inboundParseQueueService.queue.getWaitingCount()).toEqual(1);

      const inboundParseQueueJobs = await inboundParseQueueService.queue.getJobs();
      expect(inboundParseQueueJobs.length).toEqual(1);
      const [inboundParseQueueJob] = inboundParseQueueJobs;
      expect(inboundParseQueueJob).toMatchObject(
        expect.objectContaining({
          id: '2',
          name: jobId,
          data: {
            _id: jobId,
            _environmentId,
            _organizationId,
            _userId,
          },
          attemptsMade: 0,
        })
      );
    });
  });

  describe('Cluster mode', () => {
    beforeAll(async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      inboundParseQueueService = new InboundParseQueueService(new WorkflowInMemoryProviderService());
      await inboundParseQueueService.queue.obliterate();
    });

    afterAll(async () => {
      await inboundParseQueueService.gracefulShutdown();
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    });

    it('should have prefix in cluster mode', async () => {
      expect(inboundParseQueueService.queue.opts.prefix).toEqual('{inbound-parse-mail}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - inboundParseQueueService(new InboundParseQueueService(new WorkflowInMemoryProviderService());
      await inboundParseQueueSe...)
 - inboundParseQueueService(new InboundParseQueueService(new WorkflowInMemoryProviderService());
      await inboundParseQueueSe...)
 - IS_IN_MEMORY_CLUSTER_MODE_ENABLED('false';
    });

    it('should have prefix in cluster mode', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/inbound-parse-queue.service.ts
Tamaño: 1293 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { IInboundParseBulkJobDto, IInboundParseJobDto } from '../../dtos/inbound-parse-job.dto';

import { BullMqService, QueueOptions } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { QueueBaseService } from './queue-base.service';

const LOG_CONTEXT = 'InboundParseQueueService';

@Injectable()
export class InboundParseQueueService extends QueueBaseService {
  constructor(public workflowInMemoryProviderService: WorkflowInMemoryProviderService) {
    super(JobTopicNameEnum.INBOUND_PARSE_MAIL, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, LOG_CONTEXT);

    this.createQueue(this.getOverrideOptions());
  }

  public async add(data: IInboundParseJobDto) {
    return await super.add(data);
  }

  public async addBulk(data: IInboundParseBulkJobDto[]) {
    return await super.addBulk(data);
  }

  private getOverrideOptions(): QueueOptions {
    return {
      defaultJobOptions: {
        attempts: 5,
        backoff: {
          delay: 4000,
          type: 'exponential',
        },
        removeOnComplete: true,
        removeOnFail: true,
      },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class InboundParseQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/index.ts
Tamaño: 498 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ActiveJobsMetricQueueService } from './active-jobs-metric-queue.service';
export { InboundParseQueueService } from './inbound-parse-queue.service';
export { QueueBaseService } from './queue-base.service';
export { StandardQueueService } from './standard-queue.service';
export { SubscriberProcessQueueService } from './subscriber-process-queue.service';
export { WebSocketsQueueService } from './web-sockets-queue.service';
export { WorkflowQueueService } from './workflow-queue.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/queue-base.service.ts
Tamaño: 2619 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { IJobData, JobTopicNameEnum } from '@novu/shared';

import { BulkJobOptions, BullMqService, JobsOptions, Queue, QueueOptions } from '../bull-mq';

const LOG_CONTEXT = 'QueueService';

export class QueueBaseService {
  private instance: BullMqService;

  public readonly DEFAULT_ATTEMPTS = 3;
  public queue: Queue;

  constructor(
    public readonly topic: JobTopicNameEnum,
    private bullMqService: BullMqService
  ) {
    this.instance = bullMqService;
  }

  public createQueue(overrideOptions?: QueueOptions): void {
    const options = {
      ...this.getQueueOptions(),
      ...(overrideOptions && {
        defaultJobOptions: {
          ...this.getQueueOptions().defaultJobOptions,
          ...overrideOptions.defaultJobOptions,
        },
      }),
    };

    this.queue = this.instance.createQueue(this.topic, options);
  }

  private getQueueOptions(): QueueOptions {
    return {
      defaultJobOptions: {
        removeOnComplete: true,
      },
    };
  }

  public isReady(): boolean {
    return this.instance.isClientReady();
  }

  public async isPaused(): Promise<boolean> {
    return await this.instance.isQueuePaused();
  }

  public async getStatus() {
    return await this.instance.getStatus();
  }

  public async getGroupsJobsCount() {
    return await (this.instance.queue as any).getGroupsJobsCount();
  }

  public async getWaitingCount() {
    return await this.instance.queue.getWaitingCount();
  }

  public async getDelayedCount() {
    return await this.instance.queue.getDelayedCount();
  }

  public async getActiveCount() {
    return await this.instance.queue.getActiveCount();
  }

  public async gracefulShutdown(): Promise<void> {
    Logger.log(`Shutting the ${this.topic} queue service down`, LOG_CONTEXT);

    this.queue = undefined;
    await this.instance.gracefulShutdown();

    Logger.log(`Shutting down the ${this.topic} queue service has finished`, LOG_CONTEXT);
  }

  public async add(params: IJobParams) {
    const jobOptions = {
      removeOnComplete: true,
      removeOnFail: true,
      ...params.options,
    };

    await this.instance.add(params.name, params.data, jobOptions, params.groupId);
  }

  public async addBulk(data: IBulkJobParams[]) {
    await this.instance.addBulk(data);
  }

  async onModuleDestroy(): Promise<void> {
    await this.gracefulShutdown();
  }
}

export interface IJobParams {
  name: string;
  data?: any;
  groupId?: string;
  options?: JobsOptions;
}

export interface IBulkJobParams {
  name: string;
  data: any;
  groupId?: string;
  options?: BulkJobOptions;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class QueueBaseService
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/standard-queue.service.spec.ts
Tamaño: 4611 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { StandardQueueService } from './standard-queue.service';

let standardQueueService: StandardQueueService;

describe('Standard Queue service', () => {
  describe('General', () => {
    beforeAll(async () => {
      standardQueueService = new StandardQueueService(new WorkflowInMemoryProviderService());
      await standardQueueService.queue.obliterate();
    });

    beforeEach(async () => {
      await standardQueueService.queue.drain();
    });

    afterAll(async () => {
      await standardQueueService.gracefulShutdown();
    });

    it('should be initialised properly', async () => {
      expect(standardQueueService).toBeDefined();
      expect(Object.keys(standardQueueService)).toEqual(
        expect.arrayContaining(['topic', 'DEFAULT_ATTEMPTS', 'instance', 'queue'])
      );
      expect(standardQueueService.DEFAULT_ATTEMPTS).toEqual(3);
      expect(standardQueueService.topic).toEqual('standard');
      expect(await standardQueueService.getStatus()).toEqual({
        queueIsPaused: false,
        queueName: 'standard',
        workerName: undefined,
        workerIsPaused: undefined,
        workerIsRunning: undefined,
      });
      expect(await standardQueueService.isPaused()).toEqual(false);
      expect(standardQueueService.queue).toMatchObject(
        expect.objectContaining({
          _events: {},
          _eventsCount: 0,
          _maxListeners: undefined,
          name: 'standard',
          jobsOpts: {
            removeOnComplete: true,
          },
        })
      );
      expect(standardQueueService.queue.opts.prefix).toEqual('bull');
    });

    it('should add a job in the queue', async () => {
      const jobId = 'standard-job-id';
      const _environmentId = 'standard-environment-id';
      const _organizationId = 'standard-organization-id';
      const _userId = 'standard-user-id';
      const jobData = {
        _id: jobId,
        test: 'standard-job-data',
        _environmentId,
        _organizationId,
        _userId,
      };

      await standardQueueService.add({
        name: jobId,
        data: jobData,
        groupId: _organizationId,
      });

      expect(await standardQueueService.queue.getActiveCount()).toEqual(0);
      expect(await standardQueueService.queue.getWaitingCount()).toEqual(1);

      const standardQueueJobs = await standardQueueService.queue.getJobs();
      expect(standardQueueJobs.length).toEqual(1);
      const [standardQueueJob] = standardQueueJobs;
      expect(standardQueueJob).toMatchObject(
        expect.objectContaining({
          id: '1',
          name: jobId,
          data: jobData,
          attemptsMade: 0,
        })
      );
    });

    it('should add a minimal job in the queue', async () => {
      const jobId = 'standard-job-id-2';
      const _environmentId = 'standard-environment-id';
      const _organizationId = 'standard-organization-id';
      const _userId = 'standard-user-id';
      const jobData = {
        _id: jobId,
        test: 'standard-job-data-2',
        _environmentId,
        _organizationId,
        _userId,
      };

      await standardQueueService.add({
        name: jobId,
        data: jobData,
        groupId: _organizationId,
      });

      expect(await standardQueueService.queue.getActiveCount()).toEqual(0);
      expect(await standardQueueService.queue.getWaitingCount()).toEqual(1);

      const standardQueueJobs = await standardQueueService.queue.getJobs();
      expect(standardQueueJobs.length).toEqual(1);
      const [standardQueueJob] = standardQueueJobs;
      expect(standardQueueJob).toMatchObject(
        expect.objectContaining({
          id: '2',
          name: jobId,
          data: {
            _id: jobId,
            _environmentId,
            _organizationId,
            _userId,
          },
          attemptsMade: 0,
        })
      );
    });
  });

  describe('Cluster mode', () => {
    beforeAll(async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      standardQueueService = new StandardQueueService(new WorkflowInMemoryProviderService());
      await standardQueueService.queue.obliterate();
    });

    afterAll(async () => {
      await standardQueueService.gracefulShutdown();
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    });

    it('should have prefix in cluster mode', async () => {
      expect(standardQueueService.queue.opts.prefix).toEqual('{standard}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - standardQueueService(new StandardQueueService(new WorkflowInMemoryProviderService());
      await standardQueueService.qu...)
 - standardQueueService(new StandardQueueService(new WorkflowInMemoryProviderService());
      await standardQueueService.qu...)
 - IS_IN_MEMORY_CLUSTER_MODE_ENABLED('false';
    });

    it('should have prefix in cluster mode', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/standard-queue.service.ts
Tamaño: 916 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { IStandardBulkJobDto, IStandardJobDto } from '../../dtos';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { QueueBaseService } from './queue-base.service';

const LOG_CONTEXT = 'StandardQueueService';

@Injectable()
export class StandardQueueService extends QueueBaseService {
  constructor(public workflowInMemoryProviderService: WorkflowInMemoryProviderService) {
    super(JobTopicNameEnum.STANDARD, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, LOG_CONTEXT);

    this.createQueue();
  }

  public async add(data: IStandardJobDto) {
    return await super.add(data);
  }

  public async addBulk(data: IStandardBulkJobDto[]) {
    return await super.addBulk(data);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StandardQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/subscriber-process-queue.service.ts
Tamaño: 1115 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { IProcessSubscriberBulkJobDto, IProcessSubscriberJobDto } from '../../dtos/process-subscriber-job.dto';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { QueueBaseService } from './queue-base.service';

@Injectable()
export class SubscriberProcessQueueService extends QueueBaseService {
  private readonly LOG_CONTEXT = 'SubscriberProcessQueueService';
  constructor(
    @Inject(forwardRef(() => WorkflowInMemoryProviderService))
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService
  ) {
    super(JobTopicNameEnum.PROCESS_SUBSCRIBER, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, this.LOG_CONTEXT);

    this.createQueue();
  }

  public async add(data: IProcessSubscriberJobDto) {
    return await super.add(data);
  }

  public async addBulk(data: IProcessSubscriberBulkJobDto[]) {
    return await super.addBulk(data);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - LOG_CONTEXT('SubscriberProcessQueueService';
  constructor(
    @Inject(forwardRef(())
Declaraciones 'export' encontradas:
- export class SubscriberProcessQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/web-sockets-queue.service.spec.ts
Tamaño: 4854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { IWebSocketJobDto } from '../../dtos';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { SocketWorkerService } from '../socket-worker';
import { WebSocketsQueueService } from './web-sockets-queue.service';

let webSocketsQueueService: WebSocketsQueueService;

// Mock SocketWorkerService
const mockSocketWorkerService = {
  isEnabled: jest.fn().mockResolvedValue(false),
  sendMessage: jest.fn().mockResolvedValue(undefined),
} as any;

describe('WebSockets Queue service', () => {
  describe('General', () => {
    beforeAll(async () => {
      webSocketsQueueService = new WebSocketsQueueService(
        new WorkflowInMemoryProviderService(),
        mockSocketWorkerService
      );
      await webSocketsQueueService.queue.obliterate();
    });

    beforeEach(async () => {
      await webSocketsQueueService.queue.drain();
    });

    afterAll(async () => {
      await webSocketsQueueService.gracefulShutdown();
    });

    it('should be initialised properly', async () => {
      expect(webSocketsQueueService).toBeDefined();
      expect(Object.keys(webSocketsQueueService)).toEqual(
        expect.arrayContaining(['topic', 'DEFAULT_ATTEMPTS', 'instance', 'queue'])
      );
      expect(webSocketsQueueService.DEFAULT_ATTEMPTS).toEqual(3);
      expect(webSocketsQueueService.topic).toEqual('ws_socket_queue');
      expect(await webSocketsQueueService.getStatus()).toEqual({
        queueIsPaused: false,
        queueName: 'ws_socket_queue',
        workerName: undefined,
        workerIsPaused: undefined,
        workerIsRunning: undefined,
      });
      expect(await webSocketsQueueService.isPaused()).toEqual(false);
      expect(webSocketsQueueService.queue.opts.prefix).toEqual('bull');
    });

    it('should add a job in the queue', async () => {
      const jobId = 'web-sockets-queue-job-id';
      const _environmentId = 'web-sockets-queue-environment-id';
      const _organizationId = 'web-sockets-queue-organization-id';
      const _userId = 'web-sockets-queue-user-id';
      const jobData = {
        _id: jobId,
        _environmentId,
        _organizationId,
        _userId,
      } as any;

      await webSocketsQueueService.add({
        name: jobId,
        data: jobData,
        groupId: _organizationId,
      });

      expect(await webSocketsQueueService.queue.getActiveCount()).toEqual(0);
      expect(await webSocketsQueueService.queue.getWaitingCount()).toEqual(1);

      const webSocketsQueueJobs = await webSocketsQueueService.queue.getJobs();
      expect(webSocketsQueueJobs.length).toEqual(1);
      const [webSocketsQueueJob] = webSocketsQueueJobs;
      expect(webSocketsQueueJob).toMatchObject(
        expect.objectContaining({
          id: '1',
          name: jobId,
          data: jobData,
          attemptsMade: 0,
        })
      );
    });

    it('should add a minimal job in the queue', async () => {
      const jobId = 'web-sockets-queue-job-id-2';
      const _environmentId = 'web-sockets-queue-environment-id';
      const _organizationId = 'web-sockets-queue-organization-id';
      const _userId = 'web-sockets-queue-user-id';
      const jobData = {
        _id: jobId,
        test: 'web-sockets-queue-job-data-2',
        _environmentId,
        _organizationId,
        _userId,
      };

      await webSocketsQueueService.add({
        name: jobId,
        data: jobData as any,
        groupId: _organizationId,
      });

      expect(await webSocketsQueueService.queue.getActiveCount()).toEqual(0);
      expect(await webSocketsQueueService.queue.getWaitingCount()).toEqual(1);

      const webSocketsQueueJobs = await webSocketsQueueService.queue.getJobs();
      expect(webSocketsQueueJobs.length).toEqual(1);
      const [webSocketQueueJob] = webSocketsQueueJobs;
      expect(webSocketQueueJob).toMatchObject(
        expect.objectContaining({
          id: '2',
          name: jobId,
          data: {
            _id: jobId,
            _environmentId,
            _organizationId,
            _userId,
          },
          attemptsMade: 0,
        })
      );
    });
  });

  describe('Cluster mode', () => {
    beforeAll(async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      webSocketsQueueService = new WebSocketsQueueService(
        new WorkflowInMemoryProviderService(),
        mockSocketWorkerService
      );
      await webSocketsQueueService.queue.obliterate();
    });

    afterAll(async () => {
      await webSocketsQueueService.gracefulShutdown();
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    });

    it('should have prefix in cluster mode', async () => {
      expect(webSocketsQueueService.queue.opts.prefix).toEqual('{ws_socket_queue}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mockSocketWorkerService({
  isEnabled: jest.fn().mockResolvedValue(false),
  sendMessage: jest.fn().mockResolvedValue(undefi...)
 - webSocketsQueueService(new WebSocketsQueueService(
        new WorkflowInMemoryProviderService(),
        mockSocketWorkerS...)
 - webSocketsQueueService(new WebSocketsQueueService(
        new WorkflowInMemoryProviderService(),
        mockSocketWorkerS...)
 - IS_IN_MEMORY_CLUSTER_MODE_ENABLED('false';
    });

    it('should have prefix in cluster mode', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/web-sockets-queue.service.ts
Tamaño: 2613 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { IWebSocketBulkJobDto, IWebSocketJobDto } from '../../dtos/web-sockets-job.dto';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { SocketWorkerService } from '../socket-worker';
import { QueueBaseService } from './queue-base.service';

const LOG_CONTEXT = 'WebSocketsQueueService';

@Injectable()
export class WebSocketsQueueService extends QueueBaseService {
  constructor(
    public workflowInMemoryProviderService: WorkflowInMemoryProviderService,
    private socketWorkerService: SocketWorkerService
  ) {
    super(JobTopicNameEnum.WEB_SOCKETS, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, LOG_CONTEXT);

    this.createQueue();
  }

  public async add(data: IWebSocketJobDto) {
    const isSocketWorkerEnabled = await this.socketWorkerService.isEnabled(data.data?._environmentId);

    if (isSocketWorkerEnabled && data.data) {
      const { userId, event, _environmentId, _organizationId, subscriberId, payload, contextKeys } = data.data;
      await this.socketWorkerService.sendMessage({
        userId,
        event,
        data: payload,
        organizationId: _organizationId,
        environmentId: _environmentId,
        subscriberId,
        contextKeys,
      });

      Logger.debug(`Sent message directly to socket worker for user ${userId}, event ${event}`, LOG_CONTEXT);
    }

    return await super.add(data);
  }

  public async addBulk(data: IWebSocketBulkJobDto[]): Promise<void> {
    // Check if socket worker is enabled using the first item's context
    const firstItem = data.find((item) => item.data);
    const isSocketWorkerEnabled = firstItem
      ? await this.socketWorkerService.isEnabled(firstItem.data?._environmentId)
      : false;

    if (isSocketWorkerEnabled) {
      const promises = data.map(async (item) => {
        if (item.data) {
          const { userId, event, _environmentId, _organizationId, subscriberId, payload, contextKeys } = item.data;

          return this.socketWorkerService.sendMessage({
            userId,
            event,
            data: payload,
            organizationId: _organizationId,
            environmentId: _environmentId,
            subscriberId,
            contextKeys,
          });
        }
      });

      await Promise.all(promises);

      Logger.debug(`Sent ${data.length} messages directly to socket worker`, LOG_CONTEXT);
    }

    await super.addBulk(data);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - firstItem(data.find((item))
 - promises(data.map(async (item))
Declaraciones 'export' encontradas:
- export class WebSocketsQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/workflow-queue.service.spec.ts
Tamaño: 4689 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { IWorkflowDataDto } from '../../dtos';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { WorkflowQueueService } from './workflow-queue.service';

let workflowQueueService: WorkflowQueueService;

describe('Workflow Queue service', () => {
  describe('General', () => {
    beforeAll(async () => {
      workflowQueueService = new WorkflowQueueService(new WorkflowInMemoryProviderService());
      await workflowQueueService.queue.obliterate();
    });

    beforeEach(async () => {
      await workflowQueueService.queue.drain();
    });

    afterAll(async () => {
      await workflowQueueService.gracefulShutdown();
    });

    it('should be initialised properly', async () => {
      expect(workflowQueueService).toBeDefined();
      expect(Object.keys(workflowQueueService)).toEqual(
        expect.arrayContaining(['topic', 'DEFAULT_ATTEMPTS', 'instance', 'queue'])
      );
      expect(workflowQueueService.DEFAULT_ATTEMPTS).toEqual(3);
      expect(workflowQueueService.topic).toEqual('trigger-handler');
      expect(await workflowQueueService.getStatus()).toEqual({
        queueIsPaused: false,
        queueName: 'trigger-handler',
        workerName: undefined,
        workerIsPaused: undefined,
        workerIsRunning: undefined,
      });
      expect(await workflowQueueService.isPaused()).toEqual(false);
      expect(workflowQueueService.queue).toMatchObject(
        expect.objectContaining({
          _events: {},
          _eventsCount: 0,
          _maxListeners: undefined,
          name: 'trigger-handler',
          jobsOpts: {
            removeOnComplete: true,
          },
        })
      );
      expect(workflowQueueService.queue.opts.prefix).toEqual('bull');
    });

    it('should add a job in the queue', async () => {
      const jobId = 'workflow-job-id';
      const _environmentId = 'workflow-environment-id';
      const _organizationId = 'workflow-organization-id';
      const _userId = 'workflow-user-id';
      const jobData = {
        _id: jobId,
        _environmentId,
        _organizationId,
        _userId,
      } as unknown as IWorkflowDataDto;

      await workflowQueueService.add({
        name: jobId,
        data: jobData,
        groupId: _organizationId,
      });

      expect(await workflowQueueService.queue.getActiveCount()).toEqual(0);
      expect(await workflowQueueService.queue.getWaitingCount()).toEqual(1);

      const workflowQueueJobs = await workflowQueueService.queue.getJobs();
      expect(workflowQueueJobs.length).toEqual(1);
      const [workflowQueueJob] = workflowQueueJobs;
      expect(workflowQueueJob).toMatchObject(
        expect.objectContaining({
          id: '1',
          name: jobId,
          data: jobData,
          attemptsMade: 0,
        })
      );
    });

    it('should add a minimal job in the queue', async () => {
      const jobId = 'workflow-job-id-2';
      const _environmentId = 'workflow-environment-id';
      const _organizationId = 'workflow-organization-id';
      const _userId = 'workflow-user-id';
      const jobData = {
        _id: jobId,
        test: 'workflow-job-data-2',
        _environmentId,
        _organizationId,
        _userId,
      };

      await workflowQueueService.add({
        name: jobId,
        data: jobData as any,
        groupId: _organizationId,
      });

      expect(await workflowQueueService.queue.getActiveCount()).toEqual(0);
      expect(await workflowQueueService.queue.getWaitingCount()).toEqual(1);

      const workflowQueueJobs = await workflowQueueService.queue.getJobs();
      expect(workflowQueueJobs.length).toEqual(1);
      const [workflowQueueJob] = workflowQueueJobs;
      expect(workflowQueueJob).toMatchObject(
        expect.objectContaining({
          id: '2',
          name: jobId,
          data: {
            _id: jobId,
            _environmentId,
            _organizationId,
            _userId,
          },
          attemptsMade: 0,
        })
      );
    });
  });

  describe('Cluster mode', () => {
    beforeAll(async () => {
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'true';

      workflowQueueService = new WorkflowQueueService(new WorkflowInMemoryProviderService());
      await workflowQueueService.queue.obliterate();
    });

    afterAll(async () => {
      await workflowQueueService.gracefulShutdown();
      process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    });

    it('should have prefix in cluster mode', async () => {
      expect(workflowQueueService.queue.opts.prefix).toEqual('{trigger-handler}');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowQueueService(new WorkflowQueueService(new WorkflowInMemoryProviderService());
      await workflowQueueService.qu...)
 - workflowQueueService(new WorkflowQueueService(new WorkflowInMemoryProviderService());
      await workflowQueueService.qu...)
 - IS_IN_MEMORY_CLUSTER_MODE_ENABLED('false';
    });

    it('should have prefix in cluster mode', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/queues/workflow-queue.service.ts
Tamaño: 916 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { IWorkflowBulkJobDto, IWorkflowJobDto } from '../../dtos';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { QueueBaseService } from './queue-base.service';

const LOG_CONTEXT = 'WorkflowQueueService';

@Injectable()
export class WorkflowQueueService extends QueueBaseService {
  constructor(public workflowInMemoryProviderService: WorkflowInMemoryProviderService) {
    super(JobTopicNameEnum.WORKFLOW, new BullMqService(workflowInMemoryProviderService));

    Logger.log(`Creating queue ${this.topic}`, LOG_CONTEXT);

    this.createQueue();
  }

  public async add(data: IWorkflowJobDto) {
    return await super.add(data);
  }

  public async addBulk(data: IWorkflowBulkJobDto[]) {
    return await super.addBulk(data);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowQueueService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/readiness/index.ts
Tamaño: 69 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { INovuWorker, ReadinessService } from './readiness.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/readiness/readiness.service.spec.ts
Tamaño: 4311 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  StandardQueueServiceHealthIndicator,
  SubscriberProcessQueueHealthIndicator,
  WorkflowQueueServiceHealthIndicator,
} from '../../health';

import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { StandardQueueService, SubscriberProcessQueueService, WorkflowQueueService } from '../queues';
import { StandardWorkerService, WorkerBaseService } from '../workers';
import { ReadinessService } from './readiness.service';

let readinessService: ReadinessService;
let standardQueueService: StandardQueueService;
let workflowQueueService: WorkflowQueueService;
let subscriberProcessQueueService: SubscriberProcessQueueService;
let testWorker: WorkerBaseService;

describe('Readiness Service', () => {
  beforeAll(async () => {
    process.env.IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';
    process.env.IS_IN_MEMORY_CLUSTER_MODE_ENABLED = 'false';

    standardQueueService = new StandardQueueService(new WorkflowInMemoryProviderService());
    workflowQueueService = new WorkflowQueueService(new WorkflowInMemoryProviderService());
    subscriberProcessQueueService = new SubscriberProcessQueueService(new WorkflowInMemoryProviderService());

    await Promise.all([
      standardQueueService.workflowInMemoryProviderService.initialize(),
      workflowQueueService.workflowInMemoryProviderService.initialize(),
      subscriberProcessQueueService.workflowInMemoryProviderService.initialize(),
    ]);

    const standardQueueServiceHealthIndicator = new StandardQueueServiceHealthIndicator(standardQueueService);
    const workflowQueueServiceHealthIndicator = new WorkflowQueueServiceHealthIndicator(workflowQueueService);
    const subscriberProcessQueueHealthIndicator = new SubscriberProcessQueueHealthIndicator(
      subscriberProcessQueueService
    );

    readinessService = new ReadinessService([
      standardQueueServiceHealthIndicator,
      workflowQueueServiceHealthIndicator,
      subscriberProcessQueueHealthIndicator,
    ]);
  });

  afterAll(async () => {
    await standardQueueService.gracefulShutdown();
    await workflowQueueService.gracefulShutdown();
    await testWorker?.gracefulShutdown();
  });

  describe('Set up', () => {
    it('should be able to instantiate it correctly', async () => {
      expect(Object.keys(readinessService)).toEqual(
        expect.arrayContaining([
          'standardQueueServiceHealthIndicator',
          'workflowQueueServiceHealthIndicator',
          'subscriberProcessQueueHealthIndicator',
        ])
      );

      const areQueuesEnabled = await readinessService.areQueuesEnabled();
      expect(areQueuesEnabled).toEqual(true);
    });
  });

  describe('Functionalities', () => {
    it('should be able to pause the workers given', async () => {
      const getWorkerOptions = () => {
        return {
          lockDuration: 90000,
          concurrency: 200,
        };
      };

      const getWorkerProcessor = () => {
        return async ({ data }) => {
          return await new Promise((resolve, reject) => {
            resolve(data);
          });
        };
      };

      testWorker = new StandardWorkerService(new BullMqService(new WorkflowInMemoryProviderService()));
      await testWorker.initWorker(getWorkerProcessor(), getWorkerOptions());

      const [initialIsPaused, initialIsRunning] = await Promise.all([testWorker.isPaused(), testWorker.isRunning()]);

      expect(initialIsPaused).toEqual(false);
      expect(initialIsRunning).toEqual(true);

      await readinessService.pauseWorkers([testWorker]);

      const [isPaused, isRunning] = await Promise.all([testWorker.isPaused(), testWorker.isRunning()]);

      expect(isPaused).toEqual(true);
      expect(isRunning).toEqual(true);
    });

    it('should be able to resume the workers given', async () => {
      const [initialIsPaused, initialIsRunning] = await Promise.all([testWorker.isPaused(), testWorker.isRunning()]);

      expect(initialIsPaused).toEqual(true);
      expect(initialIsRunning).toEqual(true);

      await readinessService.enableWorkers([testWorker]);

      const [isPaused, isRunning] = await Promise.all([testWorker.isPaused(), testWorker.isRunning()]);

      expect(isPaused).toEqual(false);
      expect(isRunning).toEqual(true);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - readinessService(new ReadinessService([
      standardQueueServiceHealthIndicator,
      workflowQueueServiceHealthIn...)
 - areQueuesEnabled(await readinessService.areQueuesEnabled();
      expect(areQueuesEnabled).toEqual(true);
    });
  }...)
 - getWorkerOptions())
 - getWorkerProcessor())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/readiness/readiness.service.ts
Tamaño: 2865 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { HealthIndicatorResult, HealthIndicatorStatus } from '@nestjs/terminus';
import { setTimeout } from 'timers/promises';
import { IHealthIndicator } from '../../health';
import { IDestroy } from '../../modules';
import { Worker } from '../bull-mq';

export interface INovuWorker extends IDestroy {
  readonly DEFAULT_ATTEMPTS: number;
  readonly topic: string;
  pause: () => Promise<void>;
  resume: () => Promise<void>;
  worker: Worker;
}

const LOG_CONTEXT = 'ReadinessService';

@Injectable()
export class ReadinessService {
  constructor(
    @Inject('QUEUE_HEALTH_INDICATORS')
    private healthIndicators: IHealthIndicator[]
  ) {}

  async areQueuesEnabled(): Promise<boolean> {
    Logger.log('Enabling queues as workers are meant to be ready', LOG_CONTEXT);

    const retries = 10;
    const delay = 5000;

    for (let i = 1; i < retries + 1; i += 1) {
      const result = await this.checkServicesHealth();
      Logger.log(`Checking if queues are enabled ${i}/${retries} ${JSON.stringify(result)}`, LOG_CONTEXT);
      if (result) {
        return true;
      }

      Logger.warn(
        `Some health indicator returned false when checking if queues are enabled ${i}/${retries}`,
        LOG_CONTEXT
      );

      await setTimeout(delay);
    }

    return false;
  }

  private async checkServicesHealth() {
    try {
      const healths = await Promise.all(this.healthIndicators.map((health) => health.isHealthy()));

      const statuses = healths.map((health: HealthIndicatorResult) => Object.values(health)[0].status);

      return statuses.every((status: HealthIndicatorStatus) => status === 'up');
    } catch (error) {
      Logger.error(error, 'Some health indicator throw an error when checking if queues are enabled', LOG_CONTEXT);

      return false;
    }
  }

  async pauseWorkers(workers: INovuWorker[]): Promise<void> {
    for (const worker of workers) {
      try {
        Logger.verbose(`Pausing worker ${worker.topic}...`, LOG_CONTEXT);

        await worker.pause();
      } catch (error) {
        Logger.error(error, `Failed to pause worker ${worker.topic}.`, LOG_CONTEXT);

        throw error;
      }
    }
  }

  async enableWorkers(workers: INovuWorker[]): Promise<void> {
    const areQueuesEnabled = await this.areQueuesEnabled();

    if (areQueuesEnabled) {
      for (const worker of workers) {
        try {
          Logger.verbose(`Resuming worker ${worker.topic}...`, LOG_CONTEXT);

          await worker.resume();
        } catch (error) {
          Logger.error(error, `Failed to resume worker ${worker.topic}.`, LOG_CONTEXT);

          throw error;
        }
      }
    } else {
      const error = new Error('Queues are not enabled');
      Logger.error(error, 'Queues are not enabled', LOG_CONTEXT);
      throw error;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - healths(await Promise.all(this.healthIndicators.map((health))
 - statuses(healths.map((health: HealthIndicatorResult))
Declaraciones 'export' encontradas:
- export  interface
- export class ReadinessService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/sanitize/sanitizer-v0.service.spec.ts
Tamaño: 2427 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EmailBlockTypeEnum, IEmailBlock } from '@novu/shared';
import { expect } from 'chai';

/* cspell:disable next-line */
import { sanitizeHTMLV0 as sanitizeHTML, sanitizeMessageContentV0 } from './sanitizer-v0.service';

describe('HTML Sanitizer', () => {
  it('should sanitize bad html', () => {
    const sanitizedHtml = sanitizeHTML('hello <b>bold</b> <script>alert(123)</script>');
    expect(sanitizedHtml).to.equal('hello <b>bold</b> ');
  });

  it('should sanitized message text content', () => {
    const result = sanitizeMessageContentV0('hello <b>bold</b> <script>alert(123)</script>');
    expect(result).to.equal('hello <b>bold</b> ');
  });

  it('should sanitized message email block content', () => {
    const result = sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: 'hello <b>bold</b> <script>alert(123)</script>',
        url: '',
      },
    ]) as IEmailBlock[];

    expect(result[0].content).to.equal('hello <b>bold</b> ');
  });

  it('should NOT sanitize style tags', () => {
    const result = sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: '<style>p { color: red; }</style><p>Red Text</p>',
        url: '',
      },
    ]) as IEmailBlock[];

    expect(result[0].content).to.equal('<style>p { color: red; }</style><p>Red Text</p>');
  });

  it('should NOT sanitize style attributes', () => {
    const result = sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: '<p style="color: red;">Red Text</p>',
        url: '',
      },
    ]) as IEmailBlock[];

    expect(result[0].content).to.equal('<p style="color: red;">Red Text</p>');
  });

  it('should NOT format style attributes', () => {
    const result = sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: '<p style="color:red;">Red Text</p>',
        url: '',
      },
    ]) as IEmailBlock[];

    expect(result[0].content).to.equal('<p style="color:red;">Red Text</p>');
  });

  it('should NOT sanitize img tags', () => {
    const result = sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: '<img src="https://example.com/image.jpg" alt="Example Image">',
        url: '',
      },
    ]) as IEmailBlock[];

    expect(result[0].content).to.equal('<img src="https://example.com/image.jpg" alt="Example Image" />');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - sanitizedHtml(sanitizeHTML('hello <b>bold</b> <script>alert(123)</script>');
    expect(sanitizedHtml).to.equal('h...)
 - result(sanitizeMessageContentV0('hello <b>bold</b> <script>alert(123)</script>');
    expect(result).to.equ...)
 - result(sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: 'hello <b...)
 - result(sanitizeMessageContentV0([
      {
        type: EmailBlockTypeEnum.TEXT,
        content: '<style>p...)
 - style("color: red;">Red Text</p>');
  });

  it('should NOT format style attributes', ())
 - style("color:red;">Red Text</p>');
  });

  it('should NOT sanitize img tags', ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/sanitize/sanitizer-v0.service.ts
Tamaño: 2951 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IEmailBlock } from '@novu/shared';
import sanitizeTypes, { IOptions } from 'sanitize-html';

/**
 * Options for the sanitize-html library.
 *
 * @see https://www.npmjs.com/package/sanitize-html#default-options
 */
const sanitizeOptions: IOptions = {
  /**
   * Additional tags to allow.
   */
  allowedTags: sanitizeTypes.defaults.allowedTags.concat(['style', 'img']),
  allowedAttributes: {
    ...sanitizeTypes.defaults.allowedAttributes,
    /**
     * Additional attributes to allow on all tags.
     */
    '*': ['style'],
    img: ['src', 'srcset', 'alt', 'title', 'width', 'height', 'loading'],
  },
  /**
   * Required to disable console warnings when allowing style tags.
   *
   * We are allowing style tags to support the use of styles in the In-App Editor.
   * This is a known security risk through an XSS attack vector,
   * but we are accepting this risk by dropping support for IE11.
   *
   * @see https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#remote-style-sheet
   */
  allowVulnerableTags: true,
  /**
   * Required to disable formatting of style attributes. This is useful to retain
   * formatting of style attributes in the In-App Editor.
   */
  parseStyleAttributes: false,
};

/**
 * @deprecated Use sanitizeHTML from sanitizer.service.ts instead
 */
// cspell:disable-next-line
export function sanitizeHTMLV0(html: string) {
  if (!html) return html;

  return sanitizeTypes(html, sanitizeOptions);
}

/**
 * @deprecated Use sanitizeHtmlInObject from sanitizer.service.ts instead
 */
export const sanitizeHtmlInObjectV0 = <T extends Record<string, unknown>>(object: T): T => {
  return Object.keys(object).reduce((acc, key: keyof T) => {
    const value = object[key];

    if (typeof value === 'string') {
      // cspell:disable-next-line
      acc[key] = sanitizeHTMLV0(value) as T[keyof T];
    } else if (Array.isArray(value)) {
      // cspell:disable-next-line
      acc[key] = value.map((item) => {
        if (typeof item === 'string') {
          // cspell:disable-next-line
          return sanitizeHTMLV0(item);
        } else if (typeof item === 'object') {
          return sanitizeHtmlInObjectV0(item);
        } else {
          return item;
        }
      }) as T[keyof T];
    } else if (typeof value === 'object' && value !== null) {
      acc[key] = sanitizeHtmlInObjectV0(value as Record<string, unknown>) as T[keyof T];
    } else {
      acc[key] = value;
    }

    return acc;
  }, {} as T);
};

/**
 * @deprecated Use sanitizer.service.ts instead
 */
export function sanitizeMessageContentV0(content: string | IEmailBlock[]) {
  if (typeof content === 'string') {
    // cspell:disable-next-line
    return sanitizeHTMLV0(content);
  }

  if (Array.isArray(content)) {
    return content.map((i) => {
      return {
        ...i,
        // cspell:disable-next-line
        content: sanitizeHTMLV0(i.content),
      };
    });
  }

  return content;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - sanitizeHTMLV0(html: string)
 - sanitizeMessageContentV0(content: string | IEmailBlock[])
Asignaciones con arrow functions encontradas (posibles funciones):
 - sanitizeHtmlInObjectV0(<T extends Record<string, unknown>>(object: T): T)
Declaraciones 'export' encontradas:
- export function sanitizeHTMLV0
- export  const
- export function sanitizeMessageContentV0

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/sanitize/sanitizer.service.ts
Tamaño: 2840 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import sanitizeTypes, { IOptions } from 'sanitize-html';

/**
 * Options for the sanitize-html library.
 *
 * We are providing a permissive approach by default, with the exception of
 * disabling `script` tags.
 *
 * @see https://www.npmjs.com/package/sanitize-html#default-options
 */
const sanitizeOptions: IOptions = {
  /**
   * Additional tags to allow.
   */
  allowedTags: sanitizeTypes.defaults.allowedTags.concat([
    'style',
    'img',
    'html',
    'head',
    'body',
    'link',
    'meta',
    'title',
  ]),
  // Setting this to false to allow all attributes.
  allowedAttributes: false,
  /**
   * Additional URL schemes to allow in src, href, and other URL attributes.
   * Including 'cid:' for Content-ID references used in email attachments.
   */
  allowedSchemes: sanitizeTypes.defaults.allowedSchemes.concat(['cid']),
  /**
   * Required to disable console warnings when allowing style tags.
   *
   * We are allowing style tags to support the use of styles in the In-App Editor.
   * This is a known security risk through an XSS attack vector,
   * but we are accepting this risk by dropping support for IE11.
   *
   * @see https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#remote-style-sheet
   */
  allowVulnerableTags: true,
  /**
   * Required to disable formatting of style attributes. This is useful to retain
   * formatting of style attributes in the In-App Editor.
   */
  parseStyleAttributes: false,
  parser: {
    // Convert the case of attribute names to lowercase.
    lowerCaseAttributeNames: true,
  },
};

export const sanitizeHTML = (html: string): string => {
  if (!html) {
    return html;
  }

  // Sanitize-html removes the DOCTYPE tag, so we need to add it back.
  const doctypeRegex = /^<!DOCTYPE .*?>/;
  const doctypeTags = html.match(doctypeRegex);
  const cleanHtml = sanitizeTypes(html, sanitizeOptions);

  const cleanHtmlWithDocType = doctypeTags ? doctypeTags[0] + cleanHtml : cleanHtml;

  return cleanHtmlWithDocType;
};

export const sanitizeHtmlInObject = <T extends Record<string, unknown>>(object: T): T => {
  return Object.keys(object).reduce((acc, key: keyof T) => {
    const value = object[key];

    if (typeof value === 'string') {
      acc[key] = sanitizeHTML(value) as T[keyof T];
    } else if (Array.isArray(value)) {
      acc[key] = value.map((item) => {
        if (typeof item === 'string') {
          return sanitizeHTML(item);
        } else if (typeof item === 'object') {
          return sanitizeHtmlInObject(item);
        } else {
          return item;
        }
      }) as T[keyof T];
    } else if (typeof value === 'object' && value !== null) {
      acc[key] = sanitizeHtmlInObject(value as Record<string, unknown>) as T[keyof T];
    } else {
      acc[key] = value;
    }

    return acc;
  }, {} as T);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - sanitizeHTML(html: string): string)
 - sanitizeHtmlInObject(<T extends Record<string, unknown>>(object: T): T)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/socket-worker/index.ts
Tamaño: 63 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { SocketWorkerService } from './socket-worker.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/socket-worker/socket-worker.service.ts
Tamaño: 8010 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { MessageRepository } from '@novu/dal';
import { ChannelTypeEnum, FeatureFlagsKeysEnum, WebSocketEventEnum } from '@novu/shared';
import got, { HTTPError, RequestError } from 'got';

import { FeatureFlagsService } from '../feature-flags';

const LOG_CONTEXT = 'SocketWorkerService';

type UnreadCountPaginationIndication = {
  unreadCount: number;
  hasMore: boolean;
};

export interface SendMessageParams {
  userId: string;
  event: string;
  data: any;
  organizationId?: string;
  environmentId?: string;
  subscriberId?: string;
  contextKeys?: string[];
}

@Injectable()
export class SocketWorkerService {
  private readonly socketWorkerUrl: string | undefined;
  private readonly socketWorkerApiKey: string | undefined;

  constructor(
    private featureFlagsService: FeatureFlagsService,
    private messageRepository: MessageRepository
  ) {
    this.socketWorkerUrl = process.env.SOCKET_WORKER_URL;
    this.socketWorkerApiKey = process.env.INTERNAL_SERVICES_API_KEY;
  }

  async sendMessage({
    userId,
    event,
    data,
    organizationId,
    environmentId,
    subscriberId,
    contextKeys,
  }: SendMessageParams): Promise<void> {
    if (event === WebSocketEventEnum.RECEIVED) {
      const { messageId } = data || {};
      const storedMessage = await this.messageRepository.findOne({
        _id: messageId,
        _environmentId: environmentId,
      });

      if (!storedMessage) {
        Logger.error(`Message with id ${messageId} not found in environment ${environmentId}`, LOG_CONTEXT);

        return;
      }

      await this.sendMessageInternal({
        userId,
        event,
        data: { message: storedMessage },
        organizationId,
        environmentId,
        subscriberId,
        contextKeys,
      });

      // Only recalculate the counts if we send a messageId/message.
      if (messageId) {
        await Promise.all([
          this.sendUnseenCount(userId, environmentId, organizationId, contextKeys),
          this.sendUnreadCount(userId, environmentId, organizationId, contextKeys),
        ]);
      }
    } else if (event === WebSocketEventEnum.UNREAD) {
      await this.sendUnreadCount(userId, environmentId, organizationId, contextKeys);
    } else if (event === WebSocketEventEnum.UNSEEN) {
      await this.sendUnseenCount(userId, environmentId, organizationId, contextKeys);
    } else {
      await this.sendMessageInternal({
        userId,
        event,
        data,
        organizationId,
        environmentId,
        subscriberId,
        contextKeys,
      });
    }
  }

  private async sendMessageInternal({
    userId,
    event,
    data,
    organizationId,
    environmentId,
    subscriberId,
    contextKeys,
  }: SendMessageParams): Promise<void> {
    if (!this.socketWorkerUrl) {
      Logger.debug('Socket worker URL not configured, skipping dispatch', LOG_CONTEXT);

      return;
    }

    if (!this.socketWorkerApiKey) {
      Logger.error('Socket worker API key not configured, cannot dispatch', LOG_CONTEXT);

      return;
    }

    try {
      const payload = {
        userId,
        event,
        data,
        organizationId,
        environmentId,
        subscriberId,
        contextKeys,
      };

      Logger.log(`Dispatching event ${event} to socket worker for user ${userId}`, LOG_CONTEXT);

      await got.post(`${this.socketWorkerUrl}/send`, {
        json: payload,
        headers: {
          Authorization: `Bearer ${this.socketWorkerApiKey}`,
        },
        responseType: 'json',
        timeout: 5000, // 5 second timeout
        retry: {
          limit: 2,
          methods: ['POST'],
          statusCodes: [408, 429, 500, 502, 503, 504],
        },
      });

      Logger.debug(`Successfully dispatched event ${event} to socket worker for user ${userId}`, LOG_CONTEXT);
    } catch (error) {
      if (error instanceof HTTPError) {
        const { statusCode } = error.response;
        const errorText = error.response.body || error.message;

        if (statusCode === 401) {
          Logger.error(
            `Unauthorized request to socket worker - check API key configuration: ${errorText}`,
            LOG_CONTEXT
          );
        } else {
          Logger.error(`Failed to dispatch to socket worker: ${statusCode} - ${errorText}`, LOG_CONTEXT);
        }
      } else if (error instanceof RequestError) {
        Logger.error(`Request error dispatching to socket worker: ${error.message}`, LOG_CONTEXT);
      } else {
        Logger.error(
          `Error dispatching to socket worker: ${error instanceof Error ? error.message : String(error)}`,
          LOG_CONTEXT
        );
      }
    }
  }

  private async sendUnreadCountChange(
    userId: string,
    environmentId: string,
    organizationId?: string,
    contextKeys?: string[]
  ): Promise<void> {
    try {
      const [unreadCount, severityCounts] = await Promise.all([
        this.messageRepository.getCount(
          environmentId,
          userId,
          ChannelTypeEnum.IN_APP,
          { read: false },
          { limit: 101 },
          contextKeys,
          undefined,
          'primary'
        ),
        this.messageRepository.getCountBySeverity(
          environmentId,
          userId,
          ChannelTypeEnum.IN_APP,
          { read: false, snoozed: false },
          { limit: 99 },
          contextKeys
        ),
      ]);

      const counts = {
        total: unreadCount,
        severity: {
          high: 0,
          medium: 0,
          low: 0,
          none: 0,
        },
      };

      for (const { severity, count } of severityCounts) {
        if (severity in counts.severity) {
          counts.severity[severity] = count;
        }
      }

      const paginationIndication: UnreadCountPaginationIndication =
        unreadCount > 100 ? { unreadCount: 100, hasMore: true } : { unreadCount, hasMore: false };

      await this.sendMessageInternal({
        userId,
        event: WebSocketEventEnum.UNREAD,
        data: {
          unreadCount: paginationIndication.unreadCount,
          counts,
          hasMore: paginationIndication.hasMore,
        },
        organizationId,
        environmentId,
        contextKeys,
      });
    } catch (error) {
      Logger.error(
        `Error sending unread count change: ${error instanceof Error ? error.message : String(error)}`,
        LOG_CONTEXT
      );
    }
  }

  private async sendUnseenCountChange(
    userId: string,
    environmentId: string,
    organizationId?: string,
    contextKeys?: string[]
  ): Promise<void> {
    try {
      await this.sendMessageInternal({
        userId,
        event: WebSocketEventEnum.UNSEEN,
        data: {},
        organizationId,
        environmentId,
        contextKeys,
      });
    } catch (error) {
      Logger.error(
        `Error sending unseen count change: ${error instanceof Error ? error.message : String(error)}`,
        LOG_CONTEXT
      );
    }
  }

  async sendUnseenCount(
    userId: string,
    environmentId: string,
    organizationId?: string,
    contextKeys?: string[]
  ): Promise<void> {
    return this.sendUnseenCountChange(userId, environmentId, organizationId, contextKeys);
  }

  async sendUnreadCount(
    userId: string,
    environmentId: string,
    organizationId?: string,
    contextKeys?: string[]
  ): Promise<void> {
    return this.sendUnreadCountChange(userId, environmentId, organizationId, contextKeys);
  }

  async isEnabled(environmentId?: string): Promise<boolean> {
    const hasConfig = !!this.socketWorkerUrl && !!this.socketWorkerApiKey;

    if (!hasConfig) {
      return false;
    }

    if (process.env.NOVU_ENTERPRISE !== 'true') {
      return false;
    }

    const isFeatureFlagEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_CLOUDFLARE_SOCKETS_ENABLED,
      environment: { _id: environmentId },
      defaultValue: false,
    });

    return isFeatureFlagEnabled;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class SocketWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/storage/index.ts
Tamaño: 548 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AzureBlobStorageService, GCSStorageService, S3StorageService, StorageService } from './storage.service';

export * from './storage-helper.service';

function getStorageServiceClass(service: string) {
  switch (service) {
    case 'GCS':
      return GCSStorageService;
    case 'AZURE':
      return AzureBlobStorageService;
    default:
      return S3StorageService;
  }
}

export const storageService = {
  provide: StorageService,
  useClass: getStorageServiceClass(String(process.env.STORAGE_SERVICE)),
};

export { StorageService };


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getStorageServiceClass(service: string)
Declaraciones 'export' encontradas:
- export
- export  const
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/storage/non-existing-file.error.ts
Tamaño: 164 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class NonExistingFileError extends Error {
  constructor() {
    super('File not found for the key provided');
    this.name = 'NonExistingFileError';
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NonExistingFileError

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/storage/storage-helper.service.spec.ts
Tamaño: 7105 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { S3Client } from '@aws-sdk/client-s3';
import { BlockBlobClient } from '@azure/storage-blob';
import { File } from '@google-cloud/storage';
import { IAttachmentOptionsExtended } from '@novu/stateless';
import { AzureBlobStorageService, GCSStorageService, S3StorageService } from './storage.service';
import { StorageHelperService } from './storage-helper.service';

const file = Buffer.from('test');
const gcpFileSave = jest.fn(() => Promise.resolve({}));
const gcpDownload = jest.fn(() => Promise.resolve([file]));
const gcpDelete = jest.fn(() => Promise.resolve({}));

const azureUpload = jest.fn(() => Promise.resolve({ _response: { status: 201 } }));
const azureDownloadToBuffer = jest.fn(() => Promise.resolve(file));
const azureDelete = jest.fn(() => Promise.resolve({ _response: { status: 202 } }));

jest.mock('@aws-sdk/client-s3');
jest.mock('@azure/storage-blob', () => ({
  ...jest.requireActual('@azure/storage-blob'),
  StorageSharedKeyCredential: jest.fn(() => ({})),
  BlobServiceClient: jest.fn(() => ({
    getContainerClient: jest.fn(() => ({
      getBlockBlobClient: jest.fn(() => ({
        upload: azureUpload,
        downloadToBuffer: azureDownloadToBuffer,
        delete: azureDelete,
      })),
    })),
  })),
}));
jest.mock('@google-cloud/storage', () => ({
  ...jest.requireActual('@google-cloud/storage'),
  Storage: jest.fn(() => ({
    bucket: () => ({
      file: jest.fn(() => ({
        save: gcpFileSave,
        delete: gcpDelete,
        download: gcpDownload,
      })),
    }),
  })),
}));

describe('Storage-Helper service', () => {
  beforeAll(() => {
    jest.resetModules();
    process.env = {
      ...process.env,
      GCS_BUCKET_NAME: 'test_bucket',
      AZURE_CONTAINER_NAME: 'test_bucket',
    };
  });

  beforeEach(() => {
    jest.clearAllMocks();
  });

  // mocking the S3 Storage service with jest
  describe('S3', () => {
    const s3StorageHelperService = new StorageHelperService(new S3StorageService());
    const attachments: IAttachmentOptionsExtended[] = [
      {
        name: 'test.png',
        file: Buffer.from('test'),
        storagePath: 'attachments/test.png',
        mime: 'image/png',
      },
    ];
    const resultAttachments = attachments.map((attachment) => {
      attachment.file = null;

      return attachment;
    });

    it('should upload file', async () => {
      // resolve PutObjectCommand
      jest.spyOn(S3Client.prototype, 'send').mockImplementation(() => Promise.resolve({}));

      await s3StorageHelperService.uploadAttachments(attachments);
    });

    it('should get file', async () => {
      // resolve GetObjectCommand with the file
      jest.spyOn(S3Client.prototype, 'send').mockImplementation(() =>
        Promise.resolve({
          Body: {
            on: (event, callback) => {
              if (event === 'data') {
                callback(Buffer.from('test'));
              }
              if (event === 'end') {
                callback();
              }
            },
          },
        })
      );

      await s3StorageHelperService.getAttachments(attachments);
    });

    it('should delete file', async () => {
      // resolve DeleteObjectCommand
      jest.spyOn(S3Client.prototype, 'send').mockImplementation(() => Promise.resolve({}));

      await s3StorageHelperService.deleteAttachments(resultAttachments);
    });

    it('should handle error for file which is not found', async () => {
      const attachments2: IAttachmentOptionsExtended[] = [
        {
          name: 'new-image.png',
          storagePath: 'attachments/new-image.png',
          file: null,
          mime: 'image/png',
        },
      ];
      jest
        .spyOn(S3Client.prototype, 'send')
        .mockImplementation(() => Promise.reject({ message: 'The specified key does not exist.' }));

      await s3StorageHelperService.getAttachments(attachments2);
      expect(attachments2[0].file).toBeNull();
    });
  });

  // mocking the google cloud storage service with jest
  describe('Google Cloud', () => {
    const gCSStorageHelperService = new StorageHelperService(new GCSStorageService());
    const gcAttachments: IAttachmentOptionsExtended[] = [
      {
        name: 'test.png',
        storagePath: 'attachments/test.png',
        file: Buffer.from('test'),
        mime: 'image/png',
      },
    ];

    it('should upload file', async () => {
      await gCSStorageHelperService.uploadAttachments(gcAttachments);

      expect(gcpFileSave).toHaveBeenCalledTimes(1);
    });

    it('should delete file', async () => {
      await gCSStorageHelperService.deleteAttachments(gcAttachments);

      expect(gcpDelete).toHaveBeenCalledTimes(1);
    });

    it('should get file', async () => {
      await gCSStorageHelperService.getAttachments(gcAttachments);

      expect(gcpDownload).toHaveBeenCalledTimes(1);
      expect(gcAttachments[0].file).toEqual(file);
    });

    it('should handle error for file which is not found', async () => {
      const gcAttachments2: IAttachmentOptionsExtended[] = [
        {
          name: 'new-image.png',
          storagePath: 'attachments/new-image.png',
          file: null,
          mime: 'image/png',
        },
      ];
      gcpDownload.mockImplementationOnce(() => Promise.reject({ code: 404 }));
      await gCSStorageHelperService.getAttachments(gcAttachments2);

      expect(gcAttachments2[0].file).toBeNull();
    });
  });

  // mocking the azure storage service with jest
  describe('Azure', () => {
    const azureStorageHelperService = new StorageHelperService(new AzureBlobStorageService());
    const azureAttachments: IAttachmentOptionsExtended[] = [
      {
        name: 'test.png',
        storagePath: 'attachments/test.png',
        file: Buffer.from('test'),
        mime: 'image/png',
      },
    ];

    it('should upload file', async () => {
      await azureStorageHelperService.uploadAttachments(azureAttachments);

      expect(azureUpload).toHaveBeenCalledTimes(1);
    });

    it('should delete file', async () => {
      await azureStorageHelperService.deleteAttachments(azureAttachments);

      expect(azureDelete).toHaveBeenCalledTimes(1);
    });

    it('should get file', async () => {
      await azureStorageHelperService.getAttachments(azureAttachments);

      expect(azureDownloadToBuffer).toHaveBeenCalledTimes(1);
      expect(azureAttachments[0].file).toBeInstanceOf(Buffer);
    });

    it('should handle error for file which is not found', async () => {
      const azureAttachments2: IAttachmentOptionsExtended[] = [
        {
          name: 'new-image.png',
          storagePath: 'attachments/new-image.png',
          file: null,
          mime: 'image/png',
        },
      ];
      azureDownloadToBuffer.mockImplementationOnce(() => Promise.reject({ statusCode: 404 }));
      // sets the file to null if the get-file method throws error with status code 404
      await azureStorageHelperService.getAttachments(azureAttachments2);

      expect(azureDownloadToBuffer).toHaveBeenCalledTimes(1);
      expect(azureAttachments2[0].file).toBeNull();
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - gcpFileSave(jest.fn(())
 - gcpDownload(jest.fn(())
 - gcpDelete(jest.fn(())
 - azureUpload(jest.fn(())
 - azureDownloadToBuffer(jest.fn(())
 - azureDelete(jest.fn(())
 - env({
      ...process.env,
      GCS_BUCKET_NAME: 'test_bucket',
      AZURE_CONTAINER_NAME: 'test_buck...)
 - resultAttachments(attachments.map((attachment))
 - file(null;

      return attachment;
    });

    it('should upload file', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/storage/storage-helper.service.ts
Tamaño: 1808 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { IAttachmentOptionsExtended } from '@novu/stateless';
import { Instrument } from '../../instrumentation';
import { NonExistingFileError } from './non-existing-file.error';
import { StorageService } from './storage.service';

@Injectable()
export class StorageHelperService {
  constructor(private storageService: StorageService) {}

  private areAttachmentsMissing(attachments?: IAttachmentOptionsExtended[]) {
    return !(Array.isArray(attachments) && attachments.length > 0);
  }

  @Instrument()
  async uploadAttachments(attachments?: IAttachmentOptionsExtended[]) {
    if (!attachments || this.areAttachmentsMissing(attachments)) {
      return;
    }

    const promises = attachments.map(async (attachment) => {
      if (attachment.file) {
        await this.storageService.uploadFile(attachment.storagePath, attachment.file, attachment.mime);
      }
    });
    await Promise.all(promises);
  }

  async getAttachments(attachments?: IAttachmentOptionsExtended[]) {
    if (!attachments || this.areAttachmentsMissing(attachments)) {
      return;
    }

    for (const attachment of attachments) {
      try {
        attachment.file = await this.storageService.getFile(attachment.storagePath);
      } catch (error: any) {
        if (error instanceof NonExistingFileError || error.name === 'NonExistingFileError') {
          attachment.file = null;
        } else {
          throw error;
        }
      }
    }
  }

  async deleteAttachments(attachments?: IAttachmentOptionsExtended[]) {
    if (!attachments || this.areAttachmentsMissing(attachments)) {
      return;
    }

    for (const attachment of attachments) {
      if (attachment.file) {
        await this.storageService.deleteFile(attachment.storagePath);
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - promises(attachments.map(async (attachment))
Declaraciones 'export' encontradas:
- export class StorageHelperService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/storage/storage.service.ts
Tamaño: 8033 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DeleteObjectCommand,
  GetObjectCommand,
  PutObjectCommand,
  PutObjectCommandOutput,
  S3Client,
} from '@aws-sdk/client-s3';
import { getSignedUrl } from '@aws-sdk/s3-request-presigner';
import {
  BlobSASPermissions,
  BlobServiceClient,
  generateBlobSASQueryParameters,
  SASProtocol,
  StorageSharedKeyCredential,
} from '@azure/storage-blob';
import { Storage } from '@google-cloud/storage';
import { Readable } from 'stream';
import { URL } from 'url';

import { NonExistingFileError } from './non-existing-file.error';

export interface IFilePath {
  path: string;
  name: string;
}

export abstract class StorageService {
  abstract getSignedUrl(
    key: string,
    contentType: string
  ): Promise<{
    signedUrl: string;
    path: string;
    additionalHeaders?: Record<string, string>;
  }>;
  abstract uploadFile(key: string, file: Buffer, contentType: string): Promise<PutObjectCommandOutput>;
  abstract getFile(key: string): Promise<Buffer>;
  abstract deleteFile(key: string): Promise<void>;
}

async function streamToBuffer(stream: Readable): Promise<Buffer> {
  return await new Promise((resolve, reject) => {
    const chunks: Uint8Array[] = [];
    stream.on('data', (chunk) => chunks.push(chunk));
    stream.on('error', reject);
    stream.on('end', () => resolve(Buffer.concat(chunks)));
  });
}
export class S3StorageService implements StorageService {
  private s3 = new S3Client({
    region: process.env.S3_REGION,
    endpoint: process.env.S3_LOCAL_STACK || undefined,
    forcePathStyle: true,
  });

  async uploadFile(key: string, file: Buffer, contentType: string): Promise<PutObjectCommandOutput> {
    const command = new PutObjectCommand({
      Bucket: process.env.S3_BUCKET_NAME,
      Key: key,
      Body: file,
      ContentType: contentType,
    });

    return await this.s3.send(command);
  }

  async getFile(key: string): Promise<Buffer> {
    try {
      const command = new GetObjectCommand({
        Bucket: process.env.S3_BUCKET_NAME,
        Key: key,
      });
      const data = await this.s3.send(command);
      const bodyContents = await streamToBuffer(data.Body as Readable);

      return bodyContents as unknown as Buffer;
    } catch (error: any) {
      if (error.code === 'NoSuchKey' || error.message === 'The specified key does not exist.') {
        throw new NonExistingFileError();
      }

      throw error;
    }
  }

  async deleteFile(key: string): Promise<void> {
    const command = new DeleteObjectCommand({
      Bucket: process.env.S3_BUCKET_NAME,
      Key: key,
    });
    await this.s3.send(command);
  }

  async getSignedUrl(key: string, contentType: string) {
    const command = new PutObjectCommand({
      Key: key,
      Bucket: process.env.S3_BUCKET_NAME,
      ACL: 'public-read',
      ContentType: contentType,
    });

    const signedUrl = await getSignedUrl(this.s3, command, { expiresIn: 3600 });
    const parsedUrl = new URL(signedUrl);
    const path = process.env.CDN_URL ? `${process.env.CDN_URL}/${key}` : `${parsedUrl.origin}${parsedUrl.pathname}`;

    return { signedUrl, path };
  }
}

export class GCSStorageService implements StorageService {
  private gcs = new Storage();

  async uploadFile(key: string, file: Buffer, contentType: string): Promise<PutObjectCommandOutput> {
    if (!process.env.GCS_BUCKET_NAME) throw new Error('GCS_BUCKET_NAME is not defined as env variable');

    const bucket = this.gcs.bucket(process.env.GCS_BUCKET_NAME);
    const fileObject = bucket.file(key);

    return (await fileObject.save(file, {
      contentType,
      metadata: {
        cacheControl: 'public, max-age=31536000',
      },
    })) as unknown as PutObjectCommandOutput;
  }

  async getFile(key: string): Promise<Buffer> {
    if (!process.env.GCS_BUCKET_NAME) throw new Error('GCS_BUCKET_NAME is not defined as env variable');

    try {
      const bucket = this.gcs.bucket(process.env.GCS_BUCKET_NAME);
      const fileObject = bucket.file(key);
      const [file] = await fileObject.download();

      return file;
    } catch (error: any) {
      if (error.code === 404) {
        throw new NonExistingFileError();
      }
      throw error;
    }
  }

  async deleteFile(key: string): Promise<void> {
    if (!process.env.GCS_BUCKET_NAME) throw new Error('GCS_BUCKET_NAME is not defined as env variable');

    const bucket = this.gcs.bucket(process.env.GCS_BUCKET_NAME);
    const fileObject = bucket.file(key);
    fileObject.delete();
  }

  async getSignedUrl(key: string, contentType: string) {
    if (!process.env.GCS_BUCKET_NAME) throw new Error('GCS_BUCKET_NAME is not defined as env variable');

    const [signedUrl] = await this.gcs
      .bucket(process.env.GCS_BUCKET_NAME)
      .file(key)
      .getSignedUrl({
        version: 'v4',
        action: 'write',
        expires: Date.now() + 60 * 60 * 1000, // 60 minutes
        contentType,
      });

    const parsedUrl = new URL(signedUrl);
    const path = process.env.CDN_URL
      ? `${process.env.CDN_URL}/${key}`
      : `${process.env.GCS_DOMAIN}${parsedUrl.pathname}`;

    return { signedUrl, path };
  }
}

export class AzureBlobStorageService implements StorageService {
  private sharedKeyCredential = new StorageSharedKeyCredential(
    process.env.AZURE_ACCOUNT_NAME as string,
    process.env.AZURE_ACCOUNT_KEY as string
  );
  private blobServiceClient = new BlobServiceClient(
    process.env.AZURE_HOST_NAME || `https://${process.env.AZURE_ACCOUNT_NAME}.blob.core.windows.net`,
    this.sharedKeyCredential
  );

  async uploadFile(key: string, file: Buffer, contentType: string): Promise<PutObjectCommandOutput> {
    if (!process.env.AZURE_CONTAINER_NAME) throw new Error('AZURE_CONTAINER_NAME is not defined as env variable');

    const containerClient = this.blobServiceClient.getContainerClient(process.env.AZURE_CONTAINER_NAME);
    const blockBlobClient = containerClient.getBlockBlobClient(key);

    return (await blockBlobClient.upload(file, file.length, {
      blobHTTPHeaders: {
        blobContentType: contentType,
      },
    })) as unknown as PutObjectCommandOutput;
  }

  async getFile(key: string): Promise<Buffer> {
    if (!process.env.AZURE_CONTAINER_NAME) throw new Error('AZURE_CONTAINER_NAME is not defined as env variable');

    const containerClient = this.blobServiceClient.getContainerClient(process.env.AZURE_CONTAINER_NAME);
    const blockBlobClient = containerClient.getBlockBlobClient(key);

    try {
      return await blockBlobClient.downloadToBuffer();
    } catch (error: any) {
      if (error.statusCode === 404) {
        throw new NonExistingFileError();
      }
      throw error;
    }
  }

  async deleteFile(key: string): Promise<void> {
    if (!process.env.AZURE_CONTAINER_NAME) throw new Error('AZURE_CONTAINER_NAME is not defined as env variable');

    const containerClient = this.blobServiceClient.getContainerClient(process.env.AZURE_CONTAINER_NAME);
    const blockBlobClient = containerClient.getBlockBlobClient(key);
    blockBlobClient.delete();
  }

  async getSignedUrl(key: string, contentType: string) {
    const containerName = process.env.AZURE_CONTAINER_NAME || 'novu';
    const blobName = key;
    const containerClient = this.blobServiceClient.getContainerClient(containerName);
    const blobClient = containerClient.getBlobClient(blobName);
    const blobSAS = generateBlobSASQueryParameters(
      {
        containerName,
        blobName,
        permissions: BlobSASPermissions.parse('racwd'),
        startsOn: new Date(),
        expiresOn: new Date(new Date().valueOf() + 60 * 60 * 1000), // 60 minutes
        protocol: SASProtocol.HttpsAndHttp,
        contentType,
      },
      this.sharedKeyCredential
    ).toString();

    const signedUrl = `${blobClient.url}?${blobSAS}`;
    const path = process.env.CDN_URL ? `${process.env.CDN_URL}/${key}` : `${blobClient.url}`;
    const additionalHeaders = {
      'x-ms-blob-type': 'BlockBlob',
    };

    return {
      signedUrl,
      path,
      additionalHeaders,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - streamToBuffer(stream: Readable)
Declaraciones 'export' encontradas:
- export  interface
- export  abstract
- export class S3StorageService
- export class GCSStorageService
- export class AzureBlobStorageService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/throttle/index.ts
Tamaño: 76 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './redis-throttle.service';
export * from './throttle.types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/throttle/redis-throttle.service.ts
Tamaño: 6726 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { Redis } from 'ioredis';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { IThrottleReservationParams, IThrottleReservationResult } from './throttle.types';

const LOG_CONTEXT = 'RedisThrottleService';

@Injectable()
export class RedisThrottleService {
  private reserveScriptSha: string | null = null;
  private releaseScriptSha: string | null = null;
  private readonly ttlBufferMs: number;

  private readonly reserveScript = `
    -- KEYS[1] = setKey
    -- ARGV[1] = limit
    -- ARGV[2] = ttlSec
    -- ARGV[3] = jobId
    -- Returns: {granted (0/1), countAfter, ttlSecRemaining}
    local setKey = KEYS[1]
    local limit = tonumber(ARGV[1])
    local ttlSec = tonumber(ARGV[2])
    local jobId = ARGV[3]

    -- Manual TTL check: if key exists but has expired, clean it up
    local currentTtl = redis.call('TTL', setKey)
    if currentTtl == 0 then
      -- Key exists but has no TTL (should not happen) or has expired
      redis.call('DEL', setKey)
    elseif currentTtl == -1 then
      -- Key exists but has no expiry set (should not happen with our logic)
      redis.call('DEL', setKey)
    end

    local count = redis.call('SCARD', setKey)
    if count >= limit then
      local ttl = redis.call('TTL', setKey)
      return {0, count, ttl}
    end

    local added = redis.call('SADD', setKey, jobId)
    if added == 0 then
      -- Job already exists, consider it granted
      local ttl = redis.call('TTL', setKey)
      return {1, count, ttl}
    end

    count = count + 1
    if count == 1 then
      redis.call('EXPIRE', setKey, ttlSec)
    end

    if count > limit then
      redis.call('SREM', setKey, jobId)
      local ttl = redis.call('TTL', setKey)
      return {0, count - 1, ttl}
    end

    local ttl = redis.call('TTL', setKey)
    return {1, count, ttl}
  `;

  private readonly releaseScript = `
    -- KEYS[1] = setKey
    -- ARGV[1] = jobId
    -- Returns: {removed (0/1), countAfter, ttlSecRemaining}
    local setKey = KEYS[1]
    local jobId = ARGV[1]
    
    -- Manual TTL check: if key exists but has expired, clean it up
    local currentTtl = redis.call('TTL', setKey)
    if currentTtl == 0 then
      -- Key exists but has no TTL (should not happen) or has expired
      redis.call('DEL', setKey)
      return {0, 0, 0}
    elseif currentTtl == -1 then
      -- Key exists but has no expiry set (should not happen with our logic)
      redis.call('DEL', setKey)
      return {0, 0, 0}
    end
    
    local removed = redis.call('SREM', setKey, jobId)
    local count = redis.call('SCARD', setKey)
    local ttl = redis.call('TTL', setKey)
    return {removed, count, ttl}
  `;

  constructor(private workflowInMemoryProviderService: WorkflowInMemoryProviderService) {
    this.ttlBufferMs = Number(process.env.THROTTLE_REDIS_TTL_BUFFER_MS) || 30000;
  }

  private get redisClient(): Redis | undefined {
    return this.workflowInMemoryProviderService.getClient() as Redis;
  }

  private buildSetKey(params: {
    environmentId: string;
    subscriberId: string;
    workflowId: string;
    stepId: string;
    throttleKey?: string;
    throttleValue?: string;
  }): string {
    const baseKey = `throttle:${params.environmentId}:${params.subscriberId}:${params.workflowId}:${params.stepId}`;
    const throttleKeyPart =
      params.throttleKey && params.throttleValue !== undefined ? `:${params.throttleKey}:${params.throttleValue}` : '';
    const finalKey = `${baseKey}${throttleKeyPart}:set`;

    return finalKey;
  }

  private computeTtlSeconds(windowMs: number): number {
    return Math.ceil((windowMs + this.ttlBufferMs) / 1000);
  }

  private async ensureScriptsLoaded(): Promise<void> {
    const client = this.redisClient;
    if (!client) {
      throw new Error('Redis client not available');
    }

    try {
      if (!this.reserveScriptSha) {
        this.reserveScriptSha = (await client.script('LOAD', this.reserveScript)) as string;
      }
      if (!this.releaseScriptSha) {
        this.releaseScriptSha = (await client.script('LOAD', this.releaseScript)) as string;
      }
    } catch (error) {
      Logger.error('Failed to load Lua scripts', error, LOG_CONTEXT);
      throw error;
    }
  }

  private async executeReserveScript(
    setKey: string,
    limit: number,
    ttlSec: number,
    jobId: string
  ): Promise<[number, number, number]> {
    const client = this.redisClient;
    if (!client) {
      throw new Error('Redis client not available');
    }

    try {
      await this.ensureScriptsLoaded();
      const result = await client.evalsha(
        this.reserveScriptSha!,
        1,
        setKey,
        limit.toString(),
        ttlSec.toString(),
        jobId
      );
      return result as [number, number, number];
    } catch (error: unknown) {
      const errorMessage = error instanceof Error ? error.message : String(error);
      if (errorMessage?.includes('NOSCRIPT')) {
        Logger.warn('Script not found, reloading and retrying', LOG_CONTEXT);
        this.reserveScriptSha = null;
        await this.ensureScriptsLoaded();
        const result = await client.evalsha(
          this.reserveScriptSha!,
          1,
          setKey,
          limit.toString(),
          ttlSec.toString(),
          jobId
        );
        return result as [number, number, number];
      }
      throw error;
    }
  }

  async reserveThrottleSlot(params: IThrottleReservationParams): Promise<IThrottleReservationResult> {
    const setKey = this.buildSetKey({
      environmentId: params.environmentId,
      subscriberId: params.subscriberId,
      workflowId: params.workflowId,
      stepId: params.stepId,
      throttleKey: params.throttleKey,
      throttleValue: params.throttleValue,
    });

    const ttlSec = this.computeTtlSeconds(params.windowMs);

    try {
      const [granted, count, ttlSecRemaining] = await this.executeReserveScript(
        setKey,
        params.limit,
        ttlSec,
        params.jobId
      );

      const result: IThrottleReservationResult = {
        granted: granted === 1,
        count,
        ttlMs: ttlSecRemaining > 0 ? ttlSecRemaining * 1000 : 0,
        windowStartMs: params.nowMs, // For sliding windows, window starts when first request arrives
      };

      Logger.debug(
        {
          ...params,
          setKey,
          result,
        },
        'Throttle slot reservation result',
        LOG_CONTEXT
      );

      return result;
    } catch (error) {
      Logger.error(
        {
          error,
          params,
          setKey,
        },
        'Failed to reserve throttle slot',
        LOG_CONTEXT
      );

      throw error;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class RedisThrottleService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/throttle/throttle.types.ts
Tamaño: 724 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IThrottleReservationParams {
  environmentId: string;
  subscriberId: string;
  workflowId: string;
  stepId: string;
  jobId: string;
  windowMs: number;
  limit: number;
  nowMs: number;
  throttleKey?: string;
  throttleValue?: string;
}

export interface IThrottleReservationResult {
  granted: boolean;
  count: number;
  ttlMs: number;
  windowStartMs: number;
}

export interface IThrottleReleaseParams {
  environmentId: string;
  subscriberId: string;
  workflowId: string;
  stepId: string;
  jobId: string;
  windowMs: number;
  nowMs: number;
  throttleKey?: string;
  throttleValue?: string;
}

export interface IThrottleReleaseResult {
  released: boolean;
  count: number;
  ttlMs: number;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/active-jobs-metric-worker.service.ts
Tamaño: 608 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkflowInMemoryProviderService } from '../in-memory-provider';
import { WorkerBaseService } from './worker-base.service';

const LOG_CONTEXT = 'ActiveJobsMetricWorkerService';

@Injectable()
export class ActiveJobsMetricWorkerService extends WorkerBaseService {
  constructor(private workflowInMemoryProvider: WorkflowInMemoryProviderService) {
    super(JobTopicNameEnum.ACTIVE_JOBS_METRIC, new BullMqService(workflowInMemoryProvider));
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ActiveJobsMetricWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/completed-jobs-metric-worker.service.ts
Tamaño: 0 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###



### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/inbound-parse-worker.service.ts
Tamaño: 0 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###



### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/index.ts
Tamaño: 475 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ActiveJobsMetricWorkerService } from './active-jobs-metric-worker.service';
export { StandardWorkerService } from './standard-worker.service';
export { SubscriberProcessWorkerService } from './subscriber-process-worker.service';
export { WebSocketsWorkerService } from './web-sockets-worker.service';
export {
  WorkerBaseService,
  WorkerOptions,
  WorkerProcessor,
} from './worker-base.service';
export { WorkflowWorkerService } from './workflow-worker.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/standard-worker.service.ts
Tamaño: 374 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkerBaseService } from './worker-base.service';

const LOG_CONTEXT = 'StandardWorkerService';

export class StandardWorkerService extends WorkerBaseService {
  constructor(public bullMqService: BullMqService) {
    super(JobTopicNameEnum.STANDARD, bullMqService);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StandardWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/subscriber-process-worker.service.ts
Tamaño: 403 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkerBaseService } from './worker-base.service';

const LOG_CONTEXT = 'SubscriberProcessWorkerService';

export class SubscriberProcessWorkerService extends WorkerBaseService {
  constructor(private bullMqService: BullMqService) {
    super(JobTopicNameEnum.PROCESS_SUBSCRIBER, bullMqService);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SubscriberProcessWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/web-sockets-worker.service.ts
Tamaño: 381 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkerBaseService } from './worker-base.service';

const LOG_CONTEXT = 'WebSocketsWorkerService';

export class WebSocketsWorkerService extends WorkerBaseService {
  constructor(public bullMqService: BullMqService) {
    super(JobTopicNameEnum.WEB_SOCKETS, bullMqService);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WebSocketsWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/worker-base.service.ts
Tamaño: 1866 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { JobTopicNameEnum } from '@novu/shared';

import { BullMqService, Processor, Worker, WorkerOptions } from '../bull-mq';
import { INovuWorker } from '../readiness';

const LOG_CONTEXT = 'WorkerService';

export type WorkerProcessor = string | Processor<any, unknown, string> | undefined;

export { WorkerOptions };

export class WorkerBaseService implements INovuWorker {
  private instance: BullMqService;

  public readonly DEFAULT_ATTEMPTS = 3;

  constructor(
    public readonly topic: JobTopicNameEnum,
    public bullMqServiceInstance: BullMqService
  ) {
    this.instance = bullMqServiceInstance;
  }

  public get worker(): Worker {
    return this.instance.worker;
  }

  public initWorker(processor: WorkerProcessor, options?: WorkerOptions): void {
    Logger.log(`Worker ${this.topic} initialized`, LOG_CONTEXT);

    this.createWorker(processor, options);
  }

  public createWorker(processor: WorkerProcessor, options: WorkerOptions): void {
    this.instance.createWorker(this.topic, processor, options);
  }

  public async isRunning(): Promise<boolean> {
    return await this.instance.isWorkerRunning();
  }

  public async isPaused(): Promise<boolean> {
    return await this.instance.isWorkerPaused();
  }

  public async pause(): Promise<void> {
    if (this.worker) {
      await this.instance.pauseWorker();
    }
  }

  public async resume(): Promise<void> {
    if (this.worker) {
      await this.instance.resumeWorker();
    }
  }

  public async gracefulShutdown(): Promise<void> {
    Logger.log(`Shutting the ${this.topic} worker service down`, LOG_CONTEXT);

    await this.instance.gracefulShutdown();

    Logger.log(`Shutting down the ${this.topic} worker service has finished`, LOG_CONTEXT);
  }

  async onModuleDestroy(): Promise<void> {
    await this.gracefulShutdown();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export
- export class WorkerBaseService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/services/workers/workflow-worker.service.ts
Tamaño: 374 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobTopicNameEnum } from '@novu/shared';
import { BullMqService } from '../bull-mq';
import { WorkerBaseService } from './worker-base.service';

const LOG_CONTEXT = 'WorkflowWorkerService';

export class WorkflowWorkerService extends WorkerBaseService {
  constructor(public bullMqService: BullMqService) {
    super(JobTopicNameEnum.WORKFLOW, bullMqService);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowWorkerService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/tracing/index.ts
Tamaño: 66 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './otel-wrapper';
export * from './tracing.module';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/tracing/otel-wrapper.ts
Tamaño: 2500 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, PipeTransform, Type } from '@nestjs/common';
import { MetricOptions, SpanOptions, Tracer } from '@opentelemetry/api';
import {
  Span,
  MetricService as setMetricService,
  OtelCounter as setOtelCounter,
  OtelHistogram as setOtelHistogram,
  OtelInstanceCounter as setOtelInstanceCounter,
  OtelObservableCounter as setOtelObservableCounter,
  OtelObservableGauge as setOtelObservableGauge,
  OtelObservableUpDownCounter as setOtelObservableUpDownCounter,
  OtelUpDownCounter as setOtelUpDownCounter,
  TraceService as setTraceService,
} from 'nestjs-otel';

export type OtelDataOrPipe = string | PipeTransform<any, any> | Type<PipeTransform<any, any>>;

export function OtelSpan(name?: string, options?: SpanOptions) {
  return Span(name, options);
}

export function OtelInstanceCounter(options?: MetricOptions) {
  return setOtelInstanceCounter(options);
}

export function OtelUpDownCounter(name: string, options?: MetricOptions) {
  return setOtelUpDownCounter(name, options);
}

export function OtelHistogram(name: string, options?: MetricOptions) {
  return setOtelHistogram(name, options);
}

export function OtelObservableGauge(name: string, options?: MetricOptions) {
  return setOtelObservableGauge(name, options);
}

export function OtelObservableCounter(name: string, options?: MetricOptions) {
  return setOtelObservableCounter(name, options);
}

export function OtelObservableUpDownCounter(name: string, options?: MetricOptions) {
  return setOtelObservableUpDownCounter(name, options);
}

export function OtelCounter(name: string, options?: MetricOptions) {
  return setOtelCounter(name, options);
}

@Injectable()
export class TraceService extends setTraceService {
  getTracer() {
    return super.getTracer();
  }

  getSpan() {
    return super.getSpan();
  }

  startSpan(name: string) {
    return super.startSpan(name);
  }
}

@Injectable()
export class MetricService extends setMetricService {
  getCounter(name, options) {
    return super.getCounter(name, options);
  }

  getUpDownCounter(name, options) {
    return super.getUpDownCounter(name, options);
  }

  getHistogram(name, options) {
    return super.getHistogram(name, options);
  }

  getObservableCounter(name, options) {
    return super.getObservableCounter(name, options);
  }

  getObservableGauge(name, options) {
    return super.getObservableGauge(name, options);
  }

  getObservableUpDownCounter(name, options) {
    return super.getObservableUpDownCounter(name, options);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - OtelSpan(name?: string, options?: SpanOptions)
 - OtelInstanceCounter(options?: MetricOptions)
 - OtelUpDownCounter(name: string, options?: MetricOptions)
 - OtelHistogram(name: string, options?: MetricOptions)
 - OtelObservableGauge(name: string, options?: MetricOptions)
 - OtelObservableCounter(name: string, options?: MetricOptions)
 - OtelObservableUpDownCounter(name: string, options?: MetricOptions)
 - OtelCounter(name: string, options?: MetricOptions)
Declaraciones 'export' encontradas:
- export  type
- export function OtelSpan
- export function OtelInstanceCounter
- export function OtelUpDownCounter
- export function OtelHistogram
- export function OtelObservableGauge
- export function OtelObservableCounter
- export function OtelObservableUpDownCounter
- export function OtelCounter
- export class TraceService
- export class MetricService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/tracing/tracing.module.ts
Tamaño: 956 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DynamicModule, Module } from '@nestjs/common';
import { OpenTelemetryModule } from 'nestjs-otel';
import { TracingService } from './tracing.service';

const OtelModule = OpenTelemetryModule.forRoot({
  metrics: {
    hostMetrics: true,
    apiMetrics: {
      enable: true,
      ignoreRoutes: ['/favicon.ico', '/v1/health-check'],
      // Records metrics for all URLs, even undefined ones
      ignoreUndefinedRoutes: true,
    },
  },
});

@Module({})
export class TracingModule {
  static register(serviceName: string, version: string): DynamicModule {
    return {
      module: TracingModule,
      imports: [OtelModule],
      providers: [
        TracingService,
        { provide: 'TRACING_SERVICE_NAME', useValue: serviceName },
        { provide: 'TRACING_SERVICE_VERSION', useValue: version },
        {
          provide: 'TRACING_ENABLE_OTEL',
          useValue: process.env.ENABLE_OTEL === 'true',
        },
      ],
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TracingModule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/tracing/tracing.service.ts
Tamaño: 932 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, OnModuleDestroy, OnModuleInit } from '@nestjs/common';
import { NodeSDK } from '@opentelemetry/sdk-node';
import { initializeOtelSdk } from './tracing';

@Injectable()
export class TracingService implements OnModuleInit, OnModuleDestroy {
  private otelSDKInstance: NodeSDK;

  constructor(
    @Inject('TRACING_SERVICE_NAME') private readonly serviceName: string,
    @Inject('TRACING_SERVICE_VERSION') private readonly version: string,
    @Inject('TRACING_ENABLE_OTEL') private readonly otelEnabled: boolean
  ) {}

  async onModuleDestroy() {
    if (this.otelSDKInstance) {
      await this.otelSDKInstance.shutdown();
    }
  }
  onModuleInit() {
    if (!this.hasValidParameters()) return;

    this.otelSDKInstance = initializeOtelSdk(this.serviceName, this.version);
    this.otelSDKInstance.start();
  }

  private hasValidParameters() {
    return this.serviceName && this.otelEnabled;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TracingService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/tracing/tracing.ts
Tamaño: 1974 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';
import { AsyncLocalStorageContextManager } from '@opentelemetry/context-async-hooks';
import { CompositePropagator, W3CBaggagePropagator, W3CTraceContextPropagator } from '@opentelemetry/core';
import { PrometheusExporter } from '@opentelemetry/exporter-prometheus';
import { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-http';
import { B3InjectEncoding, B3Propagator } from '@opentelemetry/propagator-b3';
import { JaegerPropagator } from '@opentelemetry/propagator-jaeger';
import { Resource } from '@opentelemetry/resources';
import { NodeSDK } from '@opentelemetry/sdk-node';
import { BatchSpanProcessor } from '@opentelemetry/sdk-trace-base';
import { SemanticResourceAttributes } from '@opentelemetry/semantic-conventions';

export function initializeOtelSdk(serviceName: string, version: string) {
  return new NodeSDK({
    resource: new Resource({
      'service.version': version,
      'service.group': 'instrumentation-group',
      [SemanticResourceAttributes.SERVICE_NAME]: serviceName,
    }),
    metricReader: new PrometheusExporter({
      port: 9464,
      preventServerStart: false,
      appendTimestamp: true,
    }),
    spanProcessor: new BatchSpanProcessor(new OTLPTraceExporter(), {
      // The maximum queue size. After the size is reached spans are dropped.
      maxQueueSize: 1000,
      // The interval between two consecutive exports
      scheduledDelayMillis: 30000,
    }),
    contextManager: new AsyncLocalStorageContextManager(),
    serviceName,
    textMapPropagator: new CompositePropagator({
      propagators: [
        new JaegerPropagator(),
        new W3CTraceContextPropagator(),
        new W3CBaggagePropagator(),
        new B3Propagator(),
        new B3Propagator({
          injectEncoding: B3InjectEncoding.MULTI_HEADER,
        }),
      ],
    }),
    instrumentations: [getNodeAutoInstrumentations()],
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - initializeOtelSdk(serviceName: string, version: string)
Declaraciones 'export' encontradas:
- export function initializeOtelSdk

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/index.ts
Tamaño: 1718 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './bulk-create-execution-details';
export * from './calculate-limit-novu-integration';
export * from './compile-email-template';
export * from './compile-in-app-template';
export * from './compile-step-template';
export * from './compile-template';
export * from './conditions-filter';
export * from './create-change';
export * from './create-execution-details';
export * from './create-notification-jobs';
export * from './create-or-update-subscriber';
export * from './create-tenant';
export * from './delete-preferences';
export * from './digest-filter-steps';
export * from './execute-bridge-request';
export * from './get-decrypted-integrations';
export * from './get-decrypted-secret-key';
export * from './get-layout';
export * from './get-novu-layout';
export * from './get-novu-provider-credentials';
export * from './get-preferences';
export * from './get-subscriber-schedule';
export * from './get-subscriber-template-preference';
export * from './get-tenant';
export * from './get-topic-subscribers';
export * from './merge-preferences';
export * from './message-template';
export * from './normalize-variables';
export * from './process-tenant';
export * from './promote-type-change.command';
export * from './select-integration';
export * from './select-variant';
export * from './subscribers';
export * from './tier-restrictions-validate';
export * from './trigger-base';
export * from './trigger-broadcast';
export * from './trigger-event';
export * from './trigger-multicast';
export * from './update-change';
export * from './update-subscriber';
export * from './update-tenant';
export * from './upsert-control-values';
export * from './upsert-preferences';
export * from './workflow';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/promote-type-change.command.ts
Tamaño: 252 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsDefined } from 'class-validator';
import { EnvironmentWithUserCommand } from '../commands';
import { IItem } from './create-change';

export class PromoteTypeChangeCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  item: IItem;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PromoteTypeChangeCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/bulk-create-execution-details/bulk-create-execution-details.command.ts
Tamaño: 267 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentWithSubscriber } from '../../commands';
import { CreateExecutionDetailsCommand } from '../create-execution-details';

export class BulkCreateExecutionDetailsCommand extends EnvironmentWithSubscriber {
  details: CreateExecutionDetailsCommand[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class BulkCreateExecutionDetailsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/bulk-create-execution-details/bulk-create-execution-details.usecase.ts
Tamaño: 1629 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { DalException, ExecutionDetailsEntity, ExecutionDetailsRepository } from '@novu/dal';
import { InstrumentUsecase } from '../../instrumentation';
import { PlatformException } from '../../utils/exceptions';
import { mapExecutionDetailsCommandToEntity } from '../create-execution-details';
import { BulkCreateExecutionDetailsCommand } from './bulk-create-execution-details.command';

const LOG_CONTEXT = 'BulkCreateExecutionDetails';

@Injectable()
export class BulkCreateExecutionDetails {
  constructor(private executionDetailsRepository: ExecutionDetailsRepository) {}

  @InstrumentUsecase()
  async execute(command: BulkCreateExecutionDetailsCommand) {
    const entities = [];
    command.details.forEach((detail) => {
      let entity = mapExecutionDetailsCommandToEntity(detail);

      entity = this.cleanFromNulls(entity);

      entities.push(entity);
    });

    try {
      await this.executionDetailsRepository.insertMany(entities);
      Logger.verbose({ entities }, 'Bulk execution details created', LOG_CONTEXT);
    } catch (error) {
      Logger.error({ entities, error }, 'Bulk execution details creation failed', LOG_CONTEXT);

      if (error instanceof DalException) {
        throw new PlatformException(error.message);
      }
      throw error;
    }
  }

  private cleanFromNulls(
    entity: Omit<ExecutionDetailsEntity, 'createdAt' | '_id'>
  ): Omit<ExecutionDetailsEntity, 'createdAt' | '_id'> {
    const cleanEntity = { ...entity };

    if (cleanEntity.raw === null) {
      delete cleanEntity.raw;
    }

    return cleanEntity;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - entities([];
    command.details.forEach((detail))
Declaraciones 'export' encontradas:
- export class BulkCreateExecutionDetails

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/bulk-create-execution-details/index.ts
Tamaño: 179 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { BulkCreateExecutionDetailsCommand } from './bulk-create-execution-details.command';
export { BulkCreateExecutionDetails } from './bulk-create-execution-details.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/calculate-limit-novu-integration/calculate-limit-novu-integration.command.ts
Tamaño: 301 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum } from '@novu/shared';
import { IsEnum } from 'class-validator';

import { EnvironmentCommand } from '../../commands/project.command';

export class CalculateLimitNovuIntegrationCommand extends EnvironmentCommand {
  @IsEnum(ChannelTypeEnum)
  channelType: ChannelTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CalculateLimitNovuIntegrationCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/calculate-limit-novu-integration/calculate-limit-novu-integration.usecase.ts
Tamaño: 2680 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { MessageRepository } from '@novu/dal';
import { ChannelTypeEnum, ChatProviderIdEnum, EmailProviderIdEnum, SmsProviderIdEnum } from '@novu/shared';
import { endOfMonth, startOfMonth } from 'date-fns';

import { areNovuEmailCredentialsSet, areNovuSmsCredentialsSet } from '../../utils/novu-integrations';
import { CalculateLimitNovuIntegrationCommand } from './calculate-limit-novu-integration.command';

@Injectable()
export class CalculateLimitNovuIntegration {
  constructor(private messageRepository: MessageRepository) {}

  static MAX_NOVU_INTEGRATION_MAIL_REQUESTS = parseInt(process.env.MAX_NOVU_INTEGRATION_MAIL_REQUESTS || '300', 10);

  static MAX_NOVU_INTEGRATION_SMS_REQUESTS = parseInt(process.env.MAX_NOVU_INTEGRATION_SMS_REQUESTS || '20', 10);

  static MAX_NOVU_INTEGRATION_CHAT_REQUESTS = parseInt(process.env.MAX_NOVU_INTEGRATION_CHAT_REQUESTS || '300', 10);

  async execute(command: CalculateLimitNovuIntegrationCommand): Promise<{ limit: number; count: number } | undefined> {
    const { channelType } = command;

    if (channelType === ChannelTypeEnum.EMAIL && !areNovuEmailCredentialsSet()) {
      return;
    }

    if (channelType === ChannelTypeEnum.SMS && !areNovuSmsCredentialsSet()) {
      return;
    }

    const providerId = CalculateLimitNovuIntegration.getProviderId(channelType);

    if (providerId === undefined) {
      return;
    }
    const limit = CalculateLimitNovuIntegration.getLimit(channelType);

    const messagesCount = await this.messageRepository.count(
      {
        channel: command.channelType,
        _environmentId: command.environmentId,
        providerId,
        createdAt: {
          $gte: startOfMonth(new Date()),
          $lte: endOfMonth(new Date()),
        },
      },
      limit
    );

    return {
      limit,
      count: messagesCount,
    };
  }

  static getProviderId(type: ChannelTypeEnum) {
    switch (type) {
      case ChannelTypeEnum.EMAIL:
        return EmailProviderIdEnum.Novu;
      case ChannelTypeEnum.SMS:
        return SmsProviderIdEnum.Novu;
      case ChannelTypeEnum.CHAT:
        return ChatProviderIdEnum.Novu;
      default:
        return undefined;
    }
  }

  static getLimit(type: ChannelTypeEnum): number {
    switch (type) {
      case ChannelTypeEnum.EMAIL:
        return CalculateLimitNovuIntegration.MAX_NOVU_INTEGRATION_MAIL_REQUESTS;
      case ChannelTypeEnum.SMS:
        return CalculateLimitNovuIntegration.MAX_NOVU_INTEGRATION_SMS_REQUESTS;
      case ChannelTypeEnum.CHAT:
        return CalculateLimitNovuIntegration.MAX_NOVU_INTEGRATION_CHAT_REQUESTS;
      default:
        return 0;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CalculateLimitNovuIntegration

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/calculate-limit-novu-integration/index.ts
Tamaño: 120 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './calculate-limit-novu-integration.command';
export * from './calculate-limit-novu-integration.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-email-template/compile-email-template.command.ts
Tamaño: 742 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IEmailBlock } from '@novu/dal';
import { LayoutId, MessageTemplateContentType } from '@novu/shared';
import { IsDefined, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands/project.command';

export class CompileEmailTemplateCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  content: string | IEmailBlock[];

  @IsString()
  contentType: MessageTemplateContentType;

  @IsDefined()
  payload: any;

  @IsString()
  subject: string;

  @IsOptional()
  @IsString()
  layoutId?: LayoutId | null;

  @IsString()
  @IsOptional()
  preheader?: string | null;

  @IsString()
  @IsOptional()
  senderName?: string | null;

  @IsString()
  @IsOptional()
  locale?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileEmailTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-email-template/compile-email-template.usecase.ts
Tamaño: 7873 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import { CommunityOrganizationRepository, IEmailBlock } from '@novu/dal';
import { merge } from 'es-toolkit/compat';
import { readFile } from 'fs/promises';
import { VerifyPayloadService } from '../../services';
import { CompileTemplate, CompileTemplateBase } from '../compile-template';
import { GetLayoutCommand, GetLayoutUseCase, LayoutDto } from '../get-layout';
import { GetNovuLayout } from '../get-novu-layout';
import { CompileEmailTemplateCommand } from './compile-email-template.command';

@Injectable()
export class CompileEmailTemplate extends CompileTemplateBase {
  constructor(
    private compileTemplate: CompileTemplate,
    protected communityOrganizationRepository: CommunityOrganizationRepository,
    private getLayoutUsecase: GetLayoutUseCase,
    private getNovuLayoutUsecase: GetNovuLayout,
    protected moduleRef: ModuleRef
  ) {
    super(communityOrganizationRepository, moduleRef);
  }

  public async execute(
    command: CompileEmailTemplateCommand,
    // we need i18nInstance outside the command on order to avoid command serialization on it.
    i18nInstance?: any
  ) {
    const verifyPayloadService = new VerifyPayloadService();
    const organization = await this.getOrganization(command.organizationId);

    const isEditorMode = command.contentType === 'editor';

    let layout: LayoutDto | null = null;
    let layoutContent: string | null = null;

    if (command.layoutId) {
      layout = await this.getLayoutUsecase.execute(
        GetLayoutCommand.create({
          layoutIdOrInternalId: command.layoutId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
        })
      );

      layoutContent = layout.content;
    } else if (isEditorMode && !command.layoutId) {
      layoutContent = await this.getNovuLayoutUsecase.execute({});
    }

    const layoutVariables = layout?.variables || [];
    const defaultPayload = verifyPayloadService.verifyPayload(layoutVariables, command.payload);

    let helperBlocksContent: string | null = null;
    if (isEditorMode) {
      helperBlocksContent = await this.loadTemplateContent('basic.handlebars');
    }

    let subject = '';
    let senderName;
    const { content } = command;
    let { preheader } = command;

    command.payload = merge({}, defaultPayload, command.payload);

    const payload = {
      ...command.payload,
      preheader,
      blocks: [],
      branding: {
        logo: organization.branding?.logo,
        color: organization.branding?.color || '#f47373',
      },
    };

    try {
      subject = await this.renderContent(command.subject, payload, i18nInstance);

      if (preheader) {
        preheader = await this.renderContent(preheader, payload, i18nInstance);
      }

      if (command.senderName) {
        senderName = await this.renderContent(command.senderName, payload, i18nInstance);
      }
    } catch (e: any) {
      throw new BadRequestException(e?.message || `Email subject message content could not be generated`);
    }

    const customLayout = CompileEmailTemplate.addPreheader(layoutContent as string);

    if (isEditorMode) {
      for (const block of content as IEmailBlock[]) {
        block.content = await this.renderContent(block.content, payload, i18nInstance);
        block.url = await this.renderContent(block.url || '', payload, i18nInstance);
      }
    }

    const templateVariables = {
      ...payload,
      subject,
      preheader,
      body: '',
      blocks: isEditorMode ? content : [],
    };

    const body = await this.compileTemplate.execute(
      {
        template: !isEditorMode ? (content as string) : (helperBlocksContent as string),
        data: templateVariables,
      },
      i18nInstance
    );

    templateVariables.body = body as string;

    const html = customLayout
      ? await this.compileTemplate.execute(
          {
            template: customLayout,
            data: templateVariables,
          },
          i18nInstance
        )
      : body;

    return { html, content, subject, senderName };
  }

  private async renderContent(content: string, payload: Record<string, unknown>, i18nInstance: any) {
    const renderedContent = await this.compileTemplate.execute(
      {
        template: content,
        data: {
          ...payload,
        },
      },
      i18nInstance
    );

    return renderedContent?.trim() || '';
  }

  public static addPreheader(content: string): string {
    // "&nbsp;&zwnj;&nbsp;&zwnj;" is needed to spacing away the rest of the email from the preheader area in email clients
    return content?.replace(
      /<body\b[^<>]*?>/,
      `$&{{#if preheader}}
          <div style="display: none; max-height: 0px; overflow: hidden;">
            {{preheader}}
            &nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;
          </div>
        {{/if}}`
    );
  }

  private async loadTemplateContent(name: string) {
    const content = await readFile(`${__dirname}/templates/${name}`);

    return content.toString();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileEmailTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-email-template/index.ts
Tamaño: 100 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './compile-email-template.command';
export * from './compile-email-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-email-template/templates/basic.handlebars
Tamaño: 1403 bytes
Lenguaje detectado: HANDLEBARS

### CONTENIDO ORIGINAL ###


{{#each blocks}}
  <div style="margin-bottom: 10px" data-test-id="block-item-wrapper">
    {{#equals type 'text'}}
      <div style="
        text-align: {{#if styles.textAlign}}{{styles.textAlign}}{{else}}left{{/if}};
        ">
        <div>
          <p>
            {{{content}}}
          </p>
        </div>
      </div>
    {{/equals}}
    {{#equals type 'button'}}
      <div>
        <div
          style="
                                                      font-family: inherit;
                                                      text-align: center;
                                                    "
        >
          <a style="
            line-height: 30px;
            display: inline-block;
            font-weight: 400;
            white-space: nowrap;
            text-align: center;
            border: 1px solid transparent;
            height: 32px;
            padding: 4px 15px;
            font-size: 14px;
            border-radius: 4px;
            color: white;
            background: {{#if ../branding.color}}{{../branding.color}}{{else}}#ff6f61{{/if}};
            border-color: {{#if ../branding.color}}{{../branding.color}}{{else}}#ff6f61{{/if}};
            text-decoration: none;
            "
             href="{{{url}}}"
             target="_blank">
            {{{content}}}
          </a>
        </div>
      </div>
    {{/equals}}
  </div>
{{/each}}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{{#each blocks}}
<div style="margin-bottom: 10px" data-test-id="block-item-wrapper">
{{#equals type 'text'}}
<div style="
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-in-app-template/compile-in-app-template.command.ts
Tamaño: 426 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IMessageCTA } from '@novu/shared';
import { IsDefined, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands/project.command';

export class CompileInAppTemplateCommand extends EnvironmentWithUserCommand {
  @IsOptional()
  content?: string;

  @IsDefined()
  payload: any;

  @IsOptional()
  cta?: IMessageCTA;

  @IsString()
  @IsOptional()
  locale?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileInAppTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-in-app-template/compile-in-app-template.usecase.ts
Tamaño: 2394 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import { CommunityOrganizationRepository, OrganizationEntity } from '@novu/dal';
import { IMessageButton } from '@novu/shared';
import { CompileTemplate, CompileTemplateBase } from '../compile-template';
import { CompileInAppTemplateCommand } from './compile-in-app-template.command';

@Injectable()
export class CompileInAppTemplate extends CompileTemplateBase {
  constructor(
    private compileTemplate: CompileTemplate,
    protected communityOrganizationRepository: CommunityOrganizationRepository,
    protected moduleRef: ModuleRef
  ) {
    super(communityOrganizationRepository, moduleRef);
  }

  public async execute(
    command: CompileInAppTemplateCommand,
    // we need i18nInstance outside the command on order to avoid command serialization on it.
    i18nInstance?: any
  ) {
    const organization = await this.getOrganization(command.organizationId);
    const payload = command.payload || {};

    let content = '';
    const ctaButtons: IMessageButton[] = [];
    let url;

    try {
      content = command.content
        ? await this.compileInAppTemplate(command.content, payload, organization, i18nInstance)
        : '';

      if (command.cta?.data?.url) {
        url = await this.compileInAppTemplate(command.cta?.data?.url, payload, organization, i18nInstance);
      }

      if (command.cta?.action?.buttons) {
        for (const action of command.cta.action.buttons) {
          const buttonContent = await this.compileInAppTemplate(action.content, payload, organization, i18nInstance);
          ctaButtons.push({ type: action.type, content: buttonContent });
        }
      }
    } catch (e: any) {
      throw new BadRequestException(e?.message || `In-App Message content could not be generated`);
    }

    return { content, ctaButtons, url };
  }

  private async compileInAppTemplate(
    content: string,
    payload: any,
    organization: OrganizationEntity | null,
    i18nInstance: any
  ): Promise<string> {
    return await this.compileTemplate.execute(
      {
        template: content as string,
        data: {
          ...payload,
          branding: {
            logo: organization?.branding?.logo,
            color: organization?.branding?.color || '#f47373',
          },
        },
      },
      i18nInstance
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileInAppTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-in-app-template/index.ts
Tamaño: 102 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './compile-in-app-template.command';
export * from './compile-in-app-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-step-template/compile-step-template.command.ts
Tamaño: 376 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsDefined, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands/project.command';

export class CompileStepTemplateCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  content: string;

  @IsOptional()
  title?: string;

  @IsDefined()
  payload: any;

  @IsString()
  @IsOptional()
  locale?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileStepTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-step-template/compile-step-template.usecase.ts
Tamaño: 1603 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import { CommunityOrganizationRepository } from '@novu/dal';
import { CompileTemplate, CompileTemplateBase } from '../compile-template';
import { CompileStepTemplateCommand } from './compile-step-template.command';

@Injectable()
export class CompileStepTemplate extends CompileTemplateBase {
  constructor(
    private compileTemplate: CompileTemplate,
    protected communityOrganizationRepository: CommunityOrganizationRepository,
    protected moduleRef: ModuleRef
  ) {
    super(communityOrganizationRepository, moduleRef);
  }

  public async execute(
    command: CompileStepTemplateCommand,
    // we need i18nInstance outside the command on order to avoid command serialization on it.
    i18nInstance?: any
  ) {
    const payload = command.payload || {};

    let content = '';

    let title: string | undefined;

    try {
      content = await this.compileStepTemplate(command.content, payload, i18nInstance);

      if (command.title) {
        title = await this.compileStepTemplate(command.title, payload, i18nInstance);
      }
    } catch (e: any) {
      throw new BadRequestException(e?.message || `Compile step content failed to generate`);
    }

    return { content, title };
  }

  private async compileStepTemplate(content: string, payload: any, i18nInstance?: any): Promise<string> {
    return await this.compileTemplate.execute(
      {
        template: content as string,
        data: {
          ...payload,
        },
      },
      i18nInstance
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileStepTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-step-template/index.ts
Tamaño: 98 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './compile-step-template.command';
export * from './compile-step-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-template/compile-template.base.ts
Tamaño: 732 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotFoundException } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import { CommunityOrganizationRepository, OrganizationEntity } from '@novu/dal';

export abstract class CompileTemplateBase {
  protected constructor(
    protected communityOrganizationRepository: CommunityOrganizationRepository,
    protected moduleRef: ModuleRef
  ) {}

  protected async getOrganization(organizationId: string): Promise<OrganizationEntity | undefined> {
    const organization = await this.communityOrganizationRepository.findById(organizationId, 'branding defaultLocale');

    if (!organization) {
      throw new NotFoundException(`Organization ${organizationId} not found`);
    }

    return organization;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-template/compile-template.command.ts
Tamaño: 297 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsDefined, IsObject } from 'class-validator';

import { BaseCommand } from '../../commands/base.command';

export class CompileTemplateCommand extends BaseCommand {
  @IsDefined()
  template: string;

  @IsObject()
  data: any; // eslint-disable-line @typescript-eslint/no-explicit-any
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CompileTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-template/compile-template.spec.ts
Tamaño: 9092 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { CompileTemplateCommand } from './compile-template.command';
import { CompileTemplate } from './compile-template.usecase';

describe('Compile Template', () => {
  let useCase: CompileTemplate;

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [],
      providers: [CompileTemplate],
    }).compile();

    useCase = moduleRef.get<CompileTemplate>(CompileTemplate);
  });

  it('should render custom html', async () => {
    const result = await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
        name: 'Test Name',
      },
      template: '<div>{{name}}</div>',
    });

    expect(result).toEqual('<div>Test Name</div>');
  });

  it('should render pluralisation in html', async () => {
    const result = await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
        dog_count: 1,
        sausage_count: 2,
      },
      template:
        '<div>{{dog_count}} {{pluralize dog_count "dog" "dogs"}} and {{sausage_count}} {{pluralize sausage_count "sausage" "sausages"}} for {{pluralize dog_count "him" "them"}}</div>',
    });

    expect(result).toEqual('<div>1 dog and 2 sausages for him</div>');
  });

  it('should render unique values of array', async () => {
    const result = await useCase.execute({
      data: {
        names: [{ name: 'dog' }, { name: 'cat' }, { name: 'dog' }],
      },
      template: '<div>{{#each (unique names "name")}}{{this}}-{{/each}}</div>',
    });

    expect(result).toEqual('<div>dog-cat-</div>');
  });

  it('should render groupBy values of array', async () => {
    const result = await useCase.execute({
      data: {
        names: [
          {
            name: 'Name 1',
            age: '30',
          },
          {
            name: 'Name 2',
            age: '31',
          },
          {
            name: 'Name 1',
            age: '32',
          },
        ],
      },
      template: '{{#each (groupBy names "name")}}<h1>{{key}}</h1>{{#each items}}{{age}}-{{/each}}{{/each}}',
    });

    expect(result).toEqual('<h1>Name 1</h1>30-32-<h1>Name 2</h1>31-');
  });

  it('should render sortBy values of array', async () => {
    const result = await useCase.execute({
      data: {
        people: [
          {
            name: 'a75',
            item1: false,
            item2: false,
            id: 1,
            updated_at: '2023-01-01T06:25:24Z',
          },
          {
            name: 'z32',
            item1: true,
            item2: false,
            id: 3,
            updated_at: '2023-01-09T11:25:13Z',
          },
          {
            name: 'e77',
            item1: false,
            item2: false,
            id: 2,
            updated_at: '2023-01-05T04:13:24Z',
          },
        ],
      },
      template: `{{#each (sortBy people 'updated_at')}}{{name}} - {{id}}{{/each}}`,
    });

    expect(result).toEqual('a75 - 1e77 - 2z32 - 3');
  });

  it('should allow the user to specify handlebars helpers', async () => {
    const result = await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
        message: 'hello world',
        messageTwo: 'hEllo world',
      },
      template: '<div>{{titlecase message}} and {{lowercase messageTwo}} and {{uppercase message}}</div>',
    });

    expect(result).toEqual('<div>Hello World and hello world and HELLO WORLD</div>');
  });

  it('should allow apostrophes to be in data', async () => {
    const result = await useCase.execute({
      data: {
        message: "hello' world",
      },
      template: '<div>{{message}}</div>',
    });

    expect(result).toEqual("<div>hello' world</div>");
  });

  describe('Date Formation', () => {
    it('should allow user to format the date', async () => {
      const result = await useCase.execute({
        data: {
          date: '2020-01-01',
        },
        template: "<div>{{dateFormat date 'EEEE, MMMM Do yyyy'}}</div>",
      });
      expect(result).toEqual('<div>Wednesday, January 1st 2020</div>');
    });

    it('should not fail and return same date for invalid date', async () => {
      const result = await useCase.execute({
        data: {
          date: 'ABCD',
        },
        template: "<div>{{dateFormat date 'EEEE, MMMM Do yyyy'}}</div>",
      });
      expect(result).toEqual('<div>ABCD</div>');
    });
  });

  describe('Number formating', () => {
    it('should format number', async () => {
      const result = await useCase.execute({
        data: { number: 1000000000 },
        template: '<div>{{numberFormat number decimalSep="," decimalLength="2" thousandsSep="|"}}</div>',
      });

      expect(result).toEqual('<div>1|000|000|000,00</div>');
    });

    it('should not fail and return passed value', async () => {
      const result = await useCase.execute({
        data: { number: 'Not a number' },
        template: '<div>{{numberFormat number decimalSep="," decimalLength="2" thousandsSep="|"}}</div>',
      });

      expect(result).toEqual('<div>Not a number</div>');
    });
  });

  describe('gt helper', () => {
    const template = `{{#gt steps 5 }}<span>gt block</span>{{else}}<span>else block</span>{{/gt}}`;
    it('shoud render gt block', async () => {
      const result = await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result).toEqual('<span>gt block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });

  describe('gte helper', () => {
    const template = `{{#gte steps 5 }}<span>gte block</span>{{else}}<span>else block</span>{{/gte}}`;
    it('shoud render gte block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>gte block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 4 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });

  describe('lt helper', () => {
    const template = `{{#lt steps 5 }}<span>lt block</span>{{else}}<span>else block</span>{{/lt}}`;
    it('shoud render lt block', async () => {
      const result = await useCase.execute({
        data: { steps: 4 },
        template,
      });

      expect(result).toEqual('<span>lt block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });

  describe('lte helper', () => {
    const template = `{{#lte steps 5 }}<span>lte block</span>{{else}}<span>else block</span>{{/lte}}`;
    it('shoud render lte block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>lte block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });

  describe('eq helper', () => {
    const template = `{{#eq steps 5 }}<span>eq block</span>{{else}}<span>else block</span>{{/eq}}`;
    it('shoud render eq block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>eq block</span>');
    });

    it('shoud use strict check and render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: '5' },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });

  describe('ne helper', () => {
    const template = `{{#ne steps 5 }}<span>ne block</span>{{else}}<span>else block</span>{{/ne}}`;
    it('shoud render ne block', async () => {
      const result = await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result).toEqual('<span>ne block</span>');
    });

    it('shoud use strict check and render ne block', async () => {
      const result = await useCase.execute({
        data: { steps: '5' },
        template,
      });

      expect(result).toEqual('<span>ne block</span>');
    });

    it('shoud render alternative block', async () => {
      const result = await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result).toEqual('<span>else block</span>');
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useCase(moduleRef.get<CompileTemplate>(CompileTemplate);
  });

  it('should render custom html', async ())
 - result(await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
 ...)
 - result(await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
 ...)
 - result(await useCase.execute({
      data: {
        names: [{ name: 'dog' }, { name: 'cat' }, { name: 'dog...)
 - result(await useCase.execute({
      data: {
        names: [
          {
            name: 'Name 1',
     ...)
 - result(await useCase.execute({
      data: {
        people: [
          {
            name: 'a75',
       ...)
 - result(await useCase.execute({
      data: {
        branding: {
          color: '#e7e7e7e9',
        },
 ...)
 - result(await useCase.execute({
      data: {
        message: "hello' world",
      },
      template: '<di...)
 - result(await useCase.execute({
        data: {
          date: '2020-01-01',
        },
        template: "...)
 - result(await useCase.execute({
        data: {
          date: 'ABCD',
        },
        template: "<div>{...)
 - thousandsSep("|"}}</div>',
      });

      expect(result).toEqual('<div>1|000|000|000,00</div>');
    });

    i...)
 - thousandsSep("|"}}</div>',
      });

      expect(result).toEqual('<div>Not a number</div>');
    });
  });

  d...)
 - template(`{{#gt steps 5 }}<span>gt block</span>{{else}}<span>else block</span>{{/gt}}`;
    it('shoud render ...)
 - result(await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result...)
 - template(`{{#gte steps 5 }}<span>gte block</span>{{else}}<span>else block</span>{{/gte}}`;
    it('shoud rend...)
 - result(await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: 4 },
        template,
      });

      expect(result...)
 - template(`{{#lt steps 5 }}<span>lt block</span>{{else}}<span>else block</span>{{/lt}}`;
    it('shoud render ...)
 - result(await useCase.execute({
        data: { steps: 4 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result...)
 - template(`{{#lte steps 5 }}<span>lte block</span>{{else}}<span>else block</span>{{/lte}}`;
    it('shoud rend...)
 - result(await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result...)
 - template(`{{#eq steps 5 }}<span>eq block</span>{{else}}<span>else block</span>{{/eq}}`;
    it('shoud render ...)
 - result(await useCase.execute({
        data: { steps: 5 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: '5' },
        template,
      });

      expect(resu...)
 - result(await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result...)
 - template(`{{#ne steps 5 }}<span>ne block</span>{{else}}<span>else block</span>{{/ne}}`;
    it('shoud render ...)
 - result(await useCase.execute({
        data: { steps: 6 },
        template,
      });

      expect(result...)
 - result(await useCase.execute({
        data: { steps: '5' },
        template,
      });

      expect(resu...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-template/compile-template.usecase.ts
Tamaño: 5439 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { HandlebarHelpersEnum } from '@novu/shared';
import { format } from 'date-fns';
import Handlebars from 'handlebars';
import { CompileTemplateCommand } from './compile-template.command';

const assertResult = (condition: boolean, options) => {
  const fn = condition ? options.fn : options.inverse;

  return typeof fn === 'function' ? fn(this) : condition;
};

function createHandlebarsInstance(i18next: any) {
  const handlebars = Handlebars.create();

  handlebars.registerHelper('json', (context) => JSON.stringify(context));

  if (i18next) {
    handlebars.registerHelper(HandlebarHelpersEnum.I18N, function (key, { hash, data, fn }) {
      const options = {
        ...data.root.i18next,
        ...hash,
        returnObjects: false,
      };

      const replace = (options.replace = {
        // @ts-ignore
        ...this,
        ...options.replace,
        ...hash,
      });
      delete replace.i18next; // may creep in if this === data.root

      if (fn) {
        options.defaultValue = fn(replace);
      }

      // @ts-ignore
      return new handlebars.SafeString(i18next.t(key, options));
    });
  }

  handlebars.registerHelper(HandlebarHelpersEnum.EQUALS, function (arg1, arg2, options) {
    // @ts-expect-error
    return arg1 == arg2 ? options.fn(this) : options.inverse(this);
  });

  handlebars.registerHelper(HandlebarHelpersEnum.TITLECASE, (value) =>
    value
      ?.split(' ')
      .map((letter) => letter.charAt(0).toUpperCase() + letter.slice(1).toLowerCase())
      .join(' ')
  );

  handlebars.registerHelper(HandlebarHelpersEnum.UPPERCASE, (value) => value?.toUpperCase());

  handlebars.registerHelper(HandlebarHelpersEnum.LOWERCASE, (value) => value?.toLowerCase());

  handlebars.registerHelper(HandlebarHelpersEnum.PLURALIZE, (number, single, plural) =>
    number === 1 ? single : plural
  );

  handlebars.registerHelper(HandlebarHelpersEnum.DATEFORMAT, (date, dateFormat) => {
    // Format date if parameters are valid
    if (date && dateFormat && !Number.isNaN(Date.parse(date))) {
      return format(new Date(date), dateFormat);
    }

    return date;
  });

  handlebars.registerHelper(HandlebarHelpersEnum.GROUP_BY, (array, property) => {
    if (!Array.isArray(array)) return [];
    const map = {};
    array.forEach((item) => {
      if (item[property]) {
        const key = item[property];
        if (!map[key]) {
          map[key] = [item];
        } else {
          map[key].push(item);
        }
      }
    });

    const result = [];
    for (const [key, value] of Object.entries(map)) {
      result.push({ key, items: value });
    }

    return result;
  });

  handlebars.registerHelper(HandlebarHelpersEnum.UNIQUE, (array, property) => {
    if (!Array.isArray(array)) return '';

    return array
      .map((item) => {
        if (item[property]) {
          return item[property];
        }
      })
      .filter((value, index, self) => self.indexOf(value) === index);
  });

  handlebars.registerHelper(HandlebarHelpersEnum.SORT_BY, (array, property) => {
    if (!Array.isArray(array)) return '';
    if (!property) return array.sort();

    return array.sort((a, b) => {
      const _x = a[property];
      const _y = b[property];

      return _x < _y ? -1 : _x > _y ? 1 : 0;
    });
  });

  // based on: https://gist.github.com/DennyLoko/61882bc72176ca74a0f2
  handlebars.registerHelper(HandlebarHelpersEnum.NUMBERFORMAT, (number, options) => {
    if (Number.isNaN(number)) {
      return number;
    }

    const decimalLength = options.hash.decimalLength || 2;
    const thousandsSep = options.hash.thousandsSep || ',';
    const decimalSep = options.hash.decimalSep || '.';

    const value = parseFloat(number);

    const re = `\\d(?=(\\d{3})+${decimalLength > 0 ? '\\D' : '$'})`;

    const num = value.toFixed(Math.max(0, ~~decimalLength));

    return (decimalSep ? num.replace('.', decimalSep) : num).replace(new RegExp(re, 'g'), `$&${thousandsSep}`);
  });

  handlebars.registerHelper(HandlebarHelpersEnum.GT, (arg1, arg2, options) => assertResult(arg1 > arg2, options));

  handlebars.registerHelper(HandlebarHelpersEnum.GTE, (arg1, arg2, options) => assertResult(arg1 >= arg2, options));

  handlebars.registerHelper(HandlebarHelpersEnum.LT, (arg1, arg2, options) => assertResult(arg1 < arg2, options));

  handlebars.registerHelper(HandlebarHelpersEnum.LTE, (arg1, arg2, options) => assertResult(arg1 <= arg2, options));

  handlebars.registerHelper(HandlebarHelpersEnum.EQ, (arg1, arg2, options) => assertResult(arg1 === arg2, options));

  handlebars.registerHelper(HandlebarHelpersEnum.NE, (arg1, arg2, options) => assertResult(arg1 !== arg2, options));

  return handlebars;
}

@Injectable()
export class CompileTemplate {
  async execute(
    command: CompileTemplateCommand,
    // we need i18nInstance outside the command on order to avoid command serialization on it.
    i18nInstance?: any
  ): Promise<string> {
    const templateContent = command.template || '';

    let result = '';
    try {
      const handlebars = createHandlebarsInstance(i18nInstance);
      const template = handlebars.compile(templateContent);

      result = template(command.data, {});
    } catch (e: any) {
      throw new BadRequestException(e?.message || `Handlebars message content could not be generated ${e}`);
    }

    return result.replace(/&#x27;/g, "'");
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createHandlebarsInstance(i18next: any)
Asignaciones con arrow functions encontradas (posibles funciones):
 - assertResult(condition: boolean, options))
 - handlebars(Handlebars.create();

  handlebars.registerHelper('json', (context))
 - map({};
    array.forEach((item))
 - result([];
    for (const [key, value] of Object.entries(map)) {
      result.push({ key, items: value });
...)
 - _y(b[property];

      return _x < _y ? -1 : _x > _y ? 1 : 0;
    });
  });

  // based on: https://gis...)
 - num(value.toFixed(Math.max(0, ~~decimalLength));

    return (decimalSep ? num.replace('.', decimalSep) ...)
Declaraciones 'export' encontradas:
- export class CompileTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/compile-template/index.ts
Tamaño: 129 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './compile-template.base';
export * from './compile-template.command';
export * from './compile-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/conditions-filter/conditions-filter.command.ts
Tamaño: 434 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobEntity, NotificationStepEntity, StepFilter } from '@novu/dal';
import { IsDefined } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';
import { IFilterVariables } from '../../utils';

export class ConditionsFilterCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  filters: StepFilter[];

  job?: JobEntity;

  step?: NotificationStepEntity;

  variables?: IFilterVariables;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ConditionsFilterCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/conditions-filter/conditions-filter.usecase.ts
Tamaño: 14976 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { forwardRef, Inject, Injectable } from '@nestjs/common';
import {
  EnvironmentRepository,
  ExecutionDetailsRepository,
  JobEntity,
  JobRepository,
  MessageRepository,
  StepFilter,
  SubscriberEntity,
  SubscriberRepository,
} from '@novu/dal';
import {
  ChannelTypeEnum,
  ExecutionDetailsSourceEnum,
  ExecutionDetailsStatusEnum,
  FILTER_TO_LABEL,
  FieldLogicalOperatorEnum,
  FieldOperatorEnum,
  FilterParts,
  FilterPartTypeEnum,
  ICondition,
  IOnlineInLastFilterPart,
  IPreviousStepFilterPart,
  IRealtimeOnlineFilterPart,
  IWebhookFilterPart,
  PreviousStepTypeEnum,
  TimeOperatorEnum,
} from '@novu/shared';
import axios from 'axios';
import { differenceInDays, differenceInHours, differenceInMinutes, parseISO } from 'date-fns';
import { decryptApiKey } from '../../encryption';
import { buildSubscriberKey, CachedResponse } from '../../services';
import { createHash, Filter, FilterProcessingDetails, IFilterVariables, PlatformException } from '../../utils';
import { CompileTemplate } from '../compile-template';
import { CreateExecutionDetails, CreateExecutionDetailsCommand, DetailEnum } from '../create-execution-details';
import { ConditionsFilterCommand } from './conditions-filter.command';

export interface IConditionsFilterResponse {
  passed: boolean;
  conditions: ICondition[];
  variables: IFilterVariables;
}

@Injectable()
export class ConditionsFilter extends Filter {
  constructor(
    private subscriberRepository: SubscriberRepository,
    private messageRepository: MessageRepository,
    private jobRepository: JobRepository,
    private environmentRepository: EnvironmentRepository,
    @Inject(forwardRef(() => CreateExecutionDetails))
    private createExecutionDetails: CreateExecutionDetails,
    private compileTemplate: CompileTemplate
  ) {
    super();
  }

  public async filter(command: ConditionsFilterCommand): Promise<IConditionsFilterResponse> {
    const { variables } = command;
    const filters = this.extractFilters(command);

    if (!filters || !Array.isArray(filters) || filters.length === 0) {
      return {
        passed: true,
        conditions: [],
        variables,
      };
    }

    const details: FilterProcessingDetails[] = [];

    const foundFilter = await this.findAsync(filters, async (filter) => {
      const filterProcessingDetails = new FilterProcessingDetails();
      filterProcessingDetails.addFilter(filter, variables);

      const { children } = filter;
      const noRules = !children || (Array.isArray(children) && children.length === 0);
      if (noRules) {
        return true;
      }

      const singleRule = !children || (Array.isArray(children) && children.length === 1);
      if (singleRule) {
        const result = await this.processFilter(variables, children[0], command, filterProcessingDetails);

        details.push(filterProcessingDetails);

        return result;
      }

      const result = await this.handleGroupFilters(filter, variables, command, filterProcessingDetails);

      details.push(filterProcessingDetails);

      return result;
    });

    const conditions = details
      .map((detail) => detail.toObject().conditions)
      .reduce((conditionsArray, collection) => [...collection, ...conditionsArray], []);

    return {
      passed: !!foundFilter,
      conditions,
      variables,
    };
  }

  private extractFilters(command: ConditionsFilterCommand) {
    return command.filters?.length ? command.filters : command.step?.filters?.length ? command.step.filters : [];
  }

  public static sumFilters(
    summary: {
      filters: string[];
      failedFilters: string[];
      passedFilters: string[];
    },
    condition: ICondition
  ) {
    let type: string = condition.filter?.toLowerCase();

    if (condition.filter === FILTER_TO_LABEL.isOnline || condition.filter === FILTER_TO_LABEL.isOnlineInLast) {
      type = 'online';
    }

    return Filter.sumFilters(summary, condition, type);
  }

  private async processPreviousStep(
    filter: IPreviousStepFilterPart,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    const job = await this.jobRepository.findOne({
      transactionId: command.job.transactionId,
      _subscriberId: command.job._subscriberId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      'step.uuid': filter.step,
    });

    if (!job) {
      return true;
    }

    const message = await this.messageRepository.findOne({
      _jobId: job._id,
      _environmentId: command.environmentId,
      _subscriberId: command.job._subscriberId,
      transactionId: command.job.transactionId,
    });

    if (!message) {
      return true;
    }

    const label = FILTER_TO_LABEL[filter.on];
    const field = filter.stepType;
    const expected = 'true';
    const operator = FieldOperatorEnum.EQUAL;

    const value = [PreviousStepTypeEnum.SEEN, PreviousStepTypeEnum.UNSEEN].includes(filter.stepType)
      ? message.seen
      : message.read;
    const passed = [PreviousStepTypeEnum.UNREAD, PreviousStepTypeEnum.UNSEEN].includes(filter.stepType)
      ? value === false
      : value;

    filterProcessingDetails.addCondition({
      filter: label,
      field,
      expected,
      actual: `${passed}`,
      operator,
      passed,
    });

    return passed;
  }

  private async processIsOnline(
    filter: IRealtimeOnlineFilterPart | IOnlineInLastFilterPart,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    const subscriber = await this.getSubscriberBySubscriberId({
      subscriberId: command.job.subscriberId,
      _environmentId: command.environmentId,
    });

    const hasNoOnlineFieldsSet =
      typeof subscriber?.isOnline === 'undefined' && typeof subscriber?.lastOnlineAt === 'undefined';
    const isOnlineString = `${subscriber?.isOnline ?? ''}`;
    const lastOnlineAtString = `${subscriber?.lastOnlineAt ?? ''}`;
    // the old subscriber created before the is online functionality should not be processed
    if (hasNoOnlineFieldsSet) {
      filterProcessingDetails.addCondition({
        filter: FILTER_TO_LABEL[filter.on],
        field: 'isOnline',
        expected: `${filter.value}`,
        actual: `${filter.on === FilterPartTypeEnum.IS_ONLINE ? isOnlineString : lastOnlineAtString}`,
        operator: filter.on === FilterPartTypeEnum.IS_ONLINE ? FieldOperatorEnum.EQUAL : filter.timeOperator,
        passed: false,
      });

      return false;
    }

    const isOnlineMatch = subscriber?.isOnline === filter.value;
    if (filter.on === FilterPartTypeEnum.IS_ONLINE) {
      filterProcessingDetails.addCondition({
        filter: FILTER_TO_LABEL[filter.on],
        field: 'isOnline',
        expected: `${filter.value}`,
        actual: isOnlineString,
        operator: FieldOperatorEnum.EQUAL,
        passed: isOnlineMatch,
      });

      return isOnlineMatch;
    }

    const currentDate = new Date();
    const lastOnlineAt = subscriber?.lastOnlineAt ? parseISO(subscriber?.lastOnlineAt) : new Date();
    const diff = differenceIn(currentDate, lastOnlineAt, filter.timeOperator);
    const result = subscriber?.isOnline || (!subscriber?.isOnline && diff >= 0 && diff <= filter.value);

    filterProcessingDetails.addCondition({
      filter: FILTER_TO_LABEL[filter.on],
      field: subscriber?.isOnline ? 'isOnline' : 'lastOnlineAt',
      expected: subscriber?.isOnline ? 'true' : `${filter.value}`,
      actual: `${subscriber?.isOnline ? 'true' : diff}`,
      operator: filter.timeOperator,
      passed: result,
    });

    return result;
  }

  private async getWebhookResponse(
    child: IWebhookFilterPart,
    variables: IFilterVariables,
    command: ConditionsFilterCommand
  ): Promise<Record<string, unknown> | undefined> {
    if (!child.webhookUrl) return undefined;

    const payload = await this.buildPayload(variables, command);

    const hmac = await this.buildHmac(command);

    const config = {
      headers: {
        'nv-hmac-256': hmac,
      },
    };

    try {
      return await axios.post(child.webhookUrl, payload, config).then((response) => {
        return response.data as Record<string, unknown>;
      });
    } catch (err: any) {
      throw new Error(
        JSON.stringify({
          message: err.message,
          data: 'Exception while performing webhook request.',
        })
      );
    }
  }

  private async buildHmac(command: ConditionsFilterCommand): Promise<string> {
    if (process.env.NODE_ENV === 'test') return '';

    const environment = await this.environmentRepository.findOne({
      _id: command.environmentId,
      _organizationId: command.organizationId,
    });
    if (!environment) throw new PlatformException('Environment is not found');

    return createHash(decryptApiKey(environment.apiKeys[0].key), command.environmentId);
  }

  private async buildPayload(variables: IFilterVariables, command: ConditionsFilterCommand) {
    if (process.env.NODE_ENV === 'test') return variables;

    const payload: Partial<{
      subscriber: SubscriberEntity | null;
      payload: Record<string, unknown>;
      identifier: string;
      channel: string;
      providerId: string;
    }> = {};

    if (variables.subscriber) {
      payload.subscriber = variables.subscriber;
    } else {
      payload.subscriber = await this.subscriberRepository.findBySubscriberId(
        command.environmentId,
        command.job.subscriberId
      );
    }

    if (variables.payload) {
      payload.payload = variables.payload;
    }

    payload.identifier = command.job.identifier;
    payload.channel = command.job.type;

    if (command.job.providerId) {
      payload.providerId = command.job.providerId;
    }

    return payload;
  }

  private async processFilter(
    variables: IFilterVariables,
    child: FilterParts,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    let passed = false;

    if (child.on === FilterPartTypeEnum.WEBHOOK) {
      if (process.env.NODE_ENV === 'test') return true;
      child.value = await this.compileFilter(child.value, variables, command.job);
      const res = await this.getWebhookResponse(child, variables, command);
      passed = this.processFilterEquality({ payload: undefined, webhook: res }, child, filterProcessingDetails);
    }

    if (
      child.on === FilterPartTypeEnum.TENANT ||
      child.on === FilterPartTypeEnum.PAYLOAD ||
      child.on === FilterPartTypeEnum.SUBSCRIBER
    ) {
      child.value = await this.compileFilter(child.value, variables, command.job);

      passed = this.processFilterEquality(variables, child, filterProcessingDetails);
    }

    if (child.on === FilterPartTypeEnum.IS_ONLINE || child.on === FilterPartTypeEnum.IS_ONLINE_IN_LAST) {
      passed = await this.processIsOnline(child, command, filterProcessingDetails);
    }

    if (child.on === FilterPartTypeEnum.PREVIOUS_STEP) {
      passed = await this.processPreviousStep(child, command, filterProcessingDetails);
    }

    return passed;
  }
  private async handleGroupFilters(
    filter: StepFilter,
    variables: IFilterVariables,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    if (filter.value === FieldLogicalOperatorEnum.OR) {
      return await this.handleOrFilters(filter, variables, command, filterProcessingDetails);
    }

    if (filter.value === FieldLogicalOperatorEnum.AND) {
      return await this.handleAndFilters(filter, variables, command, filterProcessingDetails);
    }

    return false;
  }

  private async handleAndFilters(
    filter: StepFilter,
    variables: IFilterVariables,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    const { webhookFilters, otherFilters } = this.splitFilters(filter);

    const matchedOtherFilters = await this.filterAsync(otherFilters, (i) =>
      this.processFilter(variables, i, command, filterProcessingDetails)
    );
    if (otherFilters.length !== matchedOtherFilters.length) {
      return false;
    }

    const matchedWebhookFilters = await this.filterAsync(webhookFilters, (i) =>
      this.processFilter(variables, i, command, filterProcessingDetails)
    );

    return matchedWebhookFilters.length === webhookFilters.length;
  }

  private splitFilters(filter: StepFilter) {
    const webhookFilters = filter.children.filter((childFilter) => childFilter.on === 'webhook');

    const otherFilters = filter.children.filter((childFilter) => childFilter.on !== 'webhook');

    return { webhookFilters, otherFilters };
  }

  private async handleOrFilters(
    filter: StepFilter,
    variables: IFilterVariables,
    command: ConditionsFilterCommand,
    filterProcessingDetails: FilterProcessingDetails
  ): Promise<boolean> {
    const { webhookFilters, otherFilters } = this.splitFilters(filter);

    const foundFilter = await this.findAsync(otherFilters, (i) =>
      this.processFilter(variables, i, command, filterProcessingDetails)
    );
    if (foundFilter) {
      return true;
    }

    return !!(await this.findAsync(webhookFilters, (i) =>
      this.processFilter(variables, i, command, filterProcessingDetails)
    ));
  }

  private async compileFilter(value: string, variables: IFilterVariables, job: JobEntity): Promise<string | undefined> {
    try {
      return await this.compileTemplate.execute({
        template: value,
        data: {
          ...variables,
        },
      });
    } catch (e: any) {
      await this.createExecutionDetails.execute(
        CreateExecutionDetailsCommand.create({
          ...CreateExecutionDetailsCommand.getDetailsFromJob(job),
          detail: DetailEnum.PROCESSING_STEP_FILTER_ERROR,
          source: ExecutionDetailsSourceEnum.INTERNAL,
          status: ExecutionDetailsStatusEnum.FAILED,
          isTest: false,
          isRetry: false,
          raw: JSON.stringify({ error: e?.message }),
        })
      );
    }
  }

  @CachedResponse({
    builder: (command: { subscriberId: string; _environmentId: string }) =>
      buildSubscriberKey({
        _environmentId: command._environmentId,
        subscriberId: command.subscriberId,
      }),
  })
  public async getSubscriberBySubscriberId({
    subscriberId,
    _environmentId,
  }: {
    subscriberId: string;
    _environmentId: string;
  }) {
    return await this.subscriberRepository.findOne({
      _environmentId,
      subscriberId,
    });
  }
}

const differenceIn = (currentDate: Date, lastDate: Date, timeOperator: TimeOperatorEnum) => {
  if (timeOperator === TimeOperatorEnum.MINUTES) {
    return differenceInMinutes(currentDate, lastDate);
  }

  if (timeOperator === TimeOperatorEnum.HOURS) {
    return differenceInHours(currentDate, lastDate);
  }

  return differenceInDays(currentDate, lastDate);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - foundFilter(await this.findAsync(filters, async (filter))
 - conditions(details
      .map((detail))
 - config({
      headers: {
        'nv-hmac-256': hmac,
      },
    };

    try {
      return await axios....)
 - matchedOtherFilters(await this.filterAsync(otherFilters, (i))
 - matchedWebhookFilters(await this.filterAsync(webhookFilters, (i))
 - webhookFilters(filter.children.filter((childFilter))
 - otherFilters(filter.children.filter((childFilter))
 - foundFilter(await this.findAsync(otherFilters, (i))
 - differenceIn(currentDate: Date, lastDate: Date, timeOperator: TimeOperatorEnum))
Declaraciones 'export' encontradas:
- export  interface
- export class ConditionsFilter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/conditions-filter/index.ts
Tamaño: 90 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './conditions-filter.command';
export * from './conditions-filter.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-change/create-change.command.ts
Tamaño: 567 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChangeEntityTypeEnum } from '@novu/shared';
import { IsDefined, IsMongoId, IsOptional, IsString } from 'class-validator';
import { Document } from 'mongoose';
import { EnvironmentWithUserCommand } from '../../commands';

export interface IItem extends Pick<Document, '_id'> {
  [key: string]: any;
}

export class CreateChangeCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  item: IItem;

  @IsDefined()
  @IsString()
  type: ChangeEntityTypeEnum;

  @IsMongoId()
  changeId: string;

  @IsMongoId()
  @IsOptional()
  parentChangeId?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class CreateChangeCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-change/create-change.usecase.ts
Tamaño: 1540 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { ChangeRepository } from '@novu/dal';
import { applyDiff, getDiff } from 'recursive-diff';

import { CreateChangeCommand } from './create-change.command';

@Injectable()
export class CreateChange {
  constructor(private changeRepository: ChangeRepository) {}

  async execute(command: CreateChangeCommand) {
    const changes = await this.changeRepository.getEntityChanges(
      command.organizationId,
      command.type,
      command.item._id
    );
    const aggregatedItem = changes
      .filter((change) => change.enabled)
      .reduce((prev, change) => {
        return applyDiff(prev, change.change);
      }, {});

    const changePayload = getDiff(aggregatedItem, command.item, true);

    const change = await this.changeRepository.findOne({
      _environmentId: command.environmentId,
      _id: command.changeId,
    });

    if (change) {
      change.change = changePayload;

      await this.changeRepository.update(
        { _environmentId: command.environmentId, _id: command.changeId },
        {
          $set: change,
        }
      );

      return change;
    }

    const item = await this.changeRepository.create({
      _organizationId: command.organizationId,
      _environmentId: command.environmentId,
      _creatorId: command.userId,
      change: changePayload,
      type: command.type,
      _entityId: command.item._id,
      enabled: false,
      _parentId: command.parentChangeId,
      _id: command.changeId,
    });

    return item;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - aggregatedItem(changes
      .filter((change))
Declaraciones 'export' encontradas:
- export class CreateChange

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-change/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './create-change.command';
export * from './create-change.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/create-execution-details.command.ts
Tamaño: 2566 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExecutionDetailsEntity, ExecutionDetailsRepository, JobEntity } from '@novu/dal';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum, StepTypeEnum } from '@novu/shared';
import { EmailEventStatusEnum, SmsEventStatusEnum } from '@novu/stateless';
import { IsDate, IsDefined, IsNotEmpty, IsOptional, IsString } from 'class-validator';
import { EnvironmentWithSubscriber } from '../../commands';
import { DetailEnum } from './types';

export class CreateExecutionDetailsCommand extends EnvironmentWithSubscriber {
  // used for trace log
  @IsString()
  @IsDefined()
  workflowRunIdentifier: string;

  @IsOptional()
  jobId?: string;

  @IsNotEmpty()
  notificationId: string;

  @IsOptional()
  notificationTemplateId?: string;

  @IsOptional()
  messageId?: string;

  @IsOptional()
  providerId?: string;

  @IsNotEmpty()
  transactionId: string;

  @IsOptional()
  channel?: StepTypeEnum;

  @IsNotEmpty()
  detail: DetailEnum;

  @IsNotEmpty()
  source: ExecutionDetailsSourceEnum;

  @IsNotEmpty()
  status: ExecutionDetailsStatusEnum;

  @IsNotEmpty()
  isTest: boolean;

  @IsNotEmpty()
  isRetry: boolean;

  @IsOptional()
  @IsString()
  raw?: string | null;

  @IsOptional()
  @IsString()
  // todo check if this can required
  _subscriberId?: string;

  @IsOptional()
  @IsString()
  _id?: string;

  @IsOptional()
  @IsDate()
  createdAt?: Date;

  webhookStatus?: EmailEventStatusEnum | SmsEventStatusEnum;

  static getDetailsFromJob(
    job: JobEntity
  ): Pick<
    CreateExecutionDetailsCommand,
    | 'environmentId'
    | 'organizationId'
    | 'subscriberId'
    | '_subscriberId'
    | 'jobId'
    | 'notificationId'
    | 'notificationTemplateId'
    | 'providerId'
    | 'transactionId'
    | 'channel'
    | 'workflowRunIdentifier'
  > {
    return {
      environmentId: job._environmentId,
      organizationId: job._organizationId,
      subscriberId: job.subscriberId,
      // backward compatibility - ternary needed to be removed once the queue renewed
      _subscriberId: job._subscriberId ? job._subscriberId : job.subscriberId,
      jobId: job._id,
      notificationId: job._notificationId,
      notificationTemplateId: job._templateId,
      providerId: job.providerId,
      transactionId: job.transactionId,
      channel: job.type,
      workflowRunIdentifier: job.identifier,
    };
  }

  static getExecutionLogMetadata(): Pick<ExecutionDetailsEntity, '_id'> & {
    createdAt: Date;
  } {
    return {
      _id: ExecutionDetailsRepository.createObjectId(),
      createdAt: new Date(),
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateExecutionDetailsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/create-execution-details.spec.ts
Tamaño: 1957 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { ExecutionDetailsRepository } from '@novu/dal';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum, StepTypeEnum } from '@novu/shared';
import { UserSession } from '@novu/testing';
import { CreateExecutionDetailsCommand } from './create-execution-details.command';
import { CreateExecutionDetails } from './create-execution-details.usecase';
import { DetailEnum } from './types';

describe('Create Execution Details', () => {
  let useCase: CreateExecutionDetails;
  let session: UserSession;

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [ExecutionDetailsRepository, CreateExecutionDetails],
      providers: [],
    }).compile();

    session = new UserSession();
    await session.initialize();

    useCase = moduleRef.get<CreateExecutionDetails>(CreateExecutionDetails);
  });

  it('should create the execution details for a job of a notification', async () => {
    const command = CreateExecutionDetailsCommand.create({
      organizationId: session.organization._id,
      environmentId: session.environment._id,
      subscriberId: session.subscriberId,
      jobId: ExecutionDetailsRepository.createObjectId(),
      notificationId: ExecutionDetailsRepository.createObjectId(),
      notificationTemplateId: ExecutionDetailsRepository.createObjectId(),
      messageId: ExecutionDetailsRepository.createObjectId(),
      providerId: 'test-provider-id',
      transactionId: 'test-transaction-id',
      channel: StepTypeEnum.SMS,
      detail: DetailEnum.MESSAGE_SENT,
      source: ExecutionDetailsSourceEnum.WEBHOOK,
      status: ExecutionDetailsStatusEnum.SUCCESS,
      isTest: false,
      isRetry: false,
      workflowRunIdentifier: 'test-workflow-run-identifier',
    });

    const result = await useCase.execute(command);

    expect(result).toHaveProperty('id');
    expect(result).toHaveProperty('createdAt');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useCase(moduleRef.get<CreateExecutionDetails>(CreateExecutionDetails);
  });

  it('should create the execut...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/create-execution-details.usecase.ts
Tamaño: 8776 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { ExecutionDetailsEntity, ExecutionDetailsRepository } from '@novu/dal';
import { ExecutionDetailsStatusEnum, FeatureFlagsKeysEnum } from '@novu/shared';
import { FeatureFlagsService, LogRepository, StepType } from '../../services';
import { EntityType, EventType, TraceLogRepository, TraceStatus } from '../../services/analytic-logs/trace-log';
import { CreateExecutionDetailsCommand } from './create-execution-details.command';
import { mapExecutionDetailsCommandToEntity } from './dtos/execution-details.dto';
import { DetailEnum } from './types';

// Using satisfies ensures all DetailEnum values are mapped at compile time
const mapDetailToEventType = {
  // Step events
  [DetailEnum.STEP_CREATED]: 'step_created',
  [DetailEnum.STEP_QUEUED]: 'step_queued',
  [DetailEnum.STEP_DELAYED]: 'step_delayed',
  [DetailEnum.STEP_DIGESTED]: 'step_digested',
  [DetailEnum.STEP_FILTERED_BY_SUBSCRIBER_WORKFLOW_PREFERENCES]: 'step_filtered',
  [DetailEnum.STEP_FILTERED_BY_SUBSCRIBER_GLOBAL_PREFERENCES]: 'step_filtered',
  [DetailEnum.STEP_FILTERED_BY_WORKFLOW_RESOURCE_PREFERENCES]: 'step_filtered',
  [DetailEnum.STEP_FILTERED_BY_USER_WORKFLOW_PREFERENCES]: 'step_filtered',
  [DetailEnum.PROCESSING_STEP_FILTER]: 'step_filter_processing',
  [DetailEnum.PROCESSING_STEP_FILTER_ERROR]: 'step_filter_failed',

  // Message events
  [DetailEnum.MESSAGE_CREATED]: 'message_created',
  [DetailEnum.MESSAGE_SENT]: 'message_sent',
  [DetailEnum.MESSAGE_SEEN]: 'message_seen',
  [DetailEnum.MESSAGE_READ]: 'message_read',
  [DetailEnum.MESSAGE_CLICKED]: 'message_clicked',
  [DetailEnum.MESSAGE_DELIVERED]: 'message_delivered',
  [DetailEnum.MESSAGE_REJECTED]: 'message_rejected',
  [DetailEnum.MESSAGE_BLOCKED]: 'message_blocked',
  [DetailEnum.MESSAGE_SPAM]: 'message_spam',
  [DetailEnum.MESSAGE_BOUNCED]: 'message_bounced',
  [DetailEnum.MESSAGE_DROPPED]: 'message_dropped',
  [DetailEnum.MESSAGE_DEFERRED]: 'message_deferred',
  [DetailEnum.MESSAGE_UNSUBSCRIBED]: 'message_unsubscribed',
  [DetailEnum.MESSAGE_DELAYED]: 'message_delayed',
  [DetailEnum.MESSAGE_COMPLAINT]: 'message_complaint',
  [DetailEnum.MESSAGE_SNOOZED]: 'message_snoozed',
  [DetailEnum.MESSAGE_UNSNOOZED]: 'message_unsnoozed',
  [DetailEnum.MESSAGE_UNSNOOZE_FAILED]: 'message_unsnooze_failed',
  [DetailEnum.MESSAGE_CONTENT_NOT_GENERATED]: 'message_content_failed',
  [DetailEnum.MESSAGE_CONTENT_SYNTAX_ERROR]: 'message_content_failed',
  [DetailEnum.MESSAGE_SEVERITY_OVERRIDDEN]: 'message_severity_overridden',

  // Subscriber events
  [DetailEnum.SUBSCRIBER_NO_ACTIVE_INTEGRATION]: 'subscriber_integration_missing',
  [DetailEnum.SUBSCRIBER_MISSING_EMAIL_ADDRESS]: 'subscriber_missing_email_address',
  [DetailEnum.SUBSCRIBER_MISSING_PHONE_NUMBER]: 'subscriber_missing_phone_number',
  [DetailEnum.SUBSCRIBER_NO_ACTIVE_CHANNEL]: 'subscriber_channel_missing',
  [DetailEnum.SUBSCRIBER_NOT_MEMBER_OF_ORGANIZATION]: 'subscriber_validation_failed',

  // Provider events
  [DetailEnum.PROVIDER_ERROR]: 'provider_error',
  [DetailEnum.LIMIT_PASSED_NOVU_INTEGRATION]: 'provider_limit_exceeded',

  // Digest events
  [DetailEnum.DIGEST_MERGED]: 'digest_merged',
  [DetailEnum.DIGEST_SKIPPED]: 'digest_skipped',
  [DetailEnum.DIGEST_TRIGGERED_EVENTS]: 'digest_triggered',
  [DetailEnum.START_DIGESTING]: 'digest_started',

  // Delay events
  [DetailEnum.DELAY_FINISHED]: 'delay_completed',
  [DetailEnum.DELAY_MISCONFIGURATION]: 'delay_misconfigured',
  [DetailEnum.DEFER_DURATION_LIMIT_EXCEEDED]: 'delay_limit_exceeded',

  // Throttle events
  [DetailEnum.STEP_THROTTLED]: 'step_throttled',
  [DetailEnum.THROTTLE_LIMIT_EXCEEDED]: 'throttle_limit_exceeded',
  [DetailEnum.THROTTLE_WINDOW_IN_PAST]: 'throttle_window_in_past',

  // Workflow events
  [DetailEnum.STEP_COMPLETED]: 'step_completed',

  // Bridge events
  [DetailEnum.FAILED_BRIDGE_EXECUTION]: 'bridge_execution_failed',
  [DetailEnum.SKIPPED_BRIDGE_EXECUTION]: 'bridge_execution_skipped',

  // Webhook events
  [DetailEnum.WEBHOOK_FILTER_FAILED_RETRY]: 'webhook_filter_retrying',
  [DetailEnum.WEBHOOK_FILTER_FAILED_LAST_RETRY]: 'webhook_filter_failed',

  // Integration events
  [DetailEnum.INTEGRATION_INSTANCE_SELECTED]: 'integration_selected',

  // Layout events
  [DetailEnum.LAYOUT_NOT_FOUND]: 'layout_not_found',
  [DetailEnum.LAYOUT_SELECTED]: 'layout_selected',

  // Tenant events
  [DetailEnum.TENANT_CONTEXT_SELECTED]: 'tenant_selected',
  [DetailEnum.TENANT_NOT_FOUND]: 'tenant_not_found',

  // Variant events
  [DetailEnum.VARIANT_CHOSEN]: 'variant_selected',

  // Notification events
  [DetailEnum.NOTIFICATION_ERROR]: 'notification_error',

  // Chat events
  [DetailEnum.CHAT_WEBHOOK_URL_MISSING]: 'chat_webhook_missing',
  [DetailEnum.CHAT_ALL_CHANNELS_FAILED]: 'chat_all_channels_failed',
  [DetailEnum.CHAT_MISSING_PHONE_NUMBER]: 'chat_phone_missing',
  [DetailEnum.CHAT_SOME_CHANNELS_SKIPPED]: 'chat_some_channels_skipped',

  // Push events
  [DetailEnum.PUSH_MISSING_DEVICE_TOKENS]: 'push_tokens_missing',
  [DetailEnum.PUSH_SOME_CHANNELS_SKIPPED]: 'push_some_channels_skipped',

  // Reply/Inbound mail events
  [DetailEnum.REPLY_CALLBACK_MISSING_REPLAY_CALLBACK_URL]: 'reply_callback_missing',
  [DetailEnum.REPLY_CALLBACK_NOT_CONFIGURATION]: 'reply_callback_misconfigured',
  [DetailEnum.REPLY_CALLBACK_MISSING_MX_RECORD_CONFIGURATION]: 'reply_mx_record_missing',
  [DetailEnum.REPLY_CALLBACK_MISSING_MX_ROUTE_DOMAIN_CONFIGURATION]: 'reply_mx_domain_missing',

  // Skipped step events
  [DetailEnum.SKIPPED_STEP_BY_CONDITIONS]: 'step_skipped',
  [DetailEnum.SKIPPED_STEP_OUTSIDE_OF_THE_SCHEDULE]: 'step_skipped_outside_of_the_schedule',
  [DetailEnum.STEP_EXTENDED_TO_SCHEDULE]: 'step_extended_to_schedule',
  [DetailEnum.SKIPPED_STEP_MAX_EXTENSIONS_REACHED]: 'step_skipped_max_extensions_reached',
} satisfies Record<DetailEnum, EventType>;

@Injectable()
export class CreateExecutionDetails {
  constructor(
    private executionDetailsRepository: ExecutionDetailsRepository,
    private traceLogRepository: TraceLogRepository,
    private featureFlagsService: FeatureFlagsService
  ) {}

  async execute(command: CreateExecutionDetailsCommand): Promise<void> {
    const isClickhouseOnlyEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_EXECUTION_DETAILS_CLICKHOUSE_ONLY_ENABLED,
      defaultValue: false,
      organization: { _id: command.organizationId },
      environment: { _id: command.environmentId },
    });
    let entity = mapExecutionDetailsCommandToEntity(command);

    entity = this.cleanFromNulls(entity);

    if (!isClickhouseOnlyEnabled) {
      await this.executionDetailsRepository.create(entity, { writeConcern: 1 });
    }

    await this.createTraceLogEntry(command, new Date().toISOString());
  }

  private cleanFromNulls(
    entity: Omit<ExecutionDetailsEntity, 'createdAt' | '_id'>
  ): Omit<ExecutionDetailsEntity, 'createdAt' | '_id'> {
    const cleanEntity = { ...entity };

    if (cleanEntity.raw === null) {
      delete cleanEntity.raw;
    }

    return cleanEntity;
  }

  private async createTraceLogEntry(command: CreateExecutionDetailsCommand, createdAt: string): Promise<void> {
    // Handle dynamic provider selection messages
    const eventType = this.getEventType(command.detail);

    const traceData = {
      created_at: LogRepository.formatDateTime64(new Date(createdAt)),
      organization_id: command.organizationId,
      environment_id: command.environmentId,
      user_id: null,
      subscriber_id: command._subscriberId || null,
      external_subscriber_id: command.subscriberId || null,
      event_type: eventType,
      title: command.detail,
      message: null,
      raw_data: command.raw || null,
      status: this.mapExecutionStatusToTraceStatus(command.status),
      entity_type: 'step_run' as EntityType,
      entity_id: command.jobId,
      step_run_type: command.channel as StepType,
      workflow_run_identifier: command.workflowRunIdentifier,
    };

    await this.traceLogRepository.createStepRun([traceData]);
  }

  private getEventType(detail: string): EventType {
    // Check if it's a provider selection message
    if (detail.includes('provider was selected')) {
      return 'integration_selected';
    }

    // Use the standard mapping for enum values
    return mapDetailToEventType[detail as DetailEnum];
  }

  private mapExecutionStatusToTraceStatus(status: ExecutionDetailsStatusEnum): TraceStatus {
    switch (status) {
      case ExecutionDetailsStatusEnum.SUCCESS:
        return 'success';
      case ExecutionDetailsStatusEnum.FAILED:
        return 'error';
      case ExecutionDetailsStatusEnum.PENDING:
        return 'pending';
      case ExecutionDetailsStatusEnum.WARNING:
        return 'warning';
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateExecutionDetails

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/index.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { CreateExecutionDetailsCommand } from './create-execution-details.command';
export { CreateExecutionDetails } from './create-execution-details.usecase';
export * from './dtos';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/dtos/execution-details-response.dto.ts
Tamaño: 1141 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';
import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum, StepTypeEnum } from '@novu/shared';

export class ExecutionDetailsResponseDto {
  @ApiPropertyOptional()
  _id?: string;

  @ApiProperty()
  _organizationId: string;

  @ApiProperty()
  _jobId: string;

  @ApiProperty()
  _environmentId: string;

  @ApiProperty()
  _notificationId: string;

  @ApiProperty()
  _notificationTemplateId: string;

  @ApiProperty()
  _subscriberId: string;

  @ApiPropertyOptional()
  _messageId?: string;

  @ApiPropertyOptional()
  providerId?: string;

  @ApiProperty()
  transactionId: string;

  @ApiProperty({
    enum: StepTypeEnum,
  })
  channel?: StepTypeEnum;

  @ApiProperty()
  detail: string;

  @ApiProperty({
    enum: ExecutionDetailsSourceEnum,
  })
  source: ExecutionDetailsSourceEnum;

  @ApiProperty({
    enum: ExecutionDetailsStatusEnum,
  })
  status: ExecutionDetailsStatusEnum;

  @ApiProperty({
    type: Boolean,
  })
  isTest: boolean;

  @ApiProperty({
    type: Boolean,
  })
  isRetry: boolean;

  @ApiPropertyOptional()
  createdAt?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExecutionDetailsResponseDto

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/dtos/execution-details.dto.ts
Tamaño: 1044 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiProperty } from '@nestjs/swagger';
import { ExecutionDetailsEntity } from '@novu/dal';

import { CreateExecutionDetailsCommand } from '../create-execution-details.command';

export class CreateExecutionDetailsResponseDto {
  @ApiProperty()
  id: string;

  @ApiProperty()
  createdAt: string;
}

export const mapExecutionDetailsCommandToEntity = (
  command: CreateExecutionDetailsCommand
): Omit<ExecutionDetailsEntity, '_id' | 'createdAt'> => {
  const {
    jobId: _jobId,
    environmentId: _environmentId,
    organizationId: _organizationId,
    subscriberId: _subscriberId,
    notificationId: _notificationId,
    notificationTemplateId: _notificationTemplateId,
    messageId: _messageId,
    workflowRunIdentifier: _workflowRunIdentifier,
    ...nonUnderscoredFields
  } = command;

  return {
    _jobId: _jobId as string,
    _environmentId,
    _organizationId,
    _subscriberId,
    _notificationId,
    _notificationTemplateId: _notificationTemplateId as string,
    _messageId,
    ...nonUnderscoredFields,
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mapExecutionDetailsCommandToEntity(command: CreateExecutionDetailsCommand
): Omit<ExecutionDetailsEntity, '_id' | 'createdAt'>)
Declaraciones 'export' encontradas:
- export class CreateExecutionDetailsResponseDto
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/dtos/index.ts
Tamaño: 91 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './execution-details.dto';
export * from './execution-details-response.dto';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-execution-details/types/index.ts
Tamaño: 4971 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum DetailEnum {
  REPLY_CALLBACK_MISSING_REPLAY_CALLBACK_URL = 'Inbound mail - Missing replay callback URL',
  REPLY_CALLBACK_NOT_CONFIGURATION = 'Inbound mail - Missing configuration',
  REPLY_CALLBACK_MISSING_MX_RECORD_CONFIGURATION = 'Inbound mail - Missing MX Record configuration',
  REPLY_CALLBACK_MISSING_MX_ROUTE_DOMAIN_CONFIGURATION = 'Inbound mail - Missing MX route domain configuration',
  CHAT_WEBHOOK_URL_MISSING = 'Webhook URL for the chat channel is missing',
  CHAT_ALL_CHANNELS_FAILED = 'All chat channels failed to send the message',
  CHAT_SOME_CHANNELS_SKIPPED = 'Some chat channels skipped to send the message',
  CHAT_MISSING_PHONE_NUMBER = 'Subscriber is missing a phone number',
  STEP_CREATED = 'Step created',
  STEP_QUEUED = 'Step queued',
  STEP_DELAYED = 'Step delayed',
  STEP_DIGESTED = 'Step digested',
  MESSAGE_CONTENT_NOT_GENERATED = 'Message content could not be generated',
  MESSAGE_CONTENT_SYNTAX_ERROR = 'Message content could not be generated due to syntax error in email editor',
  MESSAGE_CREATED = 'Message created',
  MESSAGE_SEEN = 'Message seen',
  MESSAGE_READ = 'Message read',
  MESSAGE_CLICKED = 'Message clicked',
  MESSAGE_DELIVERED = 'Message delivered',
  MESSAGE_REJECTED = 'Message rejected',
  MESSAGE_BLOCKED = 'Message blocked',
  MESSAGE_SPAM = 'Message spam',
  MESSAGE_BOUNCED = 'Message bounced',
  MESSAGE_DROPPED = 'Message dropped',
  MESSAGE_DEFERRED = 'Message deferred',
  MESSAGE_UNSUBSCRIBED = 'Message unsubscribed',
  MESSAGE_DELAYED = 'Message delayed',
  MESSAGE_COMPLAINT = 'Message complaint',
  MESSAGE_SNOOZED = 'Message snoozed',
  MESSAGE_UNSNOOZED = 'Message unsnoozed',
  MESSAGE_UNSNOOZE_FAILED = 'Message unsnooze failed',
  FAILED_BRIDGE_EXECUTION = 'Bridge execution failed',
  SKIPPED_BRIDGE_EXECUTION = 'Bridge execution skipped',
  SUBSCRIBER_NO_ACTIVE_INTEGRATION = 'Subscriber does not have an active integration',
  LAYOUT_SELECTED = 'Layout selected',
  LAYOUT_NOT_FOUND = 'Layout not found ',
  INTEGRATION_INSTANCE_SELECTED = 'Integration instance selected',
  TENANT_CONTEXT_SELECTED = 'Tenant context selected',
  TENANT_NOT_FOUND = 'Tenant identifier not found',
  LIMIT_PASSED_NOVU_INTEGRATION = "Novu's provider limit has been reached",
  SUBSCRIBER_NOT_MEMBER_OF_ORGANIZATION = 'Test provider can only be used to send emails to current logged in user',
  SUBSCRIBER_MISSING_EMAIL_ADDRESS = 'Subscriber missing email address',
  SUBSCRIBER_MISSING_PHONE_NUMBER = 'Subscriber missing phone number',
  SUBSCRIBER_NO_ACTIVE_CHANNEL = 'Subscriber does not have a configured channel',
  MESSAGE_SENT = 'Message sent',
  PROVIDER_ERROR = 'Unexpected provider error',
  START_DIGESTING = 'Start digesting',
  STEP_COMPLETED = 'Step completed',
  PROCESSING_STEP_FILTER = 'Processing step filter',
  PROCESSING_STEP_FILTER_ERROR = 'Processing step filter failed',
  SKIPPED_STEP_BY_CONDITIONS = 'Step was skipped based on steps conditions',
  SKIPPED_STEP_OUTSIDE_OF_THE_SCHEDULE = "The step was skipped as it fell outside the subscriber's schedule",
  DIGEST_TRIGGERED_EVENTS = 'Digest triggered events',
  STEP_FILTERED_BY_SUBSCRIBER_WORKFLOW_PREFERENCES = 'Step filtered by subscriber workflow preferences',
  STEP_FILTERED_BY_SUBSCRIBER_GLOBAL_PREFERENCES = 'Step filtered by subscriber global preferences',
  STEP_FILTERED_BY_WORKFLOW_RESOURCE_PREFERENCES = 'Step filtered by workflow preferences',
  STEP_FILTERED_BY_USER_WORKFLOW_PREFERENCES = 'Step filtered by user preferences',
  WEBHOOK_FILTER_FAILED_RETRY = 'Webhook filter failed, retry will be executed',
  WEBHOOK_FILTER_FAILED_LAST_RETRY = 'Failed to get response from remote webhook filter on last retry',
  DIGEST_MERGED = 'Digest was merged with other digest',
  DIGEST_SKIPPED = 'Digest was skipped, first backoff event',
  DELAY_FINISHED = 'Delay is finished',
  PUSH_MISSING_DEVICE_TOKENS = 'Subscriber credentials is missing the tokens for sending a push notification message',
  PUSH_SOME_CHANNELS_SKIPPED = 'Some push channels skipped to send the message',
  VARIANT_CHOSEN = 'Variant was chosen by the provided condition criteria',
  NOTIFICATION_ERROR = 'There was one or more errors when trying to execute the notification',
  DELAY_MISCONFIGURATION = 'Invalid delay configuration',
  DEFER_DURATION_LIMIT_EXCEEDED = 'Defer duration limit exceeded',
  MESSAGE_SEVERITY_OVERRIDDEN = 'Severity for the message was overridden',
  STEP_THROTTLED = 'Step was throttled due to rate limiting',
  THROTTLE_LIMIT_EXCEEDED = 'Throttle limit exceeded for the given window',
  THROTTLE_WINDOW_IN_PAST = 'Throttle window date is in the past',
  STEP_EXTENDED_TO_SCHEDULE = 'Step was extended to the next available time in the subscriber schedule',
  SKIPPED_STEP_MAX_EXTENSIONS_REACHED = 'Step was executed due to maximum number of subscriber schedule extensions reached',
}

export function createProviderSelectedMessage(providerId: string): string {
  return `${providerId} provider was selected`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createProviderSelectedMessage(providerId: string)
Declaraciones 'export' encontradas:
- export  enum
- export function createProviderSelectedMessage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-notification-jobs/create-notification-jobs.command.ts
Tamaño: 1418 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

// TODO: We shouldn't be importing from DAL here. Needs big refactor throughout monorepo.
import { NotificationTemplateEntity, SubscriberEntity, TopicEntity } from '@novu/dal';
import {
  ChannelTypeEnum,
  ISubscribersDefine,
  ITenantDefine,
  ProvidersIdEnum,
  SeverityLevelEnum,
  StatelessControls,
  TriggerOverrides,
  WorkflowPreferences,
} from '@novu/shared';
import { IsArray, IsDefined, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';

export class CreateNotificationJobsCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsString()
  identifier: string;

  @IsDefined()
  overrides: TriggerOverrides;

  @IsDefined()
  payload: any;

  @IsDefined()
  subscriber: SubscriberEntity;

  @IsDefined()
  template: NotificationTemplateEntity;

  @IsDefined()
  templateProviderIds: Record<ChannelTypeEnum, ProvidersIdEnum>;

  @IsDefined()
  to: ISubscribersDefine;

  @IsOptional()
  topics?: Pick<TopicEntity, '_id' | 'key'>[];

  @IsString()
  @IsDefined()
  transactionId: string;

  @IsOptional()
  actor?: SubscriberEntity;

  @IsOptional()
  tenant?: ITenantDefine;

  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  contextKeys?: string[];

  bridgeUrl?: string;

  controls?: StatelessControls;

  preferences?: WorkflowPreferences;

  @IsDefined()
  severity: SeverityLevelEnum;

  @IsDefined()
  critical: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateNotificationJobsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-notification-jobs/create-notification-jobs.usecase.ts
Tamaño: 9834 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import {
  JobEntity,
  JobStatusEnum,
  NotificationEntity,
  NotificationRepository,
  NotificationStepEntity,
} from '@novu/dal';
import {
  DeliveryLifecycleStatusEnum,
  DigestTypeEnum,
  IDigestBaseMetadata,
  IWorkflowStepMetadata,
  STEP_TYPE_TO_CHANNEL_TYPE,
  StepTypeEnum,
} from '@novu/shared';
import { InstrumentUsecase } from '../../instrumentation';
import { WorkflowRunRepository, WorkflowRunStatusEnum } from '../../services/analytic-logs';
import { getNestedValue } from '../../utils';
import { PlatformException } from '../../utils/exceptions';
import { DigestFilterSteps, DigestFilterStepsCommand } from '../digest-filter-steps';
import { CreateNotificationJobsCommand } from './create-notification-jobs.command';

const LOG_CONTEXT = 'CreateNotificationUseCase';
type NotificationJob = Omit<JobEntity, '_id' | 'createdAt' | 'updatedAt'>;

@Injectable()
export class CreateNotificationJobs {
  constructor(
    private digestFilterSteps: DigestFilterSteps,
    private notificationRepository: NotificationRepository,
    private workflowRunRepository: WorkflowRunRepository
  ) {}

  @InstrumentUsecase()
  public async execute(command: CreateNotificationJobsCommand): Promise<NotificationJob[]> {
    const activeSteps = this.filterActiveSteps(command.template.steps);

    const channels = activeSteps
      .map((item) => item.template.type as StepTypeEnum)
      .reduce<StepTypeEnum[]>((list, channel) => {
        if (list.includes(channel) || channel === StepTypeEnum.TRIGGER) {
          return list;
        }
        list.push(channel);

        return list;
      }, []);

    const notification = await this.createNotification(command, channels);

    if (!notification) {
      const message = 'Notification could not be created';
      const error = new PlatformException(message);
      Logger.error(error, message, LOG_CONTEXT);
      throw error;
    }

    const jobs: NotificationJob[] = [];

    const steps = await this.createSteps(command, activeSteps, notification);

    const adhocTriggerJob = this.createATriggerJobIfMissing(steps, command, notification);
    if (adhocTriggerJob) {
      jobs.push(adhocTriggerJob);
    }

    for (const step of steps) {
      if (!step.template) {
        throw new PlatformException('Step template was not found');
      }

      jobs.push(this.buildJobFromStep(step, command, notification));
    }

    return jobs;
  }

  private async createNotification(command: CreateNotificationJobsCommand, channels: StepTypeEnum[]) {
    const notification = await this.notificationRepository.create({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _subscriberId: command.subscriber._id,
      _templateId: command.template._id,
      topics: command.topics?.map((topic) => ({ _topicId: topic._id, topicKey: topic.key })) || [],
      transactionId: command.transactionId,
      to: command.to,
      payload: command.payload,
      channels,
      controls: command.controls,
      tags: command.template.tags,
      severity: command.severity,
      critical: command.critical,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    });

    await this.createWorkflowRun(notification, command);

    return notification;
  }

  private async createWorkflowRun(notification: NotificationEntity, command: CreateNotificationJobsCommand) {
    try {
      await this.workflowRunRepository.create(notification, command.template, {
        status: WorkflowRunStatusEnum.PROCESSING,
        deliveryLifecycleStatus: DeliveryLifecycleStatusEnum.PENDING,
        userId: command.userId,
        externalSubscriberId: command.subscriber.subscriberId,
      });
    } catch (error) {
      console.error(
        { error: error instanceof Error ? error.message : 'Unknown error', notificationId: notification._id },
        'Failed to create workflow run'
      );
      // Don't throw here as we don't want to fail the main notification creation
    }
  }

  private buildJobFromStep(step, command: CreateNotificationJobsCommand, notification): NotificationJob {
    const channel = STEP_TYPE_TO_CHANNEL_TYPE.get(step.template.type);
    const providerId = command.templateProviderIds[channel];

    return {
      identifier: command.identifier,
      payload: command.payload,
      overrides: command.overrides,
      tenant: command.tenant,
      step: this.buildStepForJob(step, command),
      transactionId: command.transactionId,
      _notificationId: notification._id,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _userId: command.userId,
      subscriberId: command.subscriber.subscriberId,
      _subscriberId: command.subscriber._id,
      status: JobStatusEnum.PENDING,
      _templateId: notification._templateId,
      digest: this.buildStepMetadata(step, command),
      type: step.template.type,
      providerId,
      ...this.overloadActorData(command),
      preferences: command.preferences,
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    };
  }

  private buildStepMetadata(
    step: NotificationStepEntity,
    command: CreateNotificationJobsCommand
  ): IWorkflowStepMetadata {
    if (this.isIDigestBaseMetadata(step.metadata)) {
      const digestValue = this.buildDigestValue(step.metadata, command) || 'No-Value-Provided';
      const digestKey = step.metadata.digestKey || 'No-Key-Provided';

      return { ...step.metadata, digestValue, digestKey };
    }

    return step.metadata;
  }
  private isIDigestBaseMetadata(obj: unknown): obj is IDigestBaseMetadata {
    if (typeof obj !== 'object' || obj === null) return false;

    const typedObj = obj as Partial<IDigestBaseMetadata>;

    return (
      (typedObj.digestKey === undefined || typeof typedObj.digestKey === 'string') &&
      (typedObj.digestValue === undefined || typeof typedObj.digestValue === 'string')
    );
  }

  private buildDigestValue(metadata: IDigestBaseMetadata, command: CreateNotificationJobsCommand): string | undefined {
    if (metadata.digestValue) {
      return metadata.digestValue;
    }
    if (metadata.digestKey) {
      return getNestedValue(command.payload, metadata.digestKey);
    }

    return undefined;
  }

  private overloadActorData(command: CreateNotificationJobsCommand) {
    if (command.actor) {
      return {
        _actorId: command.actor?._id,
        actorId: command.actor?.subscriberId,
      };
    }

    return {};
  }

  private buildStepForJob(step, command: CreateNotificationJobsCommand) {
    return {
      ...step,
      ...(command.bridgeUrl ? { bridgeUrl: command.bridgeUrl } : {}),
    };
  }

  private createATriggerJobIfMissing(
    steps: NotificationStepEntity[],
    command: CreateNotificationJobsCommand,
    notification: NotificationEntity
  ): NotificationJob | undefined {
    const triggerStepExist = steps.some((step) => step.template.type === StepTypeEnum.TRIGGER);

    if (triggerStepExist) {
      return undefined;
    }

    return {
      identifier: command.identifier,
      payload: command.payload,
      overrides: command.overrides,
      tenant: command.tenant,
      step: {
        bridgeUrl: command.bridgeUrl,
        template: {
          _environmentId: command.environmentId,
          _organizationId: command.organizationId,
          _creatorId: command.userId,
          _layoutId: null,
          type: StepTypeEnum.TRIGGER,
          content: '',
        },
        _templateId: notification._templateId,
      },
      type: StepTypeEnum.TRIGGER,
      _notificationId: notification._id,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _userId: command.userId,
      _subscriberId: command.subscriber._id,
      _templateId: notification._templateId,
      subscriberId: command.subscriber.subscriberId,
      transactionId: command.transactionId,
      status: JobStatusEnum.PENDING,
      ...(command.actor && {
        _actorId: command.actor?._id,
        actorId: command.actor?.subscriberId,
      }),
      ...(command.contextKeys && { contextKeys: command.contextKeys }),
    };
  }

  private async createSteps(
    command: CreateNotificationJobsCommand,
    activeSteps: NotificationStepEntity[],
    notification: NotificationEntity
  ): Promise<NotificationStepEntity[]> {
    return await this.filterDigestSteps(command, notification, activeSteps);
  }

  private filterActiveSteps(steps: NotificationStepEntity[]): NotificationStepEntity[] {
    return steps.filter((step) => step.active === true);
  }

  private async filterDigestSteps(
    command: CreateNotificationJobsCommand,
    notification: NotificationEntity,
    steps: NotificationStepEntity[]
  ): Promise<NotificationStepEntity[]> {
    // TODO: Review this for workflows with more than one digest as this will return the first element found
    const digestStep = steps.find((step) => step.template?.type === StepTypeEnum.DIGEST);

    if (digestStep?.metadata && 'type' in digestStep.metadata) {
      return await this.digestFilterSteps.execute(
        DigestFilterStepsCommand.create({
          _subscriberId: command.subscriber._id,
          payload: command.payload,
          steps: command.template.steps,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
          templateId: command.template._id,
          notificationId: notification._id,
          transactionId: command.transactionId,
          type: digestStep.metadata.type as DigestTypeEnum, // We already checked it is a DIGEST
          backoff: 'backoff' in digestStep.metadata ? digestStep.metadata.backoff : undefined,
        })
      );
    }

    return steps;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - channels(activeSteps
      .map((item))
 - notification(await this.notificationRepository.create({
      _environmentId: command.environmentId,
      _organ...)
 - triggerStepExist(steps.some((step))
 - digestStep(steps.find((step))
Declaraciones 'export' encontradas:
- export class CreateNotificationJobs

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-notification-jobs/index.ts
Tamaño: 161 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { CreateNotificationJobsCommand } from './create-notification-jobs.command';
export { CreateNotificationJobs } from './create-notification-jobs.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-or-update-subscriber/create-or-update-subscriber.command.ts
Tamaño: 1418 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity } from '@novu/dal';
import { ISubscriberChannel, SubscriberCustomData } from '@novu/shared';
import { Transform } from 'class-transformer';
import { IsBoolean, IsEmail, IsLocale, IsNotEmpty, IsOptional, IsString } from 'class-validator';

import { EnvironmentCommand } from '../../commands';

export class CreateOrUpdateSubscriberCommand extends EnvironmentCommand {
  @IsString()
  @IsNotEmpty()
  @Transform(({ value }) => value?.toString().trim())
  subscriberId: string;

  @IsEmail()
  @IsOptional()
  email?: string;

  @IsString()
  @IsOptional()
  firstName?: string;

  @IsString()
  @IsOptional()
  lastName?: string;

  @IsString()
  @IsOptional()
  phone?: string;

  @IsString()
  @IsOptional()
  avatar?: string;

  @IsLocale()
  @IsOptional()
  locale?: string;

  @IsOptional()
  data?: SubscriberCustomData;

  @IsOptional()
  timezone?: string | null;

  /**
   * Represents existing entity that will be used for updating subscriber instead of creating one
   * @optional
   */
  @IsOptional()
  subscriber?: SubscriberEntity;

  @IsOptional()
  channels?: ISubscriberChannel[];
  /**
   * Represents the name of the active worker that is processing the subscriber for debugging and logging
   */
  @IsOptional()
  activeWorkerName?: string;

  @IsOptional()
  @IsBoolean()
  allowUpdate?: boolean = true;

  @IsOptional()
  @IsBoolean()
  failIfExists?: boolean = false;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateOrUpdateSubscriberCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-or-update-subscriber/create-or-update-subscriber.spec.ts
Tamaño: 2815 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { SubscriberRepository } from '@novu/dal';
import { UserSession } from '@novu/testing';
import { CacheInMemoryProviderService, CacheService, InvalidateCacheService } from '../../services';
import { UpdateSubscriber } from '../update-subscriber';
import { CreateOrUpdateSubscriberCommand } from './create-or-update-subscriber.command';
import { CreateOrUpdateSubscriberUseCase } from './create-or-update-subscriber.usecase';

const cacheInMemoryProviderService = {
  provide: CacheInMemoryProviderService,
  useFactory: async (): Promise<CacheInMemoryProviderService> => {
    return new CacheInMemoryProviderService();
  },
};

const cacheService = {
  provide: CacheService,
  useFactory: async () => {
    const factoryCacheInMemoryProviderService = await cacheInMemoryProviderService.useFactory();

    const service = new CacheService(factoryCacheInMemoryProviderService);
    await service.initialize();

    return service;
  },
};

describe('Create Subscriber', () => {
  let useCase: CreateOrUpdateSubscriberUseCase;
  let session: UserSession;

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [SubscriberRepository, InvalidateCacheService],
      providers: [UpdateSubscriber, cacheInMemoryProviderService, cacheService],
    }).compile();

    session = new UserSession();
    await session.initialize();

    useCase = moduleRef.get<CreateOrUpdateSubscriberUseCase>(CreateOrUpdateSubscriberUseCase);
  });

  it('should create a subscriber', async () => {
    const locale = 'en';
    const result = await useCase.execute(
      CreateOrUpdateSubscriberCommand.create({
        organizationId: session.organization._id,
        environmentId: session.environment._id,
        subscriberId: '1234',
        email: 'dima@asdasdas.com',
        firstName: 'ASDAS',
        locale,
      })
    );

    expect(result.locale).toEqual(locale);
  });

  it('should update the subscriber when same id provided', async () => {
    const subscriberId = '1234';
    const email = 'dima@asdasdas.com';
    const noLocale = 'no';

    await useCase.execute(
      CreateOrUpdateSubscriberCommand.create({
        organizationId: session.organization._id,
        environmentId: session.environment._id,
        subscriberId,
        email,
        firstName: 'First Name',
        locale: 'en',
      })
    );

    const result = await useCase.execute(
      CreateOrUpdateSubscriberCommand.create({
        organizationId: session.organization._id,
        environmentId: session.environment._id,
        subscriberId,
        email,
        firstName: 'Second Name',
        locale: noLocale,
      })
    );

    expect(result.firstName).toEqual('Second Name');
    expect(result.locale).toEqual(noLocale);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - cacheInMemoryProviderService({
  provide: CacheInMemoryProviderService,
  useFactory: async (): Promise<CacheInMemoryProviderServ...)
 - cacheService({
  provide: CacheService,
  useFactory: async ())
 - service(new CacheService(factoryCacheInMemoryProviderService);
    await service.initialize();

    return s...)
 - useCase(moduleRef.get<CreateOrUpdateSubscriberUseCase>(CreateOrUpdateSubscriberUseCase);
  });

  it('should...)
 - result(await useCase.execute(
      CreateOrUpdateSubscriberCommand.create({
        organizationId: sessio...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-or-update-subscriber/create-or-update-subscriber.usecase.ts
Tamaño: 5346 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ConflictException, Injectable } from '@nestjs/common';
import { SubscriberEntity, SubscriberRepository } from '@novu/dal';
import { RetryOnError } from '../../decorators/retry-on-error-decorator';
import { InstrumentUsecase } from '../../instrumentation';
import { AnalyticsService, buildSubscriberKey, InvalidateCacheService } from '../../services';
import { OAuthHandlerEnum, UpdateSubscriberChannel, UpdateSubscriberChannelCommand } from '../subscribers';
import { UpdateSubscriber, UpdateSubscriberCommand } from '../update-subscriber';
import { CreateOrUpdateSubscriberCommand } from './create-or-update-subscriber.command';

@Injectable()
export class CreateOrUpdateSubscriberUseCase {
  constructor(
    private invalidateCache: InvalidateCacheService,
    private subscriberRepository: SubscriberRepository,
    private updateSubscriberUseCase: UpdateSubscriber,
    private updateSubscriberChannel: UpdateSubscriberChannel,
    private analyticsService: AnalyticsService
  ) {}

  @RetryOnError('MongoServerError', {
    maxRetries: 3,
    delay: 500,
  })
  @InstrumentUsecase()
  async execute(command: CreateOrUpdateSubscriberCommand) {
    const persistedSubscriber = await this.getExistingSubscriber(command);
    if (command.failIfExists && persistedSubscriber) {
      throw new ConflictException(`Subscriber with id "${command.subscriberId}" already exists`);
    }

    if (persistedSubscriber) {
      if (command.allowUpdate) {
        await this.updateSubscriber(command, persistedSubscriber);
      }
    } else {
      await this.createSubscriber(command);
    }

    if (command.channels?.length && command.allowUpdate) {
      await this.updateCredentials(command);
    }

    return persistedSubscriber && !command.allowUpdate
      ? persistedSubscriber
      : await this.fetchSubscriber({
          _environmentId: command.environmentId,
          subscriberId: command.subscriberId,
        });
  }

  private async updateSubscriber(command: CreateOrUpdateSubscriberCommand, existingSubscriber: SubscriberEntity) {
    await this.invalidateCache.invalidateByKey({
      key: buildSubscriberKey({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    return await this.updateSubscriberUseCase.execute(
      UpdateSubscriberCommand.create({
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        firstName: command.firstName,
        lastName: command.lastName,
        subscriberId: command.subscriberId,
        email: command.email,
        phone: command.phone,
        avatar: command.avatar,
        locale: command.locale,
        data: command.data,
        subscriber: existingSubscriber,
        channels: command.channels,
        timezone: command.timezone,
      })
    );
  }

  private async getExistingSubscriber(command: CreateOrUpdateSubscriberCommand) {
    const existingSubscriber: SubscriberEntity =
      command.subscriber ??
      (await this.fetchSubscriber({
        _environmentId: command.environmentId,
        subscriberId: command.subscriberId,
      }));

    return existingSubscriber;
  }

  private publishSubscriberCreatedEvent(command: CreateOrUpdateSubscriberCommand) {
    this.analyticsService.mixpanelTrack('Subscriber Created', '', {
      _organization: command.organizationId,
      hasEmail: !!command.email,
      hasPhone: !!command.phone,
      hasAvatar: !!command.avatar,
      hasLocale: !!command.locale,
      hasData: !!command.data,
      hasCredentials: !!command.channels,
    });
  }

  private async updateCredentials(command: CreateOrUpdateSubscriberCommand) {
    for (const channel of command.channels) {
      await this.updateSubscriberChannel.execute(
        UpdateSubscriberChannelCommand.create({
          organizationId: command.organizationId,
          environmentId: command.environmentId,
          subscriberId: command.subscriberId,
          providerId: channel.providerId,
          credentials: channel.credentials,
          integrationIdentifier: channel.integrationIdentifier,
          oauthHandler: OAuthHandlerEnum.EXTERNAL,
          isIdempotentOperation: false,
        })
      );
    }
  }

  private async createSubscriber(command: CreateOrUpdateSubscriberCommand): Promise<SubscriberEntity> {
    await this.invalidateCache.invalidateByKey({
      key: buildSubscriberKey({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    const createdSubscriber = await this.subscriberRepository.create({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      firstName: command.firstName,
      lastName: command.lastName,
      subscriberId: command.subscriberId,
      email: command.email,
      phone: command.phone,
      avatar: command.avatar,
      locale: command.locale,
      data: command.data,
      timezone: command.timezone,
    });
    this.publishSubscriberCreatedEvent(command);

    return createdSubscriber;
  }

  private async fetchSubscriber({
    subscriberId,
    _environmentId,
  }: {
    subscriberId: string;
    _environmentId: string;
  }): Promise<SubscriberEntity | null> {
    return await this.subscriberRepository.findBySubscriberId(_environmentId, subscriberId, false);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateOrUpdateSubscriberUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-or-update-subscriber/index.ts
Tamaño: 110 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './create-or-update-subscriber.command';
export * from './create-or-update-subscriber.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-tenant/create-tenant.command.ts
Tamaño: 390 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CustomDataType } from '@novu/shared';
import { IsNotEmpty, IsOptional, IsString } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../commands';

export class CreateTenantCommand extends EnvironmentWithUserCommand {
  @IsString()
  @IsNotEmpty()
  identifier: string;

  @IsString()
  @IsNotEmpty()
  name: string;

  @IsOptional()
  data?: CustomDataType;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateTenantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-tenant/create-tenant.usecase.ts
Tamaño: 1245 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ConflictException, Injectable } from '@nestjs/common';

import { TenantRepository } from '@novu/dal';
import { AnalyticsService } from '../../services/analytics.service';

import { CreateTenantCommand } from './create-tenant.command';

@Injectable()
export class CreateTenant {
  constructor(
    private tenantRepository: TenantRepository,
    private analyticsService: AnalyticsService
  ) {}

  async execute(command: CreateTenantCommand) {
    const tenantExist = await this.tenantRepository.findOne({
      _environmentId: command.environmentId,
      identifier: command.identifier,
    });

    if (tenantExist) {
      throw new ConflictException(
        `Tenant with identifier: ${command.identifier} already exists under environment ${command.environmentId}`
      );
    }

    const tenant = await this.tenantRepository.create({
      _organizationId: command.organizationId,
      _environmentId: command.environmentId,
      identifier: command.identifier,
      name: command.name,
      data: command.data,
    });

    this.analyticsService.track('Create Tenant - [Tenants]', command.userId, {
      _environmentId: command.environmentId,
      _organization: command.organizationId,
    });

    return tenant;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateTenant

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/create-tenant/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './create-tenant.command';
export * from './create-tenant.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/delete-preferences/delete-preferences.command.ts
Tamaño: 404 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { PreferencesTypeEnum } from '@novu/shared';
import { IsEnum, IsMongoId, IsNotEmpty } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../commands';

export class DeletePreferencesCommand extends EnvironmentWithUserCommand {
  @IsNotEmpty()
  @IsMongoId()
  readonly templateId: string;

  @IsNotEmpty()
  @IsEnum(PreferencesTypeEnum)
  readonly type: PreferencesTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DeletePreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/delete-preferences/delete-preferences.usecase.ts
Tamaño: 1721 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { PreferencesEntity, PreferencesRepository } from '@novu/dal';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { DeletePreferencesCommand } from './delete-preferences.command';

@Injectable()
export class DeletePreferencesUseCase {
  constructor(private preferencesRepository: PreferencesRepository) {}

  @InstrumentUsecase()
  public async execute(command: DeletePreferencesCommand): Promise<void> {
    const existingPreference = await this.getPreference(command);

    if (!existingPreference) {
      /*
       * If the preference does not exist, we don't need to run the delete query
       * and we handle it gracefully.
       *
       * This is necessary because Preferences are a supplementary entity to core
       * entities like Workflows & Subscribers, which may delete their
       * preferences during mutations.
       */
      return;
    }

    await this.deletePreferences(command, existingPreference._id);
  }

  @Instrument()
  private async deletePreferences(command: DeletePreferencesCommand, preferencesId: string) {
    return await this.preferencesRepository.delete({
      _id: preferencesId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _templateId: command.templateId,
      type: command.type,
    });
  }

  @Instrument()
  private async getPreference(command: DeletePreferencesCommand): Promise<PreferencesEntity | undefined> {
    return await this.preferencesRepository.findOne({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _templateId: command.templateId,
      type: command.type,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DeletePreferencesUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/delete-preferences/index.ts
Tamaño: 92 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './delete-preferences.command';
export * from './delete-preferences.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/digest-filter-steps/digest-filter-steps.command.ts
Tamaño: 679 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotificationStepEntity } from '@novu/dal';
import { DigestTypeEnum } from '@novu/shared';
import { IsBoolean, IsDefined, IsMongoId, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands/project.command';

export class DigestFilterStepsCommand extends EnvironmentWithUserCommand {
  @IsMongoId()
  _subscriberId: string;

  @IsDefined()
  payload: any;

  @IsDefined()
  steps: NotificationStepEntity[];

  @IsMongoId()
  templateId: string;

  @IsMongoId()
  notificationId: string;

  @IsString()
  transactionId: string;

  @IsString()
  type: DigestTypeEnum;

  @IsBoolean()
  @IsOptional()
  backoff?: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DigestFilterStepsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/digest-filter-steps/digest-filter-steps.usecase.ts
Tamaño: 978 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';
import { NotificationStepEntity } from '@novu/dal';
import { StepTypeEnum } from '@novu/shared';

import { DigestFilterStepsCommand } from './digest-filter-steps.command';

const LOG_CONTEXT = 'DigestFilterSteps';

// TODO; Potentially rename this use case
@Injectable()
export class DigestFilterSteps {
  public async execute(command: DigestFilterStepsCommand): Promise<NotificationStepEntity[]> {
    const { steps } = command;

    const triggerStep = this.createTriggerStep(command);

    return [triggerStep, ...steps];
  }

  private createTriggerStep(command: DigestFilterStepsCommand): NotificationStepEntity {
    return {
      template: {
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        _creatorId: command.userId,
        _layoutId: null,
        type: StepTypeEnum.TRIGGER,
        content: '',
      },
      _templateId: command.templateId,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DigestFilterSteps

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/digest-filter-steps/index.ts
Tamaño: 141 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { DigestFilterStepsCommand } from './digest-filter-steps.command';
export { DigestFilterSteps } from './digest-filter-steps.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/execute-bridge-request/execute-bridge-request.command.ts
Tamaño: 1518 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  CodeResult,
  DiscoverOutput,
  Event,
  ExecuteOutput,
  GetActionEnum,
  HealthCheck,
  HttpQueryKeysEnum,
  PostActionEnum,
} from '@novu/framework/internal';
import { ResourceOriginEnum } from '@novu/shared';
import { IsDefined, IsOptional } from 'class-validator';
import { EnvironmentLevelCommand } from '../../commands';

export type BridgeError = {
  url: string;
  code: string;
  message: string;
  statusCode: number;
  data?: unknown;
  cause?: unknown;
};

export type ProcessError = (response: BridgeError) => Promise<void>;

export class ExecuteBridgeRequestCommand extends EnvironmentLevelCommand {
  @IsOptional()
  event?: Omit<Event, `${HttpQueryKeysEnum}`>;

  @IsOptional()
  searchParams?: Partial<Record<HttpQueryKeysEnum | 'skipLayoutRendering' | 'jobId' | 'layoutId', string>>;

  @IsOptional()
  processError?: ProcessError;

  @IsDefined()
  action: PostActionEnum | GetActionEnum;

  @IsOptional()
  retriesLimit?: number;

  @IsDefined()
  workflowOrigin: ResourceOriginEnum;

  @IsOptional()
  statelessBridgeUrl?: string;
}

// will generate the output type based on the action
export type ExecuteBridgeRequestDto<T extends PostActionEnum | GetActionEnum> = T extends GetActionEnum.DISCOVER
  ? DiscoverOutput
  : T extends GetActionEnum.HEALTH_CHECK
    ? HealthCheck
    : T extends GetActionEnum.CODE
      ? CodeResult
      : T extends PostActionEnum.EXECUTE
        ? ExecuteOutput
        : T extends PostActionEnum.PREVIEW
          ? ExecuteOutput
          : never;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - ProcessError(response: BridgeError))
Declaraciones 'export' encontradas:
- export  type
- export  type
- export class ExecuteBridgeRequestCommand
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/execute-bridge-request/execute-bridge-request.usecase.ts
Tamaño: 17267 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createHmac } from 'node:crypto';
import { BadRequestException, HttpException, HttpStatus, Injectable, Logger, NotFoundException } from '@nestjs/common';
import { EnvironmentRepository } from '@novu/dal';
import {
  GetActionEnum,
  HttpHeaderKeysEnum,
  HttpQueryKeysEnum,
  isFrameworkError,
  PostActionEnum,
} from '@novu/framework/internal';
import { ResourceOriginEnum } from '@novu/shared';
import got, {
  CacheError,
  HTTPError,
  MaxRedirectsError,
  OptionsOfTextResponseBody,
  ParseError,
  ReadError,
  RequestError,
  TimeoutError,
  UnsupportedProtocolError,
  UploadError,
} from 'got';
import { HttpRequestHeaderKeysEnum } from '../../http';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { PinoLogger } from '../../logging';
import { BRIDGE_EXECUTION_ERROR } from '../../utils';
import { GetDecryptedSecretKey, GetDecryptedSecretKeyCommand } from '../get-decrypted-secret-key';
import { BridgeError, ExecuteBridgeRequestCommand, ExecuteBridgeRequestDto } from './execute-bridge-request.command';

const inTestEnv = process.env.NODE_ENV === 'test';

const RETRY_BASE_INTERVAL_IN_MS = inTestEnv ? 50 : 500;

export const DEFAULT_TIMEOUT = 5_000; // 5 seconds
export const DEFAULT_RETRIES_LIMIT = 3;
export const RETRYABLE_HTTP_CODES: number[] = [
  408, // Request Timeout
  429, // Too Many Requests
  500, // Internal Server Error
  503, // Service Unavailable
  504, // Gateway Timeout
  // https://developers.cloudflare.com/support/troubleshooting/cloudflare-errors/troubleshooting-cloudflare-5xx-errors/
  521, // CloudFlare web server is down
  522, // CloudFlare connection timed out
  524, // CloudFlare a timeout occurred
];
export const RETRYABLE_ERROR_CODES: string[] = [
  'EAI_AGAIN', //    DNS resolution failed, retry
  'ECONNREFUSED', // Connection refused by the server
  'ECONNRESET', //   Connection was forcibly closed by a peer
  'EADDRINUSE', //   Address already in use
  'EPIPE', //        Broken pipe
  'ETIMEDOUT', //    Operation timed out
  'ENOTFOUND', //    DNS lookup failed
  'EHOSTUNREACH', // No route to host
  'ENETUNREACH', //  Network is unreachable
  'BridgeRequestTimeout',
];

const LOG_CONTEXT = 'ExecuteBridgeRequest';

/*
 * The error code returned by the tunneling service.
 * TODO: replace with a constant from the tunneling client.
 */
const TUNNEL_ERROR_CODE = 'TUNNEL_ERROR';

type TunnelResponseError = {
  code: string;
  message: string;
};

/**
 * A wrapper around the BridgeError that is thrown by the ExecuteBridgeRequest usecase.
 */
class BridgeRequestError extends HttpException {
  constructor(private bridgeError: BridgeError) {
    super(
      {
        message: bridgeError.message,
        code: bridgeError.code,
        data: bridgeError.data,
      },
      bridgeError.statusCode,
      {
        cause: bridgeError.cause,
      }
    );
  }
}

@Injectable()
export class ExecuteBridgeRequest {
  constructor(
    private environmentRepository: EnvironmentRepository,
    private getDecryptedSecretKey: GetDecryptedSecretKey,
    private logger: PinoLogger
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute<T extends PostActionEnum | GetActionEnum>(
    command: ExecuteBridgeRequestCommand
  ): Promise<ExecuteBridgeRequestDto<T>> {
    const environment = await this.environmentRepository.findOne({
      _id: command.environmentId,
    });

    if (!environment) {
      throw new NotFoundException(`Environment ${command.environmentId} not found`);
    }

    const bridgeUrl = this.getBridgeUrl(
      environment.bridge?.url || environment.echo?.url,
      command.environmentId,
      command.workflowOrigin,
      command.statelessBridgeUrl,
      command.action
    );

    this.logger.info(
      `Resolved bridge URL: ${bridgeUrl} for environment ${command.environmentId} and origin ${command.workflowOrigin}`
    );

    const retriesLimit = command.retriesLimit || DEFAULT_RETRIES_LIMIT;
    const bridgeActionUrl = new URL(bridgeUrl);
    bridgeActionUrl.searchParams.set(HttpQueryKeysEnum.ACTION, command.action);
    Object.entries(command.searchParams || {}).forEach(([key, value]) => {
      bridgeActionUrl.searchParams.set(key, value);
    });

    const url = bridgeActionUrl.toString();
    const timeOut = bridgeUrl?.includes(process.env.API_INTERNAL_ORIGIN) ? 60_000 : DEFAULT_TIMEOUT;
    const options: OptionsOfTextResponseBody = {
      timeout: timeOut,
      json: command.event,
      retry: {
        limit: retriesLimit,
        methods: ['GET', 'POST'],
        statusCodes: RETRYABLE_HTTP_CODES,
        errorCodes: RETRYABLE_ERROR_CODES,
        calculateDelay: ({ attemptCount, error }) => {
          if (attemptCount > retriesLimit) {
            this.logger.info(`Exceeded retry limit of ${retriesLimit}. Stopping retries.`);

            return 0;
          }

          // Check if the error status code is in our retryable codes
          if (error?.response?.statusCode && RETRYABLE_HTTP_CODES.includes(error.response.statusCode)) {
            const delay = 2 ** attemptCount * RETRY_BASE_INTERVAL_IN_MS;
            this.logger.info(`Retryable status code ${error.response.statusCode} detected. Retrying in ${delay}ms`);

            return delay;
          }

          // Check if the error code is in our retryable error codes
          if (error?.code && RETRYABLE_ERROR_CODES.includes(error.code)) {
            const delay = 2 ** attemptCount * RETRY_BASE_INTERVAL_IN_MS;
            this.logger.info(`Retryable error code ${error.code} detected. Retrying in ${delay}ms`);

            return delay;
          }

          this.logger.info({ err: error }, 'Error is not retryable. Stopping retry attempts.');

          return 0; // Don't retry for other errors
        },
      },
      https: {
        /*
         * Reject self-signed and invalid certificates in Production environments but allow them in Development
         * as it's common for developers to use self-signed certificates in local environments.
         */
        rejectUnauthorized: environment.name.toLowerCase() === 'production',
      },
    };

    const request = [PostActionEnum.EXECUTE, PostActionEnum.PREVIEW].includes(command.action as PostActionEnum)
      ? got.post
      : got.get;

    const headers = await this.buildRequestHeaders(command);

    this.logger.info(`Making bridge request to \`${url}\``);
    try {
      return await request(url, {
        ...options,
        headers,
      }).json();
    } catch (error) {
      await this.handleResponseError(error, bridgeUrl, command.processError);
    }
  }

  @Instrument()
  private async buildRequestHeaders(command: ExecuteBridgeRequestCommand) {
    const novuSignatureHeader = await this.buildRequestSignature(command);

    return {
      [HttpRequestHeaderKeysEnum.BYPASS_TUNNEL_REMINDER]: 'true',
      [HttpRequestHeaderKeysEnum.CONTENT_TYPE]: 'application/json',
      [HttpHeaderKeysEnum.NOVU_SIGNATURE]: novuSignatureHeader,
    };
  }

  @Instrument()
  private async buildRequestSignature(command: ExecuteBridgeRequestCommand) {
    const secretKey = await this.getDecryptedSecretKey.execute(
      GetDecryptedSecretKeyCommand.create({
        environmentId: command.environmentId,
      })
    );

    const timestamp = Date.now();
    const novuSignatureHeader = `t=${timestamp},v1=${this.createHmacBySecretKey(
      secretKey,
      timestamp,
      command.event || {}
    )}`;

    return novuSignatureHeader;
  }

  @Instrument()
  private createHmacBySecretKey(secretKey: string, timestamp: number, payload: unknown) {
    const publicKey = `${timestamp}.${JSON.stringify(payload)}`;

    return createHmac('sha256', secretKey).update(publicKey).digest('hex');
  }

  /**
   * Returns the bridge URL based on the workflow origin and statelessBridgeUrl.
   *
   * - Novu Cloud workflows go to the Novu API Bridge
   * - External workflows go to the Client Bridge
   *
   * @param environmentBridgeUrl - The URL of the bridge app.
   * @param environmentId - The ID of the environment.
   * @param workflowOrigin - The origin of the workflow.
   * @param statelessBridgeUrl - The URL of the stateless bridge app.
   * @returns The correct bridge URL.
   */
  @Instrument()
  private getBridgeUrl(
    environmentBridgeUrl: string,
    environmentId: string,
    workflowOrigin: ResourceOriginEnum,
    statelessBridgeUrl?: string,
    action?: PostActionEnum | GetActionEnum
  ): string {
    if (statelessBridgeUrl) {
      return statelessBridgeUrl;
    }

    switch (workflowOrigin) {
      case ResourceOriginEnum.NOVU_CLOUD: {
        const apiUrl = this.getApiUrl(action);

        return `${apiUrl}/v1/environments/${environmentId}/bridge`;
      }
      case ResourceOriginEnum.EXTERNAL: {
        if (!environmentBridgeUrl) {
          throw new BadRequestException({
            code: BRIDGE_EXECUTION_ERROR.INVALID_BRIDGE_URL.code,
            message: BRIDGE_EXECUTION_ERROR.INVALID_BRIDGE_URL.message(environmentBridgeUrl),
          });
        }

        return environmentBridgeUrl;
      }
      default:
        throw new Error(`Unsupported workflow origin: ${workflowOrigin}`);
    }
  }

  private getApiUrl(action: PostActionEnum | GetActionEnum): string {
    const baseUrl =
      action === PostActionEnum.PREVIEW
        ? `http://localhost:${process.env.PORT}`
        : process.env.API_INTERNAL_ORIGIN || process.env.API_ROOT_URL;

    if (!baseUrl) {
      throw new Error('API URL is not properly configured');
    }

    // Ensure the URL doesn't end with a slash
    const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;

    // Add GLOBAL_CONTEXT_PATH and API_CONTEXT_PATH if they exist
    const contextPath = [
      process.env.GLOBAL_CONTEXT_PATH,
      action === PostActionEnum.PREVIEW ? process.env.API_CONTEXT_PATH : undefined,
    ]
      .filter(Boolean)
      .join('/');

    // Only append context path if it's not empty
    return contextPath ? `${cleanBaseUrl}/${contextPath}` : cleanBaseUrl;
  }

  @Instrument()
  private async handleResponseError(
    error: unknown,
    url: string,
    processError: ExecuteBridgeRequestCommand['processError']
  ) {
    let bridgeErrorData: Pick<BridgeError, 'data' | 'code' | 'statusCode' | 'message' | 'cause'>;
    if (error instanceof RequestError) {
      let body: Record<string, unknown>;
      try {
        body = JSON.parse(error.response.body as string);
      } catch (e) {
        // If the body is not valid JSON, we'll just use an empty object.
        body = {};
      }

      if (error instanceof HTTPError && isFrameworkError(body)) {
        // Handle known Framework errors. Propagate the error code and message.
        bridgeErrorData = {
          data: body.data,
          code: body.code,
          message: body.message,
          statusCode: error.response.statusCode,
        };
      } else if (error instanceof TimeoutError) {
        this.logger.error(`Bridge request timeout for \`${url}\``);
        bridgeErrorData = {
          code: BRIDGE_EXECUTION_ERROR.BRIDGE_REQUEST_TIMEOUT.code,
          message: BRIDGE_EXECUTION_ERROR.BRIDGE_REQUEST_TIMEOUT.message(url),
          statusCode: HttpStatus.REQUEST_TIMEOUT,
        };
      } else if (error instanceof UnsupportedProtocolError) {
        this.logger.error(`Unsupported protocol for \`${url}\``);
        bridgeErrorData = {
          code: BRIDGE_EXECUTION_ERROR.UNSUPPORTED_PROTOCOL.code,
          message: BRIDGE_EXECUTION_ERROR.UNSUPPORTED_PROTOCOL.message(url),
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error instanceof ReadError) {
        this.logger.error(`Response body could not be read for \`${url}\``);
        bridgeErrorData = {
          code: BRIDGE_EXECUTION_ERROR.RESPONSE_READ_ERROR.code,
          message: BRIDGE_EXECUTION_ERROR.RESPONSE_READ_ERROR.message(url),
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error instanceof UploadError) {
        this.logger.error(`Error uploading request body for \`${url}\``);
        bridgeErrorData = {
          code: BRIDGE_EXECUTION_ERROR.REQUEST_UPLOAD_ERROR.code,
          message: BRIDGE_EXECUTION_ERROR.REQUEST_UPLOAD_ERROR.message(url),
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error instanceof CacheError) {
        this.logger.error(`Error caching request for \`${url}\``);
        bridgeErrorData = {
          code: BRIDGE_EXECUTION_ERROR.REQUEST_CACHE_ERROR.code,
          message: BRIDGE_EXECUTION_ERROR.REQUEST_CACHE_ERROR.message(url),
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error instanceof MaxRedirectsError) {
        this.logger.error(`Maximum redirects exceeded for \`${url}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.MAXIMUM_REDIRECTS_EXCEEDED.message(url),
          code: BRIDGE_EXECUTION_ERROR.MAXIMUM_REDIRECTS_EXCEEDED.code,
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error instanceof ParseError) {
        this.logger.error(`Bridge URL response code is 2xx, but parsing body fails. \`${url}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.MAXIMUM_REDIRECTS_EXCEEDED.message(url),
          code: BRIDGE_EXECUTION_ERROR.MAXIMUM_REDIRECTS_EXCEEDED.code,
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (body.code === TUNNEL_ERROR_CODE) {
        // Handle known tunnel errors
        const tunnelBody = body as TunnelResponseError;
        this.logger.error(`Could not establish tunnel connection for \`${url}\`. Error: \`${tunnelBody.message}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.TUNNEL_NOT_FOUND.message(url),
          code: BRIDGE_EXECUTION_ERROR.TUNNEL_NOT_FOUND.code,
          statusCode: HttpStatus.NOT_FOUND,
        };
      } else if (error.code === 'DEPTH_ZERO_SELF_SIGNED_CERT') {
        this.logger.error(
          `Bridge URL is uing a self-signed certificate that is not allowed for production environments. \`${url}\``
        );
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.SELF_SIGNED_CERTIFICATE.message(url),
          code: BRIDGE_EXECUTION_ERROR.SELF_SIGNED_CERTIFICATE.code,
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error.response?.statusCode === 502) {
        /*
         * Tunnel was live, but the Bridge endpoint was down.
         * 502 is thrown by the tunnel service when the Bridge endpoint is not reachable.
         */
        this.logger.error(`Local Bridge endpoint not found for \`${url}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.BRIDGE_ENDPOINT_NOT_FOUND.message(url),
          code: BRIDGE_EXECUTION_ERROR.BRIDGE_ENDPOINT_NOT_FOUND.code,
          statusCode: HttpStatus.NOT_FOUND,
        };
      } else if (error.response?.statusCode === 404 || RETRYABLE_ERROR_CODES.includes(error.code)) {
        this.logger.error(`Bridge endpoint unavailable for \`${url}\``);

        let codeToThrow: string;
        if (RETRYABLE_ERROR_CODES.includes(error.code)) {
          codeToThrow = error.code;
        } else {
          codeToThrow = BRIDGE_EXECUTION_ERROR.BRIDGE_ENDPOINT_UNAVAILABLE.code;
        }
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.BRIDGE_ENDPOINT_UNAVAILABLE.message(url),
          code: codeToThrow,
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error.response?.statusCode === 405) {
        this.logger.error(`Bridge endpoint method not configured for \`${url}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.BRIDGE_METHOD_NOT_CONFIGURED.message(url),
          code: BRIDGE_EXECUTION_ERROR.BRIDGE_METHOD_NOT_CONFIGURED.code,
          statusCode: HttpStatus.BAD_REQUEST,
        };
      } else if (error.response.statusCode === 413) {
        this.logger.error(`Payload too large for \`${url}\``);
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.PAYLOAD_TOO_LARGE.message(url),
          code: BRIDGE_EXECUTION_ERROR.PAYLOAD_TOO_LARGE.code,
          statusCode: HttpStatus.PAYLOAD_TOO_LARGE,
        };
      } else {
        this.logger.error(
          { err: error },
          `Unknown bridge request error calling \`${url}\`: \`${JSON.stringify(body)}\``
        );
        bridgeErrorData = {
          message: BRIDGE_EXECUTION_ERROR.UNKNOWN_BRIDGE_REQUEST_ERROR.message(url),
          code: BRIDGE_EXECUTION_ERROR.UNKNOWN_BRIDGE_REQUEST_ERROR.code,
          statusCode: HttpStatus.INTERNAL_SERVER_ERROR,
        };
      }
    } else {
      this.logger.error({ err: error }, `Unknown bridge non-request error calling \`${url}\``);
      bridgeErrorData = {
        message: BRIDGE_EXECUTION_ERROR.UNKNOWN_BRIDGE_NON_REQUEST_ERROR.message(url),
        code: BRIDGE_EXECUTION_ERROR.UNKNOWN_BRIDGE_NON_REQUEST_ERROR.code,
        statusCode: HttpStatus.INTERNAL_SERVER_ERROR,
      };
    }

    const fullBridgeError: BridgeError = {
      ...bridgeErrorData,
      cause: error,
      url,
    };

    if (processError) {
      await processError(fullBridgeError);
    }

    throw new BridgeRequestError(fullBridgeError);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - bridgeActionUrl(new URL(bridgeUrl);
    bridgeActionUrl.searchParams.set(HttpQueryKeysEnum.ACTION, command.action);
...)
 - OptionsOfTextResponseBody({
      timeout: timeOut,
      json: command.event,
      retry: {
        limit: retriesLimit,
   ...)
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export class ExecuteBridgeRequest

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/execute-bridge-request/index.ts
Tamaño: 183 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export {
  ExecuteBridgeRequestCommand,
  ExecuteBridgeRequestDto,
} from './execute-bridge-request.command';
export { ExecuteBridgeRequest } from './execute-bridge-request.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-integrations/get-decrypted-integrations.command.ts
Tamaño: 959 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, ProvidersIdEnum } from '@novu/shared';
import { IsBoolean, IsEnum, IsOptional } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';

export class GetDecryptedIntegrationsCommand extends EnvironmentWithUserCommand {
  @IsBoolean()
  @IsOptional()
  findOne?: boolean;

  @IsBoolean()
  @IsOptional()
  active?: boolean;

  @IsEnum(ChannelTypeEnum)
  @IsOptional()
  channelType?: ChannelTypeEnum;

  @IsOptional()
  providerId?: ProvidersIdEnum;

  @IsBoolean()
  @IsOptional()
  returnCredentials?: boolean;
}

export class GetEnvironmentDecryptedIntegrationsCommand extends EnvironmentWithUserCommand {
  @IsBoolean()
  @IsOptional()
  findOne?: boolean;

  @IsBoolean()
  @IsOptional()
  active?: boolean;

  @IsEnum(ChannelTypeEnum)
  @IsOptional()
  channelType?: ChannelTypeEnum;

  @IsOptional()
  providerId?: ProvidersIdEnum;

  @IsBoolean()
  @IsOptional()
  returnCredentials?: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetDecryptedIntegrationsCommand
- export class GetEnvironmentDecryptedIntegrationsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-integrations/get-decrypted-integrations.usecase.ts
Tamaño: 1648 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { IntegrationEntity, IntegrationRepository } from '@novu/dal';

import { decryptCredentials } from '../../encryption';
import { GetDecryptedIntegrationsCommand } from './get-decrypted-integrations.command';

@Injectable()
export class GetDecryptedIntegrations {
  constructor(private integrationRepository: IntegrationRepository) {}

  async execute(command: GetDecryptedIntegrationsCommand): Promise<IntegrationEntity[]> {
    const query: Partial<IntegrationEntity> & { _organizationId: string } = {
      _organizationId: command.organizationId,
    };

    if (command.active) {
      query.active = command.active;
    }

    if (command.channelType) {
      query.channel = command.channelType;
    }

    if (command.providerId) {
      query.providerId = command.providerId;
    }

    const foundIntegrations = command.findOne
      ? [await this.integrationRepository.findOne(query)]
      : await this.integrationRepository.find(query);

    return foundIntegrations
      .filter((integration) => integration)
      .map((integration: IntegrationEntity) => {
        if (command.returnCredentials === false) {
          // Don't include credentials
          const { credentials, ...integrationWithoutCredentials } = integration;

          return integrationWithoutCredentials as IntegrationEntity;
        }

        return GetDecryptedIntegrations.getDecryptedCredentials(integration);
      });
  }

  public static getDecryptedCredentials(integration: IntegrationEntity) {
    integration.credentials = decryptCredentials(integration.credentials);

    return integration;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - foundIntegrations(command.findOne
      ? [await this.integrationRepository.findOne(query)]
      : await this.integra...)
Declaraciones 'export' encontradas:
- export class GetDecryptedIntegrations

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-integrations/index.ts
Tamaño: 108 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-decrypted-integrations.command';
export * from './get-decrypted-integrations.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-secret-key/get-decrypted-secret-key.command.ts
Tamaño: 136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentLevelCommand } from '../../commands';

export class GetDecryptedSecretKeyCommand extends EnvironmentLevelCommand {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetDecryptedSecretKeyCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-secret-key/get-decrypted-secret-key.usecase.ts
Tamaño: 778 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import { EnvironmentRepository } from '@novu/dal';
import { decryptApiKey } from '../../encryption';
import { GetDecryptedSecretKeyCommand } from './get-decrypted-secret-key.command';

@Injectable()
export class GetDecryptedSecretKey {
  constructor(private readonly environmentRepository: EnvironmentRepository) {}

  async execute(command: GetDecryptedSecretKeyCommand): Promise<string> {
    const environment = await this.environmentRepository.findOne(
      {
        _id: command.environmentId,
      },
      '_id apiKeys'
    );

    if (!environment) {
      throw new NotFoundException(`Environment ${command.environmentId} not found`);
    }

    return decryptApiKey(environment.apiKeys[0].key);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetDecryptedSecretKey

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-decrypted-secret-key/index.ts
Tamaño: 104 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-decrypted-secret-key.command';
export * from './get-decrypted-secret-key.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-layout/get-layout.command.ts
Tamaño: 490 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { LayoutId, ResourceOriginEnum, ResourceTypeEnum } from '@novu/shared';
import { IsEnum, IsOptional, IsString } from 'class-validator';

import { EnvironmentCommand } from '../../commands/project.command';

export class GetLayoutCommand extends EnvironmentCommand {
  @IsString()
  @IsOptional()
  layoutIdOrInternalId?: LayoutId;

  @IsEnum(ResourceTypeEnum)
  @IsOptional()
  type?: ResourceTypeEnum;

  @IsEnum(ResourceOriginEnum)
  @IsOptional()
  origin?: ResourceOriginEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetLayoutCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-layout/get-layout.use-case.ts
Tamaño: 2677 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import { LayoutEntity, LayoutRepository } from '@novu/dal';
import { ITemplateVariable } from '@novu/shared';

import { GetLayoutCommand } from './get-layout.command';
import { LayoutDto } from './layout.dto';

@Injectable()
export class GetLayoutUseCase {
  constructor(private layoutRepository: LayoutRepository) {}

  async execute(command: GetLayoutCommand): Promise<LayoutDto> {
    let layout: LayoutEntity;
    if (typeof command.layoutIdOrInternalId === 'undefined') {
      layout = await this.layoutRepository.findOne({
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        isDefault: true,
        type: command.type,
        origin: command.origin,
      });
    } else if (LayoutRepository.isInternalId(command.layoutIdOrInternalId)) {
      layout = await this.layoutRepository.findOne({
        _id: command.layoutIdOrInternalId,
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        type: command.type,
        origin: command.origin,
      });
    } else {
      layout = await this.layoutRepository.findOne({
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        identifier: command.layoutIdOrInternalId,
        type: command.type,
        origin: command.origin,
      });
    }

    if (!layout) {
      throw new NotFoundException(
        command.layoutIdOrInternalId
          ? `Layout not found for id ${command.layoutIdOrInternalId} in the environment ${command.environmentId}`
          : `Default layout not found in the environment ${command.environmentId}`
      );
    }

    return this.mapFromEntity(layout);
  }

  private mapFromEntity(layout: LayoutEntity): LayoutDto {
    return {
      ...layout,
      _id: layout._id,
      _organizationId: layout._organizationId,
      _environmentId: layout._environmentId,
      variables: this.mapVariablesFromEntity(layout.variables),
      isDeleted: layout.deleted,
      controls: layout.controls
        ? {
            uiSchema: layout.controls.uiSchema,
            dataSchema: layout.controls.schema,
          }
        : undefined,
      isTranslationEnabled: layout.isTranslationEnabled,
    };
  }

  private mapVariablesFromEntity(variables?: ITemplateVariable[]): ITemplateVariable[] {
    if (!variables || variables.length === 0) {
      return [];
    }

    return variables.map((variable) => {
      const { name, type, defaultValue, required } = variable;

      return {
        name,
        type,
        defaultValue,
        required,
      };
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetLayoutUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-layout/index.ts
Tamaño: 107 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-layout.command';
export * from './get-layout.use-case';
export * from './layout.dto';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-layout/layout.dto.ts
Tamaño: 10124 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiExtraModels, ApiProperty, ApiPropertyOptional, getSchemaPath } from '@nestjs/swagger';
import { ChannelTypeEnum, ITemplateVariable, JsonSchemaFormatEnum, JsonSchemaTypeEnum } from '@novu/dal';
import { ResourceOriginEnum, ResourceTypeEnum, UiSchemaGroupEnum, UiSchemaProperty } from '@novu/shared';
import { Type } from 'class-transformer';
import { IsArray, IsBoolean, IsEnum, IsNumber, IsOptional, IsString, ValidateNested } from 'class-validator';

@ApiExtraModels()
export class JSONSchemaDto {
  @ApiPropertyOptional({
    description: 'JSON Schema type',
    enum: [...Object.values(JsonSchemaTypeEnum)],
    enumName: 'JsonSchemaTypeEnum',
  })
  @IsOptional()
  @IsEnum(JsonSchemaTypeEnum)
  type?: JsonSchemaTypeEnum;

  @ApiPropertyOptional({
    description: 'Format validation for strings',
    enum: [...Object.values(JsonSchemaFormatEnum)],
    enumName: 'JsonSchemaFormatEnum',
    type: 'string',
  })
  @IsOptional()
  @IsEnum(JsonSchemaFormatEnum)
  format?: JsonSchemaFormatEnum;

  @ApiPropertyOptional({
    description: 'Title of the schema',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  title?: string;

  @ApiPropertyOptional({
    description: 'Description of the schema',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  description?: string;

  @ApiPropertyOptional({
    description: 'Default value',
    oneOf: [{ type: 'string' }, { type: 'number' }, { type: 'boolean' }],
    required: false,
  })
  @IsOptional()
  default?: string | number | boolean;

  @ApiPropertyOptional({
    description: 'Const value (exact match required)',
  })
  @IsOptional()
  const?: any;

  @ApiPropertyOptional({
    description: 'Minimum value for numbers',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  minimum?: number;

  @ApiPropertyOptional({
    description: 'Maximum value for numbers',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  maximum?: number;

  @ApiPropertyOptional({
    description: 'Exclusive minimum',
    type: 'boolean',
  })
  @IsOptional()
  @IsBoolean()
  exclusiveMinimum?: boolean;

  @ApiPropertyOptional({
    description: 'Exclusive maximum',
    type: 'boolean',
  })
  @IsOptional()
  @IsBoolean()
  exclusiveMaximum?: boolean;

  @ApiPropertyOptional({
    description: 'Minimum length for strings',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  minLength?: number;

  @ApiPropertyOptional({
    description: 'Maximum length for strings',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  maxLength?: number;

  @ApiPropertyOptional({
    description: 'Regular expression pattern',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  pattern?: string;

  @ApiPropertyOptional({
    description: 'Minimum number of items in array',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  minItems?: number;

  @ApiPropertyOptional({
    description: 'Maximum number of items in array',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  maxItems?: number;

  @ApiPropertyOptional({
    description: 'Items must be unique',
    type: 'boolean',
  })
  @IsOptional()
  @IsBoolean()
  uniqueItems?: boolean;

  @ApiPropertyOptional({
    description: 'Schema for array items',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  items?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Required properties for object',
    type: 'array',
    items: {
      type: 'string',
    },
  })
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  required?: string[];

  @ApiPropertyOptional({
    description: 'Object properties',
    type: 'object',
    additionalProperties: {
      oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
    },
  })
  @IsOptional()
  @ValidateNested({ each: true })
  @Type(() => JSONSchemaDto)
  properties?: Record<string, JSONSchemaDto>;

  @ApiPropertyOptional({
    description: 'Additional properties schema',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }, { type: 'boolean' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  additionalProperties?: JSONSchemaDto | boolean;

  @ApiPropertyOptional({
    description: 'Enumeration of possible values',
    type: 'array',
    items: {
      type: 'string', // or use a more specific type
    },
  })
  @IsOptional()
  @IsArray()
  enum?: string[];

  @ApiPropertyOptional({
    description: 'Combination of schemas (allOf)',
    type: 'array',
    items: {
      oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
    },
  })
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => JSONSchemaDto)
  allOf?: JSONSchemaDto[];

  @ApiPropertyOptional({
    description: 'At least one schema must match (anyOf)',
    type: 'array',
    items: {
      oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
    },
  })
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => JSONSchemaDto)
  anyOf?: JSONSchemaDto[];

  @ApiPropertyOptional({
    description: 'Only one schema must match (oneOf)',
    type: 'array',
    items: {
      oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
    },
  })
  @IsOptional()
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => JSONSchemaDto)
  oneOf?: JSONSchemaDto[];

  @ApiPropertyOptional({
    description: 'Schema must not match (not)',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  not?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Conditional validation schema (if condition)',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  if?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Schema to apply if "if" condition is true',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  then?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Schema to apply if "if" condition is false',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  else?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Content encoding (e.g., base64)',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  contentEncoding?: string;

  @ApiPropertyOptional({
    description: 'Content media type',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  contentMediaType?: string;

  @ApiPropertyOptional({
    description: 'Dependent required properties',
    type: 'object',
    additionalProperties: {
      type: 'array',
      items: {
        type: 'string',
      },
    },
  })
  @IsOptional()
  @ValidateNested()
  dependentRequired?: Record<string, string[]>;

  @ApiPropertyOptional({
    description: 'Dependent schemas',
    type: 'object',
    additionalProperties: {
      oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
    },
  })
  @IsOptional()
  @ValidateNested({ each: true })
  @Type(() => JSONSchemaDto)
  dependentSchemas?: Record<string, JSONSchemaDto>;

  @ApiPropertyOptional({
    description: 'JSON Schema version',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  $schema?: string;

  @ApiPropertyOptional({
    description: 'Unique identifier for the schema',
    type: 'string',
  })
  @IsOptional()
  @IsString()
  $id?: string;

  @ApiPropertyOptional({
    description: 'Content schema for specific types',
    oneOf: [{ $ref: '#/components/schemas/JSONSchemaDto' }],
  })
  @IsOptional()
  @ValidateNested()
  @Type(() => JSONSchemaDto)
  contentSchema?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'Example values',
    type: 'array',
    items: {
      type: 'object', // or use a more specific type
    },
  })
  @IsOptional()
  @IsArray()
  examples?: any[];

  @ApiPropertyOptional({
    description: 'Minimum number of decimal places',
    type: 'number',
  })
  @IsOptional()
  @IsNumber()
  multipleOf?: number;
}

@ApiExtraModels(UiSchemaProperty)
export class UiSchema {
  @ApiPropertyOptional({
    description: 'Group of the UI Schema',
    enum: [...Object.values(UiSchemaGroupEnum)],
    enumName: 'UiSchemaGroupEnum',
  })
  @IsOptional()
  group?: UiSchemaGroupEnum;

  @ApiPropertyOptional({
    description: 'Properties of the UI Schema',
    type: 'object',
    additionalProperties: {
      $ref: getSchemaPath(UiSchemaProperty),
    },
  })
  @IsOptional()
  @ValidateNested()
  properties?: Record<string, UiSchemaProperty>;
}

export class ControlsMetadataDto {
  @ApiPropertyOptional({
    description: 'JSON Schema for data',
    additionalProperties: true,
    type: () => Object,
  })
  @IsOptional()
  @ValidateNested()
  dataSchema?: JSONSchemaDto;

  @ApiPropertyOptional({
    description: 'UI Schema for rendering',
    type: UiSchema,
  })
  @IsOptional()
  @ValidateNested()
  uiSchema?: UiSchema;

  [key: string]: any;
}

export class LayoutDto {
  @ApiPropertyOptional()
  _id?: string;

  @ApiProperty()
  _organizationId: string;

  @ApiProperty()
  _environmentId: string;

  @ApiProperty()
  _creatorId: string;

  @ApiProperty()
  name: string;

  @ApiProperty()
  identifier: string;

  @ApiProperty()
  description?: string;

  @ApiProperty()
  channel: ChannelTypeEnum;

  @ApiProperty()
  content?: string;

  @ApiProperty()
  contentType?: string;

  @ApiPropertyOptional()
  variables?: ITemplateVariable[];

  @ApiProperty()
  isDefault: boolean;

  @ApiProperty()
  isDeleted: boolean;

  @ApiPropertyOptional()
  createdAt?: string;

  @ApiPropertyOptional()
  updatedAt?: string;

  @ApiPropertyOptional()
  _parentId?: string;

  @ApiPropertyOptional()
  type?: ResourceTypeEnum;

  @ApiPropertyOptional()
  origin?: ResourceOriginEnum;

  @ApiProperty({
    description: 'Controls metadata for the layout',
    type: () => ControlsMetadataDto,
    required: true,
  })
  @Type(() => ControlsMetadataDto)
  controls: ControlsMetadataDto;

  @ApiPropertyOptional()
  isTranslationEnabled?: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class JSONSchemaDto
- export class UiSchema
- export class ControlsMetadataDto
- export class LayoutDto

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-layout/get-novu-layout.command.ts
Tamaño: 117 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseCommand } from '../../commands/base.command';

export class GetNovuLayoutCommand extends BaseCommand {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetNovuLayoutCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-layout/get-novu-layout.spec.ts
Tamaño: 788 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { UserSession } from '@novu/testing';

import { GetNovuLayout } from './get-novu-layout.usecase';

describe('Get Novu Layout Usecase', () => {
  let useCase: GetNovuLayout;
  let session: UserSession;

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [],
      providers: [],
    }).compile();

    session = new UserSession();
    await session.initialize();

    useCase = moduleRef.get<GetNovuLayout>(GetNovuLayout);
  });

  it('should retrieve the novu layout', async () => {
    const layout = await useCase.execute({});

    expect(layout).toContain(
      '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">'
    );
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useCase(moduleRef.get<GetNovuLayout>(GetNovuLayout);
  });

  it('should retrieve the novu layout', async ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-layout/get-novu-layout.usecase.ts
Tamaño: 628 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { readFile } from 'fs/promises';
import { GetNovuLayoutCommand } from './get-novu-layout.command';

@Injectable()
export class GetNovuLayout {
  async execute(command: GetNovuLayoutCommand): Promise<string> {
    const template = await this.loadTemplateContent('layout.handlebars');
    if (!template) throw new BadRequestException('Novu default template not found');

    return template;
  }

  private async loadTemplateContent(name: string) {
    const content = await readFile(`${__dirname}/templates/${name}`);

    return content.toString();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetNovuLayout

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-layout/index.ts
Tamaño: 86 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-novu-layout.command';
export * from './get-novu-layout.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-layout/templates/layout.handlebars
Tamaño: 17076 bytes
Lenguaje detectado: HANDLEBARS

### CONTENIDO ORIGINAL ###

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
  data-editor-version="2"
  class="sg-campaigns"
  xmlns="http://www.w3.org/1999/xhtml"
>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
  />
  <!--[if !mso]><!-->
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <!--<![endif]-->
  <!--[if (gte mso 9)|(IE)]>
  <xml>
    <o:OfficeDocumentSettings>
      <o:AllowPNG />
      <o:PixelsPerInch>96</o:PixelsPerInch>
    </o:OfficeDocumentSettings>
  </xml>
  <![endif]-->
  <!--[if (gte mso 9)|(IE)]>
  <style type='text/css'>
    body {
      width: 600px;
      margin: 0 auto;
    }

    table {
      border-collapse: collapse;
    }

    table,
    td {
      mso-table-lspace: 0pt;
      mso-table-rspace: 0pt;
    }

    img {
      -ms-interpolation-mode: bicubic;
    }
  </style>
  <![endif]-->
  <style type="text/css">
    body,
    p,
    div {
      font-family: verdana, geneva, sans-serif;
      font-size: 16px;
    }

    body {
      color: #516775;
    }

    body a {
      color: #993300;
      text-decoration: none;
    }

    p {
      margin: 0;
      padding: 0;
    }

    table.wrapper {
      width: 100% !important;
      table-layout: fixed;
      -webkit-font-smoothing: antialiased;
      -webkit-text-size-adjust: 100%;
      -moz-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
    }

    img.max-width {
      max-width: 100% !important;
    }

    .column.of-2 {
      width: 50%;
    }

    .column.of-3 {
      width: 33.333%;
    }

    .column.of-4 {
      width: 25%;
    }

    @media screen and (max-width: 480px) {

      .preheader .rightColumnContent,
      .footer .rightColumnContent {
        text-align: left !important;
      }

      .preheader .rightColumnContent div,
      .preheader .rightColumnContent span,
      .footer .rightColumnContent div,
      .footer .rightColumnContent span {
        text-align: left !important;
      }

      .preheader .rightColumnContent,
      .preheader .leftColumnContent {
        font-size: 80% !important;
        padding: 5px 0;
      }

      table.wrapper-mobile {
        width: 100% !important;
        table-layout: fixed;
      }

      img.max-width {
        height: auto !important;
        max-width: 100% !important;
      }

      a.bulletproof-button {
        display: block !important;
        width: auto !important;
        font-size: 80%;
        padding-left: 0 !important;
        padding-right: 0 !important;
      }

      .columns {
        width: 100% !important;
      }

      .column {
        display: block !important;
        width: 100% !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
      }

      .social-icon-column {
        display: inline-block !important;
      }
    }
  </style>
  <!--user entered Head Start-->

  <!--End Head user entered-->
</head>
<body bgcolor="#f9f9f9">
{{#if preheader}}
  <div style="display: none; max-height: 0px; overflow: hidden;">
    {{preheader}}
    &nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;
  </div>
{{/if}}
<center
  class="wrapper"
  data-link-color="#993300"
  data-body-style="font-size:16px; font-family:verdana,geneva,sans-serif; color:#516775; background-color:#f9f9f9;"
>
  <div class="webkit">
    <table
      cellpadding="0"
      cellspacing="0"
      border="0"
      width="100%"
      class="wrapper"
      bgcolor="#f9f9f9"
    >
      <tr>
        <td valign="top" bgcolor="#f9f9f9" width="100%">
          <table
            width="100%"
            role="content-container"
            class="outer"
            align="center"
            cellpadding="0"
            cellspacing="0"
            border="0"
          >
            <tr>
              <td width="100%">
                <table
                  width="100%"
                  cellpadding="0"
                  cellspacing="0"
                  border="0"
                >
                  <tr>
                    <td>
                      <!--[if mso]>
                      <center>
                        <table>
                          <tr>
                            <td width='600'>
                      <![endif]-->
                      <table
                        width="100%"
                        cellpadding="0"
                        cellspacing="0"
                        border="0"
                        style="width: 100%; max-width: 600px"
                        align="center"
                      >
                        <tr>
                          <td
                            role="modules-container"
                            style="
                                  padding: 0px 0px 0px 0px;
                                  color: #516775;
                                  text-align: left;
                                "
                            bgcolor="#f9f9f9"
                            width="100%"
                            align="left"
                          >
                            <table
                              class="wrapper"
                              role="module"
                              data-type="image"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="4UqFsRLozLcypAAv4CeoFS"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="
                                          font-size: 6px;
                                          line-height: 10px;
                                          padding: 30px 0px 0px 0px;
                                        "
                                  valign="top"
                                  align="center"
                                >
                                  <img
                                    class="max-width"
                                    border="0"
                                    style="
                                            display: block;
                                            color: #000000;
                                            text-decoration: none;
                                            font-family: Helvetica, arial,
                                              sans-serif;
                                            font-size: 16px;
                                            max-width: 240px !important;
                                            width: 50%;
                                            height: auto !important;
                                          "
                                    src="{{branding.logo}}"
                                    alt=""
                                    width="200"
                                    data-responsive="true"
                                    data-proportionally-constrained="false"
                                  />
                                </td>
                              </tr>
                              </tbody>
                            </table>
                            <table
                              class="module"
                              role="module"
                              data-type="spacer"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="iqe7juSSgLbdm3gXWExpsY"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="padding: 0px 0px 30px 0px"
                                  role="module-content"
                                  bgcolor=""
                                ></td>
                              </tr>
                              </tbody>
                            </table>


                            <table
                              class="module"
                              role="module"
                              data-type="text"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="      background-color: #ffffff; border: 1px solid #efefef; table-layout: fixed; border-top: 4px solid {{#if branding.color}}{{branding.color}}{{else}}#ff6f61{{/if}};  "
                              data-muid="8VquPM2ZMj7RJRhAUE6wmF"
                              data-mc-module-version="2019-10-22"
                            >
                              <tbody>
                              <tr>
                                <td
                                  data-test-id="block-wrapper"
                                  style="

                                          padding: 30px;
                                          line-height: 30px;
                                          text-align: inherit;
                                        "
                                  height="100%"
                                  valign="top"
                                  bgcolor="#ffffff"
                                >
                                  {{{body}}}
                                </td>
                              </tr>
                              </tbody>
                            </table>

                            <table
                              class="module"
                              role="module"
                              data-type="spacer"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="h5Act64miE4yjzNnz1YMGs"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="padding: 0px 0px 30px 0px"
                                  role="module-content"
                                  bgcolor=""
                                ></td>
                              </tr>
                              </tbody>
                            </table>
                            <table
                              class="module"
                              role="module"
                              data-type="divider"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="jw3c3eYnz3qZ2aqby3rNPX"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="padding: 0px 0px 0px 0px"
                                  role="module-content"
                                  height="100%"
                                  valign="top"
                                  bgcolor=""
                                >

                                </td>
                              </tr>
                              </tbody>
                            </table>
                            <table
                              class="module"
                              role="module"
                              data-type="spacer"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="noXVUxSTfKbdSVM2Xrua2t"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="padding: 0px 0px 30px 0px"
                                  role="module-content"
                                  bgcolor=""
                                ></td>
                              </tr>
                              </tbody>
                            </table>
                            <table
                              class="module"
                              role="module"
                              data-type="spacer"
                              border="0"
                              cellpadding="0"
                              cellspacing="0"
                              width="100%"
                              style="table-layout: fixed"
                              data-muid="eAq5DwvRYWV4D7T3oBCXhH"
                            >
                              <tbody>
                              <tr>
                                <td
                                  style="padding: 0px 0px 30px 0px"
                                  role="module-content"
                                  bgcolor=""
                                ></td>
                              </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </table>
                      <!--[if mso]>
                      </td>
                      </tr>
                      </table>
                      </center>
                      <![endif]-->
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
</center>
</body>
</html>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
data-editor-version="2"
class="sg-campaigns"
xmlns="http://www.w3.org/1999/xhtml"
<!--[if !mso]><!-->
<!--<![endif]-->
<!--[if (gte mso 9)|(IE)]>
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-provider-credentials/get-novu-provider-credentials.command.ts
Tamaño: 431 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum } from '@novu/shared';
import { IsEnum, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands/project.command';

export class GetNovuProviderCredentialsCommand extends EnvironmentWithUserCommand {
  @IsEnum(ChannelTypeEnum)
  channelType: ChannelTypeEnum;

  @IsString()
  providerId: string;

  @IsOptional()
  @IsString()
  recipientEmail?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetNovuProviderCredentialsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-provider-credentials/get-novu-provider-credentials.usecase.ts
Tamaño: 4067 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ConflictException, ForbiddenException, Injectable, NotFoundException } from '@nestjs/common';
import { CommunityUserRepository, EnvironmentEntity, OrganizationEntity, UserEntity } from '@novu/dal';
import {
  ChatProviderIdEnum,
  EmailProviderIdEnum,
  FeatureFlagsKeysEnum,
  ICredentials,
  SmsProviderIdEnum,
} from '@novu/shared';
import { FeatureFlagsService } from '../../services';
import { AnalyticsService } from '../../services/analytics.service';
import { CalculateLimitNovuIntegration } from '../calculate-limit-novu-integration';
import { GetNovuProviderCredentialsCommand } from './get-novu-provider-credentials.command';

@Injectable()
export class GetNovuProviderCredentials {
  constructor(
    private analyticsService: AnalyticsService,
    protected calculateLimitNovuIntegration: CalculateLimitNovuIntegration,
    private userRepository: CommunityUserRepository,
    private featureFlagService: FeatureFlagsService
  ) {}

  async execute(integration: GetNovuProviderCredentialsCommand): Promise<ICredentials> {
    if (
      integration.providerId === EmailProviderIdEnum.Novu ||
      integration.providerId === SmsProviderIdEnum.Novu ||
      integration.providerId === ChatProviderIdEnum.Novu
    ) {
      const isTestProviderLimitsEnabled = await this.featureFlagService.getFlag({
        user: { _id: integration.userId } as UserEntity,
        environment: { _id: integration.environmentId } as EnvironmentEntity,
        organization: { _id: integration.organizationId } as OrganizationEntity,
        key: FeatureFlagsKeysEnum.IS_TEST_PROVIDER_LIMITS_ENABLED,
        defaultValue: false,
      });

      if (
        integration.providerId === EmailProviderIdEnum.Novu &&
        integration.recipientEmail &&
        isTestProviderLimitsEnabled
      ) {
        const user = await this.userRepository.findById(integration.userId);

        if (user?.email && user?.email !== integration.recipientEmail) {
          throw new ForbiddenException(
            `Recipient email (${integration.recipientEmail}) does not match the current logged-in user. Novu test provider can only be used to send emails to the current logged-in user. Connect your own email provider to send emails to other addresses.`
          );
        }
      }

      const limit = await this.calculateLimitNovuIntegration.execute({
        channelType: integration.channelType,
        environmentId: integration.environmentId,
        organizationId: integration.organizationId,
      });

      if (!limit) {
        throw new ConflictException(
          `Limit for Novu's ${integration.channelType.toLowerCase()} provider does not exist.`
        );
      }

      if (limit.count >= limit.limit) {
        this.analyticsService.track('[Novu Integration] - Limit reached', integration.userId, {
          channelType: integration.channelType,
          environmentId: integration.environmentId,
          organizationId: integration.organizationId,
          providerId: integration.providerId,
          ...limit,
        });
        throw new ConflictException(`Limit for Novu's ${integration.channelType.toLowerCase()} provider was reached.`);
      }
    }

    if (integration.providerId === EmailProviderIdEnum.Novu) {
      return {
        apiKey: process.env.NOVU_EMAIL_INTEGRATION_API_KEY,
        from: 'no-reply@novu.co',
        senderName: 'Novu',
        ipPoolName: 'Demo',
      };
    }

    if (integration.providerId === SmsProviderIdEnum.Novu) {
      return {
        accountSid: process.env.NOVU_SMS_INTEGRATION_ACCOUNT_SID,
        token: process.env.NOVU_SMS_INTEGRATION_TOKEN,
        from: process.env.NOVU_SMS_INTEGRATION_SENDER,
      };
    }

    if (integration.providerId === ChatProviderIdEnum.Novu) {
      return {
        clientId: process.env.NOVU_SLACK_INTEGRATION_CLIENT_ID,
        secretKey: process.env.NOVU_SLACK_INTEGRATION_CLIENT_SECRET,
      };
    }

    throw new NotFoundException(
      `Credentials for Novu's ${integration.channelType.toLowerCase()} provider could not be found`
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetNovuProviderCredentials

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-novu-provider-credentials/index.ts
Tamaño: 114 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-novu-provider-credentials.command';
export * from './get-novu-provider-credentials.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-preferences/get-preferences.command.ts
Tamaño: 168 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentCommand } from '../../commands';

export class GetPreferencesCommand extends EnvironmentCommand {
  subscriberId?: string;
  templateId?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetPreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-preferences/get-preferences.dto.ts
Tamaño: 599 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  PreferencesTypeEnum,
  Schedule,
  SubscriberGlobalPreference,
  WorkflowPreferences,
  WorkflowPreferencesPartial,
} from '@novu/shared';

export class GetPreferencesResponseDto {
  preferences: WorkflowPreferences;

  schedule?: Schedule;

  type: PreferencesTypeEnum;

  source: {
    [PreferencesTypeEnum.WORKFLOW_RESOURCE]: WorkflowPreferences;
    [PreferencesTypeEnum.USER_WORKFLOW]: WorkflowPreferences | null;
    [PreferencesTypeEnum.SUBSCRIBER_GLOBAL]: SubscriberGlobalPreference | null;
    [PreferencesTypeEnum.SUBSCRIBER_WORKFLOW]: WorkflowPreferencesPartial | null;
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetPreferencesResponseDto

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-preferences/get-preferences.usecase.ts
Tamaño: 6562 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { PreferencesEntity, PreferencesRepository } from '@novu/dal';
import {
  buildWorkflowPreferences,
  FeatureFlagsKeysEnum,
  IPreferenceChannels,
  PreferencesTypeEnum,
  Schedule,
  WorkflowPreferences,
  WorkflowPreferencesPartial,
} from '@novu/shared';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { FeatureFlagsService } from '../../services/feature-flags';
import { MergePreferencesCommand } from '../merge-preferences/merge-preferences.command';
import { MergePreferences } from '../merge-preferences/merge-preferences.usecase';
import { GetPreferencesCommand } from './get-preferences.command';
import { GetPreferencesResponseDto } from './get-preferences.dto';

export type PreferenceSet = {
  workflowResourcePreference?: PreferencesEntity & {
    preferences: WorkflowPreferences;
  };
  workflowUserPreference?: PreferencesEntity & {
    preferences: WorkflowPreferences;
  };
  subscriberGlobalPreference?: PreferencesEntity & {
    preferences: WorkflowPreferencesPartial;
  };
  subscriberWorkflowPreference?: PreferencesEntity & {
    preferences: WorkflowPreferencesPartial;
  };
};

class PreferencesNotFoundException extends BadRequestException {
  constructor(featureFlagCommand: GetPreferencesCommand) {
    super({ message: 'Preferences not found', ...featureFlagCommand });
  }
}

@Injectable()
export class GetPreferences {
  constructor(
    private preferencesRepository: PreferencesRepository,
    private featureFlagsService: FeatureFlagsService
  ) {}

  @InstrumentUsecase()
  async execute(command: GetPreferencesCommand): Promise<GetPreferencesResponseDto> {
    const items = await this.getPreferencesFromDb(command);

    const mergedPreferences = MergePreferences.execute(MergePreferencesCommand.create(items));

    if (!mergedPreferences.preferences) {
      throw new PreferencesNotFoundException(command);
    }

    return mergedPreferences;
  }

  @Instrument()
  public async getSubscriberGlobalPreference(command: {
    environmentId: string;
    organizationId: string;
    subscriberId: string;
  }): Promise<{
    enabled: boolean;
    channels: IPreferenceChannels;
    schedule?: Schedule;
  }> {
    const result = await this.safeExecute(command);

    if (!result) {
      return {
        channels: {
          email: true,
          sms: true,
          in_app: true,
          chat: true,
          push: true,
        },
        enabled: true,
      };
    }

    const isSubscribersScheduleEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_SUBSCRIBERS_SCHEDULE_ENABLED,
      defaultValue: false,
      environment: { _id: command.environmentId },
      organization: { _id: command.organizationId },
    });

    return {
      enabled: true,
      channels: GetPreferences.mapWorkflowPreferencesToChannelPreferences(result.preferences),
      schedule: isSubscribersScheduleEnabled ? result.schedule : undefined,
    };
  }

  public async safeExecute(command: GetPreferencesCommand): Promise<GetPreferencesResponseDto> {
    try {
      return await this.execute(
        GetPreferencesCommand.create({
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          subscriberId: command.subscriberId,
          templateId: command.templateId,
        })
      );
    } catch (e) {
      // If we cant find preferences lets return undefined instead of throwing it up to caller to make it easier for caller to handle.
      if ((e as Error).name === PreferencesNotFoundException.name) {
        return undefined;
      }
      throw e;
    }
  }

  /** Transform WorkflowPreferences into IPreferenceChannels */
  public static mapWorkflowPreferencesToChannelPreferences(
    workflowPreferences: WorkflowPreferencesPartial
  ): IPreferenceChannels {
    const builtPreferences = buildWorkflowPreferences(workflowPreferences);

    const mappedPreferences = Object.entries(builtPreferences.channels ?? {}).reduce((acc, [channel, preference]) => {
      acc[channel as keyof IPreferenceChannels] = preference.enabled;

      return acc;
    }, {} as IPreferenceChannels);

    return mappedPreferences;
  }

  private async getPreferencesFromDb(command: GetPreferencesCommand): Promise<PreferenceSet> {
    const baseQuery = {
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
    };

    const queryOptions = { readPreference: 'secondaryPreferred' as const };

    const queries = [
      this.preferencesRepository.findOne(
        {
          ...baseQuery,
          _templateId: command.templateId,
          type: PreferencesTypeEnum.WORKFLOW_RESOURCE,
        },
        undefined,
        queryOptions
      ),
      this.preferencesRepository.findOne(
        {
          ...baseQuery,
          _templateId: command.templateId,
          type: PreferencesTypeEnum.USER_WORKFLOW,
        },
        undefined,
        queryOptions
      ),
    ];

    if (command.subscriberId) {
      queries.push(
        this.preferencesRepository.findOne(
          {
            ...baseQuery,
            _subscriberId: command.subscriberId,
            _templateId: command.templateId,
            type: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
          },
          undefined,
          queryOptions
        ),
        this.preferencesRepository.findOne(
          {
            ...baseQuery,
            _subscriberId: command.subscriberId,
            type: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
          },
          undefined,
          queryOptions
        )
      );
    }

    const [
      workflowResourcePreference,
      workflowUserPreference,
      subscriberWorkflowPreference,
      subscriberGlobalPreference,
    ] = await Promise.all(queries);

    const result: PreferenceSet = {};

    if (workflowResourcePreference) {
      result.workflowResourcePreference = workflowResourcePreference as PreferenceSet['workflowResourcePreference'];
    }

    if (workflowUserPreference) {
      result.workflowUserPreference = workflowUserPreference as PreferenceSet['workflowUserPreference'];
    }

    if (subscriberWorkflowPreference) {
      result.subscriberWorkflowPreference =
        subscriberWorkflowPreference as PreferenceSet['subscriberWorkflowPreference'];
    }

    if (subscriberGlobalPreference) {
      result.subscriberGlobalPreference = subscriberGlobalPreference as PreferenceSet['subscriberGlobalPreference'];
    }

    return result;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mappedPreferences(Object.entries(builtPreferences.channels ?? {}).reduce((acc, [channel, preference]))
Declaraciones 'export' encontradas:
- export  type
- export class GetPreferences

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-preferences/index.ts
Tamaño: 125 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-preferences.command';
export * from './get-preferences.dto';
export * from './get-preferences.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-schedule/get-subscriber-schedule.command.ts
Tamaño: 254 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsDefined, IsString } from 'class-validator';
import { EnvironmentCommand } from '../../commands';

export class GetSubscriberScheduleCommand extends EnvironmentCommand {
  // database _id
  @IsString()
  @IsDefined()
  _subscriberId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetSubscriberScheduleCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-schedule/get-subscriber-schedule.usecase.ts
Tamaño: 954 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { PreferencesRepository } from '@novu/dal';
import { PreferencesTypeEnum, Schedule } from '@novu/shared';
import { InstrumentUsecase } from '../../instrumentation';
import { GetSubscriberScheduleCommand } from './get-subscriber-schedule.command';

@Injectable()
export class GetSubscriberSchedule {
  constructor(private preferencesRepository: PreferencesRepository) {}

  @InstrumentUsecase()
  async execute(command: GetSubscriberScheduleCommand): Promise<Schedule | undefined> {
    const subscriberGlobalPreference = await this.preferencesRepository.findOne(
      {
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        _subscriberId: command._subscriberId,
        type: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      },
      undefined,
      { readPreference: 'secondaryPreferred' }
    );

    return subscriberGlobalPreference?.schedule;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetSubscriberSchedule

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-schedule/index.ts
Tamaño: 102 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-subscriber-schedule.command';
export * from './get-subscriber-schedule.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-template-preference/get-subscriber-template-preference.command.ts
Tamaño: 582 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotificationTemplateEntity, SubscriberEntity } from '@novu/dal';
import { ITenantDefine } from '@novu/shared';
import { IsBoolean, IsDefined, IsNotEmpty, IsOptional } from 'class-validator';
import { EnvironmentWithSubscriber } from '../../commands';

export class GetSubscriberTemplatePreferenceCommand extends EnvironmentWithSubscriber {
  @IsNotEmpty()
  @IsDefined()
  template: NotificationTemplateEntity;

  @IsOptional()
  subscriber?: SubscriberEntity;

  @IsOptional()
  tenant?: ITenantDefine;

  @IsDefined()
  @IsBoolean()
  includeInactiveChannels: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetSubscriberTemplatePreferenceCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-template-preference/get-subscriber-template-preference.usecase.spec.ts
Tamaño: 4538 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum } from '@novu/shared';
import { filteredPreference, overridePreferences } from './get-subscriber-template-preference.usecase';

describe('overridePreferences', () => {
  beforeEach(() => {});

  it('should be overridden by the subscribers preference', async () => {
    const templateChannelPreference = {
      email: false,
      sms: true,
      in_app: true,
      chat: true,
      push: true,
    };
    const subscriberChannelPreference = {
      email: true,
      sms: true,
      push: false,
    };

    const { channels, overrides } = overridePreferences(
      {
        template: templateChannelPreference,
        subscriber: subscriberChannelPreference,
      },
      {
        email: true,
        sms: true,
        in_app: true,
        chat: true,
        push: true,
      }
    );

    const expectedPreferenceResult = {
      email: true,
      sms: true,
      in_app: true,
      chat: true,
      push: false,
    };

    expect(channels).toEqual(expectedPreferenceResult);
    expect(overrides.find((override) => override.channel === 'email').source).toEqual('subscriber');
    expect(overrides.find((override) => override.channel === 'sms').source).toEqual('subscriber');
    expect(overrides.find((override) => override.channel === 'in_app').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'chat').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'push').source).toEqual('subscriber');
  });

  it('should get preference from template when subscriber preference are empty', async () => {
    const templateChannelPreference = {
      email: false,
      sms: true,
      in_app: false,
      chat: true,
      push: true,
    };
    const subscriberChannelPreference = {};

    const { channels, overrides } = overridePreferences(
      {
        template: templateChannelPreference,
        subscriber: subscriberChannelPreference,
      },
      {
        email: true,
        sms: true,
        in_app: true,
        chat: true,
        push: true,
      }
    );

    const expectedPreferenceResult = {
      email: false,
      sms: true,
      in_app: false,
      chat: true,
      push: true,
    };

    expect(channels).toEqual(expectedPreferenceResult);
    expect(overrides.find((override) => override.channel === 'email').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'sms').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'in_app').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'chat').source).toEqual('template');
    expect(overrides.find((override) => override.channel === 'push').source).toEqual('template');
  });
});

describe('filteredPreference', () => {
  it('should filter active channels in the preference ', async () => {
    const preferences = {
      email: false,
      sms: true,
      in_app: true,
      chat: true,
      push: true,
    };
    const activeChannels = [ChannelTypeEnum.IN_APP, ChannelTypeEnum.PUSH];

    const channelPreferences = filteredPreference(preferences, activeChannels);
    const expectedPreferenceResult = {
      in_app: true,
      push: true,
    };

    expect(Object.keys(channelPreferences).length).toEqual(2);
    expect(channelPreferences).toEqual(expectedPreferenceResult);
  });

  it('should filter all if no active channels ', async () => {
    const preferences = {
      email: false,
      sms: true,
      in_app: true,
      chat: true,
      push: true,
    };
    const activeChannels = [];

    const channelPreferences = filteredPreference(preferences, activeChannels);

    expect(Object.keys(channelPreferences).length).toEqual(0);
  });

  it('should not filter preference if all the channels are active', async () => {
    const preferences = {
      email: false,
      sms: true,
      in_app: true,
      chat: true,
      push: true,
    };
    const activeChannels = [
      ChannelTypeEnum.IN_APP,
      ChannelTypeEnum.PUSH,
      ChannelTypeEnum.SMS,
      ChannelTypeEnum.EMAIL,
      ChannelTypeEnum.CHAT,
    ];

    const channelPreferences = filteredPreference(preferences, activeChannels);

    const expectedPreferenceResult = {
      email: false,
      sms: true,
      in_app: true,
      chat: true,
      push: true,
    };

    expect(Object.keys(channelPreferences).length).toEqual(5);
    expect(channelPreferences).toEqual(expectedPreferenceResult);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - expectedPreferenceResult({
      email: true,
      sms: true,
      in_app: true,
      chat: true,
      push: false,
    }...)
 - expectedPreferenceResult({
      email: false,
      sms: true,
      in_app: false,
      chat: true,
      push: true,
    ...)
 - expectedPreferenceResult({
      in_app: true,
      push: true,
    };

    expect(Object.keys(channelPreferences).length).t...)
 - channelPreferences(filteredPreference(preferences, activeChannels);

    expect(Object.keys(channelPreferences).length)...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-template-preference/get-subscriber-template-preference.usecase.ts
Tamaño: 9277 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import {
  MessageTemplateRepository,
  NotificationTemplateEntity,
  SubscriberEntity,
  SubscriberRepository,
  TenantRepository,
  WorkflowOverrideRepository,
} from '@novu/dal';
import {
  ChannelTypeEnum,
  IOverridePreferencesSources,
  IPreferenceChannels,
  IPreferenceOverride,
  ISubscriberPreferenceResponse,
  ITemplateConfiguration,
  PreferenceOverrideSourceEnum,
  PreferencesTypeEnum,
  SeverityLevelEnum,
  StepTypeEnum,
} from '@novu/shared';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { buildSubscriberKey, CachedResponse } from '../../services';
import { GetPreferences } from '../get-preferences';
import { GetSubscriberTemplatePreferenceCommand } from './get-subscriber-template-preference.command';

const PRIORITY_ORDER = [
  PreferenceOverrideSourceEnum.TEMPLATE,
  PreferenceOverrideSourceEnum.WORKFLOW_OVERRIDE,
  PreferenceOverrideSourceEnum.SUBSCRIBER,
];

@Injectable()
export class GetSubscriberTemplatePreference {
  constructor(
    private messageTemplateRepository: MessageTemplateRepository,
    private subscriberRepository: SubscriberRepository,
    private workflowOverrideRepository: WorkflowOverrideRepository,
    private tenantRepository: TenantRepository,
    private getPreferences: GetPreferences
  ) {}

  @InstrumentUsecase()
  async execute(command: GetSubscriberTemplatePreferenceCommand): Promise<ISubscriberPreferenceResponse> {
    const subscriber = command.subscriber ?? (await this.getSubscriber(command));

    const initialChannels = await this.getChannels(command);

    const workflowOverride = await this.getWorkflowOverride(command);

    const templateChannelPreference = command.template.preferenceSettings;

    const subscriberWorkflowPreference = await this.getSubscriberWorkflowPreference(command, subscriber._id);
    const workflowOverrideChannelPreference = workflowOverride?.preferenceSettings;

    const { channels, overrides } = overridePreferences(
      {
        template: templateChannelPreference,
        subscriber: subscriberWorkflowPreference.channels,
        workflowOverride: workflowOverrideChannelPreference,
      },
      initialChannels
    );

    const template = mapTemplateConfiguration({
      ...command.template,
      critical: subscriberWorkflowPreference.critical,
    });

    return {
      template,
      preference: {
        enabled: subscriberWorkflowPreference.enabled,
        channels,
        overrides,
      },
      type: subscriberWorkflowPreference.type,
    };
  }

  @Instrument()
  private async getSubscriberWorkflowPreference(
    command: GetSubscriberTemplatePreferenceCommand,
    subscriberId: string
  ): Promise<{
    channels: IPreferenceChannels;
    critical?: boolean;
    type: PreferencesTypeEnum;
    enabled: boolean;
  }> {
    const subscriberWorkflowPreference = await this.getPreferences.safeExecute({
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      subscriberId,
      templateId: command.template._id,
    });

    const subscriberWorkflowChannels = GetPreferences.mapWorkflowPreferencesToChannelPreferences(
      subscriberWorkflowPreference.preferences
    );
    const subscriberPreferenceType = subscriberWorkflowPreference.type;
    const critical = subscriberWorkflowPreference.preferences?.all?.readOnly;
    const enabled = true;

    return {
      channels: subscriberWorkflowChannels,
      critical,
      type: subscriberPreferenceType,
      enabled,
    };
  }

  @Instrument()
  private async getWorkflowOverride(command: GetSubscriberTemplatePreferenceCommand) {
    if (!command.tenant?.identifier) {
      return null;
    }

    const tenant = await this.tenantRepository.findOne({
      _environmentId: command.environmentId,
      identifier: command.tenant.identifier,
    });

    if (!tenant) {
      return null;
    }

    return await this.workflowOverrideRepository.findOne({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _workflowId: command.template._id,
      _tenantId: tenant._id,
    });
  }

  @Instrument()
  private async getChannels(command: GetSubscriberTemplatePreferenceCommand): Promise<IPreferenceChannels> {
    let includedChannels: ChannelTypeEnum[];
    if (command.includeInactiveChannels === true) {
      includedChannels = Object.values(ChannelTypeEnum);
    } else {
      includedChannels = await this.queryActiveChannels(command);
    }

    const initialChannels = filteredPreference(
      {
        email: true,
        sms: true,
        in_app: true,
        chat: true,
        push: true,
      },
      includedChannels
    );

    return initialChannels;
  }

  @Instrument()
  private async queryActiveChannels(command: GetSubscriberTemplatePreferenceCommand): Promise<ChannelTypeEnum[]> {
    const activeSteps = command.template.steps.filter((step) => step.active === true);

    const stepMissingTemplate = activeSteps.some((step) => !step.template);

    if (stepMissingTemplate) {
      const messageIds = activeSteps.map((step) => step._templateId);

      const messageTemplates = await this.messageTemplateRepository.find(
        {
          _environmentId: command.environmentId,
          _id: {
            $in: messageIds,
          },
        },
        '_id type'
      );

      return [
        ...new Set(messageTemplates.map((messageTemplate) => messageTemplate.type) as unknown as ChannelTypeEnum[]),
      ];
    }

    const channels = activeSteps
      .map((item) => item.template.type as StepTypeEnum)
      .reduce<StepTypeEnum[]>((list, channel) => {
        if (list.includes(channel)) {
          return list;
        }
        list.push(channel);

        return list;
      }, []);

    return channels as unknown as ChannelTypeEnum[];
  }

  @CachedResponse({
    builder: (command: GetSubscriberTemplatePreferenceCommand) =>
      buildSubscriberKey({
        _environmentId: command.environmentId,
        subscriberId: command.subscriberId,
      }),
  })
  private async getSubscriber(command: GetSubscriberTemplatePreferenceCommand): Promise<SubscriberEntity | null> {
    if (command.subscriber) {
      return command.subscriber;
    }

    const subscriber = await this.subscriberRepository.findBySubscriberId(command.environmentId, command.subscriberId);

    if (!subscriber) {
      throw new BadRequestException(`Subscriber ${command.subscriberId} not found`);
    }

    return subscriber;
  }
}

function updateOverrideReasons(
  channelName,
  sourceName: PreferenceOverrideSourceEnum,
  index: number,
  overrideReasons: IPreferenceOverride[]
) {
  const currentOverride: IPreferenceOverride = {
    channel: channelName as ChannelTypeEnum,
    source: sourceName,
  };

  const notFoundFlag = -1;
  const existsInOverrideReasons = index !== notFoundFlag;
  if (existsInOverrideReasons) {
    overrideReasons[index] = currentOverride;
  } else {
    overrideReasons.push(currentOverride);
  }
}

function overridePreference(
  oldPreferenceState: {
    overrides: IPreferenceOverride[];
    channels: IPreferenceChannels;
  },
  sourcePreference: IPreferenceChannels,
  sourceName: PreferenceOverrideSourceEnum
) {
  const channels = { ...oldPreferenceState.channels };
  const overrides = [...oldPreferenceState.overrides];

  for (const [channelName, channelValue] of Object.entries(sourcePreference)) {
    if (typeof channels[channelName] !== 'boolean') continue;

    const index = overrides.findIndex((overrideReason) => overrideReason.channel === channelName);

    const isSameReason = overrides[index]?.source !== channelValue;

    if (!isSameReason) continue;

    channels[channelName] = channelValue;
    updateOverrideReasons(channelName, sourceName, index, overrides);
  }

  return {
    channels,
    overrides,
  };
}

export function overridePreferences(
  preferenceSources: IOverridePreferencesSources,
  initialActiveChannels: IPreferenceChannels
) {
  let result: {
    overrides: IPreferenceOverride[];
    channels: IPreferenceChannels;
  } = {
    overrides: [],
    channels: { ...initialActiveChannels },
  };

  for (const sourceName of PRIORITY_ORDER) {
    const sourcePreference = preferenceSources[sourceName] as IPreferenceChannels;

    // subscriber may miss preference if he did not toggle his preferences
    if (!sourcePreference) continue;

    result = overridePreference(result, sourcePreference, sourceName);
  }

  return result;
}

export const filteredPreference = (preferences: IPreferenceChannels, filterKeys: string[]): IPreferenceChannels =>
  Object.entries(preferences).reduce(
    (obj, [key, value]) => (filterKeys.includes(key) ? { ...obj, [key]: value } : obj),
    {}
  );

export function mapTemplateConfiguration(template: NotificationTemplateEntity): ITemplateConfiguration {
  return {
    _id: template._id,
    name: template.name,
    tags: template?.tags || [],
    critical: template.critical != null ? template.critical : true,
    triggers: template.triggers,
    ...(template.data ? { data: template.data } : {}),
    updatedAt: template.updatedAt,
    createdAt: template.createdAt,
    severity: template.severity ?? SeverityLevelEnum.NONE,
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - updateOverrideReasons(channelName,
  sourceName: PreferenceOverrideSourceEnum,
  index: number,
  overrideReasons: IPreferenceOverride[])
 - overridePreference(oldPreferenceState: {
    overrides: IPreferenceOverride[];
    channels: IPreferenceChannels;
  },
  sourcePreference: IPreferenceChannels,
  sourceName: PreferenceOverrideSourceEnum)
 - overridePreferences(preferenceSources: IOverridePreferencesSources,
  initialActiveChannels: IPreferenceChannels)
 - mapTemplateConfiguration(template: NotificationTemplateEntity)
Asignaciones con arrow functions encontradas (posibles funciones):
 - activeSteps(command.template.steps.filter((step))
 - stepMissingTemplate(activeSteps.some((step))
 - messageIds(activeSteps.map((step))
 - messageTemplates(await this.messageTemplateRepository.find(
        {
          _environmentId: command.environmentId...)
 - channels(activeSteps
      .map((item))
 - index(overrides.findIndex((overrideReason))
 - filteredPreference(preferences: IPreferenceChannels, filterKeys: string[]): IPreferenceChannels)
Declaraciones 'export' encontradas:
- export class GetSubscriberTemplatePreference
- export function overridePreferences
- export  const
- export function mapTemplateConfiguration

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-subscriber-template-preference/index.ts
Tamaño: 124 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-subscriber-template-preference.command';
export * from './get-subscriber-template-preference.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-tenant/get-tenant.command.ts
Tamaño: 223 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsNotEmpty, IsString } from 'class-validator';
import { EnvironmentCommand } from '../../commands';

export class GetTenantCommand extends EnvironmentCommand {
  @IsString()
  @IsNotEmpty()
  identifier: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetTenantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-tenant/get-tenant.usecase.ts
Tamaño: 672 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import { TenantRepository } from '@novu/dal';
import { GetTenantCommand } from './get-tenant.command';

@Injectable()
export class GetTenant {
  constructor(private tenantRepository: TenantRepository) {}

  async execute(command: GetTenantCommand) {
    const tenant = await this.tenantRepository.findOne({
      _environmentId: command.environmentId,
      identifier: command.identifier,
    });

    if (!tenant) {
      throw new NotFoundException(
        `Tenant with identifier: ${command.identifier} does not exist under environment ${command.environmentId}`
      );
    }

    return tenant;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetTenant

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-tenant/index.ts
Tamaño: 76 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-tenant.command';
export * from './get-tenant.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-topic-subscribers/get-topic-subscribers.command.ts
Tamaño: 272 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TopicKey } from '@novu/shared';
import { IsDefined, IsString } from 'class-validator';
import { EnvironmentCommand } from '../../commands';

export class GetTopicSubscribersCommand extends EnvironmentCommand {
  @IsString()
  @IsDefined()
  topicKey: TopicKey;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetTopicSubscribersCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-topic-subscribers/get-topic-subscribers.use-case.ts
Tamaño: 1676 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import { TopicRepository, TopicSubscribersEntity, TopicSubscribersRepository } from '@novu/dal';

import { ITopicSubscriber } from '@novu/shared';
import { GetTopicSubscribersCommand } from './get-topic-subscribers.command';

@Injectable()
export class GetTopicSubscribersUseCase {
  constructor(
    private topicSubscribersRepository: TopicSubscribersRepository,
    private topicRepository: TopicRepository
  ) {}

  async execute(command: GetTopicSubscribersCommand) {
    const topic = await this.topicRepository.findTopicByKey(
      command.topicKey,
      command.organizationId,
      command.environmentId
    );
    if (!topic) {
      throw new NotFoundException(`Topic with key ${command.topicKey} not found in current environment`);
    }

    const topicSubscribers = await this.topicSubscribersRepository.findSubscribersByTopicId(
      command.environmentId,
      command.organizationId,
      topic._id
    );

    if (!topicSubscribers) {
      throw new NotFoundException(
        `Topic id ${command.topicKey} for the organization ${command.organizationId} in the environment ${command.environmentId} has no entity with subscribers`
      );
    }

    return topicSubscribers.map(this.mapFromEntity);
  }

  private mapFromEntity(topicSubscriber: TopicSubscribersEntity): ITopicSubscriber {
    return {
      ...topicSubscriber,
      topicKey: topicSubscriber.topicKey,
      _topicId: topicSubscriber._topicId,
      _organizationId: topicSubscriber._organizationId,
      _environmentId: topicSubscriber._environmentId,
      _subscriberId: topicSubscriber._subscriberId,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetTopicSubscribersUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/get-topic-subscribers/index.ts
Tamaño: 99 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-topic-subscribers.command';
export * from './get-topic-subscribers.use-case';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/merge-preferences/index.ts
Tamaño: 90 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './merge-preferences.command';
export * from './merge-preferences.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/merge-preferences/merge-preferences.command.ts
Tamaño: 484 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseCommand } from '../../commands';
import { PreferenceSet } from '../get-preferences/get-preferences.usecase';

export class MergePreferencesCommand extends BaseCommand {
  workflowResourcePreference?: PreferenceSet['workflowResourcePreference'];
  workflowUserPreference?: PreferenceSet['workflowUserPreference'];
  subscriberGlobalPreference?: PreferenceSet['subscriberGlobalPreference'];
  subscriberWorkflowPreference?: PreferenceSet['subscriberWorkflowPreference'];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MergePreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/merge-preferences/merge-preferences.spec.ts
Tamaño: 11930 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DEFAULT_WORKFLOW_PREFERENCES, PreferencesTypeEnum, WorkflowPreferences } from '@novu/shared';
import { describe, expect, it } from 'vitest';
import { PreferenceSet } from '../get-preferences/get-preferences.usecase';
import { MergePreferencesCommand } from './merge-preferences.command';
import { MergePreferences } from './merge-preferences.usecase';

/**
 * This test spec is used to test the merge preferences usecase.
 * It covers all the possible combinations of preferences types and readOnly flag.
 */

const MOCK_SUBSCRIBER_GLOBAL_PREFERENCE = {
  ...DEFAULT_WORKFLOW_PREFERENCES,
  channels: {
    ...DEFAULT_WORKFLOW_PREFERENCES.channels,
    email: { enabled: false },
    in_app: { enabled: true },
  },
};

const MOCK_SUBSCRIBER_WORKFLOW_PREFERENCE = {
  ...DEFAULT_WORKFLOW_PREFERENCES,
  channels: {
    ...DEFAULT_WORKFLOW_PREFERENCES.channels,
    email: { enabled: true },
    in_app: { enabled: true },
  },
};

type TestCase = {
  comment: string;
  types: PreferencesTypeEnum[];
  expectedType: PreferencesTypeEnum;
  readOnly: boolean;
};

const testCases: TestCase[] = [
  // readOnly false scenarios
  {
    comment: 'Workflow resource only',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: false,
  },
  {
    comment: 'Subscriber global only',
    types: [PreferencesTypeEnum.SUBSCRIBER_GLOBAL],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    readOnly: false,
  },
  {
    comment: 'Subscriber workflow overrides workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_WORKFLOW],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'Subscriber global overrides workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_GLOBAL],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    readOnly: false,
  },
  {
    comment: 'Subscriber workflow overrides subscriber global',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'User workflow has priority over workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.USER_WORKFLOW],
    expectedType: PreferencesTypeEnum.USER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'User workflow overrides workflow resource',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'Subscriber global overrides user workflow',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    readOnly: false,
  },
  {
    comment: 'Subscriber workflow overrides user workflow',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  // readOnly true scenarios
  {
    comment: 'Workflow resource readOnly flag has priority over subscriber',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: true,
  },
  {
    comment: 'Workflow resource readOnly flag has priority over subscriber workflow',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_WORKFLOW],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: true,
  },
  {
    comment: 'Workflow resource readOnly flag has priority over subscriber global',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_GLOBAL],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: true,
  },
  {
    comment: 'User workflow readOnly flag has priority over workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.USER_WORKFLOW],
    expectedType: PreferencesTypeEnum.USER_WORKFLOW,
    readOnly: true,
  },
  // Subscriber overrides behavior with readOnly false
  {
    comment: 'Subscriber workflow overrides workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_WORKFLOW],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'Subscriber global overrides workflow resource',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_GLOBAL],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    readOnly: false,
  },
  {
    comment: 'Subscriber workflow overrides user workflow',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  {
    comment: 'Subscriber global overrides user workflow',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    readOnly: false,
  },
  {
    comment: 'Subscriber workflow overrides subscriber global',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    readOnly: false,
  },
  // Subscriber overrides with readOnly true behavior
  {
    comment: 'Subscriber workflow cannot override workflow resource when readOnly is true',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_WORKFLOW],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: true,
  },
  {
    comment: 'Subscriber global cannot override workflow resource when readOnly is true',
    types: [PreferencesTypeEnum.WORKFLOW_RESOURCE, PreferencesTypeEnum.SUBSCRIBER_GLOBAL],
    expectedType: PreferencesTypeEnum.WORKFLOW_RESOURCE,
    readOnly: true,
  },
  {
    comment: 'Subscriber workflow cannot override user workflow when readOnly is true',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.USER_WORKFLOW,
    readOnly: true,
  },
  {
    comment: 'Subscriber global cannot override user workflow when readOnly is true',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    ],
    expectedType: PreferencesTypeEnum.USER_WORKFLOW,
    readOnly: true,
  },
  {
    comment: 'Subscriber global+workflow cannot override user workflow when readOnly is true',
    types: [
      PreferencesTypeEnum.WORKFLOW_RESOURCE,
      PreferencesTypeEnum.USER_WORKFLOW,
      PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    ],
    expectedType: PreferencesTypeEnum.USER_WORKFLOW,
    readOnly: true,
  },
];

describe('MergePreferences', () => {
  describe('merging readOnly and subscriberOverrides', () => {
    testCases.forEach(({ types, expectedType, readOnly, comment = '' }) => {
      it(`should merge preferences for types: ${types.join(', ')} with readOnly: ${readOnly}${comment ? ` (${comment})` : ''}`, () => {
        const preferenceSet = types.reduce((acc, type, index) => {
          const preference = {
            _id: `${index + 1}`,
            _organizationId: '1',
            _environmentId: '1',
            type,
            preferences: {
              // default
              ...DEFAULT_WORKFLOW_PREFERENCES,
              // readOnly
              all: { ...DEFAULT_WORKFLOW_PREFERENCES.all, readOnly },
              // subscriber overrides
              ...(PreferencesTypeEnum.SUBSCRIBER_GLOBAL === type ? MOCK_SUBSCRIBER_GLOBAL_PREFERENCE : {}),
              ...(PreferencesTypeEnum.SUBSCRIBER_WORKFLOW === type ? MOCK_SUBSCRIBER_WORKFLOW_PREFERENCE : {}),
            },
          };

          switch (type) {
            case PreferencesTypeEnum.WORKFLOW_RESOURCE:
              acc.workflowResourcePreference = preference;
              break;
            case PreferencesTypeEnum.USER_WORKFLOW:
              acc.workflowUserPreference = preference;
              break;
            case PreferencesTypeEnum.SUBSCRIBER_GLOBAL:
              acc.subscriberGlobalPreference = preference;
              break;
            case PreferencesTypeEnum.SUBSCRIBER_WORKFLOW:
              acc.subscriberWorkflowPreference = preference;
              break;
            default:
              throw new Error(`Unknown preference type: ${type}`);
          }

          return acc;
        }, {} as PreferenceSet);

        const command = MergePreferencesCommand.create(preferenceSet);

        const result = MergePreferences.execute(command);

        const hasSubscriberGlobalPreference = !!preferenceSet.subscriberGlobalPreference;
        const hasSubscriberWorkflowPreference = !!preferenceSet.subscriberWorkflowPreference;

        let expectedPreferences: WorkflowPreferences;

        if (!readOnly) {
          if (hasSubscriberWorkflowPreference) {
            expectedPreferences = MOCK_SUBSCRIBER_WORKFLOW_PREFERENCE;
          } else if (hasSubscriberGlobalPreference) {
            expectedPreferences = MOCK_SUBSCRIBER_GLOBAL_PREFERENCE;
          } else {
            expectedPreferences = DEFAULT_WORKFLOW_PREFERENCES;
          }
        } else {
          expectedPreferences = {
            ...DEFAULT_WORKFLOW_PREFERENCES,
            all: { ...DEFAULT_WORKFLOW_PREFERENCES.all, readOnly },
          };
        }

        expect(result).toEqual({
          preferences: expectedPreferences,
          type: expectedType,
          source: {
            [PreferencesTypeEnum.WORKFLOW_RESOURCE]: null,
            [PreferencesTypeEnum.USER_WORKFLOW]: null,
            [PreferencesTypeEnum.SUBSCRIBER_GLOBAL]: null,
            [PreferencesTypeEnum.SUBSCRIBER_WORKFLOW]: null,
            ...Object.entries(preferenceSet).reduce((acc, [key, pref]) => {
              if (pref) {
                acc[pref.type] = pref.preferences;
              }

              return acc;
            }, {}),
          },
        });
      });
    });
  });

  it('should have test cases for all combinations of PreferencesTypeEnum', () => {
    // Function to generate all subsets of an array, ensuring requiredTypes are included
    function generateSubsets(arr: PreferencesTypeEnum[], required: PreferencesTypeEnum[]) {
      return arr
        .reduce((subsets, value) => subsets.concat(subsets.map((set) => [value, ...set])), [
          [],
        ] as PreferencesTypeEnum[][])
        .map((subset) => [...new Set([...required, ...subset])]);
    }

    const allTypes = Object.values(PreferencesTypeEnum);
    const requiredTypes = [PreferencesTypeEnum.WORKFLOW_RESOURCE];

    const allCombinations = generateSubsets(allTypes, requiredTypes).filter((subset) => subset.length > 0);

    const coveredCombinations = testCases.map((testCase) => testCase.types.sort().join(','));

    allCombinations.forEach((combination) => {
      const combinationKey = combination.sort().join(',');
      expect(coveredCombinations, `Combination ${combinationKey} is not covered`).toContain(combinationKey);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - generateSubsets(arr: PreferencesTypeEnum[], required: PreferencesTypeEnum[])
Asignaciones con arrow functions encontradas (posibles funciones):
 - comment('' }))
 - preferenceSet(types.reduce((acc, type, index))
 - expectedPreferences({
            ...DEFAULT_WORKFLOW_PREFERENCES,
            all: { ...DEFAULT_WORKFLOW_PREFERENCES.al...)
 - allCombinations(generateSubsets(allTypes, requiredTypes).filter((subset))
 - coveredCombinations(testCases.map((testCase))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/merge-preferences/merge-preferences.usecase.ts
Tamaño: 2560 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/** biome-ignore-all lint/complexity/noStaticOnlyClass: needed */

import { PreferencesEntity } from '@novu/dal';
import { DEFAULT_WORKFLOW_PREFERENCES, PreferencesTypeEnum, WorkflowPreferences } from '@novu/shared';
import { toMerged } from 'es-toolkit';
import { GetPreferencesResponseDto } from '../get-preferences';
import { MergePreferencesCommand } from './merge-preferences.command';

/**
 * Merge preferences for a subscriber.
 *
 * The order of precedence is:
 * 1. Workflow resource preferences
 * 2. Workflow user preferences
 * 3. Subscriber global preferences
 * 4. Subscriber workflow preferences
 *
 * If a workflow has the readOnly flag set to true, the subscriber preferences are ignored.
 *
 * If the workflow does not have the readOnly flag set to true, the subscriber preferences are merged with the workflow preferences.
 *
 * If the subscriber has no preferences, the workflow preferences are returned.
 */
export class MergePreferences {
  public static execute(command: MergePreferencesCommand): GetPreferencesResponseDto {
    const workflowPreferences = [command.workflowResourcePreference, command.workflowUserPreference].filter(
      (preference) => preference !== undefined
    );

    const subscriberPreferences = [command.subscriberGlobalPreference, command.subscriberWorkflowPreference].filter(
      (preference) => preference !== undefined
    );

    const isWorkflowPreferenceReadonly = workflowPreferences.some((preference) => preference.preferences.all?.readOnly);

    const preferencesList = [
      ...workflowPreferences,
      // If the workflow preference is readOnly, we disregard the subscriber preferences
      ...(isWorkflowPreferenceReadonly ? [] : subscriberPreferences),
    ];

    const mergedPreferences = preferencesList.reduce(
      (acc, preference) => toMerged(acc, preference),
      {}
    ) as PreferencesEntity & { preferences: WorkflowPreferences };

    // Build the source object
    const source = {
      [PreferencesTypeEnum.WORKFLOW_RESOURCE]: command.workflowResourcePreference?.preferences || null,
      [PreferencesTypeEnum.USER_WORKFLOW]: command.workflowUserPreference?.preferences || null,
      [PreferencesTypeEnum.SUBSCRIBER_GLOBAL]: command.subscriberGlobalPreference?.preferences || null,
      [PreferencesTypeEnum.SUBSCRIBER_WORKFLOW]: command.subscriberWorkflowPreference?.preferences || null,
    };

    return {
      preferences: mergedPreferences.preferences,
      schedule: mergedPreferences.schedule,
      type: mergedPreferences.type,
      source,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - workflowPreferences([command.workflowResourcePreference, command.workflowUserPreference].filter(
      (preference))
 - subscriberPreferences([command.subscriberGlobalPreference, command.subscriberWorkflowPreference].filter(
      (preference...)
 - isWorkflowPreferenceReadonly(workflowPreferences.some((preference))
 - mergedPreferences(preferencesList.reduce(
      (acc, preference))
Declaraciones 'export' encontradas:
- export class MergePreferences

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/index.ts
Tamaño: 451 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './create-message-template/create-message-template.command';
export * from './create-message-template/create-message-template.usecase';

export * from './delete-message-template/delete-message-template.command';
export * from './delete-message-template/delete-message-template.usecase';
export * from './update-message-template/update-message-template.command';
export * from './update-message-template/update-message-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/shared.ts
Tamaño: 360 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageTemplateContentType, StepTypeEnum } from '@novu/shared';

export function shouldSanitize(channelType: StepTypeEnum, contentType?: MessageTemplateContentType) {
  const channelsToSanitize = [StepTypeEnum.EMAIL, StepTypeEnum.IN_APP];

  if (!channelsToSanitize.includes(channelType)) {
    return false;
  }

  return contentType === 'editor';
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - shouldSanitize(channelType: StepTypeEnum, contentType?: MessageTemplateContentType)
Declaraciones 'export' encontradas:
- export function shouldSanitize

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/create-message-template/create-message-template.command.ts
Tamaño: 1696 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClientSession } from '@novu/dal';

import {
  IActor,
  IEmailBlock,
  IMessageCTA,
  ITemplateVariable,
  MessageTemplateContentType,
  ResourceTypeEnum,
  StepTypeEnum,
} from '@novu/shared';
import { Exclude } from 'class-transformer';
import { IsDefined, IsEnum, IsMongoId, IsOptional, IsString, ValidateNested } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../../commands';
import { JSONSchema } from '../../../value-objects';

export class CreateMessageTemplateCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsEnum(StepTypeEnum)
  type: StepTypeEnum;

  @IsOptional()
  name?: string;

  @IsOptional()
  subject?: string;

  @IsOptional()
  title?: string;

  @IsOptional()
  variables?: ITemplateVariable[];

  @IsOptional()
  content?: string | IEmailBlock[];

  @IsOptional()
  contentType?: MessageTemplateContentType;

  @IsOptional()
  @ValidateNested()
  cta?: IMessageCTA;

  @IsOptional()
  @IsString()
  feedId?: string;

  @IsOptional()
  @IsString()
  layoutId?: string | null;

  @IsMongoId()
  parentChangeId?: string;

  @IsOptional()
  @IsString()
  preheader?: string;

  @IsOptional()
  @IsString()
  senderName?: string;

  @IsOptional()
  actor?: IActor;

  @IsOptional()
  _creatorId?: string;

  @IsOptional()
  controls?: {
    schema: JSONSchema;
  };

  @IsOptional()
  output?: {
    schema: JSONSchema;
  };

  @IsOptional()
  code?: string;

  @IsOptional()
  stepId?: string;

  @IsEnum(ResourceTypeEnum)
  @IsDefined()
  workflowType: ResourceTypeEnum;

  /**
   * Exclude session from the command to avoid serializing it in the response
   */
  @Exclude()
  @IsOptional()
  session?: ClientSession | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateMessageTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/create-message-template/create-message-template.spec.ts
Tamaño: 2790 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { ChangeRepository, LayoutRepository, MessageTemplateRepository } from '@novu/dal';
import { EmailBlockTypeEnum, ResourceTypeEnum, StepTypeEnum, TemplateVariableTypeEnum } from '@novu/shared';
import { UserSession } from '@novu/testing';
import { expect } from 'chai';
import { CreateChange } from '../../create-change';
import { UpdateChange } from '../../update-change';
import { CreateMessageTemplateCommand } from './create-message-template.command';
import { CreateMessageTemplate } from './create-message-template.usecase';

describe('Create Message Template', () => {
  let useCase: CreateMessageTemplate;
  let session: UserSession;

  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [],
      providers: [MessageTemplateRepository, LayoutRepository, CreateChange, UpdateChange, ChangeRepository],
    }).compile();

    session = new UserSession();
    await session.initialize();

    useCase = moduleRef.get<CreateMessageTemplate>(CreateMessageTemplate);
  });

  it('should create the message template', async () => {
    const parentChangeId = MessageTemplateRepository.createObjectId();
    const content = [{ type: EmailBlockTypeEnum.TEXT, content: 'test' }];
    const command = CreateMessageTemplateCommand.create({
      userId: session.user._id,
      organizationId: session.organization._id,
      environmentId: session.environment._id,
      type: StepTypeEnum.PUSH,
      name: 'test-message-template',
      title: 'test',
      variables: [
        {
          type: TemplateVariableTypeEnum.STRING,
          name: 'test',
          required: false,
          defaultValue: '',
        },
        {
          type: TemplateVariableTypeEnum.STRING,
          name: 'test',
          required: false,
          defaultValue: 'test',
        },
      ],
      content,
      parentChangeId,
      workflowType: ResourceTypeEnum.REGULAR,
    });

    const result = await useCase.execute(command);

    expect(result).to.ownProperty('_id');
    expect(result).to.ownProperty('createdAt');
    expect(result).to.ownProperty('updatedAt');
    expect(result).to.ownProperty('_layoutId');
    expect(result._organizationId).to.eql(session.organization._id);
    expect(result._environmentId).to.eql(session.environment._id);
    expect(result._creatorId).to.eql(session.user._id);
    expect(result._feedId).to.eql(null);
    expect(result._layoutId).to.eql(null);
    expect(result.type).to.eql(StepTypeEnum.PUSH);
    expect(result.active).to.eql(true);
    expect(result.name).to.eql('test-message-template');
    expect(result.title).to.eql('test');
    expect(result.content).to.eql(content);
    expect(result.variables?.at(0)?.defaultValue).to.eql(undefined);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useCase(moduleRef.get<CreateMessageTemplate>(CreateMessageTemplate);
  });

  it('should create the message ...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/create-message-template/create-message-template.usecase.ts
Tamaño: 3999 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { LayoutRepository, MessageTemplateEntity, MessageTemplateRepository } from '@novu/dal';
import { ChangeEntityTypeEnum, IMessageAction, isBridgeWorkflow, StepTypeEnum } from '@novu/shared';
import { sanitizeMessageContentV0 } from '../../../services';
import { normalizeVariantDefault } from '../../../utils/variants';
import { CreateChange, CreateChangeCommand } from '../../create-change';
import { UpdateChange, UpdateChangeCommand } from '../../update-change';
import { shouldSanitize } from '../shared';
import { CreateMessageTemplateCommand } from './create-message-template.command';

@Injectable()
export class CreateMessageTemplate {
  constructor(
    private messageTemplateRepository: MessageTemplateRepository,
    private layoutRepository: LayoutRepository,
    private createChange: CreateChange,
    private updateChange: UpdateChange
  ) {}

  async execute(command: CreateMessageTemplateCommand): Promise<MessageTemplateEntity> {
    if ((command?.cta?.action as IMessageAction | undefined | '') === '') {
      throw new BadRequestException('Please provide a valid CTA action');
    }

    let layoutId: string | undefined | null;
    if (command.type === StepTypeEnum.EMAIL && !command.layoutId) {
      const defaultLayout = await this.layoutRepository.findDefault(command.environmentId, command.organizationId);
      layoutId = defaultLayout?._id;
    } else {
      layoutId = command.layoutId;
    }

    let item: MessageTemplateEntity = await this.messageTemplateRepository.create(
      {
        cta: command.cta,
        name: command.name,
        variables: command.variables ? normalizeVariantDefault(command.variables) : undefined,
        content: shouldSanitize(command.type, command.contentType)
          ? sanitizeMessageContentV0(command.content)
          : command.content,
        contentType: command.contentType,
        subject: command.subject,
        title: command.title,
        type: command.type,
        _feedId: command.feedId ? command.feedId : null,
        _layoutId: layoutId,
        _organizationId: command.organizationId,
        _environmentId: command.environmentId,
        _creatorId: command.userId,
        preheader: command.preheader,
        senderName: command.senderName,
        controls: command.controls,
        output: command.output,
        actor: command.actor,
        code: command.code,
      },
      command.session ? { session: command.session } : {}
    );

    if (item?._id) {
      item = (await this.messageTemplateRepository.findOne({
        _id: item._id,
        _organizationId: command.organizationId,
      })) as MessageTemplateEntity;
    }

    if (!isBridgeWorkflow(command.workflowType)) {
      await this.createChange.execute(
        CreateChangeCommand.create({
          organizationId: command.organizationId,
          environmentId: command.environmentId,
          userId: command.userId,
          item,
          type: ChangeEntityTypeEnum.MESSAGE_TEMPLATE,
          parentChangeId: command.parentChangeId,
          changeId: MessageTemplateRepository.createObjectId(),
        })
      );
    }

    if (command.feedId) {
      await this.updateChange.execute(
        UpdateChangeCommand.create({
          _entityId: command.feedId,
          type: ChangeEntityTypeEnum.FEED,
          parentChangeId: command.parentChangeId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
        })
      );
    }

    if (command.layoutId) {
      await this.updateChange.execute(
        UpdateChangeCommand.create({
          _entityId: command.layoutId,
          type: ChangeEntityTypeEnum.LAYOUT,
          parentChangeId: command.parentChangeId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
        })
      );
    }

    return item;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CreateMessageTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/create-message-template/index.ts
Tamaño: 102 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './create-message-template.command';
export * from './create-message-template.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/delete-message-template/delete-message-template.command.ts
Tamaño: 467 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ResourceTypeEnum } from '@novu/shared';
import { IsDefined, IsEnum, IsMongoId, IsOptional } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../../commands';

export class DeleteMessageTemplateCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsMongoId()
  messageTemplateId: string;

  @IsOptional()
  @IsMongoId()
  parentChangeId?: string;

  @IsEnum(ResourceTypeEnum)
  @IsDefined()
  workflowType: ResourceTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DeleteMessageTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/delete-message-template/delete-message-template.usecase.ts
Tamaño: 1871 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { ChangeRepository, DalException, MessageTemplateRepository } from '@novu/dal';
import { ChangeEntityTypeEnum, isBridgeWorkflow } from '@novu/shared';
import { CreateChange, CreateChangeCommand } from '../../create-change';
import { DeleteMessageTemplateCommand } from './delete-message-template.command';

@Injectable()
export class DeleteMessageTemplate {
  constructor(
    private messageTemplateRepository: MessageTemplateRepository,
    private createChange: CreateChange,
    private changeRepository: ChangeRepository
  ) {}

  async execute(command: DeleteMessageTemplateCommand): Promise<boolean> {
    try {
      await this.messageTemplateRepository.delete({
        _environmentId: command.environmentId,
        _id: command.messageTemplateId,
      });

      const changeId = await this.changeRepository.getChangeId(
        command.environmentId,
        ChangeEntityTypeEnum.MESSAGE_TEMPLATE,
        command.messageTemplateId
      );

      const deletedMessageTemplate = await this.messageTemplateRepository.findDeleted({
        _environmentId: command.environmentId,
        _id: command.messageTemplateId,
      });

      if (!isBridgeWorkflow(command.workflowType)) {
        await this.createChange.execute(
          CreateChangeCommand.create({
            changeId,
            organizationId: command.organizationId,
            environmentId: command.environmentId,
            userId: command.userId,
            item: deletedMessageTemplate[0],
            type: ChangeEntityTypeEnum.MESSAGE_TEMPLATE,
            parentChangeId: command.parentChangeId,
          })
        );
      }

      return true;
    } catch (error) {
      if (error instanceof DalException) {
        throw new BadRequestException(error.message);
      }
      throw error;
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DeleteMessageTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/update-message-template/update-message-template.command.ts
Tamaño: 1519 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  IActor,
  IEmailBlock,
  IMessageCTA,
  ITemplateVariable,
  MessageTemplateContentType,
  ResourceTypeEnum,
  StepTypeEnum,
} from '@novu/shared';
import { IsDefined, IsEnum, IsMongoId, IsOptional, IsString, ValidateNested } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../../commands';
import { JSONSchema } from '../../../value-objects';

export class UpdateMessageTemplateCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsMongoId()
  templateId: string;

  @IsOptional()
  @IsEnum(StepTypeEnum)
  type: StepTypeEnum;

  @IsOptional()
  @IsString()
  name?: string;

  @IsOptional()
  @IsString()
  subject?: string;

  @IsOptional()
  @IsString()
  title?: string;

  @IsOptional()
  variables?: ITemplateVariable[];

  @IsOptional()
  content?: string | IEmailBlock[];

  @IsOptional()
  contentType?: MessageTemplateContentType;

  @IsOptional()
  @ValidateNested()
  cta?: IMessageCTA;

  @IsOptional()
  feedId?: string | null;

  @IsOptional()
  layoutId?: string | null;

  @IsMongoId()
  @IsOptional()
  parentChangeId?: string;

  @IsOptional()
  @IsString()
  preheader?: string;

  @IsOptional()
  @IsString()
  senderName?: string;

  @IsOptional()
  actor?: IActor;

  @IsOptional()
  inputs?: {
    schema: JSONSchema;
  };
  @IsOptional()
  controls?: {
    schema: JSONSchema;
  };

  @IsOptional()
  output?: { schema: JSONSchema };

  @IsOptional()
  code?: string;

  @IsEnum(ResourceTypeEnum)
  @IsDefined()
  workflowType: ResourceTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateMessageTemplateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/message-template/update-message-template/update-message-template.usecase.ts
Tamaño: 5656 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, NotFoundException } from '@nestjs/common';

import { ChangeRepository, MessageRepository, MessageTemplateEntity, MessageTemplateRepository } from '@novu/dal';
import { ChangeEntityTypeEnum, isBridgeWorkflow } from '@novu/shared';
import { sanitizeMessageContentV0 } from '../../../services';
import { normalizeVariantDefault } from '../../../utils';
import { CreateChange, CreateChangeCommand } from '../../create-change';
import { UpdateChange, UpdateChangeCommand } from '../../update-change';
import { shouldSanitize } from '../shared';
import { UpdateMessageTemplateCommand } from './update-message-template.command';

@Injectable()
export class UpdateMessageTemplate {
  constructor(
    private messageTemplateRepository: MessageTemplateRepository,
    private messageRepository: MessageRepository,
    private changeRepository: ChangeRepository,
    private createChange: CreateChange,
    private updateChange: UpdateChange
  ) {}

  async execute(command: UpdateMessageTemplateCommand): Promise<MessageTemplateEntity> {
    const existingTemplate = await this.messageTemplateRepository.findOne({
      _id: command.templateId,
      _environmentId: command.environmentId,
    });
    if (!existingTemplate) {
      throw new NotFoundException(`Message template with id ${command.templateId} not found`);
    }

    const updatePayload: Partial<MessageTemplateEntity> = {};

    const unsetPayload: Partial<Record<keyof MessageTemplateEntity, string>> = {};

    if (command.name) {
      updatePayload.name = command.name;
    }

    if (command.content !== null || command.content !== undefined) {
      updatePayload.content = shouldSanitize(existingTemplate.type, command.contentType)
        ? sanitizeMessageContentV0(command.content)
        : command.content;
    }

    if (command.variables) {
      updatePayload.variables = normalizeVariantDefault(command.variables);
    }

    if (command.contentType) {
      updatePayload.contentType = command.contentType;
    }

    if (command.cta) {
      updatePayload.cta = {
        ...(existingTemplate.cta && { cta: existingTemplate.cta }),
        ...command.cta,
      };
    } else if (existingTemplate.cta) {
      unsetPayload.cta = '';
    }

    if (command.feedId) {
      updatePayload._feedId = command.feedId;
    }

    if (!command.feedId && existingTemplate._feedId) {
      unsetPayload._feedId = '';
    }

    if (command.layoutId) {
      updatePayload._layoutId = command.layoutId;
    }

    if (command.subject) {
      updatePayload.subject = command.subject;
    }

    if (command.title) {
      updatePayload.title = command.title;
    }

    if (command.preheader !== undefined || command.preheader !== null) {
      updatePayload.preheader = command.preheader;
    }

    if (command.senderName !== undefined || command.senderName !== null) {
      updatePayload.senderName = command.senderName;
    }

    if (command.actor) {
      updatePayload.actor = command.actor;
    }

    if (command.controls) {
      updatePayload.controls = command.controls;
    }

    if (command.output) {
      updatePayload.output = command.output;
    }

    if (command.code) {
      updatePayload.code = command.code;
    }

    if (!Object.keys(updatePayload).length) {
      throw new BadRequestException('No properties found for update');
    }

    await this.messageTemplateRepository.update(
      {
        _id: command.templateId,
        _organizationId: command.organizationId,
        _environmentId: command.environmentId,
      },
      {
        $set: updatePayload,
        $unset: unsetPayload,
      }
    );

    const item = await this.messageTemplateRepository.findOne({
      _id: command.templateId,
      _organizationId: command.organizationId,
    });
    if (!item) throw new NotFoundException(`Message template with id ${command.templateId} is not found`);

    if (command.feedId || (!command.feedId && existingTemplate._feedId)) {
      await this.messageRepository.updateFeedByMessageTemplateId(
        command.environmentId,
        command.templateId,
        command.feedId
      );
    }

    if (item._id) {
      const changeId = await this.changeRepository.getChangeId(
        command.environmentId,
        ChangeEntityTypeEnum.MESSAGE_TEMPLATE,
        item._id
      );
      if (!isBridgeWorkflow(command.workflowType)) {
        await this.createChange.execute(
          CreateChangeCommand.create({
            organizationId: command.organizationId,
            environmentId: command.environmentId,
            userId: command.userId,
            item,
            type: ChangeEntityTypeEnum.MESSAGE_TEMPLATE,
            parentChangeId: command.parentChangeId,
            changeId,
          })
        );
      }
    }

    if (command.feedId && command.parentChangeId) {
      await this.updateChange.execute(
        UpdateChangeCommand.create({
          _entityId: command.feedId,
          type: ChangeEntityTypeEnum.FEED,
          parentChangeId: command.parentChangeId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
        })
      );
    }

    if (command.layoutId && command.parentChangeId) {
      await this.updateChange.execute(
        UpdateChangeCommand.create({
          _entityId: command.layoutId,
          type: ChangeEntityTypeEnum.LAYOUT,
          parentChangeId: command.parentChangeId,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
        })
      );
    }

    return item;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateMessageTemplate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/normalize-variables/index.ts
Tamaño: 94 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './normalize-variables.command';
export * from './normalize-variables.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/normalize-variables/normalize-variables.command.ts
Tamaño: 436 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobEntity, NotificationStepEntity, StepFilter } from '@novu/dal';
import { IsDefined } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';
import { IFilterVariables } from '../../utils';

export class NormalizeVariablesCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  filters: StepFilter[];

  job?: JobEntity;

  step?: NotificationStepEntity;

  variables?: IFilterVariables;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NormalizeVariablesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/normalize-variables/normalize-variables.usecase.ts
Tamaño: 4021 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { SubscriberEntity, SubscriberRepository, TenantEntity, TenantRepository } from '@novu/dal';
import { FilterPartTypeEnum, IMessageFilter } from '@novu/shared';
import { buildSubscriberKey, CachedResponse } from '../../services';
import { IFilterVariables } from '../../utils';
import { ConditionsFilterCommand } from '../conditions-filter';

/**
 * This service class is responsible for normalizing the variables used within the message filtering process.
 * Normalization in this context refers to ensuring all necessary data is present for filter evaluation.
 *
 * It achieves this by:
 *  1. Checking if subscriber and tenant information are provided in the command itself.
 *  2. If missing, it tries to infer them from the filters and job data (if available).
 *  3. Finally, it fetches the complete subscriber and tenant entities from the database if necessary.
 *
 * By providing a normalized set of variables, this service simplifies filter evaluation and promotes code clarity.
 */
@Injectable()
export class NormalizeVariables {
  constructor(
    private subscriberRepository: SubscriberRepository,
    private tenantRepository: TenantRepository
  ) {}

  public async execute(command: ConditionsFilterCommand) {
    const filterVariables: IFilterVariables = {};

    const combinedFilters = [command.step, ...(command.step?.variants || [])].flatMap((variant) =>
      variant?.filters ? variant?.filters : []
    );

    filterVariables.subscriber = await this.fetchSubscriberIfMissing(command, combinedFilters);
    filterVariables.tenant = await this.fetchTenantIfMissing(command, combinedFilters);
    filterVariables.payload = command.variables?.payload
      ? command.variables?.payload
      : (command.job?.payload ?? undefined);

    filterVariables.step = command.variables?.step ?? undefined;
    filterVariables.actor = command.variables?.actor ?? undefined;
    filterVariables.context = command.variables?.context ?? undefined;

    return filterVariables;
  }
  private async fetchSubscriberIfMissing(
    command: ConditionsFilterCommand,
    filters: IMessageFilter[]
  ): Promise<SubscriberEntity | undefined> {
    if (command.variables?.subscriber) {
      return command.variables.subscriber;
    }

    const subscriberFilterExist = filters?.find((filter) => {
      return filter?.children?.find((item) => item?.on === FilterPartTypeEnum.SUBSCRIBER);
    });

    if (subscriberFilterExist && command.job) {
      return (
        (await this.getSubscriberBySubscriberId({
          subscriberId: command.job.subscriberId,
          _environmentId: command.environmentId,
        })) ?? undefined
      );
    }

    return undefined;
  }

  private async fetchTenantIfMissing(
    command: ConditionsFilterCommand,
    filters: IMessageFilter[]
  ): Promise<TenantEntity | undefined> {
    if (command.variables?.tenant) {
      return command.variables.tenant;
    }

    const tenantIdentifier =
      typeof command.job?.tenant === 'string' ? command.job?.tenant : command.job?.tenant?.identifier;
    const tenantFilterExist = filters?.find((filter) => {
      return filter?.children?.find((item) => item?.on === FilterPartTypeEnum.TENANT);
    });

    if (tenantFilterExist && tenantIdentifier && command.job) {
      return (
        (await this.tenantRepository.findOne({
          _environmentId: command.job._environmentId,
          identifier: tenantIdentifier,
        })) ?? undefined
      );
    }

    return undefined;
  }

  @CachedResponse({
    builder: (command: { subscriberId: string; _environmentId: string }) =>
      buildSubscriberKey({
        _environmentId: command._environmentId,
        subscriberId: command.subscriberId,
      }),
  })
  public async getSubscriberBySubscriberId({
    subscriberId,
    _environmentId,
  }: {
    subscriberId: string;
    _environmentId: string;
  }) {
    return await this.subscriberRepository.findOne({
      _environmentId,
      subscriberId,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - combinedFilters([command.step, ...(command.step?.variants || [])].flatMap((variant))
 - subscriberFilterExist(filters?.find((filter))
 - tenantFilterExist(filters?.find((filter))
Declaraciones 'export' encontradas:
- export class NormalizeVariables

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/process-tenant/index.ts
Tamaño: 123 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ProcessTenantCommand } from './process-tenant.command';
export { ProcessTenant } from './process-tenant.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/process-tenant/process-tenant.command.ts
Tamaño: 267 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ITenantDefine } from '@novu/shared';
import { IsDefined } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';

export class ProcessTenantCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  tenant: ITenantDefine;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ProcessTenantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/process-tenant/process-tenant.usecase.ts
Tamaño: 2900 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { TenantEntity, TenantRepository } from '@novu/dal';
import { ITenantDefine } from '@novu/shared';
import { isEqual } from 'lodash';

import { InstrumentUsecase } from '../../instrumentation';
import { CreateTenant, CreateTenantCommand } from '../create-tenant';
import { UpdateTenant, UpdateTenantCommand } from '../update-tenant';
import { ProcessTenantCommand } from './process-tenant.command';

@Injectable()
export class ProcessTenant {
  constructor(
    private updateTenantUsecase: UpdateTenant,
    private createTenantUsecase: CreateTenant,
    private tenantRepository: TenantRepository
  ) {}

  @InstrumentUsecase()
  public async execute(command: ProcessTenantCommand): Promise<TenantEntity | undefined> {
    const { environmentId, organizationId, userId, tenant } = command;

    let tenantEntity;

    try {
      tenantEntity = await this.getTenant(environmentId, organizationId, userId, tenant);
    } catch (e) {
      tenantEntity = null;
    }

    if (tenantEntity === null) {
      return undefined;
    }

    return tenantEntity;
  }

  private async getTenant(
    environmentId: string,
    organizationId: string,
    userId: string,
    tenantPayload: ITenantDefine
  ): Promise<TenantEntity> {
    const tenant = await this.getTenantByIdentifier({
      _environmentId: environmentId,
      identifier: tenantPayload.identifier,
    });

    if (tenant) {
      if (!this.tenantNeedUpdate(tenant, tenantPayload)) {
        return tenant;
      }

      return await this.updateTenantUsecase.execute(
        UpdateTenantCommand.create({
          environmentId,
          organizationId,
          userId,
          identifier: tenantPayload.identifier,
          name: tenantPayload?.name,
          data: tenantPayload?.data,
          tenant,
        })
      );
    }

    return await this.createTenant(environmentId, organizationId, userId, tenantPayload);
  }

  private async createTenant(
    environmentId: string,
    organizationId: string,
    userId: string,
    tenantPayload: ITenantDefine
  ): Promise<TenantEntity> {
    return await this.createTenantUsecase.execute(
      CreateTenantCommand.create({
        environmentId,
        organizationId,
        userId,
        identifier: tenantPayload.identifier,
        name: tenantPayload?.name,
        data: tenantPayload?.data,
      })
    );
  }

  private async getTenantByIdentifier({ identifier, _environmentId }: { identifier: string; _environmentId: string }) {
    return await this.tenantRepository.findOne({
      _environmentId,
      identifier,
    });
  }

  private tenantNeedUpdate(tenant: TenantEntity, tenantPayload: Partial<TenantEntity>): boolean {
    return (
      !!(tenantPayload?.name && tenant?.name !== tenantPayload?.name) ||
      !!(tenantPayload?.data && !isEqual(tenant?.data, tenantPayload?.data))
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ProcessTenant

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-integration/index.ts
Tamaño: 139 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { SelectIntegrationCommand } from './select-integration.command';
export { SelectIntegration } from './select-integration.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-integration/select-integration.command.ts
Tamaño: 572 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, ITenantDefine, ProvidersIdEnum } from '@novu/shared';
import { IsDefined, IsMongoId, IsOptional } from 'class-validator';

import { EnvironmentCommand } from '../../commands/project.command';

export class SelectIntegrationCommand extends EnvironmentCommand {
  @IsOptional()
  @IsMongoId()
  id?: string;

  @IsOptional()
  identifier?: string;

  @IsDefined()
  channelType: ChannelTypeEnum;

  @IsOptional()
  providerId?: ProvidersIdEnum;

  @IsDefined()
  filterData: {
    tenant?: ITenantDefine;
  };

  @IsOptional()
  userId?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SelectIntegrationCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-integration/select-integration.spec.ts
Tamaño: 5222 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  EnvironmentRepository,
  ExecutionDetailsRepository,
  IntegrationEntity,
  IntegrationRepository,
  JobRepository,
  MessageRepository,
  SubscriberRepository,
  TenantRepository,
} from '@novu/dal';
import { ChannelTypeEnum, EmailProviderIdEnum } from '@novu/shared';
import { FeatureFlagsService, TraceLogRepository } from '../../services';
import { CompileTemplate } from '../compile-template';
import { ConditionsFilter } from '../conditions-filter';
import { CreateExecutionDetails } from '../create-execution-details';
import { SelectIntegrationCommand } from './select-integration.command';
import { SelectIntegration } from './select-integration.usecase';

const testIntegration: IntegrationEntity = {
  _environmentId: 'env-test-123',
  _id: 'integration-test-123',
  _organizationId: 'org-test-123',
  active: true,
  channel: ChannelTypeEnum.EMAIL,
  credentials: {
    apiKey: '123',
    user: 'test-user',
    secretKey: '123',
    domain: 'domain',
    password: '123',
    host: 'host',
    port: 'port',
    secure: true,
    region: 'region',
    accountSid: 'accountSid',
    messageProfileId: 'messageProfileId',
    token: '123',
    from: 'from',
    senderName: 'senderName',
    applicationId: 'applicationId',
    clientId: 'clientId',
    projectName: 'projectName',
  },
  providerId: 'test-provider-id',
  deleted: false,
  identifier: 'test-integration-identifier',
  name: 'test-integration-name',
  primary: true,
  priority: 1,
  deletedAt: null,
  deletedBy: null,
};

const novuIntegration: IntegrationEntity = {
  _environmentId: 'env-test-123',
  _id: 'integration-test-novu-123',
  _organizationId: 'org-test-123',
  active: true,
  channel: ChannelTypeEnum.EMAIL,
  credentials: {},
  providerId: EmailProviderIdEnum.Novu,
  deleted: false,
  identifier: 'test-novu-integration-identifier',
  name: 'test-novu-integration-name',
  primary: true,
  priority: 1,
  deletedAt: null,
  deletedBy: null,
};

const findOneMock = jest.fn(() => testIntegration);

jest.mock('@novu/dal', () => ({
  ...jest.requireActual('@novu/dal'),
  IntegrationRepository: jest.fn(() => ({
    findOne: findOneMock,
  })),
}));

jest.mock('../get-decrypted-integrations', () => ({
  ...jest.requireActual('../get-decrypted-integrations'),
  GetDecryptedIntegrations: jest.fn(() => ({
    execute: jest.fn(() => novuIntegration),
  })),
}));

describe('select integration', () => {
  let useCase: SelectIntegration;
  const integrationRepository: IntegrationRepository = new IntegrationRepository();

  const conditionsFilter = new ConditionsFilter(
    new SubscriberRepository(),
    new MessageRepository(),
    new JobRepository(),
    new EnvironmentRepository(),
    new CreateExecutionDetails(new ExecutionDetailsRepository(), TraceLogRepository as any, new FeatureFlagsService()),
    new CompileTemplate()
  );
  beforeEach(async () => {
    // @ts-expect-error
    useCase = new SelectIntegration(integrationRepository, conditionsFilter, new TenantRepository());
    jest.clearAllMocks();
  });

  it('should select the integration', async () => {
    const integration = await useCase.execute(
      SelectIntegrationCommand.create({
        channelType: ChannelTypeEnum.EMAIL,
        environmentId: 'environmentId',
        organizationId: 'organizationId',
        userId: 'userId',
        filterData: {},
      })
    );

    expect(integration).not.toBeNull();
    expect(integration?.identifier).toEqual(testIntegration.identifier);
  });

  it('should return the novu integration', async () => {
    findOneMock.mockImplementationOnce(() => null);

    const integration = await useCase.execute(
      SelectIntegrationCommand.create({
        channelType: ChannelTypeEnum.EMAIL,
        environmentId: 'environmentId',
        organizationId: 'organizationId',
        userId: 'userId',
        filterData: {},
      })
    );

    expect(integration).not.toBeNull();
    expect(integration?.providerId).toEqual(EmailProviderIdEnum.Novu);
  });

  it.each`
    channel                   | shouldUsePrimary
    ${ChannelTypeEnum.PUSH}   | ${false}
    ${ChannelTypeEnum.CHAT}   | ${false}
    ${ChannelTypeEnum.IN_APP} | ${false}
    ${ChannelTypeEnum.EMAIL}  | ${true}
    ${ChannelTypeEnum.SMS}    | ${true}
  `(
    'for channel $channel it should select integration by primary: $shouldUsePrimary',
    async ({ channel, shouldUsePrimary }) => {
      const environmentId = 'environmentId';
      const organizationId = 'organizationId';
      const userId = 'userId';
      findOneMock.mockImplementation(() => ({
        ...testIntegration,
        channel,
      }));

      const integration = await useCase.execute(
        SelectIntegrationCommand.create({
          channelType: channel,
          environmentId,
          organizationId,
          userId,
          filterData: {},
        })
      );

      expect(findOneMock).toHaveBeenCalledWith(
        {
          _organizationId: organizationId,
          _environmentId: environmentId,
          channel,
          active: true,
          ...(shouldUsePrimary && {
            primary: true,
          }),
        },
        undefined,
        { query: { sort: { createdAt: -1 } } }
      );
    }
  );
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - findOneMock(jest.fn(())
 - conditionsFilter(new ConditionsFilter(
    new SubscriberRepository(),
    new MessageRepository(),
    new JobReposi...)
 - useCase(new SelectIntegration(integrationRepository, conditionsFilter, new TenantRepository());
    jest.cle...)
 - integration(await useCase.execute(
      SelectIntegrationCommand.create({
        channelType: ChannelTypeEnum....)
 - integration(await useCase.execute(
      SelectIntegrationCommand.create({
        channelType: ChannelTypeEnum....)
 - userId('userId';
      findOneMock.mockImplementation(())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-integration/select-integration.usecase.ts
Tamaño: 4562 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { IntegrationEntity, IntegrationRepository, TenantEntity, TenantRepository } from '@novu/dal';
import { CHANNELS_WITH_PRIMARY } from '@novu/shared';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { CachedQuery } from '../../services/cache/interceptors/cached-query.interceptor';
import { buildIntegrationKey } from '../../services/cache/key-builders/queries';
import { ConditionsFilter, ConditionsFilterCommand } from '../conditions-filter';
import { GetDecryptedIntegrations } from '../get-decrypted-integrations';
import { NormalizeVariables, NormalizeVariablesCommand } from '../normalize-variables';
import { SelectIntegrationCommand } from './select-integration.command';

@Injectable()
export class SelectIntegration {
  constructor(
    private integrationRepository: IntegrationRepository,
    protected conditionsFilter: ConditionsFilter,
    private tenantRepository: TenantRepository,
    private normalizeVariablesUsecase: NormalizeVariables
  ) {}

  @InstrumentUsecase()
  @CachedQuery({
    builder: ({ organizationId, ...command }: SelectIntegrationCommand) =>
      buildIntegrationKey().cache({
        _organizationId: organizationId,
        ...command,
      }),
  })
  async execute(command: SelectIntegrationCommand): Promise<IntegrationEntity | undefined> {
    let integration: IntegrationEntity | null = await this.getPrimaryIntegration(command);

    if (!command.identifier && command.filterData.tenant && command.userId) {
      const query = this.getIntegrationQuery(command);

      const integrations = await this.integrationRepository.find(query);

      let tenant: TenantEntity | null = null;
      const commandTenantIdentifier =
        typeof command.filterData.tenant === 'string'
          ? command.filterData.tenant
          : command.filterData.tenant.identifier;
      if (commandTenantIdentifier) {
        tenant = await this.tenantRepository.findOne({
          _organizationId: command.organizationId,
          _environmentId: command.environmentId,
          identifier: commandTenantIdentifier,
        });
      }

      for (const currentIntegration of integrations) {
        if (!currentIntegration.conditions || currentIntegration.conditions.length === 0) {
          continue;
        }

        const variables = await this.normalizeVariablesUsecase.execute(
          NormalizeVariablesCommand.create({
            filters: currentIntegration.conditions || [],
            environmentId: command.environmentId,
            organizationId: command.organizationId,
            userId: command.userId,
            variables: {
              tenant,
            },
          })
        );

        const { passed } = await this.conditionsFilter.filter(
          ConditionsFilterCommand.create({
            filters: currentIntegration.conditions,
            environmentId: command.environmentId,
            organizationId: command.organizationId,
            userId: command.userId,
            variables,
          })
        );

        if (passed) {
          integration = currentIntegration;
          break;
        }
      }
    }

    if (!integration) {
      return;
    }

    return GetDecryptedIntegrations.getDecryptedCredentials(integration);
  }

  @Instrument()
  private async getPrimaryIntegration(command: SelectIntegrationCommand): Promise<IntegrationEntity | null> {
    const isChannelSupportsPrimary = CHANNELS_WITH_PRIMARY.includes(command.channelType);

    const query: Partial<IntegrationEntity> & { _organizationId: string } = command.identifier
      ? {
          _organizationId: command.organizationId,
          channel: command.channelType,
          identifier: command.identifier,
          active: true,
        }
      : this.getIntegrationQuery(command, isChannelSupportsPrimary);

    return await this.integrationRepository.findOne(query, undefined, {
      query: { sort: { createdAt: -1 } },
    });
  }

  private getIntegrationQuery(command: SelectIntegrationCommand, isChannelSupportsPrimary = false) {
    const query: Partial<IntegrationEntity> & { _organizationId: string } = {
      _organizationId: command.organizationId,
      _environmentId: command.environmentId,
      channel: command.channelType,
      active: true,
    };

    if (command.id) {
      query._id = command.id;
    }

    if (command.providerId) {
      query.providerId = command.providerId;
    }

    if (isChannelSupportsPrimary) {
      query.primary = true;
    }

    return query;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SelectIntegration

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-variant/index.ts
Tamaño: 84 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './select-variant.command';
export * from './select-variant.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-variant/select-variant.command.ts
Tamaño: 461 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobEntity, NotificationStepEntity, TenantEntity } from '@novu/dal';
import { IsDefined } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';
import { IFilterVariables } from '../../utils/filter-processing-details';

export class SelectVariantCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  filterData: IFilterVariables;

  @IsDefined()
  step: NotificationStepEntity;

  @IsDefined()
  job: JobEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SelectVariantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-variant/select-variant.spec.ts
Tamaño: 7249 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageTemplateEntity, MessageTemplateRepository, SubscriberRepository, TenantRepository } from '@novu/dal';
import { EmailBlockTypeEnum, FieldLogicalOperatorEnum, FieldOperatorEnum, StepTypeEnum } from '@novu/shared';

import { ConditionsFilter } from '../conditions-filter';
import { NormalizeVariables } from '../normalize-variables';
import { SelectVariantCommand } from './select-variant.command';
import { SelectVariant } from './select-variant.usecase';

const findOneMessageTemplateMock = jest.fn(() => testVariant);

jest.mock('@novu/dal', () => ({
  ...jest.requireActual('@novu/dal'),
  MessageTemplateRepository: jest.fn(() => ({
    findOne: findOneMessageTemplateMock,
  })),
}));

describe('select variant', () => {
  let selectVariantUsecase: SelectVariant;

  beforeEach(async () => {
    selectVariantUsecase = new SelectVariant(
      // @ts-ignore
      new ConditionsFilter(),
      new MessageTemplateRepository(),
      new NormalizeVariables(new SubscriberRepository(), new TenantRepository())
    );
    jest.clearAllMocks();
  });

  it('should select the variant', async () => {
    const variant = await selectVariantUsecase.execute(command as unknown as SelectVariantCommand);

    expect(variant.messageTemplate.content).toEqual(testVariant.content);
    expect(variant.messageTemplate.subject).toEqual(testVariant.subject);
    expect(variant.messageTemplate._id).toEqual(testVariant._id);
  });

  it('should return step template if no variants are available', async () => {
    const commandWithoutVariants = { ...command };
    commandWithoutVariants.step.variants = [];

    const stepVariant = await selectVariantUsecase.execute(commandWithoutVariants as unknown as SelectVariantCommand);

    expect(stepVariant.conditions).toBeUndefined();
    expect(stepVariant.messageTemplate.content).toEqual(commandWithoutVariants.step.template.content);
    expect(stepVariant.messageTemplate.subject).toEqual(commandWithoutVariants.step.template.subject);
    expect(stepVariant.messageTemplate._id).toEqual(commandWithoutVariants.step.template._id);
  });

  it('should return step template if no filterData are available', async () => {
    const commandWithoutFilterData = { ...command };
    commandWithoutFilterData.filterData = {} as any;

    const stepVariant = await selectVariantUsecase.execute(commandWithoutFilterData as unknown as SelectVariantCommand);

    expect(stepVariant.conditions).toBeUndefined();
    expect(stepVariant.messageTemplate.content).toEqual(commandWithoutFilterData.step.template.content);
    expect(stepVariant.messageTemplate.subject).toEqual(commandWithoutFilterData.step.template.subject);
    expect(stepVariant.messageTemplate._id).toEqual(commandWithoutFilterData.step.template._id);
  });

  it('should return step template if no filters are available', async () => {
    const commandWithoutFilterData = { ...command };
    commandWithoutFilterData.filterData = {} as any;

    commandWithoutFilterData.step.variants.forEach((variant) => {
      variant.filters = [];
    });

    const stepVariant = await selectVariantUsecase.execute(commandWithoutFilterData as unknown as SelectVariantCommand);

    expect(stepVariant.conditions).toBeUndefined();
    expect(stepVariant.messageTemplate.content).toEqual(commandWithoutFilterData.step.template.content);
    expect(stepVariant.messageTemplate.subject).toEqual(commandWithoutFilterData.step.template.subject);
    expect(stepVariant.messageTemplate._id).toEqual(commandWithoutFilterData.step.template._id);
  });
});

const variantCommand = [
  {
    metadata: {
      timed: {
        weekDays: [],
        monthDays: [],
      },
    },
    active: true,
    shouldStopOnFail: false,
    filters: [
      {
        isNegated: false,
        type: 'GROUP',
        value: FieldLogicalOperatorEnum.AND,
        children: [
          {
            field: 'name',
            value: 'Titans',
            operator: FieldOperatorEnum.EQUAL,
            on: 'tenant',
            _id: '6509997c2c2343366ae4a864',
          },
        ],
        _id: '6509997c2c2343366ae4a863',
      },
    ],
    _templateId: '6509997c2c2343366ae4a858',
    _id: '6509997c2c2343366ae4a862',
    id: '6509997c2c2343366ae4a862',
  },
  {
    metadata: {
      timed: {
        weekDays: [],
        monthDays: [],
      },
    },
    active: true,
    shouldStopOnFail: false,
    filters: [
      {
        isNegated: false,
        type: 'GROUP',
        value: FieldLogicalOperatorEnum.AND,
        children: [
          {
            field: 'name',
            value: 'The one and only tenant',
            operator: FieldOperatorEnum.EQUAL,
            on: 'tenant',
            _id: '6509997c2c2343366ae4a867',
          },
        ],
        _id: '6509997c2c2343366ae4a866',
      },
    ],
    _templateId: '6509997c2c2343366ae4a85a',
    _id: '6509997c2c2343366ae4a865',
    id: '6509997c2c2343366ae4a865',
  },
];

const filterDataCommand = {
  tenant: {
    _id: '6509997c2c2343366ae4a851',
    identifier: 'one_123',
    name: 'The one and only tenant',
    data: {
      value1: 'Best fighter',
      value2: 'Ever',
    },
    _environmentId: '6509997c2c2343366ae4a7f1',
    _organizationId: '6509997c2c2343366ae4a7eb',
    createdAt: '2023-09-19T12:52:12.829Z',
    updatedAt: '2023-09-19T12:52:12.829Z',
    __v: 0,
    id: '6509997c2c2343366ae4a851',
  },
};

const stepCommand = {
  metadata: {
    timed: {
      weekDays: [],
      monthDays: [],
    },
  },
  active: true,
  shouldStopOnFail: false,
  filters: [],
  _templateId: '6509997c2c2343366ae4a856',
  variants: variantCommand,
  _id: '6509997c2c2343366ae4a861',
  id: '6509997c2c2343366ae4a861',
  template: {
    _id: '6509997c2c2343366ae4a856',
    type: 'email',
    active: true,
    name: 'Root Message Name',
    subject: 'Root Test email subject',
    variables: [],
    content: [
      {
        type: 'text',
        content: 'Root This is a sample text block',
      },
    ],
    preheader: 'Root Test email preheader',
    _environmentId: '6509997c2c2343366ae4a7f1',
    _organizationId: '6509997c2c2343366ae4a7eb',
    _creatorId: '6509997c2c2343366ae4a7e9',
    _feedId: '6509997c2c2343366ae4a820',
    _layoutId: '6509997c2c2343366ae4a7f6',
    deleted: false,
    createdAt: '2023-09-19T12:52:12.842Z',
    updatedAt: '2023-09-19T12:52:12.842Z',
    __v: 0,
    id: '6509997c2c2343366ae4a856',
  },
};

const command = {
  organizationId: '6509997c2c2343366ae4a7eb',
  environmentId: '6509997c2c2343366ae4a7f1',
  userId: '6509997c2c2343366ae4a7e9',
  step: stepCommand,
  filterData: filterDataCommand,
};

const testVariant: MessageTemplateEntity = {
  _id: '6509a934462a5dd6a03954fe',
  type: StepTypeEnum.EMAIL,
  active: true,
  name: 'Better Variant Message Template',
  subject: 'Better Variant subject',
  variables: [],
  content: [
    {
      type: EmailBlockTypeEnum.TEXT,
      content: 'This is a sample of Better Variant text block',
    },
  ],
  preheader: 'Better Variant pre header',
  _environmentId: '6509a934462a5dd6a0395495',
  _organizationId: '6509a934462a5dd6a039548f',
  _creatorId: '6509a934462a5dd6a039548d',
  _feedId: '6509a934462a5dd6a03954c4',
  _layoutId: '6509a934462a5dd6a039549a',
  deleted: false,
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - findOneMessageTemplateMock(jest.fn(())
 - selectVariantUsecase(new SelectVariant(
      // @ts-ignore
      new ConditionsFilter(),
      new MessageTemplateReposi...)
 - variant(await selectVariantUsecase.execute(command as unknown as SelectVariantCommand);

    expect(variant....)
 - stepVariant(await selectVariantUsecase.execute(commandWithoutVariants as unknown as SelectVariantCommand);

    ...)
 - stepVariant(await selectVariantUsecase.execute(commandWithoutFilterData as unknown as SelectVariantCommand);

  ...)
 - filterData({} as any;

    commandWithoutFilterData.step.variants.forEach((variant))

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/select-variant/select-variant.usecase.ts
Tamaño: 3130 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, Logger } from '@nestjs/common';

import { MessageTemplateEntity, MessageTemplateRepository } from '@novu/dal';
import { ICondition } from '@novu/shared';
import { IFilterVariables, PlatformException } from '../../utils';
import { ConditionsFilter, ConditionsFilterCommand } from '../conditions-filter';
import { NormalizeVariables, NormalizeVariablesCommand } from '../normalize-variables';
import { SelectVariantCommand } from './select-variant.command';

const LOG_CONTEXT = 'SelectVariant';

@Injectable()
export class SelectVariant {
  constructor(
    private conditionsFilter: ConditionsFilter,
    private messageTemplateRepository: MessageTemplateRepository,
    private normalizeVariablesUsecase: NormalizeVariables
  ) {}

  async execute(command: SelectVariantCommand): Promise<{
    messageTemplate: MessageTemplateEntity;
    conditions?: ICondition[];
  }> {
    if (!command.step.variants?.length) {
      return { messageTemplate: command.step.template };
    }

    if (!this.isFilterDataExist(command.filterData)) {
      return { messageTemplate: command.step.template };
    }

    for (const variant of command.step.variants) {
      if (!variant.filters?.length || !variant.active) {
        continue;
      }

      const variables = await this.normalizeVariablesUsecase.execute(
        NormalizeVariablesCommand.create({
          filters: variant.filters || [],
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
          step: command.step,
          job: command.job,
          variables: command.filterData,
        })
      );

      const { passed, conditions } = await this.conditionsFilter.filter(
        ConditionsFilterCommand.create({
          filters: variant.filters,
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          userId: command.userId,
          step: command.step,
          job: command.job,
          variables,
        })
      );

      if (passed) {
        const messageTemplate = await this.messageTemplateRepository.findOne({
          _organizationId: command.organizationId,
          _environmentId: command.environmentId,
          _id: variant._templateId,
        });

        if (!messageTemplate) {
          const errorMessage = `Variant message template with id ${variant._templateId} not found`;
          Logger.error(
            {
              variantTemplateId: variant._templateId,
              filters: variant.filters,
              organizationId: command.organizationId,
              transactionId: command.job.transactionId,
              conditions,
            },
            errorMessage,
            LOG_CONTEXT
          );

          throw new PlatformException(errorMessage);
        }

        return { messageTemplate, conditions };
      }
    }

    return { messageTemplate: command.step.template };
  }

  private isFilterDataExist(filterData: IFilterVariables) {
    return !!filterData.tenant || !!filterData.payload || !!filterData.subscriber || !!filterData.webhook;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SelectVariant

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/subscribers/index.ts
Tamaño: 70 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './types';
export * from './update-subscriber-channel';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/subscribers/types/index.ts
Tamaño: 75 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum OAuthHandlerEnum {
  NOVU = 'novu',
  EXTERNAL = 'external',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/subscribers/update-subscriber-channel/index.ts
Tamaño: 106 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './update-subscriber-channel.command';
export * from './update-subscriber-channel.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/subscribers/update-subscriber-channel/update-subscriber-channel.command.ts
Tamaño: 1257 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity } from '@novu/dal';
import { ChatProviderIdEnum, IChannelCredentials, ISubscriberChannel, PushProviderIdEnum } from '@novu/shared';
import { IsBoolean, IsNotEmpty, IsOptional, IsString, ValidateNested } from 'class-validator';
import { EnvironmentCommand } from '../../../commands';
import { OAuthHandlerEnum } from '../types';

export class IChannelCredentialsCommand implements IChannelCredentials {
  @IsString()
  @IsOptional()
  webhookUrl?: string;

  @IsString()
  @IsOptional()
  channel?: string;

  @IsString({ each: true })
  @IsOptional()
  deviceTokens?: string[];

  @IsOptional()
  alertUid?: string;

  @IsOptional()
  title?: string;

  @IsOptional()
  imageUrl?: string;

  @IsOptional()
  state?: string;

  @IsOptional()
  externalUrl?: string;
}

export class UpdateSubscriberChannelCommand extends EnvironmentCommand implements ISubscriberChannel {
  @IsString()
  subscriberId: string;

  providerId: ChatProviderIdEnum | PushProviderIdEnum;

  subscriber?: SubscriberEntity;

  @ValidateNested()
  credentials: IChannelCredentialsCommand;

  @IsNotEmpty()
  oauthHandler: OAuthHandlerEnum;

  @IsOptional()
  @IsString()
  integrationIdentifier?: string;

  @IsBoolean()
  isIdempotentOperation: boolean;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class IChannelCredentialsCommand
- export class UpdateSubscriberChannelCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/subscribers/update-subscriber-channel/update-subscriber-channel.usecase.ts
Tamaño: 6445 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, forwardRef, Inject, Injectable } from '@nestjs/common';
import { IntegrationEntity, IntegrationRepository, SubscriberEntity, SubscriberRepository } from '@novu/dal';
import { IChannelSettings } from '@novu/shared';
import { isEqual } from 'lodash';
import { AnalyticsService, buildSubscriberKey, InvalidateCacheService } from '../../../services';
import { UpdateSubscriberChannelCommand } from './update-subscriber-channel.command';

@Injectable()
export class UpdateSubscriberChannel {
  constructor(
    @Inject(forwardRef(() => InvalidateCacheService))
    private invalidateCache: InvalidateCacheService,
    private subscriberRepository: SubscriberRepository,
    private integrationRepository: IntegrationRepository,
    @Inject(forwardRef(() => AnalyticsService))
    private analyticsService: AnalyticsService
  ) {}

  async execute(command: UpdateSubscriberChannelCommand) {
    const foundSubscriber =
      command.subscriber ??
      (await this.subscriberRepository.findBySubscriberId(command.environmentId, command.subscriberId));

    if (!foundSubscriber) {
      throw new BadRequestException(`SubscriberId: ${command.subscriberId} not found`);
    }

    const query: Partial<IntegrationEntity> & { _environmentId: string } = {
      _environmentId: command.environmentId,
      providerId: command.providerId,
      active: true,
    };
    if (command.integrationIdentifier) {
      query.identifier = command.integrationIdentifier;
    }

    const foundIntegration = await this.integrationRepository.findOne(query, undefined, {
      query: { sort: { createdAt: -1 } },
    });

    if (!foundIntegration) {
      throw new BadRequestException(
        `Subscribers environment (${command.environmentId}) do not have active ${command.providerId} integration.`
      );
    }
    const updatePayload = this.createUpdatePayload(command);

    const existingChannel = foundSubscriber?.channels?.find(
      (subscriberChannel) =>
        subscriberChannel.providerId === command.providerId && subscriberChannel._integrationId === foundIntegration._id
    );

    if (existingChannel) {
      await this.updateExistingSubscriberChannel(
        command.environmentId,
        existingChannel,
        updatePayload,
        foundSubscriber,
        command.isIdempotentOperation
      );
    } else {
      await this.addChannelToSubscriber(updatePayload, foundIntegration, command, foundSubscriber);
    }

    this.analyticsService.mixpanelTrack('Set Subscriber Credentials - [Subscribers]', '', {
      providerId: command.providerId,
      _organization: command.organizationId,
      oauthHandler: command.oauthHandler,
      _subscriberId: foundSubscriber._id,
    });

    return (await this.subscriberRepository.findBySubscriberId(
      command.environmentId,
      command.subscriberId
    )) as SubscriberEntity;
  }

  private async addChannelToSubscriber(
    updatePayload: Partial<IChannelSettings>,
    foundIntegration,
    command: UpdateSubscriberChannelCommand,
    foundSubscriber
  ) {
    updatePayload._integrationId = foundIntegration._id;
    updatePayload.providerId = command.providerId;

    await this.invalidateCache.invalidateByKey({
      key: buildSubscriberKey({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    await this.subscriberRepository.update(
      { _environmentId: command.environmentId, _id: foundSubscriber },
      {
        $push: {
          channels: updatePayload,
        },
      }
    );
  }

  private async updateExistingSubscriberChannel(
    environmentId: string,
    existingChannel: IChannelSettings,
    updatePayload: Partial<IChannelSettings>,
    foundSubscriber: SubscriberEntity,
    isIdempotentOperation: boolean
  ) {
    const equal = isEqual(existingChannel.credentials, updatePayload.credentials);

    if (equal) {
      return;
    }

    let deviceTokens: string[] = [];

    if (updatePayload.credentials?.deviceTokens) {
      if (isIdempotentOperation) {
        deviceTokens = this.unionDeviceTokens([], updatePayload.credentials.deviceTokens);
      } else {
        deviceTokens = this.unionDeviceTokens(
          existingChannel.credentials.deviceTokens ?? [],
          updatePayload.credentials.deviceTokens
        );
      }
    }

    await this.invalidateCache.invalidateByKey({
      key: buildSubscriberKey({
        subscriberId: foundSubscriber.subscriberId,
        _environmentId: foundSubscriber._environmentId,
      }),
    });

    const mappedChannel: IChannelSettings = this.mapChannel(updatePayload, existingChannel, deviceTokens);

    await this.subscriberRepository.update(
      {
        _environmentId: environmentId,
        _id: foundSubscriber,
        'channels._integrationId': existingChannel._integrationId,
      },
      { $set: { 'channels.$': mappedChannel } }
    );
  }

  private mapChannel(
    updatePayload: Partial<IChannelSettings>,
    existingChannel: IChannelSettings,
    deviceTokens: string[]
  ): IChannelSettings {
    return {
      _integrationId: updatePayload._integrationId || existingChannel._integrationId,
      providerId: updatePayload.providerId || existingChannel.providerId,
      credentials: {
        ...existingChannel.credentials,
        ...updatePayload.credentials,
        deviceTokens,
      },
    };
  }

  private unionDeviceTokens(existingDeviceTokens: string[], updateDeviceTokens: string[]): string[] {
    // in order to not have breaking change we will support [] update
    if (updateDeviceTokens?.length === 0) return [];

    return [...new Set([...existingDeviceTokens, ...updateDeviceTokens])];
  }

  private createUpdatePayload(command: UpdateSubscriberChannelCommand) {
    const updatePayload: Partial<IChannelSettings> = {
      credentials: {},
    };

    if (command.credentials != null) {
      if (command.credentials.webhookUrl != null && updatePayload.credentials) {
        updatePayload.credentials.webhookUrl = command.credentials.webhookUrl;
      }
      if (command.credentials.deviceTokens != null && updatePayload.credentials) {
        updatePayload.credentials.deviceTokens = [...new Set([...command.credentials.deviceTokens])];
      }
      if (command.credentials.channel != null && updatePayload.credentials) {
        updatePayload.credentials.channel = command.credentials.channel;
      }
    }

    return updatePayload;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - existingChannel(foundSubscriber?.channels?.find(
      (subscriberChannel))
Declaraciones 'export' encontradas:
- export class UpdateSubscriberChannel

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/tier-restrictions-validate/index.ts
Tamaño: 108 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './tier-restrictions-validate.command';
export * from './tier-restrictions-validate.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/tier-restrictions-validate/tier-restrictions-validate.command.ts
Tamaño: 743 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { StepTypeEnum } from '@novu/shared';
import { Transform } from 'class-transformer';
import { IsEnum, IsNumber, IsOptional, IsString } from 'class-validator';
import { OrganizationLevelCommand } from '../../commands';

export class TierRestrictionsValidateCommand extends OrganizationLevelCommand {
  @IsOptional()
  @Transform(({ value }) => (value ? Number(value) : value))
  @IsNumber()
  amount?: number;

  @IsString()
  @IsOptional()
  unit?: string;

  @IsNumber()
  @IsOptional()
  deferDurationMs?: number;

  @IsOptional()
  @IsString()
  cron?: string;

  @IsOptional()
  @IsString()
  type?: string;

  @IsOptional()
  @IsString()
  dynamicKey?: string;

  @IsEnum(StepTypeEnum)
  @IsOptional()
  stepType?: StepTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TierRestrictionsValidateCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/tier-restrictions-validate/tier-restrictions-validate.response.ts
Tamaño: 298 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum ErrorEnum {
  TIER_LIMIT_EXCEEDED = 'TIER_LIMIT_EXCEEDED',
  INVALID_DEFER_DURATION = 'INVALID_DEFER_DURATION',
}

export type TierValidationError = {
  controlKey: string;
  error: ErrorEnum;
  message: string;
};

export type TierRestrictionsValidateResponse = TierValidationError[];


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/tier-restrictions-validate/tier-restrictions-validate.usecase.ts
Tamaño: 9364 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { CommunityOrganizationRepository, OrganizationEntity } from '@novu/dal';
import {
  ApiServiceLevelEnum,
  castUnitToDigestUnitEnum,
  DigestUnitEnum,
  FeatureFlagsKeysEnum,
  FeatureNameEnum,
  getFeatureForTierAsNumber,
  StepTypeEnum,
} from '@novu/shared';
import { parseExpression as parseCronExpression } from 'cron-parser';
import { addYears, differenceInMilliseconds, isAfter } from 'date-fns';
import { InstrumentUsecase } from '../../instrumentation';
import { FeatureFlagsService } from '../../services';
import { MIN_VALIDATION_LIMITS, SYSTEM_LIMITS } from '../../services/resource-validator.service';
import { TierRestrictionsValidateCommand } from './tier-restrictions-validate.command';
import {
  ErrorEnum,
  TierRestrictionsValidateResponse,
  TierValidationError,
} from './tier-restrictions-validate.response';

@Injectable()
export class TierRestrictionsValidateUsecase {
  constructor(
    private organizationRepository: CommunityOrganizationRepository,
    private featureFlagsService: FeatureFlagsService
  ) {}

  @InstrumentUsecase()
  async execute(command: TierRestrictionsValidateCommand): Promise<TierRestrictionsValidateResponse> {
    const { stepType } = command;

    if (!isDigestDelayOrThrottle(stepType)) {
      return [];
    }

    const organization = await this.organizationRepository.findById(command.organizationId);

    if (!organization) {
      throw new Error(`Organization not found: ${command.organizationId}`);
    }

    if (stepType !== StepTypeEnum.THROTTLE && isCronExpression(command.cron)) {
      const maxDelayMs = await this.getMaxDelayInMs(
        command,
        organization,
        stepType as StepTypeEnum.DELAY | StepTypeEnum.DIGEST
      );

      if (this.isCronDeltaDeferDurationExceededTier(command.cron, maxDelayMs)) {
        return [
          {
            controlKey: 'cron',
            error: ErrorEnum.TIER_LIMIT_EXCEEDED,
            message:
              `The maximum delay allowed is ${msToDays(maxDelayMs)} days. ` +
              'Please contact our support team to discuss extending this limit for your use case.',
          },
        ];
      }

      return [];
    }

    if (stepType !== StepTypeEnum.THROTTLE && isRegularDeferAction(command)) {
      const deferDurationMs = calculateDeferDuration(command);

      if (deferDurationMs < MIN_VALIDATION_LIMITS.DEFER_DURATION_MS) {
        return [];
      }

      const maxDelayMs = await this.getMaxDelayInMs(
        command,
        organization,
        stepType as StepTypeEnum.DELAY | StepTypeEnum.DIGEST
      );

      const amountIssue = buildIssue(deferDurationMs, maxDelayMs, ErrorEnum.TIER_LIMIT_EXCEEDED, 'amount');
      const unitIssue = buildIssue(deferDurationMs, maxDelayMs, ErrorEnum.TIER_LIMIT_EXCEEDED, 'unit');

      return [amountIssue, unitIssue].filter(Boolean);
    }

    if (stepType === StepTypeEnum.DELAY && isDynamicDelayAction(command)) {
      return [];
    }

    if (stepType === StepTypeEnum.THROTTLE && isRegularThrottleAction(command)) {
      const throttleDurationMs = calculateThrottleDuration(command);

      if (throttleDurationMs < MIN_VALIDATION_LIMITS.DEFER_DURATION_MS) {
        return [];
      }

      const maxThrottleMs = await this.getMaxThrottleInMs(command, organization);

      const amountIssue = buildIssue(throttleDurationMs, maxThrottleMs, ErrorEnum.TIER_LIMIT_EXCEEDED, 'amount');
      const unitIssue = buildIssue(throttleDurationMs, maxThrottleMs, ErrorEnum.TIER_LIMIT_EXCEEDED, 'unit');

      return [amountIssue, unitIssue].filter(Boolean);
    }

    return [];
  }

  private async getMaxDelayInMs(
    command: TierRestrictionsValidateCommand,
    organization: OrganizationEntity,
    stepType: StepTypeEnum.DELAY | StepTypeEnum.DIGEST
  ) {
    const systemLimit = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.MAX_DEFER_DURATION_IN_MS_NUMBER,
      defaultValue: SYSTEM_LIMITS.DEFER_DURATION_MS,
      environment: { _id: command.environmentId },
      organization,
    });

    // If the system limit is not the default, we need to use it as the absolute limit for special cases instead of the tier limit
    const isSpecialLimit = systemLimit !== SYSTEM_LIMITS.DEFER_DURATION_MS;
    if (isSpecialLimit) {
      return systemLimit;
    }

    const tierLimit = getFeatureForTierAsNumber(
      stepType === StepTypeEnum.DELAY
        ? FeatureNameEnum.PLATFORM_MAX_DELAY_DURATION
        : FeatureNameEnum.PLATFORM_MAX_DIGEST_WINDOW_TIME,
      organization.apiServiceLevel || ApiServiceLevelEnum.FREE,
      true
    );

    return Math.min(systemLimit, tierLimit);
  }

  private async getMaxThrottleInMs(command: TierRestrictionsValidateCommand, organization: OrganizationEntity) {
    const systemLimit = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.MAX_DEFER_DURATION_IN_MS_NUMBER,
      defaultValue: SYSTEM_LIMITS.DEFER_DURATION_MS,
      environment: { _id: command.environmentId },
      organization,
    });

    // If the system limit is not the default, we need to use it as the absolute limit for special cases instead of the tier limit
    const isSpecialLimit = systemLimit !== SYSTEM_LIMITS.DEFER_DURATION_MS;
    if (isSpecialLimit) {
      return systemLimit;
    }

    const tierLimit = getFeatureForTierAsNumber(
      FeatureNameEnum.PLATFORM_MAX_THROTTLE_WINDOW_TIME,
      organization.apiServiceLevel || ApiServiceLevelEnum.FREE,
      true
    );

    return Math.min(systemLimit, tierLimit);
  }

  private isCronDeltaDeferDurationExceededTier(cron: string, maxDelayMs: number): boolean {
    const cronExpression = parseCronExpression(cron);
    const firstDate = cronExpression.next().toDate();
    const twoYearsFromFirst = addYears(firstDate, 2);
    let previousDate = firstDate;
    const MAX_ITERATIONS = 50;

    for (let i = 0; i < MAX_ITERATIONS; i += 1) {
      const currentDate = cronExpression.next().toDate();

      // If we've gone past two years from the first date, the intervals are safe
      if (isAfter(currentDate, twoYearsFromFirst)) {
        return false;
      }

      const deferDurationMs = differenceInMilliseconds(currentDate, previousDate);

      if (deferDurationMs > maxDelayMs) {
        return true;
      }

      previousDate = currentDate;
    }

    return false;
  }
}
function calculateDeferDuration(command: TierRestrictionsValidateCommand): number | null {
  if (command.deferDurationMs) {
    return command.deferDurationMs;
  }

  if (isValidDigestUnit(command.unit) && isNumber(command.amount)) {
    return calculateMilliseconds(command.amount, command.unit);
  }

  return null;
}

function isValidDigestUnit(unit: unknown): unit is DigestUnitEnum {
  return Object.values(DigestUnitEnum).includes(unit as DigestUnitEnum);
}

function isNumber(value: unknown): value is number {
  return !Number.isNaN(Number(value));
}

function calculateMilliseconds(amount: number, unit: DigestUnitEnum): number {
  switch (unit) {
    case DigestUnitEnum.SECONDS:
      return amount * 1000;
    case DigestUnitEnum.MINUTES:
      return amount * 1000 * 60;
    case DigestUnitEnum.HOURS:
      return amount * 1000 * 60 * 60;
    case DigestUnitEnum.DAYS:
      return amount * 1000 * 60 * 60 * 24;
    case DigestUnitEnum.WEEKS:
      return amount * 1000 * 60 * 60 * 24 * 7;
    case DigestUnitEnum.MONTHS:
      return amount * 1000 * 60 * 60 * 24 * 30; // Using 30 days as an approximation for a month
    default:
      return 0;
  }
}

/*
 * Cron expression is another term for a timed digest
 */
const isCronExpression = (cron: string) => {
  return !!cron;
};

const isRegularDeferAction = (command: TierRestrictionsValidateCommand) => {
  if (command.type === 'dynamic') {
    return false;
  }

  if (command.deferDurationMs) {
    return true;
  }

  return !!command.amount && isNumber(command.amount) && !!command.unit && isValidDigestUnit(command.unit);
};

const isDynamicDelayAction = (command: TierRestrictionsValidateCommand) => {
  return command.type === 'dynamic' && !!command.dynamicKey;
};

function buildIssue(
  deferDurationMs: number,
  maxDelayMs: number,
  error: ErrorEnum,
  controlKey: string
): TierValidationError | null {
  if (deferDurationMs > maxDelayMs) {
    return {
      controlKey,
      error,
      message:
        `The maximum delay allowed is ${msToDays(maxDelayMs)} days. ` +
        'Please contact our support team to discuss extending this limit for your use case.',
    };
  }

  return null;
}

function msToDays(ms: number): number {
  return Math.floor(ms / (1000 * 60 * 60 * 24));
}

function isDigestDelayOrThrottle(
  stepType: StepTypeEnum
): stepType is StepTypeEnum.DIGEST | StepTypeEnum.DELAY | StepTypeEnum.THROTTLE {
  return [StepTypeEnum.DIGEST, StepTypeEnum.DELAY, StepTypeEnum.THROTTLE].includes(stepType);
}

function isRegularThrottleAction(command: TierRestrictionsValidateCommand) {
  return command.amount && command.unit && !isCronExpression(command.cron);
}

function calculateThrottleDuration(command: TierRestrictionsValidateCommand): number | null {
  if (!command.amount || !command.unit) {
    return null;
  }

  const digestUnit = castUnitToDigestUnitEnum(command.unit);
  if (!digestUnit) {
    return null;
  }

  return calculateMilliseconds(command.amount, digestUnit);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - calculateDeferDuration(command: TierRestrictionsValidateCommand)
 - isValidDigestUnit(unit: unknown)
 - isNumber(value: unknown)
 - calculateMilliseconds(amount: number, unit: DigestUnitEnum)
 - buildIssue(deferDurationMs: number,
  maxDelayMs: number,
  error: ErrorEnum,
  controlKey: string)
 - msToDays(ms: number)
 - isDigestDelayOrThrottle(stepType: StepTypeEnum)
 - isRegularThrottleAction(command: TierRestrictionsValidateCommand)
 - calculateThrottleDuration(command: TierRestrictionsValidateCommand)
Asignaciones con arrow functions encontradas (posibles funciones):
 - isCronExpression(cron: string))
 - isRegularDeferAction(command: TierRestrictionsValidateCommand))
 - isDynamicDelayAction(command: TierRestrictionsValidateCommand))
Declaraciones 'export' encontradas:
- export class TierRestrictionsValidateUsecase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-base/index.ts
Tamaño: 74 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { BaseTriggerCommand, TriggerBase } from './trigger-base.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-base/trigger-base.usecase.ts
Tamaño: 3489 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import {
  EnvironmentEntity,
  NotificationTemplateEntity,
  OrganizationEntity,
  SubscriberEntity,
  TopicEntity,
  UserEntity,
} from '@novu/dal';
import {
  FeatureFlagsKeysEnum,
  ISubscribersDefine,
  ITenantDefine,
  ResourceEnum,
  StatelessControls,
  SubscriberSourceEnum,
  TriggerOverrides,
  TriggerRequestCategoryEnum,
} from '@novu/shared';
import _ from 'lodash';

import { IProcessSubscriberBulkJobDto } from '../../dtos';
import { PinoLogger } from '../../logging';
import { CacheService, FeatureFlagsService } from '../../services';
import { buildUsageKey } from '../../services/cache/key-builders';
import { SubscriberProcessQueueService } from '../../services/queues/subscriber-process-queue.service';
import { mapSubscribersToJobs } from '../../utils';

export type BaseTriggerCommand = {
  environmentId: string;
  organizationId: string;
  userId: string;
  transactionId: string;
  // TODO: remove optional flag after all the workers are migrated to use requestId NV-6475
  requestId?: string;
  identifier: string;
  payload: any;
  overrides: TriggerOverrides;
  template: NotificationTemplateEntity;
  actor?: SubscriberEntity | undefined;
  contextKeys?: string[];
  tenant: ITenantDefine | null;
  environmentName: string;
  requestCategory?: TriggerRequestCategoryEnum;
  controls?: StatelessControls;
  bridgeUrl?: string;
  bridgeWorkflow?: any;
};

@Injectable()
export abstract class TriggerBase {
  constructor(
    protected subscriberProcessQueueService: SubscriberProcessQueueService,
    protected cacheService: CacheService,
    protected featureFlagsService: FeatureFlagsService,
    protected logger: PinoLogger,
    protected queueChunkSize: number = 100
  ) {}

  protected async subscriberProcessQueueAddBulk(jobs: IProcessSubscriberBulkJobDto[]) {
    const isUsageTrackingInTriggerBaseEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_INCR_IF_EXIST_USAGE_ENABLED,
      defaultValue: false,
      organization: { _id: jobs[0].data.organizationId } as OrganizationEntity,
      environment: { _id: jobs[0].data.environmentId } as EnvironmentEntity,
      user: { _id: jobs[0].data.userId } as UserEntity,
    });

    return await Promise.all(
      _.chunk(jobs, this.queueChunkSize).map(async (chunk: IProcessSubscriberBulkJobDto[]) => {
        try {
          await this.subscriberProcessQueueService.addBulk(chunk);
        } catch (error) {
          this.logger.warn({ err: error }, 'Failed to add jobs to queue');
        }

        if (isUsageTrackingInTriggerBaseEnabled) {
          try {
            await this.cacheService.incrIfExistsAtomic(
              buildUsageKey({
                _organizationId: jobs[0].data.organizationId,
                resourceType: ResourceEnum.EVENTS,
              }),
              chunk.length
            );
          } catch (error) {
            this.logger.warn({ err: error }, 'Failed to increment usage counter');
          }
        }
      })
    );
  }

  protected async sendToProcessSubscriberService(
    command: BaseTriggerCommand,
    subscribers: { subscriberId: string; topics?: Pick<TopicEntity, '_id' | 'key'>[] }[] | ISubscribersDefine[],
    subscriberSource: SubscriberSourceEnum
  ) {
    if (subscribers.length === 0) {
      return;
    }

    const jobs = mapSubscribersToJobs(subscriberSource, subscribers, command);

    return await this.subscriberProcessQueueAddBulk(jobs);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - isUsageTrackingInTriggerBaseEnabled(await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_INCR_IF_EXIST_USAGE_ENAB...)
Declaraciones 'export' encontradas:
- export  type
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-broadcast/index.ts
Tamaño: 90 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './trigger-broadcast.command';
export * from './trigger-broadcast.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-broadcast/trigger-broadcast.command.ts
Tamaño: 663 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotificationTemplateEntity, SubscriberEntity } from '@novu/dal';
import { ITenantDefine } from '@novu/shared';
import { IsArray, IsDefined, IsOptional, IsString, ValidateNested } from 'class-validator';

import { TriggerEventBroadcastCommand } from '../trigger-event';

export class TriggerBroadcastCommand extends TriggerEventBroadcastCommand {
  @IsDefined()
  template: NotificationTemplateEntity;

  @IsOptional()
  actor?: SubscriberEntity | undefined;

  @ValidateNested()
  tenant: ITenantDefine | null;

  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  contextKeys?: string[];

  @IsDefined()
  @IsString()
  environmentName: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TriggerBroadcastCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-broadcast/trigger-broadcast.usecase.ts
Tamaño: 4765 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { SubscriberEntity, SubscriberRepository } from '@novu/dal';
import { SubscriberSourceEnum } from '@novu/shared';

import { PinoLogger } from 'nestjs-pino';
import { InstrumentUsecase } from '../../instrumentation';
import { CacheService, FeatureFlagsService } from '../../services';
import type { EventType, Trace } from '../../services/analytic-logs';
import { LogRepository, mapEventTypeToTitle, TraceLogRepository } from '../../services/analytic-logs';
import { SubscriberProcessQueueService } from '../../services/queues/subscriber-process-queue.service';
import { TriggerBase } from '../trigger-base';
import { TriggerBroadcastCommand } from './trigger-broadcast.command';

const QUEUE_CHUNK_SIZE = Number(process.env.BROADCAST_QUEUE_CHUNK_SIZE) || 100;

@Injectable()
export class TriggerBroadcast extends TriggerBase {
  constructor(
    private subscriberRepository: SubscriberRepository,
    protected subscriberProcessQueueService: SubscriberProcessQueueService,
    protected cacheService: CacheService,
    protected featureFlagsService: FeatureFlagsService,
    protected logger: PinoLogger,
    private traceLogRepository: TraceLogRepository
  ) {
    super(subscriberProcessQueueService, cacheService, featureFlagsService, logger, QUEUE_CHUNK_SIZE);
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute(command: TriggerBroadcastCommand) {
    try {
      const subscriberFetchBatchSize = 500;
      let subscribers: SubscriberEntity[] = [];
      let totalProcessed = 0;

      for await (const subscriber of this.subscriberRepository.findBatch(
        {
          _environmentId: command.environmentId,
          _organizationId: command.organizationId,
        },
        'subscriberId',
        {},
        subscriberFetchBatchSize
      )) {
        subscribers.push(subscriber);
        if (subscribers.length === subscriberFetchBatchSize) {
          await this.sendToProcessSubscriberService(command, subscribers, SubscriberSourceEnum.BROADCAST);
          totalProcessed += subscribers.length;
          subscribers = [];
        }
      }

      await this.createBroadcastTrace(
        command,
        'request_subscriber_processing_completed',
        'success',
        'Subscriber processing completed successfully',
        {
          addressingType: 'broadcast',
          workflowId: command.template._id,
          totalSubscribers: totalProcessed,
        }
      );

      if (subscribers.length > 0) {
        await this.sendToProcessSubscriberService(command, subscribers, SubscriberSourceEnum.BROADCAST);
        totalProcessed += subscribers.length;
      }
    } catch (e) {
      const error = e as Error;
      await this.createBroadcastTrace(
        command,
        'request_failed',
        'error',
        `Broadcast processing failed: ${error.message || 'Unknown error'}`,
        {
          addressingType: 'broadcast',
          workflowId: command.template._id,
          error: error.message,
          stack: error.stack,
        }
      );

      this.logger.error(
        {
          transactionId: command.transactionId,
          organization: command.organizationId,
          triggerIdentifier: command.identifier,
          userId: command.userId,
          error: e,
        },
        'Unexpected error has occurred when processing broadcast'
      );

      throw e;
    }
  }

  private async createBroadcastTrace(
    command: TriggerBroadcastCommand,
    eventType: EventType,
    status: 'success' | 'error' | 'warning' = 'success',
    message?: string,
    rawData?: any
  ): Promise<void> {
    if (!command.requestId) {
      return;
    }

    try {
      const traceData: Omit<Trace, 'id' | 'expires_at'> = {
        created_at: LogRepository.formatDateTime64(new Date()),
        organization_id: command.organizationId,
        environment_id: command.environmentId,
        user_id: command.userId,
        subscriber_id: null,
        external_subscriber_id: null,
        event_type: eventType,
        title: mapEventTypeToTitle(eventType),
        message: message || null,
        raw_data: rawData ? JSON.stringify(rawData) : null,
        status,
        entity_type: 'request',
        entity_id: command.requestId,
        workflow_run_identifier: command.template.triggers[0].identifier,
      };

      await this.traceLogRepository.createRequest([traceData]);
    } catch (error) {
      this.logger.error(
        {
          error,
          eventType,
          transactionId: command.transactionId,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
        },
        'Failed to create broadcast trace'
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TriggerBroadcast

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-event/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './trigger-event.command';
export * from './trigger-event.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-event/trigger-event.command.ts
Tamaño: 1984 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DiscoverWorkflowOutput } from '@novu/framework/internal';
import {
  AddressingTypeEnum,
  ContextPayload,
  StatelessControls,
  TriggerOverrides,
  TriggerRecipientSubscriber,
  TriggerRecipientsPayload,
  TriggerRequestCategoryEnum,
  TriggerTenantContext,
} from '@novu/shared';
import { IsDefined, IsEnum, IsOptional, IsString, ValidateIf, ValidateNested } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../commands';
import { IsValidContextPayload } from '../../decorators';

export class TriggerEventBaseCommand extends EnvironmentWithUserCommand {
  @IsDefined()
  @IsString()
  identifier: string;

  @IsDefined()
  payload: any;

  @IsDefined()
  overrides: TriggerOverrides;

  @IsString()
  @IsDefined()
  transactionId: string;

  // TODO: remove optional flag after all the workers are migrated to use requestId NV-6475
  @IsString()
  @IsOptional()
  requestId?: string;

  @IsOptional()
  @ValidateIf((_, value) => typeof value !== 'string')
  @ValidateNested()
  actor?: TriggerRecipientSubscriber | null;

  @IsOptional()
  @ValidateIf((_, value) => typeof value !== 'string')
  @ValidateNested()
  tenant?: TriggerTenantContext | null;

  @IsOptional()
  @IsEnum(TriggerRequestCategoryEnum)
  requestCategory?: TriggerRequestCategoryEnum;

  @IsOptional()
  @IsString()
  bridgeUrl?: string;

  @IsOptional()
  bridgeWorkflow?: DiscoverWorkflowOutput;

  controls?: StatelessControls;

  @IsOptional()
  @IsValidContextPayload({ maxCount: 5 })
  context?: ContextPayload;
}

export class TriggerEventMulticastCommand extends TriggerEventBaseCommand {
  @IsDefined()
  to: TriggerRecipientsPayload;

  @IsEnum(AddressingTypeEnum)
  addressingType: AddressingTypeEnum.MULTICAST;
}

export class TriggerEventBroadcastCommand extends TriggerEventBaseCommand {
  @IsEnum(AddressingTypeEnum)
  addressingType: AddressingTypeEnum.BROADCAST;
}

export type TriggerEventCommand = TriggerEventMulticastCommand | TriggerEventBroadcastCommand;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TriggerEventBaseCommand
- export class TriggerEventMulticastCommand
- export class TriggerEventBroadcastCommand
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-event/trigger-event.usecase.ts
Tamaño: 14034 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable, Logger, NotFoundException } from '@nestjs/common';
import {
  ContextRepository,
  EnvironmentRepository,
  JobEntity,
  JobRepository,
  NotificationTemplateEntity,
  NotificationTemplateRepository,
  SubscriberEntity,
} from '@novu/dal';
import {
  AddressingTypeEnum,
  FeatureFlagsKeysEnum,
  ISubscribersDefine,
  ITenantDefine,
  TriggerRecipientSubscriber,
  TriggerTenantContext,
} from '@novu/shared';
import { addBreadcrumb } from '@sentry/node';
import { Instrument, InstrumentUsecase } from '../../instrumentation';
import { PinoLogger } from '../../logging';
import { FeatureFlagsService } from '../../services';
import type { EventType, Trace } from '../../services/analytic-logs';
import { LogRepository, mapEventTypeToTitle, TraceLogRepository } from '../../services/analytic-logs';
import { AnalyticsService } from '../../services/analytics.service';
import { CreateOrUpdateSubscriberCommand, CreateOrUpdateSubscriberUseCase } from '../create-or-update-subscriber';
import { ProcessTenant, ProcessTenantCommand } from '../process-tenant';
import { TriggerBroadcastCommand } from '../trigger-broadcast/trigger-broadcast.command';
import { TriggerBroadcast } from '../trigger-broadcast/trigger-broadcast.usecase';
import { TriggerMulticast, TriggerMulticastCommand } from '../trigger-multicast';
import { TriggerEventCommand } from './trigger-event.command';

function getActiveWorker() {
  return process.env.ACTIVE_WORKER;
}

@Injectable()
export class TriggerEvent {
  constructor(
    private createOrUpdateSubscriberUsecase: CreateOrUpdateSubscriberUseCase,
    private environmentRepository: EnvironmentRepository,
    private jobRepository: JobRepository,
    private notificationTemplateRepository: NotificationTemplateRepository,
    private processTenant: ProcessTenant,
    private logger: PinoLogger,
    private triggerBroadcast: TriggerBroadcast,
    private triggerMulticast: TriggerMulticast,
    private analyticsService: AnalyticsService,
    private traceLogRepository: TraceLogRepository,
    private contextRepository: ContextRepository,
    private featureFlagsService: FeatureFlagsService
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute(command: TriggerEventCommand) {
    await this.createWorkflowTrace(command, 'workflow_execution_started', 'success', 'Workflow execution started');

    try {
      const mappedCommand = await this.getMappedCommand(command);
      const { environmentId, identifier, organizationId, userId } = mappedCommand;

      const environment = await this.environmentRepository.findOne({
        _id: environmentId,
      });

      if (!environment) {
        throw new BadRequestException('Environment not found');
      }

      this.logger.assign({
        transactionId: mappedCommand.transactionId,
        environmentId: mappedCommand.environmentId,
        organizationId: mappedCommand.organizationId,
        contextKeys: mappedCommand.contextKeys,
      });

      Logger.debug(mappedCommand.actor);

      await this.validateTransactionIdProperty(mappedCommand.transactionId, environmentId);

      addBreadcrumb({
        message: 'Sending trigger',
        data: {
          triggerIdentifier: identifier,
        },
      });

      let storedWorkflow: NotificationTemplateEntity | null = null;
      if (!command.bridgeWorkflow) {
        storedWorkflow = await this.getAndUpdateWorkflowById({
          environmentId: mappedCommand.environmentId,
          triggerIdentifier: mappedCommand.identifier,
          payload: mappedCommand.payload,
          organizationId: mappedCommand.organizationId,
          userId: mappedCommand.userId,
        });
      }

      if (!storedWorkflow && !command.bridgeWorkflow) {
        await this.createWorkflowTrace(
          command,
          'workflow_template_not_found',
          'error',
          'Notification template could not be found',
          { identifier: mappedCommand.identifier }
        );
        throw new BadRequestException('Notification template could not be found');
      }

      if (mappedCommand.tenant) {
        const tenantProcessed = await this.processTenant.execute(
          ProcessTenantCommand.create({
            environmentId,
            organizationId,
            userId,
            tenant: mappedCommand.tenant,
          })
        );

        if (!tenantProcessed) {
          await this.createWorkflowTrace(
            command,
            'workflow_tenant_processing_failed',
            'warning',
            'Tenant processing failed',
            { tenantIdentifier: mappedCommand.tenant.identifier }
          );
          Logger.warn(
            `Tenant with identifier ${JSON.stringify(
              mappedCommand.tenant.identifier
            )} of organization ${mappedCommand.organizationId} in transaction ${
              mappedCommand.transactionId
            } could not be processed.`
          );
        }
      }

      // We might have a single actor for every trigger, so we only need to check for it once
      let actorProcessed: SubscriberEntity | undefined;
      if (mappedCommand.actor) {
        this.logger.info(mappedCommand, 'Processing actor');

        try {
          actorProcessed = await this.createOrUpdateSubscriberUsecase.execute(
            this.buildCommand(environmentId, organizationId, mappedCommand.actor)
          );
        } catch (error: any) {
          await this.createWorkflowTrace(
            command,
            'workflow_actor_processing_failed',
            'error',
            'Actor processing failed',
            { error: error.message, stack: error.stack }
          );
          throw error;
        }
      }

      switch (mappedCommand.addressingType) {
        case AddressingTypeEnum.MULTICAST: {
          await this.triggerMulticast.execute(
            TriggerMulticastCommand.create({
              ...mappedCommand,
              actor: actorProcessed,
              environmentName: environment.name,
              template: storedWorkflow || (command.bridgeWorkflow as unknown as NotificationTemplateEntity),
            })
          );
          break;
        }
        case AddressingTypeEnum.BROADCAST: {
          await this.triggerBroadcast.execute(
            TriggerBroadcastCommand.create({
              ...mappedCommand,
              actor: actorProcessed,
              environmentName: environment.name,
              template: storedWorkflow || (command.bridgeWorkflow as unknown as NotificationTemplateEntity),
            })
          );
          break;
        }
        default: {
          await this.triggerMulticast.execute(
            TriggerMulticastCommand.create({
              addressingType: AddressingTypeEnum.MULTICAST,
              ...(mappedCommand as TriggerMulticastCommand),
              actor: actorProcessed,
              environmentName: environment.name,
              template: storedWorkflow || (command.bridgeWorkflow as unknown as NotificationTemplateEntity),
            })
          );
          break;
        }
      }
    } catch (e) {
      const error = e as Error;
      await this.createWorkflowTrace(
        command,
        'workflow_execution_failed',
        'error',
        `Workflow execution failed: ${error.message}`,
        { error: error.message, stack: error.stack }
      );

      Logger.error(
        {
          transactionId: command.transactionId,
          organization: command.organizationId,
          triggerIdentifier: command.identifier,
          userId: command.userId,
          error: e,
        },
        'Unexpected error has occurred when triggering event'
      );

      throw e;
    }
  }

  private async getMappedCommand(command: TriggerEventCommand) {
    const isContextEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_CONTEXT_ENABLED,
      defaultValue: false,
      organization: { _id: command.organizationId },
      environment: { _id: command.environmentId },
      user: { _id: command.userId },
    });

    return {
      ...command,
      tenant: this.mapTenant(command.tenant),
      actor: this.mapActor(command.actor),
      ...(isContextEnabled && { contextKeys: await this.resolveContextKeys(command) }),
    };
  }

  private async createWorkflowTrace(
    command: TriggerEventCommand,
    eventType: EventType,
    status: 'success' | 'error' | 'warning' = 'success',
    message?: string,
    rawData?: any
  ): Promise<void> {
    if (!command.requestId) {
      return;
    }

    try {
      const traceData: Omit<Trace, 'id' | 'expires_at'> = {
        created_at: LogRepository.formatDateTime64(new Date()),
        organization_id: command.organizationId,
        environment_id: command.environmentId,
        user_id: command.userId,
        subscriber_id: null,
        external_subscriber_id: null,
        event_type: eventType,
        title: mapEventTypeToTitle(eventType),
        message: message || null,
        raw_data: rawData ? JSON.stringify(rawData) : null,
        status,
        entity_type: 'request',
        entity_id: command.requestId,
        workflow_run_identifier: command.identifier,
      };

      await this.traceLogRepository.createRequest([traceData]);
    } catch (error) {
      this.logger.error(
        {
          error,
          eventType,
          transactionId: command.transactionId,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
        },
        'Failed to create workflow trace'
      );
    }
  }

  private buildCommand(
    environmentId: string,
    organizationId: string,
    subscriberPayload: ISubscribersDefine
  ): CreateOrUpdateSubscriberCommand {
    return CreateOrUpdateSubscriberCommand.create({
      environmentId,
      organizationId,
      subscriberId: subscriberPayload?.subscriberId,
      email: subscriberPayload?.email,
      firstName: subscriberPayload?.firstName,
      lastName: subscriberPayload?.lastName,
      phone: subscriberPayload?.phone,
      avatar: subscriberPayload?.avatar,
      locale: subscriberPayload?.locale,
      data: subscriberPayload?.data,
      channels: subscriberPayload?.channels,
      activeWorkerName: getActiveWorker(),
    });
  }
  private async getAndUpdateWorkflowById(command: {
    triggerIdentifier: string;
    environmentId: string;
    payload: Record<string, any>;
    organizationId: string;
    userId: string;
  }) {
    const lastTriggeredAt = new Date();

    const workflow = await this.notificationTemplateRepository.findByTriggerIdentifierAndUpdate(
      command.environmentId,
      command.triggerIdentifier,
      lastTriggeredAt
    );

    if (workflow) {
      // We only consider trigger when it's coming from the backend SDK
      if (!command.payload?.__source) {
        if (!workflow.lastTriggeredAt) {
          this.analyticsService.track('Workflow Connected to Backend SDK - [API]', command.userId, {
            name: workflow.name,
            origin: workflow.origin,
            _organization: command.organizationId,
            _environment: command.environmentId,
          });
        }

        /**
         * Update the entry to cache it with the new lastTriggeredAt
         */
        workflow.lastTriggeredAt = lastTriggeredAt.toISOString();
      }
    }

    return workflow;
  }

  @Instrument()
  private async validateTransactionIdProperty(transactionId: string, environmentId: string): Promise<void> {
    const found = (await this.jobRepository.findOne(
      {
        transactionId,
        _environmentId: environmentId,
      },
      '_id'
    )) as Pick<JobEntity, '_id'>;

    if (found) {
      throw new BadRequestException(
        'transactionId property is not unique, please make sure all triggers have a unique transactionId'
      );
    }
  }

  private mapTenant(tenant: TriggerTenantContext): ITenantDefine | null {
    if (!tenant) return null;

    if (typeof tenant === 'string') {
      return { identifier: tenant };
    }

    return tenant;
  }

  private mapActor(subscriber: TriggerRecipientSubscriber): ISubscribersDefine | null {
    if (!subscriber) return null;

    if (typeof subscriber === 'string') {
      return { subscriberId: subscriber };
    }

    return subscriber;
  }

  private async resolveContextKeys(command: TriggerEventCommand): Promise<string[]> {
    if (!command.context) {
      return [];
    }

    try {
      const contexts = await this.contextRepository.findOrCreateContextsFromPayload(
        command.environmentId,
        command.organizationId,
        command.context
      );

      this.createWorkflowTrace(command, 'workflow_context_resolution_completed', 'success', 'Context resolved', {
        context: contexts.map((context) => ({
          id: context.id,
          type: context.type,
          data: context.data,
          createdAt: context.createdAt,
          updatedAt: context.updatedAt,
        })),
      });

      return contexts.map((context) => context.key);
    } catch (error) {
      this.logger.error(
        {
          error,
          transactionId: command.transactionId,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
          context: command.context,
        },
        'Failed to resolve context'
      );

      if (error instanceof BadRequestException) {
        this.createWorkflowTrace(command, 'workflow_context_resolution_failed', 'error', 'Context resolution failed', {
          context: command.context,
        });
      }

      if (error instanceof NotFoundException) {
        this.createWorkflowTrace(command, 'workflow_context_not_found', 'error', 'Context not found', {
          context: command.context,
        });
      }
      throw new BadRequestException(
        `Failed to resolve context: ${error instanceof Error ? error.message : String(error)} | Context: ${JSON.stringify(command.context)}`
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getActiveWorker()
Asignaciones con arrow functions encontradas (posibles funciones):
 - contexts(await this.contextRepository.findOrCreateContextsFromPayload(
        command.environmentId,
       ...)
Declaraciones 'export' encontradas:
- export class TriggerEvent

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-multicast/index.ts
Tamaño: 90 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './trigger-multicast.command';
export * from './trigger-multicast.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-multicast/trigger-multicast.command.ts
Tamaño: 663 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotificationTemplateEntity, SubscriberEntity } from '@novu/dal';
import { ITenantDefine } from '@novu/shared';
import { IsArray, IsDefined, IsOptional, IsString, ValidateNested } from 'class-validator';

import { TriggerEventMulticastCommand } from '../trigger-event';

export class TriggerMulticastCommand extends TriggerEventMulticastCommand {
  @IsDefined()
  template: NotificationTemplateEntity;

  @IsOptional()
  actor?: SubscriberEntity | undefined;

  @ValidateNested()
  tenant: ITenantDefine | null;

  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  contextKeys?: string[];

  @IsDefined()
  @IsString()
  environmentName: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TriggerMulticastCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/trigger-multicast/trigger-multicast.usecase.ts
Tamaño: 10414 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { TopicEntity, TopicRepository, TopicSubscribersRepository } from '@novu/dal';
import {
  ISubscribersDefine,
  ITopic,
  SubscriberSourceEnum,
  TriggerRecipient,
  TriggerRecipientSubscriber,
  TriggerRecipientsTypeEnum,
} from '@novu/shared';

import { PinoLogger } from 'nestjs-pino';
import { InstrumentUsecase } from '../../instrumentation';
import { CacheService, FeatureFlagsService } from '../../services';
import type { EventType, Trace } from '../../services/analytic-logs';
import { LogRepository, mapEventTypeToTitle, TraceLogRepository } from '../../services/analytic-logs';
import { SubscriberProcessQueueService } from '../../services/queues/subscriber-process-queue.service';
import { TriggerBase } from '../trigger-base';
import { TriggerMulticastCommand } from './trigger-multicast.command';

const QUEUE_CHUNK_SIZE = Number(process.env.MULTICAST_QUEUE_CHUNK_SIZE) || 100;
const SUBSCRIBER_TOPIC_DISTINCT_BATCH_SIZE = Number(process.env.SUBSCRIBER_TOPIC_DISTINCT_BATCH_SIZE) || 100;

const isNotTopic = (recipient: TriggerRecipient): recipient is TriggerRecipientSubscriber => !isTopic(recipient);

const isTopic = (recipient: TriggerRecipient): recipient is ITopic =>
  (recipient as ITopic).type && (recipient as ITopic).type === TriggerRecipientsTypeEnum.TOPIC;

@Injectable()
export class TriggerMulticast extends TriggerBase {
  constructor(
    subscriberProcessQueueService: SubscriberProcessQueueService,
    private topicSubscribersRepository: TopicSubscribersRepository,
    private topicRepository: TopicRepository,
    protected cacheService: CacheService,
    protected featureFlagsService: FeatureFlagsService,
    protected logger: PinoLogger,
    private traceLogRepository: TraceLogRepository
  ) {
    super(subscriberProcessQueueService, cacheService, featureFlagsService, logger, QUEUE_CHUNK_SIZE);
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute(command: TriggerMulticastCommand) {
    const { environmentId, organizationId, to: recipients, actor } = command;

    try {
      const mappedRecipients = Array.isArray(recipients) ? recipients : [recipients];

      const { singleSubscribers, topicKeys, topicExclusions } = splitByRecipientType(mappedRecipients);
      const subscribersToProcess = Array.from(singleSubscribers.values());
      let totalProcessed = 0;

      if (subscribersToProcess.length > 0) {
        await this.sendToProcessSubscriberService(command, subscribersToProcess, SubscriberSourceEnum.SINGLE);
        totalProcessed += subscribersToProcess.length;
      }

      const topics = await this.getTopicsByTopicKeys(organizationId, environmentId, topicKeys);

      await this.validateTopicExist(command, topics, topicKeys);

      const topicIds = topics.map((topic) => topic._id);
      const singleSubscriberIds = Array.from(singleSubscribers.keys());
      const allTopicExcludedSubscribers = Array.from(
        new Set([...Array.from(topicExclusions.values()).flatMap((set) => Array.from(set))])
      );
      let subscribersList: { subscriberId: string; topics: Pick<TopicEntity, '_id' | 'key'>[] }[] = [];
      const getTopicDistinctSubscribersGenerator = this.topicSubscribersRepository.getTopicDistinctSubscribers({
        query: {
          _organizationId: organizationId,
          _environmentId: environmentId,
          topicIds,
          excludeSubscribers: [...singleSubscriberIds, ...allTopicExcludedSubscribers],
        },
        batchSize: SUBSCRIBER_TOPIC_DISTINCT_BATCH_SIZE,
      });

      for await (const externalSubscriberIdGroup of getTopicDistinctSubscribersGenerator) {
        const externalSubscriberId = externalSubscriberIdGroup._id;

        if (actor && actor.subscriberId === externalSubscriberId) {
          continue;
        }

        subscribersList.push({
          subscriberId: externalSubscriberId,
          topics: topics?.map((topic) => ({ _id: topic._id, key: topic.key })),
        });

        if (subscribersList.length === SUBSCRIBER_TOPIC_DISTINCT_BATCH_SIZE) {
          await this.sendToProcessSubscriberService(command, subscribersList, SubscriberSourceEnum.TOPIC);
          totalProcessed += subscribersList.length;

          subscribersList = [];
        }
      }

      await this.createMulticastTrace(
        command,
        'request_subscriber_processing_completed',
        'success',
        'Subscriber processing completed successfully',
        {
          addressingType: 'multicast',
          workflowId: command.template._id,
          totalSubscribers: totalProcessed,
          singleSubscribers: subscribersToProcess.length,
          topicSubscribers: totalProcessed - subscribersToProcess.length,
          topicsUsed: topics.length,
        }
      );

      if (subscribersList.length > 0) {
        await this.sendToProcessSubscriberService(command, subscribersList, SubscriberSourceEnum.TOPIC);
        totalProcessed += subscribersList.length;
      }
    } catch (e) {
      const error = e as Error;
      await this.createMulticastTrace(
        command,
        'request_failed',
        'error',
        `Multicast processing failed: ${error.message}`,
        {
          addressingType: 'multicast',
          workflowId: command.template._id,
          error: error.message,
          stack: error.stack,
        }
      );

      this.logger.error(
        {
          transactionId: command.transactionId,
          organization: command.organizationId,
          triggerIdentifier: command.identifier,
          userId: command.userId,
          error: e,
        },
        'Unexpected error has occurred when processing multicast'
      );

      throw e;
    }
  }

  private async createMulticastTrace(
    command: TriggerMulticastCommand,
    eventType: EventType,
    status: 'success' | 'error' | 'warning' = 'success',
    message?: string,
    rawData?: any
  ): Promise<void> {
    if (!command.requestId) {
      return;
    }

    try {
      const traceData: Omit<Trace, 'id' | 'expires_at'> = {
        created_at: LogRepository.formatDateTime64(new Date()),
        organization_id: command.organizationId,
        environment_id: command.environmentId,
        user_id: command.userId,
        subscriber_id: null,
        external_subscriber_id: null,
        event_type: eventType,
        title: mapEventTypeToTitle(eventType),
        message: message || null,
        raw_data: rawData ? JSON.stringify(rawData) : null,
        status,
        entity_type: 'request',
        entity_id: command.requestId,
        workflow_run_identifier: command.template.triggers[0].identifier,
      };

      await this.traceLogRepository.createRequest([traceData]);
    } catch (error) {
      this.logger.error(
        {
          error,
          eventType,
          transactionId: command.transactionId,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
        },
        'Failed to create multicast trace'
      );
    }
  }

  private async getTopicsByTopicKeys(
    organizationId: string,
    environmentId: string,
    topicKeys: Set<string>
  ): Promise<Pick<TopicEntity, '_id' | 'key'>[]> {
    return await this.topicRepository.find(
      {
        _organizationId: organizationId,
        _environmentId: environmentId,
        key: { $in: Array.from(topicKeys) },
      },
      '_id key'
    );
  }

  private async validateTopicExist(
    command: TriggerMulticastCommand,
    topics: Pick<TopicEntity, '_id' | 'key'>[],
    topicKeys: Set<string>
  ) {
    if (topics.length === topicKeys.size) {
      return;
    }

    const storageTopicsKeys = topics.map((topic) => topic.key);
    const notFoundTopics = [...topicKeys].filter((topicKey) => !storageTopicsKeys.includes(topicKey));

    if (notFoundTopics.length > 0) {
      this.logger.warn(`Topic with key ${notFoundTopics.join()} not found in current environment`);
      await this.createMulticastTrace(command, 'topic_not_found', 'warning', 'Multicast processing failed', {
        addressingType: 'multicast',
        workflowId: command.template._id,
        topicKeys: notFoundTopics,
      });
    }
  }
}

export const splitByRecipientType = (
  mappedRecipients: TriggerRecipient[]
): {
  singleSubscribers: Map<string, ISubscribersDefine>;
  topicKeys: Set<string>;
  topicExclusions: Map<string, Set<string>>;
} => {
  return mappedRecipients.reduce(
    (acc, recipient) => {
      if (!recipient) {
        return acc;
      }

      if (isTopic(recipient)) {
        acc.topicKeys.add(recipient.topicKey);
        const topicRecipient = recipient as ITopic;
        if (topicRecipient.exclude && topicRecipient.exclude.length > 0) {
          const existingExclusions = acc.topicExclusions.get(topicRecipient.topicKey) || new Set<string>();
          for (const subscriberId of topicRecipient.exclude) {
            existingExclusions.add(subscriberId);
          }
          acc.topicExclusions.set(topicRecipient.topicKey, existingExclusions);
        }
      } else {
        const subscribersDefine = buildSubscriberDefine(recipient);

        acc.singleSubscribers.set(subscribersDefine.subscriberId, subscribersDefine);
      }

      return acc;
    },
    {
      singleSubscribers: new Map<string, ISubscribersDefine>(),
      topicKeys: new Set<string>(),
      topicExclusions: new Map<string, Set<string>>(),
    }
  );
};

export const buildSubscriberDefine = (recipient: TriggerRecipientSubscriber): ISubscribersDefine => {
  if (typeof recipient === 'string') {
    return { subscriberId: recipient };
  } else {
    validateSubscriberDefine(recipient);

    return recipient;
  }
};

export const validateSubscriberDefine = (recipient: ISubscribersDefine) => {
  if (!recipient) {
    throw new BadRequestException(
      'subscriberId under property to is not configured, please make sure all subscribers contains subscriberId property'
    );
  }

  if (Array.isArray(recipient)) {
    throw new BadRequestException(
      'subscriberId under property to is type array, which is not allowed please make sure all subscribers ids are strings'
    );
  }

  if (!recipient.subscriberId) {
    throw new BadRequestException(
      'subscriberId under property to is not configured, please make sure all subscribers contains subscriberId property'
    );
  }
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - isNotTopic(recipient: TriggerRecipient): recipient is TriggerRecipientSubscriber)
 - isTopic(recipient: TriggerRecipient): recipient is ITopic)
 - topicIds(topics.map((topic))
 - allTopicExcludedSubscribers(Array.from(
        new Set([...Array.from(topicExclusions.values()).flatMap((set))
 - storageTopicsKeys(topics.map((topic))
 - notFoundTopics([...topicKeys].filter((topicKey))
 - splitByRecipientType(mappedRecipients: TriggerRecipient[]
): {
  singleSubscribers: Map<string, ISubscribersDefine>;
  to...)
 - buildSubscriberDefine(recipient: TriggerRecipientSubscriber): ISubscribersDefine)
 - validateSubscriberDefine(recipient: ISubscribersDefine))
Declaraciones 'export' encontradas:
- export class TriggerMulticast
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-change/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './update-change.command';
export * from './update-change.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-change/update-change.command.ts
Tamaño: 391 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChangeEntityTypeEnum } from '@novu/shared';
import { IsDefined, IsMongoId, IsString } from 'class-validator';
import { EnvironmentWithUserCommand } from '../../commands';

export class UpdateChangeCommand extends EnvironmentWithUserCommand {
  @IsMongoId()
  _entityId: string;

  @IsDefined()
  @IsString()
  type: ChangeEntityTypeEnum;

  @IsMongoId()
  parentChangeId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateChangeCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-change/update-change.usecase.ts
Tamaño: 602 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { ChangeRepository } from '@novu/dal';
import { UpdateChangeCommand } from './update-change.command';

@Injectable()
export class UpdateChange {
  constructor(private changeRepository: ChangeRepository) {}

  async execute(command: UpdateChangeCommand) {
    await this.changeRepository.update(
      {
        _environmentId: command.environmentId,
        _entityId: command._entityId,
        type: command.type,
        enabled: false,
      },
      {
        $set: {
          _parentId: command.parentChangeId,
        },
      }
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateChange

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-subscriber/index.ts
Tamaño: 90 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './update-subscriber.command';
export * from './update-subscriber.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-subscriber/update-subscriber.command.ts
Tamaño: 934 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity } from '@novu/dal';
import { ISubscriberChannel, SubscriberCustomData } from '@novu/shared';
import { Transform } from 'class-transformer';
import { IsEmail, IsLocale, IsOptional, IsString } from 'class-validator';

import { EnvironmentCommand } from '../../commands';

export class UpdateSubscriberCommand extends EnvironmentCommand {
  @IsString()
  subscriberId: string;

  @IsOptional()
  firstName?: string;

  @IsOptional()
  lastName?: string;

  @Transform((params) => (params.value === '' ? null : params.value))
  @IsOptional()
  @IsEmail()
  email?: string;

  @IsOptional()
  @IsString()
  phone?: string;

  @IsString()
  @IsOptional()
  avatar?: string;

  @IsLocale()
  @IsOptional()
  locale?: string;

  @IsOptional()
  timezone?: string;

  @IsOptional()
  data?: SubscriberCustomData;

  @IsOptional()
  subscriber?: SubscriberEntity;

  @IsOptional()
  channels?: ISubscriberChannel[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateSubscriberCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-subscriber/update-subscriber.spec.ts
Tamaño: 2408 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Test } from '@nestjs/testing';
import { SubscriberRepository } from '@novu/dal';
import { SubscribersService, UserSession } from '@novu/testing';
import {
  CacheInMemoryProviderService,
  CacheService,
  InMemoryProviderEnum,
  InvalidateCacheService,
} from '../../services';
import { UpdateSubscriberCommand } from './update-subscriber.command';
import { UpdateSubscriber } from './update-subscriber.usecase';

const cacheInMemoryProviderService = {
  provide: CacheInMemoryProviderService,
  useFactory: async (): Promise<CacheInMemoryProviderService> => {
    const cacheInMemoryProvider = new CacheInMemoryProviderService();

    return cacheInMemoryProvider;
  },
};

const cacheService = {
  provide: CacheService,
  useFactory: async () => {
    const factoryInMemoryProviderService = await cacheInMemoryProviderService.useFactory();

    return new CacheService(factoryInMemoryProviderService);
  },
};

describe('Update Subscriber', () => {
  let updateUsecase: UpdateSubscriber;
  let session: UserSession;
  const subscriberRepository = new SubscriberRepository();
  beforeEach(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [SubscriberRepository, InvalidateCacheService],
      providers: [UpdateSubscriber, cacheInMemoryProviderService, cacheService],
    }).compile();

    session = new UserSession();
    await session.initialize();

    updateUsecase = moduleRef.get<UpdateSubscriber>(UpdateSubscriber);
  });

  it('should update subscribers name', async () => {
    const subscriberService = new SubscribersService(session.organization._id, session.environment._id);
    const subscriber = await subscriberService.createSubscriber();
    await updateUsecase.execute(
      UpdateSubscriberCommand.create({
        organizationId: subscriber._organizationId,
        subscriberId: subscriber.subscriberId,
        lastName: 'Test Last Name',
        locale: 'sv',
        environmentId: session.environment._id,
      })
    );

    const updatedSubscriber = await subscriberRepository.findOne({
      _id: subscriber._id,
      _environmentId: subscriber._environmentId,
    });
    expect(updatedSubscriber.lastName).toEqual('Test Last Name');
    expect(updatedSubscriber.firstName).toEqual(subscriber.firstName);
    expect(updatedSubscriber.email).toEqual(subscriber.email);
    expect(updatedSubscriber.locale).toEqual('sv');
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - cacheInMemoryProviderService({
  provide: CacheInMemoryProviderService,
  useFactory: async (): Promise<CacheInMemoryProviderServ...)
 - cacheService({
  provide: CacheService,
  useFactory: async ())
 - factoryInMemoryProviderService(await cacheInMemoryProviderService.useFactory();

    return new CacheService(factoryInMemoryProvide...)
 - subscriberRepository(new SubscriberRepository();
  beforeEach(async ())
 - updateUsecase(moduleRef.get<UpdateSubscriber>(UpdateSubscriber);
  });

  it('should update subscribers name', asy...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-subscriber/update-subscriber.usecase.ts
Tamaño: 4107 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BadRequestException, Injectable } from '@nestjs/common';
import { SubscriberEntity, SubscriberRepository } from '@novu/dal';

import { buildSubscriberKey, CachedResponse, InvalidateCacheService } from '../../services';
import { subscriberNeedUpdate } from '../../utils';
import { OAuthHandlerEnum, UpdateSubscriberChannel, UpdateSubscriberChannelCommand } from '../subscribers';
import { UpdateSubscriberCommand } from './update-subscriber.command';

@Injectable()
export class UpdateSubscriber {
  constructor(
    private invalidateCache: InvalidateCacheService,
    private subscriberRepository: SubscriberRepository,
    private updateSubscriberChannel: UpdateSubscriberChannel
  ) {}

  public async execute(command: UpdateSubscriberCommand): Promise<SubscriberEntity> {
    const foundSubscriber = command.subscriber
      ? command.subscriber
      : await this.fetchSubscriber({
          subscriberId: command.subscriberId,
          _environmentId: command.environmentId,
        });

    if (!foundSubscriber) {
      throw new BadRequestException(`SubscriberId: ${command.subscriberId} not found`);
    }

    const updatePayload: Partial<SubscriberEntity> = {};

    if (command.email !== undefined) {
      updatePayload.email = command.email;
    }

    if (command.phone != null) {
      updatePayload.phone = command.phone;
    }

    if (command.firstName != null) {
      updatePayload.firstName = command.firstName;
    }

    if (command.lastName != null) {
      updatePayload.lastName = command.lastName;
    }

    if (command.avatar != null) {
      updatePayload.avatar = command.avatar;
    }

    if (command.locale != null) {
      updatePayload.locale = command.locale;
    }
    if (command.timezone != null) {
      updatePayload.timezone = command.timezone;
    }

    if (command.data != null) {
      updatePayload.data = command.data;
    }

    if (command.channels?.length) {
      await this.updateSubscriberChannels(command, foundSubscriber);
    }

    if (!subscriberNeedUpdate(foundSubscriber, updatePayload)) {
      return {
        ...foundSubscriber,
      };
    }

    await this.invalidateCache.invalidateByKey({
      key: buildSubscriberKey({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      }),
    });

    await this.subscriberRepository.update(
      {
        _environmentId: command.environmentId,
        _id: foundSubscriber._id,
      },
      {
        $set: updatePayload,
      }
    );

    // fetch subscriber again as channel credentials are updated
    if (command.channels?.length) {
      const updatedSubscriber = await this.fetchSubscriber({
        subscriberId: command.subscriberId,
        _environmentId: command.environmentId,
      });

      return updatedSubscriber;
    }

    return {
      ...foundSubscriber,
      ...updatePayload,
    };
  }

  private async updateSubscriberChannels(command: UpdateSubscriberCommand, foundSubscriber: SubscriberEntity) {
    for (const channel of command.channels) {
      await this.updateSubscriberChannel.execute(
        UpdateSubscriberChannelCommand.create({
          subscriber: foundSubscriber,
          organizationId: command.organizationId,
          environmentId: command.environmentId,
          subscriberId: command.subscriberId,
          providerId: channel.providerId,
          credentials: channel.credentials,
          integrationIdentifier: channel.integrationIdentifier,
          oauthHandler: OAuthHandlerEnum.EXTERNAL,
          isIdempotentOperation: false,
        })
      );
    }
  }

  @CachedResponse({
    builder: (command: { subscriberId: string; _environmentId: string }) =>
      buildSubscriberKey({
        _environmentId: command._environmentId,
        subscriberId: command.subscriberId,
      }),
  })
  private async fetchSubscriber({
    subscriberId,
    _environmentId,
  }: {
    subscriberId: string;
    _environmentId: string;
  }): Promise<SubscriberEntity | null> {
    return await this.subscriberRepository.findBySubscriberId(_environmentId, subscriberId, true);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - updatedSubscriber(await this.fetchSubscriber({
        subscriberId: command.subscriberId,
        _environmentId: com...)
Declaraciones 'export' encontradas:
- export class UpdateSubscriber

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-tenant/index.ts
Tamaño: 82 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './update-tenant.command';
export * from './update-tenant.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-tenant/update-tenant.command.ts
Tamaño: 534 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TenantEntity } from '@novu/dal';

import { CustomDataType } from '@novu/shared';
import { IsNotEmpty, IsOptional, IsString } from 'class-validator';

import { EnvironmentWithUserCommand } from '../../commands';

export class UpdateTenantCommand extends EnvironmentWithUserCommand {
  @IsString()
  @IsNotEmpty()
  identifier: string;

  @IsString()
  @IsOptional()
  newIdentifier?: string;

  @IsString()
  @IsOptional()
  name?: string;

  @IsOptional()
  data?: CustomDataType;

  @IsOptional()
  tenant?: TenantEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateTenantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/update-tenant/update-tenant.usecase.ts
Tamaño: 2151 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ConflictException, Injectable } from '@nestjs/common';
import { TenantEntity, TenantRepository } from '@novu/dal';
import { GetTenant, GetTenantCommand } from '../get-tenant';
import { UpdateTenantCommand } from './update-tenant.command';

@Injectable()
export class UpdateTenant {
  constructor(
    private tenantRepository: TenantRepository,
    private getTenantUsecase: GetTenant
  ) {}

  async execute(command: UpdateTenantCommand): Promise<TenantEntity> {
    const tenant =
      command.tenant ??
      (await this.getTenantUsecase.execute(
        GetTenantCommand.create({
          environmentId: command.environmentId,
          organizationId: command.organizationId,
          identifier: command.identifier,
        })
      ));

    const updatePayload: Partial<TenantEntity> = {};

    if (command.name) {
      updatePayload.name = command.name;
    }

    if (command.data) {
      updatePayload.data = command.data;
    }

    if (command?.newIdentifier && command?.newIdentifier !== tenant?.identifier) {
      await this.validateIdentifierDuplication({
        environmentId: command.environmentId,
        identifier: command.newIdentifier,
      });

      updatePayload.identifier = command.newIdentifier;
    }

    await this.tenantRepository.update(
      {
        _environmentId: command.environmentId,
        _organizationId: command.organizationId,
        identifier: command.identifier,
        _id: tenant._id,
      },
      {
        $set: updatePayload,
      }
    );

    return (await this.tenantRepository.findOne({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _id: tenant._id,
    }))!;
  }

  private async validateIdentifierDuplication({
    environmentId,
    identifier,
  }: {
    environmentId: string;
    identifier: string;
  }) {
    const tenantExist = await this.tenantRepository.findOne({
      _environmentId: environmentId,
      identifier,
    });

    if (tenantExist) {
      throw new ConflictException(
        `Tenant with identifier: ${identifier} already exists under environment ${environmentId}`
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpdateTenant

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-control-values/index.ts
Tamaño: 98 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './upsert-control-values.command';
export * from './upsert-control-values.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-control-values/upsert-control-values.command.ts
Tamaño: 582 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ControlValuesLevelEnum } from '@novu/shared';
import { IsEnum, IsNotEmpty, IsObject, IsOptional, IsString } from 'class-validator';
import { EnvironmentCommand } from '../../commands';

export class UpsertControlValuesCommand extends EnvironmentCommand {
  @IsString()
  @IsOptional()
  workflowId?: string;

  @IsString()
  @IsOptional()
  stepId?: string;

  @IsString()
  @IsOptional()
  layoutId?: string;

  @IsEnum(ControlValuesLevelEnum)
  @IsNotEmpty()
  level: ControlValuesLevelEnum;

  @IsObject()
  @IsOptional()
  newControlValues?: Record<string, unknown>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertControlValuesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-control-values/upsert-control-values.usecase.ts
Tamaño: 1805 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';

import { ControlValuesEntity, ControlValuesRepository } from '@novu/dal';
import { ControlValuesLevelEnum } from '@novu/shared';
import { UpsertControlValuesCommand } from './upsert-control-values.command';

@Injectable()
export class UpsertControlValuesUseCase {
  constructor(private controlValuesRepository: ControlValuesRepository) {}

  async execute(command: UpsertControlValuesCommand) {
    const existingControlValues = await this.controlValuesRepository.findFirst({
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _workflowId: command.workflowId,
      _stepId: command.stepId,
      _layoutId: command.layoutId,
      level: command.level,
    });

    if (existingControlValues) {
      return await this.updateControlValues(existingControlValues, command, command.newControlValues);
    }

    return await this.controlValuesRepository.create({
      _organizationId: command.organizationId,
      _environmentId: command.environmentId,
      _workflowId: command.workflowId,
      _stepId: command.stepId,
      _layoutId: command.layoutId,
      level: command.level,
      priority: 0,
      controls: command.newControlValues,
    });
  }

  private async updateControlValues(
    found: ControlValuesEntity,
    command: UpsertControlValuesCommand,
    controlValues: Record<string, unknown>
  ) {
    await this.controlValuesRepository.update(
      {
        _id: found._id,
        _organizationId: command.organizationId,
      },
      {
        priority: 0,
        controls: controlValues,
      }
    );

    return this.controlValuesRepository.findOne({
      _id: found._id,
      _organizationId: command.organizationId,
      _environmentId: command.environmentId,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertControlValuesUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/index.ts
Tamaño: 337 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './upsert-preferences.command';
export * from './upsert-preferences.usecase';
export * from './upsert-subscriber-global-preferences.command';
export * from './upsert-subscriber-workflow-preferences.command';
export * from './upsert-user-workflow-preferences.command';
export * from './upsert-workflow-preferences.command';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-preferences.command.ts
Tamaño: 3615 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ChannelPreference as ChannelPreferenceType,
  ChannelTypeEnum,
  WorkflowPreferences,
  WorkflowPreferencesPartial,
  WorkflowPreference as WorkflowPreferenceType,
} from '@novu/shared';
import { Type } from 'class-transformer';
import { IsBoolean, IsObject, IsOptional, ValidateIf, ValidateNested } from 'class-validator';
import { EnvironmentCommand } from '../../commands';

// PARTIAL PREFERENCES
export class WorkflowPreferencePartial implements Partial<WorkflowPreferenceType> {
  @IsOptional()
  @IsBoolean()
  readonly enabled?: boolean;

  @IsOptional()
  @IsBoolean()
  readonly readOnly?: boolean;
}

export class ChannelPreferencePartial implements Partial<ChannelPreferenceType> {
  @IsOptional()
  @IsBoolean()
  readonly enabled?: boolean;
}

export class ChannelPreferencesPartial implements Partial<Record<ChannelTypeEnum, ChannelPreferencePartial>> {
  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencePartial)
  readonly email?: ChannelPreferencePartial;

  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencePartial)
  readonly sms?: ChannelPreferencePartial;

  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencePartial)
  readonly in_app?: ChannelPreferencePartial;

  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencePartial)
  readonly push?: ChannelPreferencePartial;

  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencePartial)
  readonly chat?: ChannelPreferencePartial;
}

export class PreferencesPartial implements WorkflowPreferencesPartial {
  @IsOptional()
  @IsObject()
  @ValidateNested()
  @Type(() => WorkflowPreferencePartial)
  readonly all?: WorkflowPreferencePartial;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencesPartial)
  readonly channels?: ChannelPreferencesPartial;
}

export class UpsertPreferencesPartialBaseCommand extends EnvironmentCommand {
  @IsObject()
  @ValidateNested()
  @Type(() => PreferencesPartial)
  readonly preferences: PreferencesPartial;
}

// FULL PREFERENCES
export class WorkflowPreferenceRequired implements WorkflowPreferenceType {
  @IsBoolean()
  readonly enabled: boolean;

  @IsBoolean()
  readonly readOnly: boolean;
}

export class ChannelPreferenceRequired implements ChannelPreferenceType {
  @IsBoolean()
  readonly enabled: boolean;
}

export class ChannelPreferencesRequired implements Record<ChannelTypeEnum, ChannelPreferenceRequired> {
  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferenceRequired)
  readonly email: ChannelPreferenceRequired;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferenceRequired)
  readonly sms: ChannelPreferenceRequired;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferenceRequired)
  readonly in_app: ChannelPreferenceRequired;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferenceRequired)
  readonly push: ChannelPreferenceRequired;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferenceRequired)
  readonly chat: ChannelPreferenceRequired;
}

export class PreferencesRequired implements WorkflowPreferences {
  @IsObject()
  @ValidateNested()
  @Type(() => WorkflowPreferenceRequired)
  readonly all: WorkflowPreferenceRequired;

  @IsObject()
  @ValidateNested()
  @Type(() => ChannelPreferencesRequired)
  readonly channels: ChannelPreferencesRequired;
}

export class UpsertPreferencesRequiredBaseCommand extends EnvironmentCommand {
  @IsObject()
  @ValidateNested()
  @Type(() => PreferencesRequired)
  readonly preferences: PreferencesRequired;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowPreferencePartial
- export class ChannelPreferencePartial
- export class ChannelPreferencesPartial
- export class PreferencesPartial
- export class UpsertPreferencesPartialBaseCommand
- export class WorkflowPreferenceRequired
- export class ChannelPreferenceRequired
- export class ChannelPreferencesRequired
- export class PreferencesRequired
- export class UpsertPreferencesRequiredBaseCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-preferences.usecase.ts
Tamaño: 6971 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable } from '@nestjs/common';
import { PreferencesEntity, PreferencesRepository } from '@novu/dal';
import {
  FeatureFlagsKeysEnum,
  PreferencesTypeEnum,
  WorkflowPreferences,
  WorkflowPreferencesPartial,
} from '@novu/shared';
import { Instrument } from '../../instrumentation';
import { FeatureFlagsService } from '../../services/feature-flags/feature-flags.service';
import { deepMerge } from '../../utils';
import { UpsertSubscriberGlobalPreferencesCommand } from './upsert-subscriber-global-preferences.command';
import { UpsertSubscriberWorkflowPreferencesCommand } from './upsert-subscriber-workflow-preferences.command';
import { UpsertUserWorkflowPreferencesCommand } from './upsert-user-workflow-preferences.command';
import { UpsertWorkflowPreferencesCommand } from './upsert-workflow-preferences.command';

export type WorkflowPreferencesFull = Omit<PreferencesEntity, 'preferences'> & {
  preferences: WorkflowPreferences;
};

type UpsertPreferencesCommand = Omit<
  Partial<
    UpsertWorkflowPreferencesCommand &
      UpsertSubscriberGlobalPreferencesCommand &
      UpsertSubscriberWorkflowPreferencesCommand &
      UpsertUserWorkflowPreferencesCommand
  >,
  'preferences'
> & {
  organizationId: string;
  environmentId: string;
  type: PreferencesTypeEnum;
  preferences: WorkflowPreferencesPartial;
};

@Injectable()
export class UpsertPreferences {
  constructor(
    private preferencesRepository: PreferencesRepository,
    private featureFlagsService: FeatureFlagsService
  ) {}

  @Instrument()
  public async upsertWorkflowPreferences(command: UpsertWorkflowPreferencesCommand): Promise<WorkflowPreferencesFull> {
    const result = await this.upsert({
      templateId: command.templateId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      preferences: command.preferences,
      type: PreferencesTypeEnum.WORKFLOW_RESOURCE,
      returnPreference: true,
    });

    return result as WorkflowPreferencesFull;
  }

  @Instrument()
  public async upsertSubscriberGlobalPreferences(command: UpsertSubscriberGlobalPreferencesCommand) {
    await this.deleteSubscriberWorkflowChannelPreferences(command);

    const isSubscribersScheduleEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_SUBSCRIBERS_SCHEDULE_ENABLED,
      defaultValue: false,
      environment: { _id: command.environmentId },
      organization: { _id: command.organizationId },
    });

    return this.upsert({
      _subscriberId: command._subscriberId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      preferences: command.preferences,
      type: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
      returnPreference: command.returnPreference,
      schedule: isSubscribersScheduleEnabled ? command.schedule : undefined,
    });
  }

  private async deleteSubscriberWorkflowChannelPreferences(command: UpsertSubscriberGlobalPreferencesCommand) {
    const channelTypes = Object.keys(command.preferences?.channels || {});

    if (channelTypes.length === 0) {
      // If there are no channels to update, we don't need to run the update query
      return;
    }

    const preferenceUnsetPayload = channelTypes.reduce((acc, channelType) => {
      acc[`preferences.channels.${channelType}`] = '';

      return acc;
    }, {});

    await this.preferencesRepository.update(
      {
        _environmentId: command.environmentId,
        _subscriberId: command._subscriberId,
        type: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
        $or: channelTypes.map((channelType) => ({
          [`preferences.channels.${channelType}`]: { $exists: true },
        })),
      },
      {
        $unset: preferenceUnsetPayload,
      }
    );
  }

  @Instrument()
  public async upsertSubscriberWorkflowPreferences(command: UpsertSubscriberWorkflowPreferencesCommand) {
    return this.upsert({
      _subscriberId: command._subscriberId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      preferences: command.preferences,
      templateId: command.templateId,
      type: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
      returnPreference: command.returnPreference,
    });
  }

  @Instrument()
  public async upsertUserWorkflowPreferences(
    command: UpsertUserWorkflowPreferencesCommand
  ): Promise<WorkflowPreferencesFull> {
    const result = await this.upsert({
      userId: command.userId,
      environmentId: command.environmentId,
      organizationId: command.organizationId,
      preferences: command.preferences,
      templateId: command.templateId,
      type: PreferencesTypeEnum.USER_WORKFLOW,
      returnPreference: true,
    });

    return result as WorkflowPreferencesFull;
  }

  private async upsert(command: UpsertPreferencesCommand): Promise<PreferencesEntity | undefined> {
    const foundPreference = await this.getPreference(command);

    if (foundPreference) {
      return this.updatePreferences(foundPreference, command);
    }

    return this.createPreferences(command);
  }

  private async createPreferences(command: UpsertPreferencesCommand): Promise<PreferencesEntity> {
    return await this.preferencesRepository.create({
      _subscriberId: command._subscriberId,
      _userId: command.userId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _templateId: command.templateId,
      preferences: command.preferences,
      type: command.type,
      schedule: command.schedule,
    });
  }

  private async updatePreferences(
    foundPreference: PreferencesEntity,
    command: UpsertPreferencesCommand
  ): Promise<PreferencesEntity> {
    const mergedPreferences = deepMerge([
      foundPreference.preferences,
      command.preferences as WorkflowPreferencesPartial,
    ]);

    await this.preferencesRepository.update(
      {
        _id: foundPreference._id,
        _environmentId: command.environmentId,
      },
      {
        $set: {
          preferences: mergedPreferences,
          schedule: command.schedule,
          _userId: command.userId,
        },
      }
    );

    if (command.returnPreference) {
      return await this.getPreference(command);
    }

    return undefined;
  }

  private async deletePreferences(command: UpsertPreferencesCommand, preferencesId: string) {
    return await this.preferencesRepository.delete({
      _id: preferencesId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _templateId: command.templateId,
    });
  }

  private async getPreference(command: UpsertPreferencesCommand): Promise<PreferencesEntity | undefined> {
    return await this.preferencesRepository.findOne({
      _subscriberId: command._subscriberId,
      _environmentId: command.environmentId,
      _organizationId: command.organizationId,
      _templateId: command.templateId,
      type: command.type,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - preferenceUnsetPayload(channelTypes.reduce((acc, channelType))
Declaraciones 'export' encontradas:
- export  type
- export class UpsertPreferences

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-subscriber-global-preferences.command.ts
Tamaño: 500 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Schedule } from '@novu/shared';
import { IsBoolean, IsMongoId, IsNotEmpty, IsOptional } from 'class-validator';
import { UpsertPreferencesPartialBaseCommand } from './upsert-preferences.command';

export class UpsertSubscriberGlobalPreferencesCommand extends UpsertPreferencesPartialBaseCommand {
  @IsNotEmpty()
  @IsMongoId()
  readonly _subscriberId: string;

  @IsOptional()
  @IsBoolean()
  readonly returnPreference?: boolean = true;

  @IsOptional()
  readonly schedule?: Schedule;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertSubscriberGlobalPreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-subscriber-workflow-preferences.command.ts
Tamaño: 437 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsBoolean, IsMongoId, IsNotEmpty, IsOptional } from 'class-validator';
import { UpsertSubscriberGlobalPreferencesCommand } from './upsert-subscriber-global-preferences.command';

export class UpsertSubscriberWorkflowPreferencesCommand extends UpsertSubscriberGlobalPreferencesCommand {
  @IsNotEmpty()
  @IsMongoId()
  readonly templateId: string;

  @IsBoolean()
  @IsOptional()
  readonly returnPreference?: boolean = true;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertSubscriberWorkflowPreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-user-workflow-preferences.command.ts
Tamaño: 301 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsMongoId, IsNotEmpty } from 'class-validator';
import { UpsertWorkflowPreferencesCommand } from './upsert-workflow-preferences.command';

export class UpsertUserWorkflowPreferencesCommand extends UpsertWorkflowPreferencesCommand {
  @IsNotEmpty()
  @IsMongoId()
  readonly userId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertUserWorkflowPreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/upsert-preferences/upsert-workflow-preferences.command.ts
Tamaño: 300 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsMongoId, IsNotEmpty } from 'class-validator';
import { UpsertPreferencesRequiredBaseCommand } from './upsert-preferences.command';

export class UpsertWorkflowPreferencesCommand extends UpsertPreferencesRequiredBaseCommand {
  @IsNotEmpty()
  @IsMongoId()
  readonly templateId: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UpsertWorkflowPreferencesCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/workflow/index.ts
Tamaño: 134 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './get-workflow-by-ids/get-workflow-by-ids.command';
export * from './get-workflow-by-ids/get-workflow-by-ids.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/workflow/get-workflow-by-ids/get-workflow-by-ids.command.ts
Tamaño: 457 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClientSession } from '@novu/dal';
import { Exclude } from 'class-transformer';
import { IsDefined, IsOptional, IsString } from 'class-validator';
import { EnvironmentCommand } from '../../../commands';

export class GetWorkflowByIdsCommand extends EnvironmentCommand {
  @IsDefined()
  @IsString()
  workflowIdOrInternalId: string;

  @IsOptional()
  @IsString()
  userId?: string;

  @IsOptional()
  @Exclude()
  session?: ClientSession | null;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetWorkflowByIdsCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/usecases/workflow/get-workflow-by-ids/get-workflow-by-ids.usecase.ts
Tamaño: 1325 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Injectable, NotFoundException } from '@nestjs/common';
import { NotificationTemplateEntity, NotificationTemplateRepository } from '@novu/dal';
import { InstrumentUsecase } from '../../../instrumentation';
import { GetWorkflowByIdsCommand } from './get-workflow-by-ids.command';

@Injectable()
export class GetWorkflowByIdsUseCase {
  constructor(private notificationTemplateRepository: NotificationTemplateRepository) {}

  @InstrumentUsecase()
  async execute(command: GetWorkflowByIdsCommand): Promise<NotificationTemplateEntity> {
    const isInternalId = NotificationTemplateRepository.isInternalId(command.workflowIdOrInternalId);

    let workflowEntity: NotificationTemplateEntity;
    if (isInternalId) {
      workflowEntity = await this.notificationTemplateRepository.findById(
        command.workflowIdOrInternalId,
        command.environmentId,
        command.session
      );
    } else {
      workflowEntity = await this.notificationTemplateRepository.findByTriggerIdentifier(
        command.environmentId,
        command.workflowIdOrInternalId,
        command.session
      );
    }

    if (!workflowEntity) {
      throw new NotFoundException({
        message: 'Workflow cannot be found',
        workflowId: command.workflowIdOrInternalId,
      });
    }

    return workflowEntity;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class GetWorkflowByIdsUseCase

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/bridge.ts
Tamaño: 4018 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DelayOutput,
  DelayRegularOutput,
  DelayTimedOutput,
  DigestOutput,
  DigestRegularOutput,
  DigestTimedOutput,
} from '@novu/framework/internal';
import { DigestTypeEnum } from '@novu/shared';

export function getDigestType(outputs: DigestOutput): DigestTypeEnum {
  if (isTimedOutput(outputs)) {
    return DigestTypeEnum.TIMED;
  } else if (isLookBackDigestOutput(outputs)) {
    return DigestTypeEnum.BACKOFF;
  }

  return DigestTypeEnum.REGULAR;
}

export const isTimedOutput = (
  outputs: DigestOutput | DelayOutput | undefined
): outputs is DigestTimedOutput | DelayTimedOutput => {
  return (outputs as DigestTimedOutput)?.cron != null;
};

export const isLookBackDigestOutput = (outputs: DigestOutput | DelayOutput): outputs is DigestRegularOutput => {
  return (
    (outputs as DigestRegularOutput)?.lookBackWindow?.amount != null &&
    (outputs as DigestRegularOutput)?.lookBackWindow?.unit != null
  );
};

export const isDynamicOutput = (outputs: DelayOutput | undefined): boolean => {
  return (outputs as { dynamicKey?: string })?.dynamicKey != null;
};

export const isRegularOutput = (
  outputs: DigestOutput | DelayOutput
): outputs is DigestRegularOutput | DelayRegularOutput => {
  return !isTimedOutput(outputs) && !isLookBackDigestOutput(outputs) && !isDynamicOutput(outputs);
};

export const BRIDGE_EXECUTION_ERROR = {
  INVALID_BRIDGE_URL: {
    code: 'InvalidBridgeUrl',
    message: (bridgeUrl: string) => `Invalid bridge URL: ${bridgeUrl}`,
  },
  TUNNEL_NOT_FOUND: {
    code: 'TunnelNotFound',
    message: (url: string) =>
      `Unable to establish tunnel connection to \`${url}\`. Run npx novu@latest dev in Local mode, or ensure your Tunnel app deployment is available.`,
  },
  BRIDGE_ENDPOINT_NOT_FOUND: {
    code: 'BridgeEndpointNotFound',
    message: (url: string) =>
      `Could not connect to Bridge Endpoint at \`${url}\`. Make sure you are running your local app server.`,
  },
  BRIDGE_ENDPOINT_UNAVAILABLE: {
    code: 'BridgeEndpointUnavailable',
    message: (url: string) =>
      `Unable to reach Bridge Endpoint at \`${url}\`. Run npx novu@latest dev in Local mode, or ensure your Bridge app deployment is available.`,
  },
  BRIDGE_METHOD_NOT_CONFIGURED: {
    code: 'BridgeMethodNotConfigured',
    message: (url: string) =>
      `Bridge Endpoint at \`${url}\` is not correctly configured. Ensure your \`@novu/framework\` integration exposes the \`POST\`, \`GET\`, and \`OPTIONS\` methods.`,
  },
  BRIDGE_REQUEST_TIMEOUT: {
    code: 'BridgeRequestTimeout',
    message: (url: string) => `Bridge request timeout for \`${url}\``,
  },
  UNSUPPORTED_PROTOCOL: {
    code: 'UnsupportedProtocol',
    message: (url: string) => `Unsupported protocol for \`${url}\``,
  },
  RESPONSE_READ_ERROR: {
    code: 'ResponseReadError',
    message: (url: string) => `Response body could not be read for \`${url}\``,
  },
  REQUEST_UPLOAD_ERROR: {
    code: 'RequestUploadError',
    message: (url: string) => `Error uploading request body for \`${url}\``,
  },
  REQUEST_CACHE_ERROR: {
    code: 'RequestCacheError',
    message: (url: string) => `Error caching request for \`${url}\``,
  },
  MAXIMUM_REDIRECTS_EXCEEDED: {
    code: 'MaximumRedirectsExceeded',
    message: (url: string) => `Maximum redirects exceeded for \`${url}\``,
  },
  SELF_SIGNED_CERTIFICATE: {
    code: 'SelfSignedCertificate',
    message: (url: string) => `Bridge Endpoint can't use a self signed certificate in production environments.`,
  },
  PAYLOAD_TOO_LARGE: {
    code: 'PayloadTooLarge',
    message: (url: string) => `Payload too large for \`${url}\``,
  },
  UNKNOWN_BRIDGE_REQUEST_ERROR: {
    code: 'UnknownBridgeRequestError',
    message: (url: string) => `Unknown bridge request error calling \`${url}\``,
  },
  UNKNOWN_BRIDGE_NON_REQUEST_ERROR: {
    code: 'UnknownBridgeNonRequestError',
    message: (url: string) => `Unknown bridge non-request error calling \`${url}\``,
  },
} satisfies Record<string, { code: string; message: (url: string) => string }>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getDigestType(outputs: DigestOutput)
Asignaciones con arrow functions encontradas (posibles funciones):
 - isTimedOutput(outputs: DigestOutput | DelayOutput | undefined
): outputs is DigestTimedOutput | DelayTimedOutput)
 - isLookBackDigestOutput(outputs: DigestOutput | DelayOutput): outputs is DigestRegularOutput)
 - isDynamicOutput(outputs: DelayOutput | undefined): boolean)
 - isRegularOutput(outputs: DigestOutput | DelayOutput
): outputs is DigestRegularOutput | DelayRegularOutput)
 - BRIDGE_EXECUTION_ERROR({
  INVALID_BRIDGE_URL: {
    code: 'InvalidBridgeUrl',
    message: (bridgeUrl: string))
Declaraciones 'export' encontradas:
- export function getDigestType
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/buildBridgeEndpointUrl.ts
Tamaño: 719 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createHash } from 'crypto';

/*
 * Creates a bridge endpoint url to be used for request from novu cloud to the local
 * workflow definition
 */
export const buildBridgeEndpointUrl = (apiKey: string, baseAddress: string): string => {
  return `${buildBridgeSubdomain(apiKey)}.${baseAddress}`;
};

/*
 * Creates a bridge subdomain based on the apiKey provided. This function is used in several
 * places, including packages/novu/src/commands/init/templates/index.ts when generating the
 * subdomain in the bridge application. Developers should take care to keep changes
 * in sync.
 */
export const buildBridgeSubdomain = (apiKey: string): string => {
  return createHash('md5').update(apiKey).digest('hex');
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - buildBridgeEndpointUrl(apiKey: string, baseAddress: string): string)
 - buildBridgeSubdomain(apiKey: string): string)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/deepmerge.ts
Tamaño: 6485 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

// from: https://github.com/TehShrike/deepmerge/tree/master

function isMergeableObject(value: unknown) {
  return isNonNullObject(value) && !isSpecial(value as Record<string, unknown>);
}

function isNonNullObject(value: unknown) {
  return !!value && typeof value === 'object';
}

function isSpecial(value: Record<string, unknown>) {
  const stringValue = Object.prototype.toString.call(value);

  return stringValue === '[object RegExp]' || stringValue === '[object Date]' || stringValue === '[object Uint8Array]';
}

function emptyTarget(val: unknown) {
  return Array.isArray(val) ? [] : {};
}

function cloneUnlessOtherwiseSpecified(
  value: Record<string, unknown>,
  options: IOptions
): Record<string, unknown> | Record<string, unknown>[] {
  return options.clone !== false && options.isMergeableObject(value)
    ? deepMergeObjects(emptyTarget(value), value, options)
    : value;
}

function defaultArrayMerge(
  target: Record<string, unknown>[],
  source: Record<string, unknown>[],
  options: IOptions
): Record<string, unknown>[] {
  return target
    .concat(source)
    .map((element) => cloneUnlessOtherwiseSpecified(element, options) as Record<string, unknown>);
}

function getMergeFunction(key: string, options: IOptions) {
  if (!options.customMerge) {
    return deepMergeObjects;
  }
  const customMerge = options.customMerge(key);

  return typeof customMerge === 'function' ? customMerge : deepMergeObjects;
}

function getKeys(target: Record<string, unknown>): unknown[] {
  return Object.keys(target);
}

function propertyIsOnObject(object: Record<string, unknown>, property: string) {
  try {
    return property in object;
  } catch (_) {
    return false;
  }
}

// Protects from prototype poisoning and unexpected merging up the prototype chain.
function propertyIsUnsafe(target: Record<string, unknown>, key: string) {
  return (
    propertyIsOnObject(target, key) && // Properties are safe to merge if they don't exist in the target yet,
    !(
      Object.hasOwnProperty.call(target, key) && // unsafe if they exist up the prototype chain,
      Object.propertyIsEnumerable.call(target, key)
    )
  ); // and also unsafe if they're nonenumerable.
}

function mergeObject(
  target: Record<string, unknown>,
  source: Record<string, unknown>,
  options: IOptions
): Record<string, unknown> {
  const destination = {};
  if (options.isMergeableObject(target)) {
    // @ts-ignore
    getKeys(target).forEach((key: string) => {
      destination[key] = cloneUnlessOtherwiseSpecified(target[key] as Record<string, unknown>, options);
    });
  }
  // @ts-ignore
  getKeys(source).forEach((key: string) => {
    if (propertyIsUnsafe(target, key as string)) {
      return;
    }

    if (propertyIsOnObject(target, key as string) && options.isMergeableObject(source[key])) {
      destination[key] = getMergeFunction(key as string, options)(
        target[key] as Record<string, unknown>,
        source[key] as Record<string, unknown>,
        options
      );
    } else {
      destination[key] = cloneUnlessOtherwiseSpecified(source[key] as Record<string, unknown>, options);
    }
  });

  return destination;
}

interface IOptions {
  customMerge: (
    key: string
  ) => (target: Record<string, unknown>, source: Record<string, unknown>, options: IOptions) => Record<string, unknown>;
  arrayMerge: (
    target: Record<string, unknown>[],
    source: Record<string, unknown>[],
    options: IOptions
  ) => Record<string, unknown>[];
  isMergeableObject: (value: unknown) => boolean;
  cloneUnlessOtherwiseSpecified: (
    value: Record<string, unknown>,
    options: IOptions
  ) => Record<string, unknown> | Record<string, unknown>[];
  clone?: boolean;
}

interface IDeepMergeOptions {
  customMerge?: (
    key: string
  ) => (target: Record<string, unknown>, source: Record<string, unknown>, options: IOptions) => Record<string, unknown>;
  arrayMerge?: (
    target: Record<string, unknown>[],
    source: Record<string, unknown>[],
    options: IOptions
  ) => Record<string, unknown>[];
  isMergeableObject?: (value: unknown) => boolean;
  cloneUnlessOtherwiseSpecified?: (
    value: Record<string, unknown>,
    options: IOptions
  ) => Record<string, unknown> | Record<string, unknown>[];
  clone?: boolean;
}

/**
 * Merges two objects or arrays of objects using deepMerge. The second object
 * takes precedence for any keys that are present in both objects.
 * @param source - The source object or array of objects to merge from.
 * @param target - The target object or array of objects to merge into.
 * @param options - The options to pass to deepMerge.
 * @returns The merged object or array of objects.
 */
function deepMergeObjects<T extends Record<string, unknown> | Record<string, unknown>[]>(
  target: Record<string, unknown> | Record<string, unknown>[],
  source: Record<string, unknown> | Record<string, unknown>[],
  options?: IDeepMergeOptions
): T {
  options = options || {};
  options.arrayMerge = options.arrayMerge || defaultArrayMerge;
  options.isMergeableObject = options.isMergeableObject || isMergeableObject;
  /*
   * cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()
   * implementations can use it. The caller may not replace it.
   */
  options.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;

  const sourceIsArray = Array.isArray(source);
  const targetIsArray = Array.isArray(target);
  const sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;

  if (!sourceAndTargetTypesMatch) {
    return cloneUnlessOtherwiseSpecified(source as Record<string, unknown>, options as IOptions) as T;
  }
  if (sourceIsArray) {
    return options.arrayMerge(
      target as Record<string, unknown>[],
      source as Record<string, unknown>[],
      options as IOptions
    ) as T;
  }

  return mergeObject(target as Record<string, unknown>, source, options as IOptions) as T;
}

/**
 * Merges an array of objects using deepMerge. Items later in the array take
 * precedence for any keys that are present in multiple objects.
 *
 * @param array - The array of objects to merge.
 * @param options - The options to pass to deepMerge.
 * @returns The merged object.
 */
export function deepMerge<T extends Record<string, unknown>>(array: T[], options?: IDeepMergeOptions): T {
  if (!Array.isArray(array)) {
    throw new Error('first argument should be an array');
  }

  return array.reduce((prev, next) => deepMergeObjects(prev, next, options), {} as T);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isMergeableObject(value: unknown)
 - isNonNullObject(value: unknown)
 - isSpecial(value: Record<string, unknown>)
 - emptyTarget(val: unknown)
 - cloneUnlessOtherwiseSpecified(value: Record<string, unknown>,
  options: IOptions)
 - defaultArrayMerge(target: Record<string, unknown>[],
  source: Record<string, unknown>[],
  options: IOptions)
 - getMergeFunction(key: string, options: IOptions)
 - getKeys(target: Record<string, unknown>)
 - propertyIsOnObject(object: Record<string, unknown>, property: string)
 - propertyIsUnsafe(target: Record<string, unknown>, key: string)
 - mergeObject(target: Record<string, unknown>,
  source: Record<string, unknown>,
  options: IOptions)
Asignaciones con arrow functions encontradas (posibles funciones):
 - destination({};
  if (options.isMergeableObject(target)) {
    // @ts-ignore
    getKeys(target).forEach((key: s...)
Declaraciones 'export' encontradas:
- export function deepMerge

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/digest.ts
Tamaño: 1500 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JobEntity } from '@novu/dal';
import {
  DelayTypeEnum,
  DigestTypeEnum,
  IDigestBaseMetadata,
  IDigestRegularMetadata,
  JobStatusEnum,
  StepTypeEnum,
} from '@novu/shared';
import { getNestedValue } from './object';

export const isRegularDigest = (type: DigestTypeEnum | DelayTypeEnum) => {
  return type === DigestTypeEnum.REGULAR || type === DigestTypeEnum.BACKOFF;
};

export const isRegularDelay = (type: DelayTypeEnum) => {
  return type === DelayTypeEnum.REGULAR;
};

export const isMainDigest = (type: StepTypeEnum | undefined, status: JobStatusEnum) => {
  return type === StepTypeEnum.DIGEST && status === JobStatusEnum.DELAYED;
};

export function isActionStepType(type: StepTypeEnum) {
  const channels = [StepTypeEnum.DELAY, StepTypeEnum.DIGEST, StepTypeEnum.THROTTLE];

  return channels.find((channel) => channel === type);
}

export function isChannelStepType(type: StepTypeEnum) {
  const channels = [StepTypeEnum.IN_APP, StepTypeEnum.EMAIL, StepTypeEnum.SMS, StepTypeEnum.PUSH, StepTypeEnum.CHAT];

  return channels.find((channel) => channel === type);
}

export function getJobDigest(job: JobEntity): {
  digestMeta: IDigestBaseMetadata | undefined;
  digestKey: string | undefined;
  digestValue: string | undefined;
} {
  const digestMeta = job.digest as IDigestRegularMetadata | undefined;
  const digestKey = digestMeta?.digestKey;
  const digestValue = getNestedValue(job.payload, digestKey);

  return {
    digestKey,
    digestMeta,
    digestValue,
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - isActionStepType(type: StepTypeEnum)
 - isChannelStepType(type: StepTypeEnum)
 - getJobDigest(job: JobEntity)
Asignaciones con arrow functions encontradas (posibles funciones):
 - isRegularDigest(type: DigestTypeEnum | DelayTypeEnum))
 - isRegularDelay(type: DelayTypeEnum))
 - isMainDigest(type: StepTypeEnum | undefined, status: JobStatusEnum))
 - channels([StepTypeEnum.DELAY, StepTypeEnum.DIGEST, StepTypeEnum.THROTTLE];

  return channels.find((channel))
 - channels([StepTypeEnum.IN_APP, StepTypeEnum.EMAIL, StepTypeEnum.SMS, StepTypeEnum.PUSH, StepTypeEnum.CHAT];

...)
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export function isActionStepType
- export function isChannelStepType
- export function getJobDigest

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/duration-utils.spec.ts
Tamaño: 3675 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DurationUtils } from './duration-utils';

describe('DurationUtils', () => {
  describe('isISO8601', () => {
    it('should validate correct ISO-8601 timestamps', () => {
      expect(DurationUtils.isISO8601('2025-01-01T12:00:00Z')).toBe(true);
      expect(DurationUtils.isISO8601('2025-12-31T23:59:59Z')).toBe(true);
      expect(DurationUtils.isISO8601('2025-06-15T08:30:00.123Z')).toBe(true);
      expect(DurationUtils.isISO8601('2025-06-15T08:30:00.12Z')).toBe(true);
      expect(DurationUtils.isISO8601('2025-06-15T08:30:00.1Z')).toBe(true);
      expect(DurationUtils.isISO8601('2025-06-15T08:30:00')).toBe(true);
    });

    it('should reject invalid ISO-8601 formats', () => {
      expect(DurationUtils.isISO8601('2025-01-01')).toBe(false);
      expect(DurationUtils.isISO8601('12:00:00')).toBe(false);
      expect(DurationUtils.isISO8601('invalid-date')).toBe(false);
      expect(DurationUtils.isISO8601('2025/01/01 12:00:00')).toBe(false);
      expect(DurationUtils.isISO8601('2025-13-01T12:00:00Z')).toBe(false);
      expect(DurationUtils.isISO8601('2025-01-32T12:00:00Z')).toBe(false);
    });

    it('should reject invalid dates with correct format', () => {
      expect(DurationUtils.isISO8601('2025-02-30T12:00:00Z')).toBe(false);
    });
  });

  describe('convertToMilliseconds', () => {
    it('should convert seconds to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(5, 'seconds')).toBe(5000);
      expect(DurationUtils.convertToMilliseconds(1, 'seconds')).toBe(1000);
      expect(DurationUtils.convertToMilliseconds(60, 'seconds')).toBe(60000);
    });

    it('should convert minutes to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(1, 'minutes')).toBe(60000);
      expect(DurationUtils.convertToMilliseconds(5, 'minutes')).toBe(300000);
      expect(DurationUtils.convertToMilliseconds(30, 'minutes')).toBe(1800000);
    });

    it('should convert hours to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(1, 'hours')).toBe(3600000);
      expect(DurationUtils.convertToMilliseconds(2, 'hours')).toBe(7200000);
      expect(DurationUtils.convertToMilliseconds(24, 'hours')).toBe(86400000);
    });

    it('should convert days to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(1, 'days')).toBe(86400000);
      expect(DurationUtils.convertToMilliseconds(7, 'days')).toBe(604800000);
    });

    it('should convert weeks to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(1, 'weeks')).toBe(604800000);
      expect(DurationUtils.convertToMilliseconds(2, 'weeks')).toBe(1209600000);
    });

    it('should convert months to milliseconds', () => {
      expect(DurationUtils.convertToMilliseconds(1, 'months')).toBe(2592000000);
      expect(DurationUtils.convertToMilliseconds(3, 'months')).toBe(7776000000);
    });

    it('should throw error for invalid time unit', () => {
      expect(() => DurationUtils.convertToMilliseconds(5, 'invalid')).toThrow('Invalid time unit');
      expect(() => DurationUtils.convertToMilliseconds(5, 'years')).toThrow('Invalid time unit');
      expect(() => DurationUtils.convertToMilliseconds(5, '')).toThrow('Invalid time unit');
    });

    it('should handle decimal amounts correctly', () => {
      expect(DurationUtils.convertToMilliseconds(0.5, 'seconds')).toBe(500);
      expect(DurationUtils.convertToMilliseconds(1.5, 'minutes')).toBe(90000);
    });

    it('should handle zero amount', () => {
      expect(DurationUtils.convertToMilliseconds(0, 'seconds')).toBe(0);
      expect(DurationUtils.convertToMilliseconds(0, 'hours')).toBe(0);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/duration-utils.ts
Tamaño: 793 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class DurationUtils {
  static isISO8601(value: string): boolean {
    const iso8601Regex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{1,3})?Z?$/;
    if (!iso8601Regex.test(value)) {
      return false;
    }

    const date = new Date(value);

    return !Number.isNaN(date.getTime());
  }

  static convertToMilliseconds(amount: number, unit: string): number {
    const unitMap: Record<string, number> = {
      seconds: 1000,
      minutes: 60 * 1000,
      hours: 60 * 60 * 1000,
      days: 24 * 60 * 60 * 1000,
      weeks: 7 * 24 * 60 * 60 * 1000,
      months: 30 * 24 * 60 * 60 * 1000,
    };

    if (!unitMap[unit]) {
      throw new Error(`Invalid time unit '${unit}'. Supported units: ${Object.keys(unitMap).join(', ')}`);
    }

    return amount * unitMap[unit];
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DurationUtils

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/email-normalization.ts
Tamaño: 1089 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

const PLUS_ONLY = /\+.*$/;
const PLUS_AND_DOT = /\.|\+.*$/g;
const normalizableProviders = {
  'gmail.com': {
    cut: PLUS_AND_DOT,
  },
  'googlemail.com': {
    cut: PLUS_AND_DOT,
    aliasOf: 'gmail.com',
  },
  'hotmail.com': {
    cut: PLUS_ONLY,
  },
  'live.com': {
    cut: PLUS_AND_DOT,
  },
  'outlook.com': {
    cut: PLUS_ONLY,
  },
};

export function normalizeEmail(email: string): string {
  if (typeof email !== 'string') {
    throw new TypeError('normalize-email expects a string');
  }

  const lowerCasedEmail = email.toLowerCase();
  const emailParts = lowerCasedEmail.split(/@/);

  if (emailParts.length !== 2) {
    return email;
  }

  let username = emailParts[0];
  let domain = emailParts[1];

  if (normalizableProviders.hasOwnProperty(domain)) {
    if (normalizableProviders[domain].hasOwnProperty('cut')) {
      username = username.replace(normalizableProviders[domain].cut, '');
    }

    if (normalizableProviders[domain].hasOwnProperty('aliasOf')) {
      domain = normalizableProviders[domain].aliasOf;
    }
  }

  return `${username}@${domain}`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - normalizeEmail(email: string)
Declaraciones 'export' encontradas:
- export function normalizeEmail

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/exceptions.ts
Tamaño: 48 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class PlatformException extends Error {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PlatformException

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/filter-processing-details.ts
Tamaño: 1117 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity, TenantEntity } from '@novu/dal';
import type { ContextResolved } from '@novu/framework/internal';
import { ICondition, IMessageFilter, ITriggerPayload } from '@novu/shared';

export interface IFilterVariables {
  payload?: ITriggerPayload;
  subscriber?: SubscriberEntity;
  actor?: SubscriberEntity;
  webhook?: Record<string, unknown>;
  tenant?: TenantEntity;
  context?: ContextResolved;
  step?: {
    digest: boolean;
    events: any[] | undefined;
    total_count: number | undefined;
  };
}

export class FilterProcessingDetails {
  private conditions: ICondition[] = [];
  private filter: IMessageFilter;
  private variables: IFilterVariables;

  addFilter(filter: IMessageFilter, variables: IFilterVariables) {
    this.filter = filter;
    this.variables = variables;
    this.conditions = [];
  }

  addCondition(condition: ICondition) {
    this.conditions.push(condition);
  }

  toObject() {
    return {
      payload: this.variables,
      filter: this.filter,
      conditions: this.conditions,
    };
  }

  toString() {
    return JSON.stringify(this.toObject());
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class FilterProcessingDetails

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/filter.ts
Tamaño: 3517 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FILTER_TO_LABEL, FieldOperatorEnum, IBaseFieldFilterPart, ICondition } from '@novu/shared';
import _ from 'lodash';

import { FilterProcessingDetails, IFilterVariables } from './filter-processing-details';

export abstract class Filter {
  protected processFilterEquality(
    variables: IFilterVariables,
    fieldFilter: IBaseFieldFilterPart,
    filterProcessingDetails: FilterProcessingDetails
  ): boolean {
    const actualValue = _.get(variables, `${fieldFilter.on}.${fieldFilter.field}`);
    const filterValue = this.parseValue(actualValue, fieldFilter.value);
    let result = false;

    switch (fieldFilter.operator) {
      case FieldOperatorEnum.EQUAL:
        result = actualValue === filterValue;

        break;
      case FieldOperatorEnum.NOT_EQUAL:
        result = actualValue !== filterValue;

        break;
      case FieldOperatorEnum.LARGER:
        result = actualValue > filterValue;

        break;
      case FieldOperatorEnum.SMALLER:
        result = actualValue < filterValue;

        break;
      case FieldOperatorEnum.LARGER_EQUAL:
        result = actualValue >= filterValue;

        break;
      case FieldOperatorEnum.SMALLER_EQUAL:
        result = actualValue <= filterValue;

        break;
      case FieldOperatorEnum.NOT_IN:
        result = !actualValue.includes(filterValue);

        break;
      case FieldOperatorEnum.IN:
        result = actualValue.includes(filterValue);

        break;
      case FieldOperatorEnum.IS_DEFINED:
        result = actualValue !== undefined;

        break;
      default:
        break;
    }
    const actualValueString: string = Array.isArray(actualValue) ? JSON.stringify(actualValue) : `${actualValue ?? ''}`;

    filterProcessingDetails.addCondition({
      filter: FILTER_TO_LABEL[fieldFilter.on],
      field: fieldFilter.field,
      expected: `${filterValue}`,
      actual: `${actualValueString}`,
      operator: fieldFilter.operator,
      passed: result,
    });

    return result;
  }

  public static sumFilters(
    summary: {
      filters: string[];
      failedFilters: string[];
      passedFilters: string[];
    },
    condition: ICondition,
    type?: string
  ) {
    if (!type) {
      type = condition.filter;
    }

    type = type?.toLowerCase();

    if (condition.passed && !summary.passedFilters.includes(type)) {
      summary.passedFilters.push(type);
    }

    if (!condition.passed && !summary.failedFilters.includes(type)) {
      summary.failedFilters.push(type);
    }

    if (!summary.filters.includes(type)) {
      summary.filters.push(type);
    }

    return summary;
  }

  private parseValue(originValue, parsingValue) {
    switch (typeof originValue) {
      case 'number':
        return Number(parsingValue);
      case 'string':
        return String(parsingValue);
      case 'boolean':
        return parsingValue === 'true';
      case 'bigint':
        return Number(parsingValue);
      default:
        return parsingValue;
    }
  }

  protected async findAsync<T>(array: T[], predicate: (t: T) => Promise<boolean>): Promise<T | undefined> {
    for (const t of array) {
      if (await predicate(t)) {
        return t;
      }
    }

    return undefined;
  }

  protected async filterAsync<T>(arr: T[], callback: (item: T) => Promise<boolean>): Promise<T[]> {
    const fail = Symbol('Filter Async failure');

    return (await Promise.all(arr.map(async (item) => ((await callback(item)) ? item : fail)))).filter(
      (i) => i !== fail
    ) as T[];
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - fail(Symbol('Filter Async failure');

    return (await Promise.all(arr.map(async (item))
Declaraciones 'export' encontradas:
- export  abstract

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/generate-id.ts
Tamaño: 361 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { customAlphabet } from 'nanoid';
import { generateTimestampHex } from './timestamp-hex';

export const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyz';
const nanoid = customAlphabet(ALPHABET);

export function shortId(length = 4) {
  return nanoid(length);
}

export function generateObjectId() {
  return `${generateTimestampHex()}${shortId(12)}`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - shortId(length = 4)
 - generateObjectId()
Declaraciones 'export' encontradas:
- export  const
- export function shortId
- export function generateObjectId

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/hmac.ts
Tamaño: 537 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import { ContextPayload } from '@novu/shared';
import { canonicalize } from '@tufjs/canonical-json';
import { createHmac } from 'crypto';

export function createHash(key: string, valueToHash: string) {
  Logger.verbose('Creating Hmac');

  return createHmac('sha256', key).update(valueToHash).digest('hex');
}

export function createContextHash(apiKey: string, context: ContextPayload): string {
  const canonicalContext = canonicalize(context);

  return createHash(apiKey, canonicalContext);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createHash(key: string, valueToHash: string)
 - createContextHash(apiKey: string, context: ContextPayload)
Declaraciones 'export' encontradas:
- export function createHash
- export function createContextHash

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/index.ts
Tamaño: 612 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './base62';
export * from './bridge';
export * from './buildBridgeEndpointUrl';
export * from './deepmerge';
export * from './digest';
export * from './duration-utils';
export * from './email-normalization';
export * from './exceptions';
export * from './filter';
export * from './filter-processing-details';
export * from './generate-id';
export * from './hmac';
export * from './novu-integrations';
export * from './object';
export * from './sanitize-control-values';
export * from './subscriber';
export * from './subscribers.utils';
export * from './timestamp-hex';
export * from './variants';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/novu-integrations.ts
Tamaño: 1163 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const areNovuEmailCredentialsSet = () => {
  return (
    typeof process.env.NOVU_EMAIL_INTEGRATION_API_KEY !== 'undefined' &&
    process.env.NOVU_EMAIL_INTEGRATION_API_KEY !== ''
  );
};

export const areNovuSlackCredentialsSet = () => {
  const isClientIdSet =
    typeof process.env.NOVU_SLACK_INTEGRATION_CLIENT_ID !== 'undefined' &&
    process.env.NOVU_SLACK_INTEGRATION_CLIENT_ID !== '';
  const isClientSecretSet =
    typeof process.env.NOVU_SLACK_INTEGRATION_CLIENT_SECRET !== 'undefined' &&
    process.env.NOVU_SLACK_INTEGRATION_CLIENT_SECRET !== '';

  return isClientIdSet && isClientSecretSet;
};

export const areNovuSmsCredentialsSet = () => {
  const isAccountSidSet =
    typeof process.env.NOVU_SMS_INTEGRATION_ACCOUNT_SID !== 'undefined' &&
    process.env.NOVU_SMS_INTEGRATION_ACCOUNT_SID !== '';
  const isTokenSet =
    typeof process.env.NOVU_SMS_INTEGRATION_TOKEN !== 'undefined' && process.env.NOVU_SMS_INTEGRATION_TOKEN !== '';
  const isSenderSet =
    typeof process.env.NOVU_SMS_INTEGRATION_SENDER !== 'undefined' && process.env.NOVU_SMS_INTEGRATION_SENDER !== '';

  return isAccountSidSet && isTokenSet && isSenderSet;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - areNovuEmailCredentialsSet())
 - areNovuSlackCredentialsSet())
 - areNovuSmsCredentialsSet())
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/object.ts
Tamaño: 598 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';

const LOG_CONTEXT = 'GetNestedValue';

export function getNestedValue<ObjectType>(payload: ObjectType, path?: string): ObjectType | undefined {
  if (!path || !payload) {
    return undefined;
  }

  try {
    let result = payload;
    const keys = path.split('.');

    for (const key of keys) {
      if (result === undefined) {
        return undefined;
      }
      result = result[key];
    }

    return result;
  } catch (error) {
    Logger.error(error, 'Failure when parsing digest payload nested key', LOG_CONTEXT);

    return undefined;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export function getNestedValue

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/prettify.type.ts
Tamaño: 143 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type Prettify<T> = {
  [K in keyof T]: T[K];
} & {};

export type PrettifyNested<T> = {
  [K in keyof T]: PrettifyNested<T[K]>;
} & {};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/sanitize-control-values.ts
Tamaño: 10963 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { StepTypeEnum } from '@novu/shared';
import { isEmpty } from 'lodash';
import { PinoLogger } from '../logging';
import {
  ChatControlType,
  DelayControlType,
  DelayDynamicControlType,
  DelayRegularControlType,
  DelayTimedControlType,
  DigestControlSchemaType,
  DigestRegularControlType,
  DigestTimedControlType,
  EmailControlType,
  InAppRedirectType,
  LayoutControlType,
  LookBackWindowType,
  PushControlType,
  SmsControlType,
} from '../schemas/control';
import { InAppActionType, InAppControlType } from '../schemas/control/in-app-control.schema';

// Cast input T_Type to trigger Ajv validation errors - possible undefined
function sanitizeEmptyInput<T_Type>(input: T_Type, defaultValue: T_Type = undefined as unknown as T_Type): T_Type {
  return isEmpty(input) ? defaultValue : input;
}

export function sanitizeRedirect(redirect: InAppRedirectType | undefined) {
  // TODO: There is a bug here, if the redirect doesn't contain both a url and a target it is removed from the new controlValues
  if (!redirect?.url || redirect.url.length === 0 || !redirect?.target) {
    return undefined;
  }

  return {
    url: redirect.url as string,
    target: redirect.target as '_self' | '_blank' | '_parent' | '_top' | '_unfencedTop',
  };
}

function sanitizeAction(action: InAppActionType) {
  // TODO: There is a bug here, if the action doesn't contain both a label and a redirect it is removed from the new controlValues
  if (!action?.label) {
    return undefined;
  }

  return {
    label: action.label as string,
    redirect: sanitizeRedirect(action.redirect) as InAppRedirectType,
  };
}

function sanitizeInApp(controlValues: InAppControlType) {
  const normalized: InAppControlType = {
    subject: sanitizeEmptyInput<string>(controlValues.subject),
    body: sanitizeEmptyInput<string>(controlValues.body),
    avatar: sanitizeEmptyInput<string>(controlValues.avatar),
    primaryAction: undefined,
    secondaryAction: undefined,
    redirect: undefined,
    data: controlValues.data,
    skip: controlValues.skip,
    disableOutputSanitization: controlValues.disableOutputSanitization,
  };

  if (controlValues.primaryAction) {
    normalized.primaryAction = sanitizeAction(controlValues.primaryAction as InAppActionType);
  }

  if (controlValues.secondaryAction) {
    normalized.secondaryAction = sanitizeAction(controlValues.secondaryAction as InAppActionType);
  }

  if (controlValues.redirect) {
    normalized.redirect = sanitizeRedirect(controlValues.redirect as InAppRedirectType);
  }

  return filterNullishValues(normalized);
}

function sanitizeEmail(controlValues: EmailControlType) {
  const EMPTY_TIP_TAP = JSON.stringify({
    type: 'doc',
    content: [{ type: 'paragraph' }],
  });

  const emailControls: EmailControlType = {
    subject: sanitizeEmptyInput(controlValues.subject, ' '),
    body: sanitizeEmptyInput(controlValues.body, EMPTY_TIP_TAP),
    skip: controlValues.skip,
    disableOutputSanitization: controlValues.disableOutputSanitization,
    layoutId: controlValues.layoutId,
  };

  return filterNullishValues(emailControls);
}

function sanitizeSms(controlValues: SmsControlType) {
  const mappedValues: SmsControlType = {
    body: sanitizeEmptyInput(controlValues.body),
    skip: controlValues.skip,
  };

  return filterNullishValues(mappedValues);
}

function sanitizePush(controlValues: PushControlType) {
  const mappedValues: PushControlType = {
    subject: sanitizeEmptyInput(controlValues.subject),
    body: sanitizeEmptyInput(controlValues.body),
    skip: controlValues.skip,
  };

  return filterNullishValues(mappedValues);
}

function sanitizeChat(controlValues: ChatControlType) {
  const mappedValues: ChatControlType = {
    body: sanitizeEmptyInput(controlValues.body),
    skip: controlValues.skip,
  };

  return filterNullishValues(mappedValues);
}

function sanitizeDigest(controlValues: DigestControlSchemaType) {
  if (isTimedDigestControl(controlValues)) {
    const mappedValues: DigestTimedControlType = {
      type: controlValues.type,
      cron: controlValues.cron,
      digestKey: controlValues.digestKey,
      skip: controlValues.skip,
      extendToSchedule: controlValues.extendToSchedule,
    };

    return filterNullishValues(mappedValues);
  }

  if (isRegularDigestControl(controlValues)) {
    const lookBackAmount = (controlValues.lookBackWindow as LookBackWindowType)?.amount;
    const mappedValues: DigestRegularControlType = {
      type: controlValues.type,
      // Cast to trigger Ajv validation errors - possible undefined
      ...(parseAmount(controlValues.amount) as { amount?: number }),
      unit: controlValues.unit,
      digestKey: controlValues.digestKey,
      skip: controlValues.skip,
      lookBackWindow: controlValues.lookBackWindow
        ? {
            // Cast to trigger Ajv validation errors - possible undefined
            ...(parseAmount(lookBackAmount) as { amount?: number }),
            unit: (controlValues.lookBackWindow as LookBackWindowType).unit,
          }
        : undefined,
      extendToSchedule: controlValues.extendToSchedule,
    };

    return filterNullishValues(mappedValues);
  }

  const anyControlValues = controlValues as Record<string, unknown>;
  const lookBackWindow = (anyControlValues.lookBackWindow as LookBackWindowType)?.amount;

  return filterNullishValues({
    // Cast to trigger Ajv validation errors - possible undefined
    ...(parseAmount(anyControlValues.amount) as { amount?: number }),
    unit: anyControlValues.unit,
    digestKey: anyControlValues.digestKey,
    skip: anyControlValues.skip,
    lookBackWindow: anyControlValues.lookBackWindow
      ? {
          // Cast to trigger Ajv validation errors - possible undefined
          ...(parseAmount(lookBackWindow) as { amount?: number }),
          unit: (anyControlValues.lookBackWindow as LookBackWindowType).unit,
        }
      : undefined,
    extendToSchedule: anyControlValues.extendToSchedule,
  });
}

function sanitizeDelay(controlValues: DelayControlType) {
  if (isTimedDelayControl(controlValues)) {
    const mappedValues: DelayTimedControlType = {
      type: controlValues.type,
      cron: controlValues.cron,
      skip: controlValues.skip,
      extendToSchedule: controlValues.extendToSchedule,
    };

    return filterNullishValues(mappedValues);
  }

  if (isDynamicDelayControl(controlValues)) {
    const mappedValues: DelayDynamicControlType = {
      type: controlValues.type,
      dynamicKey: controlValues.dynamicKey,
      skip: controlValues.skip,
      extendToSchedule: controlValues.extendToSchedule,
    };

    return filterNullishValues(mappedValues);
  }

  if (isRegularDelayControl(controlValues)) {
    const mappedValues: DelayRegularControlType = {
      type: controlValues.type,
      // Cast to trigger Ajv validation errors - possible undefined
      ...(parseAmount(controlValues.amount) as { amount?: number }),
      unit: controlValues.unit,
      skip: controlValues.skip,
      extendToSchedule: controlValues.extendToSchedule,
    };

    return filterNullishValues(mappedValues);
  }

  return filterNullishValues(controlValues);
}

function sanitizeLayout(controlValues: LayoutControlType) {
  return {
    email: filterNullishValues({
      body: controlValues.email?.body,
      editorType: controlValues.email?.editorType,
    }),
  };
}

function parseAmount(amount?: unknown) {
  try {
    if (!isNumber(amount)) {
      return {};
    }

    const numberAmount = typeof amount === 'string' ? parseInt(amount, 10) : amount;

    return { amount: numberAmount };
  } catch (error) {
    return amount;
  }
}

function filterNullishValues<T extends Record<string, unknown>>(obj: T): T {
  if (typeof obj === 'object' && obj !== null) {
    return Object.fromEntries(Object.entries(obj).filter(([_, value]) => value !== null && value !== undefined)) as T;
  }

  return obj;
}

export type SanitizationType = StepTypeEnum | 'layout';

/**
 * Sanitizes control values received from client-side forms into a clean minimal object.
 * This function processes potentially invalid form data that may contain default/placeholder values
 * and transforms it into a standardized format suitable for preview generation.
 *
 * @example
 * // Input from form with default values:
 * {
 *   subject: "Hello",
 *   body: null,
 *   unusedField: "test"
 * }
 *
 * // Normalized output:
 * {
 *   subject: "Hello",
 *   body: " "
 * }
 *
 */
export function dashboardSanitizeControlValues(
  logger: PinoLogger,
  controlValues: Record<string, unknown>,
  type?: StepTypeEnum | 'layout'
): (Record<string, unknown> & { skip?: Record<string, unknown> }) | null {
  try {
    if (!controlValues) {
      return null;
    }

    let normalizedValues: Record<string, unknown>;
    switch (type) {
      case StepTypeEnum.IN_APP:
        normalizedValues = sanitizeInApp(controlValues as InAppControlType);
        break;
      case StepTypeEnum.EMAIL:
        normalizedValues = sanitizeEmail(controlValues as EmailControlType);
        break;
      case StepTypeEnum.SMS:
        normalizedValues = sanitizeSms(controlValues as SmsControlType);
        break;
      case StepTypeEnum.PUSH:
        normalizedValues = sanitizePush(controlValues as PushControlType);
        break;
      case StepTypeEnum.CHAT:
        normalizedValues = sanitizeChat(controlValues as ChatControlType);
        break;
      case StepTypeEnum.DIGEST:
        normalizedValues = sanitizeDigest(controlValues as DigestControlSchemaType);
        break;
      case StepTypeEnum.DELAY:
        normalizedValues = sanitizeDelay(controlValues as DelayControlType);
        break;
      case 'layout':
        normalizedValues = sanitizeLayout(controlValues as LayoutControlType);
        break;
      default:
        normalizedValues = filterNullishValues(controlValues);
    }

    return normalizedValues;
  } catch (error) {
    logger.error('Error sanitizing control values', error);

    return controlValues;
  }
}

function isNumber(value: unknown): value is number {
  return !Number.isNaN(Number.parseInt(value as string, 10));
}

function isTimedDigestControl(controlValues: unknown): controlValues is DigestTimedControlType {
  return !isEmpty((controlValues as DigestTimedControlType)?.cron);
}

function isRegularDigestControl(controlValues: unknown): controlValues is DigestRegularControlType {
  return !isTimedDigestControl(controlValues);
}

function isTimedDelayControl(controlValues: unknown): controlValues is DelayTimedControlType {
  return !isEmpty((controlValues as DelayTimedControlType)?.cron);
}

function isDynamicDelayControl(controlValues: unknown): controlValues is DelayDynamicControlType {
  return !isEmpty((controlValues as DelayDynamicControlType)?.dynamicKey);
}

function isRegularDelayControl(controlValues: unknown): controlValues is DelayRegularControlType {
  return !isTimedDelayControl(controlValues) && !isDynamicDelayControl(controlValues);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - sanitizeRedirect(redirect: InAppRedirectType | undefined)
 - sanitizeAction(action: InAppActionType)
 - sanitizeInApp(controlValues: InAppControlType)
 - sanitizeEmail(controlValues: EmailControlType)
 - sanitizeSms(controlValues: SmsControlType)
 - sanitizePush(controlValues: PushControlType)
 - sanitizeChat(controlValues: ChatControlType)
 - sanitizeDigest(controlValues: DigestControlSchemaType)
 - sanitizeDelay(controlValues: DelayControlType)
 - sanitizeLayout(controlValues: LayoutControlType)
 - parseAmount(amount?: unknown)
 - dashboardSanitizeControlValues(logger: PinoLogger,
  controlValues: Record<string, unknown>,
  type?: StepTypeEnum | 'layout')
 - isNumber(value: unknown)
 - isTimedDigestControl(controlValues: unknown)
 - isRegularDigestControl(controlValues: unknown)
 - isTimedDelayControl(controlValues: unknown)
 - isDynamicDelayControl(controlValues: unknown)
 - isRegularDelayControl(controlValues: unknown)
Declaraciones 'export' encontradas:
- export function sanitizeRedirect
- export  type
- export function dashboardSanitizeControlValues

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/subscriber.ts
Tamaño: 984 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SubscriberEntity } from '@novu/dal';
import { isEqual } from 'lodash';

export function subscriberNeedUpdate(
  subscriber: SubscriberEntity,
  subscriberPayload: Partial<Omit<SubscriberEntity, 'channels'>>
): boolean {
  return (
    !!(
      (subscriberPayload?.email && subscriber?.email !== subscriberPayload?.email) ||
      (subscriber?.email !== undefined && subscriber?.email !== subscriberPayload?.email)
    ) ||
    !!(subscriberPayload?.firstName && subscriber?.firstName !== subscriberPayload?.firstName) ||
    !!(subscriberPayload?.lastName && subscriber?.lastName !== subscriberPayload?.lastName) ||
    !!(subscriberPayload?.phone && subscriber?.phone !== subscriberPayload?.phone) ||
    !!(subscriberPayload?.avatar && subscriber?.avatar !== subscriberPayload?.avatar) ||
    !!(subscriberPayload?.locale && subscriber?.locale !== subscriberPayload?.locale) ||
    !!(subscriberPayload?.data && !isEqual(subscriber?.data, subscriberPayload?.data))
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - subscriberNeedUpdate(subscriber: SubscriberEntity,
  subscriberPayload: Partial<Omit<SubscriberEntity, 'channels'>>)
Declaraciones 'export' encontradas:
- export function subscriberNeedUpdate

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/subscribers.utils.ts
Tamaño: 1694 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { TopicEntity } from '@novu/dal';
import { ISubscribersDefine, SubscriberSourceEnum } from '@novu/shared';
import { IProcessSubscriberBulkJobDto } from '../dtos';
import { BaseTriggerCommand } from '../usecases/trigger-base/trigger-base.usecase';

export function mapSubscribersToJobs(
  subscriberSource: SubscriberSourceEnum,
  subscribers: { subscriberId: string; topics?: Pick<TopicEntity, '_id' | 'key'>[] }[] | ISubscribersDefine[],
  command: BaseTriggerCommand
): IProcessSubscriberBulkJobDto[] {
  return subscribers.map((subscriber) => {
    const job: IProcessSubscriberBulkJobDto = {
      name: command.transactionId + subscriber.subscriberId,
      data: {
        environmentId: command.environmentId,
        organizationId: command.organizationId,
        userId: command.userId,
        transactionId: command.transactionId,
        requestId: command.requestId,
        identifier: command.identifier,
        payload: command.payload,
        overrides: command.overrides,
        subscriber,
        topics: subscriber.topics,
        templateId: command.template._id,
        _subscriberSource: subscriberSource,
        requestCategory: command.requestCategory,
        controls: command.controls,
        bridge: {
          url: command.bridgeUrl,
          workflow: command.bridgeWorkflow,
        },
        environmentName: command.environmentName,
      },
      groupId: command.organizationId,
    };

    if (command.actor) {
      job.data.actor = command.actor;
    }
    if (command.tenant) {
      job.data.tenant = command.tenant;
    }
    if (command.contextKeys) {
      job.data.contextKeys = command.contextKeys;
    }

    return job;
  });
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - mapSubscribersToJobs(subscriberSource: SubscriberSourceEnum,
  subscribers: { subscriberId: string; topics?: Pick<TopicEntity, '_id' | 'key'>[] }[] | ISubscribersDefine[],
  command: BaseTriggerCommand)
Declaraciones 'export' encontradas:
- export function mapSubscribersToJobs

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/timestamp-hex.ts
Tamaño: 298 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

// Converts current timestamp to 4-byte hexadecimal string
export function generateTimestampHex() {
  const date = new Date();
  const timeInSeconds = Math.floor(date.getTime() / 1000);
  const buffer = Buffer.alloc(4);
  buffer.writeUInt32BE(timeInSeconds, 0);

  return buffer.toString('hex');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - generateTimestampHex()
Declaraciones 'export' encontradas:
- export function generateTimestampHex

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/base62/base.ts
Tamaño: 4262 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/* cspell:disable */

/*
 * base-x encoding / decoding
 * Copyright (c) 2018 base-x contributors
 * Copyright (c) 2014-2018 The Bitcoin Core developers (base58.cpp)
 * Distributed under the MIT software license, see the accompanying
 * file LICENSE or http://www.opensource.org/licenses/mit-license.php.
 * "version": "5.0.0",
 */

export function base(ALPHABET) {
  if (ALPHABET.length >= 255) {
    throw new TypeError('Alphabet too long');
  }
  const BASE_MAP = new Uint8Array(256);
  for (let j = 0; j < BASE_MAP.length; j++) {
    BASE_MAP[j] = 255;
  }
  for (let i = 0; i < ALPHABET.length; i++) {
    const x = ALPHABET.charAt(i);
    const xc = x.charCodeAt(0);
    if (BASE_MAP[xc] !== 255) {
      throw new TypeError(`${x} is ambiguous`);
    }
    BASE_MAP[xc] = i;
  }
  const BASE = ALPHABET.length;
  const LEADER = ALPHABET.charAt(0);
  const FACTOR = Math.log(BASE) / Math.log(256); // log(BASE) / log(256), rounded up
  const iFACTOR = Math.log(256) / Math.log(BASE); // log(256) / log(BASE), rounded up
  function encode(source) {
    if (source instanceof Uint8Array) {
    } else if (ArrayBuffer.isView(source)) {
      source = new Uint8Array(source.buffer, source.byteOffset, source.byteLength);
    } else if (Array.isArray(source)) {
      source = Uint8Array.from(source);
    }
    if (!(source instanceof Uint8Array)) {
      throw new TypeError('Expected Uint8Array');
    }
    if (source.length === 0) {
      return '';
    }
    // Skip & count leading zeroes.
    let zeroes = 0;
    let length = 0;
    let pbegin = 0;
    const pend = source.length;
    while (pbegin !== pend && source[pbegin] === 0) {
      pbegin++;
      zeroes++;
    }
    // Allocate enough space in big-endian base58 representation.
    const size = ((pend - pbegin) * iFACTOR + 1) >>> 0;
    const b58 = new Uint8Array(size);
    // Process the bytes.
    while (pbegin !== pend) {
      let carry = source[pbegin];
      // Apply "b58 = b58 * 256 + ch".
      let i = 0;
      for (let it1 = size - 1; (carry !== 0 || i < length) && it1 !== -1; it1--, i++) {
        carry += (256 * b58[it1]) >>> 0;
        b58[it1] = (carry % BASE) >>> 0;
        carry = (carry / BASE) >>> 0;
      }
      if (carry !== 0) {
        throw new Error('Non-zero carry');
      }
      length = i;
      pbegin++;
    }
    // Skip leading zeroes in base58 result.
    let it2 = size - length;
    while (it2 !== size && b58[it2] === 0) {
      it2++;
    }
    // Translate the result into a string.
    let str = LEADER.repeat(zeroes);
    for (; it2 < size; ++it2) {
      str += ALPHABET.charAt(b58[it2]);
    }

    return str;
  }
  function decodeUnsafe(source) {
    if (typeof source !== 'string') {
      throw new TypeError('Expected String');
    }
    if (source.length === 0) {
      return new Uint8Array();
    }
    let psz = 0;
    // Skip and count leading '1's.
    let zeroes = 0;
    let length = 0;
    while (source[psz] === LEADER) {
      zeroes++;
      psz++;
    }
    // Allocate enough space in big-endian base256 representation.
    const size = ((source.length - psz) * FACTOR + 1) >>> 0; // log(58) / log(256), rounded up.
    const b256 = new Uint8Array(size);
    // Process the characters.
    while (psz < source.length) {
      // Decode character
      let carry = BASE_MAP[source.charCodeAt(psz)];
      // Invalid character
      if (carry === 255) {
        return;
      }
      let i = 0;
      for (let it3 = size - 1; (carry !== 0 || i < length) && it3 !== -1; it3--, i++) {
        carry += (BASE * b256[it3]) >>> 0;
        b256[it3] = (carry % 256) >>> 0;
        carry = (carry / 256) >>> 0;
      }
      if (carry !== 0) {
        throw new Error('Non-zero carry');
      }
      length = i;
      psz++;
    }
    // Skip leading zeroes in b256.
    let it4 = size - length;
    while (it4 !== size && b256[it4] === 0) {
      it4++;
    }
    const vch = new Uint8Array(zeroes + (size - it4));
    let j = zeroes;
    while (it4 !== size) {
      vch[j++] = b256[it4++];
    }

    return vch;
  }
  function decode(string) {
    const buffer = decodeUnsafe(string);
    if (buffer) {
      return buffer;
    }
    throw new Error(`Non-base${BASE} character`);
  }

  return {
    encode,
    decode,
  };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - base(ALPHABET)
 - encode(source)
 - decodeUnsafe(source)
 - decode(string)
Declaraciones 'export' encontradas:
- export function base

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/base62/base62-alphabet.const.ts
Tamaño: 210 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * Base62 alphabet
 * Modifying this alphabet is prohibited as it would invalidate existing encoded data
 */
export const BASE62_ALPHABET = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/base62/base62.ts
Tamaño: 471 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { base } from './base';
import { BASE62_ALPHABET } from './base62-alphabet.const';

const { encode, decode } = base(BASE62_ALPHABET);
const ENCODING = 'hex' satisfies BufferEncoding;

export function encodeBase62(value: string): string {
  const buffer = Buffer.from(value, ENCODING);

  return encode(buffer);
}

export function decodeBase62(encoded: string): string {
  const uint8Array = decode(encoded);

  return Buffer.from(uint8Array).toString(ENCODING);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - encodeBase62(value: string)
 - decodeBase62(encoded: string)
Declaraciones 'export' encontradas:
- export function encodeBase62
- export function decodeBase62

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/base62/index.ts
Tamaño: 26 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './base62';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/variants/index.ts
Tamaño: 77 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './isVariantEmpty';
export * from './normalizeVariantDefault';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/variants/isVariantEmpty.spec.ts
Tamaño: 2301 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FieldLogicalOperatorEnum, FieldOperatorEnum, FilterPartTypeEnum } from '@novu/shared';
import { expect } from 'chai';
import { MessageFilter } from '../../value-objects/message.filter';
import { NotificationStepVariantCommand } from '../../value-objects/notification-step-variant.command';
import { isVariantEmpty } from './isVariantEmpty';

const testFilter: MessageFilter = {
  value: FieldLogicalOperatorEnum.AND,
  children: [
    {
      field: 'test',
      value: 'test',
      on: FilterPartTypeEnum.PAYLOAD,
      operator: FieldOperatorEnum.LARGER,
    },
  ],
};

describe('isVariantEmpty', () => {
  it('should return true for an empty variant', () => {
    const emptyVariant: NotificationStepVariantCommand = {};
    const result = isVariantEmpty(emptyVariant);
    expect(result).to.be.true;
  });

  it('should return true for a variant with empty filters', () => {
    const variantWithEmptyFilters: NotificationStepVariantCommand = {
      filters: [],
    };
    const result = isVariantEmpty(variantWithEmptyFilters);
    expect(result).to.be.true;
  });

  it('should return true for a variant with filters containing empty children', () => {
    const variantWithEmptyChildren: NotificationStepVariantCommand = {
      filters: [{ children: [] }, { children: [] }] as unknown as MessageFilter[],
    };
    const result = isVariantEmpty(variantWithEmptyChildren);
    expect(result).to.be.true;
  });

  it('should return false for a variant with non-empty filters', () => {
    const nonEmptyVariant: NotificationStepVariantCommand = {
      filters: [testFilter],
    };
    const result = isVariantEmpty(nonEmptyVariant);
    expect(result).to.be.false;
  });

  it('should return false for a variant with one or more non-empty child in filters', () => {
    const variantWithNonEmptyChildren: NotificationStepVariantCommand = {
      filters: [testFilter, { children: [] } as unknown as MessageFilter],
    };
    const result = isVariantEmpty(variantWithNonEmptyChildren);
    expect(result).to.be.false;
  });

  it('should return true for a variant with undefined filters', () => {
    const variantWithUndefinedFilters: NotificationStepVariantCommand = {};
    const result = isVariantEmpty(variantWithUndefinedFilters);
    expect(result).to.be.true;
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - MessageFilter({
  value: FieldLogicalOperatorEnum.AND,
  children: [
    {
      field: 'test',
      value: 'test...)
 - result(isVariantEmpty(emptyVariant);
    expect(result).to.be.true;
  });

  it('should return true for a v...)
 - result(isVariantEmpty(variantWithEmptyFilters);
    expect(result).to.be.true;
  });

  it('should return t...)
 - result(isVariantEmpty(variantWithEmptyChildren);
    expect(result).to.be.true;
  });

  it('should return ...)
 - result(isVariantEmpty(nonEmptyVariant);
    expect(result).to.be.false;
  });

  it('should return false fo...)
 - result(isVariantEmpty(variantWithNonEmptyChildren);
    expect(result).to.be.false;
  });

  it('should ret...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/variants/isVariantEmpty.ts
Tamaño: 324 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NotificationStepVariantCommand } from '../../value-objects/notification-step-variant.command';

/** determine if the variant has no filters / conditions */
export const isVariantEmpty = (variant: NotificationStepVariantCommand): boolean => {
  return !variant.filters?.some((filter) => filter.children?.length);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - isVariantEmpty(variant: NotificationStepVariantCommand): boolean)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/utils/variants/normalizeVariantDefault.ts
Tamaño: 261 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ITemplateVariable } from '@novu/shared';

export const normalizeVariantDefault = (items: ITemplateVariable[]) => {
  return items.map((item) => {
    if (item.defaultValue === '') {
      item.defaultValue = undefined;
    }

    return item;
  });
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - normalizeVariantDefault(items: ITemplateVariable[]))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/content.issue.ts
Tamaño: 293 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ContentIssueEnum } from '@novu/shared';
import { IsEnum, IsOptional, IsString } from 'class-validator';

export class ContentIssue {
  @IsOptional()
  @IsString()
  variableName?: string;

  @IsString()
  message: string;

  @IsEnum(ContentIssueEnum)
  issueType: ContentIssueEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ContentIssue

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/i-step.control.ts
Tamaño: 101 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JSONSchema } from './json-schema';

export interface IStepControl {
  schema: JSONSchema;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/index.ts
Tamaño: 283 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './content.issue';
export * from './i-step.control';
export * from './json-schema';
export * from './message.filter';
export * from './notification.step';
export * from './notification-step-variant.command';
export * from './step.issue';
export * from './step.issues';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/json-schema.ts
Tamaño: 1033 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { JsonSchemaFormatEnum, JsonSchemaTypeEnum } from '@novu/dal';

export class JSONSchema {
  type?: JsonSchemaTypeEnum;
  format?: JsonSchemaFormatEnum;
  title?: string;
  description?: string;
  default?: any;
  const?: any;
  minimum?: number;
  maximum?: number;
  exclusiveMinimum?: boolean;
  exclusiveMaximum?: boolean;
  minLength?: number;
  maxLength?: number;
  pattern?: string;
  minItems?: number;
  maxItems?: number;
  uniqueItems?: boolean;
  items?: JSONSchema;
  required?: string[];
  properties?: Record<string, JSONSchema>;
  additionalProperties?: JSONSchema | boolean;
  enum?: any[];
  allOf?: JSONSchema[];
  anyOf?: JSONSchema[];
  oneOf?: JSONSchema[];
  not?: JSONSchema;
  if?: JSONSchema;
  then?: JSONSchema;
  else?: JSONSchema;
  contentEncoding?: string;
  contentMediaType?: string;
  dependentRequired?: Record<string, string[]>;
  dependentSchemas?: Record<string, JSONSchema>;
  $schema?: string;
  $id?: string;
  contentSchema?: JSONSchema;
  examples?: any[];
  multipleOf?: number;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class JSONSchema

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/message.filter.ts
Tamaño: 317 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BuilderFieldType, BuilderGroupValues, FilterParts } from '@novu/shared';
import { IsArray, IsString } from 'class-validator';

export class MessageFilter {
  isNegated?: boolean;

  @IsString()
  type?: BuilderFieldType;

  @IsString()
  value: BuilderGroupValues;

  @IsArray()
  children: FilterParts[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MessageFilter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/notification-step-variant.command.ts
Tamaño: 1170 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IStepVariant, IWorkflowStepMetadata } from '@novu/shared';
import { Type } from 'class-transformer';
import { IsArray, IsBoolean, IsMongoId, IsObject, IsOptional, IsString, ValidateNested } from 'class-validator';
import { IStepControl } from './i-step.control';
import { MessageFilter } from './message.filter';
import { StepIssues } from './step.issues';

export class NotificationStepVariantCommand implements IStepVariant {
  @IsString()
  @IsOptional()
  _templateId?: string;

  @ValidateNested()
  @IsOptional()
  template?: any;

  @IsOptional()
  uuid?: string;

  @IsOptional()
  name?: string;

  @IsBoolean()
  active?: boolean;

  @IsBoolean()
  shouldStopOnFail?: boolean;

  @ValidateNested()
  @IsOptional()
  replyCallback?: {
    active: boolean;
    url: string;
  };

  @IsOptional()
  @IsArray()
  @ValidateNested()
  filters?: MessageFilter[];

  @IsMongoId()
  @IsOptional()
  _id?: string;

  @IsOptional()
  metadata?: IWorkflowStepMetadata;

  @IsOptional()
  output?: IStepControl;

  @IsOptional()
  stepId?: string;

  @IsOptional()
  @IsObject()
  @ValidateNested({ each: true })
  @Type(() => StepIssues)
  issues?: StepIssues;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationStepVariantCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/notification.step.ts
Tamaño: 327 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IsArray, IsOptional, ValidateNested } from 'class-validator';
import { NotificationStepVariantCommand } from './notification-step-variant.command';

export class NotificationStep extends NotificationStepVariantCommand {
  @IsOptional()
  @IsArray()
  @ValidateNested()
  variants?: NotificationStepVariantCommand[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationStep

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/step.issue.ts
Tamaño: 395 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ContentIssueEnum, IntegrationIssueEnum } from '@novu/shared';
import { IsEnum, IsOptional, IsString } from 'class-validator';

export class StepIssue {
  @IsEnum([...Object.values(ContentIssueEnum), ...Object.values(IntegrationIssueEnum)])
  issueType: ContentIssueEnum | IntegrationIssueEnum;

  @IsOptional()
  @IsString()
  variableName?: string;

  @IsString()
  message: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StepIssue

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/value-objects/step.issues.ts
Tamaño: 535 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { RuntimeIssue, StepCreateAndUpdateKeys } from '@novu/shared';
import { Type } from 'class-transformer';
import { IsObject, IsOptional, ValidateNested } from 'class-validator';
import { StepIssue } from './step.issue';

export class StepIssues {
  @IsOptional()
  @IsObject()
  @ValidateNested({ each: true })
  @Type(() => StepIssue)
  body?: Record<StepCreateAndUpdateKeys, StepIssue>;

  @IsOptional()
  @IsObject()
  @ValidateNested({ each: true })
  @Type(() => RuntimeIssue)
  controls?: Record<string, RuntimeIssue[]>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class StepIssues

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/index.ts
Tamaño: 132 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './dtos';
export * from './mappers';
export * from './services';
export * from './usecases';
export * from './utils';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/dtos/index.ts
Tamaño: 87 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './message-webhook.response.dto';
export * from './webhook-payload.dto';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/dtos/message-webhook.response.dto.ts
Tamaño: 728 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageEntity } from '@novu/dal';
import { ChannelData } from '@novu/stateless';

export type MessageWebhookResponseDto = Pick<
  MessageEntity,
  | '_id'
  | '_templateId'
  | '_environmentId'
  | '_organizationId'
  | '_notificationId'
  | 'actorSubscriber'
  | 'templateIdentifier'
  | 'createdAt'
  | 'updatedAt'
  | 'archivedAt'
  | 'archived'
  | 'transactionId'
  | 'channel'
  | 'seen'
  | 'read'
  | 'snoozedUntil'
  | 'deliveredAt'
  | 'providerId'
  | 'lastSeenDate'
  | 'firstSeenDate'
  | 'lastReadDate'
  | 'status'
  | 'errorId'
  | 'errorText'
  | 'contextKeys'
> & {
  providerResponseId?: string;
  deviceToken?: string;
  webhookUrl?: string;
  channelData?: ChannelData;
  subscriberId?: string;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/dtos/webhook-payload.dto.ts
Tamaño: 854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiProperty } from '@nestjs/swagger';
import { WebhookEventEnum, WebhookObjectTypeEnum } from '@novu/shared';

export class WrapperDto<T> {
  @ApiProperty({
    description: 'The id of the webhook event',
    type: 'string',
  })
  id: string;

  @ApiProperty({
    description: 'The type of the webhook',
    enum: WebhookEventEnum,
  })
  type: WebhookEventEnum;

  @ApiProperty({
    description: 'The payload of the webhook',
    type: 'object',
  })
  data: T;

  @ApiProperty({
    description: 'The timestamp of the webhook',
    type: 'string',
  })
  timestamp: string;

  @ApiProperty({
    description: 'The environment connected to the webhook',
    type: 'string',
  })
  environmentId: string;

  @ApiProperty({
    description: 'The object of the webhook',
    enum: WebhookObjectTypeEnum,
  })
  object: WebhookObjectTypeEnum;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WrapperDto

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/mappers/index.ts
Tamaño: 34 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './message.mapper';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/mappers/message.mapper.ts
Tamaño: 2077 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MessageEntity } from '@novu/dal';
import { ChannelData } from '@novu/stateless';
import { MessageWebhookResponseDto } from '../dtos';

export const messageWebhookMapper = (
  message: Pick<
    MessageEntity,
    | '_id'
    | '_templateId'
    | '_environmentId'
    | '_organizationId'
    | '_notificationId'
    | 'actorSubscriber'
    | 'templateIdentifier'
    | 'createdAt'
    | 'updatedAt'
    | 'archivedAt'
    | 'archived'
    | 'transactionId'
    | 'channel'
    | 'seen'
    | 'read'
    | 'snoozedUntil'
    | 'deliveredAt'
    | 'providerId'
    | 'lastSeenDate'
    | 'firstSeenDate'
    | 'lastReadDate'
    | 'status'
    | 'errorId'
    | 'errorText'
    | 'contextKeys'
  >,
  subscriberId: string,
  context?: {
    providerResponseId?: string;
    deviceToken?: string;
    /**
     * @deprecated use channelData instead
     */
    webhookUrl?: string;
    channelData?: ChannelData;
  }
): MessageWebhookResponseDto => {
  return {
    _id: message._id,
    _templateId: message._templateId,
    _environmentId: message._environmentId,
    _organizationId: message._organizationId,
    _notificationId: message._notificationId,
    subscriberId,
    actorSubscriber: message.actorSubscriber,
    templateIdentifier: message.templateIdentifier,
    createdAt: message.createdAt,
    updatedAt: message.updatedAt,
    archivedAt: message.archivedAt,
    archived: message.archived,
    transactionId: message.transactionId,
    channel: message.channel,
    seen: message.seen,
    read: message.read,
    snoozedUntil: message.snoozedUntil,
    deliveredAt: message.deliveredAt,
    providerId: message.providerId,
    lastSeenDate: message.lastSeenDate,
    firstSeenDate: message.firstSeenDate,
    lastReadDate: message.lastReadDate,
    status: message.status,
    errorId: message.errorId,
    errorText: message.errorText,
    deviceToken: context?.deviceToken,
    webhookUrl: context?.webhookUrl,
    channelData: context?.channelData,
    providerResponseId: context?.providerResponseId,
    contextKeys: message.contextKeys,
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - messageWebhookMapper(message: Pick<
    MessageEntity,
    | '_id'
    | '_templateId'
    | '_environmentId'
    | '_org...)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/services/index.ts
Tamaño: 41 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './svix-provider.service';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/services/svix-provider.service.ts
Tamaño: 421 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Provider } from '@nestjs/common';
// biome-ignore lint/style/noRestrictedImports: <explanation>
import { Svix } from 'svix';

export type SvixClient = Svix | null;

export const SvixProviderService: Provider<SvixClient> = {
  provide: 'SVIX_CLIENT',
  useFactory: (): SvixClient => {
    const apiKey = process.env.SVIX_API_KEY;

    if (!apiKey) {
      return null;
    }

    return new Svix(apiKey);
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/usecases/index.ts
Tamaño: 40 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './send-webhook-message';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/usecases/send-webhook-message/index.ts
Tamaño: 96 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './send-webhook-message.command';
export * from './send-webhook-message.usecase';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/usecases/send-webhook-message/send-webhook-message.command.ts
Tamaño: 860 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentEntity } from '@novu/dal';
import { WebhookEventEnum, WebhookObjectTypeEnum } from '@novu/shared';
import { IsDefined, IsEnum, IsOptional } from 'class-validator';
import { EnvironmentCommand } from '../../../commands/project.command';

export class SendWebhookMessageCommand extends EnvironmentCommand {
  @IsEnum(WebhookEventEnum)
  eventType: WebhookEventEnum;

  @IsDefined()
  @IsEnum(WebhookObjectTypeEnum)
  objectType: WebhookObjectTypeEnum;

  // todo: investigate if we can create generic type that depends on the objectType, (e.g. map objectType to WebhookMessageSentDto, WebhookMessageFailedDto, etc.)
  @IsDefined()
  payload: {
    object: Record<string, unknown>;
    previousObject?: Record<string, unknown>;
    [key: string]: Record<string, unknown> | undefined;
  };

  @IsOptional()
  environment?: EnvironmentEntity;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendWebhookMessageCommand

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/usecases/send-webhook-message/send-webhook-message.usecase.ts
Tamaño: 3113 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject, Injectable, Optional } from '@nestjs/common';
import { EnvironmentRepository } from '@novu/dal';
import { FeatureFlagsKeysEnum } from '@novu/shared';
import { PinoLogger } from 'nestjs-pino';
import { InstrumentUsecase } from '../../../instrumentation';
import { FeatureFlagsService } from '../../../services/feature-flags';
import { generateObjectId } from '../../../utils';
import { WrapperDto } from '../../dtos/webhook-payload.dto';
import { SvixClient } from '../../services';
import { SendWebhookMessageCommand } from './send-webhook-message.command';

@Injectable()
export class SendWebhookMessage {
  constructor(
    @Optional() @Inject('SVIX_CLIENT') private readonly svix: SvixClient | undefined,
    private logger: PinoLogger,
    private environmentRepository: EnvironmentRepository,
    private featureFlagsService: FeatureFlagsService
  ) {
    this.logger.setContext(this.constructor.name);
  }

  @InstrumentUsecase()
  async execute(command: SendWebhookMessageCommand): Promise<{ eventId: string } | undefined> {
    const isOutboundWebhooksEnabled = await this.featureFlagsService.getFlag({
      key: FeatureFlagsKeysEnum.IS_OUTBOUND_WEBHOOKS_ENABLED,
      defaultValue: true,
      environment: { _id: command.environmentId },
      organization: { _id: command.organizationId },
    });

    if (!isOutboundWebhooksEnabled) {
      this.logger.debug('Outbound webhooks are disabled via feature flag.');

      return;
    }

    if (!this.svix) {
      this.logger.debug('Svix client not available – webhooks are disabled for this instance.');

      return;
    }

    const environment =
      command.environment ||
      (await this.environmentRepository.findOne(
        {
          _id: command.environmentId,
        },
        'webhookAppId identifier'
      ));

    if (!environment) {
      throw new Error(`Environment not found for id ${command.environmentId}`);
    }

    const appId = environment.webhookAppId;

    if (!appId) {
      this.logger.debug(`Webhook app ID not found for environment ${command.environmentId}`);

      return;
    }

    const eventId = `evt_${generateObjectId()}`;

    const webhookPayload: WrapperDto<any> = {
      id: eventId,
      type: command.eventType,
      object: command.objectType,
      data: command.payload,
      timestamp: new Date().toISOString(),
      environmentId: environment.identifier,
    };

    try {
      this.logger.debug(
        `Attempting to send webhook ${command.eventType} for application ${appId}, Event ID: ${eventId}`
      );

      const message = await this.svix.message.create(appId, {
        eventType: command.eventType,
        eventId,
        payload: webhookPayload,
      });

      this.logger.debug(
        `Successfully sent webhook ${command.eventType}. Svix Message ID: ${message.id}, Event ID: ${eventId}`
      );

      return { eventId };
    } catch (error: any) {
      this.logger.error(
        `Failed to send webhook ${command.eventType} for application ${appId}. Error: ${error.message}, Event ID: ${eventId}`,
        error.stack
      );
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SendWebhookMessage

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/utils/app-id.ts
Tamaño: 350 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EnvironmentId, OrganizationId } from '@novu/shared';

/**
 * Generates a standardized app ID format for webhook applications
 * Format: o-${organizationId}-e-${environmentId}
 */
export function generateWebhookAppId(organizationId: OrganizationId, environmentId: EnvironmentId): string {
  return `o-${organizationId}-e-${environmentId}`;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - generateWebhookAppId(organizationId: OrganizationId, environmentId: EnvironmentId)
Declaraciones 'export' encontradas:
- export function generateWebhookAppId

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/application-generic/src/webhooks/utils/index.ts
Tamaño: 26 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './app-id';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/automation/.editorconfig
Tamaño: 245 bytes
Lenguaje detectado: EDITORCONFIG

### CONTENIDO ORIGINAL ###

# Editor configuration, see http://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
max_line_length = off
trim_trailing_whitespace = false


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Editor configuration, see http://editorconfig.org
root = true
[*]
charset = utf-8
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/.gitignore
Tamaño: 510 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# See http://help.github.com/ignore-files/ for more about ignoring files.

# compiled output
dist
tmp
/out-tsc

# dependencies
node_modules

# IDEs and editors
/.idea
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

# IDE - VSCode
.vscode/*
!.vscode/settings.json
!.vscode/tasks.json
!.vscode/launch.json
!.vscode/extensions.json

# misc
/.sass-cache
/connect.lock
/coverage
/libpeerconnection.log
npm-debug.log
yarn-error.log
testem.log
/typings

# System Files
.DS_Store
Thumbs.db

# NX
.nx


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# See http://help.github.com/ignore-files/ for more about ignoring files.
# compiled output
dist
tmp
# dependencies
# IDEs and editors
# IDE - VSCode
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/README.md
Tamaño: 2445 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

# Automation

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, Smart Monorepos · Fast CI.](https://nx.dev)** ✨

## Integrate with editors

Enhance your Nx experience by installing [Nx Console](https://nx.dev/nx-console) for your favorite editor. Nx Console
provides an interactive UI to view your projects, run tasks, generate code, and more! Available for VSCode, IntelliJ and
comes with a LSP for Vim users.

## Nx plugins and code generators

Add Nx plugins to leverage their code generators and automated, inferred tasks.

```
# Add plugin
npx nx add @nx/react

# Use code generator
npx nx generate @nx/react:app demo

# Run development server
npx nx serve demo

# View project details
npx nx show project demo --web
```

Run `npx nx list` to get a list of available plugins and whether they have generators. Then run `npx nx list <plugin-name>` to see what generators are available.

Learn more about [code generators](https://nx.dev/features/generate-code) and [inferred tasks](https://nx.dev/concepts/inferred-tasks) in the docs.

## Running tasks

To execute tasks with Nx use the following syntax:

```
npx nx <target> <project> <...options>
```

You can also run multiple targets:

```
npx nx run-many -t <target1> <target2>
```

..or add `-p` to filter specific projects

```
npx nx run-many -t <target1> <target2> -p <proj1> <proj2>
```

Targets can be defined in the `package.json` or `projects.json`. Learn more [in the docs](https://nx.dev/features/run-tasks).

## Set up CI!

Nx comes with local caching already built-in (check your `nx.json`). On CI you might want to go a step further.

- [Set up remote caching](https://nx.dev/features/share-your-cache)
- [Set up task distribution across multiple machines](https://nx.dev/nx-cloud/features/distribute-task-execution)
- [Learn more how to setup CI](https://nx.dev/recipes/ci)

## Explore the project graph

Run `npx nx graph` to show the graph of the workspace.
It will show tasks that you can run with Nx.

- [Learn more about Exploring the Project Graph](https://nx.dev/core-features/explore-graph)

## Connect with us!

- [Join the community](https://nx.dev/community)
- [Subscribe to the Nx Youtube Channel](https://www.youtube.com/@nxdevtools)
- [Follow us on Twitter](https://twitter.com/nxdevtools)


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Automation
<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>
✨ **This workspace has been generated by [Nx, Smart Monorepos · Fast CI.](https://nx.dev)** ✨
## Integrate with editors
## Nx plugins and code generators
# Add plugin
Menciona package.json.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/generators.json
Tamaño: 205 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "generators": {
    "provider": {
      "factory": "./src/generators/provider/generator",
      "schema": "./src/generators/provider/schema.json",
      "description": "provider generator"
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"generators": {
"provider": {
"factory": "./src/generators/provider/generator",
"schema": "./src/generators/provider/schema.json",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/nx.json
Tamaño: 1256 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "$schema": "./node_modules/nx/schemas/nx-schema.json",
  "tasksRunnerOptions": {
    "default": {
      "runner": "nx-cloud",
      "options": {
        "cacheableOperations": ["build", "test", "lint", "package", "prepare"],
        "canTrackAnalytics": false,
        "accessToken": "ZTQ3Yzc3MjEtM2M2ZS00MzRlLWI0OWItZjhmOWVhNWQ1MTM0fHJlYWQ="
      }
    }
  },
  "namedInputs": {
    "default": ["{projectRoot}/**/*", "sharedGlobals"],
    "production": [
      "default",
      "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
      "!{projectRoot}/tsconfig.spec.json",
      "!{projectRoot}/jest.config.[jt]s",
      "!{projectRoot}/src/test-setup.[jt]s",
      "!{projectRoot}/test-setup.[jt]s"
    ],
    "sharedGlobals": []
  },
  "targetDefaults": {
    "@nx/js:tsc": {
      "dependsOn": ["^build"],
      "inputs": ["production", "^production"]
    },
    "@nx/jest:jest": {
      "inputs": ["default", "^production", "{workspaceRoot}/jest.preset.js"],
      "options": {
        "passWithNoTests": true
      },
      "configurations": {
        "ci": {
          "ci": true,
          "codeCoverage": true
        }
      }
    }
  },
  "release": {
    "version": {
      "preVersionCommand": "npx nx run-many -t build"
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"$schema": "./node_modules/nx/schemas/nx-schema.json",
"tasksRunnerOptions": {
"default": {
"runner": "nx-cloud",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/package.json
Tamaño: 751 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/automation",
  "version": "2.0.1",
  "private": true,
  "license": "MIT",
  "scripts": {
    "generate:provider": "pnpm nx g automation:provider",
    "check": "biome check .",
    "check:fix": "biome check --write ."
  },
  "dependencies": {
    "@nx/devkit": "20.1.2"
  },
  "devDependencies": {
    "@nx/js": "20.1.2",
    "@swc-node/register": "1.10.10",
    "@types/jest": "^29.4.0",
    "@types/node": "^20.15.0",
    "jest": "^29.4.1",
    "jest-environment-jsdom": "^29.4.1",
    "knip": "^5.11.0",
    "nx": "20.1.2",
    "ts-jest": "^29.1.0",
    "typescript": "5.6.2",
    "verdaccio": "^5.0.4"
  },
  "type": "commonjs",
  "main": "./src/index.js",
  "typings": "./src/index.d.ts",
  "generators": "./generators.json"
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/automation",
"version": "2.0.1",
"private": true,
"license": "MIT",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/project.json
Tamaño: 445 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "automation",
  "$schema": "node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "src",
  "projectType": "library",
  "release": {
    "version": {
      "generatorOptions": {
        "packageRoot": "dist/{projectRoot}",
        "currentVersionResolver": "git-tag"
      }
    }
  },
  "tags": [],
  "targets": {
    "nx-release-publish": {
      "options": {
        "packageRoot": "dist/{projectRoot}"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "automation",
"$schema": "node_modules/nx/schemas/project-schema.json",
"sourceRoot": "src",
"projectType": "library",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/tsconfig.json
Tamaño: 684 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "compilerOptions": {
    "rootDir": ".",
    "sourceMap": true,
    "declaration": false,
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "importHelpers": true,
    "target": "es2015",
    "module": "commonjs",
    "esModuleInterop": true,
    "resolveJsonModule": true,
    "jsx": "react-jsx",
    "lib": ["es2020", "dom"],
    "skipLibCheck": true,
    "skipDefaultLibCheck": true,
    "baseUrl": ".",
    "paths": {
      "automation": ["src/index.ts"]
    }
  },
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"compilerOptions": {
"rootDir": ".",
"sourceMap": true,
"declaration": false,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/tsconfig.lib.json
Tamaño: 245 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist/out-tsc",
    "declaration": true,
    "types": ["node"]
  },
  "include": ["src/**/*.ts"],
  "exclude": ["jest.config.ts", "src/**/*.spec.ts", "src/**/*.test.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "./tsconfig.json",
"compilerOptions": {
"outDir": "./dist/out-tsc",
"declaration": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/tsconfig.spec.json
Tamaño: 241 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist/out-tsc",
    "module": "commonjs",
    "types": ["jest", "node"]
  },
  "include": ["jest.config.ts", "src/**/*.test.ts", "src/**/*.spec.ts", "src/**/*.d.ts"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "./tsconfig.json",
"compilerOptions": {
"outDir": "./dist/out-tsc",
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/.verdaccio/config.yml
Tamaño: 622 bytes
Lenguaje detectado: YAML

### CONTENIDO ORIGINAL ###

# path to a directory with all packages
storage: ../tmp/local-registry/storage

# a list of other known repositories we can talk to
uplinks:
  npmjs:
    url: https://registry.npmjs.org/
    maxage: 60m

packages:
  '**':
    # give all users (including non-authenticated users) full access
    # because it is a local registry
    access: $all
    publish: $all
    unpublish: $all

    # if package is not available locally, proxy requests to npm registry
    proxy: npmjs

# log settings
logs:
  type: stdout
  format: pretty
  level: warn

publish:
  allow_offline: true # set offline to true to allow publish offline


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# path to a directory with all packages
storage: ../tmp/local-registry/storage
# a list of other known repositories we can talk to
uplinks:
# give all users (including non-authenticated users) full access
# because it is a local registry
# if package is not available locally, proxy requests to npm registry
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/.vscode/extensions.json
Tamaño: 82 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "recommendations": ["nrwl.angular-console", "firsttris.vscode-jest-runner"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"recommendations": ["nrwl.angular-console", "firsttris.vscode-jest-runner"]
}
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/src/generators/provider/generator.ts
Tamaño: 2985 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import fs from 'node:fs';
import path from 'node:path';
import { addProjectConfiguration, formatFiles, generateFiles, Tree } from '@nx/devkit';
import { IProviderGeneratorSchema } from './schema';

const PROVIDERS_BASE_FOLDER = path.join('..', '..', 'packages', 'providers', 'src', 'lib');

export async function providerGenerator(tree: Tree, options: IProviderGeneratorSchema) {
  options = enrichOptionsWithMultipleCases(options);
  const providerNameInKebabCase = options.name;
  const providerInnerFolder = path.join(PROVIDERS_BASE_FOLDER, options.type.toLowerCase(), providerNameInKebabCase);
  buildAndAddProjectConfiguration(tree, options, providerInnerFolder);
  generateFilesBasedOnTemplate(tree, providerInnerFolder, options);
  addExportToIndexTs(providerNameInKebabCase, options.type);
  removeDefaultProjectJsonFromTree(tree, providerInnerFolder);
  await formatFiles(tree);
}

function repopulateFileWithNewLine(filePath, lines: string[]) {
  fs.writeFile(filePath, `${lines.join('\n')}\n`, 'utf8', (err) => {
    if (err) {
      console.error('Error writing to file:', err);

      return;
    }
    console.log('Line added successfully.');
  });
}

function addLineToFile(filePath, lineToAdd) {
  fs.readFile(filePath, 'utf8', (err, data) => {
    if (err) {
      console.error('Error reading file:', err);

      return;
    }
    const lines = data.split('\n');
    while (lines.length > 0 && lines[lines.length - 1].trim() === '') {
      lines.pop();
    }
    lines.push(lineToAdd);

    // Write the updated content back to the file
    repopulateFileWithNewLine(filePath, lines);
  });
}

function toPascalCase(kebabString) {
  return kebabString
    .toLowerCase()
    .split('-')
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join('');
}
function enrichOptionsWithMultipleCases(options: IProviderGeneratorSchema) {
  return {
    ...options,
    pascalType: toPascalCase(options.type),
    pascalName: toPascalCase(options.name),
    upperType: options.type.toUpperCase(),
  };
}

function buildAndAddProjectConfiguration(tree: Tree, options: IProviderGeneratorSchema, projectRoot: string) {
  addProjectConfiguration(tree, options.name, {
    root: projectRoot,
    projectType: 'library',
    sourceRoot: projectRoot,
    targets: {},
  });
}

function buildExportLine(providerName: string) {
  return `export * from './${providerName}/${providerName}.provider';`;
}

function addExportToIndexTs(providerName: string, type: string) {
  const indexTsPath = path.join(PROVIDERS_BASE_FOLDER, type.toLowerCase(), 'index.ts');
  addLineToFile(indexTsPath, buildExportLine(providerName));
}

function removeDefaultProjectJsonFromTree(tree: Tree, projectRoot: string) {
  tree.delete(`${projectRoot}/project.json`);
}

function generateFilesBasedOnTemplate(tree: Tree, projectRoot: string, options: IProviderGeneratorSchema) {
  generateFiles(tree, path.join(__dirname, 'files'), projectRoot, options);
}
export default providerGenerator;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - providerGenerator(tree: Tree, options: IProviderGeneratorSchema)
 - repopulateFileWithNewLine(filePath, lines: string[])
 - addLineToFile(filePath, lineToAdd)
 - toPascalCase(kebabString)
 - enrichOptionsWithMultipleCases(options: IProviderGeneratorSchema)
 - buildAndAddProjectConfiguration(tree: Tree, options: IProviderGeneratorSchema, projectRoot: string)
 - buildExportLine(providerName: string)
 - addExportToIndexTs(providerName: string, type: string)
 - removeDefaultProjectJsonFromTree(tree: Tree, projectRoot: string)
 - generateFilesBasedOnTemplate(tree: Tree, projectRoot: string, options: IProviderGeneratorSchema)
Asignaciones con arrow functions encontradas (posibles funciones):
 - providerInnerFolder(path.join(PROVIDERS_BASE_FOLDER, options.type.toLowerCase(), providerNameInKebabCase);
  buildAndAdd...)
Declaraciones 'export' encontradas:
- export  async
- export
- export default  providerGenerator

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/automation/src/generators/provider/schema.json
Tamaño: 612 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "$schema": "https://json-schema.org/schema",
  "$id": "Provider",
  "title": "",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "",
      "$default": {
        "$source": "argv",
        "index": 0
      },
      "x-prompt": "Write the provider name`kebab-cased` (e.g. proton-mail, outlook365, yahoo-mail)?"
    },
    "type": {
      "type": "string",
      "x-prompt": "Choose the provider type?",
      "$default": {
        "$source": "argv",
        "index": 0
      },
      "enum": ["EMAIL", "SMS", "PUSH", "CHAT"]
    }
  },
  "required": ["name"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"$schema": "https://json-schema.org/schema",
"$id": "Provider",
"title": "",
"type": "object",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/src/generators/provider/schema.ts
Tamaño: 143 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IProviderGeneratorSchema {
  name: string;
  type: string;
  pascalType: string;
  pascalName: string;
  upperType: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/automation/src/generators/provider/files/__name__.provider.ts.template
Tamaño: 1009 bytes
Lenguaje detectado: TEMPLATE

### CONTENIDO ORIGINAL ###

import {
  ChannelTypeEnum,
  ISendMessageSuccessResponse,
  I<%= pascalType %>Options,
  I<%= pascalType %>Provider,
} from '@novu/stateless';
import { BaseProvider, CasingEnum  } from '../../../base.provider';
import { WithPassthrough } from '../../../utils/types';

export class <%= pascalName %><%= pascalType %>Provider extends BaseProvider implements I<%= pascalType %>Provider {
  id = '<%= name %>';
  channelType = ChannelTypeEnum.<%= upperType %> as ChannelTypeEnum.<%= upperType %>;
  protected casing: CasingEnum = CasingEnum.CAMEL_CASE;

  constructor(
    private config: {
      <%= upperType === 'EMAIL' ? 'apiKey: string;' : null %>
    }
  ) {
    super();
  }

  async sendMessage(
    options: I<%= pascalType %>Options,
    bridgeProviderData: WithPassthrough<Record<string, unknown>> = {}
  ): Promise<ISendMessageSuccessResponse> {
    const data = this.transform(bridgeProviderData, options);


    return {
      id: 'id_returned_by_provider',
      date: 'current_time'
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import {
ChannelTypeEnum,
ISendMessageSuccessResponse,
I<%= pascalType %>Options,
I<%= pascalType %>Provider,
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/automation/src/generators/provider/files/__name__.test.provider.spec.ts.template
Tamaño: 158 bytes
Lenguaje detectado: TEMPLATE

### CONTENIDO ORIGINAL ###

import { <%= pascalName %><%= pascalType %>Provider } from './<%= name %>.provider';

test('should trigger <%= name %> library correctly', async () => {

});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { <%= pascalName %><%= pascalType %>Provider } from './<%= name %>.provider';
test('should trigger <%= name %> library correctly', async () => {
});
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/.dockerignore
Tamaño: 13 bytes
Lenguaje detectado: DOCKERIGNORE

### CONTENIDO ORIGINAL ###

node_modules


### ANALISIS AUTOMATICO (ESPAÑOL) ###

node_modules
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/.gitignore
Tamaño: 1843 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###


### Node template
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# next.js build output
.next
### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and WebStorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff
.idea


# Sensitive or high-churn files
.idea/**/dataSources/
.idea/**/dataSources.ids
.idea/**/dataSources.local.xml
.idea/**/sqlDataSources.xml
.idea/**/dynamic.xml
.idea/**/uiDesigner.xml
.idea/**/dbnavigator.xml

# Gradle
.idea/**/gradle.xml
.idea/**/libraries

# CMake
cmake-build-debug/
cmake-build-release/

# Mongo Explorer plugin
.idea/**/mongoSettings.xml

# File-based project format
*.iws

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Cursive Clojure plugin
.idea/replstate.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

# Editor-based Rest Client
.idea/httpRequests


### ANALISIS AUTOMATICO (ESPAÑOL) ###

### Node template
# Logs
logs
*.log
# Runtime data
# Directory for instrumented libs generated by jscoverage/JSCover
# Coverage directory used by tools like istanbul
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/package.json
Tamaño: 1520 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/dal",
  "version": "2.0.5",
  "description": "",
  "private": true,
  "scripts": {
    "start": "npm run start:dev",
    "afterinstall": "pnpm build",
    "prebuild": "rimraf dist",
    "build": "cross-env node_modules/.bin/tsc -p tsconfig.build.json",
    "build:watch": "cross-env node_modules/.bin/tsc -p tsconfig.build.json -w --preserveWatchOutput",
    "start:dev": "pnpm build:watch",
    "precommit": "lint-staged",
    "check": "biome check .",
    "check:fix": "biome check --write .",
    "test": "echo \"No test specified\"",
    "test:watch": ""
  },
  "author": "",
  "license": "ISC",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "peerDependencies": {
    "@nestjs/common": "10.4.18"
  },
  "dependencies": {
    "@aws-sdk/client-s3": "^3.382.0",
    "@aws-sdk/s3-request-presigner": "^3.382.0",
    "@faker-js/faker": "^6.0.0",
    "@novu/shared": "workspace:*",
    "aws-sdk": "^2.665.0",
    "class-transformer": "0.5.1",
    "cross-fetch": "^3.0.4",
    "date-fns": "^2.29.2",
    "event-stream": "^4.0.1",
    "fs-extra": "^9.0.0",
    "googleapis": "^60.0.1",
    "jsonfile": "^6.0.1",
    "mongoose": "^7.8.7",
    "mongoose-delete": "^1.0.1",
    "reflect-metadata": "0.2.2",
    "superagent-defaults": "^0.1.14",
    "uuid": "^8.3.0"
  },
  "devDependencies": {
    "@types/node": "^20.15.0",
    "apollo-boost": "0.4.9",
    "rimraf": "^3.0.2",
    "supertest": "^7.0.0",
    "ts-node": "~10.9.1",
    "tsconfig-paths": "~4.1.0",
    "typescript": "5.6.2"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/dal",
"version": "2.0.5",
"description": "",
"private": true,
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/project.json
Tamaño: 235 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/dal",
  "sourceRoot": "libs/dal/src",
  "projectType": "library",
  "targets": {
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "command": "npx biome lint libs/dal"
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/dal",
"sourceRoot": "libs/dal/src",
"projectType": "library",
"targets": {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/tsconfig.build.json
Tamaño: 338 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "module": "commonjs",
    "target": "es6",
    "declaration": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "types": ["node"]
  },
  "include": ["src/**/*"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"module": "commonjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/tsconfig.json
Tamaño: 190 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "strictNullChecks": true,
    "types": ["node"],
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "../../tsconfig.json",
"compilerOptions": {
"strictNullChecks": true,
"types": ["node"],
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/dal/src/dal.service.ts
Tamaño: 1808 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Logger } from '@nestjs/common';
import mongoose, { Connection, ConnectOptions } from 'mongoose';
import { AuthMechanism } from './types';

const MONGODB_CONTEXT = '[@novu/dal]';

export { mongoose };

export class DalService {
  connection: Connection;

  async connect(url: string, config: ConnectOptions = {}) {
    const baseConfig: ConnectOptions = {
      autoIndex: process.env.MONGO_AUTO_CREATE_INDEXES === 'true',
      maxIdleTimeMS: process.env.MONGO_MAX_IDLE_TIME_IN_MS ? Number(process.env.MONGO_MAX_IDLE_TIME_IN_MS) : 1000 * 30,
      maxPoolSize: process.env.MONGO_MAX_POOL_SIZE ? Number(process.env.MONGO_MAX_POOL_SIZE) : 50,
      minPoolSize: process.env.MONGO_MIN_POOL_SIZE ? Number(process.env.MONGO_MIN_POOL_SIZE) : 10,
      authMechanism: (process.env.MONGO_AUTH_MECHANISM as AuthMechanism) || ('DEFAULT' as AuthMechanism),
    };

    const finalConfig = {
      ...baseConfig,
      ...config,
    };
    const instance = await mongoose.connect(url, finalConfig);

    this.connection = instance.connection;

    mongoose.connection.on('connected', () => Logger.debug('[@novu/dal]: Mongo connected', MONGODB_CONTEXT));
    mongoose.connection.on('disconnected', () => Logger.debug('[@novu/dal]: Mongo disconnected', MONGODB_CONTEXT));
    mongoose.connection.on('error', (err) =>
      Logger.error(`[@novu/dal]: Mongo error: ${err.message}`, MONGODB_CONTEXT, {
        cause: err,
        stack: err.stack,
      })
    );

    return this.connection;
  }

  isConnected(): boolean {
    return this.connection && this.connection.readyState === 1;
  }

  async disconnect() {
    await mongoose.disconnect();
  }

  async destroy() {
    if (process.env.NODE_ENV !== 'test') throw new Error('Allowed only in test mode');

    await mongoose.connection.dropDatabase();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - connection(instance.connection;

    mongoose.connection.on('connected', ())
Declaraciones 'export' encontradas:
- export
- export class DalService

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/index.ts
Tamaño: 1331 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './dal.service';
export * from './repositories/base-repository';
export * from './repositories/change';
export * from './repositories/channel-connection';
export * from './repositories/channel-endpoint';
export * from './repositories/context';
export * from './repositories/control-values';
export * from './repositories/environment';
export * from './repositories/execution-details';
export * from './repositories/feed';
export * from './repositories/integration';
export * from './repositories/job';
export * from './repositories/layout';
export * from './repositories/localization';
export * from './repositories/localization-group';
export * from './repositories/member';
export * from './repositories/message';
export * from './repositories/message-template';
export * from './repositories/notification';
export * from './repositories/notification-group';
export * from './repositories/notification-template';
export * from './repositories/organization';
export * from './repositories/preferences';
export * from './repositories/schema-default.options';
export * from './repositories/subscriber';
export * from './repositories/tenant';
export * from './repositories/topic';
export * from './repositories/user';
export * from './repositories/workflow-override';
export * from './shared';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/base-repository.ts
Tamaño: 18412 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum } from '@novu/shared';
import { ClassConstructor, plainToInstance } from 'class-transformer';
import {
  ClientSession,
  FilterQuery,
  Model,
  ProjectionType,
  QueryOptions,
  QueryWithHelpers,
  SortOrder,
  Types,
  UpdateQuery,
} from 'mongoose';
import { DalException } from '../shared';

export class BaseRepository<T_DBModel, T_MappedEntity, T_Enforcement> {
  public _model: Model<T_DBModel>;

  constructor(
    protected MongooseModel: Model<T_DBModel>,
    protected entity: ClassConstructor<T_MappedEntity>
  ) {
    this._model = MongooseModel;
  }

  public static createObjectId() {
    return new Types.ObjectId().toString();
  }

  public static isInternalId(id: string) {
    const isValidMongoId = Types.ObjectId.isValid(id);
    if (!isValidMongoId) {
      return false;
    }

    return id === new Types.ObjectId(id).toString();
  }

  protected convertObjectIdToString(value: Types.ObjectId): string {
    return value.toString();
  }

  protected convertStringToObjectId(value: string): Types.ObjectId {
    return new Types.ObjectId(value);
  }

  async count(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    limit?: number,
    readPreference?: 'secondaryPreferred' | 'primary'
  ): Promise<number> {
    return this.MongooseModel.countDocuments(query, {
      limit,
      readPreference: readPreference || 'primary',
    });
  }

  private async getCountWithLimit(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    maxLimit: number = 50001
  ): Promise<{ count: number; hasMore: boolean }> {
    const result = await this.count(query, maxLimit, 'secondaryPreferred');
    const count = result;
    const hasMore = count === maxLimit;

    return {
      count: hasMore ? maxLimit - 1 : count,
      hasMore,
    };
  }

  async estimatedDocumentCount(): Promise<number> {
    return this.MongooseModel.estimatedDocumentCount();
  }

  async aggregate(query: any[], options: { readPreference?: 'secondaryPreferred' | 'primary' } = {}): Promise<any> {
    return await this.MongooseModel.aggregate(query).read(options.readPreference || 'primary');
  }

  async findOne(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    select?: ProjectionType<T_MappedEntity>,
    options: {
      readPreference?: 'secondaryPreferred' | 'primary';
      query?: QueryOptions<T_DBModel>;
      session?: ClientSession | null;
    } = {}
  ): Promise<T_MappedEntity | null> {
    const { session, ...queryOptions } = options;

    const queryBuilder = this.MongooseModel.findOne(query, select, queryOptions.query).read(
      queryOptions.readPreference || 'primary'
    );

    if (session) {
      queryBuilder.session(session);
    }

    const data = await queryBuilder;
    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  async findOneAndUpdate(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    update: UpdateQuery<T_DBModel>,
    options: QueryOptions<T_DBModel> & { session?: ClientSession | null } = {}
  ): Promise<T_MappedEntity | null> {
    const { session, ...updateOptions } = options;

    const data = await this.MongooseModel.findOneAndUpdate(query, update, {
      ...updateOptions,
      upsert: updateOptions.upsert || false,
      new: updateOptions.new || false,
      ...(session && { session }),
    });

    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  async delete(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    options: { session?: ClientSession | null } = {}
  ): Promise<{
    /** Indicates whether this writes result was acknowledged. If not, then all other members of this result will be undefined. */
    acknowledged: boolean;
    /** The number of documents that were deleted */
    deletedCount: number;
  }> {
    const { session } = options;
    const deleteOptions = session ? { session } : {};

    return await this.MongooseModel.deleteMany(query, deleteOptions);
  }

  async findOneAndDelete(query: FilterQuery<T_DBModel> & T_Enforcement): Promise<T_MappedEntity | null> {
    const data = await this.MongooseModel.findOneAndDelete(query).lean();
    if (!data) return null;

    return this.mapEntity(data);
  }

  async find(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    select: ProjectionType<T_MappedEntity> = '',
    options: {
      limit?: number;
      sort?: any;
      skip?: number;
      session?: ClientSession | null;
      readPreference?: 'secondaryPreferred' | 'primary';
    } = {}
  ): Promise<T_MappedEntity[]> {
    const { session, ...queryOptions } = options;

    const queryBuilder = this.MongooseModel.find(query, select, {
      sort: queryOptions.sort || null,
    })
      .skip(queryOptions.skip as number)
      .limit(queryOptions.limit as number)
      .read(queryOptions.readPreference || 'primary')
      .lean();

    if (session) {
      queryBuilder.session(session);
    }

    const data = await queryBuilder.exec();

    return this.mapEntities(data);
  }

  async *findBatch(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    select = '',
    options: { limit?: number; sort?: any; skip?: number } = {},
    batchSize = 500
  ) {
    for await (const doc of this._model
      .find(query, select, {
        sort: options.sort || null,
      })
      .batchSize(batchSize)
      .cursor()) {
      yield this.mapEntity(doc);
    }
  }

  private async createCursorBasedOrStatement({
    isSortDesc,
    paginateField,
    after,
    queryOrStatements,
  }: {
    isSortDesc: boolean;
    paginateField?: string;
    after: string;
    queryOrStatements?: object[];
  }): Promise<FilterQuery<T_DBModel>[]> {
    const afterItem = await this.MongooseModel.findOne({ _id: after });
    if (!afterItem) {
      throw new DalException('Invalid after id');
    }

    let cursorOrStatements: FilterQuery<T_DBModel>[] = [];
    let enhancedCursorOrStatements: FilterQuery<T_DBModel>[] = [];
    if (paginateField && afterItem[paginateField]) {
      const paginatedFieldValue = afterItem[paginateField];
      cursorOrStatements = [
        { [paginateField]: isSortDesc ? { $lt: paginatedFieldValue } : { $gt: paginatedFieldValue } } as any,
        { [paginateField]: { $eq: paginatedFieldValue }, _id: isSortDesc ? { $lt: after } : { $gt: after } },
      ];
      const firstStatement = (queryOrStatements ?? []).map((item) => ({
        ...item,
        ...cursorOrStatements[0],
      }));
      const secondStatement = (queryOrStatements ?? []).map((item) => ({
        ...item,
        ...cursorOrStatements[1],
      }));
      enhancedCursorOrStatements = [...firstStatement, ...secondStatement];
    } else {
      cursorOrStatements = [{ _id: isSortDesc ? { $lt: after } : { $gt: after } }];
      const firstStatement = (queryOrStatements ?? []).map((item) => ({
        ...item,
        ...cursorOrStatements[0],
      }));
      enhancedCursorOrStatements = [...firstStatement];
    }

    return enhancedCursorOrStatements.length > 0 ? enhancedCursorOrStatements : cursorOrStatements;
  }

  /**
   * @deprecated This method is deprecated
   * Please use findWithCursorBasedPagination() instead.
   */
  async cursorPagination({
    query,
    limit,
    offset,
    after,
    sort,
    paginateField,
    enhanceQuery,
  }: {
    query?: FilterQuery<T_DBModel> & T_Enforcement;
    limit: number;
    offset: number;
    after?: string;
    sort?: any;
    paginateField?: string;
    enhanceQuery?: (query: QueryWithHelpers<Array<T_DBModel>, T_DBModel>) => any;
  }): Promise<{ data: T_MappedEntity[]; hasMore: boolean }> {
    const isAfterDefined = typeof after !== 'undefined';
    const sortKeys = Object.keys(sort ?? {});
    const isSortDesc = sortKeys.length > 0 && sort[sortKeys[0]] === -1;

    let findQueryBuilder = this.MongooseModel.find({
      ...query,
    });
    if (isAfterDefined) {
      const orStatements = await this.createCursorBasedOrStatement({
        isSortDesc,
        paginateField,
        after,
        queryOrStatements: query?.$or,
      });

      findQueryBuilder = this.MongooseModel.find({
        ...query,
        $or: orStatements,
      });
    }

    findQueryBuilder.sort(sort).limit(limit + 1);
    if (!isAfterDefined) {
      findQueryBuilder.skip(offset);
    }

    if (enhanceQuery) {
      findQueryBuilder = enhanceQuery(findQueryBuilder);
    }

    const messages = await findQueryBuilder.exec();

    const hasMore = messages.length > limit;
    if (hasMore) {
      messages.pop();
    }

    return {
      data: this.mapEntities(messages),
      hasMore,
    };
  }

  async create(
    data: FilterQuery<T_DBModel> & T_Enforcement,
    options: IOptions & { session?: ClientSession | null } = {}
  ): Promise<T_MappedEntity> {
    const { session, ...saveOptions } = options;
    const newEntity = new this.MongooseModel(data);

    const mongooseOptions = saveOptions?.writeConcern ? { w: saveOptions?.writeConcern } : {};
    if (session) {
      Object.assign(mongooseOptions, { session });
    }

    const saved = await newEntity.save(mongooseOptions);

    return this.mapEntity(saved);
  }

  async insertMany(
    data: FilterQuery<T_DBModel> & T_Enforcement[],
    ordered = false
  ): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: Types.ObjectId[] }> {
    let result;
    try {
      result = await this.MongooseModel.insertMany(data, { ordered });
    } catch (e: unknown) {
      if (e instanceof Error) {
        throw new DalException(e.message);
      } else {
        throw new DalException('An unknown error occurred');
      }
    }

    const insertedIds = result.map((inserted) => inserted._id);

    return {
      acknowledged: true,
      insertedCount: result.length,
      insertedIds,
    };
  }

  async update(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    updateBody: UpdateQuery<T_DBModel>,
    options: QueryOptions<T_DBModel> & {
      session?: ClientSession | null;
      writeConcern?: { w: number | 'majority' };
    } = {}
  ): Promise<{
    matched: number;
    modified: number;
  }> {
    const { session, ...updateOptions } = options;

    const saved = await this.MongooseModel.updateMany(query, updateBody, {
      multi: true,
      ...updateOptions,
      ...(session && { session }),
    });

    return {
      matched: saved.matchedCount,
      modified: saved.modifiedCount,
    };
  }

  async updateOne(
    query: FilterQuery<T_DBModel> & T_Enforcement,
    updateBody: UpdateQuery<T_DBModel>
  ): Promise<{
    matched: number;
    modified: number;
  }> {
    const saved = await this.MongooseModel.updateOne(query, updateBody);

    return {
      matched: saved.matchedCount,
      modified: saved.modifiedCount,
    };
  }

  async upsertMany(data: (FilterQuery<T_DBModel> & T_Enforcement)[]) {
    const promises = data.map((entry) =>
      this.MongooseModel.findOneAndUpdate(entry, entry, { upsert: true, new: true })
    );

    return await Promise.all(promises);
  }

  async upsert(query: FilterQuery<T_DBModel> & T_Enforcement, data: FilterQuery<T_DBModel> & T_Enforcement) {
    return await this.MongooseModel.findOneAndUpdate(query, data, {
      upsert: true,
      new: true,
      includeResultMetadata: true,
    });
  }

  async bulkWrite(bulkOperations: any, ordered = false): Promise<any> {
    return await this.MongooseModel.bulkWrite(bulkOperations, { ordered });
  }

  protected mapEntity<TData>(data: TData): TData extends null ? null : T_MappedEntity {
    return plainToInstance(this.entity, JSON.parse(JSON.stringify(data))) as any;
  }

  protected mapEntities(data: any): T_MappedEntity[] {
    return plainToInstance<T_MappedEntity, T_MappedEntity[]>(this.entity, JSON.parse(JSON.stringify(data)));
  }

  /*
   * Note about parallelism in transactions
   *
   * Running operations in parallel is not supported during a transaction.
   * The use of Promise.all, Promise.allSettled, Promise.race, etc. to parallelize operations
   * inside a transaction is undefined behaviour and should be avoided.
   *
   * Refer to https://mongoosejs.com/docs/transactions.html#note-about-parallelism-in-transactions
   */
  async withTransaction(fn: (session: ClientSession | null) => Promise<any>) {
    try {
      return await (await this._model.db.startSession()).withTransaction(fn);
    } catch (error) {
      // Check if the error is related to replica set requirement
      if (
        error.message?.includes('replica set') ||
        error.message?.includes('transaction') ||
        error.codeName === 'IllegalOperation'
      ) {
        // MongoDB is not running in replica set mode, execute without transaction
        return await fn(null);
      }

      throw error;
    }
  }

  async findWithCursorBasedPagination({
    query = {} as FilterQuery<T_DBModel> & T_Enforcement,
    limit,
    before,
    after,
    sortBy,
    sortDirection = DirectionEnum.DESC,
    paginateField,
    enhanceQuery,
    includeCursor,
  }: {
    query?: FilterQuery<T_DBModel> & T_Enforcement;
    limit: number;
    before?: { sortBy: string; paginateField: any };
    after?: { sortBy: string; paginateField: any };
    sortBy: string;
    sortDirection: DirectionEnum;
    paginateField: string;
    enhanceQuery?: (query: QueryWithHelpers<Array<T_DBModel>, T_DBModel>) => any;
    includeCursor?: boolean;
  }): Promise<{
    data: T_MappedEntity[];
    next: string | null;
    previous: string | null;
    totalCount: number;
    totalCountCapped: boolean;
  }> {
    if (before && after) {
      throw new DalException('Cannot specify both "before" and "after" cursors at the same time.');
    }

    const isDesc = sortDirection === DirectionEnum.DESC;
    const sortValue = isDesc ? -1 : 1;
    const paginationQuery: any = { ...query };

    let reverseResults = false;

    if (before) {
      paginationQuery.$or = [
        {
          [sortBy]: isDesc
            ? { [includeCursor ? '$gte' : '$gt']: before.sortBy }
            : { [includeCursor ? '$lte' : '$lt']: before.sortBy },
        },
        {
          $and: [
            { [sortBy]: { $eq: before.sortBy } },
            {
              [paginateField]: isDesc
                ? { [includeCursor ? '$gte' : '$gt']: before.paginateField }
                : { [includeCursor ? '$lte' : '$lt']: before.paginateField },
            },
          ],
        },
      ];

      // Reverse sort order for backwards pagination
      reverseResults = true;
    } else if (after) {
      paginationQuery.$or = [
        {
          [sortBy]: isDesc
            ? { [includeCursor ? '$lte' : '$lt']: after.sortBy }
            : { [includeCursor ? '$gte' : '$gt']: after.sortBy },
        },
        {
          $and: [
            { [sortBy]: { $eq: after.sortBy } },
            {
              [paginateField]: isDesc
                ? { [includeCursor ? '$lte' : '$lt']: after.paginateField }
                : { [includeCursor ? '$gte' : '$gt']: after.paginateField },
            },
          ],
        },
      ];
    }

    let builder = this.MongooseModel.find(paginationQuery)
      .sort({
        [sortBy]: reverseResults ? -sortValue : sortValue,
        [paginateField]: reverseResults ? -sortValue : sortValue,
      } as Record<string, SortOrder>)
      .limit(limit + 1);

    if (enhanceQuery) {
      builder = enhanceQuery(builder);
    }

    // Run find query and count aggregation in parallel
    const [rawResults, countResult] = await Promise.all([builder.exec(), this.getCountWithLimit(query, 50001)]);

    const hasExtraItem = rawResults.length > limit;
    const totalCount = countResult.count;
    const hasMore = countResult.hasMore;

    let startIndex = 0;
    let endIndex = limit;
    if (reverseResults) {
      rawResults.reverse();

      /**
       * If we have an extra item, we need to adjust the start and end index
       * as it is reversed, the first item is actually the extra item
       */
      if (hasExtraItem) {
        startIndex = 1;
        endIndex = limit + 1;
      }
    }

    const pageResults = rawResults.slice(startIndex, endIndex);

    if (pageResults.length === 0) {
      return {
        data: [],
        next: null,
        previous: null,
        totalCount: totalCount,
        totalCountCapped: hasMore,
      };
    }

    let nextCursor: string | null = null;
    let prevCursor: string | null = null;

    const firstItem = pageResults[0];
    const lastItem = pageResults[pageResults.length - 1];

    if (hasExtraItem) {
      if (before) {
        prevCursor = firstItem[paginateField].toString();
      } else {
        nextCursor = lastItem[paginateField].toString();
      }
    }

    if (before) {
      const nextQuery: any = { ...query };

      nextQuery.$or = [
        {
          [sortBy]: isDesc ? { $lt: lastItem[sortBy] } : { $gt: lastItem[sortBy] },
        },
        {
          $and: [
            { [sortBy]: { $eq: lastItem[sortBy] } },
            {
              [paginateField]: isDesc ? { $lt: lastItem[paginateField] } : { $gt: lastItem[paginateField] },
            },
          ],
        },
      ];

      const maybeNext = await this.MongooseModel.findOne(nextQuery)
        .sort({ [sortBy]: sortValue, [paginateField]: sortValue })
        .limit(1)
        .exec();

      if (maybeNext) {
        nextCursor = lastItem[paginateField].toString();
      }
    } else {
      const prevQuery: any = { ...query };

      prevQuery.$or = [
        {
          [sortBy]: isDesc ? { $gt: firstItem[sortBy] } : { $lt: firstItem[sortBy] },
        },
        {
          $and: [
            { [sortBy]: { $eq: firstItem[sortBy] } },
            { [paginateField]: isDesc ? { $gt: firstItem[paginateField] } : { $lt: firstItem[paginateField] } },
          ],
        },
      ];

      const maybePrev = await this.MongooseModel.findOne(prevQuery)
        .sort({ [sortBy]: sortValue, [paginateField]: sortValue })
        .limit(1)
        .exec();

      if (maybePrev) {
        prevCursor = firstItem[paginateField].toString();
      }
    }

    return {
      data: this.mapEntities(pageResults),
      next: nextCursor,
      previous: prevCursor,
      totalCount: totalCount,
      totalCountCapped: hasMore,
    };
  }

  protected regExpEscape(literalString: string): string {
    return literalString.replace(/[-[\]{}()*+!<=:?./\\^$|#\s,]/g, '\\$&');
  }
}

interface IOptions {
  writeConcern?: number | 'majority';
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - firstStatement(queryOrStatements ?? []).map((item))
 - secondStatement(queryOrStatements ?? []).map((item))
 - firstStatement(queryOrStatements ?? []).map((item))
 - enhancedCursorOrStatements([...firstStatement];
    }

    return enhancedCursorOrStatements.length > 0 ? enhancedCursorOrState...)
 - insertedIds(result.map((inserted))
 - promises(data.map((entry))
 - ordered(false): Promise<any> {
    return await this.MongooseModel.bulkWrite(bulkOperations, { ordered });
 ...)
 - sortDirection(DirectionEnum.DESC,
    paginateField,
    enhanceQuery,
    includeCursor,
  }: {
    query?: Filte...)
Declaraciones 'export' encontradas:
- export class BaseRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/index.ts
Tamaño: 35 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './base-repository';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/schema-default.options.ts
Tamaño: 135 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const schemaOptions = {
  timestamps: true,
  id: true,
  toJSON: {
    virtuals: true,
  },
  toObject: { virtuals: true },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/change/change.entity.ts
Tamaño: 765 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChangeEntityTypeEnum } from '@novu/shared';
import { Types } from 'mongoose';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';
import { UserEntity } from '../user';

export class ChangeEntity {
  _id: string;

  _creatorId: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;

  _entityId: string;

  enabled: boolean;

  type: ChangeEntityTypeEnum;

  change: any;

  createdAt: string;

  _parentId?: string;
}

export type ChangeDBModel = ChangePropsValueType<
  Omit<ChangeEntity, '_parentId'>,
  '_creatorId' | '_environmentId' | '_organizationId' | '_entityId'
> & {
  _parentId?: Types.ObjectId;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChangeEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/change/change.repository.ts
Tamaño: 2553 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChangeEntityTypeEnum } from '@novu/shared';

import { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { UserEntity } from '../user';
import { ChangeDBModel, ChangeEntity } from './change.entity';
import { Change } from './change.schema';
import { ChangeEntityPopulated } from './types';

export class ChangeRepository extends BaseRepository<ChangeDBModel, ChangeEntity, EnforceEnvOrOrgIds> {
  constructor() {
    super(Change, ChangeEntity);
  }

  public async getEntityChanges(
    organizationId: string,
    entityType: ChangeEntityTypeEnum,
    entityId: string
  ): Promise<ChangeEntity[]> {
    return await this.find(
      {
        _organizationId: organizationId,
        _entityId: entityId,
        type: entityType,
      },
      '',
      {
        sort: { createdAt: 1 },
      }
    );
  }

  public async getChangeId(environmentId: string, entityType: ChangeEntityTypeEnum, entityId: string): Promise<string> {
    const change = await this.findOne({
      _environmentId: environmentId,
      _entityId: entityId,
      type: entityType,
      enabled: false,
    });

    if (change?._id) {
      return change._id;
    }

    return BaseRepository.createObjectId();
  }

  public async getList(organizationId: string, environmentId: string, enabled: boolean, skip = 0, limit = 10) {
    const totalItemsCount = await this.count({
      _environmentId: environmentId,
      _organizationId: organizationId,
      enabled,
      _parentId: { $exists: false, $eq: null },
    });

    const userSelect: Array<keyof UserEntity> = ['_id', 'firstName', 'lastName', 'profilePicture'];

    const items = await this.MongooseModel.find({
      _environmentId: environmentId,
      _organizationId: organizationId,
      enabled,
      _parentId: { $exists: false, $eq: null },
    })
      .sort({ createdAt: -1 })
      .skip(skip)
      .limit(limit)
      .populate('user', userSelect);

    return { totalCount: totalItemsCount, data: this.mapEntities(items) as ChangeEntityPopulated[] };
  }

  public async getParentId(
    environmentId: string,
    entityType: ChangeEntityTypeEnum,
    entityId: string
  ): Promise<string | null> {
    const change = await this.findOne(
      {
        _environmentId: environmentId,
        _entityId: entityId,
        type: entityType,
        enabled: false,
        _parentId: { $exists: true },
      },
      '_parentId'
    );
    if (change?._parentId) {
      return change._parentId;
    }

    return null;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChangeRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/change/change.schema.ts
Tamaño: 1232 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { ChangeDBModel } from './change.entity';

const changeSchema = new Schema<ChangeDBModel>(
  {
    enabled: {
      type: Schema.Types.Boolean,
      default: false,
    },
    type: {
      type: Schema.Types.String,
    },
    change: Schema.Types.Mixed,
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _entityId: { type: Schema.Types.ObjectId, index: true },
    _creatorId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
      index: true,
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'Change',
    },
  },
  { ...schemaOptions }
);

changeSchema.virtual('user', {
  ref: 'User',
  localField: '_creatorId',
  foreignField: '_id',
  justOne: true,
});

changeSchema.index({
  _environmentId: 1,
});

changeSchema.index({
  _creatorId: 1,
});

changeSchema.index({
  _entityId: 1,
});

export const Change =
  (mongoose.models.Change as mongoose.Model<ChangeDBModel>) || mongoose.model<ChangeDBModel>('Change', changeSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/change/index.ts
Tamaño: 103 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './change.entity';
export * from './change.repository';
export * from './change.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/change/types.ts
Tamaño: 222 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { UserEntity } from '../user';
import { ChangeEntity } from './change.entity';

export type ChangeEntityPopulated = ChangeEntity & {
  user: Pick<UserEntity, '_id' | 'firstName' | 'lastName' | 'profilePicture'>;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-connection/channel-connection.entity.ts
Tamaño: 819 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, IChannelConnection, ProvidersIdEnum, ResourceKey } from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class ChannelConnectionEntity implements IChannelConnection {
  _id: string;
  identifier: string;

  _organizationId: OrganizationId;
  _environmentId: EnvironmentId;

  integrationIdentifier: string;
  providerId: ProvidersIdEnum;
  channel: ChannelTypeEnum;
  resource: ResourceKey;

  workspace: { id: string; name?: string };
  auth: { accessToken: string };

  createdAt: string;
  updatedAt: string;
}

export type ChannelConnectionDBModel = ChangePropsValueType<
  ChannelConnectionEntity,
  '_environmentId' | '_organizationId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChannelConnectionEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-connection/channel-connection.repository.ts
Tamaño: 495 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { ChannelConnectionDBModel, ChannelConnectionEntity } from './channel-connection.entity';
import { ChannelConnection } from './channel-connection.schema';

export class ChannelConnectionRepository extends BaseRepository<
  ChannelConnectionDBModel,
  ChannelConnectionEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(ChannelConnection, ChannelConnectionEntity);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChannelConnectionRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-connection/channel-connection.schema.ts
Tamaño: 1267 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { ChannelConnectionDBModel } from './channel-connection.entity';

const channelConnectionSchema = new Schema<ChannelConnectionDBModel>(
  {
    identifier: {
      type: Schema.Types.String,
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      required: true,
      ref: 'Organization',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      required: true,
      ref: 'Environment',
    },
    integrationIdentifier: {
      type: Schema.Types.String,
      required: true,
    },
    providerId: {
      type: Schema.Types.String,
      required: true,
    },
    channel: {
      type: Schema.Types.String,
      required: true,
    },
    resource: {
      type: Schema.Types.String,
      required: true,
    },
    workspace: {
      type: Schema.Types.Mixed,
      required: true,
    },
    auth: {
      type: Schema.Types.Mixed,
      required: true,
    },
  },
  schemaOptions
);

export const ChannelConnection =
  (mongoose.models.ChannelConnection as mongoose.Model<ChannelConnectionDBModel>) ||
  mongoose.model<ChannelConnectionDBModel>('ChannelConnection', channelConnectionSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-connection/index.ts
Tamaño: 139 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './channel-connection.entity';
export * from './channel-connection.repository';
export * from './channel-connection.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-endpoint/channel-endpoint.entity.ts
Tamaño: 921 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ChannelEndpointByType,
  ChannelEndpointType,
  ChannelTypeEnum,
  IChannelEndpoint,
  ProvidersIdEnum,
  ResourceKey,
} from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class ChannelEndpointEntity<T extends ChannelEndpointType = ChannelEndpointType> implements IChannelEndpoint<T> {
  _id: string;
  identifier: string;

  _organizationId: OrganizationId;
  _environmentId: EnvironmentId;

  connectionIdentifier?: string;
  integrationIdentifier: string;

  providerId: ProvidersIdEnum;
  channel: ChannelTypeEnum;
  resource: ResourceKey;
  type: T;
  endpoint: ChannelEndpointByType[T];

  createdAt: string;
  updatedAt: string;
}

export type ChannelEndpointDBModel = ChangePropsValueType<ChannelEndpointEntity, '_environmentId' | '_organizationId'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChannelEndpointEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-endpoint/channel-endpoint.repository.ts
Tamaño: 475 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { ChannelEndpointDBModel, ChannelEndpointEntity } from './channel-endpoint.entity';
import { ChannelEndpoint } from './channel-endpoint.schema';

export class ChannelEndpointRepository extends BaseRepository<
  ChannelEndpointDBModel,
  ChannelEndpointEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(ChannelEndpoint, ChannelEndpointEntity);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ChannelEndpointRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-endpoint/channel-endpoint.schema.ts
Tamaño: 1538 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ENDPOINT_TYPES } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { ChannelEndpointDBModel } from './channel-endpoint.entity';

const channelEndpointSchema = new Schema<ChannelEndpointDBModel>(
  {
    identifier: {
      type: Schema.Types.String,
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      required: true,
      ref: 'Organization',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      required: true,
      ref: 'Environment',
    },
    connectionIdentifier: {
      type: Schema.Types.String,
      required: false,
    },
    integrationIdentifier: {
      type: Schema.Types.String,
      required: true,
    },
    providerId: {
      type: Schema.Types.String,
      required: true,
    },
    channel: {
      type: Schema.Types.String,
      required: true,
    },
    resource: {
      type: Schema.Types.String,
      required: true,
    },
    type: {
      type: Schema.Types.String,
      enum: Object.values(ENDPOINT_TYPES),
      required: true,
    },
    endpoint: {
      type: Schema.Types.Mixed,
      required: true,
    },
  },
  schemaOptions
);

channelEndpointSchema.index(
  {
    _environmentId: 1,
    identifier: 1,
  },
  {
    unique: true,
  }
);

export const ChannelEndpoint =
  (mongoose.models.ChannelEndpoint as mongoose.Model<ChannelEndpointDBModel>) ||
  mongoose.model<ChannelEndpointDBModel>('ChannelEndpoint', channelEndpointSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/channel-endpoint/index.ts
Tamaño: 133 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './channel-endpoint.entity';
export * from './channel-endpoint.repository';
export * from './channel-endpoint.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/context/context.entity.ts
Tamaño: 608 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Context, ContextData, ContextId, ContextType } from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class ContextEntity implements Context {
  _id: string;
  _organizationId: OrganizationId;
  _environmentId: EnvironmentId;

  id: ContextId;
  type: ContextType;
  data: ContextData;

  key: string;

  createdAt: string;
  updatedAt: string;
}

export type ContextDBModel = ChangePropsValueType<ContextEntity, '_environmentId' | '_organizationId'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ContextEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/context/context.repository.ts
Tamaño: 2594 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ContextData, ContextId, ContextPayload, ContextType, createContextKey } from '@novu/shared';
import { FilterQuery } from 'mongoose';
import type { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { ContextDBModel, ContextEntity } from './context.entity';
import { Context } from './context.schema';

export class ContextRepository extends BaseRepository<ContextDBModel, ContextEntity, EnforceEnvOrOrgIds> {
  constructor() {
    super(Context, ContextEntity);
  }

  async findOrCreateContextsFromPayload(
    environmentId: string,
    organizationId: string,
    contextPayload: ContextPayload
  ): Promise<ContextEntity[]> {
    const findOrCreatePromises = Object.entries(contextPayload).map(([type, value]) => {
      if (!value) return null;

      const { id, data } =
        typeof value === 'string' ? { id: value, data: undefined } : { id: value.id, data: value.data };

      return this.findOrCreateContext(environmentId, organizationId, type, id, data);
    });

    const validPromises = findOrCreatePromises.filter((promise): promise is Promise<ContextEntity> => promise !== null);

    return Promise.all(validPromises);
  }

  async findOrCreateContext(
    environmentId: string,
    organizationId: string,
    type: ContextType,
    id: ContextId,
    data?: ContextData
  ): Promise<ContextEntity> {
    const query = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      id,
      type,
    };

    const existingContext = await this.findOne(query);

    if (existingContext) {
      return existingContext;
    }

    const newContext: FilterQuery<ContextDBModel> & EnforceEnvOrOrgIds = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      id,
      type,
      key: createContextKey(type, id),
      data: data || {},
    };

    try {
      return await this.create(newContext);
    } catch (error) {
      const isDuplicateKeyError = error && typeof error === 'object' && 'code' in error && error.code === 11000;

      if (isDuplicateKeyError) {
        const context = await this.findOne(query);
        if (context) {
          return context;
        }
      }

      throw error;
    }
  }

  async findByKeys(environmentId: string, organizationId: string, contextKeys: string[]): Promise<ContextEntity[]> {
    if (contextKeys.length === 0) {
      return [];
    }

    const query = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      key: { $in: contextKeys },
    };

    return this.find(query);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - findOrCreatePromises(Object.entries(contextPayload).map(([type, value]))
 - validPromises(findOrCreatePromises.filter((promise): promise is Promise<ContextEntity>)
Declaraciones 'export' encontradas:
- export class ContextRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/context/context.schema.ts
Tamaño: 1189 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { ContextDBModel } from './context.entity';

const contextSchema = new Schema<ContextDBModel>(
  {
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
    id: {
      type: Schema.Types.String,
      required: true,
    },
    type: {
      type: Schema.Types.String,
      required: true,
    },
    key: {
      type: Schema.Types.String,
      required: true,
    },
    data: {
      type: Schema.Types.Mixed,
      required: false,
      default: {},
    },
  },
  { ...schemaOptions, minimize: false }
);

contextSchema.index(
  {
    _environmentId: 1,
    _organizationId: 1,
    type: 1,
    id: 1,
  },
  {
    unique: true,
  }
);

contextSchema.index(
  {
    _environmentId: 1,
    _organizationId: 1,
    key: 1,
  },
  {
    unique: true,
  }
);

export const Context =
  (mongoose.models.Context as mongoose.Model<ContextDBModel>) ||
  mongoose.model<ContextDBModel>('Context', contextSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/context/index.ts
Tamaño: 106 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './context.entity';
export * from './context.repository';
export * from './context.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/control-values/control-values.entity.ts
Tamaño: 359 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ControlValuesLevelEnum } from '@novu/shared';

export class ControlValuesEntity {
  _id: string;
  createdAt: string;
  updatedAt: string;
  _environmentId: string;
  _organizationId: string;
  level: ControlValuesLevelEnum;
  priority: number;
  controls: Record<string, unknown>;
  _workflowId?: string;
  _stepId?: string;
  _layoutId?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ControlValuesEntity

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/control-values/control-values.repository.ts
Tamaño: 1404 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ControlValuesLevelEnum } from '@novu/shared';
import { SoftDeleteModel } from 'mongoose-delete';
import { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { ControlValuesEntity } from './control-values.entity';
import { ControlValues, ControlValuesModel } from './control-values.schema';

export interface DeleteManyValuesQuery {
  _environmentId: string;
  _organizationId: string;
  _workflowId?: string;
  _stepId?: string;
  _layoutId?: string;
  level?: ControlValuesLevelEnum;
}

export interface FindControlValuesQuery {
  _environmentId: string;
  _organizationId: string;
  _workflowId?: string;
  _stepId?: string;
  _layoutId?: string;
  level?: ControlValuesLevelEnum;
  [key: string]: unknown;
}

export class ControlValuesRepository extends BaseRepository<
  ControlValuesModel,
  ControlValuesEntity,
  EnforceEnvOrOrgIds
> {
  private controlValues: SoftDeleteModel;

  constructor() {
    super(ControlValues, ControlValuesEntity);
    this.controlValues = ControlValues;
  }

  async deleteMany(query: DeleteManyValuesQuery) {
    return await super.delete(query);
  }

  async findMany(query: FindControlValuesQuery): Promise<ControlValuesEntity[]> {
    return await super.find(query);
  }

  async findFirst(query: FindControlValuesQuery): Promise<ControlValuesEntity | null> {
    return await this.findOne(query);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export class ControlValuesRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/control-values/control-values.schema.ts
Tamaño: 1317 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { ChangePropsValueType } from '../../types';
import { schemaOptions } from '../schema-default.options';
import { ControlValuesEntity } from './control-values.entity';

const mongooseDelete = require('mongoose-delete');

export type ControlValuesModel = ChangePropsValueType<
  ControlValuesEntity,
  '_environmentId' | '_organizationId' | '_workflowId' | '_layoutId'
>;

const controlValuesSchema = new Schema<ControlValuesModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _workflowId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _stepId: {
      type: Schema.Types.ObjectId,
    } as any,
    _layoutId: {
      type: Schema.Types.ObjectId,
      ref: 'Layout',
    },
    level: Schema.Types.String,
    priority: Schema.Types.Number,
    controls: Schema.Types.Mixed,
  },
  schemaOptions
);

controlValuesSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const ControlValues =
  (mongoose.models.ControlValues as mongoose.Model<ControlValuesModel>) ||
  mongoose.model<ControlValuesModel>('controls', controlValuesSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/control-values/index.ts
Tamaño: 127 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './control-values.entity';
export * from './control-values.repository';
export * from './control-values.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/environment/environment.entity.ts
Tamaño: 1300 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EncryptedSecret, EnvironmentTypeEnum, IApiRateLimitMaximum } from '@novu/shared';
import { Types } from 'mongoose';

import type { ChangePropsValueType } from '../../types/helpers';
import type { OrganizationId } from '../organization';

export interface IApiKey {
  /*
   * backward compatibility -
   * remove `string` type after encrypt-api-keys-migration run
   * remove the optional from hash
   */
  key: EncryptedSecret | string;
  hash?: string;
  _userId: string;
}

export interface IWidgetSettings {
  notificationCenterEncryption: boolean;
}

export interface IDnsSettings {
  mxRecordConfigured: boolean;
  inboundParseDomain: string;
}

export class EnvironmentEntity {
  _id: string;

  name: string;

  _organizationId: OrganizationId;

  identifier: string;

  apiKeys: IApiKey[];

  apiRateLimits?: IApiRateLimitMaximum;

  widget: IWidgetSettings;

  dns?: IDnsSettings;

  _parentId: string;

  color?: string;

  type: EnvironmentTypeEnum;

  echo: {
    url: string;
  };
  bridge: {
    url: string;
  };

  webhookAppId?: string;

  createdAt?: string;

  updatedAt?: string;
}

export type EnvironmentDBModel = ChangePropsValueType<
  Omit<EnvironmentEntity, 'apiKeys'>,
  '_organizationId' | '_parentId'
> & {
  apiKeys: IApiKey & { _userId: Types.ObjectId }[];
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export  interface
- export class EnvironmentEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/environment/environment.repository.ts
Tamaño: 2807 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { EncryptedSecret, IApiRateLimitMaximum } from '@novu/shared';
import { BaseRepository } from '../base-repository';
import { EnvironmentDBModel, EnvironmentEntity, IApiKey } from './environment.entity';
import { Environment } from './environment.schema';

export class EnvironmentRepository extends BaseRepository<EnvironmentDBModel, EnvironmentEntity, object> {
  constructor() {
    super(Environment, EnvironmentEntity);
  }

  async findEnvironmentByIdentifier(identifier: string) {
    const data = await this.MongooseModel.findOne({ identifier }).read('secondaryPreferred');
    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  async updateApiKeyUserId(organizationId: string, oldUserId: string, newUserId: string) {
    return await this.update(
      {
        _organizationId: organizationId,
        'apiKeys._userId': oldUserId,
      },
      {
        $set: {
          'apiKeys.$._userId': newUserId,
        },
      }
    );
  }

  async findOrganizationEnvironments(organizationId: string) {
    return this.find({
      _organizationId: organizationId,
    });
  }

  async findByIdAndOrganization(environmentId: string, organizationId: string) {
    return this.findOne({
      _id: environmentId,
      _organizationId: organizationId,
    });
  }

  async addApiKey(environmentId: string, key: EncryptedSecret, userId: string) {
    return await this.update(
      {
        _id: environmentId,
      },
      {
        $push: {
          apiKeys: {
            key,
            _userId: userId,
          },
        },
      }
    );
  }

  async findByApiKey({ hash }: { hash: string }) {
    return await this.findOne({ 'apiKeys.hash': hash }, '_id _organizationId apiKeys', {
      readPreference: 'secondaryPreferred',
    });
  }

  async getApiKeys(environmentId: string): Promise<IApiKey[]> {
    const environment = await this.findOne(
      {
        _id: environmentId,
      },
      'apiKeys'
    );
    if (!environment) return [];

    return environment.apiKeys;
  }

  async updateApiKey(environmentId: string, key: EncryptedSecret, userId: string, hash?: string) {
    await this.update(
      {
        _id: environmentId,
      },
      {
        $set: {
          apiKeys: [
            {
              key,
              _userId: userId,
              hash,
            },
          ],
        },
      }
    );

    return await this.getApiKeys(environmentId);
  }

  async updateApiRateLimits(environmentId: string, apiRateLimits: Partial<IApiRateLimitMaximum>) {
    return await this.update(
      {
        _id: environmentId,
      },
      [
        {
          $set: {
            apiRateLimits: {
              $mergeObjects: ['$apiRateLimits', apiRateLimits],
            },
          },
        },
      ]
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class EnvironmentRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/environment/environment.schema.ts
Tamaño: 3169 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiRateLimitCategoryEnum, EnvironmentEnum, EnvironmentTypeEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { EnvironmentDBModel } from './environment.entity';

const environmentSchema = new Schema<EnvironmentDBModel>(
  {
    name: Schema.Types.String,
    identifier: {
      type: Schema.Types.String,
      unique: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    apiKeys: [
      {
        key: {
          type: Schema.Types.String,
          unique: true,
        },
        hash: Schema.Types.String,
        _userId: {
          type: Schema.Types.ObjectId,
          ref: 'User',
        },
      },
    ],
    apiRateLimits: {
      [ApiRateLimitCategoryEnum.TRIGGER]: Schema.Types.Number,
      [ApiRateLimitCategoryEnum.CONFIGURATION]: Schema.Types.Number,
      [ApiRateLimitCategoryEnum.GLOBAL]: Schema.Types.Number,
    },
    widget: {
      notificationCenterEncryption: {
        type: Schema.Types.Boolean,
        default: false,
      },
    },
    dns: {
      mxRecordConfigured: {
        type: Schema.Types.Boolean,
      },
      inboundParseDomain: {
        type: Schema.Types.String,
      },
    },
    echo: {
      url: Schema.Types.String,
    },
    bridge: {
      url: Schema.Types.String,
    },
    webhookAppId: {
      type: Schema.Types.String,
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    color: Schema.Types.String,
    type: {
      type: Schema.Types.String,
      enum: Object.values(EnvironmentTypeEnum),
    },
  },
  schemaOptions
);

/*
 * Path: ./get-platform-notification-usage.usecase.ts
 *    Context: execute()
 *        Query: organizationRepository.aggregate(
 *                $lookup:
 *        {
 *          from: 'environments',
 *          localField: '_id',
 *          foreignField: '_organizationId',
 *          as: 'environments',
 *        }
 */
environmentSchema.index({
  _organizationId: 1,
});

environmentSchema.index({
  'apiKeys.hash': 1,
});

environmentSchema.index(
  {
    identifier: 1,
  },
  { unique: true }
);

environmentSchema.index(
  {
    'apiKeys.key': 1,
  },
  {
    unique: true,
  }
);

// To provide backward compatibility with environments created before the type field was added
environmentSchema.post(['find', 'findOne', 'findOneAndUpdate'], (docs) => {
  const processDoc = (document: any) => {
    if (document && !document.type) {
      let defaultType = EnvironmentTypeEnum.PROD;
      if (document.name === EnvironmentEnum.DEVELOPMENT) {
        defaultType = EnvironmentTypeEnum.DEV;
      } else if (document.name === EnvironmentEnum.PRODUCTION) {
        defaultType = EnvironmentTypeEnum.PROD;
      }
      Object.assign(document, { type: defaultType });
    }
  };

  if (Array.isArray(docs)) {
    docs.forEach(processDoc);
  } else if (docs) {
    processDoc(docs);
  }
});

export const Environment =
  (mongoose.models.Environment as mongoose.Model<EnvironmentDBModel>) ||
  mongoose.model<EnvironmentDBModel>('Environment', environmentSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - environmentSchema(new Schema<EnvironmentDBModel>(
  {
    name: Schema.Types.String,
    identifier: {
      type: Sch...)
 - processDoc(document: any))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/environment/index.ts
Tamaño: 105 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './environment.entity';
export * from './environment.repository';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/environment/types.ts
Tamaño: 36 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type EnvironmentId = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/execution-details/execution-details.entity.ts
Tamaño: 998 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum, StepTypeEnum } from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class ExecutionDetailsEntity {
  _id: string;
  _jobId: string;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  _notificationId: string;
  _notificationTemplateId: string;
  _subscriberId: string;
  _messageId?: string;
  providerId?: string;
  transactionId: string;
  channel?: StepTypeEnum;
  detail: string;
  source: ExecutionDetailsSourceEnum;
  status: ExecutionDetailsStatusEnum;
  isTest: boolean;
  isRetry: boolean;
  createdAt: string;
  raw?: string | null;
  webhookStatus?: string;
}

export type ExecutionDetailsDBModel = ChangePropsValueType<
  ExecutionDetailsEntity,
  '_environmentId' | '_organizationId' | '_notificationId' | '_notificationTemplateId' | '_subscriberId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExecutionDetailsEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/execution-details/execution-details.repository.ts
Tamaño: 1454 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExecutionDetailsStatusEnum } from '@novu/shared';
import { EnforceEnvId } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { ExecutionDetailsDBModel, ExecutionDetailsEntity } from './execution-details.entity';
import { ExecutionDetails } from './execution-details.schema';

/**
 * Execution details is meant to be read only almost exclusively as a log history of the Jobs executions.
 */
export class ExecutionDetailsRepository extends BaseRepository<
  ExecutionDetailsDBModel,
  ExecutionDetailsEntity,
  EnforceEnvId
> {
  constructor() {
    super(ExecutionDetails, ExecutionDetailsEntity);
  }

  /**
   * As we have a status of potentially read confirmation for notifications that might have that kind
   * of confirmation there is potentially use of this method
   */
  public async updateStatus(environmentId: string, executionDetailsId: string, status: ExecutionDetailsStatusEnum) {
    await this.update(
      {
        _environmentId: environmentId,
        _id: executionDetailsId,
      },
      {
        $set: {
          status,
        },
      }
    );
  }

  /**
   * Activity feed might need to retrieve all the executions of a notification.
   */
  public async findAllNotificationExecutions(organizationId: string, environmentId: string, notificationId: string) {
    return await this.find({
      _environmentId: environmentId,
      _notificationId: notificationId,
    });
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class ExecutionDetailsRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/execution-details/execution-details.schema.ts
Tamaño: 3054 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ExecutionDetailsSourceEnum, ExecutionDetailsStatusEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { ExecutionDetailsDBModel } from './execution-details.entity';

const executionDetailsSchema = new Schema<ExecutionDetailsDBModel>(
  {
    _jobId: {
      type: Schema.Types.String,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _notificationId: {
      type: Schema.Types.ObjectId,
      ref: 'Notification',
    },
    _notificationTemplateId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    _messageId: {
      type: Schema.Types.String,
    },
    providerId: {
      type: Schema.Types.String,
    },
    transactionId: {
      type: Schema.Types.String,
    },
    channel: {
      type: Schema.Types.String,
    },
    detail: {
      type: Schema.Types.String,
    },
    source: {
      type: Schema.Types.String,
      default: ExecutionDetailsSourceEnum.CREDENTIALS,
    },
    status: {
      type: Schema.Types.String,
      default: ExecutionDetailsStatusEnum.PENDING,
    },
    isTest: {
      type: Schema.Types.Boolean,
    },
    isRetry: {
      type: Schema.Types.Boolean,
    },
    raw: {
      type: Schema.Types.String,
    },
    webhookStatus: {
      type: Schema.Types.String,
    },
  },
  schemaOptions
);

/*
 * This index was initially created to optimize:
 *
 * Path : libs/dal/src/repositories/job/job.schema.ts
 *    Context : The _jobId is here because of JobSchema
 *                                            ref: 'ExecutionDetails',
 *                                            foreignField: '_jobId',
 *
 *
 *  Path : apps/api/src/app/events/usecases/message-matcher/message-matcher.usecase.ts
 *    Context : processPreviousStep
 *    Query : count({
 *      _jobId: command.job._parentId,
 *      _messageId: message._id,
 *      _environmentId: command.environmentId,
 *      webhookStatus: EmailEventStatusEnum.OPENED,
 *    });
 */
executionDetailsSchema.index({
  _jobId: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path : apps/api/src/app/execution-details/usecases/get-execution-details/get-execution-details.usecase.ts
 *    Context : execute()
 *        Query : find({
 *         _notificationId: command.notificationId,
 *         _environmentId: command.environmentId,
 *         _subscriberId: command.subscriberId,
 *      });
 */
executionDetailsSchema.index({
  _notificationId: 1,
});

/*
 * This index was created to push entries to Online Archive
 */
executionDetailsSchema.index({ createdAt: 1 });

export const ExecutionDetails =
  (mongoose.models.ExecutionDetails as mongoose.Model<ExecutionDetailsDBModel>) ||
  mongoose.model<ExecutionDetailsDBModel>('ExecutionDetails', executionDetailsSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/execution-details/index.ts
Tamaño: 136 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './execution-details.entity';
export * from './execution-details.repository';
export * from './execution-details.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/feed/feed.entity.ts
Tamaño: 426 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class FeedEntity {
  _id: string;

  name: string;

  identifier: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;
}

export type FeedDBModel = ChangePropsValueType<FeedEntity, '_environmentId' | '_organizationId'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FeedEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/feed/feed.repository.ts
Tamaño: 1451 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FilterQuery } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { MessageTemplateRepository } from '../message-template';
import { FeedDBModel, FeedEntity } from './feed.entity';
import { Feed } from './feed.schema';

export class FeedRepository extends BaseRepository<FeedDBModel, FeedEntity, EnforceEnvOrOrgIds> {
  private feed: SoftDeleteModel;
  private messageTemplateRepository = new MessageTemplateRepository();
  constructor() {
    super(Feed, FeedEntity);
    this.feed = Feed;
  }

  async delete(query: FilterQuery<FeedEntity>) {
    const feed = await this.findOne({ _id: query._id, _environmentId: query._environmentId });
    if (!feed || !feed?._id) throw new DalException(`Could not find feed with id ${query._id}`);
    const relatedMessages = await this.messageTemplateRepository.getMessageTemplatesByFeed(
      feed._environmentId,
      feed._id
    );
    if (relatedMessages.length) throw new DalException(`Can not delete feed that has existing message`);

    return await this.feed.delete({ _id: feed._id, _environmentId: feed._environmentId });
  }

  async findDeleted(query: FilterQuery<FeedEntity>): Promise<FeedEntity> {
    const res: FeedEntity = await this.feed.findDeleted(query);

    return this.mapEntity(res);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FeedRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/feed/feed.schema.ts
Tamaño: 962 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { FeedDBModel } from './feed.entity';

const mongooseDelete = require('mongoose-delete');

const feedSchema = new Schema<FeedDBModel>(
  {
    name: Schema.Types.String,
    identifier: {
      type: Schema.Types.String,
      index: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
  },
  schemaOptions
);

feedSchema.index({
  _organizationId: 1,
});

feedSchema.index({
  _environmentId: 1,
});

feedSchema.index({
  identifier: 1,
});

feedSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const Feed =
  (mongoose.models.Feed as mongoose.Model<FeedDBModel>) || mongoose.model<FeedDBModel>('Feed', feedSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/feed/index.ts
Tamaño: 97 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './feed.entity';
export * from './feed.repository';
export * from './feed.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/integration/index.ts
Tamaño: 80 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './integration.entity';
export * from './integration.repository';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/integration/integration.entity.ts
Tamaño: 1073 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, IConfigurations, ICredentials } from '@novu/shared';
import { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import { StepFilter } from '../notification-template';
import type { OrganizationId } from '../organization';

export type ICredentialsEntity = ICredentials;

export type ConfigConfigurationEntity = IConfigurations;

export class IntegrationEntity {
  _id: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;

  providerId: string;

  channel: ChannelTypeEnum;

  credentials: ICredentialsEntity;

  configurations?: ConfigConfigurationEntity;

  active: boolean;

  name: string;

  identifier: string;

  priority: number;

  primary: boolean;

  deleted: boolean;

  deletedAt?: string;

  deletedBy?: string;

  conditions?: StepFilter[];

  connected?: boolean;
}

export type IntegrationDBModel = ChangePropsValueType<IntegrationEntity, '_environmentId' | '_organizationId'>;

export type ProviderCount = {
  providerId: string;
  count: number;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export class IntegrationEntity
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/integration/integration.repository.ts
Tamaño: 4550 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { NOVU_PROVIDERS } from '@novu/shared';
import { FilterQuery } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds, IDeleteResult } from '../../types';

import { BaseRepository } from '../base-repository';
import { IntegrationDBModel, IntegrationEntity, ProviderCount } from './integration.entity';
import { Integration } from './integration.schema';

export type IntegrationQuery = FilterQuery<IntegrationDBModel> & EnforceEnvOrOrgIds;

export class IntegrationRepository extends BaseRepository<IntegrationDBModel, IntegrationEntity, EnforceEnvOrOrgIds> {
  private integration: SoftDeleteModel;
  constructor() {
    super(Integration, IntegrationEntity);
    this.integration = Integration;
  }

  async find(
    query: IntegrationQuery,
    select = '',
    options: { limit?: number; sort?: any; skip?: number } = {}
  ): Promise<IntegrationEntity[]> {
    return super.find(query, select, options);
  }

  async findByEnvironmentId(environmentId: string): Promise<IntegrationEntity[]> {
    return await this.find({
      _environmentId: environmentId,
    });
  }

  async findHighestPriorityIntegration({
    _organizationId,
    _environmentId,
    channel,
  }: Pick<IntegrationEntity, '_environmentId' | '_organizationId' | 'channel'>) {
    return await this.findOne(
      {
        _organizationId,
        _environmentId,
        channel,
        active: true,
      },
      undefined,
      { query: { sort: { priority: -1 } } }
    );
  }

  async countActiveExcludingNovu({
    _organizationId,
    _environmentId,
    channel,
  }: Pick<IntegrationEntity, '_environmentId' | '_organizationId' | 'channel'>) {
    return await this.count({
      _organizationId,
      _environmentId,
      channel,
      active: true,
      providerId: {
        $nin: NOVU_PROVIDERS,
      },
    });
  }

  async create(data: IntegrationQuery): Promise<IntegrationEntity> {
    return await super.create(data);
  }

  async delete(query: IntegrationQuery) {
    return await this.integration.delete({ _id: query._id, _organizationId: query._organizationId });
  }

  async deleteMany(query: IntegrationQuery): Promise<IDeleteResult> {
    const { _environmentId, _organizationId } = query || {};
    if (!_environmentId || !_organizationId) {
      throw new DalException(
        'Deletion operation blocked for missing any of these properties: [_environmentId, _organizationId]. We are avoiding a potential unexpected multiple deletion'
      );
    }

    const { acknowledged, modifiedCount, matchedCount } = await this.integration.delete(query);

    if (matchedCount === 0 || modifiedCount === 0) {
      throw new DalException(
        `Deletion of many integrations in environment ${_environmentId} and organization ${_organizationId}  was not performed properly`
      );
    }

    return {
      modifiedCount,
      matchedCount,
    };
  }

  async findDeleted(query: IntegrationQuery): Promise<IntegrationEntity> {
    const res: IntegrationEntity = await this.integration.findDeleted(query);

    return this.mapEntity(res);
  }

  async recalculatePriorityForAllActive({
    _id,
    _organizationId,
    _environmentId,
    channel,
  }: Pick<IntegrationEntity, '_environmentId' | '_organizationId' | 'channel'> & {
    _id?: string;
    exclude?: boolean;
  }) {
    const otherActiveIntegrations = await this.find(
      {
        _organizationId,
        _environmentId,
        channel,
        active: true,
        ...(_id && {
          _id: {
            $nin: [_id],
          },
        }),
      },
      '_id',
      { sort: { priority: -1 } }
    );

    let ids = otherActiveIntegrations.map((integration) => integration._id);
    if (_id) {
      ids = [_id, ...otherActiveIntegrations.map((integration) => integration._id)];
    }

    const promises = ids.map((id, index) =>
      this.update(
        {
          _id: id,
          _organizationId,
          _environmentId,
        },
        {
          $set: {
            priority: ids.length - index,
          },
        }
      )
    );
    await Promise.all(promises);
  }

  async sumByProviderId(): Promise<ProviderCount[]> {
    const res = await this.integration.aggregate<ProviderCount[]>([
      {
        $group: {
          _id: '$providerId',
          count: { $sum: 1 },
        },
      },
      {
        $project: {
          _id: 0,
          providerId: '$_id',
          count: 1,
        },
      },
    ]);

    return res;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - ids(otherActiveIntegrations.map((integration))
 - ids([_id, ...otherActiveIntegrations.map((integration))
 - promises(ids.map((id, index))
Declaraciones 'export' encontradas:
- export  type
- export class IntegrationRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/integration/integration.schema.ts
Tamaño: 3696 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { IntegrationDBModel } from './integration.entity';

const mongooseDelete = require('mongoose-delete');

const integrationSchema = new Schema<IntegrationDBModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    providerId: Schema.Types.String,
    channel: Schema.Types.String,
    credentials: {
      apiVersion: Schema.Types.String,
      apiKey: Schema.Types.String,
      user: Schema.Types.String,
      secretKey: Schema.Types.String,
      domain: Schema.Types.String,
      password: Schema.Types.String,
      host: Schema.Types.String,
      port: Schema.Types.String,
      secure: Schema.Types.Boolean,
      region: Schema.Types.String,
      accountSid: Schema.Types.String,
      messageProfileId: Schema.Types.String,
      token: Schema.Types.String,
      from: Schema.Types.String,
      senderName: Schema.Types.String,
      applicationId: Schema.Types.String,
      clientId: Schema.Types.String,
      projectName: Schema.Types.String,
      serviceAccount: Schema.Types.String,
      baseUrl: Schema.Types.String,
      webhookUrl: Schema.Types.String,
      requireTls: Schema.Types.Boolean,
      ignoreTls: Schema.Types.Boolean,
      tlsOptions: Schema.Types.Mixed,
      redirectUrl: Schema.Types.String,
      hmac: Schema.Types.Boolean,
      ipPoolName: Schema.Types.String,
      apiKeyRequestHeader: Schema.Types.String,
      secretKeyRequestHeader: Schema.Types.String,
      idPath: Schema.Types.String,
      datePath: Schema.Types.String,
      authenticateByToken: Schema.Types.Boolean,
      authenticationTokenKey: Schema.Types.String,
      instanceId: Schema.Types.String,
      alertUid: Schema.Types.String,
      title: Schema.Types.String,
      imageUrl: Schema.Types.String,
      state: Schema.Types.String,
      externalLink: Schema.Types.String,
      apiToken: Schema.Types.String,
      channelId: Schema.Types.String,
      phoneNumberIdentification: Schema.Types.String,
      accessKey: Schema.Types.String,
      appSid: Schema.Types.String,
      senderId: Schema.Types.String,
      servicePlanId: Schema.Types.String,
    },
    configurations: {
      inboundWebhookEnabled: Schema.Types.Boolean,
      inboundWebhookSigningKey: Schema.Types.String,
      configurationSetName: Schema.Types.String,
    },
    active: {
      type: Schema.Types.Boolean,
      default: false,
    },
    name: Schema.Types.String,
    identifier: Schema.Types.String,
    priority: {
      type: Schema.Types.Number,
      default: 0,
    },
    primary: {
      type: Schema.Types.Boolean,
      default: false,
    },
    conditions: [
      {
        isNegated: Schema.Types.Boolean,
        type: {
          type: Schema.Types.String,
        },
        value: Schema.Types.String,
        children: [
          {
            field: Schema.Types.String,
            value: Schema.Types.Mixed,
            operator: Schema.Types.String,
            on: Schema.Types.String,
          },
        ],
      },
    ],
    connected: Schema.Types.Boolean,
  },
  schemaOptions
);

integrationSchema.index({
  _organizationId: 1,
  active: 1,
});

integrationSchema.index({
  _environmentId: 1,
});

integrationSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const Integration =
  (mongoose.models.Integration as mongoose.Model<IntegrationDBModel>) ||
  mongoose.model<IntegrationDBModel>('Integration', integrationSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/job/index.ts
Tamaño: 94 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './job.entity';
export * from './job.repository';
export * from './job.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/job/job.entity.ts
Tamaño: 1878 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  ITenantDefine,
  IWorkflowStepMetadata,
  JobStatusEnum,
  StepTypeEnum,
  TriggerOverrides,
  WorkflowPreferences,
} from '@novu/shared';
import { Types } from 'mongoose';
import type { ChangePropsValueType } from '../../types';
import type { EnvironmentId } from '../environment';
import { NotificationStepEntity } from '../notification-template';
import type { OrganizationId } from '../organization';

export { JobStatusEnum };

export type DeliveryLifecycleState = {
  status?: DeliveryLifecycleStatusEnum;
  detail?: DeliveryLifecycleDetail;
};

export class JobEntity {
  _id: string;
  identifier: string;
  payload: any;
  overrides: TriggerOverrides;
  step: NotificationStepEntity;
  tenant?: ITenantDefine;
  transactionId: string;
  _notificationId: string;
  subscriberId: string;
  _subscriberId: string;
  _mergedDigestId?: string | null;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  providerId?: string;
  _userId: string;
  delay?: number;
  _parentId?: string;
  status: JobStatusEnum;
  deliveryLifecycleState?: DeliveryLifecycleState;
  error?: any;
  createdAt: string;
  updatedAt: string;
  _templateId: string;
  digest?: IWorkflowStepMetadata & {
    events?: any[];
  };
  type?: StepTypeEnum;
  _actorId?: string;
  actorId?: string;
  stepOutput?: Record<string, unknown>;
  preferences?: WorkflowPreferences;
  contextKeys?: string[];
  /**
   * used to track the number of times a step has been extended to the next available time in the subscriber schedule
   */
  scheduleExtensionsCount?: number;
}

export type JobDBModel = ChangePropsValueType<
  Omit<JobEntity, '_parentId' | '_actorId'>,
  '_notificationId' | '_subscriberId' | '_environmentId' | '_organizationId' | '_userId'
> & {
  _parentId?: Types.ObjectId;

  _actorId?: Types.ObjectId;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export  type
- export class JobEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/job/job.repository.ts
Tamaño: 9444 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  DeliveryLifecycleDetail,
  DeliveryLifecycleStatusEnum,
  DigestCreationResultEnum,
  IDigestBaseMetadata,
  IDigestRegularMetadata,
  StepTypeEnum,
} from '@novu/shared';
import { sub } from 'date-fns';
import { ProjectionType } from 'mongoose';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds, IUpdateResult } from '../../types';
import { BaseRepository } from '../base-repository';
import { EnvironmentEntity } from '../environment';
import { NotificationEntity } from '../notification';
import { NotificationTemplateEntity } from '../notification-template';
import { SubscriberEntity } from '../subscriber';
import { DeliveryLifecycleState, JobDBModel, JobEntity, JobStatusEnum } from './job.entity';
import { Job } from './job.schema';

type JobEntityPopulated = JobEntity & {
  template: NotificationTemplateEntity;
  notification: NotificationEntity;
  subscriber: SubscriberEntity;
  environment: EnvironmentEntity;
};

export interface IDelayOrDigestJobResult {
  digestResult: DigestCreationResultEnum;
  activeDigestId?: string;
  activeNotificationId?: string;
}

export class JobRepository extends BaseRepository<JobDBModel, JobEntity, EnforceEnvOrOrgIds> {
  constructor() {
    super(Job, JobEntity);
  }

  public async storeJobs(jobs: Omit<JobEntity, '_id' | 'createdAt' | 'updatedAt'>[]): Promise<JobEntity[]> {
    const stored: JobEntity[] = [];
    for (let index = 0; index < jobs.length; index += 1) {
      if (index > 0) {
        jobs[index]._parentId = stored[index - 1]._id;
      }

      const created = new this.MongooseModel({ ...jobs[index], createdAt: Date.now() });

      stored.push(this.mapEntity(created));
    }

    await this.insertMany(stored, true);

    return stored;
  }

  public async updateStatus(
    environmentId: string,
    jobId: string,
    status: JobStatusEnum,
    deliveryLifecycleState?: DeliveryLifecycleState
  ): Promise<JobEntity | null> {
    return this.MongooseModel.findOneAndUpdate(
      {
        _environmentId: environmentId,
        _id: jobId,
      },
      {
        $set: {
          status,
          deliveryLifecycleState,
        },
      },
      { new: true }
    );
  }

  public async setError(organizationId: string, jobId: string, error: any): Promise<void> {
    const result = await this._model.updateOne(
      {
        _organizationId: this.convertStringToObjectId(organizationId),
        _id: this.convertStringToObjectId(jobId),
      },
      {
        $set: {
          error,
        },
      }
    );

    if (result.modifiedCount === 0) {
      throw new DalException(
        `There was a problem when trying to set an error for the job ${jobId} in the organization ${organizationId}`
      );
    }
  }

  public async findJobsToDigest(
    from: Date,
    templateId: string,
    environmentId: string,
    subscriberId: string,
    digestKey?: string,
    digestValue?: string | number
  ) {
    /**
     * Remove digest jobs that have been completed and currently delayed jobs that have a digest pending.
     */
    const digests = await this.find({
      updatedAt: {
        $gte: from,
      },
      _templateId: templateId,
      $or: [
        { status: JobStatusEnum.COMPLETED, type: StepTypeEnum.DIGEST },
        { status: JobStatusEnum.DELAYED, type: StepTypeEnum.DELAY },
      ],
      _environmentId: environmentId,
      _subscriberId: subscriberId,
    });
    const transactionIds = digests.map((job) => job.transactionId);

    const result = await this.find({
      updatedAt: {
        $gte: from,
      },
      _templateId: templateId,
      status: JobStatusEnum.COMPLETED,
      type: StepTypeEnum.TRIGGER,
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      ...(digestKey && { [`payload.${digestKey}`]: digestValue }),
      transactionId: {
        $nin: transactionIds,
      },
    });

    const transactionIdsTriggers = result.map((job) => job.transactionId);

    /**
     * Update events that have been digested (events that have been sent) to be of status completed.
     * To avoid cases of same events being sent multiple times.
     * Happens in cases of delay followed by digest
     */
    await this.update(
      {
        updatedAt: {
          $gte: from,
        },
        _templateId: templateId,
        status: JobStatusEnum.PENDING,
        type: StepTypeEnum.DIGEST,
        _environmentId: environmentId,
        _subscriberId: subscriberId,
        transactionId: {
          $in: transactionIdsTriggers,
        },
      },
      {
        $set: {
          status: JobStatusEnum.COMPLETED,
        },
      }
    );

    return result;
  }

  public async findOnePopulate({
    query,
    select = '',
    selectTemplate = '',
    selectNotification = '',
    selectSubscriber = '',
    selectEnvironment = '',
  }: {
    query: { _environmentId: string; transactionId: string };
    select?: ProjectionType<JobEntity>;
    selectTemplate?: ProjectionType<NotificationTemplateEntity>;
    selectNotification?: ProjectionType<NotificationEntity>;
    selectSubscriber?: ProjectionType<SubscriberEntity>;
    selectEnvironment?: ProjectionType<EnvironmentEntity>;
  }) {
    const job = this.MongooseModel.findOne(query, select)
      .populate('template', selectTemplate)
      .populate('notification', selectNotification)
      .populate('subscriber', selectSubscriber)
      .populate('environment', selectEnvironment)
      .lean()
      .exec();

    return job as unknown as JobEntityPopulated;
  }

  public async markJobAsDigestMaster(job: JobEntity) {
    await this._model.updateOne(
      {
        _environmentId: job._environmentId,
        _templateId: job._templateId,
        _subscriberId: job._subscriberId,
        _id: job._id,
      },
      {
        $set: {
          status: JobStatusEnum.DELAYED,
        },
      }
    );
  }

  public async getExistingDelayedJobWithTheSameDigestValue(job: JobEntity, digestMeta?: IDigestBaseMetadata) {
    const findOne = await this._model.findOne(
      {
        status: JobStatusEnum.DELAYED,
        type: StepTypeEnum.DIGEST,
        _templateId: job._templateId,
        _environmentId: this.convertStringToObjectId(job._environmentId),
        _subscriberId: this.convertStringToObjectId(job._subscriberId),
        'digest.digestValue': digestMeta?.digestValue,
      },
      '_id _notificationId'
    );

    return findOne != null ? { _id: findOne._id, _notificationId: findOne._notificationId } : null;
  }

  private getBackoffDate(metadata: IDigestRegularMetadata | undefined) {
    return sub(new Date(), {
      [metadata?.backoffUnit as string]: metadata?.backoffAmount,
    });
  }

  public async getAnotherJobTriggeredWithinBackoffTime(
    job: JobEntity,
    metadata?: IDigestRegularMetadata | undefined
  ): Promise<JobEntity[] | undefined> {
    const otherDigestJobsWithSameDigestKeyValue = await this.find(this.buildLookBackDigestQuery(metadata, job));

    return await this.find({
      status: JobStatusEnum.COMPLETED,
      type: StepTypeEnum.TRIGGER,
      _organizationId: job._organizationId,
      transactionId: { $in: otherDigestJobsWithSameDigestKeyValue.map((job1) => job1.transactionId) },
    });
  }
  private buildLookBackDigestQuery(metadata: IDigestRegularMetadata | undefined, job: JobEntity) {
    return {
      createdAt: {
        $gte: this.getBackoffDate(metadata),
      },
      _notificationId: {
        $ne: job._notificationId,
      },
      _templateId: job._templateId,
      status: { $in: [JobStatusEnum.PENDING, JobStatusEnum.SKIPPED, JobStatusEnum.COMPLETED] },
      type: StepTypeEnum.DIGEST,
      _environmentId: job._environmentId,
      _subscriberId: job._subscriberId,
      'digest.digestValue': metadata?.digestValue,
    };
  }

  async updateAllChildJobStatus(job: JobEntity, status: JobStatusEnum, activeDigestId: string): Promise<JobEntity[]> {
    const updatedJobs: JobEntity[] = [];

    let childJob: JobEntity | null = await this.MongooseModel.findOneAndUpdate<JobEntity>(
      {
        _environmentId: job._environmentId,
        _parentId: job._id,
      },
      {
        $set: {
          status,
          _mergedDigestId: activeDigestId,
        },
      }
    );

    if (childJob) {
      updatedJobs.push(childJob);
    }

    while (childJob) {
      childJob = await this.MongooseModel.findOneAndUpdate<JobEntity>(
        {
          _environmentId: job._environmentId,
          _parentId: childJob._id,
        },
        {
          $set: {
            status,
            _mergedDigestId: activeDigestId,
          },
        }
      );

      if (childJob) {
        updatedJobs.push(childJob);
      }
    }

    return updatedJobs;
  }

  public async cancelPendingJobs({
    _environmentId,
    transactionId,
    _subscriberId,
    _templateId,
  }: {
    _environmentId: string;
    transactionId: string;
    _subscriberId: string;
    _templateId: string;
  }): Promise<IUpdateResult> {
    return this.MongooseModel.updateMany(
      {
        _environmentId,
        _subscriberId,
        _templateId,
        status: JobStatusEnum.PENDING,
        transactionId,
      },
      {
        $set: {
          status: JobStatusEnum.CANCELED,
          deliveryLifecycleState: {
            status: DeliveryLifecycleStatusEnum.CANCELED,
            detail: DeliveryLifecycleDetail.EXECUTION_STOPPED,
          },
        },
      }
    );
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - transactionIds(digests.map((job))
 - transactionIdsTriggers(result.map((job))
 - otherDigestJobsWithSameDigestKeyValue(await this.find(this.buildLookBackDigestQuery(metadata, job));

    return await this.find({
      s...)
Declaraciones 'export' encontradas:
- export  interface
- export class JobRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/job/job.schema.ts
Tamaño: 12093 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { JobDBModel, JobStatusEnum } from './job.entity';

const jobSchema = new Schema<JobDBModel>(
  {
    identifier: {
      type: Schema.Types.String,
    },
    status: {
      type: Schema.Types.String,
      default: JobStatusEnum.PENDING,
    },
    deliveryLifecycleState: {
      type: {
        status: {
          type: Schema.Types.String,
        },
        detail: {
          type: Schema.Types.String,
        },
      },
    },
    payload: {
      type: Schema.Types.Mixed,
    },
    overrides: {
      type: Schema.Types.Mixed,
    },
    tenant: {
      type: Schema.Types.Mixed,
    },
    contextKeys: {
      type: [Schema.Types.String],
      default: undefined,
    },
    step: {
      type: Schema.Types.Mixed,
    },
    _templateId: {
      type: Schema.Types.String,
      ref: 'NotificationTemplate',
    },
    transactionId: {
      type: Schema.Types.String,
    },
    delay: {
      type: Schema.Types.Number,
    },
    _notificationId: {
      type: Schema.Types.ObjectId,
      ref: 'Notification',
    },
    _mergedDigestId: {
      type: String,
      ref: 'Job',
    },
    subscriberId: {
      type: Schema.Types.String,
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    _userId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'Job',
    },
    error: {
      type: Schema.Types.Mixed,
    },
    digest: {
      events: [Schema.Types.Mixed],
      amount: {
        type: Schema.Types.Number,
      },
      unit: {
        type: Schema.Types.String,
      },
      digestKey: {
        type: Schema.Types.String,
      },
      digestValue: {
        type: Schema.Types.String,
      },
      type: {
        type: Schema.Types.String,
      },
      backoffUnit: {
        type: Schema.Types.String,
      },
      backoffAmount: {
        type: Schema.Types.Number,
      },
      updateMode: {
        type: Schema.Types.Boolean,
      },
      backoff: {
        type: Schema.Types.Boolean,
      },
      timed: {
        cronExpression: {
          type: Schema.Types.String,
        },
        untilDate: {
          type: Schema.Types.String,
        },
        atTime: {
          type: Schema.Types.String,
        },
        weekDays: [Schema.Types.String],
        monthDays: [Schema.Types.Number],
        ordinal: {
          type: Schema.Types.String,
        },
        ordinalValue: {
          type: Schema.Types.String,
        },
        monthlyType: {
          type: Schema.Types.String,
        },
      },
    },
    type: {
      type: Schema.Types.String,
    },
    providerId: {
      type: Schema.Types.String,
    },
    _actorId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    actorId: {
      type: Schema.Types.String,
    },
    stepOutput: Schema.Types.Mixed,
    preferences: Schema.Types.Mixed,
    scheduleExtensionsCount: {
      type: Schema.Types.Number,
    },
  },
  schemaOptions
);

jobSchema.virtual('executionDetails', {
  ref: 'ExecutionDetails',
  localField: '_id',
  foreignField: '_jobId',
});

jobSchema.virtual('template', {
  ref: 'NotificationTemplate',
  localField: '_templateId',
  foreignField: '_id',
  justOne: true,
});

jobSchema.virtual('notification', {
  ref: 'Notification',
  localField: '_notificationId',
  foreignField: '_id',
  justOne: true,
});

jobSchema.virtual('subscriber', {
  ref: 'Subscriber',
  localField: '_subscriberId',
  foreignField: '_id',
  justOne: true,
});

jobSchema.virtual('environment', {
  ref: 'Environment',
  localField: '_environmentId',
  foreignField: '_id',
  justOne: true,
});

/*
 * This index was initially created to optimize:
 *
 * Path : apps/api/src/app/events/usecases/send-message/digest/get-digest-events.usecase.ts
 *    Context : filterJobs()
 *       Query : findOne.(
 *          {
 *            transactionId: transactionId,
 *            _subscriberId: currentJob._subscriberId,
 *            _environmentId: currentJob._environmentId,
 *            type: StepTypeEnum.TRIGGER,
 *          },
 *          '_id'
 *        )
 *
 * Path : apps/api/src/app/events/usecases/message-matcher/message-matcher.usecase.ts
 *    Context : processPreviousStep()
 *       Query : findOne({
 *           transactionId: command.transactionId,
 *           _subscriberId: command._subscriberId ? command._subscriberId : command.subscriberId,
 *           _environmentId: command.environmentId,
 *           _organizationId: command.organizationId,
 *           'step.uuid': filter.step,
 *        })
 *
 * Path : apps/api/src/app/events/usecases/trigger-event/trigger-event.usecase.ts
 *    Context : validateTransactionIdProperty()
 *       Query : findOne(
 *          {
 *            transactionId,
 *            _environmentId: environmentId,
 *          },
 *          '_id'
 *        )
 *
 * Path : apps/api/src/app/events/usecases/send-message/digest/digest.usecase.ts
 *    Context : getJobsToUpdate()
 *       Query : find({
 *           transactionId: command.transactionId,
 *           _environmentId: command.environmentId,
 *           _id: {
 *             $ne: command.jobId,
 *           },
 *         })
 *
 * Path : apps/api/src/app/events/usecases/cancel-delayed/cancel-delayed.usecase.ts
 *    Context : execute()
 *       Query : findOne({
 *         transactionId: command.transactionId,
 *         _environmentId: command.environmentId,
 *         status: JobStatusEnum.DELAYED,
 *        })
 *
 * Path : libs/dal/src/repositories/job/job.repository.ts
 *    Context : findOnePopulate()
 *       Query : findOne( { _environmentId: string; transactionId: string })
 *
 */
jobSchema.index({
  transactionId: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path : libs/dal/src/repositories/job/job.repository.ts
 *    Context : execute()
 *       Query : findOne({
 *          _parentId: command.parentId,
 *          _environmentId: command.environmentId,
 *        })
 */
jobSchema.index({
  _parentId: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path : apps/api/src/app/events/usecases/digest-filter-steps/digest-filter-steps-backoff.usecase.ts
 *    Context : getTrigger()
 *       Query : findOne({
 *          _subscriberId: command._subscriberId,
 *          _templateId: command.templateId,
 *          _environmentId: command.environmentId,
 *          status: JobStatusEnum.COMPLETED,
 *          type: StepTypeEnum.TRIGGER,
 *          query['payload.' + digestKey] = DigestFilterSteps.getNestedValue(command.payload, digestKey);
 *          updatedAt: {
 *            $gte: this.getBackoffDate(step),
 *          },
 *        })
 *    Context : alreadyHaveDigest()
 *              type should be after _environmentId
 *       Query : findOne({
 *          _templateId: command.templateId,
 *          _subscriberId: command._subscriberId,
 *          _environmentId: command.environmentId,
 *          type: StepTypeEnum.TRIGGER,
 *          query['payload.' + digestKey] = DigestFilterSteps.getNestedValue(command.payload, digestKey);
 *          updatedAt: {
 *            $gte: this.getBackoffDate(step),
 *          },
 *        })
 *
 * Path: apps/api/src/app/events/usecases/digest-filter-steps/digest-filter-steps-regular.usecase.ts
 *    Context : getDigest()
 *       Query : findOne({
 *         _templateId: command.templateId,
 *         _subscriberId: command._subscriberId,
 *         _environmentId: command.environmentId,
 *         status: JobStatusEnum.DELAYED,
 *         type: StepTypeEnum.DIGEST,
 *          where['payload.' + digestKey] = DigestFilterSteps.getNestedValue(command.payload, digestKey);
 *       })
 *
 * Path : libs/dal/src/repositories/job/job.repository.ts
 *    Context : findJobsToDigest()
 *       Query : find({
 *          _templateId: templateId,
 *          _subscriberId: subscriberId,
 *          $or: [
 *            { status: JobStatusEnum.COMPLETED, type: StepTypeEnum.DIGEST },
 *            { status: JobStatusEnum.DELAYED, type: StepTypeEnum.DELAY },
 *          ],
 *          _environmentId: environmentId,
 *          updatedAt: {
 *            $gte: from,
 *          },
 *        })
 *       Query : find({
 *           updatedAt: {
 *             $gte: from,
 *           },
 *           _templateId: templateId,
 *           status: JobStatusEnum.COMPLETED,
 *           type: StepTypeEnum.TRIGGER,
 *           _environmentId: environmentId,
 *           _subscriberId: subscriberId,
 *           transactionId: {
 *             $nin: transactionIds,
 *           },
 *         })
 *       Query : update({
 *            updatedAt: {
 *              $gte: from,
 *            }
 *    Context : shouldDelayDigestJobOrMerge()
 *       Query : find({
 *          _subscriberId: this.convertStringToObjectId(job._subscriberId),
 *          _templateId: job._templateId,
 *          _environmentId: this.convertStringToObjectId(job._environmentId),
 *          status: JobStatusEnum.DELAYED,
 *          type: StepTypeEnum.DIGEST,
 *          ...(digestKey && { [`payload.${digestKey}`]: digestValue }),
 *        }
 *
 * Path : apps/api/src/app/events/usecases/add-job/add-delay-job.usecase.ts
 *    Context : noExistingDelayedJobForDate()
 *       Query : findOne(
 *          {
 *            status: JobStatusEnum.DELAYED,
 *            type: StepTypeEnum.DELAY,
 *            _subscriberId: data._subscriberId,
 *            _templateId: data._templateId,
 *            _environmentId: data._environmentId,
 *            transactionId: { $ne: data.transactionId },
 *            'step.metadata.type': DelayTypeEnum.SCHEDULED,
 *            'step.metadata.delayPath': currentDelayPath,
 *            [`payload.${currentDelayPath}`]: currentDelayDate,
 *          },
 *          '_subscriberId'
 *       )
 */
jobSchema.index({
  _subscriberId: 1,
  _templateId: 1,
  type: 1,
  status: 1,
  updatedAt: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path : apps/api/src/app/events/usecases/send-message/digest/get-digest-events-backoff.usecase.ts
 *    Context : execute()
 *       Query : find({
 *          _subscriberId: command._subscriberId ? command._subscriberId : command.subscriberId,
 *          _templateId: currentJob._templateId,
 *          _environmentId: command.environmentId,
 *          type: StepTypeEnum.TRIGGER,
 *          status: JobStatusEnum.COMPLETED,
 *          createdAt: {
 *            $gte: currentJob.createdAt,
 *          },
 *        }
 */
jobSchema.index({
  _subscriberId: 1,
  _templateId: 1,
  type: 1,
  status: 1,
  createdAt: 1,
});

/*
 * This index was initially created to optimize:
 *
 *    Context : The reason for this Index is that it used by the activity feed with populate,
 *              Notification scheme virtual localField: '_id', foreignField: '_notificationId', one to many
 */
jobSchema.index({
  _notificationId: 1,
});

jobSchema.index(
  {
    _mergedDigestId: 1,
  },
  {
    sparse: true,
  }
);

/*
 * This index was created to push entries to Online Archive
 */
jobSchema.index({ createdAt: 1 });

jobSchema.index(
  {
    subscriberId: 1,
    _environmentId: 1,
    'digest.digestValue': 1,
    'digest.digestKey': 1,
    _templateId: 1,
    status: 1,
    type: 1,
  },
  {
    name: 'Guard from having two master jobs for same digest key, digest value, workflow and subscriber',
    unique: true,
    partialFilterExpression: {
      status: 'delayed',
      type: 'digest',
      createdAt: { $gte: new Date('2025-03-05T00:00:01.505+00:00') },
      'digest.digestValue': { $exists: true },
      'digest.digestKey': { $exists: true },
    },
  }
);

export const Job = (mongoose.models.Job as mongoose.Model<JobDBModel>) || mongoose.model<JobDBModel>('Job', jobSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/layout/index.ts
Tamaño: 95 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './layout.entity';
export * from './layout.repository';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/layout/layout.entity.ts
Tamaño: 1179 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ResourceOriginEnum, ResourceTypeEnum } from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import { ControlSchemas } from '../message-template';
import { UserEntity } from '../user';
import {
  ChannelTypeEnum,
  EnvironmentId,
  ITemplateVariable,
  LayoutDescription,
  LayoutId,
  LayoutIdentifier,
  LayoutName,
  OrganizationId,
  UserId,
} from './types';

export class LayoutEntity {
  _id: LayoutId;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  _creatorId: UserId;
  _parentId?: LayoutId;
  _updatedBy?: string;
  name: LayoutName;
  identifier: LayoutIdentifier;
  description?: LayoutDescription;
  variables?: ITemplateVariable[];
  content?: string;
  contentType?: string;
  isDefault: boolean;
  deleted: boolean;
  channel: ChannelTypeEnum;
  type?: ResourceTypeEnum;
  origin?: ResourceOriginEnum;
  createdAt?: string;
  updatedAt?: string;
  controls?: ControlSchemas;
  readonly updatedBy?: UserEntity;
  isTranslationEnabled?: boolean;
}

export type LayoutDBModel = ChangePropsValueType<
  LayoutEntity,
  '_environmentId' | '_organizationId' | '_creatorId' | '_parentId' | '_updatedBy'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LayoutEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/layout/layout.repository.ts
Tamaño: 7920 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum, ResourceOriginEnum, ResourceTypeEnum } from '@novu/shared';
import { ClientSession, FilterQuery, ProjectionType, QueryOptions } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { LayoutDBModel, LayoutEntity } from './layout.entity';
import { Layout } from './layout.schema';
import { EnvironmentId, LayoutId, OrderDirectionEnum, OrganizationId } from './types';

type LayoutQuery = FilterQuery<LayoutDBModel> & EnforceEnvOrOrgIds;

export class LayoutRepository extends BaseRepository<LayoutDBModel, LayoutEntity, EnforceEnvOrOrgIds> {
  private layout: SoftDeleteModel;

  constructor() {
    super(Layout, LayoutEntity);
    this.layout = Layout;
  }

  async findOne(
    query: FilterQuery<LayoutDBModel> & EnforceEnvOrOrgIds,
    select?: ProjectionType<LayoutEntity>,
    options: {
      readPreference?: 'secondaryPreferred' | 'primary';
      query?: QueryOptions<LayoutDBModel>;
      session?: ClientSession | null;
    } = {}
  ): Promise<LayoutEntity | null> {
    const { session, ...queryOptions } = options;

    const queryBuilder = this.MongooseModel.findOne(query, select, queryOptions.query)
      .read(queryOptions.readPreference || 'primary')
      .populate('updatedBy');

    if (session) {
      queryBuilder.session(session);
    }

    const data = await queryBuilder;
    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  async findPublishable(environmentId: string, organizationId: string): Promise<LayoutEntity[]> {
    const items = await this.MongooseModel.find({
      _environmentId: environmentId,
      _organizationId: organizationId,
      type: ResourceTypeEnum.BRIDGE,
      origin: ResourceOriginEnum.NOVU_CLOUD,
    }).populate('updatedBy', '_id firstName lastName externalId');

    return this.mapEntities(items);
  }

  async createLayout(entity: Omit<LayoutEntity, '_id' | 'createdAt' | 'updatedAt'>): Promise<LayoutEntity> {
    const {
      channel,
      content,
      contentType,
      identifier,
      description,
      isDefault,
      name,
      variables,
      _creatorId,
      _environmentId,
      _organizationId,
      type,
      origin,
      controls,
      isTranslationEnabled,
    } = entity;

    return await this.create({
      _creatorId,
      _environmentId,
      _organizationId,
      content,
      contentType,
      identifier,
      isDefault,
      deleted: false,
      description,
      name,
      variables,
      channel,
      type,
      origin,
      controls,
      isTranslationEnabled,
    });
  }

  async deleteLayout(_id: LayoutId, _environmentId: EnvironmentId, _organizationId: OrganizationId): Promise<void> {
    const deleteQuery: LayoutQuery = {
      _id,
      _environmentId,
      _organizationId,
    };

    const result = await this.layout.delete(deleteQuery);

    if (result.modifiedCount !== 1) {
      throw new DalException(
        `Soft delete of layout ${_id} in environment ${_environmentId} was not performed properly`
      );
    }
  }

  async findDefault(_environmentId: EnvironmentId, _organizationId: OrganizationId): Promise<LayoutEntity | null> {
    return await this.findOne({ _environmentId, _organizationId, isDefault: true });
  }

  async findDeleted(id: LayoutId, environmentId: EnvironmentId): Promise<LayoutEntity | null> {
    const deletedLayout: LayoutEntity = await this.layout.findOneDeleted({
      _id: this.convertStringToObjectId(id),
      _environmentId: this.convertStringToObjectId(environmentId),
    });

    if (!deletedLayout?._id) {
      return null;
    }

    return this.mapEntity(deletedLayout);
  }

  async findDeletedByParentId(parentId: LayoutId, environmentId: EnvironmentId): Promise<LayoutEntity | null> {
    const deletedLayout: LayoutEntity = await this.layout.findOneDeleted({
      _parentId: this.convertStringToObjectId(parentId),
      _environmentId: this.convertStringToObjectId(environmentId),
    });

    if (!deletedLayout?._id) {
      return null;
    }

    return this.mapEntity(deletedLayout);
  }

  async filterLayouts(
    query: LayoutQuery,
    pagination: { limit: number; skip: number; sortBy?: string; orderBy?: OrderDirectionEnum }
  ): Promise<LayoutEntity[]> {
    const order = pagination.orderBy ?? OrderDirectionEnum.DESC;
    const sort = pagination.sortBy ? { [pagination.sortBy]: order } : { createdAt: OrderDirectionEnum.DESC };
    const parsedQuery = { ...query };

    parsedQuery._environmentId = this.convertStringToObjectId(parsedQuery._environmentId);
    parsedQuery._organizationId = this.convertStringToObjectId(parsedQuery._organizationId);

    const data = await this.aggregate([
      {
        $match: {
          ...parsedQuery,
        },
      },
      { $sort: sort },
      {
        $skip: pagination.skip,
      },
      {
        $limit: pagination.limit,
      },
    ]);

    return data;
  }

  async updateIsDefault(
    _id: LayoutId,
    _environmentId: EnvironmentId,
    _organizationId: OrganizationId,
    isDefault: boolean
  ): Promise<void> {
    const updated = await this.update(
      {
        _id,
        _environmentId,
        _organizationId,
      },
      {
        isDefault,
      }
    );

    if (updated.matched === 0 || updated.modified === 0) {
      throw new DalException(
        `Update of layout ${_id} in environment ${_environmentId} was not performed properly. Not able to set 'isDefault' to ${isDefault}`
      );
    }
  }

  async updateLayout(entity: LayoutEntity): Promise<LayoutEntity> {
    const { _id, _environmentId, _organizationId, createdAt, updatedAt, ...updates } = entity;

    const updated = await this.update(
      {
        _id,
        _environmentId,
        _organizationId,
      },
      updates
    );

    if (updated.matched === 0 || updated.modified === 0) {
      throw new DalException(`Update of layout ${_id} in environment ${_environmentId} was not performed properly`);
    }

    const updatedEntity = await this.findOne({ _id, _environmentId, _organizationId });

    if (!updatedEntity) {
      throw new DalException(
        `Update of layout ${_id} in environment ${_environmentId} was performed but entity could not been retrieved`
      );
    }

    return updatedEntity;
  }

  public async getV2List({
    organizationId,
    environmentId,
    skip = 0,
    limit = 10,
    searchQuery,
    orderBy = 'createdAt',
    orderDirection = DirectionEnum.DESC,
  }: {
    organizationId: string;
    environmentId: string;
    skip: number;
    limit: number;
    searchQuery?: string;
    orderBy: string;
    orderDirection: DirectionEnum;
  }) {
    const dbQuery: LayoutQuery = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      type: ResourceTypeEnum.BRIDGE,
      origin: ResourceOriginEnum.NOVU_CLOUD,
    };

    if (searchQuery) {
      dbQuery.$or = [
        { name: { $regex: this.regExpEscape(searchQuery), $options: 'i' } },
        { identifier: { $regex: this.regExpEscape(searchQuery), $options: 'i' } },
      ];
    }

    const [layouts, totalCount] = await Promise.all([
      this.paginate(dbQuery, {
        limit,
        skip,
        orderBy,
        orderDirection,
      }),
      this.count(dbQuery),
    ]);

    return {
      data: layouts,
      totalCount,
    };
  }

  private async paginate(
    query: LayoutQuery,
    pagination: { limit: number; skip: number; orderBy: string; orderDirection: DirectionEnum }
  ) {
    const items = await this.MongooseModel.find({
      ...query,
    })
      .sort({ [pagination.orderBy]: pagination.orderDirection === DirectionEnum.ASC ? 1 : -1 })
      .skip(pagination.skip)
      .limit(pagination.limit)
      .lean();

    return this.mapEntities(items);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LayoutRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/layout/layout.schema.ts
Tamaño: 2043 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { LayoutDBModel } from './layout.entity';

const mongooseDelete = require('mongoose-delete');

const layoutSchema = new Schema<LayoutDBModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _creatorId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'Layout',
    },
    _updatedBy: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    name: Schema.Types.String,
    identifier: Schema.Types.String,
    description: Schema.Types.String,
    variables: [
      {
        name: Schema.Types.String,
        type: {
          type: Schema.Types.String,
        },
        required: {
          type: Schema.Types.Boolean,
          default: false,
        },
        defaultValue: Schema.Types.Mixed,
      },
    ],
    content: Schema.Types.String,
    contentType: Schema.Types.String,
    isDefault: {
      type: Schema.Types.Boolean,
      default: false,
    },
    channel: {
      type: Schema.Types.String,
    },
    type: {
      type: Schema.Types.String,
    },
    origin: {
      type: Schema.Types.String,
    },
    controls: { schema: Schema.Types.Mixed, uiSchema: Schema.Types.Mixed },
    isTranslationEnabled: {
      type: Schema.Types.Boolean,
      default: false,
    },
  },
  schemaOptions
);

layoutSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

layoutSchema.virtual('updatedBy', {
  ref: 'User',
  localField: '_updatedBy',
  foreignField: '_id',
  justOne: true,
  select: '_id firstName lastName externalId',
});

layoutSchema.index({
  _environmentId: 1,
});

export const Layout =
  (mongoose.models.Layout as mongoose.Model<LayoutDBModel>) || mongoose.model<LayoutDBModel>('Layout', layoutSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/layout/types.ts
Tamaño: 445 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ChannelTypeEnum, IEmailBlock, ITemplateVariable, OrderDirectionEnum } from '@novu/shared';

export { EnvironmentId } from '../environment';
export { OrganizationId } from '../organization';
export { ExternalSubscriberId, SubscriberId } from '../subscriber';
export { UserId } from '../user';

export type LayoutId = string;
export type LayoutName = string;
export type LayoutIdentifier = string;
export type LayoutDescription = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export  type
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization-group/index.ts
Tamaño: 139 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './localization-group.entity';
export * from './localization-group.repository';
export * from './localization-group.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization-group/localization-group.entity.ts
Tamaño: 704 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export enum LocalizationResourceEnum {
  WORKFLOW = 'workflow',
  LAYOUT = 'layout',
}

export class LocalizationGroupEntity {
  _id: string;

  resourceType: LocalizationResourceEnum;
  resourceId: string;
  resourceName: string;

  _resourceInternalId: string;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  createdAt: string;
  updatedAt: string;
}

export type LocalizationGroupDBModel = ChangePropsValueType<
  LocalizationGroupEntity,
  '_environmentId' | '_organizationId' | '_resourceInternalId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum
- export class LocalizationGroupEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization-group/localization-group.repository.ts
Tamaño: 3231 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ClientSession } from 'mongoose';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import {
  LocalizationGroupDBModel,
  LocalizationGroupEntity,
  LocalizationResourceEnum,
} from './localization-group.entity';
import { LocalizationGroup } from './localization-group.schema';

export class LocalizationGroupRepository extends BaseRepository<
  LocalizationGroupDBModel,
  LocalizationGroupEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(LocalizationGroup, LocalizationGroupEntity);
  }

  async findByResource(
    resourceType: LocalizationResourceEnum,
    resourceInternalId: string,
    environmentId: string,
    organizationId: string
  ) {
    return this.findOne({
      resourceType,
      _resourceInternalId: resourceInternalId,
      _environmentId: environmentId,
      _organizationId: organizationId,
    });
  }

  async findByIds(ids: string[], environmentId: string, organizationId: string): Promise<LocalizationGroupEntity[]> {
    return this.find({
      _id: { $in: ids },
      _environmentId: environmentId,
      _organizationId: organizationId,
    });
  }

  async getOrCreateForResource(
    resourceType: LocalizationResourceEnum,
    resourceId: string,
    resourceName: string,
    _resourceInternalId: string,
    environmentId: string,
    organizationId: string,
    session?: ClientSession | null
  ) {
    let group = await this.findByResource(resourceType, _resourceInternalId, environmentId, organizationId);

    if (!group) {
      group = await this.create(
        {
          resourceType,
          resourceId,
          resourceName,
          _resourceInternalId,
          _environmentId: environmentId,
          _organizationId: organizationId,
        },
        { session }
      );
    } else if (group.resourceName !== resourceName) {
      // Update resource name if it has changed
      await this.update(
        {
          _id: group._id,
          _environmentId: environmentId,
          _organizationId: organizationId,
        },
        { resourceName },
        { session }
      );

      group = await this.findByResource(resourceType, _resourceInternalId, environmentId, organizationId);
    }

    return group;
  }

  async findPaginatedGroups(
    environmentId: string,
    organizationId: string,
    options: {
      query?: string;
      limit: number;
      offset: number;
    }
  ): Promise<{ data: LocalizationGroupEntity[]; totalCount: number }> {
    const { query, limit, offset } = options;

    const filters: any = {
      _environmentId: environmentId,
      _organizationId: organizationId,
    };

    if (query) {
      // Use regex search like workflow controller for consistency
      filters.$or = [
        { resourceName: { $regex: this.regExpEscape(query), $options: 'i' } },
        { resourceId: { $regex: this.regExpEscape(query), $options: 'i' } },
      ];
    }

    const [totalCount, data] = await Promise.all([
      this.count(filters),
      this.find(
        filters,
        {},
        {
          sort: { updatedAt: -1 },
          skip: offset,
          limit,
        }
      ),
    ]);

    return { data, totalCount };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LocalizationGroupRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization-group/localization-group.schema.ts
Tamaño: 1346 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { LocalizationGroupDBModel, LocalizationResourceEnum } from './localization-group.entity';

const localizationGroupSchema = new Schema<LocalizationGroupDBModel>(
  {
    resourceType: {
      type: Schema.Types.String,
      enum: Object.values(LocalizationResourceEnum),
      required: true,
    },
    resourceId: {
      type: Schema.Types.String,
      required: true,
    },
    resourceName: {
      type: Schema.Types.String,
      required: true,
    },
    _resourceInternalId: {
      type: Schema.Types.ObjectId,
      required: true,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      required: true,
    },
  },
  schemaOptions
);

localizationGroupSchema.index({
  resourceType: 1,
  _resourceInternalId: 1,
  _environmentId: 1,
  _organizationId: 1,
});

localizationGroupSchema.index({
  _environmentId: 1,
  _organizationId: 1,
  updatedAt: -1,
});

export const LocalizationGroup =
  (mongoose.models.LocalizationGroup as mongoose.Model<LocalizationGroupDBModel>) ||
  mongoose.model<LocalizationGroupDBModel>('LocalizationGroup', localizationGroupSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization/index.ts
Tamaño: 121 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './localization.entity';
export * from './localization.repository';
export * from './localization.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization/localization.entity.ts
Tamaño: 551 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class LocalizationEntity {
  _id: string;

  locale: string;
  content: string;
  _localizationGroupId: string;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  createdAt: string;
  updatedAt: string;
}

export type LocalizationDBModel = ChangePropsValueType<
  LocalizationEntity,
  '_environmentId' | '_organizationId' | '_localizationGroupId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LocalizationEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization/localization.repository.ts
Tamaño: 451 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { LocalizationDBModel, LocalizationEntity } from './localization.entity';
import { Localization } from './localization.schema';

export class LocalizationRepository extends BaseRepository<
  LocalizationDBModel,
  LocalizationEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(Localization, LocalizationEntity);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class LocalizationRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/localization/localization.schema.ts
Tamaño: 1153 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { LocalizationDBModel } from './localization.entity';

const localizationSchema = new Schema<LocalizationDBModel>(
  {
    locale: {
      type: Schema.Types.String,
      required: true,
    },
    content: {
      type: Schema.Types.String,
      required: true,
    },
    _localizationGroupId: {
      type: Schema.Types.ObjectId,
      ref: 'LocalizationGroup',
      required: true,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      required: true,
    },
  },
  schemaOptions
);

localizationSchema.index({
  _localizationGroupId: 1,
  locale: 1,
  _environmentId: 1,
  _organizationId: 1,
});

localizationSchema.index({
  _localizationGroupId: 1,
  _environmentId: 1,
  _organizationId: 1,
});

export const Localization =
  (mongoose.models.Localization as mongoose.Model<LocalizationDBModel>) ||
  mongoose.model<LocalizationDBModel>('Localization', localizationSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/community.member.repository.ts
Tamaño: 5374 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MemberRoleEnum, MemberStatusEnum } from '@novu/shared';
import { FilterQuery } from 'mongoose';
import type { EnforceOrgId } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { MemberDBModel, MemberEntity } from './member.entity';
import { IAddMemberData } from './member.repository';
import { Member } from './member.schema';
import { IMemberRepository } from './member-repository.interface';

type MemberQuery = FilterQuery<MemberDBModel> & EnforceOrgId;

export class CommunityMemberRepository
  extends BaseRepository<MemberDBModel, MemberEntity, EnforceOrgId>
  implements IMemberRepository
{
  constructor() {
    super(Member, MemberEntity);
  }

  async removeMemberById(
    organizationId: string,
    memberId: string
  ): Promise<{
    /** Indicates whether this write result was acknowledged. If not, then all other members of this result will be undefined. */
    acknowledged: boolean;
    /** The number of documents that were deleted */
    deletedCount: number;
  }> {
    return this.MongooseModel.deleteOne({
      _id: memberId,
      _organizationId: organizationId,
    });
  }

  async updateMemberRoles(organizationId: string, memberId: string, roles: MemberRoleEnum[]) {
    return this.update(
      {
        _id: memberId,
        _organizationId: organizationId,
      },
      {
        roles,
      }
    );
  }

  async getOrganizationMembers(organizationId: string) {
    const requestQuery: MemberQuery = {
      _organizationId: organizationId,
    };

    const members = await this.MongooseModel.find(requestQuery).populate(
      '_userId',
      'firstName lastName email _id profilePicture createdAt'
    );
    if (!members) return [];

    const membersEntity: any = this.mapEntities(members);

    return [
      ...membersEntity.map((member) => {
        return {
          ...member,
          _userId: member._userId ? member._userId._id : null,
          user: member._userId,
        };
      }),
    ];
  }

  async getOrganizationOwnerAccount(organizationId: string) {
    const requestQuery: MemberQuery = {
      _organizationId: organizationId,
      roles: MemberRoleEnum.OSS_ADMIN,
    };

    const member = await this.MongooseModel.findOne(requestQuery);

    return this.mapEntity(member);
  }

  async getOrganizationAdmins(organizationId: string) {
    const requestQuery: MemberQuery = {
      _organizationId: organizationId,
    };

    const members = await this.MongooseModel.find(requestQuery).populate('_userId', 'firstName lastName email _id');
    if (!members) return [];

    const membersEntity = this.mapEntities(members);

    return [
      ...membersEntity
        .filter((i) => i.roles.includes(MemberRoleEnum.OSS_ADMIN))
        .map((member) => {
          return {
            ...member,
            _userId: member._userId ? (member._userId as any)._id : null,
            user: member._userId,
          };
        }),
    ];
  }

  async findUserActiveMembers(userId: string): Promise<MemberEntity[]> {
    // exception casting - due to the login logic in generateUserToken
    const requestQuery = {
      _userId: userId,
      memberStatus: MemberStatusEnum.ACTIVE,
    } as unknown as MemberQuery;

    return await this.find(requestQuery);
  }

  async convertInvitedUserToMember(
    organizationId: string,
    token: string,
    data: {
      memberStatus: MemberStatusEnum;
      _userId: string;
      answerDate: Date;
    }
  ) {
    await this.update(
      {
        _organizationId: organizationId,
        'invite.token': token,
      },
      {
        memberStatus: data.memberStatus,
        _userId: data._userId,
        'invite.answerDate': data.answerDate,
      }
    );
  }

  async findByInviteToken(token: string) {
    const requestQuery = {
      'invite.token': token,
    } as unknown as MemberQuery;

    return await this.findOne(requestQuery);
  }

  async findInviteeByEmail(organizationId: string, email: string): Promise<MemberEntity | null> {
    const foundMember = await this.findOne({
      _organizationId: organizationId,
      'invite.email': email,
    });

    if (!foundMember) return null;

    return foundMember;
  }

  async addMember(organizationId: string, member: IAddMemberData): Promise<void> {
    await this.create({
      _userId: member._userId,
      roles: member.roles,
      invite: member.invite,
      memberStatus: member.memberStatus,
      _organizationId: organizationId,
    });
  }

  async isMemberOfOrganization(organizationId: string, userId: string): Promise<boolean> {
    return !!(await this.findOne(
      {
        _organizationId: organizationId,
        _userId: userId,
      },
      '_id',
      {
        readPreference: 'secondaryPreferred',
      }
    ));
  }

  async findMemberByUserId(organizationId: string, userId: string): Promise<MemberEntity | null> {
    const member = await this.findOne({
      _organizationId: organizationId,
      _userId: userId,
    });

    if (!member) return null;

    return this.mapEntity(member) as MemberEntity;
  }

  async findMemberById(organizationId: string, memberId: string): Promise<MemberEntity | null> {
    const member = await this.findOne({
      _organizationId: organizationId,
      _id: memberId,
    });

    if (!member) return null;

    return this.mapEntity(member) as MemberEntity;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - any(this.mapEntities(members);

    return [
      ...membersEntity.map((member))
 - membersEntity(this.mapEntities(members);

    return [
      ...membersEntity
        .filter((i))
Declaraciones 'export' encontradas:
- export class CommunityMemberRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/index.ts
Tamaño: 197 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './community.member.repository';
export * from './member.entity';
export * from './member.repository';
export * from './member.schema';
export * from './member-repository.interface';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/member-repository.interface.ts
Tamaño: 2934 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IMemberInvite, MemberRoleEnum, MemberStatusEnum } from '@novu/shared';
import { Types } from 'mongoose';
import { MemberEntity } from './member.entity';
import { IAddMemberData } from './member.repository';

export interface IMemberRepository extends IMemberRepositoryMongo {
  removeMemberById(
    organizationId: string,
    memberId: string
  ): Promise<{
    acknowledged: boolean;
    deletedCount: number;
  }>;
  updateMemberRoles(
    organizationId: string,
    memberId: string,
    roles: MemberRoleEnum[]
  ): Promise<{
    matched: number;
    modified: number;
  }>;
  getOrganizationMembers(organizationId: string): Promise<MemberEntity[]>;
  getOrganizationOwnerAccount(organizationId: string): Promise<MemberEntity | null>;
  getOrganizationAdmins(organizationId: string): Promise<
    {
      _userId: any;
      user: string;
      _id: string;
      roles: MemberRoleEnum[];
      invite?: IMemberInvite | undefined;
      memberStatus: MemberStatusEnum;
      _organizationId: string;
    }[]
  >;
  findUserActiveMembers(userId: string): Promise<MemberEntity[]>;
  convertInvitedUserToMember(
    organizationId: string,
    token: string,
    data: {
      memberStatus: MemberStatusEnum;
      _userId: string;
      answerDate: Date;
    }
  ): Promise<void>;
  findByInviteToken(token: string): Promise<MemberEntity | null>;
  findInviteeByEmail(organizationId: string, email: string): Promise<MemberEntity | null>;
  addMember(organizationId: string, member: IAddMemberData): Promise<void>;
  isMemberOfOrganization(organizationId: string, userId: string): Promise<boolean>;
  findMemberByUserId(organizationId: string, userId: string): Promise<MemberEntity | null>;
  findMemberById(organizationId: string, memberId: string): Promise<MemberEntity | null>;
}

/**
 * MongoDB specific methods from base-repository.ts to achieve
 * common interface for EE and Community repositories
 */
export interface IMemberRepositoryMongo {
  create(data: any, options?: any): Promise<MemberEntity>;
  update(query: any, body: any): Promise<{ matched: number; modified: number }>;
  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }>;
  count(query: any, limit?: number): Promise<number>;
  aggregate(query: any[], options?: { readPreference?: 'secondaryPreferred' | 'primary' }): Promise<any>;
  findOne(query: any, select?: any, options?: any): Promise<MemberEntity | null>;
  find(query: any, select?: any, options?: any): Promise<MemberEntity[]>;
  findBatch(query: any, select?: string, options?: any, batchSize?: number): AsyncGenerator<any>;
  insertMany(
    data: any,
    ordered: boolean
  ): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: Types.ObjectId[] }>;
  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }>;
  upsertMany(data: any): Promise<any>;
  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/member.entity.ts
Tamaño: 720 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IMemberInvite, MemberRoleEnum, MemberStatusEnum } from '@novu/shared';
import { Types } from 'mongoose';
import type { ChangePropsValueType } from '../../types/helpers';
import type { OrganizationId } from '../organization';
import { UserEntity } from '../user';

export class MemberEntity {
  _id: string;

  _userId: string;

  user?: Pick<UserEntity, 'firstName' | '_id' | 'lastName' | 'email'>;

  roles: MemberRoleEnum[];

  invite?: IMemberInvite;

  memberStatus: MemberStatusEnum;

  _organizationId: OrganizationId;
}

export type MemberDBModel = ChangePropsValueType<Omit<MemberEntity, 'invite'>, '_userId' | '_organizationId'> & {
  invite?: IMemberInvite & {
    _inviterId: Types.ObjectId;
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MemberEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/member.repository.ts
Tamaño: 4828 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject } from '@nestjs/common';
import { IMemberInvite, MemberRoleEnum, MemberStatusEnum } from '@novu/shared';
import { MemberEntity } from './member.entity';
import { IMemberRepository } from './member-repository.interface';

export interface IAddMemberData {
  _userId?: string;
  roles: MemberRoleEnum[];
  invite?: IMemberInvite;
  memberStatus: MemberStatusEnum;
}

export class MemberRepository implements IMemberRepository {
  constructor(@Inject('MEMBER_REPOSITORY') private memberRepository: IMemberRepository) {}

  removeMemberById(organizationId: string, memberId: string): Promise<{ acknowledged: boolean; deletedCount: number }> {
    return this.memberRepository.removeMemberById(organizationId, memberId);
  }

  updateMemberRoles(
    organizationId: string,
    memberId: string,
    roles: MemberRoleEnum[]
  ): Promise<{ matched: number; modified: number }> {
    return this.memberRepository.updateMemberRoles(organizationId, memberId, roles);
  }

  getOrganizationMembers(organizationId: string): Promise<any[]> {
    return this.memberRepository.getOrganizationMembers(organizationId);
  }

  getOrganizationOwnerAccount(organizationId: string): Promise<MemberEntity | null> {
    return this.memberRepository.getOrganizationOwnerAccount(organizationId);
  }

  getOrganizationAdmins(organizationId: string): Promise<
    {
      _userId: any;
      user: string;
      _id: string;
      roles: MemberRoleEnum[];
      invite?: IMemberInvite | undefined;
      memberStatus: MemberStatusEnum;
      _organizationId: string;
    }[]
  > {
    return this.memberRepository.getOrganizationAdmins(organizationId);
  }

  findUserActiveMembers(userId: string): Promise<MemberEntity[]> {
    return this.memberRepository.findUserActiveMembers(userId);
  }

  convertInvitedUserToMember(
    organizationId: string,
    token: string,
    data: { memberStatus: MemberStatusEnum; _userId: string; answerDate: Date }
  ): Promise<void> {
    return this.memberRepository.convertInvitedUserToMember(organizationId, token, data);
  }

  findByInviteToken(token: string): Promise<MemberEntity | null> {
    return this.memberRepository.findByInviteToken(token);
  }

  findInviteeByEmail(organizationId: string, email: string): Promise<MemberEntity | null> {
    return this.memberRepository.findInviteeByEmail(organizationId, email);
  }

  addMember(organizationId: string, member: IAddMemberData): Promise<void> {
    return this.memberRepository.addMember(organizationId, member);
  }

  isMemberOfOrganization(organizationId: string, userId: string): Promise<boolean> {
    return this.memberRepository.isMemberOfOrganization(organizationId, userId);
  }

  findMemberByUserId(organizationId: string, userId: string): Promise<MemberEntity | null> {
    return this.memberRepository.findMemberByUserId(organizationId, userId);
  }

  findMemberById(organizationId: string, memberId: string): Promise<MemberEntity | null> {
    return this.memberRepository.findMemberById(organizationId, memberId);
  }

  create(data: any, options?: any): Promise<MemberEntity> {
    return this.memberRepository.create(data, options);
  }

  update(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.memberRepository.update(query, body);
  }

  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }> {
    return this.memberRepository.delete(query);
  }

  count(query: any, limit?: number): Promise<number> {
    return this.memberRepository.count(query, limit);
  }

  aggregate(query: any[], options?: { readPreference?: 'secondaryPreferred' | 'primary' }): Promise<any> {
    return this.memberRepository.aggregate(query, options);
  }

  findOne(query: any, select?: any, options?: any): Promise<MemberEntity | null> {
    return this.memberRepository.findOne(query, select, options);
  }

  find(query: any, select?: any, options?: any): Promise<MemberEntity[]> {
    return this.memberRepository.find(query, select, options);
  }

  async *findBatch(
    query: any,
    select?: string | undefined,
    options?: any,
    batchSize?: number | undefined
  ): AsyncGenerator<any, any, unknown> {
    return this.memberRepository.findBatch(query, select, options, batchSize);
  }

  insertMany(data: any, ordered: boolean): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: any }> {
    return this.memberRepository.insertMany(data, ordered);
  }

  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.memberRepository.updateOne(query, body);
  }

  upsertMany(data: any): Promise<any> {
    return this.memberRepository.upsertMany(data);
  }

  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any> {
    return this.memberRepository.bulkWrite(bulkOperations, ordered);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class MemberRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/member/member.schema.ts
Tamaño: 1147 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { MemberDBModel } from './member.entity';

const memberSchema = new Schema<MemberDBModel>(
  {
    invite: {
      email: Schema.Types.String,
      token: {
        type: Schema.Types.String,
        index: true,
      },
      invitationDate: Schema.Types.Date,
      answerDate: Schema.Types.Date,
      _inviterId: {
        type: Schema.Types.ObjectId,
        ref: 'User',
      },
    },
    memberStatus: Schema.Types.String,
    _userId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
      index: true,
    },
    roles: [Schema.Types.String],
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
    },
  },
  schemaOptions
);

memberSchema.index({
  _userId: 1,
});

memberSchema.index({
  'invite.token': 1,
});

memberSchema.index({
  _organizationId: 1,
});

memberSchema.index({
  'organizationId._userId._id': 1,
});

export const Member =
  (mongoose.models.Member as mongoose.Model<MemberDBModel>) || mongoose.model<MemberDBModel>('Member', memberSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message-template/index.ts
Tamaño: 158 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './message-template.entity';
export * from './message-template.repository';
export * from './message-template.schema';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message-template/message-template.entity.ts
Tamaño: 3200 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  EnvironmentId,
  IActor,
  IMessageCTA,
  MessageTemplateContentType,
  OrganizationId,
  StepTypeEnum,
  UiSchemaGroupEnum,
  UiSchemaProperty,
} from '@novu/shared';
import type { ChangePropsValueType } from '../../types';
import { IEmailBlock, ITemplateVariable } from './types';

export class MessageTemplateEntity {
  _id?: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;

  _creatorId: string;

  // TODO: Due a circular dependency I can't import LayoutId from Layout.
  _layoutId?: string | null;

  type: StepTypeEnum;

  variables?: ITemplateVariable[];

  content: string | IEmailBlock[];

  contentType?: MessageTemplateContentType;

  active?: boolean;

  subject?: string;

  title?: string;

  name?: string;

  stepId?: string;

  preheader?: string;

  senderName?: string;

  _feedId?: string;

  cta?: IMessageCTA;

  _parentId?: string;

  actor?: IActor;

  deleted?: boolean;

  controls?: ControlSchemas;

  output?: {
    schema: JSONSchemaEntity;
  };

  code?: string;
}
export class ControlSchemas {
  schema: JSONSchemaEntity;
  uiSchema?: UiSchemaEntity;
}
export type MessageTemplateDBModel = ChangePropsValueType<
  MessageTemplateEntity,
  '_environmentId' | '_organizationId' | '_creatorId' | '_layoutId' | '_feedId' | '_parentId'
>;

// Enum for JSON Schema types
export enum JsonSchemaTypeEnum {
  STRING = 'string',
  NUMBER = 'number',
  INTEGER = 'integer',
  BOOLEAN = 'boolean',
  ARRAY = 'array',
  OBJECT = 'object',
  NULL = 'null',
}
export enum JsonSchemaFormatEnum {
  DATE = 'date',
  TIME = 'time',
  DATETIME = 'date-time',
  DURATION = 'duration',
  EMAIL = 'email',
  HOSTNAME = 'hostname',
  IDN_HOSTNAME = 'idn-hostname',
  IPV4 = 'ipv4',
  IPV6 = 'ipv6',
  JSON_POINTER = 'json-pointer',
  RELATIVE_JSON_POINTER = 'relative-json-pointer',
  REGEX = 'regex',
  URI = 'uri',
  URI_REFERENCE = 'uri-reference',
  URI_TEMPLATE = 'uri-template',
  URL = 'url',
  UUID = 'uuid',
  GUID = 'guid',
  PHONE = 'phone',
  PASSWORD = 'password',
  COLOR = 'color',
}
export class UiSchemaEntity {
  group?: UiSchemaGroupEnum;
  properties?: Record<string, UiSchemaProperty>;
}

export class JSONSchemaEntity {
  type?: JsonSchemaTypeEnum;
  format?: JsonSchemaFormatEnum;
  title?: string;
  description?: string;
  default?: any;
  const?: any;
  minimum?: number;
  maximum?: number;
  exclusiveMinimum?: boolean;
  exclusiveMaximum?: boolean;
  minLength?: number;
  maxLength?: number;
  pattern?: string;
  minItems?: number;
  maxItems?: number;
  uniqueItems?: boolean;
  items?: JSONSchemaEntity;
  required?: string[];
  properties?: Record<string, JSONSchemaEntity>;
  additionalProperties?: JSONSchemaEntity | boolean;
  enum?: any[];
  allOf?: JSONSchemaEntity[];
  anyOf?: JSONSchemaEntity[];
  oneOf?: JSONSchemaEntity[];
  not?: JSONSchemaEntity;
  if?: JSONSchemaEntity;
  then?: JSONSchemaEntity;
  else?: JSONSchemaEntity;
  contentEncoding?: string;
  contentMediaType?: string;
  dependentRequired?: Record<string, string[]>;
  dependentSchemas?: Record<string, JSONSchemaEntity>;
  $schema?: string;
  $id?: string;
  contentSchema?: JSONSchemaEntity;
  examples?: any[];
  multipleOf?: number;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class MessageTemplateEntity
- export class ControlSchemas
- export  type
- export  enum
- export  enum
- export class UiSchemaEntity
- export class JSONSchemaEntity

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message-template/message-template.repository.ts
Tamaño: 1824 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FilterQuery } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { MessageTemplateDBModel, MessageTemplateEntity } from './message-template.entity';
import { MessageTemplate } from './message-template.schema';

type MessageTemplateQuery = FilterQuery<MessageTemplateDBModel>;
export interface DeleteMsgByIdQuery {
  _id: string;
  _environmentId: string;
}
export class MessageTemplateRepository extends BaseRepository<
  MessageTemplateDBModel,
  MessageTemplateEntity,
  EnforceEnvOrOrgIds
> {
  private messageTemplate: SoftDeleteModel;
  constructor() {
    super(MessageTemplate, MessageTemplateEntity);
    this.messageTemplate = MessageTemplate;
  }

  async getMessageTemplatesByFeed(environmentId: string, feedId: string) {
    return await this.find({
      _environmentId: environmentId,
      _feedId: feedId,
    });
  }

  async getMessageTemplatesByLayout(_environmentId: string, _layoutId: string, pagination?: { limit?: number }) {
    return await this.find(
      {
        _environmentId,
        _layoutId,
      },
      {},
      pagination
    );
  }

  async delete(query: MessageTemplateQuery) {
    return await this.messageTemplate.delete({
      _id: query._id,
      _environmentId: query._environmentId,
    });
  }

  async deleteById(query: DeleteMsgByIdQuery) {
    return await this.messageTemplate.delete({
      _id: query._id,
      _environmentId: query._environmentId,
    });
  }

  async findDeleted(query: MessageTemplateQuery): Promise<MessageTemplateEntity> {
    const res: MessageTemplateEntity = await this.messageTemplate.findDeleted(query);

    return this.mapEntity(res);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export class MessageTemplateRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message-template/message-template.schema.ts
Tamaño: 2579 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ActorTypeEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { MessageTemplateDBModel } from './message-template.entity';

const mongooseDelete = require('mongoose-delete');

const messageTemplateSchema = new Schema<MessageTemplateDBModel>(
  {
    type: {
      type: Schema.Types.String,
    },
    active: {
      type: Schema.Types.Boolean,
      default: true,
    },
    name: Schema.Types.String,
    stepId: Schema.Types.String,
    subject: Schema.Types.String,
    variables: [
      {
        name: Schema.Types.String,
        type: {
          type: Schema.Types.String,
        },
        required: {
          type: Schema.Types.Boolean,
          default: false,
        },
        defaultValue: Schema.Types.Mixed,
      },
    ],
    content: Schema.Types.Mixed,
    contentType: Schema.Types.String,
    title: Schema.Types.String,
    cta: {
      type: {
        type: Schema.Types.String,
      },
      data: Schema.Types.Mixed,
      action: Schema.Types.Mixed,
    },
    preheader: Schema.Types.String,
    senderName: Schema.Types.String,
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _creatorId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _feedId: {
      type: Schema.Types.ObjectId,
      ref: 'Feed',
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _layoutId: {
      type: Schema.Types.ObjectId,
      ref: 'Layout',
      /*
       * This will make it retro-compatible and will allow
       * that if no layout assigned to not break.
       */
      default: null,
    },
    actor: {
      type: {
        type: Schema.Types.String,
        enum: ActorTypeEnum,
      },
      data: Schema.Types.Mixed,
    },
    controls: { schema: Schema.Types.Mixed, uiSchema: Schema.Types.Mixed },
    output: { schema: Schema.Types.Mixed },
    code: Schema.Types.String,
  },
  schemaOptions
);

messageTemplateSchema.index({
  _organizationId: 1,
  'triggers.identifier': 1,
});

messageTemplateSchema.index({
  _parentId: 1,
});

messageTemplateSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const MessageTemplate =
  (mongoose.models.MessageTemplate as mongoose.Model<MessageTemplateDBModel>) ||
  mongoose.model<MessageTemplateDBModel>('MessageTemplate', messageTemplateSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message-template/types.ts
Tamaño: 135 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export {
  EmailBlockTypeEnum,
  IEmailBlock,
  ITemplateVariable,
  TemplateVariableTypeEnum,
  TextAlignEnum,
} from '@novu/shared';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message/index.ts
Tamaño: 106 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './message.entity';
export * from './message.repository';
export * from './message.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message/message.entity.ts
Tamaño: 2553 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ChannelEndpointByType,
  ChannelEndpointType,
  ChannelTypeEnum,
  IActor,
  IMessageCTA,
  SeverityLevelEnum,
} from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import { IEmailBlock } from '../message-template';
import { NotificationTemplateEntity } from '../notification-template';
import type { OrganizationId } from '../organization';
import { SubscriberEntity } from '../subscriber';

export type MessageChannelData<T extends ChannelEndpointType = ChannelEndpointType> = {
  identifier: string;
  type: T;
  endpoint: ChannelEndpointByType[T];
  token?: string;
};

export class MessageEntity {
  _id: string;

  _templateId: string;

  _environmentId: string;

  _messageTemplateId: EnvironmentId;

  _organizationId: OrganizationId;

  _notificationId: string;

  _jobId: string;

  _subscriberId: string;

  subscriber?: SubscriberEntity;

  actorSubscriber?: SubscriberEntity;

  template?: NotificationTemplateEntity;

  templateIdentifier: string;

  createdAt: string;

  updatedAt: string;

  archivedAt?: string;

  content: string | IEmailBlock[];

  transactionId: string;

  subject?: string;

  channel: ChannelTypeEnum;

  seen: boolean;

  read: boolean;

  snoozedUntil?: string;

  deliveredAt?: string[];

  archived: boolean;

  /**
   * todo: remove deleted field after all the soft deletes are removed task nv-5688
   */
  deleted: boolean;

  email?: string;

  /**
   * @deprecated use channelData instead
   */
  phone?: string;

  /**
   * @deprecated use channelData instead
   */
  chatWebhookUrl?: string;

  /**
   * @deprecated use channelData instead
   */
  directWebhookUrl?: string;

  providerId: string;

  deviceTokens?: string[];

  title?: string;

  lastSeenDate: string;

  firstSeenDate: string;

  lastReadDate: string;

  cta: IMessageCTA;

  _feedId?: string;

  status: 'sent' | 'error' | 'warning';

  errorId: string;

  errorText: string;

  payload: Record<string, unknown>;

  data?: Record<string, unknown>;

  overrides: Record<string, unknown>;

  identifier?: string;

  actor?: IActor;

  _actorId?: string;

  tags?: string[];

  avatar?: string;

  severity?: SeverityLevelEnum;

  channelData?: MessageChannelData[];

  contextKeys?: string[];
}

export type MessageDBModel = ChangePropsValueType<
  MessageEntity,
  | '_templateId'
  | '_environmentId'
  | '_messageTemplateId'
  | '_organizationId'
  | '_notificationId'
  | '_jobId'
  | '_subscriberId'
  | '_feedId'
  | '_actorId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export class MessageEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message/message.repository.ts
Tamaño: 30988 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  ActorTypeEnum,
  ButtonTypeEnum,
  ChannelTypeEnum,
  MessageActionStatusEnum,
  MessagesStatusEnum,
  SeverityLevelEnum,
} from '@novu/shared';
import { FilterQuery, ProjectionType, Types } from 'mongoose';

import { DalException } from '../../shared';
import { EnforceEnvId } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { FeedRepository } from '../feed';
import { MessageDBModel, MessageEntity } from './message.entity';
import { Message } from './message.schema';

type MessageQuery = FilterQuery<MessageDBModel>;

const MAX_PAYLOAD_QUERY_DEPTH = 3;

const DANGEROUS_KEYS = ['__proto__', 'constructor', 'prototype'];

const isValidKey = (key: string): boolean => {
  // Reject keys starting with '$' or '.' to prevent MongoDB operator injection.
  if (key.startsWith('$') || key.startsWith('.')) {
    return false;
  }

  // Reject known prototype pollution vectors.
  if (DANGEROUS_KEYS.includes(key)) {
    return false;
  }

  return true;
};

const getEntries = (obj: object, prefix = '', currentDepth = 0, maxDepth: number): [string, any][] =>
  Object.entries(obj).flatMap(([key, value]) => {
    // Sanitize the key before using it.
    if (!isValidKey(key)) {
      // Skip this entry if the key is invalid to prevent pollution or injection.
      return [];
    }

    const newKeySegment = prefix ? `${prefix}.${key}` : key;

    if (currentDepth < maxDepth && typeof value === 'object' && value !== null && !Array.isArray(value)) {
      return getEntries(value, newKeySegment, currentDepth + 1, maxDepth);
    } else {
      return [[newKeySegment, value]];
    }
  });

const getFlatObject = (obj: object) => {
  return Object.fromEntries(getEntries(obj, '', 0, MAX_PAYLOAD_QUERY_DEPTH));
};

export class MessageRepository extends BaseRepository<MessageDBModel, MessageEntity, EnforceEnvId> {
  private feedRepository = new FeedRepository();
  constructor() {
    super(Message, MessageEntity);
  }

  async findOne(
    query: FilterQuery<MessageDBModel> & EnforceEnvId,
    select?: ProjectionType<MessageEntity>,
    options: {
      readPreference?: 'secondaryPreferred' | 'primary';
      query?: any;
      session?: any;
    } = {}
  ): Promise<MessageEntity | null> {
    const transformedQuery = this.transformContextKeysQuery(query) as FilterQuery<MessageDBModel> & EnforceEnvId;

    return super.findOne(transformedQuery, select, options);
  }

  private async getFilterQueryForMessage(
    environmentId: string,
    subscriberId: string,
    channel: ChannelTypeEnum,
    query: {
      feedId?: string[];
      tags?: string[];
      seen?: boolean;
      read?: boolean;
      archived?: boolean;
      snoozed?: boolean;
      payload?: object;
      data?: Record<string, unknown>;
      severity?: SeverityLevelEnum[];
    } = {},
    contextKeys?: string[],
    createdAt?: {
      $gte: Date;
    }
  ): Promise<MessageQuery & EnforceEnvId> {
    let requestQuery: MessageQuery & EnforceEnvId = {
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      channel,
    };

    if (query.feedId === null) {
      requestQuery._feedId = { $eq: null };
    }

    if (query.feedId) {
      const feeds = await this.feedRepository.find(
        {
          _environmentId: environmentId,
          identifier: {
            $in: query.feedId,
          },
        },
        '_id'
      );
      requestQuery._feedId = {
        $in: feeds.map((feed) => feed._id),
      };
    }

    if (query.seen != null) {
      requestQuery.seen = query.seen;
    } else {
      requestQuery.seen = { $in: [true, false] };
    }

    if (query.read != null) {
      requestQuery.read = query.read;
    } else {
      requestQuery.read = { $in: [true, false] };
    }

    if (query.tags && query.tags?.length > 0) {
      requestQuery.tags = { $in: query.tags };
    }

    if (query.archived != null) {
      requestQuery.archived = query.archived;
    } else {
      requestQuery.archived = { $in: [true, false] };
    }

    const snoozedCondition: Array<MessageQuery> = [];
    if (query.snoozed != null) {
      if (query.snoozed) {
        requestQuery.snoozedUntil = { $ne: null };
      } else {
        snoozedCondition.push({ snoozedUntil: { $exists: false } }, { snoozedUntil: null });
      }
    }

    const severityCondition: Array<MessageQuery> = [];
    if (query.severity && query.severity?.length > 0) {
      if (query.severity.includes(SeverityLevelEnum.NONE)) {
        severityCondition.push({ severity: { $exists: false } }, { severity: { $in: query.severity } });
      } else {
        requestQuery.severity = { $in: query.severity };
      }
    }

    if (contextKeys !== undefined) {
      const contextQuery = this.buildContextExactMatchQuery(contextKeys);
      requestQuery.$and = [...(requestQuery.$and ?? []), contextQuery];
    }

    if (createdAt != null) {
      requestQuery.createdAt = createdAt;
    }

    // combine all $or conditions properly
    const orConditions: Array<MessageQuery> = [];
    if (severityCondition.length > 0) {
      orConditions.push({ $or: severityCondition });
    }
    if (snoozedCondition.length > 0) {
      orConditions.push({ $or: snoozedCondition });
    }

    if (orConditions.length > 0) {
      requestQuery.$and = [...(requestQuery.$and ?? []), ...orConditions];
    }

    if (query.payload) {
      requestQuery = {
        ...getFlatObject({ payload: query.payload }),
        ...requestQuery,
      };
    }

    if (query.data) {
      requestQuery = {
        ...getFlatObject({ data: query.data }),
        ...requestQuery,
      };
    }

    return requestQuery;
  }

  /**
   * if aggregation is needed, make sure to filter with {deleted: { $ne: true }}.
   * todo: aggregate method should be implemented after all the soft deletes are removed task nv-5688
   */
  async aggregate(query: any[], options: { readPreference?: 'secondaryPreferred' | 'primary' } = {}): Promise<any> {
    throw new Error('Not implemented');
  }

  async findBySubscriberChannel(
    environmentId: string,
    subscriberId: string,
    channel: ChannelTypeEnum,
    query: { feedId?: string[]; seen?: boolean; read?: boolean; payload?: object } = {},
    options: { limit: number; skip?: number } = { limit: 10 }
  ) {
    const requestQuery = await this.getFilterQueryForMessage(environmentId, subscriberId, channel, query);

    const messages = await this.MongooseModel.find(requestQuery, '', {
      limit: options.limit,
      skip: options.skip,
      sort: '-createdAt',
    })
      .read('secondaryPreferred')
      .populate('template', '_id tags')
      .populate('subscriber', '_id firstName lastName avatar subscriberId')
      .populate('actorSubscriber', '_id firstName lastName avatar subscriberId');

    return this.mapEntities(messages);
  }

  async paginate(
    {
      environmentId,
      channel,
      subscriberId,
      tags,
      read,
      archived,
      snoozed,
      seen,
      data,
      severity: severityArray,
      contextKeys,
    }: {
      environmentId: string;
      subscriberId: string;
      channel: ChannelTypeEnum;
      tags?: string[];
      read?: boolean;
      archived?: boolean;
      snoozed?: boolean;
      seen?: boolean;
      data?: Record<string, unknown>;
      severity?: SeverityLevelEnum[];
      contextKeys?: string[];
    },
    options: { limit: number; offset: number; after?: string }
  ) {
    let query: MessageQuery & EnforceEnvId = {
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      channel,
    };

    const severityCondition: Array<MessageQuery> = [];
    if (severityArray && severityArray?.length > 0) {
      if (severityArray.includes(SeverityLevelEnum.NONE)) {
        severityCondition.push({ severity: { $exists: false } }, { severity: { $in: severityArray } });
      } else {
        query.severity = { $in: severityArray };
      }
    }

    if (contextKeys !== undefined) {
      const contextQuery = this.buildContextExactMatchQuery(contextKeys);
      query.$and = [...(query.$and ?? []), contextQuery];
    }

    if (tags && tags?.length > 0) {
      query.tags = { $in: tags };
    }

    if (typeof read === 'boolean') {
      query.read = read;
    } else {
      query.read = { $in: [true, false] };
    }

    const archivedCondition: Array<MessageQuery> = [];
    if (typeof archived === 'boolean') {
      if (!archived) {
        archivedCondition.push({ archived: { $exists: false } }, { archived: false });
      } else {
        query.archived = true;
      }
    } else {
      archivedCondition.push({ archived: { $exists: false } }, { archived: { $in: [true, false] } });
    }

    // combine all $or conditions properly
    const orConditions: Array<MessageQuery> = [];
    if (severityCondition.length > 0) {
      orConditions.push({ $or: severityCondition });
    }
    if (archivedCondition.length > 0) {
      orConditions.push({ $or: archivedCondition });
    }

    if (orConditions.length > 0) {
      query.$and = [...(query.$and ?? []), ...orConditions];
    }

    if (typeof snoozed === 'boolean') {
      query.snoozedUntil = snoozed ? { $exists: true, $ne: null } : { $eq: null };
    }

    if (typeof seen === 'boolean') {
      query.seen = seen;
    } else {
      query.seen = { $in: [true, false] };
    }

    if (data) {
      const flatData = getFlatObject({ data });

      query = {
        ...flatData,
        ...query,
      };
    }

    return await this.cursorPagination({
      query,
      limit: options.limit,
      offset: options.offset,
      after: options.after,
      sort: { createdAt: -1, _id: -1 },
      paginateField: 'createdAt',
      enhanceQuery: (queryBuilder) =>
        queryBuilder
          .read('secondaryPreferred')
          .populate('subscriber', '_id firstName lastName avatar subscriberId')
          .populate('actorSubscriber', '_id firstName lastName avatar subscriberId')
          .populate({
            path: 'template',
            select: '_id name tags data critical triggers severity',
            options: {
              withDeleted: true,
            },
          }),
    });
  }

  async getCount(
    environmentId: string,
    subscriberId: string,
    channel: ChannelTypeEnum,
    query: {
      feedId?: string[];
      tags?: string[];
      seen?: boolean;
      read?: boolean;
      archived?: boolean;
      snoozed?: boolean;
      payload?: object;
      data?: Record<string, unknown>;
      severity?: SeverityLevelEnum[];
    } = {},
    options: { limit: number; skip?: number } = { limit: 100, skip: 0 },
    contextKeys?: string[],
    createdAt?: {
      $gte: Date;
    },
    readPreference: 'secondaryPreferred' | 'primary' = 'secondaryPreferred'
  ) {
    const requestQuery = await this.getFilterQueryForMessage(
      environmentId,
      subscriberId,
      channel,
      {
        feedId: query.feedId,
        seen: query.seen,
        tags: query.tags,
        read: query.read,
        archived: query.archived,
        payload: query.payload,
        snoozed: query.snoozed,
        data: query.data,
        severity: query.severity,
      },
      contextKeys,
      createdAt
    );

    return this.MongooseModel.countDocuments(requestQuery, options).read(readPreference);
  }

  async getCountBySeverity(
    environmentId: string,
    subscriberId: string,
    channel: ChannelTypeEnum,
    query: {
      read?: boolean;
      snoozed?: boolean;
    } = {},
    options: { limit: number; skip?: number } = { limit: 100, skip: 0 },
    contextKeys?: string[]
  ): Promise<{ severity: SeverityLevelEnum; count: number }[]> {
    const severityLevels = Object.values(SeverityLevelEnum);

    const promises = severityLevels.map((severity) =>
      this.getCount(environmentId, subscriberId, channel, { ...query, severity: [severity] }, options, contextKeys)
    );

    const results = await Promise.all(promises);

    return results.map((result, index) => ({ severity: severityLevels[index], count: result }));
  }

  private getReadSeenUpdateQuery(
    subscriberId: string,
    environmentId: string,
    markAs: MessagesStatusEnum
  ): Partial<MessageEntity> & EnforceEnvId {
    const updateQuery: Partial<MessageEntity> & EnforceEnvId = {
      _subscriberId: subscriberId,
      _environmentId: environmentId,
    };

    switch (markAs) {
      case MessagesStatusEnum.READ:
        return {
          ...updateQuery,
          read: false,
        };
      case MessagesStatusEnum.UNREAD:
        return {
          ...updateQuery,
          read: true,
        };
      case MessagesStatusEnum.SEEN:
        return {
          ...updateQuery,
          seen: false,
        };
      case MessagesStatusEnum.UNSEEN:
        return {
          ...updateQuery,
          seen: true,
        };
      default:
        return updateQuery;
    }
  }

  private getReadSeenUpdatePayload(markAs: MessagesStatusEnum): {
    read?: boolean;
    lastReadDate?: Date;
    seen?: boolean;
    lastSeenDate?: Date;
  } {
    const now = new Date();

    switch (markAs) {
      case MessagesStatusEnum.READ:
        return {
          read: true,
          lastReadDate: now,
          seen: true,
          lastSeenDate: now,
        };
      case MessagesStatusEnum.UNREAD:
        return {
          read: false,
          lastReadDate: now,
          seen: true,
          lastSeenDate: now,
        };
      case MessagesStatusEnum.SEEN:
        return {
          seen: true,
          lastSeenDate: now,
        };
      case MessagesStatusEnum.UNSEEN:
        return {
          seen: false,
          lastSeenDate: now,
        };
      default:
        return {};
    }
  }

  async markAllMessagesAs({
    subscriberId,
    environmentId,
    markAs,
    channel,
    feedIdentifiers,
  }: {
    subscriberId: string;
    environmentId: string;
    markAs: MessagesStatusEnum;
    channel?: ChannelTypeEnum;
    feedIdentifiers?: string[];
  }) {
    let feedQuery;

    if (feedIdentifiers) {
      const feeds = await this.feedRepository.find(
        {
          _environmentId: environmentId,
          identifier: {
            $in: feedIdentifiers,
          },
        },
        '_id'
      );

      feedQuery = {
        $in: feeds.map((feed) => feed._id),
      };
    }

    const updateQuery = this.getReadSeenUpdateQuery(subscriberId, environmentId, markAs);

    if (feedQuery != null) {
      updateQuery._feedId = feedQuery;
    }

    if (channel != null) {
      updateQuery.channel = channel;
    }

    const updatePayload = this.getReadSeenUpdatePayload(markAs);

    // Find documents that will be updated (only fetch IDs for performance)
    const documentsToUpdate = await this.find(updateQuery, '_id');

    if (documentsToUpdate.length === 0) {
      return [];
    }

    // Extract IDs for targeted update
    const documentIds = documentsToUpdate.map((doc) => doc._id);

    // Perform the update using document IDs
    await this.update(
      {
        _id: { $in: documentIds },
        _environmentId: environmentId,
      },
      { $set: updatePayload }
    );

    // Fetch and return the updated documents
    return this.find({
      _id: { $in: documentIds },
      _environmentId: environmentId,
    });
  }

  async updateFeedByMessageTemplateId(environmentId: string, messageId: string, feedId?: string | null) {
    return this.update(
      { _environmentId: environmentId, _messageTemplateId: messageId },
      {
        $set: {
          _feedId: feedId,
        },
      }
    );
  }

  async updateMessageStatus(
    environmentId: string,
    id: string,
    status: 'error' | 'sent' | 'warning',
    providerPayload: any = {},
    errorId: string,
    errorText: string
  ) {
    return await this.update(
      {
        _environmentId: environmentId,
        _id: id,
      },
      {
        $set: {
          status,
          errorId,
          errorText,
          providerPayload,
        },
      }
    );
  }

  async changeMessagesStatus({
    environmentId,
    subscriberId,
    messageIds,
    markAs,
  }: {
    environmentId: string;
    subscriberId: string;
    messageIds: string[];
    markAs: MessagesStatusEnum;
  }): Promise<MessageEntity[]> {
    const updatePayload = this.getReadSeenUpdatePayload(markAs);

    await this.update(
      {
        _environmentId: environmentId,
        _subscriberId: subscriberId,
        _id: {
          $in: messageIds.map((id) => {
            return new Types.ObjectId(id);
          }),
        },
      },
      {
        $set: updatePayload,
      }
    );

    return this.find({
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      _id: { $in: messageIds.map((id) => new Types.ObjectId(id)) },
    });
  }

  /**
   * @deprecated
   */
  async changeStatus(
    environmentId: string,
    subscriberId: string,
    messageIds: string[],
    mark: { seen?: boolean; read?: boolean }
  ) {
    const requestQuery: FilterQuery<MessageEntity> = {};

    if (mark.seen != null) {
      requestQuery.seen = mark.seen;
      requestQuery.lastSeenDate = new Date();
    }

    if (mark.read != null) {
      requestQuery.read = mark.read;
      requestQuery.lastReadDate = new Date();
    }

    await this.update(
      {
        _environmentId: environmentId,
        _subscriberId: subscriberId,
        _id: {
          $in: messageIds.map((id) => {
            return new Types.ObjectId(id);
          }),
        },
      },
      {
        $set: requestQuery,
      }
    );
  }

  async updateMessagesStatusByIds({
    environmentId,
    subscriberId,
    ids,
    seen,
    read,
    archived,
    snoozedUntil,
    contextKeys,
  }: {
    environmentId: string;
    subscriberId: string;
    ids: string[];
    seen?: boolean;
    read?: boolean;
    archived?: boolean;
    snoozedUntil?: Date | null;
    contextKeys?: string[];
  }): Promise<MessageEntity[]> {
    const query: MessageQuery & EnforceEnvId = {
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      ...(contextKeys && contextKeys?.length > 0 && { contextKeys: { $in: contextKeys } }),
      _id: {
        $in: ids.map((id) => {
          return new Types.ObjectId(id);
        }),
      },
    };

    return await this.updateMessagesStatus({
      query,
      seen,
      read,
      archived,
      snoozedUntil,
    });
  }

  async updateMessagesFromToStatus({
    environmentId,
    subscriberId,
    contextKeys,
    from,
    to,
  }: {
    environmentId: string;
    subscriberId: string;
    contextKeys?: string[];
    from: {
      tags?: string[];
      data?: Record<string, unknown>;
      seen?: boolean;
      read?: boolean;
      archived?: boolean;
    };
    to: {
      seen?: boolean;
      read?: boolean;
      archived?: boolean;
    };
  }): Promise<MessageEntity[]> {
    const isFromSeen = from.seen !== undefined;
    const isFromRead = from.read !== undefined;
    const isFromArchived = from.archived !== undefined;
    const flatData = from.data ? getFlatObject({ data: from.data }) : {};

    const query: MessageQuery & EnforceEnvId = {
      ...flatData,
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      ...(from.tags && from.tags?.length > 0 && { tags: { $in: from.tags } }),
      ...(contextKeys && contextKeys?.length > 0 && { contextKeys: { $in: contextKeys } }),
    };

    if (isFromArchived) {
      if (!from.archived) {
        query.$or = [{ archived: { $exists: false } }, { archived: false }];
      } else {
        query.archived = true;
      }
    } else if (isFromRead) {
      query.read = from.read;
    } else if (isFromSeen) {
      query.seen = from.seen;
    }

    return await this.updateMessagesStatus({
      query,
      ...to,
    });
  }

  /**
   * Allows to update the status of queried messages at once.
   * The status can be updated to seen, unseen, read, unread, archived, unarchived, snoozed, unsnoozed.
   * Depending on the flag passed, the other flags will be updated accordingly.
   * For example:
   * seen -> { seen: true }
   * read -> { seen: true, read: true }
   * archived -> { seen: true, read: true, archived: true }
   * unseen -> { seen: false, read: false, archived: false }
   * unread -> { seen: true, read: false, archived: false }
   * unarchived -> { seen: true, read: true, archived: false }
   * snoozed -> { seen: true, archived: false, snoozedUntil: snoozedUntil }
   * unsnoozed -> { seen: true, archived: false, snoozedUntil: null }
   */
  private async updateMessagesStatus({
    query,
    seen,
    read,
    archived,
    snoozedUntil,
  }: {
    query: MessageQuery & EnforceEnvId;
    seen?: boolean;
    read?: boolean;
    archived?: boolean;
    snoozedUntil?: Date | null;
  }): Promise<MessageEntity[]> {
    const isUpdatingSeen = seen !== undefined;
    const isUpdatingRead = read !== undefined;
    const isUpdatingArchived = archived !== undefined;
    const isUpdatingSnoozed = snoozedUntil !== undefined;

    let updatePayload: FilterQuery<MessageEntity> = {};

    if (isUpdatingArchived) {
      updatePayload = {
        seen: true,
        lastSeenDate: new Date(),
        read: true,
        lastReadDate: new Date(),
        archived,
        archivedAt: archived ? new Date() : null,
      };
    } else if (isUpdatingRead) {
      updatePayload = {
        seen: true,
        lastSeenDate: new Date(),
        read,
        lastReadDate: read ? new Date() : null,
        archived: !read ? false : undefined,
        archivedAt: !read ? null : undefined,
      };
    } else if (isUpdatingSeen) {
      updatePayload = {
        seen,
        lastSeenDate: seen ? new Date() : null,
        read: !seen ? false : undefined,
        lastReadDate: !seen ? null : undefined,
        archived: !seen ? false : undefined,
        archivedAt: !seen ? null : undefined,
      };

      // If unseen, clear firstSeenDate
      if (!seen) {
        updatePayload.firstSeenDate = null;
      }
    } else if (isUpdatingSnoozed) {
      updatePayload = {
        snoozedUntil,
        seen: true,
        lastSeenDate: new Date(),
        archived: false,
        archivedAt: null,
      };
    }

    // Find documents that will be updated (only fetch IDs for performance)
    const documentsToUpdate = await this.find(query, '_id');

    if (documentsToUpdate.length === 0) {
      return [];
    }

    // Extract IDs for targeted update
    const documentIds = documentsToUpdate.map((doc) => doc._id);
    const idQuery = { _id: { $in: documentIds }, _environmentId: query._environmentId };

    // Handle firstSeenDate logic separately for operations that mark as seen
    const shouldMarkAsSeen = isUpdatingArchived || isUpdatingRead || (isUpdatingSeen && seen) || isUpdatingSnoozed;

    if (shouldMarkAsSeen) {
      // First, update all matching documents with the main update
      await this.update(idQuery, { $set: updatePayload });

      // Then, set firstSeenDate only for documents that don't already have it
      await this.update(
        {
          ...idQuery,
          firstSeenDate: { $exists: false },
        },
        {
          $set: { firstSeenDate: new Date() },
        }
      );
    } else {
      // For non-seen operations, just do the regular update
      await this.update(idQuery, { $set: updatePayload });
    }

    return this.find(idQuery);
  }

  async updateActionStatus({
    environmentId,
    subscriberId,
    id,
    actionType,
    actionStatus,
  }: {
    environmentId: string;
    subscriberId: string;
    id: string;
    actionType: ButtonTypeEnum;
    actionStatus: MessageActionStatusEnum;
  }) {
    const message = await this.findOne({
      _id: id,
      _environmentId: environmentId,
      _subscriberId: subscriberId,
    });

    if (!message) {
      throw new DalException(`Could not find a message with id ${id}`);
    }

    const isUpdatingPrimaryCta = actionType === ButtonTypeEnum.PRIMARY;
    const isUpdatingSecondaryCta = actionType === ButtonTypeEnum.SECONDARY;
    const updatePayload: FilterQuery<MessageEntity> = !message.read
      ? {
          seen: true,
          lastSeenDate: new Date(),
          read: true,
          lastReadDate: new Date(),
        }
      : {};

    if (isUpdatingPrimaryCta) {
      updatePayload['cta.action.result.type'] = ButtonTypeEnum.PRIMARY;
      updatePayload['cta.action.status'] = actionStatus;
    }

    if (isUpdatingSecondaryCta) {
      updatePayload['cta.action.result.type'] = ButtonTypeEnum.SECONDARY;
      updatePayload['cta.action.status'] = actionStatus;
    }

    await this.update(
      {
        _environmentId: environmentId,
        _subscriberId: subscriberId,
        _id: id,
      },
      {
        $set: updatePayload,
      }
    );
  }

  async findMessageById(query: { _id: string; _environmentId: string }): Promise<MessageEntity | null> {
    const res = await this.MongooseModel.findOne({ _id: query._id, _environmentId: query._environmentId })
      .populate('subscriber')
      .populate({
        path: 'actorSubscriber',
        match: {
          'actor.type': ActorTypeEnum.USER,
          _actorId: { $exists: true },
        },
        select: '_id firstName lastName avatar subscriberId',
      });

    return this.mapEntity(res);
  }

  async findWithSubscriber(
    query: MessageQuery & EnforceEnvId,
    select: ProjectionType<MessageEntity> = ''
  ): Promise<MessageEntity[]> {
    const res = await this.MongooseModel.find(query, select).populate('subscriber', 'subscriberId').lean().exec();

    const mappedEntities = this.mapEntities(res);

    // Flatten subscriber data - move subscriber.subscriberId to root level
    return mappedEntities.map((entity) => {
      if (entity.subscriber?.subscriberId) {
        return {
          ...entity,
          subscriberId: entity.subscriber.subscriberId,
          subscriber: undefined, // Remove the nested subscriber object
        };
      }

      return entity;
    });
  }

  async findMessagesByTransactionId(
    query: {
      transactionId: string[];
      _environmentId: string;
    } & Partial<Omit<MessageEntity, 'transactionId'>>
  ) {
    const res = await this.MongooseModel.find({
      transactionId: {
        $in: query.transactionId,
      },
      _environmentId: query._environmentId,
    })
      .populate('subscriber')
      .populate({
        path: 'actorSubscriber',
        match: {
          'actor.type': ActorTypeEnum.USER,
          _actorId: { $exists: true },
        },
        select: '_id firstName lastName avatar subscriberId',
      });

    return this.mapEntities(res);
  }

  async getMessages(
    query: Partial<Omit<MessageEntity, 'transactionId'>> & {
      _environmentId: string;
      transactionId?: string[];
      contextKeys?: string[];
    },
    select = '',
    options?: {
      limit?: number;
      skip?: number;
      sort?: { [key: string]: number };
    }
  ) {
    const filterQuery: FilterQuery<MessageEntity> = { ...query };
    if (query.transactionId) {
      filterQuery.transactionId = { $in: query.transactionId };
    }

    if (query.contextKeys !== undefined) {
      const contextQuery = this.buildContextExactMatchQuery(query.contextKeys);
      filterQuery.$and = [...(filterQuery.$and ?? []), contextQuery];
    }

    const data = await this.MongooseModel.find(filterQuery, select, {
      sort: options?.sort,
      limit: options?.limit,
      skip: options?.skip,
    })
      .read('secondaryPreferred')
      .populate(
        'subscriber',
        '_id firstName lastName avatar subscriberId createdAt updatedAt _organizationId _environmentId deleted'
      )
      .populate(
        'actorSubscriber',
        '_id firstName lastName avatar subscriberId createdAt updatedAt _organizationId _environmentId deleted'
      );

    return this.mapEntities(data);
  }

  async deleteMessagesByIds({
    environmentId,
    subscriberId,
    ids,
  }: {
    environmentId: string;
    subscriberId: string;
    ids: string[];
  }): Promise<MessageEntity[]> {
    const query: MessageQuery & EnforceEnvId = {
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      _id: {
        $in: ids.map((id) => {
          return new Types.ObjectId(id);
        }),
      },
    };

    // First, retrieve the messages that will be deleted for webhook events
    const messagesToDelete = await this.find(query);

    // Then delete them
    await this.delete(query);

    return messagesToDelete;
  }

  async deleteMessagesWithFilters({
    environmentId,
    subscriberId,
    filters,
    contextKeys,
  }: {
    environmentId: string;
    subscriberId: string;
    filters: {
      tags?: string[];
      data?: Record<string, unknown>;
      read?: boolean;
      archived?: boolean;
    };
    contextKeys?: string[];
  }): Promise<MessageEntity[]> {
    const flatData = filters.data ? getFlatObject({ data: filters.data }) : {};

    const query: MessageQuery & EnforceEnvId = {
      ...flatData,
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      ...(filters.tags && filters.tags?.length > 0 && { tags: { $in: filters.tags } }),
      ...(contextKeys && contextKeys?.length > 0 && { contextKeys: { $in: contextKeys } }),
    };

    const isReadFiltered = filters.read !== undefined;
    const isArchivedFiltered = filters.archived !== undefined;

    if (isArchivedFiltered) {
      if (!filters.archived) {
        query.$or = [{ archived: { $exists: false } }, { archived: false }];
      } else {
        query.archived = true;
      }
    } else if (isReadFiltered) {
      if (!filters.read) {
        query.$or = [{ read: { $exists: false } }, { read: false }];
      } else {
        query.read = true;
      }
    }

    // First, retrieve the messages that will be deleted for webhook events
    const messagesToDelete = await this.find(query);

    // Then delete them
    await this.delete(query);

    return messagesToDelete;
  }

  private transformContextKeysQuery(query: FilterQuery<MessageDBModel>): FilterQuery<MessageDBModel> {
    if (!('contextKeys' in query)) {
      return query;
    }

    const contextKeys = query.contextKeys as string[] | undefined;
    const { contextKeys: _, ...restQuery } = query;

    // undefined = feature disabled, skip context filtering
    if (contextKeys === undefined) {
      return restQuery;
    }

    return {
      ...restQuery,
      ...this.buildContextExactMatchQuery(contextKeys),
    };
  }

  private buildContextExactMatchQuery(contextKeys: string[]): MessageQuery {
    // empty array = inbox has no (default) context, only match messages with no context
    if (contextKeys.length === 0) {
      return {
        $or: [{ contextKeys: { $exists: false } }, { contextKeys: [] }],
      };
    }

    // non-empty array = exact match filtering
    return {
      contextKeys: { $all: contextKeys, $size: contextKeys.length },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - isValidKey(key: string): boolean)
 - currentDepth(0, maxDepth: number): [string, any][])
 - getFlatObject(obj: object))
 - _feedId({
        $in: feeds.map((feed))
 - query({
        ...flatData,
        ...query,
      };
    }

    return await this.cursorPagination({
  ...)
 - promises(severityLevels.map((severity))
 - results(await Promise.all(promises);

    return results.map((result, index))
 - feedQuery({
        $in: feeds.map((feed))
 - documentIds(documentsToUpdate.map((doc))
 - updatePayload(this.getReadSeenUpdatePayload(markAs);

    await this.update(
      {
        _environmentId: envir...)
 - lastReadDate(new Date();
    }

    await this.update(
      {
        _environmentId: environmentId,
        _su...)
 - EnforceEnvId({
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      ...(contextKeys && c...)
 - documentIds(documentsToUpdate.map((doc))
 - mappedEntities(this.mapEntities(res);

    // Flatten subscriber data - move subscriber.subscriberId to root level
...)
 - EnforceEnvId({
      _environmentId: environmentId,
      _subscriberId: subscriberId,
      _id: {
        $in: ...)
Declaraciones 'export' encontradas:
- export class MessageRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/message/message.schema.ts
Tamaño: 9034 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ActorTypeEnum, SeverityLevelEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { MessageDBModel } from './message.entity';

const messageSchema = new Schema<MessageDBModel>(
  {
    _templateId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _messageTemplateId: {
      type: Schema.Types.ObjectId,
    },
    _notificationId: {
      type: Schema.Types.ObjectId,
      ref: 'Notification',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    _jobId: {
      type: Schema.Types.ObjectId,
      ref: 'Job',
    },
    templateIdentifier: Schema.Types.String,
    email: Schema.Types.String,
    subject: Schema.Types.String,
    cta: {
      type: {
        type: Schema.Types.String,
      },
      data: Schema.Types.Mixed,
      action: {
        status: Schema.Types.String,
        buttons: [
          {
            type: {
              type: Schema.Types.String,
            },
            content: Schema.Types.String,
            resultContent: Schema.Types.String,
            url: Schema.Types.String,
            target: Schema.Types.String,
          },
        ],
        result: {
          payload: Schema.Types.Mixed,
          type: {
            type: Schema.Types.String,
          },
        },
      },
    },
    _feedId: {
      type: Schema.Types.ObjectId,
      ref: 'Feed',
    },
    channel: Schema.Types.String,
    content: Schema.Types.Mixed,
    phone: Schema.Types.String,
    directWebhookUrl: Schema.Types.String,
    providerId: Schema.Types.String,
    deviceTokens: [Schema.Types.Array],
    title: Schema.Types.String,
    seen: {
      type: Schema.Types.Boolean,
      default: false,
    },
    read: {
      type: Schema.Types.Boolean,
      default: false,
    },
    archived: {
      type: Schema.Types.Boolean,
      default: false,
    },
    snoozedUntil: Schema.Types.Date,
    deliveredAt: {
      type: [Schema.Types.Date],
      default: undefined,
    },
    lastSeenDate: Schema.Types.Date,
    firstSeenDate: Schema.Types.Date,
    lastReadDate: Schema.Types.Date,
    archivedAt: Schema.Types.Date,
    status: {
      type: Schema.Types.String,
      default: 'sent',
    },
    errorId: Schema.Types.String,
    errorText: Schema.Types.String,
    transactionId: {
      type: Schema.Types.String,
    },
    identifier: Schema.Types.String,
    payload: Schema.Types.Mixed,
    data: Schema.Types.Mixed,
    overrides: Schema.Types.Mixed,
    actor: {
      type: {
        type: Schema.Types.String,
        enum: ActorTypeEnum,
      },
      data: Schema.Types.Mixed,
    },
    _actorId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    tags: [Schema.Types.String],
    avatar: Schema.Types.String,
    severity: {
      type: Schema.Types.String,
      enum: SeverityLevelEnum,
      default: SeverityLevelEnum.NONE,
    },
    channelData: {
      type: [
        {
          _id: false,
          identifier: {
            type: Schema.Types.String,
            required: true,
          },
          type: {
            type: Schema.Types.String,
            required: true,
          },
          endpoint: {
            type: Schema.Types.Mixed,
            required: true,
          },
          token: {
            type: Schema.Types.String,
            required: false,
          },
        },
      ],
      default: undefined,
    },
    contextKeys: {
      type: [Schema.Types.String],
      default: undefined,
    },
  },
  schemaOptions
);

/**
 * todo: all the pre hooks should be removed after all the soft deletes are removed task nv-5688
 */
messageSchema.pre('find', function filterDeletedFind() {
  this.where({ deleted: { $ne: true } });
});
messageSchema.pre('findOne', function filterDeletedFindOne() {
  this.where({ deleted: { $ne: true } });
});
messageSchema.pre('findOneAndUpdate', function filterDeletedFindOneAndUpdate() {
  this.where({ deleted: { $ne: true } });
});
messageSchema.pre('countDocuments', function filterDeletedCountDocuments() {
  this.where({ deleted: { $ne: true } });
});
messageSchema.pre('count', function filterDeletedCount() {
  this.where({ deleted: { $ne: true } });
});

messageSchema.virtual('subscriber', {
  ref: 'Subscriber',
  localField: '_subscriberId',
  foreignField: '_id',
  justOne: true,
});

messageSchema.virtual('template', {
  ref: 'NotificationTemplate',
  localField: '_templateId',
  foreignField: '_id',
  justOne: true,
});

messageSchema.virtual('actorSubscriber', {
  ref: 'Subscriber',
  localField: '_actorId',
  foreignField: '_id',
  justOne: true,
});

/*
 * This index was initially created to optimize:
 *
 * Path : libs/dal/src/repositories/message/message.repository.ts
 * Context : findBySubscriberChannel()
 * Query : find({
 * _environmentId: environmentId,
 * _subscriberId: subscriberId,
 * channel,
 * _feedId
 * seen
 * read,
 * sort: '-createdAt',
 * });
 *
 * Path : libs/dal/src/repositories/message/message.repository.ts
 * Context : markAllMessagesAs()
 * Query : update({
 *   _subscriberId: subscriberId,
 *   _environmentId: environmentId,
 *   seen: false,
 *   read: false,
 *   ...(feedQuery && { _feedId: feedQuery })
 *   channel,
 * })
 *
 * Path : libs/dal/src/repositories/message/message.repository.ts
 * Context : getCount()
 * Query : count( _environmentId, _subscriberId, channel, _feedId, seen, read)
 *
 * Path : libs/dal/src/repositories/message/message.repository.ts
 * Context : getTotalCount()
 * Query : count( _environmentId, _subscriberId, channel, _feedId, seen, read)
 *
 * Path : apps/api/src/app/messages/usecases/get-messages/get-messages.usecase.ts
 *    Context : execute()
 *       Query : count({
 *          _environmentId: command.environmentId,
 *          _subscriber: subscriber._id,
 *           channel = command.channel;
 *        })
 *       Query : find({
 *          _environmentId: command.environmentId,
 *          _subscriber: subscriber._id,
 *           channel = command.channel;
 *        })
 */
messageSchema.index({
  _subscriberId: 1,
  _environmentId: 1,
  channel: 1,
  read: 1,
  archived: 1,
  seen: 1,
  snoozedUntil: 1,
  createdAt: -1,
});

/*
 * Path : libs/dal/src/repositories/message/message.repository.ts
 * Context : updateFeedByMessageTemplateId()
 * Query : update({ _environmentId: environmentId, _messageTemplateId: messageId }
 */
messageSchema.index({
  _messageTemplateId: 1,
  _environmentId: 1,
});

/*
 * This index was initially created to optimize:
 *
 * apps/api/src/app/events/usecases/send-message/send-message-in-app.usecase.ts
 * execute
 * findOne({
 *   _notificationId: notification._id,
 *   _environmentId: command.environmentId,
 *   _subscriberId: command._subscriberId,
 *   _templateId: notification._templateId,
 *   _messageTemplateId: inAppChannel.template._id,
 *   channel: ChannelTypeEnum.IN_APP,
 *   transactionId: command.transactionId,
 *   providerId: InAppProviderIdEnum.Novu,
 *   _feedId: inAppChannel.template._feedId,
 * });
 *
 *
 * Path: libs/application-generic/src/usecases/conditions-filter/conditions-filter.usecase.ts
 * Context: processPreviousStep
 * Query: findOne({
 *   _jobId: job._id,
 *   _environmentId: command.environmentId,
 *   _subscriberId: command._subscriberId ? command._subscriberId : command.subscriberId,
 *   transactionId: command.transactionId,
 * });
 *
 * Path: apps/api/src/app/inbound-parse/usecases/inbound-email-parse/inbound-email-parse.usecase.ts
 * Context: getEntities()
 * Query: findOne({
 *   transactionId,
 *   _environmentId: environment._id,
 *   _subscriberId: subscriber._id,
 * });
 */
messageSchema.index({
  transactionId: 1,
  _subscriberId: 1,
  _environmentId: 1,
  providerId: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path: apps/api/src/app/integrations/usecases/calculate-limit-novu-integration/calculate-limit-novu-integration.usecase.ts
 * Context: execute()
 * Query: count(
 *   {
 *     channel: command.channelType,
 *     _environmentId: command.environmentId,
 *     providerId,
 *     createdAt: { $gte: startOfMonth(new Date()), $lte: endOfMonth(new Date()) },
 *   }
 */
messageSchema.index({
  _environmentId: 1,
  providerId: 1,
  createdAt: 1,
});

/*
 * This index was created to push entries to Online Archive
 */
messageSchema.index({ createdAt: 1 });

/**
 * todo: remove deleted field after all the soft deletes are removed task nv-5688
 */
messageSchema.index({ _environmentId: 1, _jobId: 1, deleted: 1 });

/*
 * Index for context key filtering
 */
messageSchema.index({
  _environmentId: 1,
  contextKeys: 1,
});

export const Message =
  (mongoose.models.Message as mongoose.Model<MessageDBModel>) ||
  mongoose.model<MessageDBModel>('Message', messageSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - filterDeletedFind()
 - filterDeletedFindOne()
 - filterDeletedFindOneAndUpdate()
 - filterDeletedCountDocuments()
 - filterDeletedCount()
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-group/index.ts
Tamaño: 139 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './notification-group.entity';
export * from './notification-group.repository';
export * from './notification-group.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-group/notification-group.entity.ts
Tamaño: 485 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';

export class NotificationGroupEntity {
  _id: string;

  name: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;

  _parentId?: string;
}

export type NotificationGroupDBModel = ChangePropsValueType<
  NotificationGroupEntity,
  '_environmentId' | '_organizationId' | '_parentId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationGroupEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-group/notification-group.repository.ts
Tamaño: 503 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { NotificationGroupDBModel, NotificationGroupEntity } from './notification-group.entity';
import { NotificationGroup } from './notification-group.schema';

export class NotificationGroupRepository extends BaseRepository<
  NotificationGroupDBModel,
  NotificationGroupEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(NotificationGroup, NotificationGroupEntity);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationGroupRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-group/notification-group.schema.ts
Tamaño: 944 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { NotificationGroupDBModel } from './notification-group.entity';

const NotificationGroupSchema = new Schema<NotificationGroupDBModel>(
  {
    name: Schema.Types.String,
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationGroup',
    },
  },
  schemaOptions
);

NotificationGroupSchema.index({
  _organizationId: 1,
});

NotificationGroupSchema.index({
  _environmentId: 1,
});

export const NotificationGroup =
  (mongoose.models.NotificationGroup as mongoose.Model<NotificationGroupDBModel>) ||
  mongoose.model<NotificationGroupDBModel>('NotificationGroup', NotificationGroupSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-template/index.ts
Tamaño: 100 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './notification-template.entity';
export * from './notification-template.repository';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-template/notification-template.entity.ts
Tamaño: 3638 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import {
  BuilderFieldType,
  BuilderGroupValues,
  ControlSchemas,
  CustomDataType,
  FilterParts,
  IMessageFilter,
  INotificationTrigger,
  INotificationTriggerVariable,
  IPreferenceChannels,
  ITriggerReservedVariable,
  IWorkflowStepMetadata,
  ResourceOriginEnum,
  ResourceTypeEnum,
  RuntimeIssue,
  SeverityLevelEnum,
  StepIssues,
  TriggerTypeEnum,
  WorkflowStatusEnum,
} from '@novu/shared';
import { Types } from 'mongoose';
import type { ChangePropsValueType } from '../../types';
import type { EnvironmentId } from '../environment';
import { MessageTemplateEntity } from '../message-template';
import { NotificationGroupEntity } from '../notification-group';
import type { OrganizationId } from '../organization';
import { UserEntity } from '../user';

export class NotificationTemplateEntity {
  _id: string;

  name: string;

  description: string;

  active: boolean;

  draft: boolean;

  /** @deprecated - use `userPreferences` instead */
  preferenceSettings: IPreferenceChannels;

  /** @deprecated - use `userPreferences` instead */
  critical: boolean;

  tags: string[];

  steps: NotificationStepEntity[];

  _organizationId: OrganizationId;

  _creatorId: string;

  _environmentId: EnvironmentId;

  triggers: NotificationTriggerEntity[];

  _notificationGroupId: string;

  _parentId?: string;

  deleted: boolean;

  deletedAt: string;

  deletedBy: string;

  createdAt?: string;

  updatedAt?: string;

  _updatedBy?: string;

  readonly notificationGroup?: NotificationGroupEntity;

  readonly updatedBy?: UserEntity;

  isBlueprint: boolean;

  blueprintId?: string;

  data?: CustomDataType;

  type?: ResourceTypeEnum;

  origin?: ResourceOriginEnum;

  rawData?: any;

  payloadSchema?: any;

  validatePayload?: boolean;

  isTranslationEnabled?: boolean;

  issues: Record<string, RuntimeIssue[]>;

  status?: WorkflowStatusEnum;

  lastTriggeredAt?: string;

  lastPublishedAt?: string;

  _lastPublishedBy?: string;

  readonly lastPublishedBy?: UserEntity;

  severity?: SeverityLevelEnum;
}

export type NotificationTemplateDBModel = ChangePropsValueType<
  Omit<NotificationTemplateEntity, '_parentId'>,
  '_environmentId' | '_organizationId' | '_creatorId' | '_notificationGroupId' | '_updatedBy' | '_lastPublishedBy'
> & {
  _parentId?: Types.ObjectId;
};

export class NotificationTriggerEntity implements INotificationTrigger {
  type: TriggerTypeEnum;

  identifier: string;

  variables: INotificationTriggerVariable[];

  subscriberVariables?: Pick<INotificationTriggerVariable, 'name'>[];

  reservedVariables?: ITriggerReservedVariable[];
}

export class NotificationStepData {
  _id?: string;

  uuid?: string;

  stepId?: string;

  issues?: StepIssues;

  name?: string;

  _templateId: string;

  active?: boolean;

  replyCallback?: {
    active: boolean;
    url: string;
  };

  template?: MessageTemplateEntity;

  filters?: StepFilter[];

  _parentId?: string | null;

  metadata?: IWorkflowStepMetadata;

  shouldStopOnFail?: boolean;

  bridgeUrl?: string;
  /*
   * controlVariables exists
   * only on none production environment in order to provide stateless control variables on fly
   */
  controlVariables?: Record<string, unknown>;
  /**
   * @deprecated This property is deprecated and will be removed in future versions.
   * Use IMessageTemplate.controls
   */
  controls?: ControlSchemas;
}
export class NotificationStepEntity extends NotificationStepData {
  variants?: NotificationStepData[];
}

export class StepFilter implements IMessageFilter {
  isNegated?: boolean;
  type?: BuilderFieldType;
  value: BuilderGroupValues;
  children: FilterParts[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationTemplateEntity
- export  type
- export class NotificationTriggerEntity
- export class NotificationStepData
- export class NotificationStepEntity
- export class StepFilter

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-template/notification-template.repository.ts
Tamaño: 13766 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum, ResourceOriginEnum, ResourceTypeEnum, SeverityLevelEnum } from '@novu/shared';
import { ClientSession, FilterQuery } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { EnvironmentRepository } from '../environment';
import { NotificationTemplateDBModel, NotificationTemplateEntity } from './notification-template.entity';
import { NotificationTemplate } from './notification-template.schema';

type NotificationTemplateQuery = FilterQuery<NotificationTemplateDBModel> & EnforceEnvOrOrgIds;

export class NotificationTemplateRepository extends BaseRepository<
  NotificationTemplateDBModel,
  NotificationTemplateEntity,
  EnforceEnvOrOrgIds
> {
  private notificationTemplate: SoftDeleteModel;
  private environmentRepository = new EnvironmentRepository();

  constructor() {
    super(NotificationTemplate, NotificationTemplateEntity);
    this.notificationTemplate = NotificationTemplate;
  }

  async findPublishable(environmentId: string, organizationId: string): Promise<NotificationTemplateEntity[]> {
    const items = await this.MongooseModel.find({
      _environmentId: environmentId,
      _organizationId: organizationId,
      type: ResourceTypeEnum.BRIDGE,
      origin: ResourceOriginEnum.NOVU_CLOUD,
    })
      .select({
        _id: 1,
        name: 1,
        'triggers.identifier': 1,
        updatedAt: 1,
        _updatedBy: 1,
        _environmentId: 1,
        isTranslationEnabled: 1,
      })
      .populate('updatedBy', '_id firstName lastName externalId')
      .populate('lastPublishedBy', '_id firstName lastName externalId');

    return this.mapEntities(items);
  }

  async findForBulkPreferences(
    environmentId: string,
    ids: string[],
    identifiers: string[],
    session?: ClientSession | null
  ) {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      $or: [{ _id: { $in: ids } }, { 'triggers.identifier': { $in: identifiers } }],
    };

    const query = this.MongooseModel.find(requestQuery, undefined, { session }).populate('steps.template', { type: 1 });

    const items = await query;

    return this.mapEntities(items);
  }

  async findByTriggerIdentifierBulk(environmentId: string, identifiers: string[], session?: ClientSession | null) {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      'triggers.identifier': { $in: identifiers },
    };

    const query = this.MongooseModel.find(requestQuery, undefined, { session }).populate('steps.template');

    const items = await query;

    return this.mapEntities(items);
  }

  async findByTriggerIdentifier(environmentId: string, identifier: string, session?: ClientSession | null) {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      'triggers.identifier': identifier,
    };

    const query = this.MongooseModel.findOne(requestQuery, undefined, { session })
      .populate('steps.template')
      .populate('updatedBy');

    const item = await query;

    return this.mapEntity(item);
  }

  async findAllByTriggerIdentifier(
    environmentId: string,
    identifier: string,
    session?: ClientSession | null
  ): Promise<NotificationTemplateEntity[]> {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      'triggers.identifier': identifier,
    };

    const query = await this._model.find(requestQuery, { _id: 1, 'triggers.identifier': 1 }, { session });

    return this.mapEntities(query);
  }

  async findById(id: string, environmentId: string, session?: ClientSession | null) {
    const query = this.MongooseModel.findOne(
      {
        _id: id,
        _environmentId: environmentId,
      },
      undefined,
      { session }
    )
      .populate('steps.template')
      .populate('steps.variants.template')
      .populate('updatedBy');

    const item = await query;

    return this.mapEntity(item);
  }

  async findByTriggerIdentifierAndUpdate(environmentId: string, triggerIdentifier: string, lastTriggeredAt: Date) {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      'triggers.identifier': triggerIdentifier,
    };

    const item = await this.MongooseModel.findOneAndUpdate(
      requestQuery,
      {
        $set: {
          lastTriggeredAt,
        },
      },
      {
        timestamps: false,
      }
    ).populate('steps.template');

    return this.mapEntity(item);
  }

  async updatePublishFields(workflowId: string, environmentId: string, userId: string, session?: ClientSession | null) {
    const requestQuery: NotificationTemplateQuery = {
      _id: workflowId,
      _environmentId: environmentId,
    };

    const item = await this.MongooseModel.findOneAndUpdate(
      requestQuery,
      {
        $set: {
          lastPublishedAt: new Date(),
          _lastPublishedBy: userId,
        },
      },
      { session, new: true }
    );

    return this.mapEntity(item);
  }

  async findBlueprintById(id: string) {
    if (!this.blueprintOrganizationId) throw new DalException('Blueprint environment id was not found');

    const requestQuery: NotificationTemplateQuery = {
      isBlueprint: true,
      _organizationId: this.blueprintOrganizationId,
      _id: id,
    };

    const item = await this.MongooseModel.findOne(requestQuery)
      .populate('steps.template')
      .populate('notificationGroup')
      .lean();

    return this.mapEntity(item);
  }

  async findBlueprintByTriggerIdentifier(identifier: string) {
    if (!this.blueprintOrganizationId) throw new DalException('Blueprint environment id was not found');

    const requestQuery: NotificationTemplateQuery = {
      isBlueprint: true,
      _organizationId: this.blueprintOrganizationId,
      triggers: { $elemMatch: { identifier } },
    };

    const item = await this.MongooseModel.findOne(requestQuery)
      .populate('steps.template')
      .populate('notificationGroup')
      .lean();

    return this.mapEntity(item);
  }

  async findBlueprintTemplates(organizationId: string, environmentId: string): Promise<NotificationTemplateEntity[]> {
    const _organizationId = organizationId;

    if (!_organizationId) throw new DalException('Blueprint environment id was not found');

    const templates = await this.MongooseModel.find({
      isBlueprint: true,
      _environmentId: environmentId,
      _organizationId,
    })
      .populate('steps.template')
      .populate('notificationGroup')
      .lean();

    if (!templates) {
      return [];
    }

    return this.mapEntities(templates);
  }

  async findAllGroupedByCategory(): Promise<{ name: string; blueprints: NotificationTemplateEntity[] }[]> {
    const organizationId = this.blueprintOrganizationId;

    if (!organizationId) {
      return [];
    }

    const productionEnvironmentId = (
      await this.environmentRepository.findOrganizationEnvironments(organizationId)
    )?.find((env) => env.name === 'Production')?._id;

    if (!productionEnvironmentId) {
      throw new DalException(
        `Production environment id for BLUEPRINT_CREATOR ${process.env.BLUEPRINT_CREATOR} was not found`
      );
    }

    const requestQuery: NotificationTemplateQuery = {
      isBlueprint: true,
      _environmentId: productionEnvironmentId,
      _organizationId: organizationId,
    };

    const result = await this.MongooseModel.find(requestQuery)
      .populate('steps.template')
      .populate('notificationGroup')
      .lean();

    const items = result?.map((item) => this.mapEntity(item));

    const groupedItems = items.reduce((acc, item) => {
      const notificationGroupId = item._notificationGroupId;
      const notificationGroupName = item.notificationGroup?.name;

      if (!acc[notificationGroupId]) {
        acc[notificationGroupId] = {
          name: notificationGroupName,
          blueprints: [],
        };
      }

      acc[notificationGroupId].blueprints.push(item);

      return acc;
    }, {});

    return Object.values(groupedItems);
  }

  async getBlueprintList(skip = 0, limit = 10) {
    if (!this.blueprintOrganizationId) {
      return { totalCount: 0, data: [] };
    }

    const requestQuery: NotificationTemplateQuery = {
      isBlueprint: true,
      _organizationId: this.blueprintOrganizationId,
    };

    const totalItemsCount = await this.count(requestQuery);
    const items = await this.MongooseModel.find(requestQuery)
      .sort({ createdAt: -1 })
      .skip(skip)
      .limit(limit)
      .populate({ path: 'notificationGroup' });

    return { totalCount: totalItemsCount, data: this.mapEntities(items) };
  }

  async getList(
    organizationId: string,
    environmentId: string,
    skip: number = 0,
    limit: number = 10,
    query?: string,
    excludeNewDashboardWorkflows: boolean = false,
    orderBy: string = 'createdAt',
    orderDirection: DirectionEnum = DirectionEnum.DESC,
    tags?: string[],
    status?: string[]
  ): Promise<{ totalCount: number; data: NotificationTemplateEntity[] }> {
    const searchQuery: FilterQuery<NotificationTemplateDBModel> = {};

    if (query) {
      searchQuery.$or = [
        { name: { $regex: regExpEscape(query), $options: 'i' } },
        { 'triggers.identifier': { $regex: regExpEscape(query), $options: 'i' } },
      ];
    }

    if (excludeNewDashboardWorkflows) {
      searchQuery.$nor = [{ origin: 'novu-cloud', type: 'BRIDGE' }];
    }

    if (tags && tags.length > 0) {
      searchQuery.tags = { $in: tags };
    }

    if (status && status.length > 0) {
      searchQuery.status = { $in: status };
    }

    const totalItemsCount = await this.count({
      _environmentId: environmentId,
      ...searchQuery,
    });

    const mongoQuery = this.MongooseModel.find({
      _environmentId: environmentId,
      _organizationId: organizationId,
      ...searchQuery,
    })
      .sort({ [orderBy]: orderDirection === DirectionEnum.ASC ? 1 : -1 })
      .skip(skip)
      .limit(limit)
      .populate({ path: 'notificationGroup' })
      .populate('steps.template', { type: 1 })
      .select('-steps.variants')
      .populate('updatedBy')
      .populate('lastPublishedBy', '_id firstName lastName');

    const items = await mongoQuery.lean();

    return { totalCount: totalItemsCount, data: this.mapEntities(items) };
  }

  async filterActive({
    organizationId,
    environmentId,
    tags,
    critical,
    severity,
  }: {
    organizationId: string;
    environmentId: string;
    tags?: string[];
    critical?: boolean;
    severity?: SeverityLevelEnum[];
  }) {
    const requestQuery: NotificationTemplateQuery = {
      _environmentId: environmentId,
      _organizationId: organizationId,
      active: true,
    };

    const severityCondition: Array<FilterQuery<NotificationTemplateDBModel>> = [];
    if (severity && severity?.length > 0) {
      if (severity.includes(SeverityLevelEnum.NONE)) {
        severityCondition.push({ severity: { $exists: false } }, { severity: { $in: severity } });
      } else {
        requestQuery.severity = { $in: severity };
      }
    }

    if (tags && tags?.length > 0) {
      requestQuery.tags = { $in: tags };
    }

    if (critical !== undefined) {
      requestQuery.critical = { $eq: critical };
    }

    // combine all $or conditions properly
    const orConditions: Array<FilterQuery<NotificationTemplateDBModel>> = [];
    if (severityCondition.length > 0) {
      orConditions.push({ $or: severityCondition });
    }
    if (orConditions.length > 0) {
      requestQuery.$and = [...(requestQuery.$and ?? []), ...orConditions];
    }

    const items = await this.MongooseModel.find(requestQuery)
      .populate('steps.template', { type: 1 })
      .limit(200) // protective limit
      .read('secondaryPreferred');

    return this.mapEntities(items);
  }

  async delete(query: NotificationTemplateQuery) {
    return await this.notificationTemplate.delete({ _id: query._id, _environmentId: query._environmentId });
  }

  async findDeleted(query: NotificationTemplateQuery): Promise<NotificationTemplateEntity> {
    const res: NotificationTemplateEntity = await this.notificationTemplate.findDeleted(query);

    return this.mapEntity(res);
  }

  private get blueprintOrganizationId(): string | undefined {
    return NotificationTemplateRepository.getBlueprintOrganizationId();
  }

  public static getBlueprintOrganizationId(): string | undefined {
    return process.env.BLUEPRINT_CREATOR;
  }

  async estimatedDocumentCount(): Promise<any> {
    return this.notificationTemplate.estimatedDocumentCount();
  }

  async getTotalSteps(): Promise<number> {
    const res = await this.notificationTemplate.aggregate<{ totalSteps: number }>([
      {
        $group: {
          _id: null,
          totalSteps: {
            $sum: {
              $cond: {
                if: { $isArray: '$steps' },
                then: { $size: '$steps' },
                else: 0,
              },
            },
          },
        },
      },
    ]);
    if (res.length > 0) {
      return res[0].totalSteps;
    } else {
      return 0;
    }
  }

  async findWithTemplates(query: NotificationTemplateQuery): Promise<NotificationTemplateEntity[]> {
    const items = await this.MongooseModel.find(query)
      .populate('steps.template')
      .populate('steps.variants.template')
      .populate('updatedBy')
      .lean();

    return this.mapEntities(items);
  }
}

function regExpEscape(literalString: string): string {
  return literalString.replace(/[-[\]{}()*+!<=:?./\\^$|#\s,]/g, '\\$&');
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - regExpEscape(literalString: string)
Asignaciones con arrow functions encontradas (posibles funciones):
 - productionEnvironmentId(await this.environmentRepository.findOrganizationEnvironments(organizationId)
    )?.find((env))
 - items(result?.map((item))
 - groupedItems(items.reduce((acc, item))
Declaraciones 'export' encontradas:
- export class NotificationTemplateRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification-template/notification-template.schema.ts
Tamaño: 7898 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ResourceTypeEnum, SeverityLevelEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { NotificationTemplateDBModel } from './notification-template.entity';

const mongooseDelete = require('mongoose-delete');

const variantSchemePart = {
  active: {
    type: Schema.Types.Boolean,
    default: true,
  },
  replyCallback: {
    active: Schema.Types.Boolean,
    url: Schema.Types.String,
  },
  shouldStopOnFail: {
    type: Schema.Types.Boolean,
    default: false,
  },
  issues: Schema.Types.Mixed,
  uuid: Schema.Types.String,
  stepId: Schema.Types.String,
  name: Schema.Types.String,
  type: {
    type: Schema.Types.String,
    default: ResourceTypeEnum.REGULAR,
  },
  filters: [
    {
      isNegated: Schema.Types.Boolean,
      type: {
        type: Schema.Types.String,
      },
      value: Schema.Types.String,
      children: [
        {
          field: Schema.Types.String,
          value: Schema.Types.Mixed,
          operator: Schema.Types.String,
          on: Schema.Types.String,
          webhookUrl: Schema.Types.String,
          timeOperator: Schema.Types.String,
          step: Schema.Types.String,
          stepType: Schema.Types.String,
        },
      ],
    },
  ],
  _templateId: {
    type: Schema.Types.ObjectId,
    ref: 'MessageTemplate',
  },
  _parentId: {
    type: Schema.Types.ObjectId,
  },
  metadata: {
    amount: {
      type: Schema.Types.Number,
    },
    unit: {
      type: Schema.Types.String,
    },
    digestKey: {
      type: Schema.Types.String,
    },
    delayPath: {
      type: Schema.Types.String,
    },
    type: {
      type: Schema.Types.String,
    },
    backoffUnit: {
      type: Schema.Types.String,
    },
    backoffAmount: {
      type: Schema.Types.Number,
    },
    updateMode: {
      type: Schema.Types.Boolean,
    },
    backoff: {
      type: Schema.Types.Boolean,
    },
    timed: {
      atTime: {
        type: Schema.Types.String,
      },
      weekDays: [Schema.Types.String],
      monthDays: [Schema.Types.Number],
      ordinal: {
        type: Schema.Types.String,
      },
      ordinalValue: {
        type: Schema.Types.String,
      },
      monthlyType: {
        type: Schema.Types.String,
      },
    },
  },
};

const notificationTemplateSchema = new Schema<NotificationTemplateDBModel>(
  {
    name: Schema.Types.String,
    description: Schema.Types.String,
    active: {
      type: Schema.Types.Boolean,
      default: false,
    },
    type: {
      type: Schema.Types.String,
      default: ResourceTypeEnum.REGULAR,
    },
    draft: {
      type: Schema.Types.Boolean,
      default: true,
    },
    critical: {
      type: Schema.Types.Boolean,
      default: false,
    },
    isBlueprint: {
      type: Schema.Types.Boolean,
      default: false,
    },
    blueprintId: {
      type: Schema.Types.String,
    },
    _notificationGroupId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationGroup',
    },
    tags: [Schema.Types.String],
    triggers: [
      {
        type: {
          type: Schema.Types.String,
        },
        identifier: Schema.Types.String,
        variables: [
          {
            name: Schema.Types.String,
            type: {
              type: Schema.Types.String,
            },
          },
        ],
        reservedVariables: [
          {
            type: {
              type: Schema.Types.String,
            },
            variables: [
              {
                name: Schema.Types.String,
                type: {
                  type: Schema.Types.String,
                },
              },
            ],
          },
        ],
        subscriberVariables: [
          {
            name: Schema.Types.String,
          },
        ],
      },
    ],
    steps: [
      {
        ...variantSchemePart,
        variants: [variantSchemePart],
      },
    ],
    preferenceSettings: {
      email: {
        type: Schema.Types.Boolean,
        default: true,
      },
      sms: {
        type: Schema.Types.Boolean,
        default: true,
      },
      in_app: {
        type: Schema.Types.Boolean,
        default: true,
      },
      chat: {
        type: Schema.Types.Boolean,
        default: true,
      },
      push: {
        type: Schema.Types.Boolean,
        default: true,
      },
    },
    origin: {
      type: Schema.Types.String,
    },
    status: {
      type: Schema.Types.String,
    },
    lastTriggeredAt: {
      type: Schema.Types.Date,
      default: null,
    },
    lastPublishedAt: {
      type: Schema.Types.Date,
      default: null,
    },
    _lastPublishedBy: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _creatorId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _updatedBy: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _parentId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    data: Schema.Types.Mixed,
    rawData: Schema.Types.Mixed,
    payloadSchema: Schema.Types.Mixed,
    validatePayload: {
      type: Schema.Types.Boolean,
      default: false,
    },
    isTranslationEnabled: {
      type: Schema.Types.Boolean,
      default: false,
    },
    issues: Schema.Types.Mixed,
    severity: {
      type: Schema.Types.String,
      enum: SeverityLevelEnum,
      default: SeverityLevelEnum.NONE,
    },
  },
  { ...schemaOptions, minimize: false }
);

notificationTemplateSchema.virtual('steps.template', {
  ref: 'MessageTemplate',
  localField: 'steps._templateId',
  foreignField: '_id',
  justOne: true,
});

notificationTemplateSchema.virtual('steps.variants.template', {
  ref: 'MessageTemplate',
  localField: 'steps.variants._templateId',
  foreignField: '_id',
  justOne: true,
});

notificationTemplateSchema.path('steps').schema.set('toJSON', { virtuals: true });
notificationTemplateSchema.path('steps').schema.set('toObject', { virtuals: true });

notificationTemplateSchema.path('steps.variants').schema.set('toJSON', { virtuals: true });
notificationTemplateSchema.path('steps.variants').schema.set('toObject', { virtuals: true });

notificationTemplateSchema.virtual('notificationGroup', {
  ref: 'NotificationGroup',
  localField: '_notificationGroupId',
  foreignField: '_id',
  justOne: true,
});

notificationTemplateSchema.virtual('updatedBy', {
  ref: 'User',
  localField: '_updatedBy',
  foreignField: '_id',
  justOne: true,
  select: '_id firstName lastName externalId',
});

notificationTemplateSchema.virtual('lastPublishedBy', {
  ref: 'User',
  localField: '_lastPublishedBy',
  foreignField: '_id',
  justOne: true,
  select: '_id firstName lastName externalId',
});

notificationTemplateSchema.virtual('lastPublishedByUser', {
  ref: 'User',
  localField: '_lastPublishedBy',
  foreignField: '_id',
  justOne: true,
  select: '_id firstName lastName externalId',
});

notificationTemplateSchema.index({
  _environmentId: 1,
  'triggers.identifier': 1,
});

notificationTemplateSchema.index({
  _environmentId: 1,
  _id: 1,
});

// TODO: Deprecate this index. Use the envId, triggerId instead
notificationTemplateSchema.index({
  _organizationId: 1,
  'triggers.identifier': 1,
});

// TODO: Deprecate this index. Use the envId, triggerId instead
notificationTemplateSchema.index({
  _environmentId: 1,
  name: 1,
});

notificationTemplateSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const NotificationTemplate =
  (mongoose.models.NotificationTemplate as mongoose.Model<NotificationTemplateDBModel>) ||
  mongoose.model<NotificationTemplateDBModel>('NotificationTemplate', notificationTemplateSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification/index.ts
Tamaño: 170 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './notification.entity';
export * from './notification.feed.Item.entity';
export * from './notification.repository';
export * from './notification.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification/notification.entity.ts
Tamaño: 1315 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ISubscribersDefine, SeverityLevelEnum, StatelessControls, StepTypeEnum } from '@novu/shared';

import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import { NotificationTemplateEntity } from '../notification-template';
import type { OrganizationId } from '../organization';

export class NotificationEntity {
  _id: string;

  _templateId: string;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;

  _subscriberId: string;

  topics: {
    _topicId: string;
    topicKey: string;
  }[];

  transactionId: string;

  template?: NotificationTemplateEntity;

  channels?: StepTypeEnum[];

  _digestedNotificationId?: string;

  /*
   * This is a field that is used to define the subscriber that will receive the notification.
   * This field simplifies metric retrieval by associating external subscriber data, such as subscriberId.
   */
  to?: ISubscribersDefine | any;

  payload?: any;

  createdAt?: string;
  updatedAt?: string;
  tags?: string[];
  controls?: StatelessControls;
  severity?: SeverityLevelEnum;
  critical?: boolean;
  contextKeys?: string[];
}

export type NotificationDBModel = ChangePropsValueType<
  NotificationEntity,
  '_environmentId' | '_organizationId' | '_templateId' | '_subscriberId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification/notification.feed.Item.entity.ts
Tamaño: 1264 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { StepTypeEnum } from '@novu/shared';
import { ExecutionDetailsEntity } from '../execution-details';
import { JobEntity } from '../job';
import { NotificationTemplateEntity } from '../notification-template';
import { SubscriberEntity } from '../subscriber';
import { NotificationEntity } from './notification.entity';

export type NotificationFeedItemEntity = Omit<NotificationEntity, 'template'> & {
  template?: TemplateFeedItem;
  subscriber?: SubscriberFeedItem;
  jobs: JobFeedItem[];
};
export type TemplateFeedItem = Pick<NotificationTemplateEntity, '_id' | 'name' | 'triggers' | 'origin'>;

export type SubscriberFeedItem = Pick<
  SubscriberEntity,
  '_id' | 'firstName' | 'lastName' | 'email' | 'subscriberId' | 'phone'
>;

export type JobFeedItem = Pick<
  JobEntity,
  | '_id'
  | 'status'
  | 'overrides'
  | 'payload'
  | 'step'
  | 'type'
  | 'providerId'
  | 'createdAt'
  | 'updatedAt'
  | 'digest'
  | 'scheduleExtensionsCount'
> & {
  executionDetails: ExecutionDetailFeedItem[]; // Assuming ExecutionDetailFeedItem is defined
  type: StepTypeEnum;
};

export type ExecutionDetailFeedItem = Pick<
  ExecutionDetailsEntity,
  '_id' | 'providerId' | 'detail' | 'source' | '_jobId' | 'status' | 'isTest' | 'isRetry' | 'createdAt' | 'raw'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification/notification.repository.ts
Tamaño: 10184 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, SeverityLevelEnum, StepTypeEnum } from '@novu/shared';
import { subMonths, subWeeks } from 'date-fns';
import { FilterQuery, QueryWithHelpers, Types } from 'mongoose';

import type { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { EnvironmentId } from '../environment';
import { NotificationDBModel, NotificationEntity } from './notification.entity';
import { NotificationFeedItemEntity } from './notification.feed.Item.entity';
import { Notification } from './notification.schema';

export class NotificationRepository extends BaseRepository<
  NotificationDBModel,
  NotificationEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(Notification, NotificationEntity);
  }

  async findBySubscriberId(environmentId: string, subscriberId: string) {
    return await this.find({
      _environmentId: environmentId,
      _subscriberId: subscriberId,
    });
  }

  async getFeed(
    environmentId: string,
    query: {
      channels?: ChannelTypeEnum[] | null;
      templates?: string[] | null;
      subscriberIds?: string[];
      transactionId?: string[];
      topicKey?: string;
      severity?: SeverityLevelEnum[] | null;
      after?: string;
      before?: string;
      contextKeys?: string[];
    } = {},
    skip = 0,
    limit = 10
  ): Promise<NotificationFeedItemEntity[]> {
    const requestQuery: FilterQuery<NotificationDBModel> = {
      _environmentId: environmentId,
    };

    if (query.transactionId && query.transactionId.length > 0) {
      requestQuery.transactionId = {
        $in: query.transactionId,
      };
    }

    if (query.topicKey) {
      requestQuery['topics.topicKey'] = query.topicKey;
    }

    const severityCondition: Array<FilterQuery<NotificationDBModel>> = [];
    const orConditions: Array<FilterQuery<NotificationDBModel>> = [];

    if (query.severity && query.severity?.length > 0) {
      if (query.severity.includes(SeverityLevelEnum.NONE)) {
        severityCondition.push({ severity: { $exists: false } }, { severity: { $in: query.severity } });
      } else {
        requestQuery.severity = { $in: query.severity };
      }
    }

    if (query.after || query.before) {
      requestQuery.createdAt = {};

      if (query.after) {
        requestQuery.createdAt.$gte = query.after;
      }

      if (query.before) {
        requestQuery.createdAt.$lte = query.before;
      }
    }

    if (query?.templates) {
      requestQuery._templateId = {
        $in: query.templates,
      };
    }

    if (query.subscriberIds && query.subscriberIds.length > 0) {
      requestQuery._subscriberId = {
        $in: query.subscriberIds,
      };
    }

    if (query?.channels) {
      requestQuery.channels = {
        $in: query.channels,
      };
    }

    if (query.contextKeys !== undefined) {
      const contextQuery = this.buildContextExactMatchQuery(query.contextKeys);
      requestQuery.$and = [...(requestQuery.$and ?? []), contextQuery];
    }

    // combine all $or conditions properly
    if (severityCondition.length > 0) {
      orConditions.push({ $or: severityCondition });
    }
    if (orConditions.length > 0) {
      requestQuery.$and = [...(requestQuery.$and ?? []), ...orConditions];
    }

    const response = await this.populateFeed(this.MongooseModel.find(requestQuery), environmentId)
      .read('secondaryPreferred')
      .skip(skip)
      .limit(limit)
      .sort('-createdAt');

    return this.mapEntities(response) as unknown as NotificationFeedItemEntity[];
  }

  public async getFeedItem(
    notificationId: string,
    _environmentId: string,
    _organizationId: string
  ): Promise<NotificationFeedItemEntity> {
    const requestQuery: FilterQuery<NotificationDBModel> = {
      _id: notificationId,
      _environmentId,
      _organizationId,
    };

    return this.mapEntity(
      await this.populateFeed(this.MongooseModel.findOne(requestQuery), _environmentId)
    ) as unknown as NotificationFeedItemEntity;
  }

  public async findMetadataForTraces(
    notificationId: string,
    _environmentId: string,
    _organizationId: string
  ): Promise<NotificationFeedItemEntity> {
    const requestQuery: FilterQuery<NotificationDBModel> = {
      _id: notificationId,
      _environmentId,
      _organizationId,
    };

    return this.mapEntity(
      await this.populateFeedWithoutExecutionDetails(this.MongooseModel.findOne(requestQuery), _environmentId)
    ) as unknown as NotificationFeedItemEntity;
  }

  public async findNotificationMetadataOnly(
    notificationId: string,
    _environmentId: string,
    _organizationId: string
  ): Promise<NotificationFeedItemEntity> {
    const requestQuery: FilterQuery<NotificationDBModel> = {
      _id: notificationId,
      _environmentId,
      _organizationId,
    };

    return this.mapEntity(
      await this.populateNotificationMetadataOnly(this.MongooseModel.findOne(requestQuery))
    ) as unknown as NotificationFeedItemEntity;
  }

  private populateFeed(query: QueryWithHelpers<unknown, unknown, unknown>, environmentId: string) {
    return query
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'subscriber',
        select: 'firstName _id lastName email phone subscriberId',
      })
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'template',
        select: '_id name triggers origin',
      })
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
          sort: { createdAt: 1, _parentId: 1 },
        },
        path: 'jobs',
        match: {
          _environmentId: new Types.ObjectId(environmentId),
          type: {
            $nin: [StepTypeEnum.TRIGGER],
          },
        },
        select:
          'createdAt digest payload overrides to tenant actorId providerId step status type updatedAt _parentId scheduleExtensionsCount',
        populate: [
          {
            path: 'executionDetails',
            select: 'createdAt detail isRetry isTest providerId raw source status updatedAt webhookStatus',
            options: {
              sort: { createdAt: 1 },
            },
          },
          {
            path: 'step',
            select: '_parentId _templateId active filters template',
          },
        ],
      });
  }

  private populateFeedWithoutExecutionDetails(
    query: QueryWithHelpers<unknown, unknown, unknown>,
    environmentId: string
  ) {
    return query
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'subscriber',
        select: 'firstName _id lastName email phone subscriberId',
      })
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'template',
        select: '_id name triggers origin',
      })
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
          sort: { createdAt: 1, _parentId: 1 },
        },
        path: 'jobs',
        match: {
          _environmentId: new Types.ObjectId(environmentId),
          type: {
            $nin: [StepTypeEnum.TRIGGER],
          },
        },
        select:
          'createdAt digest payload overrides to tenant actorId providerId step status type updatedAt _parentId scheduleExtensionsCount',
        populate: [
          {
            path: 'step',
            select: '_parentId _templateId active filters template',
          },
        ],
      });
  }

  private populateNotificationMetadataOnly(query: QueryWithHelpers<unknown, unknown, unknown>) {
    return query
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'subscriber',
        select: 'firstName _id lastName email phone subscriberId',
      })
      .populate({
        options: {
          readPreference: 'secondaryPreferred',
        },
        path: 'template',
        select: '_id name triggers origin',
      });
  }

  async getActivityGraphStats(date: Date, environmentId: string) {
    return await this.aggregate(
      [
        {
          $match: {
            createdAt: { $gte: date },
            _environmentId: new Types.ObjectId(environmentId),
          },
        },
        { $unwind: '$channels' },
        {
          $group: {
            _id: {
              $dateToString: { format: '%Y-%m-%d', date: '$createdAt' },
            },
            count: {
              $sum: 1,
            },
            templates: { $addToSet: '$_templateId' },
            channels: { $addToSet: '$channels' },
          },
        },
        { $sort: { createdAt: -1 } },
      ],
      {
        readPreference: 'secondaryPreferred',
      }
    );
  }

  async getStats(environmentId: EnvironmentId): Promise<{ weekly: number; monthly: number }> {
    const now: number = Date.now();
    const monthBefore = subMonths(now, 1);
    const weekBefore = subWeeks(now, 1);

    const result = await this.aggregate(
      [
        {
          $match: {
            _environmentId: this.convertStringToObjectId(environmentId),
            createdAt: {
              $gte: monthBefore,
            },
          },
        },
        {
          $group: {
            _id: null,
            weekly: { $sum: { $cond: [{ $gte: ['$createdAt', weekBefore] }, 1, 0] } },
            monthly: { $sum: 1 },
          },
        },
      ],
      {
        readPreference: 'secondaryPreferred',
      }
    );

    const stats = result[0] || {};

    return {
      weekly: stats.weekly || 0,
      monthly: stats.monthly || 0,
    };
  }

  estimatedDocumentCount() {
    return this.MongooseModel.estimatedDocumentCount();
  }

  private buildContextExactMatchQuery(contextKeys: string[]) {
    // empty array = inbox has no context, only match notifications with no context
    if (contextKeys.length === 0) {
      return {
        $or: [{ contextKeys: { $exists: false } }, { contextKeys: [] }],
      };
    }

    // non-empty array = exact match filtering
    return {
      contextKeys: { $all: contextKeys, $size: contextKeys.length },
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class NotificationRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/notification/notification.schema.ts
Tamaño: 5313 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SeverityLevelEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { NotificationDBModel } from './notification.entity';

const notificationSchema = new Schema<NotificationDBModel>(
  {
    _templateId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    topics: [
      {
        _topicId: {
          type: Schema.Types.ObjectId,
          ref: 'Topic',
        },
        topicKey: {
          type: Schema.Types.String,
        },
      },
    ],
    transactionId: {
      type: Schema.Types.String,
    },
    channels: [
      {
        type: Schema.Types.String,
      },
    ],
    _digestedNotificationId: {
      type: Schema.Types.String,
    },
    to: {
      type: Schema.Types.Mixed,
    },
    payload: {
      type: Schema.Types.Mixed,
    },
    controls: {
      type: Schema.Types.Mixed,
    },
    tags: {
      type: [Schema.Types.String],
    },
    severity: {
      type: Schema.Types.String,
      enum: SeverityLevelEnum,
      default: SeverityLevelEnum.NONE,
    },
    critical: {
      type: Schema.Types.Boolean,
    },
    contextKeys: {
      type: [Schema.Types.String],
      default: undefined,
    },
  },
  schemaOptions
);

notificationSchema.virtual('environment', {
  ref: 'Environment',
  localField: '_environmentId',
  foreignField: '_id',
  justOne: true,
});

notificationSchema.virtual('organization', {
  ref: 'Organization',
  localField: '_organizationId',
  foreignField: '_id',
  justOne: true,
});

notificationSchema.virtual('template', {
  ref: 'NotificationTemplate',
  localField: '_templateId',
  foreignField: '_id',
  justOne: true,
});

notificationSchema.virtual('subscriber', {
  ref: 'Subscriber',
  localField: '_subscriberId',
  foreignField: '_id',
  justOne: true,
});

notificationSchema.virtual('jobs', {
  ref: 'Job',
  localField: '_id',
  foreignField: '_notificationId',
});

/*
 *
 * Path: libs/dal/src/repositories/notification/notification.repository.ts
 *    Context: findBySubscriberId()
 *        Query: find({_environmentId: environmentId,
 *                    _subscriberId: subscriberId,});
 *
 */
notificationSchema.index({
  _subscriberId: 1,
  _environmentId: 1,
});

/*
 * Path: libs/dal/src/repositories/notification/notification.repository.ts
 *    Context: getFeed()
 *        Query: find({
 *               transactionId: subscriberId,
 *               _environmentId: environmentId,
 *               _templateId = {$in: query.templates};
 *               _subscriberId = {$in: query._subscriberIds};
 *               channels = {$in: query.channels};
 *              .sort('-createdAt')});
 *
 * Path: libs/dal/src/repositories/notification/notification.repository.ts
 *     Context: getFeed()
 *         Query: MongooseModel.countDocuments({
 *                 transactionId: subscriberId,
 *                 _environmentId: environmentId,
 *                 _templateId = {$in: query.templates};
 *                 _subscriberId = {$in: query._subscriberIds};
 *                 channels = {$in: query.channels}});
 *
 */
notificationSchema.index({
  transactionId: 1,
  _environmentId: 1,
  createdAt: -1,
});

/*
 *
 * Path: libs/dal/src/repositories/notification/notification.repository.ts
 *    Context: getActivityGraphStats()
 *        Query: aggregate(
 *                {createdAt: { $gte: date }_environmentId: new Types.ObjectId(environmentId),
 *                { $sort: { createdAt: -1 } }})
 *
 * Path: libs/dal/src/repositories/notification/notification.repository.ts
 *    Context: getStats()
 *        Query: aggregate({
 *           _environmentId: this.convertStringToObjectId(environmentId),
 *           createdAt: {$gte: monthBefore}
 *           weekly: { $sum: { $cond: [{ $gte: ['$createdAt', weekBefore] }, 1, 0] } },
 *
 *
 * Path: ./get-platform-notification-usage.usecase.ts
 *    Context: execute()
 *        Query: organizationRepository.aggregate(
 *                $lookup:
 *        {
 *          from: 'notifications',
 *          localField: 'environments._id',
 *          foreignField: '_environmentId',
 *          as: 'notifications',
 *        }
 */
notificationSchema.index({
  _environmentId: 1,
  createdAt: -1,
});
/*
 * There was no point indexing old records,
 * we are not searching anything more than a month back
 */
notificationSchema.index(
  {
    _environmentId: 1,
    createdAt: 1,
  },
  {
    partialFilterExpression: {
      createdAt: {
        $gte: new Date('2025-01-01T00:00:00Z'),
      },
    },
  }
);

/*
 * This index was created to push entries to Online Archive
 */
notificationSchema.index({ createdAt: 1 });

/*
 * Index for context key filtering
 * Supports both exact matches and regex searches
 */
notificationSchema.index({
  _environmentId: 1,
  contextKeys: 1,
});

export const Notification =
  (mongoose.models.Notification as mongoose.Model<NotificationDBModel>) ||
  mongoose.model<NotificationDBModel>('Notification', notificationSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/community.organization.repository.ts
Tamaño: 4196 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { BaseRepository } from '../base-repository';
import { CommunityMemberRepository } from '../member';
import { IPartnerConfiguration, OrganizationDBModel, OrganizationEntity } from './organization.entity';
import { Organization } from './organization.schema';
import { IOrganizationRepository } from './organization-repository.interface';

export class CommunityOrganizationRepository
  extends BaseRepository<OrganizationDBModel, OrganizationEntity, object>
  implements IOrganizationRepository
{
  private memberRepository = new CommunityMemberRepository();

  constructor() {
    super(Organization, OrganizationEntity);
  }

  async findById(id: string, select?: string): Promise<OrganizationEntity | null> {
    const data = await this.MongooseModel.findById(id, select).read('secondaryPreferred');
    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  async findUserActiveOrganizations(userId: string): Promise<OrganizationEntity[]> {
    const organizationIds = await this.getUsersMembersOrganizationIds(userId);

    return await this.find({
      _id: { $in: organizationIds },
    });
  }

  private async getUsersMembersOrganizationIds(userId: string): Promise<string[]> {
    const members = await this.memberRepository.findUserActiveMembers(userId);

    return members.map((member) => member._organizationId);
  }

  async updateBrandingDetails(organizationId: string, branding: { color: string; logo: string }) {
    return this.update(
      {
        _id: organizationId,
      },
      {
        $set: {
          branding,
        },
      }
    );
  }

  async renameOrganization(organizationId: string, payload: { name: string }) {
    return this.update(
      {
        _id: organizationId,
      },
      {
        $set: {
          name: payload.name,
        },
      }
    );
  }

  async updateDefaultLocale(
    organizationId: string,
    defaultLocale: string
  ): Promise<{ matched: number; modified: number }> {
    return this.update(
      {
        _id: organizationId,
      },
      {
        $set: {
          defaultLocale,
        },
      }
    );
  }

  async findByPartnerConfigurationId({ userId, configurationId }: { userId: string; configurationId: string }) {
    const organizationIds = await this.getUsersMembersOrganizationIds(userId);

    return await this.find(
      {
        _id: { $in: organizationIds },
        'partnerConfigurations.configurationId': configurationId,
      },
      { 'partnerConfigurations.$': 1 }
    );
  }

  async upsertPartnerConfiguration({
    organizationId,
    configuration,
  }: {
    organizationId: string;
    configuration: IPartnerConfiguration;
  }) {
    // try to update existing configuration
    const updateResult = await this.update(
      {
        _id: organizationId,
        'partnerConfigurations.teamId': configuration.teamId,
      },
      {
        $set: {
          'partnerConfigurations.$': configuration,
        },
      }
    );

    // if no configurations were matched, then add new configuration
    if (updateResult.modified === 0) {
      return this.update(
        {
          _id: organizationId,
        },
        {
          $push: {
            partnerConfigurations: configuration,
          },
        }
      );
    }

    return updateResult;
  }

  async bulkUpdatePartnerConfiguration({
    userId,
    data,
    configuration,
  }: {
    userId: string;
    data: Record<string, string[]>;
    configuration: IPartnerConfiguration;
  }) {
    const { teamId } = configuration;
    const organizationIds = await this.getUsersMembersOrganizationIds(userId);

    // remove all existing configurations for this team
    await this.update(
      {
        _id: { $in: organizationIds },
      },
      {
        $pull: {
          partnerConfigurations: {
            teamId,
          },
        },
      }
    );

    const usedOrgIds = Object.keys(data);
    const promises = usedOrgIds.map((orgId) =>
      this.upsertPartnerConfiguration({
        organizationId: orgId,
        configuration: {
          ...configuration,
          projectIds: data[orgId],
        },
      })
    );

    await Promise.all(promises);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - members(await this.memberRepository.findUserActiveMembers(userId);

    return members.map((member))
 - promises(usedOrgIds.map((orgId))
Declaraciones 'export' encontradas:
- export class CommunityOrganizationRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/index.ts
Tamaño: 252 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './community.organization.repository';
export * from './organization.entity';
export * from './organization.repository';
export * from './organization.schema';
export * from './organization-repository.interface';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/organization-repository.interface.ts
Tamaño: 2492 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Types } from 'mongoose';
import { IPartnerConfiguration, OrganizationEntity } from './organization.entity';

export interface IOrganizationRepository extends IOrganizationRepositoryMongo {
  findById(id: string, select?: string): Promise<OrganizationEntity | null>;
  findUserActiveOrganizations(userId: string): Promise<OrganizationEntity[]>;
  updateBrandingDetails(
    organizationId: string,
    branding: { color: string; logo: string }
  ): Promise<{
    matched: number;
    modified: number;
  }>;
  renameOrganization(
    organizationId: string,
    payload: { name: string }
  ): Promise<{
    matched: number;
    modified: number;
  }>;
  updateDefaultLocale(
    organizationId: string,
    defaultLocale: string
  ): Promise<{
    matched: number;
    modified: number;
  }>;
  findByPartnerConfigurationId(args: { userId: string; configurationId: string }): Promise<OrganizationEntity[]>;
  upsertPartnerConfiguration(args: { organizationId: string; configuration: IPartnerConfiguration }): Promise<{
    matched: number;
    modified: number;
  }>;
  bulkUpdatePartnerConfiguration(args: {
    userId: string;
    data: Record<string, string[]>;
    configuration: IPartnerConfiguration;
  }): Promise<void>;
}

/**
 * MongoDB specific methods from base-repository.ts to achieve
 * common interface for EE and Community repositories
 */
export interface IOrganizationRepositoryMongo {
  create(data: any, options?: any): Promise<OrganizationEntity>;
  update(query: any, body: any): Promise<{ matched: number; modified: number }>;
  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }>;
  count(query: any, limit?: number): Promise<number>;
  aggregate(query: any[], options?: { readPreference?: 'secondaryPreferred' | 'primary' }): Promise<any>;
  findOne(query: any, select?: any, options?: any): Promise<OrganizationEntity | null>;
  find(query: any, select?: any, options?: any): Promise<OrganizationEntity[]>;
  findBatch(query: any, select?: string, options?: any, batchSize?: number): AsyncGenerator<any>;
  insertMany(
    data: any,
    ordered: boolean
  ): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: Types.ObjectId[] }>;
  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }>;
  upsertMany(data: any): Promise<any>;
  upsert(query: any, data: any): Promise<any>;
  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any>;
  estimatedDocumentCount(): Promise<number>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/organization.entity.ts
Tamaño: 1122 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiServiceLevelEnum, IOrganizationEntity, ProductUseCases } from '@novu/shared';

export class OrganizationEntity implements IOrganizationEntity {
  _id: string;

  name: string;

  logo?: string;

  apiServiceLevel: ApiServiceLevelEnum;

  branding?: Branding;

  partnerConfigurations?: IPartnerConfiguration[];

  defaultLocale?: string;

  targetLocales?: string[];

  domain?: string;

  productUseCases?: ProductUseCases;

  language?: string[];

  removeNovuBranding?: boolean;

  createdAt: string;

  updatedAt: string;

  externalId?: string;

  stripeCustomerId?: string;

  createdBy?: string;
}

export type Branding = {
  fontFamily?: string;
  fontColor?: string;
  contentBackground?: string;
  logo: string;
  color: string;
  direction?: 'ltr' | 'rtl';
};

export type OrganizationDBModel = OrganizationEntity;

export interface IPartnerConfiguration {
  accessToken: string;
  configurationId: string;
  projectIds?: string[];
  teamId: string;
  partnerType: PartnerTypeEnum;
}

export enum PartnerTypeEnum {
  VERCEL = 'vercel',
}

export enum DirectionEnum {
  LTR = 'ltr',
  RTL = 'trl',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class OrganizationEntity
- export  type
- export  type
- export  interface
- export  enum
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/organization.repository.ts
Tamaño: 3945 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject } from '@nestjs/common';
import { IPartnerConfiguration, OrganizationEntity } from './organization.entity';
import { IOrganizationRepository } from './organization-repository.interface';

export class OrganizationRepository implements IOrganizationRepository {
  constructor(@Inject('ORGANIZATION_REPOSITORY') private organizationRepository: IOrganizationRepository) {}

  findById(id: string, select?: string): Promise<OrganizationEntity | null> {
    return this.organizationRepository.findById(id, select);
  }

  findUserActiveOrganizations(userId: string): Promise<OrganizationEntity[]> {
    return this.organizationRepository.findUserActiveOrganizations(userId);
  }

  updateBrandingDetails(organizationId: string, branding: { color: string; logo: string }) {
    return this.organizationRepository.updateBrandingDetails(organizationId, branding);
  }

  renameOrganization(organizationId: string, payload: { name: string }) {
    return this.organizationRepository.renameOrganization(organizationId, payload);
  }

  updateDefaultLocale(organizationId: string, defaultLocale: string): Promise<{ matched: number; modified: number }> {
    return this.organizationRepository.updateDefaultLocale(organizationId, defaultLocale);
  }

  findByPartnerConfigurationId(args: { userId: string; configurationId: string }) {
    return this.organizationRepository.findByPartnerConfigurationId(args);
  }

  upsertPartnerConfiguration(args: { organizationId: string; configuration: IPartnerConfiguration }) {
    return this.organizationRepository.upsertPartnerConfiguration(args);
  }

  bulkUpdatePartnerConfiguration(args: {
    userId: string;
    data: Record<string, string[]>;
    configuration: IPartnerConfiguration;
  }) {
    return this.organizationRepository.bulkUpdatePartnerConfiguration(args);
  }

  create(data: any, options?: any): Promise<OrganizationEntity> {
    return this.organizationRepository.create(data, options);
  }

  update(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.organizationRepository.update(query, body);
  }

  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }> {
    return this.organizationRepository.delete(query);
  }

  count(query: any, limit?: number): Promise<number> {
    return this.organizationRepository.count(query, limit);
  }

  aggregate(query: any[], options?: { readPreference?: 'secondaryPreferred' | 'primary' }): Promise<any> {
    return this.organizationRepository.aggregate(query, options);
  }

  findOne(query: any, select?: any, options?: any): Promise<OrganizationEntity | null> {
    return this.organizationRepository.findOne(query, select, options);
  }

  find(query: any, select?: any, options?: any): Promise<OrganizationEntity[]> {
    return this.organizationRepository.find(query, select, options);
  }

  async *findBatch(
    query: any,
    select?: string | undefined,
    options?: any,
    batchSize?: number | undefined
  ): AsyncGenerator<any, any, unknown> {
    return this.organizationRepository.findBatch(query, select, options, batchSize);
  }

  insertMany(data: any, ordered: boolean): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: any }> {
    return this.organizationRepository.insertMany(data, ordered);
  }

  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.organizationRepository.updateOne(query, body);
  }

  upsertMany(data: any): Promise<any> {
    return this.organizationRepository.upsertMany(data);
  }

  upsert(query: any, data: any): Promise<any> {
    return this.organizationRepository.upsert(query, data);
  }

  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any> {
    return this.organizationRepository.bulkWrite(bulkOperations, ordered);
  }

  estimatedDocumentCount(): Promise<number> {
    return this.organizationRepository.estimatedDocumentCount();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class OrganizationRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/organization.schema.ts
Tamaño: 2279 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ApiServiceLevelEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { OrganizationDBModel, PartnerTypeEnum } from './organization.entity';

const organizationSchema = new Schema<OrganizationDBModel>(
  {
    name: Schema.Types.String,
    logo: Schema.Types.String,
    apiServiceLevel: {
      type: Schema.Types.String,
      enum: ApiServiceLevelEnum,
      default: ApiServiceLevelEnum.FREE,
    },
    branding: {
      fontColor: Schema.Types.String,
      contentBackground: Schema.Types.String,
      fontFamily: Schema.Types.String,
      logo: Schema.Types.String,
      color: Schema.Types.String,
      direction: Schema.Types.String,
    },
    partnerConfigurations: {
      type: [
        {
          accessToken: Schema.Types.String,
          configurationId: Schema.Types.String,
          teamId: Schema.Types.String,
          projectIds: [Schema.Types.String],
          partnerType: {
            type: Schema.Types.String,
            enum: PartnerTypeEnum,
          },
        },
      ],
      select: false,
    },
    defaultLocale: Schema.Types.String,
    targetLocales: [Schema.Types.String],
    domain: Schema.Types.String,
    language: [Schema.Types.String],
    removeNovuBranding: Schema.Types.Boolean,
    productUseCases: {
      delay: {
        type: Schema.Types.Boolean,
        default: false,
      },
      translation: {
        type: Schema.Types.Boolean,
        default: false,
      },
      digest: {
        type: Schema.Types.Boolean,
        default: false,
      },
      multi_channel: {
        type: Schema.Types.Boolean,
        default: false,
      },
      in_app: {
        type: Schema.Types.Boolean,
        default: false,
      },
    },
    externalId: Schema.Types.String,
    stripeCustomerId: Schema.Types.String,
  },
  schemaOptions
);

if (process.env.NOVU_ENTERPRISE !== 'true') {
  organizationSchema.index(
    { name: 1 },
    {
      unique: true,
      partialFilterExpression: { name: 'Community Edition' },
    }
  );
}

export const Organization =
  (mongoose.models.Organization as mongoose.Model<OrganizationDBModel>) ||
  mongoose.model<OrganizationDBModel>('Organization', organizationSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/organization/types.ts
Tamaño: 37 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type OrganizationId = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/preferences/index.ts
Tamaño: 118 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './preferences.entity';
export * from './preferences.repository';
export * from './preferences.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/preferences/preferences.entity.ts
Tamaño: 844 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { Schedule, WorkflowPreferencesPartial } from '@novu/shared';
import { PreferencesTypeEnum } from '@novu/shared';
import type { ChangePropsValueType } from '../../types';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';
import type { SubscriberId } from '../subscriber';
import type { UserId } from '../user';

export type PreferencesDBModel = ChangePropsValueType<
  PreferencesEntity,
  '_environmentId' | '_organizationId' | '_subscriberId' | '_templateId' | '_userId'
>;

export class PreferencesEntity {
  _id: string;

  _organizationId: OrganizationId;

  _environmentId: EnvironmentId;

  _subscriberId?: SubscriberId;

  _userId?: UserId;

  _templateId?: string;

  type: PreferencesTypeEnum;

  preferences: WorkflowPreferencesPartial;

  schedule?: Schedule;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export class PreferencesEntity

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/preferences/preferences.repository.ts
Tamaño: 1179 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FilterQuery } from 'mongoose';
import { SoftDeleteModel } from 'mongoose-delete';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import { PreferencesDBModel, PreferencesEntity } from './preferences.entity';
import { Preferences } from './preferences.schema';

type PreferencesQuery = FilterQuery<PreferencesDBModel> & EnforceEnvOrOrgIds;

export class PreferencesRepository extends BaseRepository<PreferencesDBModel, PreferencesEntity, EnforceEnvOrOrgIds> {
  private preferences: SoftDeleteModel;

  constructor() {
    super(Preferences, PreferencesEntity);
    this.preferences = Preferences;
  }

  async findById(id: string, environmentId: string) {
    const requestQuery: PreferencesQuery = {
      _id: id,
      _environmentId: environmentId,
    };

    const item = await this.MongooseModel.findOne(requestQuery);

    return this.mapEntity(item);
  }

  async findDeleted(query: PreferencesQuery): Promise<PreferencesEntity> {
    const res: PreferencesEntity = await this.preferences.findDeleted(query);

    return this.mapEntity(res);
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class PreferencesRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/preferences/preferences.schema.ts
Tamaño: 3465 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ChannelTypeEnum, PreferencesTypeEnum } from '@novu/shared';
import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { PreferencesDBModel } from './preferences.entity';

const mongooseDelete = require('mongoose-delete');

const preferencesSchema = new Schema<PreferencesDBModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
    },
    _userId: {
      type: Schema.Types.ObjectId,
      ref: 'User',
    },
    _templateId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    type: Schema.Types.String,
    preferences: {
      all: {
        enabled: {
          type: Schema.Types.Boolean,
        },
        readOnly: {
          type: Schema.Types.Boolean,
        },
      },
      channels: {
        [ChannelTypeEnum.EMAIL]: {
          enabled: {
            type: Schema.Types.Boolean,
          },
        },
        [ChannelTypeEnum.SMS]: {
          enabled: {
            type: Schema.Types.Boolean,
          },
        },
        [ChannelTypeEnum.IN_APP]: {
          enabled: {
            type: Schema.Types.Boolean,
          },
        },
        [ChannelTypeEnum.CHAT]: {
          enabled: {
            type: Schema.Types.Boolean,
          },
        },
        [ChannelTypeEnum.PUSH]: {
          enabled: {
            type: Schema.Types.Boolean,
          },
        },
      },
    },
    schedule: Schema.Types.Mixed,
  },
  { ...schemaOptions, minimize: false }
);

preferencesSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

// Subscriber Global Preferences
// Ensures one global preference per subscriber (SUBSCRIBER_GLOBAL type)
// Partial filter ensures this only applies to SUBSCRIBER_GLOBAL type,
// preventing conflicts with other preference types
preferencesSchema.index(
  {
    _environmentId: 1,
    _subscriberId: 1,
    type: 1,
  },
  {
    unique: true,
    partialFilterExpression: {
      type: PreferencesTypeEnum.SUBSCRIBER_GLOBAL,
    },
  }
);

// Subscriber Workflow Preferences
// Ensures one workflow preference per subscriber per template (SUBSCRIBER_WORKFLOW type)
// Partial filter ensures this only applies to SUBSCRIBER_WORKFLOW type,
// preventing conflicts with other preference types
preferencesSchema.index(
  {
    _environmentId: 1,
    _subscriberId: 1,
    _templateId: 1,
    type: 1,
  },
  {
    unique: true,
    partialFilterExpression: {
      type: PreferencesTypeEnum.SUBSCRIBER_WORKFLOW,
    },
  }
);

// Workflow Preferences (both Resource and User)
// Ensures one workflow-level preference per template per type (USER_WORKFLOW, WORKFLOW_RESOURCE)
// Partial filter ensures this only applies to USER_WORKFLOW and WORKFLOW_RESOURCE types,
// preventing conflicts with subscriber-specific preferences
preferencesSchema.index(
  {
    _environmentId: 1,
    _templateId: 1,
    type: 1,
  },
  {
    unique: true,
    partialFilterExpression: {
      type: { $in: [PreferencesTypeEnum.USER_WORKFLOW, PreferencesTypeEnum.WORKFLOW_RESOURCE] },
    },
  }
);

export const Preferences =
  (mongoose.models.Preferences as mongoose.Model<PreferencesDBModel>) ||
  mongoose.model<PreferencesDBModel>('Preferences', preferencesSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/bulk.create.subscriber.entity.ts
Tamaño: 304 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class FailedOperationEntity {
  message: string;
  subscriberId?: string;
}
export class ChangedSubscriberEntity {
  subscriberId: string;
}

export class BulkCreateSubscriberEntity {
  updated: ChangedSubscriberEntity[];
  created: ChangedSubscriberEntity[];
  failed: FailedOperationEntity[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class FailedOperationEntity
- export class ChangedSubscriberEntity
- export class BulkCreateSubscriberEntity

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/index.ts
Tamaño: 140 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './subscriber.entity';
export * from './subscriber.repository';
export * from './subscriber.schema';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/subscriber.entity.ts
Tamaño: 1101 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IChannelSettings, ISubscriber, SubscriberCustomData } from '@novu/shared';
import type { ChangePropsValueType } from '../../types/helpers';
import type { EnvironmentId } from '../environment';
import type { OrganizationId } from '../organization';
import { ExternalSubscriberId } from './types';

export class SubscriberEntity implements ISubscriber {
  // TODO: Use SubscriberId. Means lot of changes across whole codebase. Cool down.
  _id: string;

  firstName: string;

  lastName: string;

  email: string;

  phone?: string;

  avatar?: string;

  locale?: string;

  subscriberId: ExternalSubscriberId;

  /**
   * @deprecated: use channelEndpoint instead
   */
  channels?: IChannelSettings[];

  topics?: string[];

  _organizationId: OrganizationId;

  _environmentId: EnvironmentId;

  deleted: boolean;

  createdAt: string;

  updatedAt: string;

  __v?: number;

  isOnline?: boolean;

  lastOnlineAt?: string;

  data?: SubscriberCustomData;

  timezone?: string;
}

export type SubscriberDBModel = ChangePropsValueType<SubscriberEntity, '_environmentId' | '_organizationId'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class SubscriberEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/subscriber.repository.ts
Tamaño: 7683 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum, EnvironmentId, ISubscribersDefine, OrganizationId } from '@novu/shared';
import { DalException } from '../../shared';
import type { EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { BulkCreateSubscriberEntity } from './bulk.create.subscriber.entity';
import { SubscriberDBModel, SubscriberEntity } from './subscriber.entity';
import { Subscriber } from './subscriber.schema';
import { IExternalSubscribersEntity } from './types';

export class SubscriberRepository extends BaseRepository<SubscriberDBModel, SubscriberEntity, EnforceEnvOrOrgIds> {
  constructor() {
    super(Subscriber, SubscriberEntity);
  }

  async findBySubscriberId(
    environmentId: string,
    subscriberId: string,
    secondaryRead = false,
    select?: string
  ): Promise<SubscriberEntity | null> {
    return await this.findOne(
      {
        _environmentId: environmentId,
        subscriberId,
      },
      select,
      { readPreference: secondaryRead ? 'secondaryPreferred' : 'primary' }
    );
  }

  async bulkCreateSubscribers(
    subscribers: ISubscribersDefine[],
    environmentId: EnvironmentId,
    organizationId: OrganizationId
  ): Promise<BulkCreateSubscriberEntity> {
    const bulkWriteOps = subscribers.map((subscriber) => {
      const { subscriberId, ...rest } = subscriber;

      return {
        updateOne: {
          filter: { subscriberId, _environmentId: environmentId, _organizationId: organizationId },
          update: { $set: { ...rest, deleted: false } },
          upsert: true,
        },
      };
    });

    let bulkResponse;
    try {
      bulkResponse = await this.bulkWrite(bulkWriteOps);
    } catch (e: unknown) {
      if (isErrorWithWriteErrors(e)) {
        if (!e.writeErrors) {
          throw new DalException(e.message);
        }
        bulkResponse = e.result;
      } else {
        throw new DalException('An unknown error occurred');
      }
    }
    const created = bulkResponse.getUpsertedIds();
    const writeErrors = bulkResponse.getWriteErrors();

    const indexes: number[] = [];

    const insertedSubscribers = created.map((inserted) => {
      indexes.push(inserted.index);

      return mapToSubscriberObject(subscribers[inserted.index]?.subscriberId);
    });

    let failed = [];
    if (writeErrors.length > 0) {
      failed = writeErrors.map((error) => {
        indexes.push(error.err.index);

        return {
          message: error.err.errmsg,
          subscriberId: error.err.op?.subscriberId,
        };
      });
    }

    const updatedSubscribers = subscribers
      .filter((subId, index) => !indexes.includes(index))
      .map((subscriber) => {
        return mapToSubscriberObject(subscriber.subscriberId);
      });

    return {
      updated: updatedSubscribers,
      created: insertedSubscribers,
      failed,
    };
  }

  async searchByExternalSubscriberIds(
    externalSubscribersEntity: IExternalSubscribersEntity
  ): Promise<SubscriberEntity[]> {
    const { _environmentId, _organizationId, externalSubscriberIds } = externalSubscribersEntity;

    return this.find({
      _environmentId,
      _organizationId,
      subscriberId: {
        $in: externalSubscriberIds,
      },
    });
  }

  async searchSubscribers(
    environmentId: string,
    subscriberIds: string[] = [],
    emails: string[] = [],
    search?: string
  ): Promise<string[]> {
    const filters: any = [];

    if (emails?.length) {
      filters.push({
        email: {
          $in: emails,
        },
      });
    }

    if (subscriberIds?.length) {
      filters.push({
        subscriberId: {
          $in: subscriberIds,
        },
      });
    }

    if (search) {
      filters.push(
        {
          email: {
            $regex: regExpEscape(search),
            $options: 'i',
          },
        },
        {
          subscriberId: { $eq: search },
        }
      );
    }

    return (
      await this.find(
        {
          _environmentId: environmentId,
          $or: filters,
        },
        '_id'
      )
    ).map((entity) => entity._id);
  }

  async estimatedDocumentCount(): Promise<number> {
    return this._model.estimatedDocumentCount();
  }

  async listSubscribers(query: {
    environmentId: string;
    organizationId: string;
    limit: number;
    sortBy: 'updatedAt' | '_id';
    sortDirection: DirectionEnum;
    after?: string;
    before?: string;
    email?: string;
    phone?: string;
    subscriberId?: string;
    name?: string;
    includeCursor?: boolean;
  }): Promise<{
    subscribers: SubscriberEntity[];
    next: string | null;
    previous: string | null;
    totalCount: number;
    totalCountCapped: boolean;
  }> {
    if (query.before && query.after) {
      throw new DalException('Cannot specify both "before" and "after" cursors at the same time.');
    }

    const id = query.before || query.after;
    let subscriber: SubscriberEntity | null = null;
    if (id) {
      subscriber = await this.findOne({
        _environmentId: query.environmentId,
        _organizationId: query.organizationId,
        _id: id,
      });
      if (!subscriber) {
        return {
          subscribers: [],
          next: null,
          previous: null,
          totalCount: 0,
          totalCountCapped: false,
        };
      }
    }

    const after =
      query.after && subscriber ? { sortBy: subscriber[query.sortBy], paginateField: subscriber._id } : undefined;
    const before =
      query.before && subscriber ? { sortBy: subscriber[query.sortBy], paginateField: subscriber._id } : undefined;

    const pagination = await this.findWithCursorBasedPagination({
      after,
      before,
      paginateField: '_id',
      limit: query.limit,
      sortDirection: query.sortDirection,
      sortBy: query.sortBy,
      includeCursor: query.includeCursor,
      query: {
        _environmentId: query.environmentId,
        _organizationId: query.organizationId,
        $and: [
          {
            ...(query.email && {
              email: {
                $regex: regExpEscape(query.email),
                $options: 'i',
              },
            }),
            ...(query.phone && {
              phone: {
                $regex: regExpEscape(query.phone),
                $options: 'i',
              },
            }),
            ...(query.subscriberId && {
              subscriberId: {
                $regex: regExpEscape(query.subscriberId),
                $options: 'i',
              },
            }),
            ...(query.name && {
              $expr: {
                $regexMatch: {
                  input: {
                    $trim: {
                      input: {
                        $concat: [{ $ifNull: ['$firstName', ''] }, ' ', { $ifNull: ['$lastName', ''] }],
                      },
                    },
                  },
                  regex: regExpEscape(query.name),
                  options: 'i',
                },
              },
            }),
          },
        ],
      },
    });

    return {
      subscribers: pagination.data,
      next: pagination.next,
      previous: pagination.previous,
      totalCount: pagination.totalCount,
      totalCountCapped: pagination.totalCountCapped,
    };
  }
}

function mapToSubscriberObject(subscriberId: string) {
  return { subscriberId };
}

function regExpEscape(literalString: string): string {
  return literalString.replace(/[-[\]{}()*+!<=:?./\\^$|#\s,]/g, '\\$&');
}

function isErrorWithWriteErrors(e: unknown): e is { writeErrors?: any; message?: string; result?: any } {
  return typeof e === 'object' && e !== null && 'writeErrors' in e;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - mapToSubscriberObject(subscriberId: string)
 - regExpEscape(literalString: string)
 - isErrorWithWriteErrors(e: unknown)
Asignaciones con arrow functions encontradas (posibles funciones):
 - bulkWriteOps(subscribers.map((subscriber))
 - insertedSubscribers(created.map((inserted))
 - failed(writeErrors.map((error))
 - updatedSubscribers(subscribers
      .filter((subId, index))
 - any([];

    if (emails?.length) {
      filters.push({
        email: {
          $in: emails,
        ...)
Declaraciones 'export' encontradas:
- export class SubscriberRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/subscriber.schema.ts
Tamaño: 6761 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { IndexOptions, Schema } from 'mongoose';
import { IndexDefinition } from '../../shared/types';
import { schemaOptions } from '../schema-default.options';
import { SubscriberDBModel, SubscriberEntity } from './subscriber.entity';

const mongooseDelete = require('mongoose-delete');

const subscriberSchema = new Schema<SubscriberDBModel>(
  {
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    firstName: Schema.Types.String,
    lastName: Schema.Types.String,
    phone: Schema.Types.String,
    subscriberId: Schema.Types.String,
    email: Schema.Types.String,
    avatar: Schema.Types.String,
    locale: Schema.Types.String,
    channels: [Schema.Types.Mixed],
    isOnline: {
      type: Schema.Types.Boolean,
      required: false,
      default: false,
    },
    lastOnlineAt: Schema.Types.Date,
    data: Schema.Types.Mixed,
    timezone: Schema.Types.String,
  },
  schemaOptions
);

/*
 * This index was initially created to optimize:
 *
 * Path: apps/api/src/app/events/usecases/trigger-event-to-all/trigger-event-to-all.usecase.ts
 * Context: execute()
 * Query: findBatch({
 *       _environmentId: command.environmentId,
 *       _organizationId: command.organizationId,
 *     }
 *
 * Path: apps/api/src/app/subscribers/usecases/get-subscribers/get-subscriber.usecase.ts
 * Context: execute()
 * Query: count({
 *    _environmentId: command.environmentId,
 *    _organizationId: command.organizationId,
 *  });
 *
 * Path: apps/api/src/app/subscribers/usecases/get-subscribers/get-subscriber.usecase.ts
 * Context: execute()
 * Query: find({
 *     _environmentId: command.environmentId,
 *     _organizationId: command.organizationId,
 *   });
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: searchSubscribers()
 * Query: find({
 *    _environmentId: environmentId,
 *      {email: {$in: emails,}
 */
subscriberSchema.index({
  _environmentId: 1,
  email: 1,
});

/*
 * This index was initially created to optimize:
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: searchSubscribers()
 * Query: find({
 *    _environmentId: environmentId,
 *    $or: {
 *      {email: {$in: emails,}
 *      {email: {
 *          $regex: regExpEscape(search),
 *          $options: 'i',},}
 *        },
 *      {subscriberId: search,}
 *  });
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: findBySubscriberId()
 * Query: findOne(
 *     {
 *       _environmentId: environmentId,
 *       subscriberId,
 *     }
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: searchByExternalSubscriberIds()
 * Query: find({
 *     _environmentId,
 *     _organizationId,
 *     subscriberId: {
 *       $in: externalSubscriberIds,
 *     },
 *   });
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: delete()
 * Query: findOne({
 *    _environmentId: query._environmentId,
 *    subscriberId: query.subscriberId,
 *  });
 *
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: delete()
 * Query: delete({
 *     _environmentId: query._environmentId,
 *     subscriberId: query.subscriberId,
 *   });
 *
 *
 * Path: libs/dal/src/repositories/subscriber/subscriber.repository.ts
 * Context: findDeleted()
 * Query: findDeleted({
 *    _environmentId: query._environmentId,
 *    subscriberId: query.subscriberId,
 *  });
 *
 * Path: apps/api/src/app/subscribers/usecases/remove-subscriber/remove-subscriber.usecase.ts
 * Context: execute()
 * Query: delete({
 *      _environmentId: subscriber._environmentId,
 *      _organizationId: subscriber._organizationId,
 *      subscriberId: subscriber.subscriberId,
 *    });
 *
 * Path: apps/api/src/app/subscribers/usecases/remove-subscriber/remove-subscriber.usecase.ts
 * Context: execute()
 * Query: delete({
 *      _environmentId: subscriber._environmentId,
 *      _organizationId: subscriber._organizationId,
 *      subscriberId: subscriber.subscriberId,
 *    });
 *
 * Path: apps/api/src/app/events/usecases/send-message/send-message.base.ts
 * Context: getSubscriberBySubscriberId()
 * Query: findOne({
 *    subscriberId,
 *    _environmentId,
 *  });
 *
 * Path: apps/api/src/app/events/usecases/send-message/send-message.usecase.ts
 * Context: getSubscriberBySubscriberId()
 * Query: findOne({
 *     subscriberId,
 *     _environmentId,
 *   });
 *
 * Path: apps/api/src/app/integrations/usecases/get-in-app-activated/get-in-app-activated.usecase.ts
 * Context: execute()
 * Query: count({
 *    _organizationId: command.organizationId,
 *    _environmentId: command.environmentId,
 *    isOnline: { $exists: true },
 *    subscriberId: /on-boarding-subscriber/i,
 *  });
 */

/*
 * This index needs to be unique and exclude "_id" to prevent duplicate subscribers during concurrent creation attempts.
 * This situation could occur if two attempts are made to create a subscriber with the same subscriberId (e.g., 2022) simultaneously.
 * We want to ensure that the _id field is not included in the index to avoid scenarios where MongoDB's unique validation fails to prevent duplicates, such as:
 * subscriberId_2022:environmentId_123:_id_123
 * subscriberId_2022:environmentId_123:_id_1234
 * We expect an exception to be thrown when attempting to create two subscribers with the same subscriberId (e.g., 2022) within the same environment.
 *
 * We can not add `deleted` field to the index the client wont be able to delete twice subscriber with the same subscriberId.
 */
subscriberSchema.index(
  { subscriberId: 1, _environmentId: 1 },
  { name: 'unique_subscriber_per_environment', unique: true, partialFilterExpression: { deleted: false } }
);
subscriberSchema.index({
  _organizationId: 1,
});

subscriberSchema.index({
  _environmentId: 1,
  _organizationId: 1,
  deleted: 1,
});

subscriberSchema.index({
  _environmentId: 1,
  _organizationId: 1,
  updatedAt: 1,
  _id: 1,
});

subscriberSchema.index({
  _environmentId: 1,
  _organizationId: 1,
  _id: 1,
});

subscriberSchema.index(
  { _environmentId: 1, subscriberId: 1 },
  { name: 'unique_subscriber_per_environment', unique: true, partialFilterExpression: { deleted: false } }
);

subscriberSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

export const Subscriber =
  (mongoose.models.Subscriber as mongoose.Model<SubscriberDBModel>) ||
  mongoose.model<SubscriberDBModel>('Subscriber', subscriberSchema);

function index(fields: IndexDefinition<SubscriberEntity>, options?: IndexOptions) {
  subscriberSchema.index(fields, options);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - index(fields: IndexDefinition<SubscriberEntity>, options?: IndexOptions)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/subscriber/types.ts
Tamaño: 292 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type ExternalSubscriberId = string;
export type SubscriberId = string;

export interface IExternalSubscribersEntity {
  // TODO: Move to EnvironmentId, OrganizationId when possible
  _environmentId: string;
  _organizationId: string;
  externalSubscriberIds: ExternalSubscriberId[];
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/tenant/index.ts
Tamaño: 95 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './tenant.entity';
export * from './tenant.repository';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/tenant/tenant.entity.ts
Tamaño: 595 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CustomDataType } from '@novu/shared';
import { ChangePropsValueType } from '../../types/helpers';
import { EnvironmentId } from '../environment';
import { OrganizationId } from '../organization';
import { TenantId } from './types';

export class TenantEntity {
  _id: TenantId;

  identifier: string;

  name?: string;

  deleted?: boolean;

  createdAt: string;

  updatedAt: string;

  data?: CustomDataType;

  _environmentId: EnvironmentId;

  _organizationId: OrganizationId;
}

export type TenantDBModel = ChangePropsValueType<TenantEntity, '_environmentId' | '_organizationId'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TenantEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/tenant/tenant.repository.ts
Tamaño: 491 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { SoftDeleteModel } from 'mongoose-delete';
import { EnforceEnvId, EnforceEnvOrOrgIds } from '../../types';
import { BaseRepository } from '../base-repository';
import { TenantDBModel, TenantEntity } from './tenant.entity';
import { Tenant } from './tenant.schema';

export class TenantRepository extends BaseRepository<TenantDBModel, TenantEntity, EnforceEnvId> {
  private tenant: SoftDeleteModel;

  constructor() {
    super(Tenant, TenantEntity);
    this.tenant = Tenant;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TenantRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/tenant/tenant.schema.ts
Tamaño: 1143 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { TenantDBModel } from './tenant.entity';

const tenantSchema = new Schema<TenantDBModel>(
  {
    identifier: Schema.Types.String,
    name: Schema.Types.String,
    data: Schema.Types.Mixed,
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
  },
  schemaOptions
);

/*
 * This index was initially created to optimize:
 *
 * Path: apps/api/src/app/tenant/usecases/get-tenants/get-tenants.usecase.ts
 * Context: execute()
 * Query: find(
 *    {
 *      _environmentId: command.environmentId,
 *      _organizationId: command.organizationId,
 *    },
 *    '',
 *    {
 *      limit: command.limit,
 *      skip: command.page * command.limit,
 *      sort: { createdAt: -1 },
 *    }
 *  );
 */
tenantSchema.index({
  _environmentId: 1,
  createdAt: -1,
});

export const Tenant =
  (mongoose.models.Tenant as mongoose.Model<TenantDBModel>) || mongoose.model<TenantDBModel>('Tenant', tenantSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/tenant/types.ts
Tamaño: 31 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type TenantId = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/index.ts
Tamaño: 185 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './topic.entity';
export * from './topic.repository';
export * from './topic-subscribers.entity';
export * from './topic-subscribers.repository';
export * from './types';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic-subscribers.entity.ts
Tamaño: 883 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { ChangePropsValueType } from '../../types/helpers';
import {
  EnvironmentId,
  ExternalSubscriberId,
  OrganizationId,
  SubscriberId,
  TopicId,
  TopicKey,
  TopicSubscriberId,
} from './types';

export class TopicSubscribersEntity {
  _id: TopicSubscriberId;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  _subscriberId: SubscriberId;
  _topicId: TopicId;
  topicKey: TopicKey;
  // TODO: Rename to subscriberId, to align with workflowId and stepId that are also externally provided identifiers by Novu users
  externalSubscriberId: ExternalSubscriberId;

  createdAt?: string;
  updatedAt?: string;
}

export type TopicSubscribersDBModel = ChangePropsValueType<
  TopicSubscribersEntity,
  '_environmentId' | '_organizationId' | '_subscriberId' | '_topicId'
>;

export type CreateTopicSubscribersEntity = Omit<TopicSubscribersEntity, '_id'>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TopicSubscribersEntity
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic-subscribers.repository.ts
Tamaño: 5710 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum, ExternalSubscriberId } from '@novu/shared';

import { FilterQuery } from 'mongoose';
import { TopicEntity } from '../..';
import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { BaseRepository } from '../base-repository';
import {
  CreateTopicSubscribersEntity,
  TopicSubscribersDBModel,
  TopicSubscribersEntity,
} from './topic-subscribers.entity';
import { TopicSubscribers } from './topic-subscribers.schema';
import { EnvironmentId, OrganizationId, TopicId, TopicKey } from './types';

export class TopicSubscribersRepository extends BaseRepository<
  TopicSubscribersDBModel,
  TopicSubscribersEntity,
  EnforceEnvOrOrgIds
> {
  constructor() {
    super(TopicSubscribers, TopicSubscribersEntity);
  }

  async findTopicsByTopicKeys(
    environmentId: EnvironmentId,
    topicKeys: TopicKey[]
  ): Promise<{ _id: string; topic: TopicEntity }[]> {
    if (!topicKeys.length) {
      return [];
    }

    const aggregationPipeline = [
      {
        $match: {
          _environmentId: this.convertStringToObjectId(environmentId),
          topicKey: { $in: topicKeys },
        },
      },
      {
        $lookup: {
          from: 'topics',
          localField: '_topicId',
          foreignField: '_id',
          as: 'topic',
        },
      },
      { $unwind: '$topic' },
      {
        $group: {
          _id: '$topicKey',
          topic: { $first: '$topic' },
        },
      },
    ];

    return await this.aggregate(aggregationPipeline);
  }

  async addSubscribers(subscribers: CreateTopicSubscribersEntity[]): Promise<any[]> {
    const results = await this.upsertMany(subscribers);

    return results;
  }

  async *getTopicDistinctSubscribers({
    query,
    batchSize = 500,
  }: {
    query: {
      _environmentId: EnvironmentId;
      _organizationId: OrganizationId;
      topicIds: string[];
      excludeSubscribers: string[];
    };
    batchSize?: number;
  }): AsyncGenerator<{ _id: string; topics: string[] }, void, unknown> {
    const { _organizationId, _environmentId, topicIds, excludeSubscribers } = query;
    const mappedTopicIds = topicIds.map((id) => this.convertStringToObjectId(id));

    const aggregatePipeline = [
      {
        $match: {
          _organizationId: this.convertStringToObjectId(_organizationId),
          _environmentId: this.convertStringToObjectId(_environmentId),
          _topicId: { $in: mappedTopicIds },
          externalSubscriberId: { $nin: excludeSubscribers },
        },
      },
      {
        $group: {
          _id: '$externalSubscriberId',
          topics: { $push: '$_topicId' },
        },
      },
    ];

    for await (const doc of this._model.aggregate(aggregatePipeline, { batchSize }).cursor()) {
      yield doc;
    }
  }

  async findOneByTopicKeyAndExternalSubscriberId(
    _environmentId: EnvironmentId,
    _organizationId: OrganizationId,
    topicKey: TopicKey,
    externalSubscriberId: ExternalSubscriberId
  ): Promise<TopicSubscribersEntity | null> {
    return this.findOne({
      _environmentId,
      _organizationId,
      topicKey,
      externalSubscriberId,
    });
  }

  async findSubscribersByTopicId(
    _environmentId: EnvironmentId,
    _organizationId: OrganizationId,
    _topicId: TopicId
  ): Promise<TopicSubscribersEntity[]> {
    return this.find({
      _environmentId,
      _organizationId,
      _topicId,
    });
  }

  async removeSubscribers(
    _environmentId: EnvironmentId,
    _organizationId: OrganizationId,
    topicKey: TopicKey,
    externalSubscriberIds: ExternalSubscriberId[]
  ): Promise<void> {
    await this.delete({
      _environmentId,
      _organizationId,
      topicKey,
      externalSubscriberId: {
        $in: externalSubscriberIds,
      },
    });
  }

  async findTopicSubscriptionsWithPagination({
    environmentId,
    organizationId,
    topicKey,
    subscriberId,
    limit = 10,
    before,
    after,
    orderDirection = DirectionEnum.DESC,
    includeCursor,
  }): Promise<{
    data: TopicSubscribersEntity[];
    next: string | null;
    previous: string | null;
    totalCount: number;
    totalCountCapped: boolean;
  }> {
    // Build query for topic subscriptions
    const query: FilterQuery<TopicSubscribersDBModel> & EnforceEnvOrOrgIds = {
      _environmentId: environmentId,
      _organizationId: organizationId,
    };

    if (topicKey) {
      query.topicKey = topicKey;
    }

    if (subscriberId) {
      query.externalSubscriberId = subscriberId;
    }

    // Handle cursor-based pagination
    let subscription: TopicSubscribersEntity | null = null;
    const id = before || after;

    if (id) {
      subscription = await this.findOne({
        _environmentId: environmentId,
        _organizationId: organizationId,
        _id: id,
      });

      if (!subscription) {
        return {
          data: [],
          next: null,
          previous: null,
          totalCount: 0,
          totalCountCapped: false,
        };
      }
    }

    const afterCursor =
      after && subscription
        ? {
            sortBy: subscription._id,
            paginateField: subscription._id,
          }
        : undefined;
    const beforeCursor =
      before && subscription
        ? {
            sortBy: subscription._id,
            paginateField: subscription._id,
          }
        : undefined;

    // Use cursor-based pagination
    const subscriptionsPagination = await this.findWithCursorBasedPagination({
      query,
      paginateField: '_id',
      sortBy: '_id',
      sortDirection: orderDirection,
      limit,
      after: afterCursor,
      before: beforeCursor,
      includeCursor,
    });

    return subscriptionsPagination;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mappedTopicIds(topicIds.map((id))
Declaraciones 'export' encontradas:
- export class TopicSubscribersRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic-subscribers.schema.ts
Tamaño: 1345 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';
import { schemaOptions } from '../schema-default.options';
import { TopicSubscribersDBModel } from './topic-subscribers.entity';

const topicSubscribersSchema = new Schema<TopicSubscribersDBModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
      required: true,
    },
    _subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
      index: true,
      required: true,
    },
    _topicId: {
      type: Schema.Types.ObjectId,
      ref: 'Topic',
      index: true,
      required: true,
    },
    topicKey: {
      type: Schema.Types.String,
      index: true,
      required: true,
    },
    externalSubscriberId: Schema.Types.String,
  },
  schemaOptions
);

topicSubscribersSchema.index({
  _environmentId: 1,
});

topicSubscribersSchema.index({
  _subscriberId: 1,
});

topicSubscribersSchema.index({
  _topicId: 1,
});

topicSubscribersSchema.index({
  topicKey: 1,
});

export const TopicSubscribers =
  (mongoose.models.TopicSubscribers as mongoose.Model<TopicSubscribersDBModel>) ||
  mongoose.model<TopicSubscribersDBModel>('TopicSubscribers', topicSubscribersSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic.entity.ts
Tamaño: 479 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Types } from 'mongoose';

import { EnvironmentId, OrganizationId, TopicId, TopicKey, TopicName } from './types';

export class TopicEntity {
  _id: TopicId;
  _environmentId: EnvironmentId;
  _organizationId: OrganizationId;
  key: TopicKey;
  name?: TopicName;

  createdAt?: string;
  updatedAt?: string;
}

export type TopicDBModel = Omit<TopicEntity, '_environmentId' | '_organizationId'> & {
  _environmentId: Types.ObjectId;

  _organizationId: Types.ObjectId;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TopicEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic.repository.ts
Tamaño: 5958 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { DirectionEnum } from '@novu/shared';
import { FilterQuery } from 'mongoose';

import type { EnforceEnvOrOrgIds } from '../../types/enforce';
import { SortOrder } from '../../types/sort-order';
import { BaseRepository } from '../base-repository';
import { TopicDBModel, TopicEntity } from './topic.entity';
import { Topic } from './topic.schema';
import { EnvironmentId, ExternalSubscriberId, OrganizationId, TopicId, TopicKey, TopicName } from './types';

const TOPIC_SUBSCRIBERS_COLLECTION = 'topicsubscribers';

const topicWithSubscribersProjection = {
  $project: {
    _id: 1,
    _environmentId: 1,
    _organizationId: 1,
    createdAt: 1,
    updatedAt: 1,
    key: 1,
    name: 1,
    subscribers: '$topicSubscribers.externalSubscriberId',
  },
};

const lookup = {
  $lookup: {
    from: TOPIC_SUBSCRIBERS_COLLECTION,
    localField: '_id',
    foreignField: '_topicId',
    as: 'topicSubscribers',
  },
};

export class TopicRepository extends BaseRepository<TopicDBModel, TopicEntity, EnforceEnvOrOrgIds> {
  constructor() {
    super(Topic, TopicEntity);
  }

  async createTopic(entity: Omit<TopicEntity, '_id'>): Promise<TopicEntity> {
    const { key, name, _environmentId, _organizationId } = entity;

    return await this.create({
      _environmentId,
      key,
      name,
      _organizationId,
    });
  }

  async deleteTopic(key: TopicKey, environmentId: EnvironmentId, organizationId: OrganizationId): Promise<void> {
    await this.delete({
      key,
      _organizationId: organizationId,
      _environmentId: environmentId,
    });
  }

  async filterTopics(
    query: FilterQuery<TopicDBModel>,
    pagination: { limit: number; skip: number }
  ): Promise<TopicEntity & { subscribers: ExternalSubscriberId[] }[]> {
    const parsedQuery = { ...query };
    if (query._id) {
      parsedQuery._id = this.convertStringToObjectId(query._id);
    }

    parsedQuery._environmentId = this.convertStringToObjectId(query._environmentId);
    parsedQuery._organizationId = this.convertStringToObjectId(query._organizationId);

    const data = await this.aggregate([
      {
        $match: parsedQuery,
      },
      lookup,
      topicWithSubscribersProjection,
      {
        $skip: pagination.skip,
      },
      {
        $limit: pagination.limit,
      },
    ]);

    return data;
  }

  async findTopic(
    topicKey: TopicKey,
    environmentId: EnvironmentId
  ): Promise<(TopicEntity & { subscribers: ExternalSubscriberId[] }) | null> {
    const [result] = await this.aggregate([
      {
        $match: { _environmentId: this.convertStringToObjectId(environmentId), key: topicKey },
      },
      lookup,
      topicWithSubscribersProjection,
      { $limit: 1 },
    ]);

    if (!result) {
      return null;
    }

    return result;
  }

  async findTopicByKey(
    key: TopicKey,
    organizationId: OrganizationId,
    environmentId: EnvironmentId
  ): Promise<TopicEntity | null> {
    return await this.findOne({
      key,
      _organizationId: organizationId,
      _environmentId: environmentId,
    });
  }

  async renameTopic(
    _id: TopicId,
    _environmentId: EnvironmentId,
    name: TopicName
  ): Promise<TopicEntity & { subscribers: ExternalSubscriberId[] }> {
    await this.update(
      {
        _id,
        _environmentId,
      },
      {
        name,
      }
    );

    const [updatedTopic] = await this.aggregate([
      {
        $match: {
          _id: this.convertStringToObjectId(_id),
          _environmentId: this.convertStringToObjectId(_environmentId),
        },
      },
      lookup,
      topicWithSubscribersProjection,
      {
        $limit: 1,
      },
    ]);

    return updatedTopic;
  }

  estimatedDocumentCount() {
    return this.MongooseModel.estimatedDocumentCount();
  }

  async listTopics({
    organizationId,
    environmentId,
    limit = 10,
    after,
    before,
    key,
    name,
    sortBy = '_id',
    sortDirection = 1,
    includeCursor = false,
  }: {
    organizationId: string;
    environmentId: string;
    limit?: number;
    after?: string;
    before?: string;
    key?: string;
    name?: string;
    sortBy?: string;
    sortDirection?: SortOrder;
    includeCursor?: boolean;
  }): Promise<{
    topics: TopicEntity[];
    next: string | null;
    previous: string | null;
    totalCount: number;
    totalCountCapped: boolean;
  }> {
    if (before && after) {
      throw new Error('Cannot specify both "before" and "after" cursors at the same time.');
    }

    let topic: TopicEntity | null = null;
    const id = before || after;

    if (id) {
      topic = await this.findOne({
        _environmentId: environmentId,
        _organizationId: organizationId,
        _id: id,
      });

      if (!topic) {
        return {
          topics: [],
          next: null,
          previous: null,
          totalCount: 0,
          totalCountCapped: false,
        };
      }
    }

    const afterCursor = after && topic ? { sortBy: topic[sortBy], paginateField: topic._id } : undefined;
    const beforeCursor = before && topic ? { sortBy: topic[sortBy], paginateField: topic._id } : undefined;

    const query: FilterQuery<TopicDBModel> & EnforceEnvOrOrgIds = {
      _environmentId: environmentId,
      _organizationId: organizationId,
    };

    if (key) {
      query.key = { $regex: key, $options: 'i' };
    }

    if (name) {
      query.name = { $regex: name, $options: 'i' };
    }

    const pagination = await this.findWithCursorBasedPagination({
      after: afterCursor,
      before: beforeCursor,
      paginateField: '_id',
      limit,
      sortDirection: sortDirection === 1 ? DirectionEnum.ASC : DirectionEnum.DESC,
      sortBy,
      includeCursor,
      query,
    });

    return {
      topics: pagination.data,
      next: pagination.next,
      previous: pagination.previous,
      totalCount: pagination.totalCount,
      totalCountCapped: pagination.totalCountCapped,
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class TopicRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/topic.schema.ts
Tamaño: 922 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { TopicDBModel } from './topic.entity';

const topicSchema = new Schema<TopicDBModel>(
  {
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
      index: true,
      required: true,
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
      index: true,
      required: true,
    },
    key: {
      type: Schema.Types.String,
      required: true,
    },
    name: {
      type: Schema.Types.String,
    },
  },
  schemaOptions
);

topicSchema.index({
  _environmentId: 1,
  _organizationId: 1,
  key: 1,
});

topicSchema.index(
  {
    _environmentId: 1,
    key: 1,
  },
  {
    unique: true,
  }
);

export const Topic =
  (mongoose.models.Topic as mongoose.Model<TopicDBModel>) || mongoose.model<TopicDBModel>('Topic', topicSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/topic/types.ts
Tamaño: 300 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { EnvironmentId } from '../environment';
export { OrganizationId } from '../organization';
export { ExternalSubscriberId, SubscriberId } from '../subscriber';

export type TopicId = string;
export type TopicKey = string;
export type TopicName = string;
export type TopicSubscriberId = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export  type
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/community.user.repository.ts
Tamaño: 1469 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createHash } from 'crypto';
import { BaseRepository } from '../base-repository';
import { IUserResetTokenCount, UserDBModel, UserEntity } from './user.entity';
import { User } from './user.schema';
import { IUserRepository } from './user-repository.interface';

export class CommunityUserRepository
  extends BaseRepository<UserDBModel, UserEntity, object>
  implements IUserRepository
{
  constructor() {
    super(User, UserEntity);
  }

  async findByEmail(email: string): Promise<UserEntity | null> {
    return this.findOne({
      email,
    });
  }

  async findById(id: string, select?: string): Promise<UserEntity | null> {
    const data = await this.MongooseModel.findById(id, select);
    if (!data) return null;

    return this.mapEntity(data.toObject());
  }

  private hashResetToken(token: string) {
    return createHash('sha256').update(token).digest('hex');
  }

  async findUserByToken(token: string) {
    return await this.findOne({
      resetToken: this.hashResetToken(token),
    });
  }

  async updatePasswordResetToken(userId: string, token: string, resetTokenCount: IUserResetTokenCount) {
    return await this.update(
      {
        _id: userId,
      },
      {
        $set: {
          resetToken: this.hashResetToken(token),
          resetTokenDate: new Date(),
          resetTokenCount,
        },
      }
    );
  }

  async findUserSessions(userId: string): Promise<[]> {
    throw new Error('Not implemented');
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class CommunityUserRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/index.ts
Tamaño: 212 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './community.user.repository';
export * from './types';
export * from './user.entity';
export * from './user.repository';
export * from './user.schema';
export * from './user-repository.interface';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/types.ts
Tamaño: 29 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type UserId = string;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/user-repository.interface.ts
Tamaño: 1789 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Types } from 'mongoose';
import { IUserResetTokenCount, UserEntity } from './user.entity';

export interface IUserRepository extends IUserRepositoryMongo {
  findByEmail(email: string): Promise<UserEntity | null>;
  findById(id: string, select?: string): Promise<UserEntity | null>;
  findUserByToken(token: string): Promise<UserEntity | null>;
  updatePasswordResetToken(
    userId: string,
    token: string,
    resetTokenCount: IUserResetTokenCount
  ): Promise<{ matched: number; modified: number }>;
  findUserSessions(userId: string): Promise<[]>;
}

/**
 * MongoDB specific methods from base-repository.ts to achieve
 * common interface for EE and Community repositories
 */
export interface IUserRepositoryMongo {
  create(data: any, options?: any): Promise<UserEntity>;
  update(query: any, body: any): Promise<{ matched: number; modified: number }>;
  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }>;
  count(query: any, limit?: number): Promise<number>;
  aggregate(query: any[], options?: { readPreference?: 'secondaryPreferred' | 'primary' }): Promise<any>;
  findOne(query: any, select?: any, options?: any): Promise<UserEntity | null>;
  find(query: any, select?: any, options?: any): Promise<UserEntity[]>;
  findBatch(query: any, select?: string, options?: any, batchSize?: number): AsyncGenerator<any>;
  insertMany(
    data: any,
    ordered: boolean
  ): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: Types.ObjectId[] }>;
  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }>;
  upsertMany(data: any): Promise<any>;
  upsert(query: any, data: any): Promise<any>;
  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any>;
  estimatedDocumentCount(): Promise<number>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/user.entity.ts
Tamaño: 1147 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { AuthProviderEnum, IUserEntity, JobTitleEnum } from '@novu/shared';
import { Exclude } from 'class-transformer';

import { UserId } from './types';

export interface IUserToken {
  providerId: string;
  provider: AuthProviderEnum;
  accessToken: string;
  refreshToken: string;
  valid: boolean;
  username?: string;
}

export interface IUserResetTokenCount {
  reqInMinute: number;
  reqInDay: number;
}

export class UserEntity implements IUserEntity {
  _id: UserId;

  resetToken?: string;

  resetTokenDate?: string;

  resetTokenCount?: IUserResetTokenCount;

  firstName: string;

  lastName?: string | null;

  email: string;

  profilePicture?: string | null;

  @Exclude({ toPlainOnly: true })
  tokens: IUserToken[];

  @Exclude({ toPlainOnly: true })
  password?: string;

  createdAt: string;

  updatedAt: string;

  showOnBoarding?: boolean;
  showOnBoardingTour?: number;

  failedLogin?: {
    times: number;
    lastFailedAttempt: string;
  };

  servicesHashes?: { intercom?: string; plain?: string };

  jobTitle?: JobTitleEnum;

  hasPassword: boolean;

  externalId?: string;
}

export type UserDBModel = UserEntity;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface
- export class UserEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/user.repository.ts
Tamaño: 3160 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Inject } from '@nestjs/common';
import { Types } from 'mongoose';
import { IUserResetTokenCount, UserEntity } from './user.entity';
import { IUserRepository } from './user-repository.interface';

export class UserRepository implements IUserRepository {
  constructor(@Inject('USER_REPOSITORY') private userRepository: IUserRepository) {}

  async findByEmail(email: string): Promise<UserEntity | null> {
    return this.userRepository.findByEmail(email);
  }

  async findById(id: string, select?: string): Promise<UserEntity | null> {
    return this.userRepository.findById(id, select);
  }

  async findUserByToken(token: string): Promise<UserEntity | null> {
    return this.userRepository.findUserByToken(token);
  }

  async updatePasswordResetToken(
    userId: string,
    token: string,
    resetTokenCount: IUserResetTokenCount
  ): Promise<{ matched: number; modified: number }> {
    return this.userRepository.updatePasswordResetToken(userId, token, resetTokenCount);
  }

  async findUserSessions(userId: string): Promise<[]> {
    return this.userRepository.findUserSessions(userId);
  }

  create(data: any, options?: any): Promise<UserEntity> {
    return this.userRepository.create(data, options);
  }

  update(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.userRepository.update(query, body);
  }

  delete(query: any): Promise<{ acknowledged: boolean; deletedCount: number }> {
    return this.userRepository.delete(query);
  }

  count(query: any, limit?: number | undefined): Promise<number> {
    return this.userRepository.count(query, limit);
  }

  aggregate(
    query: any[],
    options?: { readPreference?: 'secondaryPreferred' | 'primary' | undefined } | undefined
  ): Promise<any> {
    return this.userRepository.aggregate(query, options);
  }

  findOne(query: any, select?: any, options?: any): Promise<UserEntity | null> {
    return this.userRepository.findOne(query, select, options);
  }

  find(query: any, select?: any, options?: any): Promise<UserEntity[]> {
    return this.userRepository.find(query, select, options);
  }

  findBatch(
    query: any,
    select?: string | undefined,
    options?: any,
    batchSize?: number | undefined
  ): AsyncGenerator<any, any, unknown> {
    return this.userRepository.findBatch(query, select, options, batchSize);
  }

  insertMany(
    data: any,
    ordered: boolean
  ): Promise<{ acknowledged: boolean; insertedCount: number; insertedIds: Types.ObjectId[] }> {
    return this.userRepository.insertMany(data, ordered);
  }

  updateOne(query: any, body: any): Promise<{ matched: number; modified: number }> {
    return this.userRepository.updateOne(query, body);
  }

  upsertMany(data: any): Promise<any> {
    return this.userRepository.upsertMany(data);
  }

  upsert(query: any, data: any): Promise<any> {
    return this.userRepository.upsert(query, data);
  }

  bulkWrite(bulkOperations: any, ordered: boolean): Promise<any> {
    return this.userRepository.bulkWrite(bulkOperations, ordered);
  }

  estimatedDocumentCount(): Promise<number> {
    return this.userRepository.estimatedDocumentCount();
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class UserRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/user/user.schema.ts
Tamaño: 1576 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { UserDBModel } from './user.entity';

const userSchema = new Schema<UserDBModel>(
  {
    firstName: Schema.Types.String,
    lastName: Schema.Types.String,
    email: Schema.Types.String,
    profilePicture: Schema.Types.String,
    resetToken: Schema.Types.String,
    resetTokenDate: Schema.Types.Date,
    resetTokenCount: {
      reqInMinute: Schema.Types.Number,
      reqInDay: Schema.Types.Number,
    },
    showOnBoarding: Schema.Types.Boolean,
    showOnBoardingTour: Schema.Types.Number,
    tokens: [
      {
        providerId: Schema.Types.String,
        provider: Schema.Types.String,
        accessToken: Schema.Types.String,
        refreshToken: Schema.Types.String,
        valid: Schema.Types.Boolean,
        lastUsed: Schema.Types.Date,
        username: Schema.Types.String,
      },
    ],
    password: Schema.Types.String,
    failedLogin: {
      times: Schema.Types.Number,
      lastFailedAttempt: Schema.Types.Date,
    },
    servicesHashes: {
      intercom: Schema.Types.String,
      plain: Schema.Types.String,
    },
    jobTitle: Schema.Types.String,
    externalId: Schema.Types.String,
  },
  schemaOptions
);

// Create a unique index for email field only when self-hosted
if (process.env.SELF_HOSTED === 'true') {
  userSchema.index(
    { email: 1 },
    {
      unique: true,
    }
  );
}

export const User =
  (mongoose.models.User as mongoose.Model<UserDBModel>) || mongoose.model<UserDBModel>('User', userSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/workflow-override/index.ts
Tamaño: 161 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './types';
export * from './workflow-override.entity';
export * from './workflow-override.repository';
export * from './workflow-override.schema';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/workflow-override/types.ts
Tamaño: 51 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { WorkflowOverrideId } from '@novu/shared';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/workflow-override/workflow-override.entity.ts
Tamaño: 981 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IPreferenceChannels } from '@novu/shared';
import type { ChangePropsValueType } from '../../types';
import type { EnvironmentId } from '../environment';
import { NotificationTemplateEntity } from '../notification-template';
import type { OrganizationId } from '../organization';
import { TenantEntity } from '../tenant';
import { WorkflowOverrideId } from './types';

export class WorkflowOverrideEntity {
  _id: WorkflowOverrideId;

  _organizationId: OrganizationId;

  _environmentId: EnvironmentId;

  _workflowId: string;

  readonly workflow?: NotificationTemplateEntity;

  _tenantId: string;

  readonly tenant?: TenantEntity;

  active: boolean;

  preferenceSettings: IPreferenceChannels;

  deleted: boolean;

  deletedAt?: string;

  deletedBy?: string;

  createdAt: string;

  updatedAt?: string;
}

export type WorkflowOverrideDBModel = ChangePropsValueType<
  WorkflowOverrideEntity,
  '_environmentId' | '_organizationId' | '_workflowId' | '_tenantId'
>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowOverrideEntity
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/workflow-override/workflow-override.repository.ts
Tamaño: 1118 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IWorkflowOverride } from '@novu/shared';
import { SoftDeleteModel } from 'mongoose-delete';
import { EnforceEnvId } from '../../types';
import { BaseRepository } from '../base-repository';
import { WorkflowOverrideDBModel, WorkflowOverrideEntity } from './workflow-override.entity';
import { WorkflowOverride } from './workflow-override.schema';

export class WorkflowOverrideRepository extends BaseRepository<
  WorkflowOverrideDBModel,
  WorkflowOverrideEntity,
  EnforceEnvId
> {
  private workflowOverride: SoftDeleteModel;

  constructor() {
    super(WorkflowOverride, WorkflowOverrideEntity);
    this.workflowOverride = WorkflowOverride;
  }

  async getList(options: { skip: number; limit: number }, query: { environmentId: string }) {
    const requestQuery: Partial<IWorkflowOverride> = {
      _environmentId: query.environmentId,
    };

    const response = await this.MongooseModel.find(requestQuery)
      .read('secondaryPreferred')
      .skip(options.skip || 0)
      .limit(options.limit || 10)
      .sort('-createdAt');

    return {
      data: this.mapEntities(response),
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class WorkflowOverrideRepository

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/repositories/workflow-override/workflow-override.schema.ts
Tamaño: 1922 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import mongoose, { Schema } from 'mongoose';

import { schemaOptions } from '../schema-default.options';
import { WorkflowOverrideDBModel } from './workflow-override.entity';

const mongooseDelete = require('mongoose-delete');

const workflowOverrideSchema = new Schema<WorkflowOverrideDBModel>(
  {
    active: {
      type: Schema.Types.Boolean,
      default: false,
    },
    _environmentId: {
      type: Schema.Types.ObjectId,
      ref: 'Environment',
    },
    _organizationId: {
      type: Schema.Types.ObjectId,
      ref: 'Organization',
    },
    _workflowId: {
      type: Schema.Types.ObjectId,
      ref: 'NotificationTemplate',
    },
    _tenantId: {
      type: Schema.Types.ObjectId,
      ref: 'Tenant',
    },
    preferenceSettings: {
      email: {
        type: Schema.Types.Boolean,
        default: true,
      },
      sms: {
        type: Schema.Types.Boolean,
        default: true,
      },
      in_app: {
        type: Schema.Types.Boolean,
        default: true,
      },
      chat: {
        type: Schema.Types.Boolean,
        default: true,
      },
      push: {
        type: Schema.Types.Boolean,
        default: true,
      },
    },
  },
  schemaOptions
);

workflowOverrideSchema.virtual('workflow', {
  ref: 'NotificationTemplate',
  localField: '_workflowId',
  foreignField: '_id',
  justOne: true,
});

workflowOverrideSchema.virtual('tenant', {
  ref: 'Tenant',
  localField: '_tenantId',
  foreignField: '_id',
  justOne: true,
});

workflowOverrideSchema.plugin(mongooseDelete, { deletedAt: true, deletedBy: true, overrideMethods: 'all' });

workflowOverrideSchema.index(
  {
    _tenantId: 1,
    _workflowId: 1,
    _environmentId: 1,
  },
  { unique: true }
);

export const WorkflowOverride =
  (mongoose.models.WorkflowOverride as mongoose.Model<WorkflowOverrideDBModel>) ||
  mongoose.model<WorkflowOverrideDBModel>('WorkflowOverride', workflowOverrideSchema);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/index.ts
Tamaño: 56 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './consts';
export * from './exceptions';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/consts/index.ts
Tamaño: 23 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './ttl';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/consts/ttl.ts
Tamaño: 283 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export const TTL_EXPIRE_AFTER_AMOUNT = '48h';

export const TTL_INDEX_ENABLED = !(process.env.NOVU_MANAGED_SERVICE === 'true' || process.env.DISABLE_TTL === 'true');

export function getTTLOptions() {
  if (TTL_INDEX_ENABLED) {
    return { expires: TTL_EXPIRE_AFTER_AMOUNT };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getTTLOptions()
Declaraciones 'export' encontradas:
- export  const
- export  const
- export function getTTLOptions

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/exceptions/dal.exception.ts
Tamaño: 43 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export class DalException extends Error {}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export class DalException

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/exceptions/index.ts
Tamaño: 33 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './dal.exception';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/types/index.ts
Tamaño: 30 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './index.type';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/shared/types/index.type.ts
Tamaño: 129 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IndexDirection } from 'mongoose';

export type IndexDefinition<Entity> = Partial<Record<keyof Entity, IndexDirection>>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/auth.ts
Tamaño: 142 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type AuthMechanism =
  | 'DEFAULT'
  | 'MONGODB-CR'
  | 'SCRAM-SHA-1'
  | 'SCRAM-SHA-256'
  | 'MONGODB-X509'
  | 'GSSAPI'
  | 'PLAIN';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/enforce.ts
Tamaño: 323 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { EnvironmentId } from '../repositories/environment';
import type { OrganizationId } from '../repositories/organization';

export type EnforceOrgId = { _organizationId: OrganizationId };
export type EnforceEnvId = { _environmentId: EnvironmentId };
export type EnforceEnvOrOrgIds = EnforceEnvId | EnforceOrgId;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/env.d.ts
Tamaño: 271 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

declare namespace NodeJS {
  export interface ProcessEnv {
    REDIS_URL: string;
    REDIS_ARENA_PORT: string;
    NODE_ENV: 'test' | 'production' | 'dev';
    MONGO_MIN_POOL_SIZE: number;
    MONGO_MAX_POOL_SIZE: number;
    NOTIFICATION_RETENTION_DAYS?: number;
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/error.enum.ts
Tamaño: 58 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export enum ErrorCodesEnum {
  DUPLICATE_KEY = '11000',
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  enum

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/helpers.ts
Tamaño: 145 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Types } from 'mongoose';

export type ChangePropsValueType<T, K extends keyof T, V = Types.ObjectId> = Omit<T, K> & {
  [P in K]: V;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/index.ts
Tamaño: 177 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ClientSession } from 'mongoose';
export * from './auth';
export * from './enforce';
export * from './error.enum';
export * from './helpers';
export * from './results';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/results.ts
Tamaño: 169 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export interface IDeleteResult {
  matchedCount: number;
  modifiedCount: number;
}

export interface IUpdateResult {
  matchedCount: number;
  modifiedCount: number;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/dal/src/types/sort-order.ts
Tamaño: 32 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type SortOrder = 1 | -1;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/.babelrc.json
Tamaño: 289 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "sourceType": "unambiguous",
  "presets": [
    [
      "@babel/preset-env",
      {
        "targets": {
          "chrome": 100,
          "safari": 15,
          "firefox": 91
        }
      }
    ],
    "@babel/preset-typescript",
    "@babel/preset-react"
  ],
  "plugins": []
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"sourceType": "unambiguous",
"presets": [
[
"@babel/preset-env",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.gitignore
Tamaño: 268 bytes
Lenguaje detectado: GITIGNORE

### CONTENIDO ORIGINAL ###

# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage


# production
build

.npmrc
.idea/*
.nyc_output

test

src/**.js
coverage
*.log
package-lock.json

storybook-static


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.
# dependencies
/node_modules
/.pnp
# testing
# production
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/package.json
Tamaño: 3015 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "name": "@novu/design-system",
  "version": "2.0.5",
  "repository": "https://github.com/novuhq/novu",
  "description": "",
  "private": true,
  "license": "ISC",
  "author": "",
  "sideEffects": false,
  "main": "dist/cjs/index.js",
  "module": "dist/esm/index.js",
  "types": "dist/types/index.d.ts",
  "files": [
    "dist/cjs",
    "dist/esm",
    "dist/types"
  ],
  "scripts": {
    "start": "npm run build:watch",
    "prebuild": "rimraf dist",
    "build": "npm run build:cjs && npm run build:esm && npm run build:types",
    "build:cjs": "cross-env node_modules/.bin/tsc -p tsconfig.json",
    "build:cjs:watch": "cross-env node_modules/.bin/tsc -w -p tsconfig.json",
    "build:watch": "npm run build:esm:watch",
    "build:esm": "cross-env node_modules/.bin/tsc -p tsconfig.esm.json",
    "build:esm:watch": "cross-env node_modules/.bin/tsc -p tsconfig.esm.json -w --preserveWatchOutput",
    "build:types": "tsc --declaration --emitDeclarationOnly --declarationMap --declarationDir dist/types -p tsconfig.json",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build"
  },
  "dependencies": {
    "@emotion/css": "^11.10.5",
    "@emotion/react": "^11.7.1",
    "@emotion/styled": "^11.6.0",
    "@mantine/hooks": "^5.7.1",
    "@mantine/notifications": "^5.7.1",
    "@novu/shared": "workspace:*",
    "@segment/analytics-next": "^1.81.0",
    "@sentry/react": "^7.40.0",
    "@tanstack/react-query": "^4.20.4",
    "axios": "^1.9.0",
    "react-helmet-async": "^1.3.0",
    "react-hook-form": "7.43.9",
    "react-icons": "5.0.1",
    "react-table": "^7.8.0",
    "tslib": "^2.3.1"
  },
  "devDependencies": {
    "@mantine/core": "^5.7.1",
    "@storybook/addon-actions": "^7.5.0",
    "@storybook/addon-docs": "^7.4.2",
    "@storybook/client-api": "^7.6.10",
    "@storybook/react": "^7.4.2",
    "@storybook/react-webpack5": "^7.4.2",
    "@storybook/theming": "^7.4.2",
    "@testing-library/jest-dom": "^6.4.1",
    "@testing-library/react": "^12.1.5",
    "@testing-library/react-hooks": "^8.0.1",
    "@testing-library/user-event": "^14.5.2",
    "@types/node": "^20.15.0",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.0.3",
    "acorn": "^8.7.1",
    "jsdom": "^24.0.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "6.2.2",
    "rimraf": "^3.0.2",
    "storybook": "^7.4.2",
    "ts-loader": "~9.4.0",
    "tslib": "^2.3.1",
    "typescript": "5.6.2",
    "url-loader": "^4.1.1",
    "vite": "^4.5.2",
    "vite-plugin-dts": "^3.6.0",
    "vitest": "^1.2.1"
  },
  "peerDependencies": {
    "@mantine/core": "^5.7.1",
    "react": ">=16.8.0",
    "react-dom": ">=16.8.0"
  },
  "nx": {
    "targets": {
      "build-storybook": {
        "dependsOn": [
          "^build"
        ],
        "outputs": [
          "{projectRoot}/storybook-static"
        ],
        "inputs": [
          "{projectRoot}/.storybook",
          "{projectRoot}/src"
        ]
      }
    }
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"name": "@novu/design-system",
"version": "2.0.5",
"repository": "https://github.com/novuhq/novu",
"description": "",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/setup-tests.ts
Tamaño: 224 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { afterEach } from 'vitest';
import { cleanup } from '@testing-library/react';
import '@testing-library/jest-dom/vitest';

// runs a clean after each test case (e.g. clearing jsdom)
afterEach(() => {
  cleanup();
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

No se detectaron funciones/exportaciones con heurística JS/TS.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/tsconfig.esm.json
Tamaño: 114 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "module": "ESNext",
    "outDir": "./dist/esm"
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"extends": "./tsconfig.json",
"compilerOptions": {
"module": "ESNext",
"outDir": "./dist/esm"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/tsconfig.json
Tamaño: 592 bytes
Lenguaje detectado: JSON

### CONTENIDO ORIGINAL ###

{
  "include": ["src", "styled-system"],
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist/cjs",
    "forceConsistentCasingInFileNames": true,
    "target": "es6",
    "strict": true,
    "typeRoots": ["./node_modules/@types"],
    "jsx": "react-jsx",
    "module": "commonjs",
    "lib": ["ESNext", "dom"],
    "skipLibCheck": true,
    "declaration": false,
    "declarationMap": false,
    "sourceMap": true,
    "removeComments": false,
    "allowSyntheticDefaultImports": true,
    "baseUrl": "."
  },
  "exclude": ["node_modules", "src/**/*.stories.*"]
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

{
"include": ["src", "styled-system"],
"extends": "../../tsconfig.json",
"compilerOptions": {
"outDir": "./dist/cjs",
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/vite.config.ts
Tamaño: 413 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import react from '@vitejs/plugin-react';
import { resolve } from 'path';
import { defineConfig } from 'vite';
import dts from 'vite-plugin-dts';

export default defineConfig({
  plugins: [react(), dts({ include: ['src'] })],
  build: {
    lib: {
      entry: resolve(__dirname, 'src/index.ts'),
      formats: ['cjs'],
    },
    rollupOptions: {
      external: ['react', 'react/jsx-runtime'],
    },
  },
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  defineConfig

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/vitest.config.ts
Tamaño: 211 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/// <reference types="vitest" />

import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: './setup-tests.ts',
  },
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  defineConfig

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/.storybook/Doc.container.tsx
Tamaño: 749 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { DocsContainer as BaseContainer } from '@storybook/addon-docs';
import { useDarkMode } from 'storybook-dark-mode';
import { themes } from '@storybook/theming';

export const DocsContainer = ({ children, context }) => {
  const dark = useDarkMode();

  return (
    <BaseContainer
      context={{
        ...context,
        storyById: (id) => {
          const storyContext = context.storyById(id);
          return {
            ...storyContext,
            parameters: {
              ...storyContext?.parameters,
              docs: {
                theme: dark ? themes.dark : themes.light,
              },
            },
          };
        },
      }}
    >
      {children}
    </BaseContainer>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { DocsContainer as BaseContainer } from '@storybook/addon-docs';
import { useDarkMode } from 'storybook-dark-mode';
import { themes } from '@storybook/theming';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/NovuTheme.tsx
Tamaño: 538 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { ThemeVarsPartial } from '@storybook/theming';
import { create } from '@storybook/theming/create';

const themeBase: ThemeVarsPartial = {
  base: 'light',
  brandTitle: 'Novu Design System',
  brandTarget: '_self',
};
/**
 * Novu Design System theme for Storybook
 *
 * @see https://storybook.js.org/docs/configure/theming
 */
export const lightTheme = create({
  ...themeBase,
  brandImage: './novu-logo-light.svg',
});

export const darkTheme = create({
  ...themeBase,
  base: 'dark',
  brandImage: './novu-logo-dark.svg',
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { ThemeVarsPartial } from '@storybook/theming';
import { create } from '@storybook/theming/create';
const themeBase: ThemeVarsPartial = {
base: 'light',
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/main.ts
Tamaño: 724 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { dirname, join } from 'path';
import { StorybookConfig } from '@storybook/react-webpack5';

export default {
  stories: ['../src/**/*.stories.mdx', '../src/**/*.stories.@(js|jsx|ts|tsx)'],

  addons: [
    getAbsolutePath('@storybook/addon-links'),
    getAbsolutePath('@storybook/addon-essentials'),
    getAbsolutePath('storybook-dark-mode'),
    getAbsolutePath('@storybook/addon-mdx-gfm'),
  ],

  framework: {
    name: '@storybook/react-webpack5',
    options: {},
  },

  features: {
    emotionAlias: false,
  },

  docs: {
    autodocs: true,
  },

  staticDirs: ['./public'],
} satisfies StorybookConfig;

function getAbsolutePath(value) {
  return dirname(require.resolve(join(value, 'package.json')));
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getAbsolutePath(value)
Declaraciones 'export' encontradas:
- export default

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/.storybook/manager-head.html
Tamaño: 62 bytes
Lenguaje detectado: HTML

### CONTENIDO ORIGINAL ###

<link rel="icon" type="image/svg+xml" href="./favicon.svg" />


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<link rel="icon" type="image/svg+xml" href="./favicon.svg" />
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/preview-head.html
Tamaño: 319 bytes
Lenguaje detectado: HTML

### CONTENIDO ORIGINAL ###

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />
<script>
  window._env_ = {
    SKIP_PREFLIGHT_CHECK: 'true',
  };
</script>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />
<script>
window._env_ = {
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/preview.tsx
Tamaño: 1489 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { useEffect } from 'react';
import { addons } from '@storybook/preview-api';
import { DARK_MODE_EVENT_NAME } from 'storybook-dark-mode';
import { ThemeProvider } from '../src/ThemeProvider';
import { useLocalThemePreference } from '@novu/design-system';
import { lightTheme, darkTheme } from './NovuTheme';
import { Parameters, Decorator } from '@storybook/react';

export const parameters: Parameters = {
  layout: 'fullscreen',
  viewMode: 'docs',
  docs: {
    // @TODO: fix the container context
    // container: DocsContainer,
  },
  actions: { argTypesRegex: '^on[A-Z].*' },
  controls: {
    matchers: {
      color: /(background|color)$/i,
      date: /Date$/,
    },
  },
  darkMode: {
    // Override the default dark theme
    dark: darkTheme,
    // Override the default light theme
    light: lightTheme,
  },
};

const channel = addons.getChannel();
function ColorSchemeThemeWrapper({ children }) {
  const { setThemeStatus } = useLocalThemePreference();

  const handleColorScheme = (value) => {
    setThemeStatus(value ? 'dark' : 'light');
  };

  useEffect(() => {
    channel.on(DARK_MODE_EVENT_NAME, handleColorScheme);
    return () => channel.off(DARK_MODE_EVENT_NAME, handleColorScheme);
  }, [channel]);

  return (
    <div style={{ margin: '3em' }}>
      <ThemeProvider>{children}</ThemeProvider>
    </div>
  );
}

export const decorators: Decorator[] = [
  (renderStory) => <ColorSchemeThemeWrapper>{renderStory()}</ColorSchemeThemeWrapper>,
];


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { useEffect } from 'react';
import { addons } from '@storybook/preview-api';
import { DARK_MODE_EVENT_NAME } from 'storybook-dark-mode';
import { ThemeProvider } from '../src/ThemeProvider';
import { useLocalThemePreference } from '@novu/design-system';
// @TODO: fix the container context
// container: DocsContainer,
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/public/favicon.svg
Tamaño: 796 bytes
Lenguaje detectado: SVG

### CONTENIDO ORIGINAL ###

<svg width="2000" height="2000" viewBox="0 0 2000 2000" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M1540 801.609C1540 855.379 1474.72 882.004 1437.11 843.57L667.229 56.7032C771.33 19.9793 883.332 0 1000 0C1198.91 0 1384.25 58.0733 1540 158.19V801.609ZM1820 427.485V801.609C1820 1106.31 1450.07 1257.18 1236.98 1039.39L409.055 193.205C161.022 375.186 0 668.789 0 1000C0 1212.94 66.5559 1410.33 180 1572.51V1200.39C180 895.692 549.933 744.819 763.025 962.612L1589.81 1807.63C1838.48 1625.71 2000 1331.72 2000 1000C2000 787.061 1933.44 589.667 1820 427.485ZM562.887 1158.43L1331.32 1943.81C1227.63 1980.21 1116.12 2000 1000 2000C801.093 2000 615.749 1941.93 460 1841.81V1200.39C460 1146.62 525.282 1120 562.887 1158.43Z" fill="black"/>
</svg>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<svg width="2000" height="2000" viewBox="0 0 2000 2000" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1540 801.609C1540 855.379 1474.72 882.004 1437.11 843.57L667.229 56.7032C771.33 19.9793 883.332 0 1000 0C1198.91 0 1384.25 58.0733 1540 158.19V801.609ZM1820 427.485V801.609C1820 1106.31 1450.07 1257.18 1236.98 1039.39L409.055 193.205C161.022 375.186 0 668.789 0 1000C0 1212.94 66.5559 1410.33 180 1572.51V1200.39C180 895.692 549.933 744.819 763.025 962.612L1589.81 1807.63C1838.48 1625.71 2000 1331.72 2000 1000C2000 787.061 1933.44 589.667 1820 427.485ZM562.887 1158.43L1331.32 1943.81C1227.63 1980.21 1116.12 2000 1000 2000C801.093 2000 615.749 1941.93 460 1841.81V1200.39C460 1146.62 525.282 1120 562.887 1158.43Z" fill="black"/>
</svg>
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/public/novu-logo-dark.svg
Tamaño: 5637 bytes
Lenguaje detectado: SVG

### CONTENIDO ORIGINAL ###

<svg width="1049" height="300" viewBox="0 0 1049 300" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M231 120.241C231 128.307 221.208 132.301 215.567 126.536L100.084 8.50548C115.699 2.9969 132.5 0 150 0C179.836 0 207.638 8.711 231 23.7285V120.241ZM273 64.1228V120.241C273 165.946 217.51 188.577 185.546 155.908L61.3582 28.9807C24.1534 56.2779 0 100.318 0 150C0 181.941 9.98339 211.55 27 235.877V180.059C27 134.354 82.4899 111.723 114.454 144.392L238.471 271.145C275.773 243.857 300 199.758 300 150C300 118.059 290.017 88.45 273 64.1228ZM84.433 173.764L199.697 291.571C184.144 297.031 167.419 300 150 300C120.164 300 92.3624 291.289 69 276.272V180.059C69 171.993 78.7923 167.999 84.433 173.764Z" fill="url(#paint0_linear_1199_1981)"/>
<path d="M487.303 223.326V140.944C487.303 126.727 483.892 115.918 477.07 108.517C470.248 101.116 459.527 97.4157 444.908 97.4157C434.967 97.4157 427.073 98.3895 421.225 100.337C415.378 102.09 411.674 103.356 410.115 104.135V223.326H380V84.8539C380.78 84.4644 382.924 83.588 386.432 82.2247C389.941 80.8614 394.619 79.4007 400.467 77.8427C406.314 76.2846 413.136 74.9213 420.933 73.7528C428.73 72.5843 437.306 72 446.662 72C457.383 72 467.129 73.4607 475.9 76.382C484.672 79.1086 492.079 83.1011 498.121 88.3596C504.359 93.618 509.134 99.9476 512.448 107.348C515.761 114.749 517.418 123.124 517.418 132.472V223.326H487.303Z" fill="white"/>
<path d="M713.257 150C713.257 161.101 711.308 171.423 707.41 180.966C703.706 190.509 698.444 198.787 691.621 205.798C684.799 212.614 676.613 218.067 667.061 222.157C657.51 226.052 646.985 228 635.485 228C623.984 228 613.361 226.052 603.615 222.157C594.064 218.067 585.878 212.614 579.055 205.798C572.233 198.787 566.873 190.509 562.975 180.966C559.271 171.423 557.419 161.101 557.419 150C557.419 138.899 559.271 128.577 562.975 119.034C566.873 109.491 572.233 101.311 579.055 94.4944C585.878 87.4831 594.064 82.03 603.615 78.1348C613.361 74.0449 623.984 72 635.485 72C646.985 72 657.51 74.0449 667.061 78.1348C676.613 82.03 684.799 87.4831 691.621 94.4944C698.444 101.311 703.706 109.491 707.41 119.034C711.308 128.577 713.257 138.899 713.257 150ZM681.973 150C681.973 142.21 680.901 135.101 678.757 128.674C676.613 122.052 673.494 116.404 669.401 111.73C665.502 106.861 660.629 103.161 654.782 100.629C649.129 97.9026 642.697 96.5393 635.485 96.5393C628.078 96.5393 621.45 97.9026 615.603 100.629C609.95 103.161 605.077 106.861 600.984 111.73C597.085 116.404 594.064 122.052 591.92 128.674C589.776 135.101 588.704 142.21 588.704 150C588.704 157.79 589.776 164.996 591.92 171.618C594.064 178.045 597.085 183.693 600.984 188.562C605.077 193.236 609.95 196.936 615.603 199.663C621.45 202.195 628.078 203.461 635.485 203.461C642.697 203.461 649.129 202.195 654.782 199.663C660.629 196.936 665.502 193.236 669.401 188.562C673.494 183.693 676.613 178.045 678.757 171.618C680.901 164.996 681.973 157.79 681.973 150Z" fill="white"/>
<path d="M888.255 83.1011C887.086 87.3858 885.039 93.1311 882.116 100.337C879.387 107.348 876.17 115.236 872.467 124C868.764 132.764 864.67 142.015 860.187 151.753C855.899 161.296 851.513 170.644 847.03 179.798C842.742 188.757 838.551 197.228 834.458 205.213C830.559 213.004 827.148 219.528 824.224 224.787H792.94C789.431 218.554 785.728 211.738 781.829 204.337C778.126 196.742 774.325 189.146 770.427 181.551C766.723 173.76 763.117 166.067 759.609 158.472C756.1 150.876 752.786 143.865 749.668 137.438C746.744 130.816 744.113 124.974 741.774 119.91C739.629 114.846 737.973 110.951 736.803 108.225C735.634 105.498 734.464 102.577 733.294 99.4607C732.125 96.3446 731.54 93.4232 731.54 90.6966C731.54 87.191 732.71 83.9775 735.049 81.0562C737.388 78.1348 741.384 76.6742 747.036 76.6742C750.935 76.6742 753.956 77.0637 756.1 77.8427C758.244 78.6217 759.414 79.1086 759.609 79.3034C762.922 88.4569 766.723 98.4869 771.011 109.393C775.495 120.3 779.978 131.109 784.461 141.82C789.139 152.337 793.622 162.464 797.91 172.202C802.199 181.745 805.999 189.828 809.313 196.449C811.652 191.97 814.673 185.64 818.377 177.461C822.275 169.086 826.271 159.933 830.364 150C834.653 140.067 838.941 129.843 843.229 119.326C847.517 108.809 851.318 99.1685 854.632 90.4045C856.191 86.1198 858.14 82.809 860.479 80.4719C862.818 77.9401 866.717 76.6742 872.175 76.6742C876.853 76.6742 880.556 77.5506 883.285 79.3034C886.209 81.0562 887.866 82.3221 888.255 83.1011Z" fill="white"/>
<path d="M1018.88 90.4045C1018.88 85.7303 1020.25 82.3221 1022.98 80.1798C1025.71 77.8427 1029.61 76.6742 1034.67 76.6742C1037.99 76.6742 1040.91 77.0637 1043.44 77.8427C1046.17 78.6217 1048.03 79.206 1049 79.5955V223.326C1047.64 223.715 1045.2 224.105 1041.69 224.494C1038.38 224.884 1034.28 225.273 1029.41 225.663C1024.54 226.247 1019.18 226.637 1013.33 226.831C1007.48 227.221 1001.54 227.416 995.495 227.416C977.757 227.416 963.333 225.273 952.223 220.989C941.307 216.704 932.633 210.472 926.201 202.292C918.209 191.97 914.213 178.24 914.213 161.101V90.4045C914.213 85.7303 915.578 82.3221 918.307 80.1798C921.035 77.8427 924.934 76.6742 930.002 76.6742C933.315 76.6742 936.239 77.0637 938.773 77.8427C941.502 78.6217 943.354 79.206 944.328 79.5955V157.888C944.328 172.689 948.032 183.79 955.439 191.191C963.041 198.592 975.808 202.292 993.74 202.292C1000.56 202.292 1006.02 202.097 1010.11 201.708C1014.4 201.124 1017.33 200.637 1018.88 200.247V90.4045Z" fill="white"/>
<defs>
<linearGradient id="paint0_linear_1199_1981" x1="300" y1="0" x2="3.57628e-05" y2="300" gradientUnits="userSpaceOnUse">
<stop offset="0.231667" stop-color="#FF884D"/>
<stop offset="0.801667" stop-color="#E300BD"/>
</linearGradient>
</defs>
</svg>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<svg width="1049" height="300" viewBox="0 0 1049 300" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M231 120.241C231 128.307 221.208 132.301 215.567 126.536L100.084 8.50548C115.699 2.9969 132.5 0 150 0C179.836 0 207.638 8.711 231 23.7285V120.241ZM273 64.1228V120.241C273 165.946 217.51 188.577 185.546 155.908L61.3582 28.9807C24.1534 56.2779 0 100.318 0 150C0 181.941 9.98339 211.55 27 235.877V180.059C27 134.354 82.4899 111.723 114.454 144.392L238.471 271.145C275.773 243.857 300 199.758 300 150C300 118.059 290.017 88.45 273 64.1228ZM84.433 173.764L199.697 291.571C184.144 297.031 167.419 300 150 300C120.164 300 92.3624 291.289 69 276.272V180.059C69 171.993 78.7923 167.999 84.433 173.764Z" fill="url(#paint0_linear_1199_1981)"/>
<path d="M487.303 223.326V140.944C487.303 126.727 483.892 115.918 477.07 108.517C470.248 101.116 459.527 97.4157 444.908 97.4157C434.967 97.4157 427.073 98.3895 421.225 100.337C415.378 102.09 411.674 103.356 410.115 104.135V223.326H380V84.8539C380.78 84.4644 382.924 83.588 386.432 82.2247C389.941 80.8614 394.619 79.4007 400.467 77.8427C406.314 76.2846 413.136 74.9213 420.933 73.7528C428.73 72.5843 437.306 72 446.662 72C457.383 72 467.129 73.4607 475.9 76.382C484.672 79.1086 492.079 83.1011 498.121 88.3596C504.359 93.618 509.134 99.9476 512.448 107.348C515.761 114.749 517.418 123.124 517.418 132.472V223.326H487.303Z" fill="white"/>
<path d="M713.257 150C713.257 161.101 711.308 171.423 707.41 180.966C703.706 190.509 698.444 198.787 691.621 205.798C684.799 212.614 676.613 218.067 667.061 222.157C657.51 226.052 646.985 228 635.485 228C623.984 228 613.361 226.052 603.615 222.157C594.064 218.067 585.878 212.614 579.055 205.798C572.233 198.787 566.873 190.509 562.975 180.966C559.271 171.423 557.419 161.101 557.419 150C557.419 138.899 559.271 128.577 562.975 119.034C566.873 109.491 572.233 101.311 579.055 94.4944C585.878 87.4831 594.064 82.03 603.615 78.1348C613.361 74.0449 623.984 72 635.485 72C646.985 72 657.51 74.0449 667.061 78.1348C676.613 82.03 684.799 87.4831 691.621 94.4944C698.444 101.311 703.706 109.491 707.41 119.034C711.308 128.577 713.257 138.899 713.257 150ZM681.973 150C681.973 142.21 680.901 135.101 678.757 128.674C676.613 122.052 673.494 116.404 669.401 111.73C665.502 106.861 660.629 103.161 654.782 100.629C649.129 97.9026 642.697 96.5393 635.485 96.5393C628.078 96.5393 621.45 97.9026 615.603 100.629C609.95 103.161 605.077 106.861 600.984 111.73C597.085 116.404 594.064 122.052 591.92 128.674C589.776 135.101 588.704 142.21 588.704 150C588.704 157.79 589.776 164.996 591.92 171.618C594.064 178.045 597.085 183.693 600.984 188.562C605.077 193.236 609.95 196.936 615.603 199.663C621.45 202.195 628.078 203.461 635.485 203.461C642.697 203.461 649.129 202.195 654.782 199.663C660.629 196.936 665.502 193.236 669.401 188.562C673.494 183.693 676.613 178.045 678.757 171.618C680.901 164.996 681.973 157.79 681.973 150Z" fill="white"/>
<path d="M888.255 83.1011C887.086 87.3858 885.039 93.1311 882.116 100.337C879.387 107.348 876.17 115.236 872.467 124C868.764 132.764 864.67 142.015 860.187 151.753C855.899 161.296 851.513 170.644 847.03 179.798C842.742 188.757 838.551 197.228 834.458 205.213C830.559 213.004 827.148 219.528 824.224 224.787H792.94C789.431 218.554 785.728 211.738 781.829 204.337C778.126 196.742 774.325 189.146 770.427 181.551C766.723 173.76 763.117 166.067 759.609 158.472C756.1 150.876 752.786 143.865 749.668 137.438C746.744 130.816 744.113 124.974 741.774 119.91C739.629 114.846 737.973 110.951 736.803 108.225C735.634 105.498 734.464 102.577 733.294 99.4607C732.125 96.3446 731.54 93.4232 731.54 90.6966C731.54 87.191 732.71 83.9775 735.049 81.0562C737.388 78.1348 741.384 76.6742 747.036 76.6742C750.935 76.6742 753.956 77.0637 756.1 77.8427C758.244 78.6217 759.414 79.1086 759.609 79.3034C762.922 88.4569 766.723 98.4869 771.011 109.393C775.495 120.3 779.978 131.109 784.461 141.82C789.139 152.337 793.622 162.464 797.91 172.202C802.199 181.745 805.999 189.828 809.313 196.449C811.652 191.97 814.673 185.64 818.377 177.461C822.275 169.086 826.271 159.933 830.364 150C834.653 140.067 838.941 129.843 843.229 119.326C847.517 108.809 851.318 99.1685 854.632 90.4045C856.191 86.1198 858.14 82.809 860.479 80.4719C862.818 77.9401 866.717 76.6742 872.175 76.6742C876.853 76.6742 880.556 77.5506 883.285 79.3034C886.209 81.0562 887.866 82.3221 888.255 83.1011Z" fill="white"/>
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/.storybook/public/novu-logo-light.svg
Tamaño: 5637 bytes
Lenguaje detectado: SVG

### CONTENIDO ORIGINAL ###

<svg width="1049" height="300" viewBox="0 0 1049 300" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M231 120.241C231 128.307 221.208 132.301 215.567 126.536L100.084 8.50548C115.699 2.9969 132.5 0 150 0C179.836 0 207.638 8.711 231 23.7285V120.241ZM273 64.1228V120.241C273 165.946 217.51 188.577 185.546 155.908L61.3582 28.9807C24.1534 56.2779 0 100.318 0 150C0 181.941 9.98339 211.55 27 235.877V180.059C27 134.354 82.4899 111.723 114.454 144.392L238.471 271.145C275.773 243.857 300 199.758 300 150C300 118.059 290.017 88.45 273 64.1228ZM84.433 173.764L199.697 291.571C184.144 297.031 167.419 300 150 300C120.164 300 92.3624 291.289 69 276.272V180.059C69 171.993 78.7923 167.999 84.433 173.764Z" fill="url(#paint0_linear_1301_3067)"/>
<path d="M487.303 223.326V140.944C487.303 126.727 483.892 115.918 477.07 108.517C470.248 101.116 459.527 97.4157 444.908 97.4157C434.967 97.4157 427.073 98.3895 421.225 100.337C415.378 102.09 411.674 103.356 410.115 104.135V223.326H380V84.8539C380.78 84.4644 382.924 83.588 386.432 82.2247C389.941 80.8614 394.619 79.4007 400.467 77.8427C406.314 76.2846 413.136 74.9213 420.933 73.7528C428.73 72.5843 437.306 72 446.662 72C457.383 72 467.129 73.4607 475.9 76.382C484.672 79.1086 492.079 83.1011 498.121 88.3596C504.359 93.618 509.134 99.9476 512.448 107.348C515.761 114.749 517.418 123.124 517.418 132.472V223.326H487.303Z" fill="black"/>
<path d="M713.257 150C713.257 161.101 711.308 171.423 707.41 180.966C703.706 190.509 698.444 198.787 691.621 205.798C684.799 212.614 676.613 218.067 667.061 222.157C657.51 226.052 646.985 228 635.485 228C623.984 228 613.361 226.052 603.615 222.157C594.064 218.067 585.878 212.614 579.055 205.798C572.233 198.787 566.873 190.509 562.975 180.966C559.271 171.423 557.419 161.101 557.419 150C557.419 138.899 559.271 128.577 562.975 119.034C566.873 109.491 572.233 101.311 579.055 94.4944C585.878 87.4831 594.064 82.03 603.615 78.1348C613.361 74.0449 623.984 72 635.485 72C646.985 72 657.51 74.0449 667.061 78.1348C676.613 82.03 684.799 87.4831 691.621 94.4944C698.444 101.311 703.706 109.491 707.41 119.034C711.308 128.577 713.257 138.899 713.257 150ZM681.973 150C681.973 142.21 680.901 135.101 678.757 128.674C676.613 122.052 673.494 116.404 669.401 111.73C665.502 106.861 660.629 103.161 654.782 100.629C649.129 97.9026 642.697 96.5393 635.485 96.5393C628.078 96.5393 621.45 97.9026 615.603 100.629C609.95 103.161 605.077 106.861 600.984 111.73C597.085 116.404 594.064 122.052 591.92 128.674C589.776 135.101 588.704 142.21 588.704 150C588.704 157.79 589.776 164.996 591.92 171.618C594.064 178.045 597.085 183.693 600.984 188.562C605.077 193.236 609.95 196.936 615.603 199.663C621.45 202.195 628.078 203.461 635.485 203.461C642.697 203.461 649.129 202.195 654.782 199.663C660.629 196.936 665.502 193.236 669.401 188.562C673.494 183.693 676.613 178.045 678.757 171.618C680.901 164.996 681.973 157.79 681.973 150Z" fill="black"/>
<path d="M888.255 83.1011C887.086 87.3858 885.039 93.1311 882.115 100.337C879.387 107.348 876.17 115.236 872.467 124C868.764 132.764 864.67 142.015 860.187 151.753C855.899 161.296 851.513 170.644 847.03 179.798C842.742 188.757 838.551 197.228 834.458 205.213C830.559 213.004 827.148 219.528 824.224 224.787H792.94C789.431 218.554 785.728 211.738 781.829 204.337C778.126 196.742 774.325 189.146 770.427 181.551C766.723 173.76 763.117 166.067 759.609 158.472C756.1 150.876 752.786 143.865 749.668 137.438C746.744 130.816 744.113 124.974 741.774 119.91C739.629 114.846 737.973 110.951 736.803 108.225C735.634 105.498 734.464 102.577 733.295 99.4607C732.125 96.3446 731.54 93.4232 731.54 90.6966C731.54 87.191 732.71 83.9775 735.049 81.0562C737.388 78.1348 741.384 76.6742 747.036 76.6742C750.935 76.6742 753.956 77.0637 756.1 77.8427C758.244 78.6217 759.414 79.1086 759.609 79.3034C762.922 88.4569 766.723 98.4869 771.011 109.393C775.495 120.3 779.978 131.109 784.461 141.82C789.139 152.337 793.622 162.464 797.91 172.202C802.199 181.745 805.999 189.828 809.313 196.449C811.652 191.97 814.673 185.64 818.377 177.461C822.275 169.086 826.271 159.933 830.364 150C834.653 140.067 838.941 129.843 843.229 119.326C847.517 108.809 851.318 99.1685 854.632 90.4045C856.191 86.1198 858.14 82.809 860.479 80.4719C862.818 77.9401 866.717 76.6742 872.175 76.6742C876.853 76.6742 880.556 77.5506 883.285 79.3034C886.209 81.0562 887.866 82.3221 888.255 83.1011Z" fill="black"/>
<path d="M1018.88 90.4045C1018.88 85.7303 1020.25 82.3221 1022.98 80.1798C1025.71 77.8427 1029.61 76.6742 1034.67 76.6742C1037.99 76.6742 1040.91 77.0637 1043.44 77.8427C1046.17 78.6217 1048.03 79.206 1049 79.5955V223.326C1047.64 223.715 1045.2 224.105 1041.69 224.494C1038.38 224.884 1034.28 225.273 1029.41 225.663C1024.54 226.247 1019.18 226.637 1013.33 226.831C1007.48 227.221 1001.54 227.416 995.495 227.416C977.757 227.416 963.333 225.273 952.223 220.989C941.307 216.704 932.633 210.472 926.201 202.292C918.209 191.97 914.213 178.24 914.213 161.101V90.4045C914.213 85.7303 915.578 82.3221 918.307 80.1798C921.035 77.8427 924.934 76.6742 930.002 76.6742C933.315 76.6742 936.239 77.0637 938.773 77.8427C941.502 78.6217 943.354 79.206 944.328 79.5955V157.888C944.328 172.689 948.032 183.79 955.439 191.191C963.041 198.592 975.808 202.292 993.74 202.292C1000.56 202.292 1006.02 202.097 1010.11 201.708C1014.4 201.124 1017.33 200.637 1018.88 200.247V90.4045Z" fill="black"/>
<defs>
<linearGradient id="paint0_linear_1301_3067" x1="300" y1="0" x2="3.57628e-05" y2="300" gradientUnits="userSpaceOnUse">
<stop offset="0.231667" stop-color="#FF884D"/>
<stop offset="0.801667" stop-color="#E300BD"/>
</linearGradient>
</defs>
</svg>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

<svg width="1049" height="300" viewBox="0 0 1049 300" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M231 120.241C231 128.307 221.208 132.301 215.567 126.536L100.084 8.50548C115.699 2.9969 132.5 0 150 0C179.836 0 207.638 8.711 231 23.7285V120.241ZM273 64.1228V120.241C273 165.946 217.51 188.577 185.546 155.908L61.3582 28.9807C24.1534 56.2779 0 100.318 0 150C0 181.941 9.98339 211.55 27 235.877V180.059C27 134.354 82.4899 111.723 114.454 144.392L238.471 271.145C275.773 243.857 300 199.758 300 150C300 118.059 290.017 88.45 273 64.1228ZM84.433 173.764L199.697 291.571C184.144 297.031 167.419 300 150 300C120.164 300 92.3624 291.289 69 276.272V180.059C69 171.993 78.7923 167.999 84.433 173.764Z" fill="url(#paint0_linear_1301_3067)"/>
<path d="M487.303 223.326V140.944C487.303 126.727 483.892 115.918 477.07 108.517C470.248 101.116 459.527 97.4157 444.908 97.4157C434.967 97.4157 427.073 98.3895 421.225 100.337C415.378 102.09 411.674 103.356 410.115 104.135V223.326H380V84.8539C380.78 84.4644 382.924 83.588 386.432 82.2247C389.941 80.8614 394.619 79.4007 400.467 77.8427C406.314 76.2846 413.136 74.9213 420.933 73.7528C428.73 72.5843 437.306 72 446.662 72C457.383 72 467.129 73.4607 475.9 76.382C484.672 79.1086 492.079 83.1011 498.121 88.3596C504.359 93.618 509.134 99.9476 512.448 107.348C515.761 114.749 517.418 123.124 517.418 132.472V223.326H487.303Z" fill="black"/>
<path d="M713.257 150C713.257 161.101 711.308 171.423 707.41 180.966C703.706 190.509 698.444 198.787 691.621 205.798C684.799 212.614 676.613 218.067 667.061 222.157C657.51 226.052 646.985 228 635.485 228C623.984 228 613.361 226.052 603.615 222.157C594.064 218.067 585.878 212.614 579.055 205.798C572.233 198.787 566.873 190.509 562.975 180.966C559.271 171.423 557.419 161.101 557.419 150C557.419 138.899 559.271 128.577 562.975 119.034C566.873 109.491 572.233 101.311 579.055 94.4944C585.878 87.4831 594.064 82.03 603.615 78.1348C613.361 74.0449 623.984 72 635.485 72C646.985 72 657.51 74.0449 667.061 78.1348C676.613 82.03 684.799 87.4831 691.621 94.4944C698.444 101.311 703.706 109.491 707.41 119.034C711.308 128.577 713.257 138.899 713.257 150ZM681.973 150C681.973 142.21 680.901 135.101 678.757 128.674C676.613 122.052 673.494 116.404 669.401 111.73C665.502 106.861 660.629 103.161 654.782 100.629C649.129 97.9026 642.697 96.5393 635.485 96.5393C628.078 96.5393 621.45 97.9026 615.603 100.629C609.95 103.161 605.077 106.861 600.984 111.73C597.085 116.404 594.064 122.052 591.92 128.674C589.776 135.101 588.704 142.21 588.704 150C588.704 157.79 589.776 164.996 591.92 171.618C594.064 178.045 597.085 183.693 600.984 188.562C605.077 193.236 609.95 196.936 615.603 199.663C621.45 202.195 628.078 203.461 635.485 203.461C642.697 203.461 649.129 202.195 654.782 199.663C660.629 196.936 665.502 193.236 669.401 188.562C673.494 183.693 676.613 178.045 678.757 171.618C680.901 164.996 681.973 157.79 681.973 150Z" fill="black"/>
<path d="M888.255 83.1011C887.086 87.3858 885.039 93.1311 882.115 100.337C879.387 107.348 876.17 115.236 872.467 124C868.764 132.764 864.67 142.015 860.187 151.753C855.899 161.296 851.513 170.644 847.03 179.798C842.742 188.757 838.551 197.228 834.458 205.213C830.559 213.004 827.148 219.528 824.224 224.787H792.94C789.431 218.554 785.728 211.738 781.829 204.337C778.126 196.742 774.325 189.146 770.427 181.551C766.723 173.76 763.117 166.067 759.609 158.472C756.1 150.876 752.786 143.865 749.668 137.438C746.744 130.816 744.113 124.974 741.774 119.91C739.629 114.846 737.973 110.951 736.803 108.225C735.634 105.498 734.464 102.577 733.295 99.4607C732.125 96.3446 731.54 93.4232 731.54 90.6966C731.54 87.191 732.71 83.9775 735.049 81.0562C737.388 78.1348 741.384 76.6742 747.036 76.6742C750.935 76.6742 753.956 77.0637 756.1 77.8427C758.244 78.6217 759.414 79.1086 759.609 79.3034C762.922 88.4569 766.723 98.4869 771.011 109.393C775.495 120.3 779.978 131.109 784.461 141.82C789.139 152.337 793.622 162.464 797.91 172.202C802.199 181.745 805.999 189.828 809.313 196.449C811.652 191.97 814.673 185.64 818.377 177.461C822.275 169.086 826.271 159.933 830.364 150C834.653 140.067 838.941 129.843 843.229 119.326C847.517 108.809 851.318 99.1685 854.632 90.4045C856.191 86.1198 858.14 82.809 860.479 80.4719C862.818 77.9401 866.717 76.6742 872.175 76.6742C876.853 76.6742 880.556 77.5506 883.285 79.3034C886.209 81.0562 887.866 82.3221 888.255 83.1011Z" fill="black"/>
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/Colors.stories.mdx
Tamaño: 886 bytes
Lenguaje detectado: MDX

### CONTENIDO ORIGINAL ###

import { Meta, ColorPalette, ColorItem } from '@storybook/addon-docs';
import { colors } from './config';

<Meta title="Components/Colors" />

# Colors

<ColorPalette>
  <ColorItem title="Gradient Horizontal" subtitle="theme.colors.gradient" colors={{ horizontal: colors.horizontal }} />
  <ColorItem title="Gradient Vertical" subtitle="theme.colors.gradient" colors={{ vertical: colors.vertical }} />
  <ColorItem
    title="Gray"
    subtitle="theme.colors.gray"
    colors={{
      BGLight: colors.BGLight,
      B98: colors.B98,
      B80: colors.B80,
      B70: colors.B70,
      B60: colors.B60,
      B40: colors.B40,
    }}
  />
  <ColorItem
    title="Dark"
    subtitle="theme.colors.dark"
    colors={{
      B40: colors.B40,
      B30: colors.B30,
      B20: colors.B20,
      B15: colors.B15,
      B17: colors.B17,
      BGDark: colors.BGDark,
    }}
  />
</ColorPalette>


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { Meta, ColorPalette, ColorItem } from '@storybook/addon-docs';
import { colors } from './config';
<Meta title="Components/Colors" />
# Colors
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/ThemeProvider.tsx
Tamaño: 3196 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { ReactNode } from 'react';
import { MantineProvider, Global, ColorSchemeProvider, MantineTheme } from '@mantine/core';
import { NotificationsProvider } from '@mantine/notifications';

import { mantineConfig } from './config/theme.config';
import { colors, shadows } from './config';
import { ChevronDown } from './icons';
import { IconProvider } from './iconsV2/IconProvider';
import { useColorScheme } from './color-scheme';

const accordionStyles = (theme: MantineTheme) => ({
  item: {
    background: theme.colorScheme === 'dark' ? colors.B15 : colors.B98,
    borderRadius: 8,
    marginBottom: 24,
  },
  control: {
    color: colors.B60,
    fontSize: 14,
    lineHeight: '20px',
    padding: 16,
    paddingRight: 20,
    '&:hover': {
      background: 'transparent',
    },
  },
  content: {
    padding: 16,
  },
});

const notificationStyles = (theme: MantineTheme) => {
  return {
    root: {
      backgroundColor: theme.colorScheme === 'dark' ? colors.B15 : colors.white,
      border: 'none',
      boxShadow: theme.colorScheme === 'dark' ? shadows.dark : shadows.light,
      width: '460px',
      borderRadius: '7px',
      padding: '20px',
      justify: 'space-between',
    },
    description: {
      fontSize: '16px',
      fontWeight: 400,
      color: theme.colorScheme === 'dark' ? colors.white : colors.B40,
    },
    closeButton: {
      color: theme.colorScheme === 'dark' ? colors.B40 : colors.B80,
    },
    icon: {
      width: '22px',
      height: '22px',
      marginRight: '10px',
    },
  };
};

export function ThemeProvider({
  children,
  shouldDisableGlobals,
}: {
  children: ReactNode | ReactNode[];
  shouldDisableGlobals?: Boolean;
}) {
  const { colorScheme, toggleColorScheme } = useColorScheme();

  return (
    <ColorSchemeProvider colorScheme={colorScheme} toggleColorScheme={toggleColorScheme}>
      <MantineProvider
        withGlobalStyles={!shouldDisableGlobals}
        withNormalizeCSS={!shouldDisableGlobals}
        theme={{
          // Override any other properties from default theme
          colorScheme,
          ...mantineConfig,
          components: {
            Notification: {
              styles: notificationStyles,
            },
            Accordion: {
              styles: accordionStyles,
              defaultProps: {
                chevron: <ChevronDown />,
              },
            },
          },
        }}
      >
        {!shouldDisableGlobals && (
          <Global
            styles={(theme) => ({
              body: {
                ...theme.fn.fontStyles(),
                backgroundColor: theme.colorScheme === 'dark' ? colors.BGDark : colors.BGLight,
                color: theme.colorScheme === 'dark' ? colors.white : colors.B40,
                marginRight: `calc(-1 * var(--removed-scroll-width, 0))`,
                overflow: 'hidden',
              },
              a: {
                textDecoration: 'none',
                color: 'inherit',
              },
            })}
          />
        )}
        <NotificationsProvider>
          <IconProvider>{children}</IconProvider>
        </NotificationsProvider>
      </MantineProvider>
    </ColorSchemeProvider>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { ReactNode } from 'react';
import { MantineProvider, Global, ColorSchemeProvider, MantineTheme } from '@mantine/core';
import { NotificationsProvider } from '@mantine/notifications';
import { mantineConfig } from './config/theme.config';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/emotion.d.ts
Tamaño: 162 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import '@emotion/react';
import type { MantineTheme } from '@mantine/core';

declare module '@emotion/react' {
  export interface Theme extends MantineTheme {}
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/index.ts
Tamaño: 2508 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { Button } from './button/Button';
export { ActionButton } from './button/ActionButton';
export { PlusButton } from './button/PlusButton';
export type { IButtonProps } from './button/Button';
export type { Size } from './button/Button';
export { Checkbox } from './checkbox/Checkbox';
export { colors, shadows } from './config';
export type { IInputProps } from './input/Input';
export { Input } from './input/Input';
export { Textarea } from './textarea/Textarea';
export { Radio } from './radio/Radio';
export { Select } from './select/Select';
export type { ISelectProps } from './select/Select.types';
export { Switch } from './switch/Switch';
export * from './table';
export { Tag } from './tag/Tag';
export { Container } from './container/Container';
export type { IDropdownProps } from './dropdown/Dropdown';
export { Dropdown } from './dropdown/Dropdown';
export { NavMenu } from './navigation/NavMenu';
export { Tabs } from './tabs/Tabs';
export { Tooltip } from './tooltip/Tooltip';
export { ColorInput } from './color-input/ColorInput';
export { TemplateButton } from './template-button/TemplateButton';
export { DragButton } from './template-button/DragButton';
export { PasswordInput } from './password-input/PasswordInput';
export { SegmentedControl } from './segmented-control/SegmentedControl';
export { NotificationBadge } from './notification-badge/NotificationBadge';
export { Modal } from './modal/Modal';
export { LoadingOverlay } from './loading-overlay/LoadingOverlay';
export { NameInput } from './name-input/NameInput';
export * from './color-scheme';
export * from './pagination';
export * from './cards';
export * from './arrow-button';
export * from './popover';
export * from './dots-navigation';
export * from './sidebar';
export * from './when';
export * from './ThemeProvider';
export * from './search-input';
export * from './hooks/useKeyDown';
export * from './hooks/useDataRef';
export * from './hooks/useLocalThemePreference';
/** @deprecated */
export * from './icons';
export * from './iconsV2';
export * from './config/inputs.styles';
export * from './config/helper';
export * from './tabs/Tabs.styles';
export * from './config/text.styles';
export * from './typography/label';
export * from './typography/title/Title';
export * from './typography/text/Text';
export * from './hover-card/HoverCard';
export * from './template-button/TemplateButton.styles';
export * from './select/Select.styles';
export * from './layout';
export * from './utils/notifications';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export  type
- export  type
- export
- export
- export  type
- export
- export
- export
- export
- export  type
- export
- export
- export
- export
- export  type
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/theme.d.ts
Tamaño: 348 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { Tuple, DefaultMantineColor } from '@mantine/core';

type ExtendedCustomColors = 'primaryColorName' | 'secondaryColorName' | DefaultMantineColor;

declare module '@mantine/core' {
  export interface MantineThemeColorsOverride {
    colors: Record<ExtendedCustomColors, Tuple<string, 10>> & {
      gradient: Tuple<string, 10>;
    };
  }
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/arrow-button/ArrowButton.tsx
Tamaño: 685 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { Center } from '@mantine/core';

import { ArrowLeft } from '../icons';
import { colors } from '../config';
import { Text } from '../typography/text/Text';

export function ArrowButton({
  label,
  onClick,
  display = true,
  testId,
}: {
  label: string;
  onClick?: React.MouseEventHandler<HTMLDivElement>;
  display?: boolean;
  testId?: string;
}) {
  return (
    <Center
      onClick={onClick}
      role="button"
      inline
      style={{ cursor: 'pointer', visibility: display ? 'visible' : 'hidden' }}
      data-test-id={testId}
    >
      <ArrowLeft color={colors.B60} />
      <Text ml={5} color={colors.B60}>
        {label}
      </Text>
    </Center>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { Center } from '@mantine/core';
import { ArrowLeft } from '../icons';
import { colors } from '../config';
import { Text } from '../typography/text/Text';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/arrow-button/index.ts
Tamaño: 45 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { ArrowButton } from './ArrowButton';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/button/ActionButton.tsx
Tamaño: 1833 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { MouseEventHandler, FunctionComponent, ReactNode } from 'react';
import { ActionIcon, Center, Sx } from '@mantine/core';

import { Tooltip, ITooltipProps } from '../tooltip/Tooltip';
import { Text } from '../typography/text/Text';
import { colors } from '../config';

export const ActionButton = React.forwardRef<
  HTMLButtonElement,
  {
    tooltip?: ReactNode;
    tooltipPosition?: ITooltipProps['position'];
    text?: string;
    color?: string;
    Icon: FunctionComponent<{ color?: string; width?: string; height?: string }>;
    style?: React.CSSProperties;
    sx?: Sx;
    onClick?: MouseEventHandler<HTMLButtonElement>;
    className?: string;
  }
>(({ tooltip, tooltipPosition, text, Icon, style, color, sx, onClick, ...rest }, ref) => {
  const pickedColor = color ?? colors.B60;

  const actionButton = (
    <ActionIcon
      ref={ref}
      sx={(theme) => ({
        minWidth: 28,
        width: 'initial',
        padding: '0 4px',
        border: 'none',
        '&:hover': {
          background: theme.colorScheme === 'dark' ? colors.B30 : colors.B98,
          borderRadius: '8px',
          '> svg': {
            color: theme.colorScheme === 'dark' ? colors.white : colors.B60,
          },
        },
        ...sx,
      })}
      onClick={onClick}
      style={style}
      {...rest}
    >
      {text ? (
        <Center inline>
          <Icon color={pickedColor} width="20px" height="20px" />
          <Text color={pickedColor} weight={'bold'} ml={4} size={14}>
            {text}
          </Text>
        </Center>
      ) : (
        <Icon color={pickedColor} width="20px" height="20px" />
      )}
    </ActionIcon>
  );

  if (!tooltip) {
    return actionButton;
  }

  return (
    <Tooltip label={tooltip} position={tooltipPosition}>
      {actionButton}
    </Tooltip>
  );
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { MouseEventHandler, FunctionComponent, ReactNode } from 'react';
import { ActionIcon, Center, Sx } from '@mantine/core';
import { Tooltip, ITooltipProps } from '../tooltip/Tooltip';
import { Text } from '../typography/text/Text';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/button/Button.stories.tsx
Tamaño: 951 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Group } from '@mantine/core';
import { Button } from './Button';

export default {
  title: 'Components/Button',
  component: Button,
  argTypes: {},
} as Meta<typeof Button>;

const Template: StoryFn<typeof Button> = ({ ...args }) => <Button {...args}>Click Me</Button>;

export const Default = Template.bind({});
Default.args = {};

export const Loading = Template.bind({});
Loading.args = {
  loading: true,
};

export const filled = () => (
  <Group>
    <Button size="lg">Large</Button>
    <Button>Medium</Button>
  </Group>
);

export const outline = () => (
  <Group>
    <Button size="lg" variant="outline">
      Large
    </Button>
    <Button variant="outline">Medium</Button>
  </Group>
);

export const disabled = () => (
  <Group>
    <Button disabled>Filled</Button>
    <Button variant="outline" disabled>
      Outline
    </Button>
  </Group>
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Group } from '@mantine/core';
import { Button } from './Button';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/button/Button.styles.ts
Tamaño: 4854 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';

const getGradient = (color) => `linear-gradient(0deg, ${color} 0%, ${color} 100%)`;

const getLabelStyles = (disabled: boolean, variant?: string): any => {
  if (disabled && variant === 'subtle') {
    return {
      gap: '8px',
    };
  }

  if (disabled) {
    return {};
  }

  if (variant === 'light') {
    return {
      fontWeight: 'normal',
      fontSize: '12px',
    };
  }

  return {
    backgroundImage: colors.horizontal,
    backgroundClip: 'text',
    fontWeight: 'bold',
    gap: '8px',
  };
};

export const getOutlineStyles = (theme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    border: '1px solid transparent',
    background: `${dark ? getGradient(colors.B17) : getGradient(colors.white)} padding-box, ${
      colors.horizontal
    } border-box`,
    color: dark ? theme.white : 'transparent',
    boxShadow: dark ? shadows.dark : shadows.medium,
  };
};

export const getSubtleStyles = (theme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    border: 'none',
    padding: '0 8px',
    background: 'transparent',
    color: dark ? theme.white : 'transparent',
    boxShadow: 'none',
    '.mantine-Button-label': {
      'div[data-square]': {
        color: colors.white,
        backgroundImage: colors.horizontal,
        backgroundColor: 'transparent',
      },
    },
    '&:hover:not(:disabled)': {
      background: 'transparent',
      color: dark ? theme.white : 'transparent',
      filter: dark ? 'none' : 'brightness(0.9)',
      '.mantine-Button-label': {
        'div[data-square]': {
          color: dark ? colors.gradientMiddle : theme.white,
          backgroundColor: dark ? theme.white : 'transparent',
          backgroundImage: dark ? 'none' : colors.horizontal,
        },
        'div:last-of-type': {
          backgroundImage: 'none !important',
          backgroundColor: dark ? theme.white : 'transparent',
          backgroundClip: 'none !important',
          color: 'transparent',
          WebkitTextFillColor: 'initial !important',
        },
      },
    },
    '&:focus:not(:disabled)': {
      background: 'transparent',
      color: dark ? theme.white : 'transparent',
      filter: dark ? 'none' : 'brightness(0.9)',
      '.mantine-Button-label': {
        'div[data-square]': {
          color: dark ? colors.gradientMiddle : theme.white,
          backgroundColor: dark ? theme.white : 'transparent',
          backgroundImage: dark ? 'none' : colors.horizontal,
        },
        'div:last-of-type': {
          backgroundImage: 'none !important',
          backgroundColor: dark ? theme.white : 'transparent',
          backgroundClip: 'none !important',
          color: 'transparent',
          WebkitTextFillColor: 'initial !important',
        },
      },
    },
    '&:disabled': {
      opacity: 0.4,
      background: 'transparent',
    },
  };
};

export const getPulseStyles = () => {
  return {
    [`&:not(:disabled):not([data-loading])`]: {
      animation: 'pulse-animation 2s infinite',
      '@keyframes pulse-animation': {
        '0%': {
          boxShadow: '0 0 0 0 rgba(255, 82, 82, 0.7)',
        },
        '70%': {
          boxShadow: '0 0 0 10px rgba(255, 82, 82, 0)',
        },
        '100%': {
          boxShadow: '0 0 0 0 rgba(255, 82, 82, 0)',
        },
      },
    },
  };
};

export const getLightStyles = (theme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    border: '1px solid transparent',
    background: dark ? '#34343A' : colors.BGLight,
    color: dark ? theme.white : colors.B17,
    boxShadow: 'none',
    '&:hover:not(:disabled)': {
      background: dark ? '#34343A' : colors.BGLight,
      filter: 'brightness(0.9)',
    },
  };
};

export default createStyles(
  (
    theme: MantineTheme,
    { disabled, inherit, variant, pulse }: { disabled: boolean; inherit: boolean; variant?: string; pulse?: boolean },
    getRef
  ) => {
    const loading = getRef('loading');
    let overrides = {};
    if (variant === 'outline') {
      overrides = getOutlineStyles(theme);
    }

    if (variant === 'subtle') {
      overrides = getSubtleStyles(theme);
    }

    if (variant === 'light') {
      overrides = getLightStyles(theme);
    }

    if (pulse) {
      overrides = { ...overrides, ...getPulseStyles() };
    }

    return {
      label: getLabelStyles(disabled, variant),
      root: {
        backgroundImage: colors.horizontal,
        width: inherit ? '100%' : '',
        [`&:not(.${loading}):disabled`]: {
          boxShadow: 'none',
        },
        '&&:hover': {
          backgroundSize: '100%',
        },
        '&:focus': {
          outlineOffset: 0,
          outline: '2px solid rgb(153,200,255)',
        },
        ...overrides,
      },
    };
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getGradient(color))
 - getLabelStyles(disabled: boolean, variant?: string): any)
 - getOutlineStyles(theme))
 - getSubtleStyles(theme))
 - getPulseStyles())
 - getLightStyles(theme))
Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/button/Button.tsx
Tamaño: 1695 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { forwardRef, MouseEventHandler } from 'react';
import { Button as MantineButton, ButtonProps, Sx } from '@mantine/core';

import useStyles from './Button.styles';

export type Size = 'xs' | 'md' | 'lg' | undefined;

export interface IButtonProps extends ButtonProps {
  id?: string;
  loading?: boolean;
  size?: Size;
  variant?: 'outline' | 'gradient' | 'subtle' | 'light';
  disabled?: boolean;
  icon?: React.ReactNode;
  fullWidth?: boolean;
  submit?: boolean;
  onClick?: (e: any) => void;
  onMouseEnter?: MouseEventHandler<any>;
  onMouseLeave?: MouseEventHandler<any>;
  inherit?: boolean;
  pulse?: boolean;
  sx?: Sx;
  iconPosition?: 'left' | 'right';
}

/**
 * Button component
 *
 */
export const Button = forwardRef<HTMLButtonElement, IButtonProps>(
  (
    {
      id,
      loading,
      children,
      submit = false,
      icon,
      size = 'md',
      fullWidth,
      disabled = false,
      inherit = false,
      onClick,
      variant = 'gradient',
      pulse,
      iconPosition = 'left',
      ...props
    },
    buttonRef
  ) => {
    const { classes } = useStyles({ disabled, inherit, variant, pulse });
    const withIconProps = icon ? (iconPosition === 'left' ? { leftIcon: icon } : { rightIcon: icon }) : {};

    return (
      <MantineButton
        id={id}
        ref={buttonRef}
        radius="md"
        classNames={classes}
        {...withIconProps}
        type={submit ? 'submit' : 'button'}
        onClick={onClick}
        disabled={disabled}
        size={size}
        loading={loading}
        fullWidth={fullWidth}
        variant={variant}
        {...props}
      >
        {children}
      </MantineButton>
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { forwardRef, MouseEventHandler } from 'react';
import { Button as MantineButton, ButtonProps, Sx } from '@mantine/core';
import useStyles from './Button.styles';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/button/PlusButton.tsx
Tamaño: 669 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';

import { Button, IButtonProps } from './Button';
import { Text } from '../typography/text/Text';
import { PlusFilled } from '../icons';

interface PlusButtonProps extends IButtonProps {
  isGradient?: boolean;
  label: string;
}

const ButtonStyled = styled(Button)`
  padding: 0;
`;

export function PlusButton({ label, isGradient = true, onClick, disabled = false, ...rest }: PlusButtonProps) {
  return (
    <ButtonStyled id="add-provider" onClick={onClick} disabled={disabled} variant="subtle" {...rest}>
      <PlusFilled width={24} height={24} />
      <Text gradient={isGradient}>{label}</Text>
    </ButtonStyled>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { Button, IButtonProps } from './Button';
import { Text } from '../typography/text/Text';
import { PlusFilled } from '../icons';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/cards/CardTile.tsx
Tamaño: 1261 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';

export const CardTile = styled.button(() => {
  const theme = useMantineTheme();

  return `
  outline: none;
  border: none;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
  min-width: 140px;
  width: 140px;
  height: 100px;
  border-radius: 8px;
  color: ${colors.B60};
  background: ${theme.colorScheme === 'dark' ? colors.B20 : colors.B98};
  box-shadow: ${shadows.dark};
  font-size: 14px;
  transition: all 0.25s ease;

  > svg {
    font-size: 20px;
  }

  &:disabled {
    cursor: not-allowed;
  }

  &:not(:disabled)&:hover {
    color: ${theme.colorScheme === 'dark' ? colors.white : colors.B60};
    background: ${theme.colorScheme === 'dark' ? colors.B30 : colors.BGLight};
  }

  &[data-can-be-hidden='true'] {
    &:nth-last-of-type(2) {
      display: none;
    }

    @media screen and (min-width: 1369px) {
      &:nth-last-of-type(2) {
        display: flex;
      }
    }
  }

  @media screen and (min-width: 1281px) {
    min-width: 160px;
    width: 160px;
    height: 120px;

    > svg {
      font-size: 24px;
    }
  }
`;
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';
export const CardTile = styled.button(() => {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/cards/Cards.tsx
Tamaño: 3621 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { useNavigate } from 'react-router-dom';
import { Grid, Stack, useMantineColorScheme } from '@mantine/core';
import styled from '@emotion/styled';

import { When } from '../when';
import { colors, shadows } from '../config';
import { Text } from '../typography/text/Text';

interface ICardCell {
  navIcon?: (props: React.ComponentPropsWithoutRef<'svg'>) => JSX.Element | React.ReactNode;
  description?: React.ReactNode | string;
  navigateTo?: string;
  onClick?: React.MouseEventHandler<HTMLButtonElement>;
  imagePath?: string;
  href?: string;
  disabled?: boolean;
  testId?: string;
}

export function Cards({ cells }: { cells: ICardCell[] }) {
  const spanNumber = 12 / cells.length;

  return (
    <Grid sx={{ justifyContent: 'center' }}>
      {cells.map((cell, index) => (
        <Grid.Col span={spanNumber} key={index} sx={{ maxWidth: 'initial' }}>
          <Card cell={cell} key={index} />
        </Grid.Col>
      ))}
    </Grid>
  );
}

function Card({ cell }: { cell: ICardCell }) {
  const { colorScheme } = useMantineColorScheme();
  const navigate = useNavigate();

  const NavIcon = cell.navIcon
    ? (cell.navIcon as (props: React.ComponentPropsWithoutRef<'svg'>) => JSX.Element)
    : undefined;
  const cardWithIconAndDescription = cell.navIcon;
  const cardWithImage = cell.imagePath;
  const onlyDescription = !cell.imagePath && !cell.navIcon && cell.description;
  const alt = cell.imagePath?.split('/').pop();
  const frameworkName = getFrameworkName(alt);

  const handleOnClick: React.MouseEventHandler<HTMLButtonElement> = (e) => {
    if (cell.onClick) {
      cell.onClick?.(e);

      return;
    }

    if (cell.navigateTo) {
      navigate(cell.navigateTo);
    }
  };

  return (
    <StyledCard
      dark={colorScheme === 'dark'}
      onClick={handleOnClick}
      disabled={cell.disabled}
      data-test-id={cell.testId}
    >
      <When truthy={onlyDescription}>
        <Text mt={10} size={'lg'}>
          {cell.description ?? ''}
        </Text>
      </When>

      <When truthy={cardWithIconAndDescription}>
        {NavIcon ? <NavIcon style={{ height: '50px', width: '50px' }} /> : null}
        <Text mt={10} size={'lg'}>
          {cell.description ?? ''}
        </Text>
      </When>

      <When truthy={cardWithImage}>
        <Stack align="center">
          <img src={cell.imagePath} alt={alt} />
          <span style={{ fontSize: '20px', textTransform: 'capitalize' }}>{frameworkName}</span>
        </Stack>
      </When>
    </StyledCard>
  );
}

function getFrameworkName(alt) {
  const framework = alt?.replace('.png', '');

  return framework === 'js' ? 'JS' : framework;
}

const StyledCard = styled.button<{ dark: boolean }>`
  outline: none;
  border: none;
  cursor: pointer;
  background-color: ${({ dark }) => (dark ? colors.B17 : colors.B98)};
  border-radius: 7px;
  height: 180px;
  min-width: 240px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  transition:
    background-color 0.25s ease,
    box-shadow 0.25s ease;

  &:disabled {
    cursor: not-allowed;
  }

  &:not(:disabled):hover {
    cursor: pointer;
    ${({ dark }) =>
      dark
        ? `
            background-color: ${colors.B20};
            box-shadow: ${shadows.dark};
          `
        : `
            background-color: ${colors.BGLight};
            box-shadow: ${shadows.light};
          `};
  }

  opacity: 0;
  transform: translateY(20px);
  animation: showUp 0.3s ease-out forwards;

  @keyframes showUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { useNavigate } from 'react-router-dom';
import { Grid, Stack, useMantineColorScheme } from '@mantine/core';
import styled from '@emotion/styled';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/cards/index.ts
Tamaño: 72 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { Cards } from './Cards';
export { CardTile } from './CardTile';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/checkbox/Checkbox.stories.tsx
Tamaño: 867 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Group } from '@mantine/core';
import { Checkbox } from './Checkbox';

export default {
  title: 'Components/Checkbox',
  component: Checkbox,
  argTypes: {},
} as Meta<typeof Checkbox>;

const Template: StoryFn<typeof Checkbox> = ({ ...args }) => <Checkbox {...args} />;

export const Default = Template.bind({});
Default.args = {
  label: 'Checkbox Label',
};

export const States = () => (
  <Group style={{ display: 'flex', flexDirection: 'column', alignItems: 'unset' }}>
    <Checkbox label="Checked checkbox" checked />
  </Group>
);

export const Disabled = () => (
  <Group style={{ display: 'flex', flexDirection: 'column', alignItems: 'unset' }}>
    <Checkbox label="Checked checkbox" checked disabled />
    <Checkbox label="Checked checkbox" disabled />
  </Group>
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Group } from '@mantine/core';
import { Checkbox } from './Checkbox';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/checkbox/Checkbox.styles.ts
Tamaño: 1089 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors } from '../config';

export default createStyles<string, { disabled: boolean }>((theme, _params, getRef) => {
  const dark = theme.colorScheme === 'dark';
  const label = getRef('label');

  return {
    icon: {
      color: 'white',
    },
    input: {
      backgroundColor: 'transparent',
      border: `1px solid ${theme.colors.gray[7]}`,
      '&:checked': {
        backgroundImage: colors.horizontal,
        color: dark ? 'white' : colors.B40,
        border: 'transparent',
        [`& + .${label}`]: {
          fontWeight: 'bold !important',
        },
        '&:disabled': {
          opacity: '0.45',
          '& + svg': {
            color: 'white',
            opacity: '0.45',
          },
        },
      },
      '&:disabled': {
        backgroundColor: 'transparent',
      },
    },
    label: {
      ref: label,
      color: dark ? 'white' : colors.B40,
      fontSize: '14px',
      padding: '0',
      margin: '0 10px',
      opacity: _params.disabled ? 0.4 : 1,
    },
  } as any;
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/checkbox/Checkbox.tsx
Tamaño: 812 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEvent } from 'react';
import { Checkbox as MantineCheckbox, CheckboxProps } from '@mantine/core';
import useStyles from './Checkbox.styles';

interface ICheckboxProps extends CheckboxProps {
  checked?: boolean;
  disabled?: boolean;
  label?: React.ReactNode | string;
  onChange?: (event: ChangeEvent<HTMLInputElement>) => void;
}

/**
 * Checkbox Component
 *
 */
export function Checkbox({
  label = 'Default Checkbox',
  checked,
  onChange,
  disabled = false,
  ...props
}: ICheckboxProps) {
  const { classes } = useStyles({ disabled });

  return (
    <MantineCheckbox
      classNames={classes}
      label={label}
      onChange={onChange}
      disabled={disabled}
      size="sm"
      checked={checked}
      {...props}
    />
  );
}

Checkbox.Group = MantineCheckbox.Group;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEvent } from 'react';
import { Checkbox as MantineCheckbox, CheckboxProps } from '@mantine/core';
import useStyles from './Checkbox.styles';
interface ICheckboxProps extends CheckboxProps {
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/color-input/ColorInput.stories.tsx
Tamaño: 594 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { ColorInput } from './ColorInput';

export default {
  title: 'Inputs/ColorInput',
  component: ColorInput,
  argTypes: {
    value: {
      table: {
        disable: true,
      },
    },
    onChange: {
      table: {
        disable: true,
      },
    },
  },
} as Meta<typeof ColorInput>;

const Template: StoryFn<typeof ColorInput> = ({ ...args }) => <ColorInput {...args} />;

export const PrimaryUse = Template.bind({});
PrimaryUse.args = {
  label: 'Font Color',
  placeholder: 'Pick font color',
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { ColorInput } from './ColorInput';
export default {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/color-input/ColorInput.tsx
Tamaño: 1121 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { ColorInput as MantineColorInput, ColorInputProps } from '@mantine/core';
import { inputStyles } from '../config/inputs.styles';
import { SpacingProps } from '../shared/spacing.props';

const defaultSwatchColors: string[] = [
  '#f47373',
  '#D9E3F0',
  '#697689',
  '#37D67A',
  '#2CCCE4',
  '#DCE775',
  '#FF8A65',
  '#BA68C8',
  '#555555',
];

interface IColorInputProps extends SpacingProps {
  label?: React.ReactNode;
  error?: string;
  placeholder?: string;
  value?: string;
  description?: string;
  disallowInput?: boolean;
  onChange?: (color: string) => void;
}

/**
 * ColorPicker component
 *
 */
export const ColorInput = React.forwardRef<HTMLInputElement, IColorInputProps>(
  ({ value, onChange, ...props }: IColorInputProps, ref) => {
    const defaultDesign = { radius: 'md', size: 'md', disallowInput: true, styles: inputStyles } as ColorInputProps;

    return (
      <MantineColorInput
        ref={ref}
        swatches={defaultSwatchColors}
        {...defaultDesign}
        onChange={onChange}
        value={value}
        {...props}
      />
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { ColorInput as MantineColorInput, ColorInputProps } from '@mantine/core';
import { inputStyles } from '../config/inputs.styles';
import { SpacingProps } from '../shared/spacing.props';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/ColorScheme.ts
Tamaño: 44 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export type ColorScheme = 'light' | 'dark';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/getColorScheme.ts
Tamaño: 958 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ColorScheme } from './ColorScheme';
import { getColorSchemeHtmlElement } from './getColorSchemeHtmlElement';

const DEFAULT_COLOR_SCHEME: ColorScheme = 'light';

/**
 * Gets the user's preferred color scheme according to their browser settings.
 * @returns ColorScheme
 */
export const getBrowserColorScheme = (): ColorScheme => {
  return window?.matchMedia?.(`(prefers-color-scheme: dark)`)?.matches ? 'dark' : DEFAULT_COLOR_SCHEME;
};

/**
 * Get the current color scheme of the application based on the application html.
 * @returns ColorScheme
 */
export const getCurrentColorScheme = (): ColorScheme => {
  const htmlElem = getColorSchemeHtmlElement();

  // fallback to browser preferences if there isn't an html element
  if (!htmlElem?.classList) {
    return getBrowserColorScheme();
  }

  return htmlElem.classList.contains('dark')
    ? 'dark'
    : htmlElem.classList.contains('light')
      ? 'light'
      : DEFAULT_COLOR_SCHEME;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getBrowserColorScheme(): ColorScheme)
 - getCurrentColorScheme(): ColorScheme)
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/getColorSchemeHtmlElement.ts
Tamaño: 463 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/** Get the innermost <html> element that serves as the basis for our theme */
export const getColorSchemeHtmlElement = (): HTMLHtmlElement | null => {
  /**
   * Avoid issues with multiple `html` elements (like in Storybook) by getting all html elements
   * and taking the innermost one
   */
  const htmlElements = document.querySelectorAll('html');

  if (!htmlElements?.length) {
    return null;
  }

  return htmlElements.item(htmlElements.length - 1);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getColorSchemeHtmlElement(): HTMLHtmlElement | null)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/index.ts
Tamaño: 146 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './ColorScheme';
export * from './mapThemeStatusToColorScheme';
export * from './useColorScheme';
export * from './getColorScheme';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/mapThemeStatusToColorScheme.ts
Tamaño: 683 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { ColorSchemePreferenceEnum } from '../hooks/useLocalThemePreference';
import { ColorScheme } from './ColorScheme';

const COLOR_SCHEME_PREFERENCE_TO_COLOR_SCHEME_MAP: Record<ColorSchemePreferenceEnum, ColorScheme | null> = {
  [ColorSchemePreferenceEnum.LIGHT]: 'light',
  [ColorSchemePreferenceEnum.DARK]: 'dark',
  [ColorSchemePreferenceEnum.SYSTEM]: null,
};

/**
 * Determine which theme status correlates with which ColorScheme.
 */
export const mapThemeStatusToColorScheme = (
  themeStatus: ColorSchemePreferenceEnum,
  preferredColorScheme: ColorScheme
): ColorScheme => {
  return COLOR_SCHEME_PREFERENCE_TO_COLOR_SCHEME_MAP[themeStatus] ?? preferredColorScheme;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - mapThemeStatusToColorScheme(themeStatus: ColorSchemePreferenceEnum,
  preferredColorScheme: ColorScheme
): ColorScheme)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/color-scheme/useColorScheme.ts
Tamaño: 1867 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useState, useEffect, useCallback } from 'react';
import { useColorScheme as useMantineColorScheme } from '@mantine/hooks';
import { useLocalThemePreference, ColorSchemePreferenceEnum } from '../hooks/useLocalThemePreference';
import { ColorScheme } from './ColorScheme';
import { mapThemeStatusToColorScheme } from './mapThemeStatusToColorScheme';
import { getColorSchemeHtmlElement } from './getColorSchemeHtmlElement';

/**
 * Handle behavior for changing ColorSchemes or ThemeStatuses.
 *
 * NOTE: This is not intended for getting the color scheme in application code:
 * - For styling with Panda, use _dark or _light to create CSS targeted at a specific color scheme.
 */
export const useColorScheme = () => {
  const { themeStatus, setThemeStatus } = useLocalThemePreference();
  const preferredColorScheme = useMantineColorScheme();
  const [colorScheme, _setColorScheme] = useState<ColorScheme>(preferredColorScheme);

  const setColorScheme = useCallback(
    (newColorScheme: ColorScheme) => {
      const htmlElem = getColorSchemeHtmlElement();
      if (!htmlElem) {
        return;
      }

      htmlElem.className = newColorScheme;
      _setColorScheme(newColorScheme);
    },
    [_setColorScheme]
  );

  const toggleColorScheme = () => {
    switch (themeStatus) {
      case ColorSchemePreferenceEnum.SYSTEM:
        setThemeStatus(ColorSchemePreferenceEnum.LIGHT);
        break;
      case ColorSchemePreferenceEnum.LIGHT:
        setThemeStatus(ColorSchemePreferenceEnum.DARK);
        break;
      default:
        setThemeStatus(ColorSchemePreferenceEnum.SYSTEM);
        break;
    }
  };

  useEffect(() => {
    setColorScheme(mapThemeStatusToColorScheme(themeStatus, preferredColorScheme));
  }, [themeStatus, preferredColorScheme, setColorScheme]);

  return {
    colorScheme,
    toggleColorScheme,
    setColorScheme,
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useColorScheme())
 - setColorScheme(useCallback(
    (newColorScheme: ColorScheme))
 - toggleColorScheme())
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/colors.ts
Tamaño: 1381 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/** @deprecated: Please only use values via Panda CSS defined via tokens. If the color doesn't exist, please contact Design. */
const gradientStart = '#FF512F';
/** @deprecated: Please only use values via Panda CSS defined via tokens. If the color doesn't exist, please contact Design. */
const gradientEnd = '#DD2476';
/** @deprecated: Please only use values via Panda CSS defined via tokens. If the color doesn't exist, please contact Design. */
const error = '#E54545';

/** @deprecated: Please only use values via Panda CSS defined via tokens. If the color doesn't exist, please contact Design. */
export const colors = {
  white: '#FFFFFF',
  black: '#000000',
  BGLight: '#EDF0F2',
  BGDark: '#13131A',
  B98: '#F5F8FA',
  B85: '#D5D5D9',
  B80: '#BEBECC',
  B70: '#A1A1B2',
  B60: '#828299',
  B40: '#525266',
  B30: '#3D3D4D',
  B20: '#292933',
  B15: '#1E1E26',
  B17: '#23232B',
  gradientStart,
  gradientEnd,
  success: '#4D9980',
  warning: '#FF8000',
  error,
  vertical: `linear-gradient(0deg, ${gradientStart} 0%, ${gradientEnd} 100%)`,
  horizontal: `linear-gradient(99deg, ${gradientEnd} 0% 0%, ${gradientStart} 100% 100%)`,
  disabled: 'linear-gradient(90deg, #F5C4D8 0%, #FFCBC1 100%)',
  darkDisabled: 'linear-gradient(90deg, #58203E 0%, #612E29 100%)',
  errorGradient: `linear-gradient(0deg, ${error}33 0%, ${error}33 100%)`,
  gradientMiddle: '#ef3f5a',
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/helper.ts
Tamaño: 204 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * It takes a color and returns a gradient
 * @param color - The color you want to use for the gradient.
 */
export const getGradient = (color) => `linear-gradient(0deg, ${color} 0%, ${color} 100%)`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getGradient(color))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/index.ts
Tamaño: 72 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { colors } from './colors';
export { shadows } from './shadows';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/inputs.styles.ts
Tamaño: 1850 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MantineTheme } from '@mantine/core';
import { colors } from './colors';

export const INPUT_HEIGHT_PX = 50;

export const inputStyles = (theme: MantineTheme) => {
  const dark = theme.colorScheme === 'dark';

  const primaryColor = dark ? theme.white : theme.colors.gray[8];
  const invalidColor = colors.vertical;
  const secondaryColor = dark ? theme.colors.dark[3] : theme.colors.gray[6];

  return {
    rightSection: {
      color: `${theme.colors.gray[7]} !important`,
    },
    input: {
      minHeight: `${INPUT_HEIGHT_PX}px`,
      borderRadius: '7px',
      borderColor: dark ? theme.colors.dark[5] : theme.colors.gray[5],
      backgroundColor: 'transparent',
      color: primaryColor,
      margin: '5px 0px',
      '&:focus, &:focus-within': {
        borderColor: theme.colors.gray[7],
      },
      '&::placeholder': {
        color: secondaryColor,
      },
      '&:focus&:invalid': {
        borderColor: colors.error,
      },
    },
    label: {
      color: primaryColor,
      fontWeight: 700,
      fontSize: '14px',
      lineHeight: '17px',
      margin: '5px 0px',
    },
    invalid: {
      borderColor: invalidColor,
      color: primaryColor,
      '&::placeholder': {
        color: secondaryColor,
      },
    },
    error: {
      color: `${invalidColor} !important`,
      fontSize: '12px',
    },
    description: {
      color: `${secondaryColor} !important`,
      fontSize: `14px !important`,
      fontWeight: 400,
      marginTop: '0px',
      marginBottom: '10px',
      lineHeight: '17px',
    },
    disabled: {
      backgroundColor: `${dark ? colors.B20 : colors.B98} !important`,
      borderColor: `${dark ? colors.B30 : colors.BGLight} !important`,
      color: `${primaryColor} !important`,
      '&::placeholder': {
        color: `${secondaryColor} !important`,
      },
    },
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - inputStyles(theme: MantineTheme))
Declaraciones 'export' encontradas:
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/shadows.ts
Tamaño: 353 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/** @deprecated: Please only use values via Panda CSS defined via tokens. If the color doesn't exist, please contact Design. */
export const shadows = {
  light: '0px 5px 15px rgba(38, 68, 128, 0.05)',
  medium: '0px 5px 15px rgba(122, 133, 153, 0.25)',
  dark: '0px 5px 20px rgba(0, 0, 0, 0.2)',
  color: '0px 5px 20px -5px rgba(233, 52, 94, 0.5)',
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/text.styles.ts
Tamaño: 544 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors } from './colors';

export const useTextStyles = createStyles((theme: MantineTheme) => {
  const dark = theme.colorScheme === 'dark';

  const primaryColor = dark ? theme.white : theme.colors.gray[8];

  return {
    heading: {
      color: dark ? theme.white : colors.B40,
    },
    subHeading: {
      color: dark ? colors.B40 : primaryColor,
    },
    separator: {
      borderTopColor: dark ? colors.B20 : colors.BGLight,
      margin: '24px 0',
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useTextStyles(createStyles((theme: MantineTheme))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/config/theme.config.ts
Tamaño: 1232 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MantineThemeOverride } from '@mantine/core';
import { colors, shadows } from '.';

export const mantineConfig: MantineThemeOverride = {
  spacing: { xs: 15, sm: 20, md: 25, lg: 30, xl: 40 },
  fontFamily: 'Lato, sans serif',
  fontSizes: { xs: 10, sm: 12, md: 14, lg: 16, xl: 18 },
  primaryColor: 'gradient',
  defaultGradient: { deg: 99, from: colors.gradientStart, to: colors.gradientEnd },
  radius: { md: 7, xl: 30 },
  lineHeight: '17px',
  shadows: {
    sm: shadows.light,
    md: shadows.medium,
    lg: shadows.dark,
    xl: shadows.color,
  },
  colors: {
    gray: [
      colors.BGLight,
      '#f1f3f5',
      colors.B98,
      '#dee2e6',
      '#ced4da',
      colors.B80,
      colors.B70,
      colors.B60,
      colors.B40,
      colors.B30,
    ],
    dark: [
      colors.white,
      colors.BGLight,
      colors.B80,
      colors.B40,
      colors.B20,
      colors.B30,
      colors.B40,
      colors.B15,
      colors.BGDark,
      colors.B17,
    ],
    gradient: ['', '', '', '', '', colors.error, colors.horizontal, colors.vertical, colors.horizontal, ''],
  },
  headings: {
    fontFamily: 'Lato, sans-serif',
    sizes: {
      h1: { fontSize: 26 },
      h2: { fontSize: 20 },
    },
  },
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/container/Container.tsx
Tamaño: 608 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { Container as MantineContainer, ContainerProps } from '@mantine/core';
import { colors, shadows } from '../config';

/**
 * Container component
 *
 */
export function Container({ children, ...props }: ContainerProps) {
  return (
    <MantineContainer
      sx={(theme) => ({
        padding: '0px',
        borderRadius: '7px',
        boxShadow: theme.colorScheme === 'dark' ? shadows.dark : shadows.light,
        backgroundColor: theme.colorScheme === 'dark' ? colors.B15 : colors.white,
      })}
      {...props}
    >
      {children}
    </MantineContainer>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { Container as MantineContainer, ContainerProps } from '@mantine/core';
import { colors, shadows } from '../config';
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/dots-navigation/DotsNavigation.tsx
Tamaño: 1957 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import React from 'react';
import { colors } from '../config';

const DotsNavigationHolder = styled.ul`
  position: relative;
  display: inline-block;
  margin: 0;
  padding: 0;
  list-style: none;
  cursor: default;
  user-select: none;
`;

const DotNavigationItem = styled.li`
  position: relative;
  display: block;
  float: left;
  margin: 0 8px;
  width: 8px;
  height: 8px;
  cursor: pointer;
`;

const DotCircleItem = styled.span<{ isCurrent: boolean }>`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  outline: none;
  border-radius: 50%;
  cursor: pointer;
  overflow: hidden;
  background-color: transparent;
  box-shadow: ${({ theme }) =>
    theme.colorScheme === 'dark' ? `inset 0 0 0 1px ${colors.white}` : `inset 0 0 0 1px ${colors.B60}`};
  transition: opacity 0.3s ease;

  &:after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    border-radius: 50%;
    background-color: ${({ theme }) => (theme.colorScheme === 'dark' ? colors.white : colors.B60)};
    transform: ${({ isCurrent }) => (isCurrent ? 'scale(1)' : 'scale(0)')};
    transform-origin: 50% 50%;
    transition: transform 0.3s ease;
  }

  &:hover,
  &:focus {
    opacity: 0.7;
  }
`;

export const DotsNavigation = ({
  selectedIndex,
  size,
  className,
  testId,
  onClick,
}: {
  selectedIndex: number;
  size: number;
  className?: string;
  testId?: string;
  onClick?: (index: number, e: React.MouseEvent<HTMLLIElement>) => void;
}) => {
  return (
    <DotsNavigationHolder className={className} data-test-id={testId}>
      {Array.from({ length: size }).map((_, index) => (
        <DotNavigationItem
          key={`dot-${index}`}
          onClick={(e) => {
            onClick?.(index, e);
          }}
        >
          <DotCircleItem isCurrent={index === selectedIndex} />
        </DotNavigationItem>
      ))}
    </DotsNavigationHolder>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import React from 'react';
import { colors } from '../config';
const DotsNavigationHolder = styled.ul`
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/dots-navigation/index.ts
Tamaño: 51 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { DotsNavigation } from './DotsNavigation';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/dropdown/Dropdown.styles.ts
Tamaño: 981 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';

export default createStyles((theme: MantineTheme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    arrow: {
      width: '7px',
      height: '7px',
      backgroundColor: dark ? colors.B20 : colors.white,
      border: 'none',
    },
    dropdown: {
      backgroundColor: dark ? colors.B20 : colors.white,
      color: dark ? theme.white : colors.B40,
      border: 'none',
      boxShadow: shadows.dark,
    },
    item: {
      borerRadius: '5px',
      color: `${dark ? theme.white : colors.B40} !important`,
      fontWeight: 400,
      fontSize: '14px',
      '&[data-critical]': { '&:hover': { color: `${colors.error} !important` } },
    },
    itemHovered: {
      backgroundColor: dark ? colors.B30 : colors.B98,
    },
    divider: {
      margin: '10px',
      borderTop: `0.0625rem solid ${dark ? colors.B30 : colors.BGLight}`,
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/dropdown/Dropdown.tsx
Tamaño: 1191 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { Menu, MenuProps } from '@mantine/core';

import useStyles from './Dropdown.styles';
import { shadows } from '../config';

export interface IDropdownProps
  extends Pick<
    MenuProps,
    | 'withArrow'
    | 'opened'
    | 'offset'
    | 'position'
    | 'onOpen'
    | 'onClose'
    | 'withinPortal'
    | 'middlewares'
    | 'disabled'
    | 'width'
    | 'styles'
    | 'zIndex'
  > {
  control: React.ReactNode;
  children: React.ReactNode;
}

export function Dropdown({ control, withArrow = true, offset = 10, children, ...props }: IDropdownProps) {
  const { classes, theme } = useStyles();

  return (
    <Menu
      withArrow={withArrow}
      transitionDuration={0}
      radius={7}
      offset={offset}
      shadow={theme.colorScheme === 'dark' ? shadows.dark : shadows.light}
      classNames={classes}
      clickOutsideEvents={['click', 'mousedown', 'touchstart']}
      middlewares={{ flip: false, shift: false }}
      {...props}
    >
      <Menu.Target>{control}</Menu.Target>
      <Menu.Dropdown>{children}</Menu.Dropdown>
    </Menu>
  );
}

Dropdown.Item = Menu.Item;
Dropdown.Label = Menu.Label;
Dropdown.Divider = Menu.Divider;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { Menu, MenuProps } from '@mantine/core';
import useStyles from './Dropdown.styles';
import { shadows } from '../config';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/hooks/useDataRef.ts
Tamaño: 148 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useRef } from 'react';

export const useDataRef = <T>(data: T) => {
  const ref = useRef<T>(data);
  ref.current = data;

  return ref;
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useDataRef(<T>(data: T))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/hooks/useKeyDown.ts
Tamaño: 480 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useEffect } from 'react';
import { useDataRef } from './useDataRef';

export const useKeyDown = (key: string, callback: () => void) => {
  const callbackRef = useDataRef(callback);

  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === key) {
        callbackRef.current();
      }
    };

    document.addEventListener('keydown', handleKeyDown);

    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [callbackRef, key]);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useKeyDown(key: string, callback: ())
 - callbackRef(useDataRef(callback);

  useEffect(())
 - handleKeyDown(e))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/hooks/useLocalThemePreference.ts
Tamaño: 775 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useLocalStorage } from '@mantine/hooks';

const STORAGE_KEY = 'mantine-theme';
const DEFAULT_THEME_TITLE = 'Match System Appearance';

export enum ColorSchemePreferenceEnum {
  DARK = 'dark',
  LIGHT = 'light',
  SYSTEM = 'system',
}

export const THEME_TITLE_LOOKUP: Record<ColorSchemePreferenceEnum, string> = {
  [ColorSchemePreferenceEnum.DARK]: 'Dark Theme',
  [ColorSchemePreferenceEnum.LIGHT]: 'Light Theme',
  [ColorSchemePreferenceEnum.SYSTEM]: DEFAULT_THEME_TITLE,
};

export function useLocalThemePreference() {
  const [themeStatus, setThemeStatus] = useLocalStorage<ColorSchemePreferenceEnum>({
    key: STORAGE_KEY,
    defaultValue: ColorSchemePreferenceEnum.DARK,
    getInitialValueInEffect: true,
  });

  return { themeStatus, setThemeStatus };
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - useLocalThemePreference()
Declaraciones 'export' encontradas:
- export  enum
- export  const
- export function useLocalThemePreference

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/hover-card/HoverCard.tsx
Tamaño: 328 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { HoverCard as MantineHoverCard, HoverCardProps } from '@mantine/core';

/**
 * HoverCard component
 */
export function HoverCard(props: HoverCardProps) {
  return <MantineHoverCard transition="fade" radius="md" {...props} />;
}
HoverCard.Target = MantineHoverCard.Target;
HoverCard.Dropdown = MantineHoverCard.Dropdown;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { HoverCard as MantineHoverCard, HoverCardProps } from '@mantine/core';
/**
* HoverCard component
*/
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/Icons.stories.tsx
Tamaño: 1641 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { useState } from 'react';
import { Group, Code, ActionIcon, Text, Grid } from '@mantine/core';
import * as allIcons from '.';
import { Input } from '../input/Input';

export default {
  title: 'Icons/Icons',
  parameters: {
    controls: { hideNoControlsWarning: true },
    viewMode: 'canvas',
    previewTabs: {
      'storybook/docs/panel': {
        hidden: true,
      },
    },
  },
  argTypes: {},
};

export const Icons = () => {
  const [search, setSearch] = useState('');
  const [iconName, setIconName] = useState('IconName');

  return (
    <div style={{ width: '100%', margin: 'auto' }}>
      <Input label="Search Icon" placeholder="Search" value={search} onChange={(e) => setSearch(e.target.value)} />
      <Grid align="center" gutter="xs" style={{ padding: '10px', paddingTop: '20px', paddingBottom: '20px' }}>
        {Object.entries(allIcons).map(([name, Icon]) => {
          if (name.includes(search.toLowerCase())) {
            return (
              <Grid.Col key={name} span={3}>
                <Group align="center" spacing={3}>
                  <ActionIcon variant="transparent" onClick={() => setIconName(name)}>
                    <Icon width="20px" height="20px" />
                  </ActionIcon>
                  <Text align="center" weight={400} size="xs">
                    {name}
                  </Text>
                </Group>
              </Grid.Col>
            );
          }

          return null;
        })}
      </Grid>
      <Code block>
        {`
import { ${iconName} } from 'apps/web/src/design-system/icons'
     
<${iconName}/> `}
      </Code>
    </div>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { useState } from 'react';
import { Group, Code, ActionIcon, Text, Grid } from '@mantine/core';
import * as allIcons from '.';
import { Input } from '../input/Input';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/index.ts
Tamaño: 27687 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/**
 * @deprecated
 * Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md"
 *
 * E.g. instead of using <Md10k />, use <Icon10k />
 */
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  AppleIcon,
} from './general/AppleIcon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  AndroidIcon,
} from './general/AndroidIcon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CurlyBrackets,
} from './general/CurlyBrackets';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ActiveLabel,
} from './general/ActiveLabel';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Activity,
} from './general/Activity';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Brand,
} from './general/Brand';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Buildings,
} from './general/Buildings';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Team,
} from './general/Team';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Settings,
} from './general/Settings';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Bolt,
} from './general/Bolt';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Moon,
} from './general/Moon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Ellipse,
} from './general/Ellipse';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DotsHorizontal,
} from './general/DotsHorizontal';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DotsHorizontalOutlined,
} from './general/DotsHorizontalOutlined';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Drag,
} from './general/Drag';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  EyeShield,
} from './general/EyeShield';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  MusicNote,
} from './general/MusicNote';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Sun,
} from './general/Sun';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Wifi,
} from './general/Wifi';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Lock,
} from './general/Lock';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Bell,
} from './general/Bell';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Mail,
} from './general/Mail';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Trash,
} from './general/Trash';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Check,
} from './general/Check';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  TextAlignment,
} from './general/TextAlignment';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CheckCircle,
} from './general/CheckCircle';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Box,
} from './general/Box';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CheckCircleOutlined,
} from './general/CheckCircleOutlined';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Repeat,
} from './general/Repeat';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Sms,
} from './general/Sms';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Mobile,
} from './general/Mobile';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  NovuIcon,
} from './general/NovuIcon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Folder,
} from './general/Folder';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Workflow,
} from './general/Workflow';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  EmptySearch,
} from './general/EmptySearch';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ErrorIcon,
} from './general/ErrorIcon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Chat,
} from './general/Chat';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  InApp,
} from './general/InApp';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  InfoCircle,
} from './general/InfoCircle';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Timer,
} from './general/Timer';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Digest,
} from './general/Digest';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Sent,
} from './general/Sent';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Received,
} from './general/Received';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Read,
} from './general/Read';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Seen,
} from './general/Seen';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Clicked,
} from './general/Clicked';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Camera,
} from './general/Camera';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Avatar,
} from './general/Avatar';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DigestGradient,
} from './general/DigestGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Clock,
} from './general/Clock';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  LetterOpened,
} from './general/LetterOpened';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BellWithNotification,
} from './general/BellWithNotification';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CountdownTimer,
} from './general/CountdownTimer';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Discord,
} from './general/Discord';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  User,
} from './general/User';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Playground,
} from './general/Playground';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  RemoveCircle,
} from './general/RemoveCircle';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ViewportWide,
} from './general/ViewportWide';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  WarningIcon,
} from './general/WarningIcon';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  MadeByNovu,
} from './general/MadeByNovu';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Pencil,
} from './general/Pencil';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  WorkflowSettings,
} from './general/WorkflowSettings';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BuildWorkflow,
} from './general/BuildWorkflow';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  RunTestBell,
} from './general/RunTestBell';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  QuickGuide,
} from './general/QuickGuide';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  RightArrow,
} from './general/RightArrow';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ReactLogo,
} from './general/ReactLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  AngularLogo,
} from './general/AngularLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  JavaScriptLogo,
} from './general/JavaScriptLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  VueLogo,
} from './general/VueLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  IframeLogo,
} from './general/IframeLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Star,
} from './general/Star';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  StarEmpty,
} from './general/StarEmpty';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  NovuLogo,
} from './general/NovuLogo';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DigestAction,
} from './general/DigestAction';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  InAppFilled,
} from './general/InAppFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  EmailFilled,
} from './general/EmailFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  SmsFilled,
} from './general/SmsFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChatFilled,
} from './general/ChatFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PushFilled,
} from './general/PushFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BoltFilled,
} from './general/BoltFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BoltOffFilled,
} from './general/BoltOffFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Question,
} from './general/Question';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ProviderMissing,
} from './general/ProviderMissing';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Calendar,
} from './general/Calendar';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Translate,
} from './general/Translate';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  UserAccess,
} from './general/UserAccess';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  SSO,
} from './general/SSO';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Cloud,
} from './general/Cloud';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Condition,
} from './general/Condition';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  RemoveCondition,
} from './general/RemoveCondition';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Warning,
} from './general/Warning';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  VariantsFile,
} from './general/VariantsFile';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ConditionsFile,
} from './general/ConditionsFile';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Variant,
} from './general/Variant';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Conditions,
} from './general/Conditions';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Logout,
} from './general/Logout';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  InviteMembers,
} from './general/InviteMembers';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Translation,
} from './general/Translation';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  MultiChannel,
} from './general/MultiChannel';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  HalfClock,
} from './general/HalfClock';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  RingingBell,
} from './general/RingingBell';

export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Copy,
} from './actions/Copy';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Close,
} from './actions/Close';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Filter,
} from './actions/Filter';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CloseCircle,
} from './actions/CloseCircle';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PlusCircle,
} from './actions/PlusCircle';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PlusCircleOutlined,
} from './actions/PlusCircleOutlined';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Search,
} from './actions/Search';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Edit,
} from './actions/Edit';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Upload,
} from './actions/Upload';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Invite,
} from './actions/Invite';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PlusFilled,
} from './actions/PlusFilled';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ConditionPlus,
} from './actions/ConditionPlus';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Duplicate,
} from './actions/Duplicate';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PencilOutlined,
} from './actions/PencilOutlined';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  VariantPlus,
} from './actions/VariantPlus';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  NoConditions,
} from './actions/NoConditions';

export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ArrowDown,
} from './arrows/ArrowDown';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DoubleArrowRight,
} from './arrows/DoubleArrowRight';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ArrowLeft,
} from './arrows/ArrowLeft';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ArrowRight,
} from './arrows/ArrowRight';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChevronDown,
} from './arrows/ChevronDown';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChevronLeft,
} from './arrows/ChevronLeft';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChevronRight,
} from './arrows/ChevronRight';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChevronUp,
} from './arrows/ChevronUp';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CircleArrowRight,
} from './arrows/CircleArrowRight';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChevronPlainDown,
} from './arrows/ChevronPlainDown';

export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ArrowLeftGradient,
} from './gradient/ArrowLeftGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BellGradient,
} from './gradient/BellGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  MailGradient,
} from './gradient/MailGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  MobileGradient,
} from './gradient/MobileGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PlusGradient,
} from './gradient/PlusGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  GlobeGradient,
} from './gradient/GlobeGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CompassGradient,
} from './gradient/CompassGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  SmsGradient,
} from './gradient/SmsGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  TapeGradient,
} from './gradient/TapeGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BoltGradient,
} from './gradient/BoltGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ConnectGradient,
} from './gradient/ConnectGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ChatGradient,
} from './gradient/ChatGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CheckCircleBroken,
} from './gradient/CheckCircleBroken';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  EditGradient,
} from './gradient/EditGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  FilterGradient,
} from './gradient/FilterGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  NestedSquares,
} from './gradient/NestedSquares';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Smiley,
} from './gradient/Smiley';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  TurnOnGradient,
} from './gradient/TurnOnGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  LevelsGradient,
} from './gradient/LevelsGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  TimerGradient,
} from './gradient/TimerGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  PageGradient,
} from './gradient/PageGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  ReactGradient,
} from './gradient/ReactGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  AngularGradient,
} from './gradient/AngularGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  VueGradient,
} from './gradient/VueGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  JsGradient,
} from './gradient/JsGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  CodeGradient,
} from './gradient/CodeGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DisconnectGradient,
} from './gradient/DisconnectGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  BoltOutlinedGradient,
} from './gradient/BoltOutlinedGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  FilterOutlined,
} from './gradient/FilterOutlined';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  TerminalGradient,
} from './gradient/TerminalGradient';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  DelayAction,
} from './gradient/DelayAction';

export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  GitHub,
} from './social/GitHub';
export {
  /** @deprecated - Use https://react-icons.github.io/react-icons/icons/md/ for names with "Icon" instead of "Md" */
  Google,
} from './social/Google';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Close.tsx
Tamaño: 831 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Close(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M13.4844 11.7031L9.53125 7.75L13.4844 3.83984C14.1289 3.15234 14.1289 2.07812 13.4844 1.39062C12.7969 0.746094 11.7227 0.746094 11.0352 1.39062L7.125 5.34375L3.17188 1.39062C2.48438 0.746094 1.41016 0.746094 0.722656 1.39062C0.078125 2.07812 0.078125 3.15234 0.722656 3.83984L4.67578 7.75L0.722656 11.7031C0.078125 12.3906 0.078125 13.4648 0.722656 14.1523C1.41016 14.7969 2.48438 14.7969 3.17188 14.1523L7.125 10.1992L11.0352 14.1523C11.7227 14.7969 12.7969 14.7969 13.4844 14.1523C14.1289 13.4648 14.1289 12.3906 13.4844 11.7031Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Close(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/CloseCircle.tsx
Tamaño: 858 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function CloseCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M8 0.5C3.84375 0.5 0.5 3.875 0.5 8C0.5 12.1562 3.84375 15.5 8 15.5C12.125 15.5 15.5 12.1562 15.5 8C15.5 3.875 12.125 0.5 8 0.5ZM10.5 9.5C10.8125 9.78125 10.8125 10.25 10.5 10.5312C10.2188 10.8438 9.75 10.8438 9.46875 10.5312L8 9.0625L6.5 10.5312C6.21875 10.8438 5.75 10.8438 5.46875 10.5312C5.15625 10.25 5.15625 9.78125 5.46875 9.5L6.9375 8L5.46875 6.53125C5.15625 6.25 5.15625 5.78125 5.46875 5.5C5.75 5.1875 6.21875 5.1875 6.5 5.5L8 6.96875L9.46875 5.5C9.75 5.1875 10.2188 5.1875 10.5 5.5C10.8125 5.78125 10.8125 6.25 10.5 6.53125L9.03125 8L10.5 9.5Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CloseCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/ConditionPlus.tsx
Tamaño: 883 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function ConditionPlus(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <mask
        id="mask0_3918_57495"
        style={{ maskType: 'alpha' }}
        maskUnits="userSpaceOnUse"
        x="0"
        y="0"
        width="16"
        height="16"
      >
        <rect width="16" height="16" fill="currentColor" />
      </mask>
      <g mask="url(#mask0_3918_57495)">
        <path
          d="M6.66667 12V10.6667H9V12H6.66667ZM4 8.66667V7.33333H11V8.66667H4ZM2 5.33333V4H14V5.33333H2Z"
          fill="currentColor"
        />
        <path
          d="M12.5 11.8333V13.8333H13.8333V11.8333H15.8333V10.5H13.8333V8.5H12.5V10.5H10.5V11.8333H12.5Z"
          fill="currentColor"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ConditionPlus(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Copy.tsx
Tamaño: 1172 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Copy(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M21.9997 12.8333H14.4997C13.5792 12.8333 12.833 13.5794 12.833 14.4999V21.9999C12.833 22.9204 13.5792 23.6666 14.4997 23.6666H21.9997C22.9202 23.6666 23.6663 22.9204 23.6663 21.9999V14.4999C23.6663 13.5794 22.9202 12.8333 21.9997 12.8333Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        fillRule="evenodd"
        clipRule="evenodd"
      />
      <path
        d="M9.5 17.8333H8.66667C8.22464 17.8333 7.80072 17.6577 7.48816 17.3452C7.17559 17.0326 7 16.6087 7 16.1667V8.66667C7 8.22464 7.17559 7.80072 7.48816 7.48816C7.80072 7.17559 8.22464 7 8.66667 7H16.1667C16.6087 7 17.0326 7.17559 17.3452 7.48816C17.6577 7.80072 17.8333 8.22464 17.8333 8.66667V9.5"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        fillRule="evenodd"
        clipRule="evenodd"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Copy(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Duplicate.tsx
Tamaño: 965 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Duplicate(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <path
        d="M10.6562 11.75H11.9688V9.34375H14.375V8.03125H11.9688V5.625H10.6562V8.03125H8.25V9.34375H10.6562V11.75ZM6.9375 14.375C6.57656 14.375 6.26758 14.2465 6.01055 13.9895C5.75352 13.7324 5.625 13.4234 5.625 13.0625V4.3125C5.625 3.95156 5.75352 3.64258 6.01055 3.38555C6.26758 3.12852 6.57656 3 6.9375 3H15.6875C16.0484 3 16.3574 3.12852 16.6145 3.38555C16.8715 3.64258 17 3.95156 17 4.3125V13.0625C17 13.4234 16.8715 13.7324 16.6145 13.9895C16.3574 14.2465 16.0484 14.375 15.6875 14.375H6.9375ZM6.9375 13.0625H15.6875V4.3125H6.9375V13.0625ZM4.3125 17C3.95156 17 3.64258 16.8715 3.38555 16.6145C3.12852 16.3574 3 16.0484 3 15.6875V5.625H4.3125V15.6875H14.375V17H4.3125Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Duplicate(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Edit.tsx
Tamaño: 1739 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Edit(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M22.2071 6.32843C22.4174 6.11814 22.7026 6 23 6C23.2974 6 23.5826 6.11814 23.7929 6.32843C24.0032 6.53872 24.1213 6.82393 24.1213 7.12132C24.1213 7.41871 24.0032 7.70392 23.7929 7.91421L14.4888 17.2184L12.3744 17.747L12.903 15.6326L22.2071 6.32843ZM23 4C22.1722 4 21.3783 4.32885 20.7929 4.91421L11.2929 14.4142C11.1647 14.5424 11.0738 14.703 11.0299 14.8788L10.0299 18.8788C9.94466 19.2196 10.0445 19.58 10.2929 19.8284C10.5413 20.0768 10.9018 20.1767 11.2425 20.0915L15.2425 19.0915C15.4184 19.0475 15.5789 18.9566 15.7071 18.8284L25.2071 9.32843C25.7925 8.74307 26.1213 7.94915 26.1213 7.12132C26.1213 6.29349 25.7925 5.49957 25.2071 4.91421C24.6217 4.32885 23.8278 4 23 4ZM7 6.12109C6.20435 6.12109 5.44129 6.43716 4.87868 6.99977C4.31607 7.56238 4 8.32544 4 9.12109V23.1211C4 23.9167 4.31607 24.6798 4.87868 25.2424C5.44129 25.805 6.20435 26.1211 7 26.1211H21C21.7957 26.1211 22.5587 25.805 23.1213 25.2424C23.6839 24.6798 24 23.9167 24 23.1211V16.1211C24 15.5688 23.5523 15.1211 23 15.1211C22.4477 15.1211 22 15.5688 22 16.1211V23.1211C22 23.3863 21.8946 23.6407 21.7071 23.8282C21.5196 24.0157 21.2652 24.1211 21 24.1211H7C6.73478 24.1211 6.48043 24.0157 6.29289 23.8282C6.10536 23.6407 6 23.3863 6 23.1211V9.12109C6 8.85588 6.10536 8.60152 6.29289 8.41399C6.48043 8.22645 6.73478 8.12109 7 8.12109H14C14.5523 8.12109 15 7.67338 15 7.12109C15 6.56881 14.5523 6.12109 14 6.12109H7Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Edit(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Filter.tsx
Tamaño: 1061 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { useMantineTheme } from '@mantine/core';

export function Filter(props: React.ComponentPropsWithoutRef<'svg'>) {
  const theme = useMantineTheme();

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="14" viewBox="0 0 16 14" fill="none" {...props}>
      <path
        d="M0.572302 0.932728L0.572318 0.932736L0.574158 0.928835C0.698017 0.666102 0.959543 0.5 1.25002 0.5H14.75C15.0405 0.5 15.302 0.666102 15.4259 0.928835C15.5502 1.19251 15.5124 1.50201 15.3285 1.72733C15.3285 1.72738 15.3284 1.72743 15.3284 1.72748L9.61307 8.71147L9.50002 8.84962V9.02812V13C9.50002 13.19 9.39351 13.3622 9.22493 13.4457C9.05055 13.5321 8.85 13.5129 8.70068 13.4005L8.70002 13.4L6.70002 11.9L6.70003 11.9L6.69763 11.8982C6.57427 11.8068 6.50002 11.6603 6.50002 11.5V9.02812V8.8496L6.38695 8.71145L0.668828 1.72472C0.668738 1.72461 0.668649 1.7245 0.668559 1.72439C0.486242 1.50046 0.448639 1.18928 0.572302 0.932728Z"
        stroke={theme.colorScheme === 'light' ? 'black' : 'currentColor'}
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { useMantineTheme } from '@mantine/core';
export function Filter(props: React.ComponentPropsWithoutRef<'svg'>) {
const theme = useMantineTheme();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Invite.tsx
Tamaño: 830 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Invite(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M16.9688 2.15625C17.0312 1.78125 16.875 1.40625 16.5625 1.1875C16.2188 0.96875 15.8125 0.96875 15.5 1.15625L1.5 9.15625C1.15625 9.34375 0.96875 9.6875 1 10.0625C1 10.4688 1.25 10.7812 1.59375 10.9375L4.8125 12.2812L13.9688 4.03125L7.1875 12.75C7.0625 12.9062 6.96875 13.125 6.96875 13.3438V16.375C6.96875 16.7188 7.28125 17 7.625 17C7.84375 17 8.0625 16.9062 8.1875 16.7188L9.78125 14.3438L13.5938 15.9375C13.7188 16 13.8438 16 13.9688 16C14.1562 16 14.3125 15.9688 14.4688 15.875C14.75 15.75 14.9375 15.4688 14.9688 15.1562L16.9688 2.15625Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Invite(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/NoConditions.tsx
Tamaño: 495 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const NoConditions = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" {...props}>
      <path
        fill="currentColor"
        d="M13.18 15.083.915 2.817l.95-.95 12.267 12.266-.95.95Zm-2.633-6.416L9.214 7.333h2.783v1.334h-1.45ZM7.214 5.333 5.881 4h8.116v1.333H7.214ZM6.664 12v-1.333h2.667V12H6.664ZM3.997 8.667V7.333h2.767v1.334H3.997Zm-2-3.334V4h1.434v1.333H1.997Z"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const NoConditions = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" {...props}>
<path
fill="currentColor"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/PencilOutlined.tsx
Tamaño: 777 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function PencilOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <path
        d="M3.89535 17C3.61757 17.0556 3.38493 16.9861 3.19743 16.7917C3.00993 16.5972 2.94396 16.3611 2.99952 16.0833L3.77035 12.375L7.60368 16.2292L3.89535 17ZM7.60368 16.2292L3.77035 12.375L12.7287 3.4375C13.0204 3.14583 13.371 3 13.7808 3C14.1905 3 14.5412 3.14583 14.8329 3.4375L16.562 5.14583C16.8537 5.4375 16.9995 5.79167 16.9995 6.20833C16.9995 6.625 16.8537 6.97917 16.562 7.27083L7.60368 16.2292ZM13.7704 4.5L5.64535 12.6458L7.35368 14.3542L15.4995 6.22917L13.7704 4.5Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PencilOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/PlusCircle.tsx
Tamaño: 736 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function PlusCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M8 0.5C3.84375 0.5 0.5 3.875 0.5 8C0.5 12.1562 3.84375 15.5 8 15.5C12.125 15.5 15.5 12.1562 15.5 8C15.5 3.875 12.125 0.5 8 0.5ZM11 8.75H8.75V11C8.75 11.4375 8.40625 11.75 8 11.75C7.5625 11.75 7.25 11.4375 7.25 11V8.75H5C4.5625 8.75 4.25 8.4375 4.25 8C4.25 7.59375 4.5625 7.25 5 7.25H7.25V5C7.25 4.59375 7.5625 4.25 8 4.25C8.40625 4.25 8.75 4.59375 8.75 5V7.25H11C11.4062 7.25 11.75 7.59375 11.75 8C11.75 8.4375 11.4062 8.75 11 8.75Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PlusCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/PlusCircleOutlined.tsx
Tamaño: 986 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function PlusCircleOutlined({
  fillColor,
  ...props
}: React.ComponentPropsWithoutRef<'svg'> & { fillColor?: string }) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <rect x="0.5" y="0.5" width="29" height="29" rx="14.5" fill={fillColor || 'transparent'} />
      <path
        d="M20.6875 14.75C20.6875 14.1484 20.1953 13.6562 19.5938 13.6562H16.0938V10.1562C16.0938 9.55469 15.6016 9.0625 15 9.0625C14.3711 9.0625 13.9062 9.55469 13.9062 10.1562V13.6562H10.4062C9.77734 13.6562 9.3125 14.1484 9.3125 14.75C9.3125 15.3789 9.77734 15.8438 10.4062 15.8438H13.9062V19.3438C13.9062 19.9727 14.3711 20.4375 15 20.4375C15.6016 20.4375 16.0938 19.9727 16.0938 19.3438V15.8438H19.5938C20.1953 15.8438 20.6875 15.3789 20.6875 14.75Z"
        fill="currentColor"
      />
      <rect x="0.5" y="0.5" width="29" height="29" rx="14.5" stroke="currentColor" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PlusCircleOutlined({
fillColor,
...props
}: React.ComponentPropsWithoutRef<'svg'> & { fillColor?: string }) {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/PlusFilled.tsx
Tamaño: 753 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function PlusFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" {...props}>
      <rect width="24" height="24" rx="4" fill="url(#paint0_linear_375_800)" />
      <path
        d="M7.19995 12H16.8M12 7.20001V16.8"
        stroke="white"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_375_800" x1="0" y1="12" x2="24" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PlusFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Search.tsx
Tamaño: 734 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Search(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="15" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M15.8438 15.1562L11.4062 10.75C12.4062 9.59375 13 8.125 13 6.5C13 2.9375 10.0625 0 6.5 0C2.90625 0 0 2.9375 0 6.5C0 10.0938 2.90625 13 6.5 13C8.09375 13 9.5625 12.4375 10.7188 11.4375L15.125 15.875C15.2188 15.9688 15.3438 16 15.5 16C15.625 16 15.75 15.9688 15.8438 15.875C16.0312 15.6875 16.0312 15.3438 15.8438 15.1562ZM6.5 12C3.4375 12 1 9.5625 1 6.5C1 3.46875 3.4375 1 6.5 1C9.53125 1 12 3.46875 12 6.5C12 9.5625 9.53125 12 6.5 12Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Search(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="15" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/Upload.tsx
Tamaño: 782 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Upload(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M24 18V22C24 22.5304 23.7893 23.0391 23.4142 23.4142C23.0391 23.7893 22.5304 24 22 24H8C7.46957 24 6.96086 23.7893 6.58579 23.4142C6.21071 23.0391 6 22.5304 6 22V18"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path d="M20 11L15 6L10 11" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
      <path d="M15 6V18" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Upload(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/actions/VariantPlus.tsx
Tamaño: 1692 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function VariantPlus(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M8.79981 11.3173V9.64516C8.54104 9.43141 8.30178 9.20525 8.08203 8.96667C7.92648 8.8 7.76814 8.63611 7.60703 8.475C7.44592 8.31389 7.25981 8.15556 7.0487 8C7.20425 7.87778 7.35147 7.75556 7.49036 7.63333C7.62925 7.51111 7.75981 7.38333 7.88203 7.25L6.93203 6.3C6.64314 6.61111 6.3487 6.86111 6.0487 7.05C5.7487 7.23889 5.28759 7.33333 4.66536 7.33333H1.33203L1.33203 8.66667L4.66536 8.66667C5.34314 8.66667 5.83481 8.77778 6.14036 9C6.44592 9.22222 6.75981 9.51111 7.08203 9.86667C7.50425 10.3333 8.05147 10.8 8.7237 11.2667C8.74845 11.2838 8.77382 11.3007 8.79981 11.3173Z"
        fill="currentColor"
      />
      <path
        d="M11.282 4.04167C11.0154 4.05833 10.7709 4.08889 10.5487 4.13333L10.8654 5.43333C11.0431 5.41111 11.2348 5.38889 11.4404 5.36667C11.6459 5.34445 11.8654 5.33333 12.0987 5.33333L11.0654 6.38333L11.9987 7.33333L14.6654 4.66667L11.9987 2L11.0654 2.93333L12.1154 4C11.8265 4.01111 11.5487 4.025 11.282 4.04167Z"
        fill="currentColor"
      />
      <path
        d="M8.43203 4.925C8.12092 5.13056 7.8487 5.34444 7.61536 5.56667L8.56536 6.51667C8.73203 6.35 8.92092 6.19445 9.13203 6.05C9.34314 5.90556 9.5987 5.77778 9.8987 5.66667L9.58203 4.38333C9.12648 4.53889 8.74314 4.71944 8.43203 4.925Z"
        fill="currentColor"
      />
      <path
        d="M11.7998 13.6V11.8H9.99981V10.6H11.7998V8.80002H12.9998V10.6H14.7998V11.8H12.9998V13.6H11.7998Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function VariantPlus(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ArrowDown.tsx
Tamaño: 480 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ArrowDown(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M10.7188 2C11.2812 1.4375 10.875 0.5 10.125 0.5H1.84375C1.09375 0.5 0.6875 1.4375 1.25 2L5.375 6.25C5.53125 6.4375 5.75 6.5 6 6.5C6.21875 6.5 6.4375 6.4375 6.59375 6.25L10.7188 2Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ArrowDown(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ArrowLeft.tsx
Tamaño: 701 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ArrowLeft(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M15 7C15 6.3125 14.4375 5.75 13.75 5.75H5.15625L7.90625 2.875C8.375 2.375 8.34375 1.59375 7.84375 1.09375C7.34375 0.625 6.5625 0.65625 6.09375 1.15625L1.34375 6.15625C0.875 6.625 0.875 7.40625 1.34375 7.875L6.09375 12.875C6.3125 13.125 6.65625 13.25 7 13.25C7.28125 13.25 7.59375 13.1562 7.84375 12.9062C8.34375 12.4375 8.375 11.6562 7.90625 11.1562L5.15625 8.25H13.75C14.4375 8.25 15 7.71875 15 7Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ArrowLeft(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ArrowRight.tsx
Tamaño: 694 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export const ArrowRight = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none" {...props}>
      <path
        d="M0 7C0 6.3125 0.5625 5.75 1.25 5.75H9.84375L7.09375 2.875C6.625 2.375 6.65625 1.59375 7.15625 1.09375C7.65625 0.625 8.4375 0.65625 8.90625 1.15625L13.6562 6.15625C14.125 6.625 14.125 7.40625 13.6562 7.875L8.90625 12.875C8.6875 13.125 8.34375 13.25 8 13.25C7.71875 13.25 7.40625 13.1562 7.15625 12.9062C6.65625 12.4375 6.625 11.6562 7.09375 11.1562L9.84375 8.25H1.25C0.5625 8.25 0 7.71875 0 7Z"
        fill="white"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export const ArrowRight = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ChevronDown.tsx
Tamaño: 454 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { colors } from '../../config';
export const ChevronDown = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="6" viewBox="0 0 12 6" fill="none">
      <path
        d="M10.8789 1.5C11.4414 0.9375 11.0352 0 10.2852 0H2.00391C1.25391 0 0.847656 0.9375 1.41016 1.5L5.53516 5.75C5.69141 5.9375 5.91016 6 6.16016 6C6.37891 6 6.59766 5.9375 6.75391 5.75L10.8789 1.5Z"
        fill={colors.B60}
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { colors } from '../../config';
export const ChevronDown = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="12" height="6" viewBox="0 0 12 6" fill="none">
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ChevronLeft.tsx
Tamaño: 629 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';

export const ChevronLeft = () => {
  const theme = useMantineTheme();

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="7" height="12" viewBox="0 0 7 12" fill="none">
      <path
        d="M4.66016 10.7188C5.22266 11.2812 6.16016 10.875 6.16016 10.125V1.84375C6.16016 1.09375 5.22266 0.6875 4.66016 1.25L0.410156 5.375C0.222656 5.53125 0.160156 5.75 0.160156 6C0.160156 6.21875 0.222656 6.4375 0.410156 6.59375L4.66016 10.7188Z"
        fill={theme.colorScheme === 'light' ? colors.B60 : 'white'}
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';
export const ChevronLeft = () => {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ChevronPlainDown.tsx
Tamaño: 386 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const ChevronPlainDown = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" {...props}>
      <path
        fill="currentColor"
        fillRule="evenodd"
        d="m12 13.94 5.47-5.47 1.06 1.06L12 16.06 5.47 9.53l1.06-1.06L12 13.94Z"
        clipRule="evenodd"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const ChevronPlainDown = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" {...props}>
<path
fill="currentColor"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ChevronRight.tsx
Tamaño: 653 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';

export const ChevronRight = () => {
  const theme = useMantineTheme();

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="7" height="12" viewBox="0 0 7 12" fill="none">
      <path
        d="M1.66016 1.28223C1.09766 0.719727 0.160156 1.12598 0.160156 1.87598L0.160156 10.1572C0.160156 10.9072 1.09766 11.3135 1.66016 10.751L5.91016 6.62598C6.09766 6.46973 6.16016 6.25098 6.16016 6.00098C6.16016 5.78223 6.09766 5.56348 5.91016 5.40723L1.66016 1.28223Z"
        fill={theme.colorScheme === 'light' ? colors.B60 : 'white'}
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';
export const ChevronRight = () => {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/ChevronUp.tsx
Tamaño: 581 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';
export const ChevronUp = () => {
  const theme = useMantineTheme();

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="6" viewBox="0 0 12 6" fill="none">
      <path
        d="M1.44141 4.5C0.878906 5.0625 1.28516 6 2.03516 6L10.3164 6C11.0664 6 11.4727 5.0625 10.9102 4.5L6.78516 0.25C6.62891 0.0625 6.41016 0 6.16016 0C5.94141 0 5.72266 0.0625 5.56641 0.25L1.44141 4.5Z"
        fill={theme.colorScheme === 'light' ? colors.B60 : 'white'}
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';
export const ChevronUp = () => {
const theme = useMantineTheme();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/CircleArrowRight.tsx
Tamaño: 940 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function CircleArrowRight(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" {...props}>
      <path
        d="M9 0.8125C4.32422 0.8125 0.5625 4.60938 0.5625 9.25C0.5625 13.9258 4.32422 17.6875 9 17.6875C13.6406 17.6875 17.4375 13.9258 17.4375 9.25C17.4375 4.60938 13.6406 0.8125 9 0.8125ZM14.2734 10.0586L10.6172 13.7148C10.1953 14.1719 9.45703 14.1719 9.03516 13.7148C8.57812 13.293 8.57812 12.5547 9.03516 12.1328L10.7578 10.375H4.5C3.86719 10.375 3.375 9.88281 3.375 9.25C3.375 8.65234 3.86719 8.125 4.5 8.125H10.7578L9.03516 6.40234C8.57812 5.98047 8.57812 5.24219 9.03516 4.82031C9.45703 4.36328 10.1953 4.36328 10.6172 4.82031L14.2734 8.47656C14.5547 8.75781 14.625 9.10938 14.625 9.25C14.625 9.42578 14.5547 9.77734 14.2734 10.0586Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CircleArrowRight(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/arrows/DoubleArrowRight.tsx
Tamaño: 1010 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function DoubleArrowRight(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M10.5 9.75C10.5 9.50391 10.3906 9.23047 10.1992 9.01172L6.26172 4.85547C5.82422 4.41797 5.14062 4.39062 4.70312 4.80078C4.26562 5.23828 4.23828 5.92188 4.67578 6.35938L7.875 9.75L4.67578 13.168C4.23828 13.6055 4.26562 14.2891 4.70312 14.7266C5.14062 15.1367 5.82422 15.1094 6.26172 14.6719L10.1992 10.5156C10.3906 10.2969 10.5 10.0234 10.5 9.75ZM15.4492 9.01172L11.5117 4.85547C11.0742 4.41797 10.3906 4.39062 9.95312 4.80078C9.51562 5.23828 9.48828 5.92188 9.89844 6.35938L13.125 9.75L9.89844 13.168C9.48828 13.6055 9.51562 14.2891 9.95312 14.7266C10.3906 15.1367 11.0742 15.1094 11.5117 14.6719L15.4492 10.5156C15.6406 10.2969 15.75 10.0234 15.75 9.75C15.75 9.50391 15.6406 9.23047 15.4492 9.01172Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function DoubleArrowRight(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ActiveLabel.tsx
Tamaño: 6198 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function ActiveLabel(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="72" height="24" viewBox="0 0 72 24" fill="none" {...props}>
      <rect width="72" height="24" rx="12" fill="#4D9980" />
      <g clipPath="url(#clip0_547_27132)">
        <path
          d="M19.4391 7.04504C19.5774 6.72394 19.4743 6.34894 19.1907 6.14269C18.9071 5.93644 18.5204 5.95519 18.2555 6.18488L12.2555 11.4349C12.0212 11.6411 11.9391 11.9716 12.0469 12.2646C12.1548 12.5575 12.4383 12.7497 12.7501 12.7497H15.3633L13.561 16.9544C13.4227 17.2755 13.5258 17.6505 13.8094 17.8568C14.093 18.063 14.4798 18.0443 14.7446 17.8146L20.7446 12.5646C20.979 12.3583 21.0633 12.0278 20.9532 11.7372C20.843 11.4466 20.5641 11.2521 20.2501 11.2521H17.6368L19.4391 7.04504Z"
          fill="white"
        />
      </g>
      <path
        d="M30.55 13.724L29.494 10.838C29.442 10.71 29.388 10.558 29.332 10.382C29.276 10.206 29.22 10.016 29.164 9.812C29.112 10.016 29.058 10.208 29.002 10.388C28.946 10.564 28.892 10.718 28.84 10.85L27.79 13.724H30.55ZM33.4 17H32.152C32.012 17 31.898 16.966 31.81 16.898C31.722 16.826 31.656 16.738 31.612 16.634L30.964 14.864H27.37L26.722 16.634C26.69 16.726 26.628 16.81 26.536 16.886C26.444 16.962 26.33 17 26.194 17H24.934L28.348 8.324H29.992L33.4 17ZM38.31 12.146C38.266 12.202 38.222 12.246 38.178 12.278C38.138 12.31 38.078 12.326 37.998 12.326C37.922 12.326 37.848 12.304 37.776 12.26C37.704 12.212 37.618 12.16 37.518 12.104C37.418 12.044 37.298 11.992 37.158 11.948C37.022 11.9 36.852 11.876 36.648 11.876C36.388 11.876 36.16 11.924 35.964 12.02C35.768 12.112 35.604 12.246 35.472 12.422C35.344 12.598 35.248 12.812 35.184 13.064C35.12 13.312 35.088 13.594 35.088 13.91C35.088 14.238 35.122 14.53 35.19 14.786C35.262 15.042 35.364 15.258 35.496 15.434C35.628 15.606 35.788 15.738 35.976 15.83C36.164 15.918 36.376 15.962 36.612 15.962C36.848 15.962 37.038 15.934 37.182 15.878C37.33 15.818 37.454 15.754 37.554 15.686C37.654 15.614 37.74 15.55 37.812 15.494C37.888 15.434 37.972 15.404 38.064 15.404C38.184 15.404 38.274 15.45 38.334 15.542L38.76 16.082C38.596 16.274 38.418 16.436 38.226 16.568C38.034 16.696 37.834 16.8 37.626 16.88C37.422 16.956 37.21 17.01 36.99 17.042C36.774 17.074 36.558 17.09 36.342 17.09C35.962 17.09 35.604 17.02 35.268 16.88C34.932 16.736 34.638 16.528 34.386 16.256C34.134 15.984 33.934 15.652 33.786 15.26C33.642 14.864 33.57 14.414 33.57 13.91C33.57 13.458 33.634 13.04 33.762 12.656C33.894 12.268 34.086 11.934 34.338 11.654C34.59 11.37 34.902 11.148 35.274 10.988C35.646 10.828 36.074 10.748 36.558 10.748C37.018 10.748 37.42 10.822 37.764 10.97C38.112 11.118 38.424 11.33 38.7 11.606L38.31 12.146ZM45.899 17H44.417V11.954H41.561V15.29C41.561 15.482 41.607 15.632 41.699 15.74C41.795 15.848 41.925 15.902 42.089 15.902C42.181 15.902 42.257 15.892 42.317 15.872C42.381 15.848 42.435 15.824 42.479 15.8C42.527 15.776 42.569 15.754 42.605 15.734C42.641 15.71 42.677 15.698 42.713 15.698C42.757 15.698 42.793 15.71 42.821 15.734C42.849 15.754 42.879 15.786 42.911 15.83L43.355 16.55C43.139 16.73 42.891 16.866 42.611 16.958C42.331 17.05 42.041 17.096 41.741 17.096C41.205 17.096 40.793 16.946 40.505 16.646C40.221 16.342 40.079 15.924 40.079 15.392V11.954H39.449C39.369 11.954 39.301 11.928 39.245 11.876C39.189 11.824 39.161 11.746 39.161 11.642V11.054L40.151 10.886L40.463 9.212C40.483 9.132 40.521 9.07 40.577 9.026C40.633 8.982 40.705 8.96 40.793 8.96H41.561V10.898H45.899V17ZM46.157 9.026C46.157 9.154 46.131 9.276 46.079 9.392C46.027 9.504 45.957 9.602 45.869 9.686C45.785 9.77 45.683 9.838 45.563 9.89C45.447 9.938 45.323 9.962 45.191 9.962C45.063 9.962 44.943 9.938 44.831 9.89C44.719 9.838 44.621 9.77 44.537 9.686C44.453 9.602 44.385 9.504 44.333 9.392C44.285 9.276 44.261 9.154 44.261 9.026C44.261 8.894 44.285 8.772 44.333 8.66C44.385 8.544 44.453 8.444 44.537 8.36C44.621 8.272 44.719 8.204 44.831 8.156C44.943 8.104 45.063 8.078 45.191 8.078C45.323 8.078 45.447 8.104 45.563 8.156C45.683 8.204 45.785 8.272 45.869 8.36C45.957 8.444 46.027 8.544 46.079 8.66C46.131 8.772 46.157 8.894 46.157 9.026ZM52.9617 10.844L50.5197 17H49.1757L46.7337 10.844H47.9577C48.0697 10.844 48.1617 10.87 48.2337 10.922C48.3097 10.974 48.3597 11.04 48.3837 11.12L49.5717 14.408C49.6357 14.6 49.6917 14.788 49.7397 14.972C49.7877 15.156 49.8297 15.34 49.8657 15.524C49.9057 15.34 49.9497 15.156 49.9977 14.972C50.0457 14.788 50.1037 14.6 50.1717 14.408L51.3837 11.12C51.4117 11.04 51.4617 10.974 51.5337 10.922C51.6057 10.87 51.6917 10.844 51.7917 10.844H52.9617ZM57.53 13.214C57.53 13.022 57.502 12.842 57.446 12.674C57.394 12.502 57.314 12.352 57.206 12.224C57.098 12.096 56.96 11.996 56.792 11.924C56.628 11.848 56.436 11.81 56.216 11.81C55.788 11.81 55.45 11.932 55.202 12.176C54.958 12.42 54.802 12.766 54.734 13.214H57.53ZM54.704 14.108C54.728 14.424 54.784 14.698 54.872 14.93C54.96 15.158 55.076 15.348 55.22 15.5C55.364 15.648 55.534 15.76 55.73 15.836C55.93 15.908 56.15 15.944 56.39 15.944C56.63 15.944 56.836 15.916 57.008 15.86C57.184 15.804 57.336 15.742 57.464 15.674C57.596 15.606 57.71 15.544 57.806 15.488C57.906 15.432 58.002 15.404 58.094 15.404C58.218 15.404 58.31 15.45 58.37 15.542L58.796 16.082C58.632 16.274 58.448 16.436 58.244 16.568C58.04 16.696 57.826 16.8 57.602 16.88C57.382 16.956 57.156 17.01 56.924 17.042C56.696 17.074 56.474 17.09 56.258 17.09C55.83 17.09 55.432 17.02 55.064 16.88C54.696 16.736 54.376 16.526 54.104 16.25C53.832 15.97 53.618 15.626 53.462 15.218C53.306 14.806 53.228 14.33 53.228 13.79C53.228 13.37 53.296 12.976 53.432 12.608C53.568 12.236 53.762 11.914 54.014 11.642C54.27 11.366 54.58 11.148 54.944 10.988C55.312 10.828 55.726 10.748 56.186 10.748C56.574 10.748 56.932 10.81 57.26 10.934C57.588 11.058 57.87 11.24 58.106 11.48C58.342 11.716 58.526 12.008 58.658 12.356C58.794 12.7 58.862 13.094 58.862 13.538C58.862 13.762 58.838 13.914 58.79 13.994C58.742 14.07 58.65 14.108 58.514 14.108H54.704Z"
        fill="white"
      />
      <defs>
        <clipPath id="clip0_547_27132">
          <rect width="9" height="12" fill="white" transform="translate(12 6)" />
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ActiveLabel(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="72" height="24" viewBox="0 0 72 24" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Activity.tsx
Tamaño: 443 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Activity(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M18.3333 9H15L12.5 16.5L7.49999 1.5L4.99999 9H1.66666"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Activity(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/AndroidIcon.tsx
Tamaño: 2057 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const AndroidIcon = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg viewBox="0 0 17 16" fill="none" {...props}>
      <g id="adb">
        <mask
          id="mask0_4150_91306"
          style={{ maskType: 'alpha' }}
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="17"
          height="16"
        >
          <rect id="Bounding box" x="0.5" width="16" height="16" fill="currentColor" />
        </mask>
        <g mask="url(#mask0_4150_91306)">
          <path
            id="adb_2"
            d="M3.83334 7.33333V6.66667C3.83334 5.86667 4.01389 5.13611 4.375 4.475C4.73611 3.81389 5.22222 3.27222 5.83334 2.85L4.58334 1.6L5.16667 1L6.58334 2.41667C6.87222 2.28333 7.18056 2.18056 7.50834 2.10833C7.83611 2.03611 8.16667 2 8.5 2C8.83334 2 9.16389 2.03611 9.49167 2.10833C9.81945 2.18056 10.1278 2.28333 10.4167 2.41667L11.8333 1L12.4167 1.6L11.1667 2.85C11.7778 3.27222 12.2639 3.81389 12.625 4.475C12.9861 5.13611 13.1667 5.86667 13.1667 6.66667V7.33333H3.83334ZM10.5 6C10.6889 6 10.8472 5.93611 10.975 5.80833C11.1028 5.68056 11.1667 5.52222 11.1667 5.33333C11.1667 5.14444 11.1028 4.98611 10.975 4.85833C10.8472 4.73056 10.6889 4.66667 10.5 4.66667C10.3111 4.66667 10.1528 4.73056 10.025 4.85833C9.89722 4.98611 9.83334 5.14444 9.83334 5.33333C9.83334 5.52222 9.89722 5.68056 10.025 5.80833C10.1528 5.93611 10.3111 6 10.5 6ZM6.5 6C6.68889 6 6.84722 5.93611 6.975 5.80833C7.10278 5.68056 7.16667 5.52222 7.16667 5.33333C7.16667 5.14444 7.10278 4.98611 6.975 4.85833C6.84722 4.73056 6.68889 4.66667 6.5 4.66667C6.31111 4.66667 6.15278 4.73056 6.025 4.85833C5.89722 4.98611 5.83334 5.14444 5.83334 5.33333C5.83334 5.52222 5.89722 5.68056 6.025 5.80833C6.15278 5.93611 6.31111 6 6.5 6ZM8.5 15.3333C7.2 15.3333 6.09722 14.8806 5.19167 13.975C4.28611 13.0694 3.83334 11.9667 3.83334 10.6667V8H13.1667V10.6667C13.1667 11.9667 12.7139 13.0694 11.8083 13.975C10.9028 14.8806 9.8 15.3333 8.5 15.3333Z"
            fill="currentColor"
          />
        </g>
      </g>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const AndroidIcon = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg viewBox="0 0 17 16" fill="none" {...props}>
<g id="adb">
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/AngularLogo.tsx
Tamaño: 1014 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const AngularLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
      <g clipPath="url(#a)">
        <path fill="#BEBECC" d="M11.964.03.75 3.995l1.772 14.76 9.454 5.22 9.503-5.291 1.771-14.76L11.964.03Z" />
        <path fill="#AD2433" d="M22.131 4.778 11.937 1.286v21.441l8.543-4.75 1.651-13.2Z" />
        <path fill="#C52A37" d="m2.009 4.84 1.518 13.2 8.411 4.687V1.285L2.008 4.84Z" />
        <path
          fill="#fff"
          d="m14.744 12.7-2.806 1.318H8.981l-1.39 3.494-2.586.048 6.933-15.496L14.744 12.7Zm-.271-.663-2.516-5.004-2.064 4.917h2.045l2.535.087Z"
        />
        <path
          fill="#BEBECC"
          d="m11.938 2.064.018 4.968 2.342 4.922h-2.355l-.005 2.06 3.256.004 1.522 3.542 2.474.046-7.253-15.542Z"
        />
      </g>
      <defs>
        <clipPath id="a">
          <path fill="#fff" d="M0 0h24v24H0z" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const AngularLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
<g clipPath="url(#a)">
<path fill="#BEBECC" d="M11.964.03.75 3.995l1.772 14.76 9.454 5.22 9.503-5.291 1.771-14.76L11.964.03Z" />
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/AppleIcon.tsx
Tamaño: 1369 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const AppleIcon = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg viewBox="0 0 15 16" fill="none" {...props}>
      <g id="Apple_logo_black 1" clipPath="url(#clip0_4150_91302)">
        <path
          id="Vector"
          d="M13.5976 5.4544C13.5048 5.5264 11.8664 6.4496 11.8664 8.5024C11.8664 10.8768 13.9512 11.7168 14.0136 11.7376C14.004 11.7888 13.6824 12.888 12.9144 14.008C12.2296 14.9936 11.5144 15.9776 10.4264 15.9776C9.3384 15.9776 9.0584 15.3456 7.8024 15.3456C6.5784 15.3456 6.1432 15.9984 5.148 15.9984C4.1528 15.9984 3.4584 15.0864 2.66 13.9664C1.7352 12.6512 0.987999 10.608 0.987999 8.6688C0.987999 5.5584 3.0104 3.9088 5.0008 3.9088C6.0584 3.9088 6.94 4.6032 7.604 4.6032C8.236 4.6032 9.2216 3.8672 10.4248 3.8672C10.8808 3.8672 12.5192 3.9088 13.5976 5.4544ZM9.8536 2.5504C10.3512 1.96 10.7032 1.1408 10.7032 0.3216C10.7032 0.208 10.6936 0.0928 10.6728 0C9.8632 0.0304 8.9 0.5392 8.3192 1.2128C7.8632 1.7312 7.4376 2.5504 7.4376 3.3808C7.4376 3.5056 7.4584 3.6304 7.468 3.6704C7.5192 3.68 7.6024 3.6912 7.6856 3.6912C8.412 3.6912 9.3256 3.2048 9.8536 2.5504Z"
          fill="currentColor"
        />
      </g>
      <defs>
        <clipPath id="clip0_4150_91302">
          <rect width="13.024" height="16" fill="currentColor" transform="translate(0.987999)" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const AppleIcon = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg viewBox="0 0 15 16" fill="none" {...props}>
<g id="Apple_logo_black 1" clipPath="url(#clip0_4150_91302)">
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Avatar.tsx
Tamaño: 556 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Avatar(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M7 8C9.1875 8 11 6.21875 11 4C11 1.8125 9.1875 0 7 0C4.78125 0 3 1.8125 3 4C3 6.21875 4.78125 8 7 8ZM8.5625 9.5H5.40625C2.40625 9.5 0 11.9375 0 14.9375C0 15.5312 0.46875 16 1.0625 16H12.9062C13.5 16 14 15.5312 14 14.9375C14 11.9375 11.5625 9.5 8.5625 9.5Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Avatar(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Bell.tsx
Tamaño: 971 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Bell(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M21.6667 10.8C21.6667 8.99653 20.9643 7.26692 19.714 5.99167C18.4638 4.71643 16.7681 4 15 4C13.2319 4 11.5362 4.71643 10.286 5.99167C9.03571 7.26692 8.33333 8.99653 8.33333 10.8C8.33333 18.7333 5 21 5 21H25C25 21 21.6667 18.7333 21.6667 10.8Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M17.7295 24C17.4521 24.6072 17.0539 25.1113 16.5748 25.4617C16.0956 25.812 15.5524 25.9965 14.9995 25.9965C14.4466 25.9965 13.9034 25.812 13.4243 25.4617C12.9452 25.1113 12.547 24.6072 12.2695 24"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Bell(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/BellWithNotification.tsx
Tamaño: 5253 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const BellWithNotification = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 125 146" {...props}>
      <path
        fill="url(#a)"
        fillRule="evenodd"
        d="M58.649 104.967c29.321 16.774 50.693 34.434 47.755 39.455-2.938 5.021-29.062-4.479-58.384-21.254C18.728 106.422-2.644 88.762.265 83.741c2.938-5.02 29.062 4.479 58.384 21.254v-.028Z"
        clipRule="evenodd"
      />
      <path
        fill="url(#b)"
        fillRule="evenodd"
        d="M106.948 22.145c5.674 3.253 7.633 10.442 4.349 16.062-3.284 5.62-10.542 7.56-16.216 4.308-5.674-3.253-7.633-10.442-4.35-16.062 3.284-5.62 10.543-7.56 16.217-4.308Z"
        clipRule="evenodd"
      />
      <path
        fill="url(#c)"
        d="M49.431 119.502c4.617 1.622 10.315-2.573 12.727-9.369 2.41-6.797.623-13.621-3.994-15.243-4.617-1.622-10.315 2.573-12.727 9.369-2.41 6.797-.623 13.621 3.994 15.243Z"
      />
      <path
        fill="url(#d)"
        fillRule="evenodd"
        d="M106.061 141.164c-1.037-2.911-3.053-10.899.576-21.768 3.341-9.984 10.024-27.102 13.422-35.718a41.03 41.03 0 0 0 2.103-5.277c5.876-18.487-1.728-39.113-19.327-49.184-17.598-10.07-39.46-6.248-52.652 7.988-1.267 1.426-2.477 2.881-3.571 4.45-5.847 7.247-17.484 21.511-24.54 29.385C14.41 79.57 6.374 81.852 3.35 82.395c8.209-.514 30.646 8.443 55.33 22.566 24.684 14.121 43.752 28.87 47.41 36.174l-.029.029Z"
        clipRule="evenodd"
      />
      <path
        stroke="url(#e)"
        strokeOpacity=".4"
        d="M104.706 138.128c-.987-1.257-2.247-2.629-3.745-4.096-2.707-2.648-6.22-5.631-10.386-8.821-8.33-6.383-19.288-13.612-31.646-20.682-12.357-7.07-24.158-12.85-33.903-16.8-4.873-1.975-9.238-3.496-12.907-4.492-2.053-.556-3.9-.952-5.504-1.169 3.966-1.29 10.009-4.216 15.83-10.697 7.067-7.885 18.711-22.16 24.557-29.404l.011-.014.01-.014c1.078-1.545 2.272-2.983 3.532-4.4 13.037-14.066 34.641-17.842 52.031-7.891 17.391 9.952 24.905 30.334 19.099 48.602a40.516 40.516 0 0 1-2.077 5.213l-.007.017-.007.016c-3.398 8.613-10.085 25.743-13.431 35.743-2.746 8.224-2.301 14.831-1.457 18.889Z"
      />
      <g filter="url(#f)">
        <path
          fill="url(#g)"
          fillRule="evenodd"
          d="M53.509 59.211c12.394 0 22.529-10.055 22.529-22.41 0-12.354-10.135-22.383-22.529-22.383-12.393 0-22.529 10.055-22.529 22.41s10.109 22.41 22.529 22.41v-.027Z"
          clipRule="evenodd"
        />
        <mask id="h" width="15" height="22" x="46" y="24" maskUnits="userSpaceOnUse" style={{ maskType: 'luminance' }}>
          <path fill="#fff" d="M60.082 24.691H46.94v20.543h13.142V24.69Z" />
        </mask>
        <g mask="url(#h)">
          <path
            fill="#fff"
            d="M59.585 43.002v2.232H48.58v-2.232h4.205V30.649c0-.438.014-.885.043-1.342l-3.239 2.67c-.14.11-.285.183-.434.22a1.014 1.014 0 0 1-.407 0 1.329 1.329 0 0 1-.336-.123.962.962 0 0 1-.225-.206l-.939-1.287 6.084-5.108h2.453v17.529h3.8Z"
            opacity=".76"
          />
        </g>
      </g>
      <defs>
        <linearGradient id="a" x1="34.5" x2="82.251" y1="141.482" y2="91.493" gradientUnits="userSpaceOnUse">
          <stop stopColor="#6E6E8F" />
          <stop offset="1" stopColor="#484856" />
        </linearGradient>
        <linearGradient id="b" x1="101.589" x2="100.284" y1="41.466" y2="20.613" gradientUnits="userSpaceOnUse">
          <stop stopColor="#A9A9B9" />
          <stop offset="1" stopColor="#fff" />
        </linearGradient>
        <linearGradient id="c" x1="58.164" x2="49.509" y1="94.89" y2="119.528" gradientUnits="userSpaceOnUse">
          <stop stopColor="#73738F" />
          <stop offset="1" stopColor="#21212D" />
        </linearGradient>
        <linearGradient id="d" x1="63.735" x2="63.735" y1="141.164" y2="23.564" gradientUnits="userSpaceOnUse">
          <stop stopColor="#BEBECC" />
          <stop offset="1" stopColor="#fff" />
        </linearGradient>
        <linearGradient id="e" x1="31.924" x2="98.436" y1="-24.181" y2="136.205" gradientUnits="userSpaceOnUse">
          <stop stopColor="#fff" stopOpacity=".23" />
          <stop offset=".743" stopColor="#FCFCFC" stopOpacity=".08" />
        </linearGradient>
        <linearGradient id="g" x1="30.98" x2="76.038" y1="36.828" y2="36.828" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <filter
          id="f"
          width="93.058"
          height="92.819"
          x="16.98"
          y=".418"
          colorInterpolationFilters="sRGB"
          filterUnits="userSpaceOnUse"
        >
          <feFlood floodOpacity="0" result="BackgroundImageFix" />
          <feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" />
          <feOffset dx="10" dy="10" />
          <feGaussianBlur stdDeviation="12" />
          <feColorMatrix values="0 0 0 0 0.133333 0 0 0 0 0.160784 0 0 0 0 0.192157 0 0 0 0.24 0" />
          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_1338_2795" />
          <feBlend in="SourceGraphic" in2="effect1_dropShadow_1338_2795" result="shape" />
        </filter>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const BellWithNotification = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 125 146" {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Bolt.tsx
Tamaño: 516 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Bolt(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M9.83333 1.6665L1.5 11.6665H9L8.16667 18.3332L16.5 8.33317H9L9.83333 1.6665Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        fillRule="evenodd"
        clipRule="evenodd"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Bolt(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/BoltFilled.tsx
Tamaño: 349 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function BoltFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path d="M4.75 15L5.4375 10.1H2L8.1875 1H9.5625L8.875 6.6H13L6.125 15H4.75Z" fill="currentColor" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BoltFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/BoltOffFilled.tsx
Tamaño: 625 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function BoltOffFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M11.5063 9.81834L6.66732 5.00016L9.15239 1.3335H10.4975L9.82495 6.7638H13.8603L11.5063 9.81834Z"
        fill="currentColor"
      />
      <path
        d="M7.33398 14.6668H5.66732L6.46219 10.1577H3.09943L5.45336 6.76381L1.33398 2.8438L2.29237 1.87653L14.6673 14.3662L13.7089 15.3335L9.82495 11.5153L7.33398 14.6668Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BoltOffFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Box.tsx
Tamaño: 1336 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Box(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M17.5 13.3329V6.66626C17.4997 6.37399 17.4225 6.08693 17.2763 5.83389C17.13 5.58086 16.9198 5.37073 16.6667 5.22459L10.8333 1.89126C10.58 1.74498 10.2926 1.66797 10 1.66797C9.70744 1.66797 9.42003 1.74498 9.16667 1.89126L3.33333 5.22459C3.08022 5.37073 2.86998 5.58086 2.72372 5.83389C2.57745 6.08693 2.5003 6.37399 2.5 6.66626V13.3329C2.5003 13.6252 2.57745 13.9122 2.72372 14.1653C2.86998 14.4183 3.08022 14.6285 3.33333 14.7746L9.16667 18.1079C9.42003 18.2542 9.70744 18.3312 10 18.3312C10.2926 18.3312 10.58 18.2542 10.8333 18.1079L16.6667 14.7746C16.9198 14.6285 17.13 14.4183 17.2763 14.1653C17.4225 13.9122 17.4997 13.6252 17.5 13.3329Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M2.7251 5.7998L10.0001 10.0081L17.2751 5.7998"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path d="M10 18.4V10" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Box(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Brand.tsx
Tamaño: 1451 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Brand(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M7.5 12.5L9.90558 14.7833L14.5 9M6.87972 3.80439L5.50274 3.78799C4.27356 3.77335 3.27335 4.77356 3.28799 6.00274L3.30439 7.37972C3.31152 7.97829 3.0732 8.55365 2.64491 8.97186L1.65964 9.93393C0.78012 10.7927 0.78012 12.2073 1.65964 13.0661L2.64491 14.0281C3.0732 14.4463 3.31152 15.0217 3.30439 15.6203L3.28799 16.9973C3.27335 18.2264 4.27356 19.2266 5.50274 19.212L6.87972 19.1956C7.47829 19.1885 8.05365 19.4268 8.47186 19.8551L9.43393 20.8404C10.2927 21.7199 11.7073 21.7199 12.5661 20.8404L13.5281 19.8551C13.9463 19.4268 14.5217 19.1885 15.1203 19.1956L16.4973 19.212C17.7264 19.2266 18.7266 18.2264 18.712 16.9973L18.6956 15.6203C18.6885 15.0217 18.9268 14.4463 19.3551 14.0281L20.3404 13.0661C21.2199 12.2073 21.2199 10.7927 20.3404 9.93393L19.3551 8.97186C18.9268 8.55365 18.6885 7.97829 18.6956 7.37972L18.712 6.00274C18.7266 4.77356 17.7264 3.77335 16.4973 3.78799L15.1203 3.80439C14.5217 3.81152 13.9463 3.5732 13.5281 3.14491L12.5661 2.15964C11.7073 1.28012 10.2927 1.28012 9.43393 2.15964L8.47186 3.14491C8.05365 3.5732 7.47829 3.81152 6.87972 3.80439Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Brand(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/BuildWorkflow.tsx
Tamaño: 7600 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function BuildWorkflow(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
      <g clipPath="url(#clip0_1481_2380)">
        <mask
          id="mask0_1481_2380"
          style={{ maskType: 'luminance' }}
          width="64"
          height="65"
          x="0"
          y="0"
          maskUnits="userSpaceOnUse"
        >
          <path fill="#fff" d="M64 .001H0v64h64v-64z"></path>
        </mask>
        <g mask="url(#mask0_1481_2380)">
          <path
            fill="#525266"
            d="M32 64.001c17.673 0 32-14.327 32-32 0-17.673-14.327-32-32-32-17.673 0-32 14.327-32 32 0 17.673 14.327 32 32 32z"
          ></path>
          <path
            fill="url(#paint0_linear_1481_2380)"
            d="M49.372 35.329c-.8.043-1.407-.76-1.14-1.529a9.91 9.91 0 00.541-3.396c-.044-3.08-2.65-5.25-6.02-4.559-3.342.686-3.97 3.688-3.483 5.102.254.739 1.138 1.997 1.926 3.033.551.725.09 1.782-.796 1.83l-8.927.478-.468-7.874c-.039-.66-.756-1.017-1.266-.629-.859.653-2.217 1.236-4.141.824-3.658-.784-3.671-4.254-3.068-6 .51-1.475 3.934-3.42 6.551-1.694.556.366 1.278-.075 1.237-.765l-.496-9.938C18.699 11.277 10 20.625 10 32c0 1.264.109 2.502.315 3.708l8.544.101c.386.008.58.426.323.688-.493.5-.98 1.317-.892 2.556.172 2.421 2.363 3.34 4.784 2.32 2.411-1.018 3.041-3.728.659-5.623l7.671.154.051 6.008c.006.658.807 1.069 1.387.705 2.963-1.857 5.777.408 5.924 2.193.17 2.073-.991 4.134-3.54 3.884a7.755 7.755 0 01-2.64-.733c-.594-.289-1.284.106-1.279.727l.042 5.194c.198.005.395.008.594.008 11.064 0 20.214-8.17 21.723-18.793l-4.294.23z"
          ></path>
          <path
            fill="url(#paint1_linear_1481_2380)"
            d="M32.586 47.97a7.757 7.757 0 002.639.732c2.55.25 3.711-1.81 3.54-3.884-.146-1.785-2.96-4.05-5.924-2.192-.58.363-1.38-.048-1.386-.706l-.051-6.008-7.671-.154c2.382 1.895 1.752 4.605-.66 5.622-2.42 1.022-4.61.102-4.784-2.32-.088-1.238.4-2.054.892-2.555.258-.262.063-.68-.323-.688l-8.543-.101C12.048 45.85 20.764 53.61 31.349 53.89l-.043-5.193c-.005-.622.686-1.017 1.28-.728z"
          ></path>
          <path
            fill="url(#paint2_linear_1481_2380)"
            d="M31.35 54.002h-.003c-10.488-.278-19.38-7.96-21.142-18.268a.112.112 0 01.025-.092.11.11 0 01.087-.04l8.544.102c.234.005.43.134.514.337a.496.496 0 01-.112.542c-.44.448-.947 1.24-.86 2.47.072 1.004.497 1.772 1.229 2.22.884.54 2.123.542 3.399.003 1.15-.485 1.922-1.397 2.066-2.44.148-1.075-.36-2.138-1.433-2.99a.112.112 0 01.07-.2h.002l7.672.153c.06 0 .11.05.11.111l.051 6.008c.002.258.15.492.396.626a.81.81 0 00.818-.014c1.805-1.132 3.342-.668 4.098-.29 1.115.556 1.918 1.589 1.998 2.569.103 1.254-.281 2.441-1.029 3.175-.659.647-1.57.934-2.635.83a7.854 7.854 0 01-2.677-.745.808.808 0 00-.788.036.68.68 0 00-.33.59l.043 5.193a.114.114 0 01-.113.114zm-20.9-18.173c1.792 10.097 10.502 17.618 20.787 17.944l-.042-5.076a.912.912 0 01.434-.781c.302-.19.679-.208 1.008-.048a7.628 7.628 0 002.6.722c.996.097 1.845-.168 2.456-.767.7-.687 1.06-1.807.962-2.996-.073-.89-.844-1.872-1.875-2.387-.714-.356-2.166-.793-3.877.28a1.036 1.036 0 01-1.046.02.944.944 0 01-.513-.82l-.05-5.899-7.245-.145c.969.867 1.419 1.92 1.271 2.99-.154 1.122-.977 2.1-2.202 2.617-1.343.567-2.657.56-3.604-.02-.785-.48-1.26-1.33-1.335-2.395-.094-1.313.45-2.162.924-2.642a.271.271 0 00.063-.3.329.329 0 00-.308-.197l-8.408-.1z"
          ></path>
          <path
            fill="url(#paint3_linear_1481_2380)"
            d="M29.08 20.92c-2.617-1.726-6.041.22-6.55 1.692-.603 1.747-.59 5.217 3.067 6.001 1.925.413 3.283-.17 4.142-.824.51-.388 1.227-.031 1.266.63l.467 7.874 8.927-.479c.886-.047 1.348-1.105.797-1.83-.788-1.036-1.672-2.294-1.927-3.033-.487-1.414.142-4.416 3.483-5.102 3.371-.691 5.976 1.48 6.021 4.559a9.915 9.915 0 01-.541 3.396c-.268.77.339 1.572 1.14 1.53l4.293-.231c.144-1.012.22-2.046.22-3.098 0-9.809-6.467-18.11-15.379-20.894l-.026.006-.06-.033a21.98 21.98 0 00-8.599-.867l.497 9.937c.04.69-.682 1.131-1.237.765z"
          ></path>
          <path
            fill="url(#paint4_linear_1481_2380)"
            d="M31.473 36.404a.112.112 0 01-.113-.106l-.467-7.874a.716.716 0 00-.414-.623.649.649 0 00-.671.077c-.82.623-2.22 1.276-4.234.844-1.34-.288-2.312-.949-2.887-1.966-.783-1.383-.63-3.117-.263-4.181.288-.835 1.389-1.722 2.677-2.159.844-.286 2.492-.614 4.043.409.216.142.479.15.702.022a.734.734 0 00.36-.687l-.497-9.939a.113.113 0 01.102-.117 22.107 22.107 0 018.663.881l.024.013c.014 0 .028 0 .042.005a22.112 22.112 0 0111.088 7.853 21.785 21.785 0 014.37 13.148c0 1.034-.075 2.082-.221 3.114a.112.112 0 01-.106.096l-4.293.23a1.251 1.251 0 01-1.064-.5 1.262 1.262 0 01-.188-1.177 9.77 9.77 0 00.535-3.359c-.021-1.454-.616-2.722-1.675-3.57-1.117-.895-2.612-1.208-4.211-.88-1.72.353-2.583 1.306-3.004 2.043-.603 1.054-.633 2.222-.395 2.913.203.587.863 1.625 1.91 3.002.287.377.341.879.142 1.309a1.185 1.185 0 01-1.022.7l-8.928.479h-.006zm-1.267-8.889a.88.88 0 01.367.081.95.95 0 01.545.815l.46 7.763 8.816-.473a.963.963 0 00.83-.57c.164-.355.12-.768-.118-1.08-1.076-1.414-1.73-2.445-1.943-3.064-.254-.738-.225-1.982.412-3.097.445-.777 1.353-1.782 3.155-2.151 1.665-.342 3.227-.014 4.397.924 1.112.891 1.737 2.22 1.76 3.743a9.994 9.994 0 01-.548 3.434c-.114.327-.056.689.155.968.208.276.534.43.871.412l4.201-.225c.137-.992.206-1.998.206-2.99 0-9.566-6.135-17.912-15.27-20.779l-.012.002a.112.112 0 01-.064-.013l-.05-.027a21.882 21.882 0 00-8.437-.87l.491 9.83a.955.955 0 01-.471.894.88.88 0 01-.94-.03c-1.47-.97-3.041-.656-3.846-.383-1.207.41-2.273 1.258-2.536 2.019-.353 1.02-.5 2.68.246 3.998.542.958 1.463 1.583 2.739 1.856 1.929.413 3.267-.208 4.049-.803a.881.881 0 01.535-.184z"
          ></path>
        </g>
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_1481_2380"
          x1="32.889"
          x2="30.443"
          y1="49.014"
          y2="10.3"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#A9A9B9"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint1_linear_1481_2380"
          x1="24.548"
          x2="24.548"
          y1="35.716"
          y2="53.89"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#73738F"></stop>
          <stop offset="1" stopColor="#21212D"></stop>
        </linearGradient>
        <linearGradient
          id="paint2_linear_1481_2380"
          x1="24.549"
          x2="24.549"
          y1="35.603"
          y2="54.002"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#73738F"></stop>
          <stop offset="1" stopColor="#21212D"></stop>
        </linearGradient>
        <linearGradient
          id="paint3_linear_1481_2380"
          x1="22.234"
          x2="53.885"
          y1="23.203"
          y2="23.203"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
        <linearGradient
          id="paint4_linear_1481_2380"
          x1="22.123"
          x2="53.998"
          y1="23.203"
          y2="23.203"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
        <clipPath id="clip0_1481_2380">
          <path fill="#fff" d="M0 0H64V64H0z" transform="translate(0 .001)"></path>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BuildWorkflow(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Buildings.tsx
Tamaño: 572 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Buildings(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M0 18V0H10V4H20V18H0ZM2 16H4V14H2V16ZM2 12H4V10H2V12ZM2 8H4V6H2V8ZM2 4H4V2H2V4ZM6 16H8V14H6V16ZM6 12H8V10H6V12ZM6 8H8V6H6V8ZM6 4H8V2H6V4ZM10 16H18V6H10V8H12V10H10V12H12V14H10V16ZM14 10V8H16V10H14ZM14 14V12H16V14H14Z"
        fillRule="evenodd"
        clipRule="evenodd"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Buildings(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Calendar.tsx
Tamaño: 1217 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export function Calendar(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="14" viewBox="0 0 12 14" fill="none" {...props}>
      <path
        d="M4.40377 10.6C3.95683 10.6 3.5778 10.4457 3.26669 10.1371C2.95558 9.82846 2.80002 9.45068 2.80002 9.00373C2.80002 8.55678 2.95433 8.17775 3.26294 7.86664C3.57154 7.55553 3.94932 7.39998 4.39627 7.39998C4.84322 7.39998 5.22225 7.55428 5.53336 7.86289C5.84447 8.17149 6.00002 8.54927 6.00002 8.99623C6.00002 9.44317 5.84572 9.8222 5.53711 10.1333C5.22851 10.4444 4.85073 10.6 4.40377 10.6ZM1.60002 13.4C1.27002 13.4 0.987524 13.2805 0.752524 13.0416C0.517524 12.8028 0.400024 12.5222 0.400024 12.2V3.39998C0.400024 3.07775 0.517524 2.7972 0.752524 2.55831C0.987524 2.31942 1.27002 2.19998 1.60002 2.19998H2.80002V0.599976H4.00002V2.19998H8.00002V0.599976H9.20002V2.19998H10.4C10.73 2.19998 11.0125 2.31942 11.2475 2.55831C11.4825 2.7972 11.6 3.07775 11.6 3.39998V12.2C11.6 12.5222 11.4825 12.8028 11.2475 13.0416C11.0125 13.2805 10.73 13.4 10.4 13.4H1.60002ZM1.60002 12.2H10.4V6.19998H1.60002V12.2ZM1.60002 4.99998H10.4V3.39998H1.60002V4.99998Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export function Calendar(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="12" height="14" viewBox="0 0 12 14" fill="none" {...props}>
<path
d="M4.40377 10.6C3.95683 10.6 3.5778 10.4457 3.26669 10.1371C2.95558 9.82846 2.80002 9.45068 2.80002 9.00373C2.80002 8.55678 2.95433 8.17775 3.26294 7.86664C3.57154 7.55553 3.94932 7.39998 4.39627 7.39998C4.84322 7.39998 5.22225 7.55428 5.53336 7.86289C5.84447 8.17149 6.00002 8.54927 6.00002 8.99623C6.00002 9.44317 5.84572 9.8222 5.53711 10.1333C5.22851 10.4444 4.85073 10.6 4.40377 10.6ZM1.60002 13.4C1.27002 13.4 0.987524 13.2805 0.752524 13.0416C0.517524 12.8028 0.400024 12.5222 0.400024 12.2V3.39998C0.400024 3.07775 0.517524 2.7972 0.752524 2.55831C0.987524 2.31942 1.27002 2.19998 1.60002 2.19998H2.80002V0.599976H4.00002V2.19998H8.00002V0.599976H9.20002V2.19998H10.4C10.73 2.19998 11.0125 2.31942 11.2475 2.55831C11.4825 2.7972 11.6 3.07775 11.6 3.39998V12.2C11.6 12.5222 11.4825 12.8028 11.2475 13.0416C11.0125 13.2805 10.73 13.4 10.4 13.4H1.60002ZM1.60002 12.2H10.4V6.19998H1.60002V12.2ZM1.60002 4.99998H10.4V3.39998H1.60002V4.99998Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Camera.tsx
Tamaño: 644 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Camera(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M14.5 2H11.75L11.3438 1C11.125 0.40625 10.5625 0 9.9375 0H6.03125C5.40625 0 4.84375 0.40625 4.625 1L4.25 2H1.5C0.65625 2 0 2.6875 0 3.5V12.5C0 13.3438 0.65625 14 1.5 14H14.5C15.3125 14 16 13.3438 16 12.5V3.5C16 2.6875 15.3125 2 14.5 2ZM8 11C6.34375 11 5 9.65625 5 8C5 6.34375 6.34375 5 8 5C9.65625 5 11 6.34375 11 8C11 9.65625 9.65625 11 8 11Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Camera(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Chat.tsx
Tamaño: 890 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Chat(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <path
        d="M16.9727 3.76172C17.0273 3.43359 16.8906 3.10547 16.6172 2.91406C16.3164 2.72266 15.9609 2.72266 15.6875 2.88672L3.4375 9.88672C3.13672 10.0508 2.97266 10.3516 3 10.6797C3 11.0352 3.21875 11.3086 3.51953 11.4453L6.33594 12.6211L14.3477 5.40234L8.41406 13.0312C8.30469 13.168 8.22266 13.3594 8.22266 13.5508V16.2031C8.22266 16.5039 8.49609 16.75 8.79688 16.75C8.98828 16.75 9.17969 16.668 9.28906 16.5039L10.6836 14.4258L14.0195 15.8203C14.1289 15.875 14.2383 15.875 14.3477 15.875C14.5117 15.875 14.6484 15.8477 14.7852 15.7656C15.0312 15.6562 15.1953 15.4102 15.2227 15.1367L16.9727 3.76172Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Chat(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ChatFilled.tsx
Tamaño: 900 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function ChatFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-workflow-node-icon
      {...props}
    >
      <path
        fill={`url(#${id})`}
        d="M19.73 3.114L3.44 12.513a.844.844 0 00.077 1.518l3.737 1.567 10.098-8.9c.193-.171.468.092.302.293L9.186 17.307v2.83c0 .829 1.002 1.156 1.494.555l2.232-2.717 4.38 1.834a.846.846 0 001.16-.64l2.53-15.184c.12-.71-.643-1.223-1.251-.871z"
      ></path>
      <defs>
        <linearGradient id={String(id)} x1="3" x2="20.994" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ChatFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Check.tsx
Tamaño: 658 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Check(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="14" height="11" viewBox="0 0 14 11" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M12.6875 2.71484C13.125 2.27734 13.125 1.59375 12.6875 1.15625C12.25 0.746094 11.5664 0.746094 11.1562 1.15625L4.92188 7.39062L2.1875 4.65625C1.75 4.24609 1.06641 4.24609 0.65625 4.65625C0.21875 5.09375 0.21875 5.77734 0.65625 6.21484L4.15625 9.71484C4.34766 9.93359 4.64844 10.043 4.92188 10.043C5.19531 10.043 5.46875 9.93359 5.6875 9.71484L12.6875 2.71484Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Check(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="14" height="11" viewBox="0 0 14 11" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/CheckCircle.tsx
Tamaño: 768 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function CheckCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M8.25 0.5C4.09375 0.5 0.75 3.875 0.75 8C0.75 12.1562 4.09375 15.5 8.25 15.5C12.375 15.5 15.75 12.1562 15.75 8C15.75 3.875 12.375 0.5 8.25 0.5ZM11.8438 6.625L7.84375 10.625C7.6875 10.8125 7.46875 10.875 7.25 10.875C7 10.875 6.78125 10.8125 6.625 10.625L4.625 8.625C4.28125 8.28125 4.28125 7.75 4.625 7.40625C4.96875 7.0625 5.5 7.0625 5.84375 7.40625L7.25 8.78125L10.625 5.40625C10.9688 5.0625 11.5 5.0625 11.8438 5.40625C12.1875 5.75 12.1875 6.28125 11.8438 6.625Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CheckCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/CheckCircleOutlined.tsx
Tamaño: 987 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function CheckCircleOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M18.3334 9.23333V10C18.3324 11.797 17.7505 13.5456 16.6745 14.9849C15.5986 16.4241 14.0862 17.4771 12.3629 17.9866C10.6396 18.4961 8.7978 18.4349 7.11214 17.8122C5.42648 17.1894 3.98729 16.0384 3.00922 14.5309C2.03114 13.0234 1.56657 11.2401 1.68481 9.44693C1.80305 7.6538 2.49775 5.94694 3.66531 4.58089C4.83288 3.21485 6.41074 2.26282 8.16357 1.86679C9.91641 1.47076 11.7503 1.65195 13.3918 2.38333"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M18.3333 3.33334L10 11.675L7.5 9.17501"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CheckCircleOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Clicked.tsx
Tamaño: 1606 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Clicked(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M12.1562 6.9375C11.8633 6.9375 11.6289 7.02539 11.4238 7.17188C11.2773 6.49805 10.7207 6 10.0469 6C9.51953 6 9.08008 6.29297 8.8457 6.70312C8.69922 6.0293 8.14258 5.53125 7.46875 5.53125C7.08789 5.53125 6.76562 5.67773 6.53125 5.91211V1.54688C6.53125 0.902344 6.00391 0.375 5.35938 0.375C4.68555 0.375 4.1875 0.902344 4.1875 1.54688V11.0098L2.54688 8.8125C2.3125 8.51953 1.96094 8.34375 1.58008 8.34375C0.964844 8.34375 0.4375 8.87109 0.4375 9.54492C0.4375 9.7793 0.496094 10.0137 0.671875 10.2188L3.33789 13.793C4.07031 14.7891 5.27148 15.375 6.53125 15.375H9.34375C11.6582 15.375 13.5625 13.5 13.5625 11.1562V8.34375C13.5625 7.58203 12.918 6.9375 12.1562 6.9375ZM7.46875 12.0938C7.46875 12.3574 7.23438 12.5625 7 12.5625C6.73633 12.5625 6.53125 12.3574 6.53125 12.0938V9.28125C6.53125 9.04688 6.73633 8.8125 7 8.8125C7.23438 8.8125 7.46875 9.04688 7.46875 9.28125V12.0938ZM9.34375 12.0938C9.34375 12.3574 9.10938 12.5625 8.875 12.5625C8.61133 12.5625 8.40625 12.3574 8.40625 12.0938V9.28125C8.40625 9.04688 8.61133 8.8125 8.875 8.8125C9.10938 8.8125 9.34375 9.04688 9.34375 9.28125V12.0938ZM11.2188 12.0938C11.2188 12.3574 10.9844 12.5625 10.75 12.5625C10.4863 12.5625 10.2812 12.3574 10.2812 12.0938V9.28125C10.2812 9.04688 10.4863 8.8125 10.75 8.8125C10.9844 8.8125 11.2188 9.04688 11.2188 9.28125V12.0938Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Clicked(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Clock.tsx
Tamaño: 2172 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const Clock = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 135 136" {...props}>
      <path
        fill="url(#a)"
        d="M67.5 135.159c37.279 0 67.5-30.07 67.5-67.164S104.779.831 67.5.831C30.22.831 0 30.901 0 67.995s30.22 67.164 67.5 67.164Z"
      />
      <path
        fill="url(#b)"
        d="M67.5 131.27c35.12 0 63.591-28.33 63.591-63.275S102.62 4.722 67.5 4.722c-35.12 0-63.59 28.328-63.59 63.273 0 34.945 28.47 63.275 63.59 63.275Z"
      />
      <path
        fill="url(#c)"
        d="m72.003 64.912 53.837-1.458C122.524 31.549 102.708 11.61 71.459 8.41l.545 56.503-.001-.001Z"
        opacity=".5"
      />
      <path
        fill="url(#d)"
        fillRule="evenodd"
        d="M66.746 39.241c-.8.012-1.397.433-1.397 1.666L65.3 63.81c-1.31.627-2.225 2.01-2.225 3.6 0 .658.157 1.275.434 1.813L37.866 94.636c-.49.474-.53 1.265-.092 1.764.438.5 1.188.52 1.675.046l25.766-25.563a3.54 3.54 0 0 0 1.585.334c2.055-.043 3.718-1.815 3.718-3.955 0-1.629-.962-3.005-2.327-3.553l-.048-22.842c0-1.23-.596-1.638-1.397-1.626Z"
        clipRule="evenodd"
      />
      <defs>
        <linearGradient id="a" x1="67.5" x2="67.5" y1=".831" y2="135.159" gradientUnits="userSpaceOnUse">
          <stop stopColor="#353544" stopOpacity=".91" />
          <stop offset="1" stopColor="#232335" stopOpacity=".98" />
        </linearGradient>
        <linearGradient id="b" x1="67.5" x2="67.5" y1="131.27" y2="4.722" gradientUnits="userSpaceOnUse">
          <stop stopColor="#BEBECC" />
          <stop offset="1" stopColor="#fff" />
        </linearGradient>
        <linearGradient id="c" x1="71.459" x2="125.84" y1="36.662" y2="36.662" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <linearGradient id="d" x1="53.994" x2="53.994" y1="39.241" y2="96.788" gradientUnits="userSpaceOnUse">
          <stop stopColor="#353544" stopOpacity=".91" />
          <stop offset="1" stopColor="#232335" stopOpacity=".98" />
        </linearGradient>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const Clock = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 135 136" {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Cloud.tsx
Tamaño: 1149 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export function Cloud(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="16" viewBox="0 0 22 16" fill="none" {...props}>
      <path
        d="M5.5 16C3.98333 16 2.6875 15.475 1.6125 14.425C0.5375 13.375 0 12.0917 0 10.575C0 9.275 0.391667 8.11667 1.175 7.1C1.95833 6.08333 2.98333 5.43333 4.25 5.15C4.66667 3.61667 5.5 2.375 6.75 1.425C8 0.475 9.41667 0 11 0C12.95 0 14.6042 0.679167 15.9625 2.0375C17.3208 3.39583 18 5.05 18 7C19.15 7.13333 20.1042 7.62917 20.8625 8.4875C21.6208 9.34583 22 10.35 22 11.5C22 12.75 21.5625 13.8125 20.6875 14.6875C19.8125 15.5625 18.75 16 17.5 16H5.5ZM5.5 14H17.5C18.2 14 18.7917 13.7583 19.275 13.275C19.7583 12.7917 20 12.2 20 11.5C20 10.8 19.7583 10.2083 19.275 9.725C18.7917 9.24167 18.2 9 17.5 9H16V7C16 5.61667 15.5125 4.4375 14.5375 3.4625C13.5625 2.4875 12.3833 2 11 2C9.61667 2 8.4375 2.4875 7.4625 3.4625C6.4875 4.4375 6 5.61667 6 7H5.5C4.53333 7 3.70833 7.34167 3.025 8.025C2.34167 8.70833 2 9.53333 2 10.5C2 11.4667 2.34167 12.2917 3.025 12.975C3.70833 13.6583 4.53333 14 5.5 14Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export function Cloud(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="22" height="16" viewBox="0 0 22 16" fill="none" {...props}>
<path
d="M5.5 16C3.98333 16 2.6875 15.475 1.6125 14.425C0.5375 13.375 0 12.0917 0 10.575C0 9.275 0.391667 8.11667 1.175 7.1C1.95833 6.08333 2.98333 5.43333 4.25 5.15C4.66667 3.61667 5.5 2.375 6.75 1.425C8 0.475 9.41667 0 11 0C12.95 0 14.6042 0.679167 15.9625 2.0375C17.3208 3.39583 18 5.05 18 7C19.15 7.13333 20.1042 7.62917 20.8625 8.4875C21.6208 9.34583 22 10.35 22 11.5C22 12.75 21.5625 13.8125 20.6875 14.6875C19.8125 15.5625 18.75 16 17.5 16H5.5ZM5.5 14H17.5C18.2 14 18.7917 13.7583 19.275 13.275C19.7583 12.7917 20 12.2 20 11.5C20 10.8 19.7583 10.2083 19.275 9.725C18.7917 9.24167 18.2 9 17.5 9H16V7C16 5.61667 15.5125 4.4375 14.5375 3.4625C13.5625 2.4875 12.3833 2 11 2C9.61667 2 8.4375 2.4875 7.4625 3.4625C6.4875 4.4375 6 5.61667 6 7H5.5C4.53333 7 3.70833 7.34167 3.025 8.025C2.34167 8.70833 2 9.53333 2 10.5C2 11.4667 2.34167 12.2917 3.025 12.975C3.70833 13.6583 4.53333 14 5.5 14Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Condition.tsx
Tamaño: 1036 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Condition(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      color="#828299"
      {...props}
    >
      <g id="Icon filter" clipPath="url(#clip0_5047_8523)">
        <g id="filter_list">
          <mask id="mask0_5047_8523" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
            <rect id="Bounding box" width="16" height="16" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_5047_8523)">
            <path
              id="filter_list_2"
              d="M6.66667 12V10.6667H9.33333V12H6.66667ZM4 8.66667V7.33333H12V8.66667H4ZM2 5.33333V4H14V5.33333H2Z"
              fill="currentColor"
            />
          </g>
        </g>
      </g>
      <defs>
        <clipPath id="clip0_5047_8523">
          <rect width="16" height="16" fill="currentColor" />
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Condition(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Conditions.tsx
Tamaño: 314 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const Conditions = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" {...props}>
      <path fill="currentColor" d="M6.398 11.6v-1.2h3.2v1.2h-3.2Zm-2.4-3V7.4h8v1.2h-8Zm-1.6-3V4.4h11.2v1.2h-11.2Z" />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const Conditions = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" {...props}>
<path fill="currentColor" d="M6.398 11.6v-1.2h3.2v1.2h-3.2Zm-2.4-3V7.4h8v1.2h-8Zm-1.6-3V4.4h11.2v1.2h-11.2Z" />
</svg>
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ConditionsFile.tsx
Tamaño: 855 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ConditionsFile(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M2.33333 13.1667C1.96667 13.1667 1.65278 13.0361 1.39167 12.775C1.13056 12.5139 1 12.2 1 11.8333V3.83333C1 3.46667 1.13056 3.15278 1.39167 2.89167C1.65278 2.63056 1.96667 2.5 2.33333 2.5H6.33333L7.66667 3.83333H13C13.3667 3.83333 13.6806 3.96389 13.9417 4.225C14.2028 4.48611 14.3333 4.8 14.3333 5.16667H7.11667L5.78333 3.83333H2.33333V11.8333H7V13.1667H2.33333Z"
        fill="currentColor"
      />
      <path
        d="M10.9442 14.2437V12.9746H13.0558V14.2437H10.9442ZM9.25888 11.7563V10.4873H14.731V11.7563H9.25888ZM8 9.26904V8H16V9.26904H8Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ConditionsFile(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/CountdownTimer.tsx
Tamaño: 1265 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function CountdownTimer(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 25 25" {...props}>
      <mask id="a" x="0" y="0" maskUnits="userSpaceOnUse" style={{ maskType: 'alpha' }}>
        <path fill="currentColor" d="M.504.5h24v24h-24z" />
      </mask>
      <g mask="url(#a)">
        <path
          fill="currentColor"
          d="M9.504 3.5v-2h6v2h-6Zm2 11h2v-6h-2v6Zm1 8a8.646 8.646 0 0 1-3.487-.712 9.192 9.192 0 0 1-2.863-1.938 9.193 9.193 0 0 1-1.937-2.863 8.646 8.646 0 0 1-.713-3.487c0-1.233.238-2.396.713-3.488A9.193 9.193 0 0 1 6.154 7.15a9.193 9.193 0 0 1 2.863-1.938 8.646 8.646 0 0 1 3.487-.712 8.92 8.92 0 0 1 2.975.5c.95.333 1.842.817 2.675 1.45l1.4-1.4 1.4 1.4-1.4 1.4a9.72 9.72 0 0 1 1.45 2.675c.333.95.5 1.942.5 2.975a8.646 8.646 0 0 1-.713 3.488 9.192 9.192 0 0 1-1.937 2.862 9.191 9.191 0 0 1-2.862 1.938 8.645 8.645 0 0 1-3.488.712Zm0-2c1.933 0 3.583-.683 4.95-2.05 1.367-1.367 2.05-3.017 2.05-4.95 0-1.933-.683-3.583-2.05-4.95-1.367-1.367-3.017-2.05-4.95-2.05-1.933 0-3.583.683-4.95 2.05-1.367 1.367-2.05 3.017-2.05 4.95 0 1.933.683 3.583 2.05 4.95 1.367 1.367 3.017 2.05 4.95 2.05Z"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CountdownTimer(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 25 25" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/CurlyBrackets.tsx
Tamaño: 1719 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function CurlyBrackets(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none" {...props}>
      <path
        d="M10 12V10.5H11.75C11.9625 10.5 12.1406 10.4281 12.2844 10.2844C12.4281 10.1406 12.5 9.9625 12.5 9.75V8.25C12.5 7.68056 12.691 7.19097 13.0729 6.78125C13.4549 6.37153 13.9306 6.13194 14.5 6.0625V5.97917C13.9306 5.86806 13.4549 5.61111 13.0729 5.20833C12.691 4.80556 12.5 4.31944 12.5 3.75V2.25C12.5 2.0375 12.4281 1.85937 12.2844 1.71562C12.1406 1.57187 11.9625 1.5 11.75 1.5H10V0H11.75C12.375 0 12.9062 0.21875 13.3438 0.65625C13.7812 1.09375 14 1.625 14 2.25V3.75C14 3.9625 14.0719 4.14063 14.2156 4.28438C14.3594 4.42813 14.5375 4.5 14.75 4.5H16V7.5H14.75C14.5375 7.5 14.3594 7.57188 14.2156 7.71563C14.0719 7.85938 14 8.0375 14 8.25V9.75C14 10.375 13.7812 10.9062 13.3438 11.3438C12.9062 11.7812 12.375 12 11.75 12H10ZM4.25 12C3.625 12 3.09375 11.7812 2.65625 11.3438C2.21875 10.9062 2 10.375 2 9.75V8.25C2 8.0375 1.92812 7.85938 1.78437 7.71563C1.64062 7.57188 1.4625 7.5 1.25 7.5H0V4.5H1.25C1.4625 4.5 1.64062 4.42813 1.78437 4.28438C1.92812 4.14063 2 3.9625 2 3.75V2.25C2 1.625 2.21875 1.09375 2.65625 0.65625C3.09375 0.21875 3.625 0 4.25 0H6V1.5H4.25C4.0375 1.5 3.85938 1.57187 3.71563 1.71562C3.57188 1.85937 3.5 2.0375 3.5 2.25V3.75C3.5 4.33333 3.30903 4.82986 2.92708 5.23958C2.54514 5.64931 2.06944 5.88889 1.5 5.95833V6.04475C2.06944 6.09825 2.54514 6.33333 2.92708 6.75C3.30903 7.16667 3.5 7.66667 3.5 8.25V9.75C3.5 9.9625 3.57188 10.1406 3.71563 10.2844C3.85938 10.4281 4.0375 10.5 4.25 10.5H6V12H4.25Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CurlyBrackets(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Digest.tsx
Tamaño: 527 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Digest(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox={`0 0 ${props.width || '24'} ${props.height || '26'}`}
      fill="none"
      {...props}
    >
      <path
        d="M1 19L12 25L23 19M1 13L12 19L23 13M12 1L1 7L12 13L23 7L12 1Z"
        stroke={props.color ? props.color : 'currentColor'}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Digest(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/DigestAction.tsx
Tamaño: 1338 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function DigestAction(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-blue-gradient-svg
      {...props}
    >
      <mask
        id="mask0_528_4359"
        style={{ maskType: 'alpha' }}
        width="24"
        height="24"
        x="0"
        y="0"
        maskUnits="userSpaceOnUse"
      >
        <path fill="#525266" d="M0 0H24V24H0z"></path>
      </mask>
      <g mask="url(#mask0_528_4359)">
        <path
          fill={`url(#${id})`}
          d="M12 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0110 20v-8c0-.55.196-1.02.588-1.412A1.926 1.926 0 0112 10h8c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v8c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0120 22h-8zm0-2h8v-8h-8v8zm-6-2V8c0-.55.196-1.02.588-1.412A1.926 1.926 0 018 6h10v2H8v10H6zm-4-4V4c0-.55.196-1.02.587-1.413A1.926 1.926 0 014 2h10v2H4v10H2z"
        ></path>
      </g>
      <defs>
        <linearGradient id={String(id)} x1="2" x2="22" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function DigestAction(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/DigestGradient.tsx
Tamaño: 851 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

import { ISvgPropsInterface } from '../interfaces/svg-props.interface';

export function DigestGradient({ width = '30', height = '31', ...props }: ISvgPropsInterface) {
  return (
    <svg width={30} height={31} viewBox={`0 0 30 31`} fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M1 19.5L12 25.5L23 19.5M1 13.5L12 19.5L23 13.5M12 1.5L1 7.5L12 13.5L23 7.5L12 1.5Z"
        stroke="url(#paint0_linear_1981_26278)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_1981_26278" x1="12" y1="25.5" x2="12" y2="1.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#14DEEB" />
          <stop offset="1" stopColor="#446EDC" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { ISvgPropsInterface } from '../interfaces/svg-props.interface';
export function DigestGradient({ width = '30', height = '31', ...props }: ISvgPropsInterface) {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Discord.tsx
Tamaño: 1294 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Discord(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="none" viewBox="0 0 16 12" {...props}>
      <path
        fill="url(#paint0_linear_2272_43212)"
        d="M13.553 1.005A13.335 13.335 0 0010.253 0a9.25 9.25 0 00-.423.85C8.599.672 7.38.672 6.17.85A8.973 8.973 0 005.744 0 13.291 13.291 0 002.44 1.007C.351 4.066-.215 7.05.068 9.99a13.36 13.36 0 004.048 2.01c.326-.435.617-.897.867-1.384a8.648 8.648 0 01-1.365-.644c.115-.082.227-.168.335-.256 2.632 1.193 5.493 1.193 8.094 0 .11.088.222.174.335.256-.433.253-.891.47-1.368.646.25.485.54.948.867 1.383a13.336 13.336 0 004.051-2.011c.332-3.409-.568-6.364-2.379-8.984zm-8.21 7.176c-.791 0-1.44-.715-1.44-1.586 0-.87.635-1.586 1.44-1.586.803 0 1.451.715 1.438 1.586 0 .87-.635 1.586-1.439 1.586zm5.315 0c-.79 0-1.439-.715-1.439-1.586 0-.87.635-1.586 1.439-1.586s1.452.715 1.438 1.586c0 .87-.634 1.586-1.438 1.586z"
      ></path>
      <defs>
        <linearGradient id="paint0_linear_2272_43212" x1="0" x2="16" y1="6" y2="6" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Discord(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="none" viewBox="0 0 16 12" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/DotsHorizontal.tsx
Tamaño: 838 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function DotsHorizontal(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M20.625 15.5C20.625 16.5547 21.4453 17.375 22.5 17.375C23.5156 17.375 24.375 16.5547 24.375 15.5C24.375 14.4844 23.5156 13.625 22.5 13.625C21.4453 13.625 20.625 14.4844 20.625 15.5ZM9.375 15.5C9.375 14.4844 8.51562 13.625 7.5 13.625C6.44531 13.625 5.625 14.4844 5.625 15.5C5.625 16.5547 6.44531 17.375 7.5 17.375C8.51562 17.375 9.375 16.5547 9.375 15.5ZM16.875 15.5C16.875 14.4844 16.0156 13.625 15 13.625C13.9453 13.625 13.125 14.4844 13.125 15.5C13.125 16.5547 13.9453 17.375 15 17.375C16.0156 17.375 16.875 16.5547 16.875 15.5Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function DotsHorizontal(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/DotsHorizontalOutlined.tsx
Tamaño: 1066 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function DotsHorizontalOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <rect x="0.5" y="0.5" width="29" height="29" rx="14.5" fill="transparent" />
      <path
        d="M18.9375 14.75C18.9375 15.4883 19.5117 16.0625 20.25 16.0625C20.9609 16.0625 21.5625 15.4883 21.5625 14.75C21.5625 14.0391 20.9609 13.4375 20.25 13.4375C19.5117 13.4375 18.9375 14.0391 18.9375 14.75ZM11.0625 14.75C11.0625 14.0391 10.4609 13.4375 9.75 13.4375C9.01172 13.4375 8.4375 14.0391 8.4375 14.75C8.4375 15.4883 9.01172 16.0625 9.75 16.0625C10.4609 16.0625 11.0625 15.4883 11.0625 14.75ZM16.3125 14.75C16.3125 14.0391 15.7109 13.4375 15 13.4375C14.2617 13.4375 13.6875 14.0391 13.6875 14.75C13.6875 15.4883 14.2617 16.0625 15 16.0625C15.7109 16.0625 16.3125 15.4883 16.3125 14.75Z"
        fill="#828299"
      />
      <rect x="0.5" y="0.5" width="29" height="29" rx="14.5" stroke="currentColor" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function DotsHorizontalOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<rect x="0.5" y="0.5" width="29" height="29" rx="14.5" fill="transparent" />
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Drag.tsx
Tamaño: 1214 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Drag(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M10 3C10.5523 3 11 2.55228 11 2C11 1.44772 10.5523 1 10 1C9.44772 1 9 1.44772 9 2C9 2.55228 9.44772 3 10 3ZM10 7C10.5523 7 11 6.55228 11 6C11 5.44772 10.5523 5 10 5C9.44772 5 9 5.44772 9 6C9 6.55228 9.44772 7 10 7ZM10 11C10.5523 11 11 10.5523 11 10C11 9.44771 10.5523 9 10 9C9.44772 9 9 9.44771 9 10C9 10.5523 9.44772 11 10 11ZM7 14C7 14.5523 6.55228 15 6 15C5.44772 15 5 14.5523 5 14C5 13.4477 5.44772 13 6 13C6.55228 13 7 13.4477 7 14ZM11 14C11 14.5523 10.5523 15 10 15C9.44772 15 9 14.5523 9 14C9 13.4477 9.44772 13 10 13C10.5523 13 11 13.4477 11 14ZM7 10C7 10.5523 6.55228 11 6 11C5.44772 11 5 10.5523 5 10C5 9.44771 5.44772 9 6 9C6.55228 9 7 9.44771 7 10ZM7 6C7 6.55228 6.55228 7 6 7C5.44772 7 5 6.55228 5 6C5 5.44772 5.44772 5 6 5C6.55228 5 7 5.44772 7 6ZM7 2C7 2.55228 6.55228 3 6 3C5.44772 3 5 2.55228 5 2C5 1.44772 5.44772 1 6 1C6.55228 1 7 1.44772 7 2Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Drag(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Ellipse.tsx
Tamaño: 758 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Ellipse(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <circle cx="11" cy="11.5" r="10" stroke="rgb(130, 130, 153)" strokeWidth="2" />
      <path
        d="M11 4.5C11.9193 4.5 12.8295 4.68106 13.6788 5.03284C14.5281 5.38463 15.2997 5.90024 15.9497 6.55025C16.5998 7.20026 17.1154 7.97194 17.4672 8.82122C17.8189 9.6705 18 10.5807 18 11.5C18 12.4193 17.8189 13.3295 17.4672 14.1788C17.1154 15.0281 16.5998 15.7997 15.9497 16.4497C15.2997 17.0998 14.5281 17.6154 13.6788 17.9672C12.8295 18.3189 11.9193 18.5 11 18.5L11 4.5Z"
        fill="rgb(130, 130, 153)"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Ellipse(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<circle cx="11" cy="11.5" r="10" stroke="rgb(130, 130, 153)" strokeWidth="2" />
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/EmailFilled.tsx
Tamaño: 1185 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function EmailFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-workflow-node-icon
      {...props}
    >
      <path
        fill={`url(#${id})`}
        d="M20.659 8.958a.212.212 0 01.341.165v7.19c0 .931-.756 1.687-1.688 1.687H4.688A1.688 1.688 0 013 16.312V9.128c0-.176.2-.275.341-.166.788.612 1.832 1.389 5.418 3.994.741.541 1.993 1.68 3.241 1.674 1.255.01 2.531-1.154 3.245-1.674 3.586-2.605 4.627-3.385 5.414-3.997zM12 13.5c.816.014 1.99-1.027 2.58-1.456 4.666-3.385 5.02-3.68 6.097-4.524A.841.841 0 0021 6.855v-.668c0-.931-.756-1.687-1.688-1.687H4.688C3.756 4.5 3 5.256 3 6.188v.667c0 .26.12.503.323.665 1.076.84 1.431 1.139 6.097 4.524.59.43 1.764 1.47 2.58 1.456z"
      ></path>
      <defs>
        <linearGradient id={String(id)} x1="3" x2="21" y1="11.25" y2="11.25" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function EmailFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/EmptySearch.tsx
Tamaño: 2188 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function EmptySearch(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none" {...props}>
      <mask
        id="mask0_1199_80915"
        style={{ maskType: 'alpha' }}
        maskUnits="userSpaceOnUse"
        x="0"
        y="0"
        width="48"
        height="48"
      >
        <rect width="48" height="48" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_1199_80915)">
        <path
          d="M13.6667 44C11.0111 44 8.73612 43.0528 6.84165 41.1583C4.94722 39.2639 4 36.9889 4 34.3333C4 31.6778 4.94722 29.4028 6.84165 27.5084C8.73612 25.6139 11.0111 24.6667 13.6667 24.6667C16.3222 24.6667 18.5972 25.6139 20.4917 27.5084C22.3861 29.4028 23.3333 31.6778 23.3333 34.3333C23.3333 36.9889 22.3861 39.2639 20.4917 41.1583C18.5972 43.0528 16.3222 44 13.6667 44ZM41.6 42L28.5667 28.9667C28.2556 29.2111 27.9056 29.45 27.5167 29.6833C27.1278 29.9167 26.7555 30.1111 26.4 30.2667C26.1555 29.8111 25.8916 29.3472 25.6083 28.875C25.325 28.4028 25.0222 27.9667 24.7 27.5667C26.3222 26.8334 27.6778 25.7056 28.7667 24.1833C29.8556 22.6611 30.4 20.8889 30.4 18.8666C30.4 16.2333 29.475 13.9861 27.625 12.125C25.775 10.2639 23.5333 9.3333 20.9 9.3333C18.2444 9.3333 15.9861 10.2639 14.125 12.125C12.2639 13.9861 11.3333 16.2333 11.3333 18.8666C11.3333 19.3111 11.375 19.7695 11.4583 20.2417C11.5416 20.7139 11.6444 21.1278 11.7667 21.4833C11.2778 21.55 10.7361 21.6667 10.1417 21.8333C9.54722 22 9.01112 22.1945 8.53335 22.4167C8.35555 21.8945 8.22222 21.3278 8.13335 20.7167C8.04445 20.1056 8 19.4889 8 18.8666C8 15.2778 9.25278 12.2361 11.7584 9.74165C14.2639 7.24722 17.3111 6 20.9 6C24.4667 6 27.4972 7.25278 29.9917 9.75835C32.4861 12.2639 33.7334 15.3 33.7334 18.8666C33.7334 20.3 33.4917 21.6972 33.0084 23.0583C32.525 24.4194 31.8611 25.6222 31.0167 26.6667L44 39.6L41.6 42ZM10.1834 39.1166L13.6667 35.6333L17.1 39.0833L18.35 37.85L14.8667 34.3667L18.4167 30.8167L17.1833 29.5833L13.6667 33.1L10.15 29.5833L8.91665 30.8167L12.4334 34.3333L8.91665 37.85L10.1834 39.1166Z"
          fill="#525266"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function EmptySearch(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none" {...props}>
<mask
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ErrorIcon.tsx
Tamaño: 875 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ErrorIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M11 0.9375C5.28516 0.9375 0.6875 5.57812 0.6875 11.25C0.6875 16.9648 5.28516 21.5625 11 21.5625C16.6719 21.5625 21.3125 16.9648 21.3125 11.25C21.3125 5.57812 16.6719 0.9375 11 0.9375ZM9.96875 6.78125C9.96875 6.22266 10.3984 5.75 11 5.75C11.5586 5.75 12.0312 6.22266 12.0312 6.78125V12.2812C12.0312 12.8828 11.5586 13.3125 11 13.3125C10.3984 13.3125 9.96875 12.8828 9.96875 12.2812V6.78125ZM11 17.4375C10.2266 17.4375 9.625 16.8359 9.625 16.1055C9.625 15.375 10.2266 14.7734 11 14.7734C11.7305 14.7734 12.332 15.375 12.332 16.1055C12.332 16.8359 11.7305 17.4375 11 17.4375Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ErrorIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/EyeShield.tsx
Tamaño: 1286 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function EyeShield(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <circle cx="15" cy="13" r="1.25" stroke="#525266" />
      <path
        d="M19.4101 11.9547C19.8088 12.3943 20.0081 12.6141 20.0081 13C20.0081 13.3859 19.8088 13.6057 19.4101 14.0453C18.4748 15.0767 16.849 16.5 15 16.5C13.151 16.5 11.5252 15.0767 10.5899 14.0453C10.1912 13.6057 9.99188 13.3859 9.99188 13C9.99188 12.6141 10.1912 12.3943 10.5899 11.9547C11.5252 10.9233 13.151 9.5 15 9.5C16.849 9.5 18.4748 10.9233 19.4101 11.9547Z"
        stroke="currentColor"
        strokeWidth="2"
      />
      <path
        d="M23.462 6.28862L23.0681 7.20776L23.462 6.28862L15.7878 2.99968C15.2847 2.78406 14.7153 2.78406 14.2122 2.99968L6.53797 6.28862C5.72805 6.63572 5.24073 7.472 5.33804 8.34777L6.23939 16.4599C6.43906 18.2569 7.3263 19.907 8.71529 21.0644L13.7196 25.2347C14.4613 25.8528 15.5387 25.8528 16.2804 25.2347L21.2847 21.0644C22.6737 19.907 23.5609 18.2569 23.7606 16.4599L24.662 8.34777C24.7593 7.47199 24.2719 6.63572 23.462 6.28862Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function EyeShield(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<circle cx="15" cy="13" r="1.25" stroke="#525266" />
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Folder.tsx
Tamaño: 951 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Folder(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <mask
        id="mask0_2372_138258"
        style={{ maskType: 'alpha' }}
        maskUnits="userSpaceOnUse"
        x="0"
        y="0"
        width="20"
        height="20"
      >
        <rect width="20" height="20" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_2372_138258)">
        <path
          d="M3.5 16C3.09722 16 2.74653 15.8507 2.44792 15.5521C2.14931 15.2535 2 14.9028 2 14.5V5.5C2 5.08333 2.14931 4.72917 2.44792 4.4375C2.74653 4.14583 3.09722 4 3.5 4H8L10 6H16.5C16.9167 6 17.2708 6.14583 17.5625 6.4375C17.8542 6.72917 18 7.08333 18 7.5V14.5C18 14.9028 17.8542 15.2535 17.5625 15.5521C17.2708 15.8507 16.9167 16 16.5 16H3.5Z"
          fill="#525266"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Folder(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/HalfClock.tsx
Tamaño: 2450 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function HalfClock(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
      <mask
        id="mask0_433_2481"
        style={{ maskType: 'alpha' }}
        width="24"
        height="24"
        x="0"
        y="0"
        maskUnits="userSpaceOnUse"
      >
        <path fill="#525266" d="M0 0H24V24H0z"></path>
      </mask>
      <g mask="url(#mask0_433_2481)">
        <path
          fill="currentColor"
          d="M15.25 5c-.35 0-.646-.12-.887-.362A1.207 1.207 0 0114 3.75c0-.35.12-.646.363-.888.241-.241.537-.362.887-.362s.646.12.887.362c.242.242.363.538.363.888s-.12.646-.363.888A1.207 1.207 0 0115.25 5zm0 16.5c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0114 20.25c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm4-13c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0118 7.25c0-.35.12-.646.363-.888.241-.241.537-.362.887-.362s.646.12.887.362c.242.242.363.538.363.888s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm0 9.5c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0118 16.75c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm1.5-4.75c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0119.5 12c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zM12 22a9.738 9.738 0 01-3.9-.788 10.099 10.099 0 01-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 012 12c0-1.383.263-2.683.788-3.9a10.099 10.099 0 012.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0112 2v2c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20v2zm0-8c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0110 12c0-.083.004-.17.012-.262a.929.929 0 01.063-.263L8 9.4 9.4 8l2.075 2.075c.067-.017.242-.042.525-.075.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0112 14z"
        ></path>
      </g>
      <defs>
        <linearGradient id="paint0_linear_433_2481" x1="2" x2="22" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function HalfClock(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/IframeLogo.tsx
Tamaño: 863 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const IframeLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
      <g clipPath="url(#a)">
        <path
          fill="#828299"
          d="M14.731 2.244a1.201 1.201 0 0 0-1.485.825l-4.8 16.802a1.201 1.201 0 1 0 2.31.66l4.8-16.802a1.201 1.201 0 0 0-.825-1.485Zm3.023 4.504a1.202 1.202 0 0 0 0 1.7l3.349 3.352-3.353 3.353a1.202 1.202 0 0 0 1.7 1.699l4.2-4.2a1.202 1.202 0 0 0 0-1.7l-4.2-4.2a1.202 1.202 0 0 0-1.7 0l.004-.004Zm-11.502 0a1.202 1.202 0 0 0-1.7 0l-4.2 4.2a1.202 1.202 0 0 0 0 1.7l4.2 4.2a1.202 1.202 0 0 0 1.7-1.699L2.899 11.8l3.353-3.353a1.202 1.202 0 0 0 0-1.699Z"
        />
      </g>
      <defs>
        <clipPath id="a">
          <path fill="#fff" d="M0 0h24v24H0z" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const IframeLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
<g clipPath="url(#a)">
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/InApp.tsx
Tamaño: 731 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function InApp(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <path
        d="M10 18C11.0938 18 12 17.125 12 16H8C8 17.125 8.875 18 10 18ZM16.7188 13.3438C16.125 12.6875 14.9688 11.7188 14.9688 8.5C14.9688 6.09375 13.2812 4.15625 11 3.65625V3C11 2.46875 10.5312 2 10 2C9.4375 2 9 2.46875 9 3V3.65625C6.6875 4.15625 5 6.09375 5 8.5C5 11.7188 3.84375 12.6875 3.25 13.3438C3.0625 13.5312 3 13.7812 3 14C3 14.5312 3.40625 15 4 15H15.9688C16.5938 15 16.9688 14.5312 17 14C17 13.7812 16.9062 13.5312 16.7188 13.3438Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function InApp(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/InAppFilled.tsx
Tamaño: 1057 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function InAppFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-workflow-node-icon
      {...props}
    >
      <path
        fill={`url(#${id})`}
        d="M12 21c1.183 0 2.142-1.007 2.142-2.25H9.858c0 1.243.96 2.25 2.142 2.25zm7.212-5.263c-.647-.73-1.858-1.828-1.858-5.425 0-2.731-1.824-4.918-4.283-5.454v-.733C13.07 3.504 12.59 3 12 3s-1.07.504-1.07 1.125v.733c-2.46.536-4.284 2.723-4.284 5.455 0 3.596-1.21 4.694-1.858 5.424-.2.226-.29.498-.288.763.004.577.435 1.125 1.075 1.125h12.85c.64 0 1.072-.548 1.075-1.125a1.128 1.128 0 00-.288-.763z"
      ></path>
      <defs>
        <linearGradient id={String(id)} x1="4.5" x2="19.5" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function InAppFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/InfoCircle.tsx
Tamaño: 2064 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function InfoCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none" {...props}>
      <g clipPath="url(#clip0_943_34508)">
        <path
          d="M14.5 8.5C14.5 6.77609 13.8152 5.12279 12.5962 3.90381C11.3772 2.68482 9.72391 2 8 2C6.27609 2 4.62279 2.68482 3.40381 3.90381C2.18482 5.12279 1.5 6.77609 1.5 8.5C1.5 10.2239 2.18482 11.8772 3.40381 13.0962C4.62279 14.3152 6.27609 15 8 15C9.72391 15 11.3772 14.3152 12.5962 13.0962C13.8152 11.8772 14.5 10.2239 14.5 8.5ZM0 8.5C0 6.37827 0.842855 4.34344 2.34315 2.84315C3.84344 1.34285 5.87827 0.5 8 0.5C10.1217 0.5 12.1566 1.34285 13.6569 2.84315C15.1571 4.34344 16 6.37827 16 8.5C16 10.6217 15.1571 12.6566 13.6569 14.1569C12.1566 15.6571 10.1217 16.5 8 16.5C5.87827 16.5 3.84344 15.6571 2.34315 14.1569C0.842855 12.6566 0 10.6217 0 8.5ZM5.30625 5.66563C5.55312 4.96875 6.21563 4.5 6.95625 4.5H8.77812C9.86875 4.5 10.75 5.38438 10.75 6.47188C10.75 7.17813 10.3719 7.83125 9.75937 8.18437L8.75 8.7625C8.74375 9.16875 8.40938 9.5 8 9.5C7.58437 9.5 7.25 9.16562 7.25 8.75V8.32812C7.25 8.05937 7.39375 7.8125 7.62813 7.67812L9.0125 6.88438C9.15938 6.8 9.25 6.64375 9.25 6.475C9.25 6.2125 9.0375 6.00313 8.77812 6.00313H6.95625C6.85 6.00313 6.75625 6.06875 6.72188 6.16875L6.70937 6.20625C6.57188 6.59688 6.14062 6.8 5.75313 6.6625C5.36563 6.525 5.15938 6.09375 5.29688 5.70625L5.30937 5.66875L5.30625 5.66563ZM7 11.5C7 11.2348 7.10536 10.9804 7.29289 10.7929C7.48043 10.6054 7.73478 10.5 8 10.5C8.26522 10.5 8.51957 10.6054 8.70711 10.7929C8.89464 10.9804 9 11.2348 9 11.5C9 11.7652 8.89464 12.0196 8.70711 12.2071C8.51957 12.3946 8.26522 12.5 8 12.5C7.73478 12.5 7.48043 12.3946 7.29289 12.2071C7.10536 12.0196 7 11.7652 7 11.5Z"
          fill="currentColor"
        />
      </g>
      <defs>
        <clipPath id="clip0_943_34508">
          <rect width="16" height="16" fill="white" transform="translate(0 0.5)" />
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function InfoCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none" {...props}>
<g clipPath="url(#clip0_943_34508)">
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/InviteMembers.tsx
Tamaño: 2781 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function InviteMembers(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <mask
        id="mask0_1537_455"
        style={{ maskType: 'alpha' }}
        maskUnits="userSpaceOnUse"
        x="0"
        y="0"
        width="20"
        height="20"
      >
        <rect width="20" height="20" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_1537_455)">
        <path
          d="M9.375 9.9375C9.73611 9.52083 10.0139 9.06167 10.2083 8.56002C10.4028 8.05837 10.5 7.53836 10.5 7C10.5 6.46649 10.4028 5.95117 10.2083 5.45404C10.0139 4.9569 9.73611 4.49306 9.375 4.0625C9.48611 4.03472 9.59028 4.01736 9.6875 4.01042C9.78472 4.00347 9.88889 4 10 4C10.8333 4 11.5417 4.29167 12.125 4.875C12.7083 5.45833 13 6.16667 13 7C13 7.83333 12.7083 8.54167 12.125 9.125C11.5417 9.70833 10.8333 10 10 10C9.88889 10 9.78125 9.99653 9.67708 9.98958C9.57292 9.98264 9.47222 9.96528 9.375 9.9375ZM13.5 16V14.0833C13.5 13.5139 13.3681 12.9826 13.1042 12.4896C12.8403 11.9965 12.4722 11.5764 12 11.2292C12.9444 11.4514 13.8472 11.7569 14.7083 12.1458C15.5694 12.5347 16 13.1806 16 14.0833V16H13.5ZM16.25 11V9.25H14.5V7.75H16.25V6H17.75V7.75H19.5V9.25H17.75V11H16.25ZM6 10C5.16667 10 4.45833 9.70833 3.875 9.125C3.29167 8.54167 3 7.83333 3 7C3 6.16667 3.29167 5.45833 3.875 4.875C4.45833 4.29167 5.16667 4 6 4C6.83333 4 7.54167 4.29167 8.125 4.875C8.70833 5.45833 9 6.16667 9 7C9 7.83333 8.70833 8.54167 8.125 9.125C7.54167 9.70833 6.83333 10 6 10ZM0 16V14.0833C0 13.7305 0.0868056 13.4061 0.260417 13.1104C0.434028 12.8146 0.673611 12.5694 0.979167 12.375C1.72917 11.9028 2.53151 11.5556 3.38621 11.3333C4.24092 11.1111 5.10897 11 5.99038 11C6.87179 11 7.73611 11.1181 8.58333 11.3542C9.43056 11.5903 10.2431 11.9306 11.0208 12.375C11.3125 12.5694 11.5486 12.8146 11.7292 13.1104C11.9097 13.4061 12 13.7305 12 14.0833V16H0ZM5.98967 8.5C6.39933 8.5 6.75347 8.35414 7.05208 8.06242C7.35069 7.77068 7.5 7.41999 7.5 7.01033C7.5 6.60067 7.35069 6.24653 7.05208 5.94792C6.75347 5.64931 6.39933 5.5 5.98967 5.5C5.58001 5.5 5.22932 5.64931 4.93758 5.94792C4.64586 6.24653 4.5 6.60067 4.5 7.01033C4.5 7.41999 4.64586 7.77068 4.93758 8.06242C5.22932 8.35414 5.58001 8.5 5.98967 8.5ZM1.5 14.5H10.5V14.0833C10.5 13.999 10.4792 13.9224 10.4375 13.8535C10.3958 13.7845 10.3403 13.7222 10.2708 13.6667C9.60417 13.3056 8.91319 13.0208 8.19792 12.8125C7.48264 12.6042 6.74653 12.5 5.98958 12.5C5.23264 12.5 4.49653 12.6007 3.78125 12.8021C3.06597 13.0035 2.38194 13.2917 1.72917 13.6667C1.65972 13.7222 1.60417 13.7845 1.5625 13.8535C1.52083 13.9224 1.5 13.999 1.5 14.0833V14.5Z"
          fill="currentColor"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function InviteMembers(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<mask
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/JavaScriptLogo.tsx
Tamaño: 1426 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const JavaScriptLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
      <g clipPath="url(#a)">
        <path fill="#FFE93E" d="M0 4a4 4 0 0 1 4-4h16a4 4 0 0 1 4 4v16a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4Z" />
        <path
          fill="#13131A"
          d="M22.035 18.276c-.175-1.095-.89-2.014-3.004-2.872-.735-.338-1.554-.58-1.798-1.136-.087-.324-.098-.507-.043-.703.157-.636.917-.835 1.52-.652.387.13.754.429.976.905 1.035-.67 1.033-.666 1.756-1.127-.264-.41-.406-.6-.58-.775-.622-.696-1.47-1.054-2.828-1.027-.235.03-.472.062-.707.091-.678.171-1.324.527-1.702 1.004-1.136 1.29-.812 3.545.57 4.474 1.362 1.022 3.363 1.255 3.618 2.21.249 1.171-.86 1.55-1.962 1.415-.812-.169-1.264-.582-1.752-1.332-.899.52-.899.52-1.822 1.051.219.48.449.696.816 1.111 1.739 1.764 6.09 1.677 6.87-.992.031-.091.241-.703.072-1.645Zm-8.988-7.245h-2.245c0 1.939-.01 3.864-.01 5.803 0 1.235.065 2.366-.136 2.713-.329.682-1.18.598-1.567.465-.395-.194-.596-.47-.829-.86-.063-.111-.111-.198-.127-.205-.61.372-1.216.746-1.825 1.118.303.623.75 1.163 1.323 1.515.855.513 2.005.67 3.207.394.783-.228 1.458-.7 1.812-1.419.51-.942.401-2.083.397-3.344.011-2.058 0-4.116 0-6.18Z"
        />
      </g>
      <defs>
        <clipPath id="a">
          <path fill="#fff" d="M0 0h24v24H0z" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const JavaScriptLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
<g clipPath="url(#a)">
<path fill="#FFE93E" d="M0 4a4 4 0 0 1 4-4h16a4 4 0 0 1 4 4v16a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4Z" />
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/LetterOpened.tsx
Tamaño: 4442 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const LetterOpened = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 148 133" {...props}>
      <path
        fill="url(#a)"
        d="M59.743 3.74 2.08 51.174a7.67 7.67 0 0 0 3.727.742l109.251-5.664a7.682 7.682 0 0 0 4.851-2.054L77.028 4.228C72.373-.11 64.689-.327 59.743 3.74Z"
      />
      <path
        fill="url(#b)"
        d="M112.86 132.169H7.688c-4.245 0-7.688-3.425-7.688-7.65V56.377c0-4.06 3.187-7.412 7.26-7.639l109.23-6.058c4.573-.254 8.354 3.503 8.105 8.054l-4.059 74.2c-.222 4.058-3.593 7.235-7.676 7.235Z"
      />
      <path
        fill="url(#c)"
        d="m62.73 91.05 57.49-47.641a7.672 7.672 0 0 0-3.73-.73L7.26 48.739a7.68 7.68 0 0 0-4.842 2.07l43.026 39.816c4.671 4.322 12.356 4.511 17.286.426Z"
      />
      <mask id="d" width="116" height="89" x="3" y="6" maskUnits="userSpaceOnUse" style={{ maskType: 'luminance' }}>
        <path
          fill="#fff"
          d="m62.729 91.06 55.651-46.118c.867-.719.43-2.117-.693-2.228-.391-.039-.791-36.314-1.197-36.29L7.26 12.481c-1.301.072-2.512 36.729-3.558 37.361-.71.43-.794 1.428-.185 1.992l41.927 38.798c4.671 4.323 12.355 4.512 17.285.426Z"
        />
      </mask>
      <g mask="url(#d)">
        <path
          fill="url(#e)"
          d="M104.237 103.569H17.643V21.445c0-3.143 2.937-5.74 6.695-5.92l72.386-3.483c4.078-.196 7.513 2.511 7.513 5.921v85.606Z"
        />
        <path
          fill="url(#f)"
          d="M101.276 103.57H20.607V27.067c0-2.928 2.737-5.348 6.238-5.516l67.432-3.244c3.798-.183 6.999 2.34 6.999 5.516v79.747Z"
        />
      </g>
      <g filter="url(#g)">
        <path
          fill="url(#h)"
          fillRule="evenodd"
          d="M90.529 88.405c12.393 0 22.529-10.055 22.529-22.41s-10.136-22.383-22.529-22.383C78.135 43.612 68 53.667 68 66.022c0 12.354 10.108 22.41 22.529 22.41v-.027Z"
          clipRule="evenodd"
        />
        <path
          fill="#fff"
          fillOpacity=".74"
          d="m87.89 74.387-6.598-6.564c-.277-.276-.277-.76 0-1.106l1.042-1.036c.278-.277.764-.277 1.111 0l5 4.975L99.556 59.6c.278-.276.764-.276 1.111 0l1.042 1.036c.278.277.278.76 0 1.106L89.001 74.387c-.348.277-.834.277-1.11 0Z"
        />
      </g>
      <defs>
        <linearGradient id="a" x1="63.845" x2="62.6" y1="46.221" y2=".782" gradientUnits="userSpaceOnUse">
          <stop stopColor="#A9A9B9" />
          <stop offset="1" stopColor="#B1B1C6" />
        </linearGradient>
        <linearGradient id="b" x1="62.303" x2="62.303" y1="132.169" y2="42.668" gradientUnits="userSpaceOnUse">
          <stop stopColor="#BEBECC" />
          <stop offset="1" stopColor="#fff" />
        </linearGradient>
        <linearGradient id="c" x1="61.319" x2="61.319" y1="42.667" y2="93.994" gradientUnits="userSpaceOnUse">
          <stop stopColor="#73738F" />
          <stop offset="1" stopColor="#21212D" />
        </linearGradient>
        <linearGradient id="e" x1="60.94" x2="60.94" y1="12.032" y2="103.569" gradientUnits="userSpaceOnUse">
          <stop stopColor="#353544" />
          <stop offset="1" stopColor="#232335" stopOpacity=".98" />
        </linearGradient>
        <linearGradient id="f" x1="60.942" x2="60.942" y1="103.57" y2="18.298" gradientUnits="userSpaceOnUse">
          <stop stopColor="#BEBECC" />
          <stop offset="1" stopColor="#fff" />
        </linearGradient>
        <linearGradient id="h" x1="68" x2="113.058" y1="66.022" y2="66.022" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <filter
          id="g"
          width="93.058"
          height="92.819"
          x="54"
          y="29.612"
          colorInterpolationFilters="sRGB"
          filterUnits="userSpaceOnUse"
        >
          <feFlood floodOpacity="0" result="BackgroundImageFix" />
          <feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" />
          <feOffset dx="10" dy="10" />
          <feGaussianBlur stdDeviation="12" />
          <feColorMatrix values="0 0 0 0 0.133333 0 0 0 0 0.160784 0 0 0 0 0.192157 0 0 0 0.24 0" />
          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_1338_3001" />
          <feBlend in="SourceGraphic" in2="effect1_dropShadow_1338_3001" result="shape" />
        </filter>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const LetterOpened = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 148 133" {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Lock.tsx
Tamaño: 910 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Lock(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M5 15.25C5 13.3644 5 12.4216 5.58579 11.8358C6.17157 11.25 7.11438 11.25 9 11.25H21C22.8856 11.25 23.8284 11.25 24.4142 11.8358C25 12.4216 25 13.3644 25 15.25V20.25C25 23.0784 25 24.4926 24.1213 25.3713C23.2426 26.25 21.8284 26.25 19 26.25H11C8.17157 26.25 6.75736 26.25 5.87868 25.3713C5 24.4926 5 23.0784 5 20.25V15.25Z"
        stroke="currentColor"
        strokeWidth="2"
      />
      <path
        d="M20 10V8.75C20 5.98858 17.7614 3.75 15 3.75V3.75C12.2386 3.75 10 5.98858 10 8.75V10"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <circle cx="15" cy="18.75" r="2.5" fill="currentColor" />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Lock(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Logout.tsx
Tamaño: 893 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Logout(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <mask
        id="mask0_1343_491"
        style={{ maskType: 'alpha' }}
        maskUnits="userSpaceOnUse"
        x="0"
        y="0"
        width="20"
        height="20"
      >
        <rect width="20" height="20" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_1343_491)">
        <path
          d="M4.5 17C4.0875 17 3.73437 16.8531 3.44062 16.5594C3.14687 16.2656 3 15.9125 3 15.5V4.5C3 4.0875 3.14687 3.73438 3.44063 3.44063C3.73437 3.14688 4.0875 3 4.5 3H10V4.5H4.5V15.5H10V17H4.5ZM13.5 13.5L12.4375 12.4375L14.125 10.75H8V9.25H14.125L12.4375 7.5625L13.5 6.5L17 10L13.5 13.5Z"
          fill="currentColor"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Logout(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<mask
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/MadeByNovu.tsx
Tamaño: 6221 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const MadeByNovu = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" {...props}>
      <path
        fill="currentColor"
        d="M10.044 6.402V15h-1.02V8.682c0-.084.002-.174.006-.27l.024-.294-2.952 5.376c-.092.18-.232.27-.42.27h-.168c-.188 0-.328-.09-.42-.27l-3.012-5.4c.024.212.036.408.036.588V15h-1.02V6.402h.858c.104 0 .184.01.24.03.056.02.11.076.162.168l2.97 5.292c.048.096.094.196.138.3.048.104.092.21.132.318.04-.108.082-.214.126-.318.044-.108.092-.21.144-.306L8.784 6.6c.048-.092.1-.148.156-.168.06-.02.142-.03.246-.03h.858Zm5.065 5.862a8.645 8.645 0 0 0-1.26.12c-.344.06-.626.14-.846.24-.216.1-.374.218-.474.354a.772.772 0 0 0-.144.456c0 .16.026.298.078.414a.814.814 0 0 0 .21.288.956.956 0 0 0 .318.162c.124.032.256.048.396.048.188 0 .36-.018.516-.054.156-.04.302-.096.438-.168.14-.072.272-.158.396-.258.128-.1.252-.214.372-.342v-1.26Zm-3.45-2.484a3.47 3.47 0 0 1 1.086-.726c.388-.16.818-.24 1.29-.24.34 0 .642.056.906.168.264.112.486.268.666.468.18.2.316.442.408.726.092.284.138.596.138.936V15h-.474a.49.49 0 0 1-.24-.048c-.056-.036-.1-.104-.132-.204l-.12-.576c-.16.148-.316.28-.468.396a2.935 2.935 0 0 1-.48.288 2.585 2.585 0 0 1-.54.174 2.77 2.77 0 0 1-.63.066c-.236 0-.458-.032-.666-.096a1.61 1.61 0 0 1-.546-.3 1.453 1.453 0 0 1-.366-.498 1.807 1.807 0 0 1-.132-.72c0-.24.066-.47.198-.69.132-.224.346-.422.642-.594.296-.172.682-.312 1.158-.42.476-.112 1.06-.176 1.752-.192v-.474c0-.472-.102-.828-.306-1.068-.204-.244-.502-.366-.894-.366-.264 0-.486.034-.666.102-.176.064-.33.138-.462.222-.128.08-.24.154-.336.222a.48.48 0 0 1-.276.096.319.319 0 0 1-.186-.054.57.57 0 0 1-.132-.144l-.192-.342Zm10.08.588c-.2-.268-.415-.454-.647-.558a1.826 1.826 0 0 0-.78-.162c-.564 0-.998.202-1.302.606-.304.404-.456.98-.456 1.728 0 .396.034.736.102 1.02.068.28.168.512.3.696.132.18.294.312.486.396.192.084.41.126.654.126.352 0 .658-.08.918-.24.264-.16.506-.386.726-.678v-2.934Zm1.069-4.206V15h-.636c-.152 0-.248-.074-.288-.222l-.096-.738a3.31 3.31 0 0 1-.888.756 2.26 2.26 0 0 1-1.152.288c-.348 0-.664-.066-.948-.198a1.994 1.994 0 0 1-.726-.594c-.2-.26-.354-.584-.462-.972a5.004 5.004 0 0 1-.162-1.338c0-.448.06-.864.18-1.248.12-.388.292-.724.516-1.008.224-.284.498-.506.822-.666a2.434 2.434 0 0 1 1.104-.246c.372 0 .69.064.954.192.268.124.506.298.714.522V6.162h1.068Zm5.754 5.136c0-.248-.036-.474-.108-.678a1.437 1.437 0 0 0-.306-.534 1.292 1.292 0 0 0-.486-.348 1.616 1.616 0 0 0-.654-.126c-.512 0-.918.15-1.218.45-.296.296-.48.708-.552 1.236h3.324Zm.864 2.85c-.132.16-.29.3-.474.42a3.022 3.022 0 0 1-.594.288 3.503 3.503 0 0 1-.648.168c-.224.04-.446.06-.666.06-.42 0-.808-.07-1.164-.21a2.636 2.636 0 0 1-.918-.624 2.919 2.919 0 0 1-.6-1.02 4.135 4.135 0 0 1-.216-1.392c0-.424.064-.82.192-1.188.132-.368.32-.686.564-.954.244-.272.542-.484.894-.636a2.902 2.902 0 0 1 1.188-.234c.364 0 .7.062 1.008.186.312.12.58.296.804.528.228.228.406.512.534.852.128.336.192.72.192 1.152 0 .168-.018.28-.054.336-.036.056-.104.084-.204.084h-4.062c.012.384.064.718.156 1.002.096.284.228.522.396.714.168.188.368.33.6.426a2.1 2.1 0 0 0 .78.138c.268 0 .498-.03.69-.09a3.456 3.456 0 0 0 .852-.402.47.47 0 0 1 .246-.096c.088 0 .156.034.204.102l.3.39Zm5.553-.612c.196.264.41.45.642.558.236.108.494.162.774.162.572 0 1.01-.202 1.314-.606.304-.404.456-1.006.456-1.806 0-.744-.136-1.29-.408-1.638-.268-.352-.652-.528-1.152-.528-.348 0-.652.08-.912.24-.256.16-.494.386-.714.678v2.94Zm0-3.738c.256-.296.544-.532.864-.708a2.3 2.3 0 0 1 1.116-.264c.356 0 .676.068.96.204.288.136.532.334.732.594.2.256.352.568.456.936.108.368.162.782.162 1.242 0 .492-.06.94-.18 1.344-.12.404-.294.75-.522 1.038a2.372 2.372 0 0 1-.822.666 2.485 2.485 0 0 1-1.092.234c-.4 0-.738-.074-1.014-.222a2.257 2.257 0 0 1-.714-.642l-.054.552c-.032.152-.124.228-.276.228h-.69V6.162h1.074v3.636Zm10.732-.876-3.39 7.872a.54.54 0 0 1-.138.192c-.052.048-.134.072-.246.072h-.792l1.11-2.412-2.508-5.724h.924c.092 0 .164.024.216.072a.335.335 0 0 1 .114.15l1.626 3.828c.064.168.118.344.162.528.056-.188.116-.366.18-.534l1.578-3.822a.33.33 0 0 1 .12-.156.327.327 0 0 1 .198-.066h.846ZM66.383 3.306A7.963 7.963 0 0 0 62 2c-.89 0-1.748.146-2.548.414l6.13 6.17c.295.297.801.089.801-.33V3.307Z"
      />
      <path
        fill="currentColor"
        d="M57.172 3.62A7.988 7.988 0 0 0 54 10c0 1.512.42 2.927 1.149 4.133v-2.388c0-2.62 3.172-3.928 5.019-2.07l6.66 6.704A7.988 7.988 0 0 0 70 10c0-1.512-.42-2.927-1.149-4.133v2.388c0 2.62-3.172 3.928-5.019 2.07l-6.66-6.704Z"
      />
      <path
        fill="currentColor"
        d="m64.548 17.586-6.13-6.17a.468.468 0 0 0-.801.33v4.948A7.963 7.963 0 0 0 62 18a7.99 7.99 0 0 0 2.548-.414ZM82.064 6.402V15h-.582a.52.52 0 0 1-.234-.048.599.599 0 0 1-.18-.162l-4.974-6.48a7.716 7.716 0 0 1 .024.564V15h-1.02V6.402h.6a.62.62 0 0 1 .228.042.274.274 0 0 1 .084.06.716.716 0 0 1 .09.096l4.974 6.474a47.307 47.307 0 0 0-.024-.3 7.077 7.077 0 0 1-.006-.282v-6.09h1.02Zm4.32 2.424a3.1 3.1 0 0 1 1.2.222c.357.148.66.358.913.63.252.272.444.602.576.99.136.384.204.814.204 1.29 0 .48-.068.912-.204 1.296a2.735 2.735 0 0 1-.576.984 2.572 2.572 0 0 1-.912.63 3.175 3.175 0 0 1-1.2.216c-.448 0-.852-.072-1.212-.216a2.572 2.572 0 0 1-.912-.63 2.805 2.805 0 0 1-.582-.984 3.972 3.972 0 0 1-.198-1.296c0-.476.066-.906.198-1.29.136-.388.33-.718.582-.99.252-.272.556-.482.912-.63.36-.148.764-.222 1.212-.222Zm0 5.424c.6 0 1.049-.2 1.345-.6.296-.404.444-.966.444-1.686 0-.724-.148-1.288-.444-1.692-.296-.404-.744-.606-1.344-.606-.304 0-.57.052-.798.156a1.507 1.507 0 0 0-.564.45c-.148.196-.26.438-.336.726a3.941 3.941 0 0 0-.108.966c0 .72.148 1.282.444 1.686.3.4.754.6 1.362.6Zm9.291-5.328L93.197 15h-.96L89.76 8.922h.87a.33.33 0 0 1 .33.222l1.542 3.912c.048.148.09.292.126.432.036.14.07.28.102.42.032-.14.066-.28.102-.42.036-.14.08-.284.132-.432l1.56-3.912a.33.33 0 0 1 .12-.156.311.311 0 0 1 .198-.066h.834Zm5.978 0V15h-.636c-.152 0-.248-.074-.288-.222l-.084-.654c-.264.292-.56.528-.888.708a2.349 2.349 0 0 1-1.128.264c-.332 0-.626-.054-.882-.162a1.779 1.779 0 0 1-.636-.468 2.01 2.01 0 0 1-.39-.726 3.313 3.313 0 0 1-.126-.942V8.922h1.068v3.876c0 .46.104.816.312 1.068.212.252.534.378.966.378.316 0 .61-.074.882-.222.276-.152.53-.36.762-.624V8.922h1.068Z"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const MadeByNovu = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Mail.tsx
Tamaño: 1361 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Mail(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M10 12.4023C9.53516 12.4023 9.07031 12.2383 8.6875 11.9375L3 7.50781V13.6875C3 14.4258 3.57422 15 4.3125 15H15.6875C16.3984 15 17 14.4258 17 13.6875V7.50781L11.2852 11.9375C10.9023 12.2383 10.4375 12.4023 10 12.4023ZM3.4375 6.74219L9.23438 11.2539C9.67188 11.582 10.3008 11.582 10.7383 11.2539L16.5352 6.74219C16.8086 6.52344 17 6.19531 17 5.8125C17 5.10156 16.3984 4.5 15.6875 4.5H4.3125C3.57422 4.5 3 5.10156 3 5.8125C3 6.19531 3.16406 6.52344 3.4375 6.74219Z"
        fill="currentColor"
      />
    </svg>
  );
}
<svg width="14" height="11" viewBox="0 0 14 11" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path
    d="M7 8.40234C6.53516 8.40234 6.07031 8.23828 5.6875 7.9375L0 3.50781V9.6875C0 10.4258 0.574219 11 1.3125 11H12.6875C13.3984 11 14 10.4258 14 9.6875V3.50781L8.28516 7.9375C7.90234 8.23828 7.4375 8.40234 7 8.40234ZM0.4375 2.74219L6.23438 7.25391C6.67188 7.58203 7.30078 7.58203 7.73828 7.25391L13.5352 2.74219C13.8086 2.52344 14 2.19531 14 1.8125C14 1.10156 13.3984 0.5 12.6875 0.5H1.3125C0.574219 0.5 0 1.10156 0 1.8125C0 2.19531 0.164062 2.52344 0.4375 2.74219Z"
    fill="white"
  />
</svg>;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Mail(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Mobile.tsx
Tamaño: 712 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Mobile(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M12.8125 2.75H6.6875C5.70312 2.75 4.9375 3.54297 4.9375 4.5V15C4.9375 15.9844 5.70312 16.75 6.6875 16.75H12.8125C13.7695 16.75 14.5625 15.9844 14.5625 15V4.5C14.5625 3.54297 13.7695 2.75 12.8125 2.75ZM9.75 15.875C9.25781 15.875 8.875 15.4922 8.875 15C8.875 14.5352 9.25781 14.125 9.75 14.125C10.2148 14.125 10.625 14.5352 10.625 15C10.625 15.4922 10.2148 15.875 9.75 15.875ZM12.8125 4.5V13.25H6.6875V4.5H12.8125Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Mobile(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Moon.tsx
Tamaño: 3409 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Moon(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M22.934 21.1084L23.7253 21.7197C23.729 21.715 23.7326 21.7103 23.7361 21.7055L22.934 21.1084ZM14.0913 5L14.8958 5.59408C15.1299 5.27706 15.156 4.8521 14.9624 4.50881C14.7688 4.16553 14.3917 3.96795 13.9992 4.00425L14.0913 5ZM24.983 15.8063L25.9772 15.6992C25.9418 15.3709 25.7466 15.0812 25.4556 14.9251C25.1646 14.769 24.8153 14.7667 24.5222 14.9188L24.983 15.8063ZM22.1426 20.497C21.0954 21.8526 19.6843 22.8815 18.0743 23.4636L18.7543 25.3444C20.7217 24.6332 22.446 23.3758 23.7253 21.7197L22.1426 20.497ZM18.0743 23.4636C16.4644 24.0456 14.7221 24.1566 13.0514 23.7838L12.6158 25.7358C14.6576 26.1914 16.7868 26.0557 18.7543 25.3444L18.0743 23.4636ZM13.0514 23.7838C11.3808 23.411 9.8506 22.5696 8.64007 21.358L7.22525 22.7716C8.70429 24.2519 10.5741 25.2801 12.6158 25.7358L13.0514 23.7838ZM8.64007 21.358C7.42953 20.1465 6.58869 18.6148 6.21607 16.9422L4.26393 17.3771C4.71909 19.4202 5.74622 21.2914 7.22525 22.7716L8.64007 21.358ZM6.21607 16.9422C5.84344 15.2696 5.95446 13.5254 6.53612 11.9137L4.65489 11.2348C3.94437 13.2036 3.80876 15.3341 4.26393 17.3771L6.21607 16.9422ZM6.53612 11.9137C7.11778 10.302 8.14598 8.8896 9.5003 7.84161L8.27631 6.25988C6.62151 7.5404 5.36541 9.26605 4.65489 11.2348L6.53612 11.9137ZM9.5003 7.84161C10.8546 6.79362 12.479 6.1534 14.1834 5.99575L13.9992 4.00425C11.9162 4.19691 9.93113 4.97934 8.27631 6.25988L9.5003 7.84161ZM13.2869 4.40592C12.036 6.09978 11.4341 8.18663 11.5906 10.2869L13.585 10.1383C13.4641 8.51525 13.9293 6.90274 14.8958 5.59408L13.2869 4.40592ZM11.5906 10.2869C11.7471 12.3872 12.6516 14.3617 14.1398 15.8512L15.5546 14.4376C14.4049 13.287 13.706 11.7614 13.585 10.1383L11.5906 10.2869ZM14.1398 15.8512C15.628 17.3407 17.6012 18.2463 19.7003 18.403L19.8492 16.4085C18.2282 16.2875 16.7042 15.5882 15.5546 14.4376L14.1398 15.8512ZM19.7003 18.403C20.3202 18.4492 20.9977 18.3386 21.6151 18.1847C22.2458 18.0275 22.8814 17.8076 23.4398 17.5897C24.0005 17.371 24.4982 17.1486 24.8553 16.9812C25.0343 16.8973 25.1791 16.8266 25.2802 16.7764C25.3307 16.7513 25.3704 16.7313 25.3981 16.7173C25.4119 16.7102 25.4227 16.7047 25.4304 16.7008C25.4342 16.6988 25.4372 16.6972 25.4395 16.6961C25.4406 16.6955 25.4415 16.695 25.4422 16.6947C25.4426 16.6945 25.4429 16.6943 25.4431 16.6942C25.4433 16.6941 25.4434 16.694 25.4435 16.694C25.4436 16.6939 25.4437 16.6939 24.983 15.8063C24.5222 14.9188 24.5223 14.9188 24.5224 14.9187C24.5224 14.9187 24.5225 14.9187 24.5225 14.9187C24.5225 14.9186 24.5225 14.9186 24.5225 14.9187C24.5224 14.9187 24.5221 14.9189 24.5216 14.9191C24.5206 14.9197 24.5188 14.9206 24.5162 14.9219C24.5111 14.9245 24.5029 14.9287 24.4917 14.9344C24.4694 14.9458 24.4354 14.9629 24.3908 14.9851C24.3015 15.0294 24.1702 15.0935 24.0063 15.1703C23.6775 15.3245 23.2218 15.528 22.713 15.7265C22.2019 15.9258 21.6517 16.1144 21.1314 16.2441C20.598 16.377 20.1594 16.4317 19.8492 16.4085L19.7003 18.403ZM23.7361 21.7055C24.1549 21.143 24.7536 20.2013 25.2277 19.1532C25.6876 18.1365 26.1027 16.8641 25.9772 15.6992L23.9887 15.9135C24.0552 16.5301 23.8273 17.3962 23.4055 18.3289C22.9978 19.2302 22.4761 20.0488 22.1318 20.5113L23.7361 21.7055Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Moon(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/MultiChannel.tsx
Tamaño: 2134 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function MultiChannel(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <mask id="mask0_2135_20239" maskUnits="userSpaceOnUse" x="0" y="0" width="20" height="20">
        <rect width="20" height="20" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_2135_20239)">
        <path
          d="M10.0058 18C8.9047 18 7.86806 17.7917 6.89583 17.375C5.92361 16.9583 5.07292 16.3854 4.34375 15.6562C3.61458 14.9271 3.04167 14.0767 2.625 13.105C2.20833 12.1334 2 11.0952 2 9.99046C2 8.88571 2.20833 7.85069 2.625 6.88542C3.04167 5.92014 3.61458 5.07292 4.34375 4.34375C5.07292 3.61458 5.92332 3.04167 6.89496 2.625C7.86661 2.20833 8.90481 2 10.0095 2C11.1143 2 12.1493 2.20833 13.1146 2.625C14.0799 3.04167 14.9271 3.61458 15.6562 4.34375C16.3854 5.07292 16.9583 5.92169 17.375 6.89008C17.7917 7.85849 18 8.89321 18 9.99425C18 11.0953 17.7917 12.1319 17.375 13.1042C16.9583 14.0764 16.3854 14.9271 15.6562 15.6562C14.9271 16.3854 14.0783 16.9583 13.1099 17.375C12.1415 17.7917 11.1068 18 10.0058 18ZM9 16.4167V15C8.72222 15 8.48611 14.9021 8.29167 14.7063C8.09722 14.5104 8 14.275 8 14V13L3.64583 8.64583C3.59028 8.90972 3.55208 9.15278 3.53125 9.375C3.51042 9.59722 3.5 9.80556 3.5 10C3.5 11.5972 4.01736 13.0069 5.05208 14.2292C6.08681 15.4514 7.40278 16.1806 9 16.4167ZM15 14.1458C15.25 13.8542 15.4688 13.5486 15.6562 13.2292C15.8438 12.9097 15.999 12.5725 16.1221 12.2176C16.2451 11.8627 16.3389 11.4982 16.4033 11.1239C16.4678 10.7496 16.5 10.375 16.5 10C16.5 8.686 16.1389 7.48597 15.4167 6.39992C14.6944 5.31386 13.7222 4.51389 12.5 4V4.5C12.5 4.9125 12.3531 5.26562 12.0594 5.55937C11.7656 5.85312 11.4125 6 11 6H9V7C9 7.28333 8.90417 7.52083 8.7125 7.7125C8.52083 7.90417 8.28333 8 8 8H7V10H12C12.2833 10 12.5208 10.0958 12.7125 10.2875C12.9042 10.4792 13 10.7167 13 11V13H13.8542C14.1736 13 14.4444 13.1111 14.6667 13.3333C14.8889 13.5556 15 13.8264 15 14.1458Z"
          fill={props.color ? props.color : 'currentColor'}
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function MultiChannel(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
<mask id="mask0_2135_20239" maskUnits="userSpaceOnUse" x="0" y="0" width="20" height="20">
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/MusicNote.tsx
Tamaño: 1451 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function MusicNote(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M11.25 20H7.81556C7.0565 20 6.67696 20 6.37035 20.1017C5.77087 20.3005 5.30054 20.7709 5.1017 21.3704C5 21.677 5 22.0565 5 22.8156V22.8156C5 23.7218 5 24.1749 5.12857 24.5159C5.38062 25.1845 5.97018 25.6678 6.6752 25.7838C7.03484 25.843 7.47914 25.7542 8.36774 25.5765L8.73786 25.5024C9.59647 25.3307 10.0258 25.2448 10.3522 25.0293C10.689 24.8069 10.9506 24.4877 11.1026 24.1139C11.25 23.7515 11.25 23.3137 11.25 22.4381V10.7792C11.25 9.20946 11.25 8.42459 11.7033 7.87163C12.1566 7.31867 12.9263 7.16475 14.4655 6.85689L18.9655 5.95689C21.1792 5.51417 22.286 5.29281 23.018 5.89292C23.75 6.49304 23.75 7.62176 23.75 9.87922V11.25M23.75 17.5V19.9381C23.75 20.8137 23.75 21.2515 23.6026 21.6139C23.4506 21.9877 23.189 22.3069 22.8522 22.5293C22.5258 22.7448 22.0965 22.8307 21.2379 23.0024L20.8677 23.0765C19.9791 23.2542 19.5348 23.343 19.1752 23.2838C18.4702 23.1678 17.8806 22.6845 17.6286 22.0159C17.5 21.6749 17.5 21.2218 17.5 20.3156V20.3156C17.5 19.5565 17.5 19.177 17.6017 18.8704C17.8005 18.2709 18.2709 17.8005 18.8704 17.6017C19.177 17.5 19.5565 17.5 20.3156 17.5H23.75ZM23.75 17.5V11.25M23.75 11.25L11.25 13.75"
        stroke="currentColor"
        strokeWidth="2"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function MusicNote(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/NovuIcon.tsx
Tamaño: 1039 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function NovuIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M11.8351 2.14312C10.7336 1.42037 9.41588 1 8 1C7.22048 1 6.47073 1.12742 5.77042 1.36256L11.135 6.76173C11.3926 7.02103 11.8351 6.83858 11.8351 6.47305V2.14312Z"
        fill="#828299"
      />
      <path
        d="M3.77507 2.4183C2.08903 3.69649 1 5.72107 1 8C1 9.32335 1.36722 10.5609 2.00532 11.6164V9.52695C2.00532 7.23409 4.7809 6.08964 6.39696 7.71613L12.2249 13.5817C13.911 12.3035 15 10.2789 15 8C15 6.67665 14.6328 5.43907 13.9947 4.3836V6.47305C13.9947 8.76591 11.2191 9.91036 9.60303 8.28386L3.77507 2.4183Z"
        fill="#828299"
      />
      <path
        d="M10.2296 14.6374L4.86501 9.23827C4.60738 8.97897 4.16489 9.16142 4.16489 9.52695V13.8569C5.26641 14.5796 6.58412 15 8 15C8.77951 15 9.52927 14.8726 10.2296 14.6374Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function NovuIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/NovuLogo.tsx
Tamaño: 4761 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function NovuLogo(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="109" height="24" fill="none" viewBox="0 0 109 24" {...props}>
      <g fillRule="evenodd" clipPath="url(#clip0_1_46)" clipRule="evenodd">
        <path
          fill="url(#paint0_radial_1_46)"
          d="M18.48 9.62a.72.72 0 01-1.235.503L8.008.68A11.98 11.98 0 0112 0c2.387 0 4.611.698 6.48 1.898V9.62zm3.36-4.49v4.49c0 3.656-4.44 5.466-6.996 2.853L4.909 2.318A11.983 11.983 0 000 12c0 2.555.799 4.924 2.16 6.87v-4.466c0-3.656 4.44-5.466 6.996-2.852l9.922 10.14A11.982 11.982 0 0024 12c0-2.555-.799-4.924-2.16-6.87zM6.755 13.901l9.22 9.424A11.967 11.967 0 0112 24a11.95 11.95 0 01-6.48-1.898v-7.697a.72.72 0 011.235-.504z"
        ></path>
        <path
          fill="url(#paint1_linear_1_46)"
          d="M18.48 9.62a.72.72 0 01-1.235.503L8.008.68A11.98 11.98 0 0112 0c2.387 0 4.611.698 6.48 1.898V9.62zm3.36-4.49v4.49c0 3.656-4.44 5.466-6.996 2.853L4.909 2.318A11.983 11.983 0 000 12c0 2.555.799 4.924 2.16 6.87v-4.466c0-3.656 4.44-5.466 6.996-2.852l9.922 10.14A11.982 11.982 0 0024 12c0-2.555-.799-4.924-2.16-6.87zM6.755 13.901l9.22 9.424A11.967 11.967 0 0112 24a11.95 11.95 0 01-6.48-1.898v-7.697a.72.72 0 011.235-.504z"
        ></path>
        <path
          fill="url(#paint2_linear_1_46)"
          d="M18.48 9.62a.72.72 0 01-1.235.503L8.008.68A11.98 11.98 0 0112 0c2.387 0 4.611.698 6.48 1.898V9.62zm3.36-4.49v4.49c0 3.656-4.44 5.466-6.996 2.853L4.909 2.318A11.983 11.983 0 000 12c0 2.555.799 4.924 2.16 6.87v-4.466c0-3.656 4.44-5.466 6.996-2.852l9.922 10.14A11.982 11.982 0 0024 12c0-2.555-.799-4.924-2.16-6.87zM6.755 13.901l9.22 9.424A11.967 11.967 0 0112 24a11.95 11.95 0 01-6.48-1.898v-7.697a.72.72 0 011.235-.504z"
        ></path>
      </g>
      <path
        fill="#525266"
        d="M73.562 12.02c.008-4.688-3.356-7.976-8.156-7.98-4.877 0-8.229 3.246-8.229 7.98 0 4.953 3.885 8.238 8.133 7.964 4.9 0 8.248-3.231 8.256-7.965h-.004zM62.016 8.119c2.371-2.44 6.302-1.73 7.592 1.391.68 1.65.66 3.338.03 4.988-.783 2.046-2.671 3.053-5.027 2.775-2.062-.243-3.622-1.912-3.904-4.193-.043-.342-.039-.692-.058-1.019.046-1.467.294-2.836 1.367-3.942zM40.012 18.171c.008 1.285.19 1.43 1.653 1.43 1.444 0 1.626-.15 1.633-1.45.012-2.934.004-5.87.004-8.8 0-2.099.147-2.262 2.282-2.559.128-.019.255-.034.383-.042 3.36-.273 5.023 1.21 5.039 4.513.012 2.304-.004 4.608.008 6.908.007 1.285.189 1.43 1.652 1.43 1.452 0 1.63-.145 1.634-1.45.012-2.619.008-5.238 0-7.854-.008-3.277-1.854-5.535-5.151-6.075-2.692-.44-5.372-.22-7.99.616-.838.266-1.174.749-1.158 1.6.03 1.955.011 3.913.011 5.87 0 1.958-.011 3.912 0 5.87v-.007zm68.281-12.31c-.008-1.107-.432-1.468-1.548-1.4-1.066.065-1.568.518-1.692 1.575-.046.406-.042.817-.046 1.228-.004 2.84 0 5.68-.008 8.52 0 .535.023 1.071-.652 1.326-3.437 1.3-6.8-.855-6.843-4.421-.027-2.21 0-4.418-.012-6.627-.007-1.346-.706-1.866-2.043-1.55-.961.227-1.231.927-1.235 1.786-.008 2.334-.035 4.672 0 7.007.054 3.645 1.938 5.968 5.626 6.405 2.429.285 4.924.061 7.387.03.807-.01 1.078-.547 1.074-1.28-.012-2.084 0-4.167 0-6.25 0-2.114.015-4.228 0-6.345l-.008-.004zM83.228 16.137c-.367-.791-.757-1.57-1.097-2.373-1.166-2.737-2.313-5.482-3.475-8.219-.406-.954-1.151-1.296-2.175-1.022-.876.231-1.305.904-1.115 1.912.104.551.305 1.099.548 1.608 1.54 3.262 3.178 6.486 4.634 9.785.706 1.605 1.753 2.168 3.448 1.974.757-.088 1.247-.339 1.576-1.015.617-1.285 1.336-2.525 1.923-3.821a522.747 522.747 0 003.873-8.77c.444-1.031.1-1.544-1.012-1.715-1.089-.168-1.838.266-2.32 1.403-1.051 2.478-2.07 4.965-3.12 7.443-.403.947-.862 1.874-1.294 2.81h-.394z"
      ></path>
      <defs>
        <radialGradient
          id="paint0_radial_1_46"
          cx="0"
          cy="0"
          r="1"
          gradientTransform="rotate(135 3.515 8.485) scale(16.9706)"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.34" stopColor="#FF006A"></stop>
          <stop offset="0.613" stopColor="#E300BD"></stop>
          <stop offset="0.767" stopColor="#FF4CE1"></stop>
        </radialGradient>
        <linearGradient id="paint1_linear_1_46" x1="14.8" x2="12" y1="-0.8" y2="24" gradientUnits="userSpaceOnUse">
          <stop offset="0.085" stopColor="#FFBA33"></stop>
          <stop offset="0.553" stopColor="#FF006A" stopOpacity="0"></stop>
        </linearGradient>
        <linearGradient id="paint2_linear_1_46" x1="12" x2="12" y1="0" y2="24" gradientUnits="userSpaceOnUse">
          <stop offset="0.547" stopOpacity="0"></stop>
          <stop offset="1" stopOpacity="0.6"></stop>
        </linearGradient>
        <clipPath id="clip0_1_46">
          <path fill="#fff" d="M0 0H24V24H0z"></path>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function NovuLogo(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="109" height="24" fill="none" viewBox="0 0 109 24" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Pencil.tsx
Tamaño: 3540 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Pencil(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
      <g clipPath="url(#clip0_1481_2250)">
        <rect width="64" height="64" fill="#525266" rx="32"></rect>
        <g clipPath="url(#clip1_1481_2250)">
          <mask
            id="mask0_1481_2250"
            style={{ maskType: 'luminance' }}
            width="64"
            height="64"
            x="0"
            y="0"
            maskUnits="userSpaceOnUse"
          >
            <path
              fill="#fff"
              d="M64 32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32 17.673 0 32-14.327 32-32z"
            ></path>
          </mask>
          <g mask="url(#mask0_1481_2250)">
            <path
              fill="#525266"
              d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z"
            ></path>
            <mask
              id="mask1_1481_2250"
              style={{ maskType: 'luminance' }}
              width="123"
              height="51"
              x="13"
              y="24"
              maskUnits="userSpaceOnUse"
            >
              <path fill="#fff" d="M135.285 24.098H13.098v50.36h122.187v-50.36z"></path>
            </mask>
            <g mask="url(#mask1_1481_2250)">
              <path
                fill="url(#paint0_linear_1481_2250)"
                d="M132.866 60.922L41.937 28.56l-4.81 13.373 90.897 33.267a4.24 4.24 0 005.12-1.855c1.062-1.826 2.078-4.679 2.139-8.953a3.632 3.632 0 00-2.417-3.469z"
              ></path>
              <path
                fill="url(#paint1_linear_1481_2250)"
                d="M13.808 25.103l12.56 1.543c-.013 1.73-.58 3.968-2.495 6.536l-10.49-6.925c-.556-.367-.237-1.236.425-1.154z"
              ></path>
              <path
                fill="url(#paint2_linear_1481_2250)"
                d="M41.939 28.558c.575 8.381-4.81 13.373-4.81 13.373l-13.256-8.75c1.916-2.568 2.482-4.806 2.495-6.536l15.57 1.913z"
              ></path>
            </g>
          </g>
        </g>
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_1481_2250"
          x1="59.742"
          x2="68.161"
          y1="65.552"
          y2="28.626"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.132" stopColor="#A9A9B9"></stop>
          <stop offset="0.883" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint1_linear_1481_2250"
          x1="19.733"
          x2="19.733"
          y1="25.098"
          y2="33.182"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#353544" stopOpacity="0.91"></stop>
          <stop offset="1" stopColor="#232335" stopOpacity="0.98"></stop>
        </linearGradient>
        <linearGradient
          id="paint2_linear_1481_2250"
          x1="23.873"
          x2="41.982"
          y1="34.288"
          y2="34.288"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#E185AE"></stop>
          <stop offset="1" stopColor="#F09990"></stop>
        </linearGradient>
        <clipPath id="clip0_1481_2250">
          <rect width="64" height="64" fill="#fff" rx="32"></rect>
        </clipPath>
        <clipPath id="clip1_1481_2250">
          <path fill="#fff" d="M0 0H64V64H0z"></path>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Pencil(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Playground.tsx
Tamaño: 10916 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


import React from 'react';

export function Playground(props: React.ComponentPropsWithoutRef<'svg'>) {
  const { fill, ...rest } = props;

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...rest}>
      <rect width="64" height="64" fill={fill || '#525266'} rx="32"></rect>
      <g clipPath="url(#clip0_2499_183)">
        <path
          fill="url(#paint0_linear_2499_183)"
          d="M26.495 35.261l-12.563-7.348.044 14.738L26.536 50l-.04-14.739z"
        ></path>
        <path
          fill="url(#paint1_linear_2499_183)"
          d="M48 22.762l-12.124-7.139-21.944 12.29 12.563 7.348L48 22.762z"
        ></path>
        <path
          fill="url(#paint2_linear_2499_183)"
          d="M26.495 35.261L26.536 50 47.96 37.31 48 22.762l-21.505 12.5z"
        ></path>
        <path
          fill="url(#paint3_linear_2499_183)"
          d="M17.604 25.06l.006 2.09c0 .438.288.88.863 1.214 1.156.678 3.04.678 4.202 0 .585-.34.878-.788.878-1.234l-.006-2.09c0 .445-.29.894-.878 1.234-1.163.678-3.046.678-4.203 0-.575-.337-.862-.776-.862-1.215z"
        ></path>
        <path
          fill="url(#paint4_linear_2499_183)"
          d="M24.596 28.698l.006 2.09c0 .44.288.882.863 1.216 1.157.677 3.04.677 4.203 0 .584-.34.878-.79.878-1.235l-.006-2.09c0 .446-.291.894-.879 1.235-1.163.677-3.046.677-4.202 0-.575-.338-.863-.777-.863-1.216z"
        ></path>
        <path
          fill="url(#paint5_linear_2499_183)"
          d="M25.367 20.672l.006 2.09c0 .439.288.881.863 1.215 1.157.678 3.04.678 4.203 0 .584-.34.878-.789.878-1.234l-.006-2.09c0 .445-.291.894-.879 1.234-1.163.678-3.046.678-4.202 0-.575-.337-.863-.776-.863-1.215z"
        ></path>
        <path
          fill="url(#paint6_linear_2499_183)"
          d="M32.36 24.312l.006 2.09c0 .439.288.88.862 1.215 1.157.677 3.04.677 4.203 0 .585-.34.878-.79.878-1.234l-.006-2.09c0 .445-.29.893-.878 1.234-1.163.677-3.046.677-4.203 0-.575-.337-.862-.776-.862-1.215z"
        ></path>
        <path
          fill="url(#paint7_linear_2499_183)"
          d="M32.783 16.842l.006 2.09c0 .439.288.881.863 1.215 1.156.678 3.04.678 4.202 0 .585-.34.879-.789.879-1.234l-.007-2.09c0 .445-.29.894-.878 1.234-1.163.678-3.046.678-4.202 0-.575-.337-.863-.776-.863-1.215z"
        ></path>
        <path
          fill="url(#paint8_linear_2499_183)"
          d="M39.775 20.5l.007 2.09c0 .44.287.881.862 1.215 1.157.678 3.04.678 4.203 0 .584-.34.878-.789.878-1.234l-.006-2.09c0 .445-.29.894-.879 1.234-1.162.678-3.046.678-4.202 0-.575-.337-.863-.776-.863-1.215z"
        ></path>
        <path
          fill="url(#paint9_linear_2499_183)"
          d="M18.482 23.822c-1.163.677-1.172 1.775-.016 2.449 1.157.678 3.04.678 4.203 0 1.162-.678 1.172-1.775.012-2.45-1.156-.677-3.036-.674-4.202 0h.003z"
        ></path>
        <path
          fill="url(#paint10_linear_2499_183)"
          d="M25.475 27.464c-1.163.678-1.173 1.775-.016 2.45 1.156.677 3.04.677 4.202 0 1.163-.678 1.172-1.776.013-2.45-1.157-.678-3.037-.674-4.203 0h.004z"
        ></path>
        <path
          fill="url(#paint11_linear_2499_183)"
          d="M26.246 19.438c-1.163.677-1.173 1.775-.016 2.45 1.156.677 3.04.677 4.202 0 1.163-.678 1.172-1.776.013-2.45-1.157-.678-3.037-.675-4.203 0h.004z"
        ></path>
        <path
          fill="url(#paint12_linear_2499_183)"
          d="M33.238 23.077c-1.163.678-1.172 1.775-.016 2.45 1.157.677 3.04.677 4.203 0 1.162-.678 1.172-1.775.012-2.45-1.156-.677-3.036-.674-4.202 0h.003z"
        ></path>
        <path
          fill="url(#paint13_linear_2499_183)"
          d="M33.661 15.509c-1.162.678-1.172 1.775-.016 2.45 1.157.677 3.04.677 4.203 0 1.163-.678 1.172-1.776.013-2.45-1.157-.678-3.037-.675-4.203 0h.003z"
        ></path>
        <path
          fill="url(#paint14_linear_2499_183)"
          d="M40.654 19.148c-1.163.678-1.173 1.775-.016 2.45 1.156.677 3.04.677 4.202 0 1.163-.678 1.173-1.775.013-2.45-1.157-.677-3.037-.674-4.202 0h.003z"
        ></path>
      </g>
      <g filter="url(#filter0_d_2499_183)">
        <path
          fill="url(#paint15_linear_2499_183)"
          fillRule="evenodd"
          d="M47 32.99c4.401 0 8-3.589 8-8 0-4.41-3.599-7.99-8-7.99s-8 3.59-8 8 3.59 8 8 8v-.01z"
          clipRule="evenodd"
        ></path>
      </g>
      <g clipPath="url(#clip1_2499_183)" opacity="0.8">
        <path
          fill="#fff"
          d="M50.679 24.52l-4.894-2.912a.35.35 0 00-.54.295h-.002v6.047h.002a.35.35 0 00.348.352.403.403 0 00.197-.06l4.889-2.91a.527.527 0 000-.811z"
        ></path>
      </g>
      <defs>
        <filter
          id="filter0_d_2499_183"
          width="26"
          height="26"
          x="33"
          y="11"
          colorInterpolationFilters="sRGB"
          filterUnits="userSpaceOnUse"
        >
          <feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood>
          <feColorMatrix
            in="SourceAlpha"
            result="hardAlpha"
            values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
          ></feColorMatrix>
          <feOffset dx="-1" dy="-1"></feOffset>
          <feGaussianBlur stdDeviation="2.5"></feGaussianBlur>
          <feColorMatrix values="0 0 0 0 0.133333 0 0 0 0 0.160784 0 0 0 0 0.192157 0 0 0 0.31 0"></feColorMatrix>
          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2499_183"></feBlend>
          <feBlend in="SourceGraphic" in2="effect1_dropShadow_2499_183" result="shape"></feBlend>
        </filter>
        <linearGradient
          id="paint0_linear_2499_183"
          x1="11.5"
          x2="24.646"
          y1="42.999"
          y2="28.751"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0.12" stopColor="#A9A9B9"></stop>
          <stop offset="1" stopColor="#DDDDE4"></stop>
        </linearGradient>
        <linearGradient
          id="paint1_linear_2499_183"
          x1="31.791"
          x2="31.155"
          y1="33.069"
          y2="15.617"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#B4B4C2"></stop>
          <stop offset="0.724" stopColor="#F2F2F2"></stop>
        </linearGradient>
        <linearGradient
          id="paint2_linear_2499_183"
          x1="37.768"
          x2="35.841"
          y1="46.959"
          y2="22.875"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#D0D0E0"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint3_linear_2499_183"
          x1="20.723"
          x2="20.584"
          y1="28.445"
          y2="25.04"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint4_linear_2499_183"
          x1="27.715"
          x2="27.576"
          y1="32.084"
          y2="28.679"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint5_linear_2499_183"
          x1="28.486"
          x2="28.348"
          y1="24.058"
          y2="20.653"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint6_linear_2499_183"
          x1="35.478"
          x2="35.34"
          y1="27.697"
          y2="24.292"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint7_linear_2499_183"
          x1="35.902"
          x2="35.763"
          y1="20.227"
          y2="16.823"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint8_linear_2499_183"
          x1="42.894"
          x2="42.756"
          y1="23.886"
          y2="20.481"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#ACACBE"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint9_linear_2499_183"
          x1="20.719"
          x2="20.606"
          y1="26.392"
          y2="23.313"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint10_linear_2499_183"
          x1="27.711"
          x2="27.598"
          y1="30.035"
          y2="26.956"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint11_linear_2499_183"
          x1="28.482"
          x2="28.369"
          y1="22.009"
          y2="18.93"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint12_linear_2499_183"
          x1="35.475"
          x2="35.361"
          y1="25.648"
          y2="22.569"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint13_linear_2499_183"
          x1="35.898"
          x2="35.785"
          y1="18.08"
          y2="15.001"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint14_linear_2499_183"
          x1="42.891"
          x2="42.777"
          y1="21.719"
          y2="18.64"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#F5F5F5"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient id="paint15_linear_2499_183" x1="39" x2="55" y1="25" y2="25" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
        <clipPath id="clip0_2499_183">
          <path fill="#fff" d="M0 0H37V35H0z" transform="translate(11 15)"></path>
        </clipPath>
        <clipPath id="clip1_2499_183">
          <path fill="#fff" d="M0 0H9V9H0z" transform="translate(43.75 19.941)"></path>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Playground(props: React.ComponentPropsWithoutRef<'svg'>) {
const { fill, ...rest } = props;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ProviderMissing.tsx
Tamaño: 971 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function ProviderMissing(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
      <path
        fill="#E64545"
        d="M6.375 3c-.622 0-1.125.503-1.125 1.125V7.5H7.5V4.125C7.5 3.503 6.997 3 6.375 3zm6.75 0C12.503 3 12 3.503 12 4.125V7.5h2.25V4.125c0-.622-.503-1.125-1.125-1.125zm-9 5.625a1.124 1.124 0 100 2.25V12a5.628 5.628 0 004.5 5.512v2.363a1.124 1.124 0 102.25 0v-2.363a5.579 5.579 0 001.234-.404 6.195 6.195 0 014.366-7.12 1.124 1.124 0 00-1.1-1.364H4.125zM18.188 21a5.062 5.062 0 100-10.125 5.062 5.062 0 000 10.125zm2.084-6.353l-1.29 1.29 1.29 1.29a.565.565 0 010 .795.565.565 0 01-.794 0l-1.29-1.29-1.29 1.29a.565.565 0 01-.795 0 .565.565 0 010-.794l1.29-1.29-1.29-1.29a.565.565 0 010-.795.565.565 0 01.794 0l1.29 1.29 1.29-1.29a.565.565 0 01.795 0 .565.565 0 010 .794z"
      ></path>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ProviderMissing(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/PushFilled.tsx
Tamaño: 1024 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function PushFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-workflow-node-icon
      {...props}
    >
      <path
        fill={`url(#${id})`}
        d="M16.2 3H7.8C6.806 3 6 3.756 6 4.688v14.625C6 20.244 6.806 21 7.8 21h8.4c.994 0 1.8-.756 1.8-1.688V4.688C18 3.756 17.194 3 16.2 3zM12 19.875c-.664 0-1.2-.503-1.2-1.125s.536-1.125 1.2-1.125c.664 0 1.2.503 1.2 1.125s-.536 1.125-1.2 1.125zm4.2-3.797c0 .232-.202.422-.45.422h-7.5c-.248 0-.45-.19-.45-.422V5.11c0-.232.202-.421.45-.421h7.5c.248 0 .45.19.45.421v10.97z"
      ></path>
      <defs>
        <linearGradient id={String(id)} x1="6" x2="18" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PushFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Question.tsx
Tamaño: 2246 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Question(props: React.ComponentPropsWithoutRef<'svg'> & { isGradient?: boolean }) {
  const { isGradient = false, ...rest } = props;

  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="25" fill="none" viewBox="0 0 26 25" {...rest}>
      <path
        fill="url(#paint0_linear_2687_104875)"
        d="M12.938 20c.437 0 .807-.151 1.109-.453.302-.302.453-.672.453-1.11 0-.437-.151-.807-.453-1.109a1.509 1.509 0 00-1.11-.453c-.437 0-.807.151-1.109.453a1.509 1.509 0 00-.453 1.11c0 .437.151.807.453 1.109.302.302.672.453 1.11.453zm-1.126-4.813h2.313c0-.687.078-1.229.234-1.624.157-.396.6-.938 1.329-1.626.541-.541.968-1.057 1.28-1.546.313-.49.47-1.079.47-1.766 0-1.167-.428-2.063-1.282-2.688C15.302 5.313 14.292 5 13.125 5c-1.188 0-2.151.313-2.89.938-.74.625-1.256 1.375-1.547 2.25L10.75 9c.104-.375.338-.781.703-1.219.365-.437.922-.656 1.672-.656.667 0 1.167.182 1.5.547.333.364.5.766.5 1.203 0 .417-.125.807-.375 1.172-.25.364-.563.703-.938 1.015-.916.813-1.479 1.428-1.687 1.844-.208.417-.313 1.177-.313 2.281zM13 25c-1.73 0-3.354-.328-4.875-.984a12.622 12.622 0 01-3.969-2.672 12.624 12.624 0 01-2.672-3.969C.828 15.855.5 14.229.5 12.5c0-1.73.328-3.354.984-4.875a12.623 12.623 0 012.672-3.969A12.623 12.623 0 018.125.984C9.645.328 11.271 0 13 0c1.73 0 3.354.328 4.875.984a12.624 12.624 0 013.969 2.672 12.622 12.622 0 012.672 3.969c.656 1.52.984 3.146.984 4.875 0 1.73-.328 3.354-.984 4.875a12.623 12.623 0 01-2.672 3.969 12.623 12.623 0 01-3.969 2.672c-1.52.656-3.146.984-4.875.984zm0-2.5c2.792 0 5.156-.969 7.094-2.906C22.03 17.656 23 15.292 23 12.5c0-2.792-.969-5.156-2.906-7.094C18.156 3.47 15.792 2.5 13 2.5c-2.792 0-5.156.969-7.094 2.906C3.97 7.344 3 9.708 3 12.5c0 2.792.969 5.156 2.906 7.094C7.844 21.53 10.208 22.5 13 22.5z"
      ></path>
      <defs>
        <linearGradient
          id="paint0_linear_2687_104875"
          x1="0.5"
          x2="25.5"
          y1="12.5"
          y2="12.5"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor={isGradient ? '#DD2476' : 'currentColor'}></stop>
          <stop offset="1" stopColor={isGradient ? '#FF512F' : 'currentColor'}></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Question(props: React.ComponentPropsWithoutRef<'svg'> & { isGradient?: boolean }) {
const { isGradient = false, ...rest } = props;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/QuickGuide.tsx
Tamaño: 5133 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function QuickGuide(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
      <g clipPath="url(#clip0_1481_5460)">
        <mask
          id="mask0_1481_5460"
          style={{ maskType: 'luminance' }}
          width="64"
          height="64"
          x="0"
          y="0"
          maskUnits="userSpaceOnUse"
        >
          <path
            fill="#fff"
            d="M64 32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32 17.673 0 32-14.327 32-32z"
          ></path>
        </mask>
        <g mask="url(#mask0_1481_5460)">
          <path
            fill="#525266"
            d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z"
          ></path>
          <mask
            id="mask1_1481_5460"
            style={{ maskType: 'luminance' }}
            width="29"
            height="38"
            x="18"
            y="13"
            maskUnits="userSpaceOnUse"
          >
            <path fill="#fff" d="M46.5 13H18v38h28.5V13z"></path>
          </mask>
          <g mask="url(#mask1_1481_5460)">
            <mask
              id="mask2_1481_5460"
              style={{ maskType: 'luminance' }}
              width="29"
              height="38"
              x="18"
              y="13"
              maskUnits="userSpaceOnUse"
            >
              <path fill="#fff" d="M46.37 13H18v38h28.37V13z"></path>
            </mask>
            <g mask="url(#mask2_1481_5460)">
              <path
                fill="url(#paint0_linear_1481_5460)"
                d="M18.455 48.31s-.515-3.643 3.502-3.924c4.018-.28 23.624.42 23.624.42s-.824 4.064 0 5.816c-3.777-.035-25.615 0-25.615 0s-1.639-.803-1.511-2.312z"
              ></path>
              <path
                fill="url(#paint1_linear_1481_5460)"
                d="M45.958 50.189H21.236c-.504 0-2.427.128-2.38-2.067.021-1.056.572-1.706 1.138-2.118a3.037 3.037 0 011.799-.568H44.31c2.109 0 1.703-2.87 1.703-2.87l-23.999.603s-3.571 2.156-3.952 4.356a4.02 4.02 0 000 1.408C18.28 50.125 19.302 51 20.49 51h25.468a.404.404 0 00.412-.406.404.404 0 00-.412-.405z"
              ></path>
              <path
                fill="url(#paint2_linear_1481_5460)"
                d="M44.503 13.035H21.471V44.81l23.032.104c.88 0 1.51-.835 1.51-1.731v-28.56c0-.897-.63-1.587-1.51-1.587z"
              ></path>
              <path
                fill="url(#paint3_linear_1481_5460)"
                d="M21.51 13s-3.708.754-3.433 3.67c.275 2.916-.015 30.85-.015 30.85s1.114-2.713 3.449-2.713V13z"
              ></path>
              <path
                fill="url(#paint4_linear_1481_5460)"
                d="M34.541 24.855V38h-3.114V24.855h3.114zm.427-3.83c0 .273-.054.529-.163.768-.109.24-.255.448-.44.628-.175.18-.385.324-.627.435a1.981 1.981 0 01-.779.154 1.95 1.95 0 01-.766-.154 2.133 2.133 0 01-1.042-1.063c-.1-.24-.151-.495-.151-.769 0-.282.05-.546.15-.794.11-.248.252-.461.428-.64.175-.18.38-.321.615-.423a1.82 1.82 0 01.766-.167c.276 0 .536.055.779.167.242.102.452.243.628.422a2.014 2.014 0 01.602 1.435z"
              ></path>
            </g>
          </g>
        </g>
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_1481_5460"
          x1="27.213"
          x2="30.328"
          y1="50.196"
          y2="41.851"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#484856"></stop>
          <stop offset="1" stopColor="#6E6E8F"></stop>
        </linearGradient>
        <linearGradient
          id="paint1_linear_1481_5460"
          x1="32.871"
          x2="32.731"
          y1="50.058"
          y2="42.556"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#A9A9B9"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint2_linear_1481_5460"
          x1="33.742"
          x2="33.742"
          y1="44.913"
          y2="13.035"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#BEBECC"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint3_linear_1481_5460"
          x1="19.87"
          x2="5.993"
          y1="43.666"
          y2="21.724"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#A9A9B9"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint4_linear_1481_5460"
          x1="33.059"
          x2="33.059"
          y1="12.633"
          y2="43.381"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#353544" stopOpacity="0.91"></stop>
          <stop offset="1" stopColor="#232335" stopOpacity="0.98"></stop>
        </linearGradient>
        <clipPath id="clip0_1481_5460">
          <path fill="#fff" d="M0 0H64V64H0z"></path>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function QuickGuide(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ReactLogo.tsx
Tamaño: 2999 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const ReactLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
      <path
        fill="#82D8F7"
        d="M24 12.002c0-1.562-1.991-3.042-5.044-3.96.705-3.057.392-5.49-.988-6.268a2.175 2.175 0 0 0-1.096-.27v1.073c.225 0 .406.043.558.125.665.375.954 1.802.729 3.638-.054.452-.142.928-.25 1.413a24.09 24.09 0 0 0-3.106-.524 23.541 23.541 0 0 0-2.035-2.403c1.595-1.456 3.092-2.254 4.11-2.254V1.5c-1.346 0-3.107.942-4.888 2.576C10.21 2.452 8.448 1.52 7.103 1.52v1.072c1.013 0 2.515.793 4.11 2.24-.685.707-1.37 1.51-2.021 2.398a23.215 23.215 0 0 0-3.111.53 14.27 14.27 0 0 1-.255-1.395c-.23-1.836.054-3.263.715-3.643.146-.087.337-.125.562-.125V1.524c-.41 0-.783.087-1.105.27-1.375.778-1.683 3.205-.974 6.253C1.981 8.969 0 10.445 0 12.002c0 1.563 1.991 3.043 5.044 3.961-.705 3.057-.392 5.49.988 6.268.318.182.69.269 1.1.269 1.346 0 3.107-.942 4.888-2.576 1.78 1.624 3.541 2.557 4.887 2.557.41 0 .782-.087 1.105-.27 1.375-.778 1.683-3.205.974-6.253C22.019 15.04 24 13.56 24 12.002Zm-6.37-3.206c-.18.62-.405 1.26-.66 1.899a25.906 25.906 0 0 0-1.345-2.278c.695.1 1.365.226 2.006.38Zm-2.24 5.12a25.511 25.511 0 0 1-1.179 1.835 25.897 25.897 0 0 1-4.412.005 24.868 24.868 0 0 1-2.201-3.74A25.546 25.546 0 0 1 9.79 8.263a25.904 25.904 0 0 1 4.411-.004c.406.572.803 1.182 1.184 1.827.372.63.71 1.268 1.018 1.913a26.73 26.73 0 0 1-1.013 1.917Zm1.58-.625c.264.644.49 1.288.675 1.913-.64.153-1.316.283-2.015.384a26.46 26.46 0 0 0 1.34-2.297Zm-4.96 5.128a19.91 19.91 0 0 1-1.36-1.538c.44.02.89.034 1.345.034.46 0 .915-.01 1.36-.034-.44.563-.895 1.077-1.345 1.538Zm-3.64-2.83c-.694-.102-1.365-.227-2.006-.38.181-.62.406-1.26.66-1.9.201.385.412.77.642 1.154.23.385.464.76.704 1.125Zm3.615-10.003c.455.461.91.975 1.36 1.538-.44-.02-.89-.034-1.345-.034-.46 0-.915.01-1.36.034.44-.563.895-1.077 1.345-1.538Zm-3.62 2.83a26.457 26.457 0 0 0-1.34 2.293 20.356 20.356 0 0 1-.675-1.913c.64-.149 1.316-.278 2.015-.38Zm-4.427 6.018c-1.732-.725-2.852-1.677-2.852-2.432 0-.754 1.12-1.71 2.852-2.432.42-.178.88-.336 1.355-.485a22.83 22.83 0 0 0 1.1 2.927c-.45 1-.811 1.976-1.085 2.913a15.013 15.013 0 0 1-1.37-.49Zm2.632 6.87c-.665-.376-.954-1.803-.729-3.64.054-.451.142-.927.25-1.413.958.231 2.005.409 3.106.524.66.89 1.345 1.697 2.035 2.404-1.595 1.456-3.092 2.254-4.11 2.254a1.184 1.184 0 0 1-.552-.13Zm11.604-3.663c.23 1.836-.054 3.263-.715 3.643-.146.087-.337.125-.562.125-1.013 0-2.515-.793-4.11-2.24.685-.707 1.37-1.51 2.021-2.399a23.207 23.207 0 0 0 3.111-.528c.113.485.2.951.255 1.398Zm1.883-3.206c-.42.177-.88.336-1.355.485a22.817 22.817 0 0 0-1.1-2.927c.45-1 .811-1.976 1.085-2.913.485.149.944.312 1.375.49 1.732.726 2.852 1.678 2.852 2.432-.005.755-1.125 1.712-2.857 2.432Z"
      />
      <path
        fill="#82D8F7"
        d="M11.995 14.199c1.235 0 2.236-.983 2.236-2.197 0-1.213-1.001-2.196-2.236-2.196-1.235 0-2.236.983-2.236 2.196 0 1.214 1.001 2.197 2.236 2.197Z"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const ReactLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
<path
fill="#82D8F7"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Read.tsx
Tamaño: 1145 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Read(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M14.9434 5.17969C14.2109 4.59375 13.625 4.125 10.1387 1.60547C9.64062 1.25391 8.67383 0.375 8 0.375V0.404297C7.9707 0.404297 7.9707 0.375 7.9707 0.375C7.29688 0.375 6.33008 1.25391 5.83203 1.60547C2.3457 4.125 1.75977 4.59375 1.02734 5.17969C0.675781 5.44336 0.5 5.85352 0.5 6.26367V13.9688C0.5 14.7598 1.11523 15.375 1.90625 15.375H14.0938C14.8555 15.375 15.5 14.7598 15.5 13.9688V6.26367C15.5 5.85352 15.2949 5.44336 14.9434 5.17969ZM9.37695 11.1562C8.9668 11.4785 8.46875 11.6543 8 11.6543C7.50195 11.6543 7.00391 11.4785 6.59375 11.1562L2.375 7.8457V6.49805C2.99023 6 3.72266 5.44336 6.94531 3.12891C7.0332 3.04102 7.15039 2.95312 7.26758 2.86523C7.41406 2.74805 7.73633 2.48438 8 2.33789C8.23438 2.48438 8.55664 2.74805 8.70312 2.86523C8.82031 2.95312 8.9375 3.04102 9.02539 3.12891C12.2188 5.44336 12.9805 6 13.625 6.49805V7.8457L9.37695 11.1562Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Read(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Received.tsx
Tamaño: 999 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Received(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M7.32617 9.48633C7.67773 9.86719 8.29297 9.86719 8.64453 9.48633L11.457 6.67383C11.8379 6.32227 11.8379 5.70703 11.457 5.35547C11.1055 4.97461 10.4902 4.97461 10.1387 5.35547L8.9375 6.55664V1.3125C8.9375 0.814453 8.49805 0.375 8 0.375C7.47266 0.375 7.0625 0.814453 7.0625 1.3125V6.55664L5.83203 5.35547C5.65625 5.17969 5.42188 5.0625 5.1875 5.0625C4.92383 5.0625 4.68945 5.17969 4.51367 5.35547C4.13281 5.70703 4.13281 6.32227 4.51367 6.67383L7.32617 9.48633ZM14.5625 9.75H11.75L10.8125 11.625H5.1875L4.25 9.75H1.4375C0.910156 9.75 0.5 10.1895 0.5 10.6875V13.9688C0.5 14.7598 1.11523 15.375 1.90625 15.375H14.0938C14.8555 15.375 15.5 14.7598 15.5 13.9688V10.6875C15.5 10.1895 15.0605 9.75 14.5625 9.75Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Received(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/RemoveCircle.tsx
Tamaño: 975 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function RemoveCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M7 0.1875C3.36328 0.1875 0.4375 3.14062 0.4375 6.75C0.4375 10.3867 3.36328 13.3125 7 13.3125C10.6094 13.3125 13.5625 10.3867 13.5625 6.75C13.5625 3.14062 10.6094 0.1875 7 0.1875ZM9.1875 8.0625C9.46094 8.30859 9.46094 8.71875 9.1875 8.96484C8.94141 9.23828 8.53125 9.23828 8.28516 8.96484L7 7.67969L5.6875 8.96484C5.44141 9.23828 5.03125 9.23828 4.78516 8.96484C4.51172 8.71875 4.51172 8.30859 4.78516 8.0625L6.07031 6.75L4.78516 5.46484C4.51172 5.21875 4.51172 4.80859 4.78516 4.5625C5.03125 4.28906 5.44141 4.28906 5.6875 4.5625L7 5.84766L8.28516 4.5625C8.53125 4.28906 8.94141 4.28906 9.1875 4.5625C9.46094 4.80859 9.46094 5.21875 9.1875 5.46484L7.90234 6.75L9.1875 8.0625Z"
        fill="white"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function RemoveCircle(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/RemoveCondition.tsx
Tamaño: 649 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function RemoveCondition(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15" fill="none" {...props}>
      <path
        d="M13.1807 14.0829L0.914062 1.81621L1.86406 0.866211L14.1307 13.1329L13.1807 14.0829ZM10.5474 7.66621L9.21406 6.33288H11.9974V7.66621H10.5474ZM7.21406 4.33288L5.88073 2.99954H13.9974V4.33288H7.21406ZM6.66406 10.9995V9.66621H9.33073V10.9995H6.66406ZM3.9974 7.66621V6.33288H6.76406V7.66621H3.9974ZM1.9974 4.33288V2.99954H3.43073V4.33288H1.9974Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function RemoveCondition(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Repeat.tsx
Tamaño: 1410 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Repeat(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <g clipPath="url(#clip0_1059_22002)">
        <path
          d="M14.1667 0.833252L17.5 4.16659L14.1667 7.49992"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <path
          d="M2.5 9.16675V7.50008C2.5 6.61603 2.85119 5.76818 3.47631 5.14306C4.10143 4.51794 4.94928 4.16675 5.83333 4.16675H17.5"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <path
          d="M5.83333 19.1667L2.5 15.8333L5.83333 12.5"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <path
          d="M17.5 10.8333V12.4999C17.5 13.384 17.1488 14.2318 16.5237 14.8569C15.8986 15.4821 15.0507 15.8333 14.1667 15.8333H2.5"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
      </g>
      <defs>
        <clipPath id="clip0_1059_22002">
          <rect width="20" height="20" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Repeat(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/RightArrow.tsx
Tamaño: 576 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function RightArrow(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" fill="none" viewBox="0 0 15 14" {...props}>
      <path
        fill="#fff"
        d="M.992 6.995c0-.688.563-1.25 1.25-1.25h8.594L8.086 2.87c-.469-.5-.438-1.282.062-1.782a1.236 1.236 0 011.75.063l4.75 5c.47.469.47 1.25 0 1.719l-4.75 5c-.218.25-.562.375-.906.375a1.18 1.18 0 01-.844-.344 1.236 1.236 0 01-.062-1.75l2.75-2.906H2.242c-.687 0-1.25-.532-1.25-1.25z"
      ></path>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function RightArrow(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" fill="none" viewBox="0 0 15 14" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/RingingBell.tsx
Tamaño: 1610 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function RingingBell(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
      <mask id="mask0_2135_20385" maskUnits="userSpaceOnUse" x="0" y="0" width="20" height="20">
        <rect width="20" height="20" fill="#D9D9D9" />
      </mask>
      <g mask="url(#mask0_2135_20385)">
        <path
          d="M2 9C2 7.77236 2.24653 6.64601 2.73958 5.62094C3.23264 4.59587 3.91667 3.70833 4.79167 2.95833L5.85417 4C5.13194 4.59722 4.55903 5.32986 4.13542 6.19792C3.71181 7.06597 3.5 8 3.5 9H2ZM16.5 9C16.5 7.98611 16.2882 7.04514 15.8646 6.17708C15.441 5.30903 14.8611 4.57639 14.125 3.97917L15.2083 2.91667C16.0694 3.65278 16.75 4.54514 17.25 5.59375C17.75 6.64236 18 7.77778 18 9H16.5ZM4 15.5V14H5V9C5 7.79167 5.37153 6.72917 6.11458 5.8125C6.85764 4.89583 7.81944 4.32639 9 4.10417V3C9 2.72222 9.09722 2.48611 9.29167 2.29167C9.48611 2.09722 9.72222 2 10 2C10.2778 2 10.5139 2.09722 10.7083 2.29167C10.9028 2.48611 11 2.72222 11 3V4.10417C12.1806 4.32639 13.1424 4.89583 13.8854 5.8125C14.6285 6.72917 15 7.79167 15 9V14H16V15.5H4ZM9.99558 18C9.58186 18 9.22917 17.8531 8.9375 17.5594C8.64583 17.2656 8.5 16.9125 8.5 16.5H11.5C11.5 16.9167 11.3527 17.2708 11.0581 17.5625C10.7635 17.8542 10.4093 18 9.99558 18ZM6.5 14H13.5V9C13.5 8.02778 13.1597 7.20139 12.4792 6.52083C11.7986 5.84028 10.9722 5.5 10 5.5C9.02778 5.5 8.20139 5.84028 7.52083 6.52083C6.84028 7.20139 6.5 8.02778 6.5 9V14Z"
          fill="currentColor"
        />
      </g>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function RingingBell(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/RunTestBell.tsx
Tamaño: 6422 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function RunTestBell(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
      <g clipPath="url(#clip0_1481_2636)">
        <rect width="64" height="64" fill="#525266" rx="32"></rect>
        <path
          fill="url(#paint0_linear_1481_2636)"
          fillRule="evenodd"
          d="M31.12 38.44c7.56 4.342 13.07 8.913 12.313 10.213-.758 1.3-7.493-1.16-15.053-5.502-7.552-4.335-13.062-8.906-12.312-10.206.758-1.3 7.493 1.16 15.053 5.502v-.008z"
          clipRule="evenodd"
        ></path>
        <path
          fill="url(#paint1_linear_1481_2636)"
          fillRule="evenodd"
          d="M43.572 17a3.035 3.035 0 011.122 4.157 3.07 3.07 0 01-4.181 1.116 3.035 3.035 0 01-1.121-4.158A3.07 3.07 0 0143.572 17z"
          clipRule="evenodd"
        ></path>
        <path
          fill="url(#paint2_linear_1481_2636)"
          d="M28.744 42.202c1.19.42 2.66-.666 3.281-2.425.622-1.76.161-3.526-1.03-3.946-1.19-.42-2.659.666-3.28 2.425-.622 1.76-.161 3.526 1.03 3.946z"
        ></path>
        <path
          fill="url(#paint3_linear_1481_2636)"
          fillRule="evenodd"
          d="M43.344 47.81c-.267-.754-.787-2.822.148-5.635.862-2.585 2.585-7.016 3.46-9.246.216-.45.395-.901.543-1.366a10.895 10.895 0 00-4.983-12.732c-4.537-2.607-10.173-1.617-13.574 2.068-.327.369-.639.746-.921 1.152-1.508 1.876-4.508 5.568-6.327 7.606-1.975 2.208-4.047 2.8-4.827 2.94 2.117-.133 7.901 2.185 14.265 5.841 6.364 3.655 11.28 7.473 12.223 9.364l-.007.008z"
          clipRule="evenodd"
        ></path>
        <path
          stroke="url(#paint4_linear_1481_2636)"
          strokeOpacity="0.4"
          d="M42.995 47.023a11.23 11.23 0 00-.966-1.06c-.698-.686-1.604-1.458-2.678-2.284-2.148-1.652-4.972-3.523-8.159-5.353-3.185-1.83-6.228-3.326-8.74-4.349-1.257-.511-2.382-.905-3.328-1.163a11.302 11.302 0 00-1.419-.302c1.022-.334 2.58-1.092 4.081-2.77 1.822-2.04 4.824-5.736 6.331-7.61l.003-.005.003-.003c.278-.4.586-.772.91-1.14 3.362-3.64 8.932-4.618 13.415-2.042a10.767 10.767 0 014.924 12.581c-.147.46-.322.905-.535 1.35l-.002.004-.002.004c-.876 2.23-2.6 6.664-3.463 9.253-.708 2.129-.593 3.839-.375 4.89z"
        ></path>
        <g filter="url(#filter0_d_1481_2636)">
          <path
            fill="url(#paint5_linear_1481_2636)"
            fillRule="evenodd"
            d="M29.795 26.595c3.195 0 5.808-2.603 5.808-5.801S32.99 15 29.795 15s-5.808 2.603-5.808 5.801 2.606 5.8 5.808 5.8v-.006z"
            clipRule="evenodd"
          ></path>
          <mask
            id="mask0_1481_2636"
            style={{ maskType: 'luminance' }}
            width="4"
            height="6"
            x="28"
            y="17"
            maskUnits="userSpaceOnUse"
          >
            <path fill="#fff" d="M31.49 17.66h-3.388v5.317h3.388V17.66z"></path>
          </mask>
          <g mask="url(#mask0_1481_2636)">
            <path
              fill="#fff"
              d="M31.363 22.399v.578h-2.837v-.578h1.084v-3.198c0-.113.004-.229.011-.347l-.835.691a.295.295 0 01-.112.057.261.261 0 01-.105 0 .341.341 0 01-.086-.032.245.245 0 01-.058-.053l-.242-.333 1.568-1.323h.633V22.4h.98z"
              opacity="0.76"
            ></path>
          </g>
        </g>
      </g>
      <defs>
        <filter
          id="filter0_d_1481_2636"
          width="59.617"
          height="59.602"
          x="9.987"
          y="1"
          colorInterpolationFilters="sRGB"
          filterUnits="userSpaceOnUse"
        >
          <feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood>
          <feColorMatrix
            in="SourceAlpha"
            result="hardAlpha"
            values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
          ></feColorMatrix>
          <feOffset dx="10" dy="10"></feOffset>
          <feGaussianBlur stdDeviation="12"></feGaussianBlur>
          <feColorMatrix values="0 0 0 0 0.133333 0 0 0 0 0.160784 0 0 0 0 0.192157 0 0 0 0.24 0"></feColorMatrix>
          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_1481_2636"></feBlend>
          <feBlend in="SourceGraphic" in2="effect1_dropShadow_1481_2636" result="shape"></feBlend>
        </filter>
        <linearGradient
          id="paint0_linear_1481_2636"
          x1="24.895"
          x2="37.258"
          y1="47.892"
          y2="35.002"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#6E6E8F"></stop>
          <stop offset="1" stopColor="#484856"></stop>
        </linearGradient>
        <linearGradient
          id="paint1_linear_1481_2636"
          x1="42.191"
          x2="41.852"
          y1="22.001"
          y2="16.603"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#A9A9B9"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint2_linear_1481_2636"
          x1="30.996"
          x2="28.748"
          y1="35.831"
          y2="42.203"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#73738F"></stop>
          <stop offset="1" stopColor="#21212D"></stop>
        </linearGradient>
        <linearGradient
          id="paint3_linear_1481_2636"
          x1="32.432"
          x2="32.432"
          y1="47.809"
          y2="17.368"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#BEBECC"></stop>
          <stop offset="1" stopColor="#fff"></stop>
        </linearGradient>
        <linearGradient
          id="paint4_linear_1481_2636"
          x1="24.23"
          x2="41.497"
          y1="5.008"
          y2="46.476"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#fff" stopOpacity="0.23"></stop>
          <stop offset="0.743" stopColor="#FCFCFC" stopOpacity="0.08"></stop>
        </linearGradient>
        <linearGradient
          id="paint5_linear_1481_2636"
          x1="23.987"
          x2="35.603"
          y1="20.801"
          y2="20.801"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
        <clipPath id="clip0_1481_2636">
          <rect width="64" height="64" fill="#fff" rx="32"></rect>
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function RunTestBell(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 64 64" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/SSO.tsx
Tamaño: 1672 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export function SSO(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 18" fill="none" {...props}>
      <path
        d="M1.6125 14.425C2.6875 15.475 4 16 5 16V14C4.25 14 3.70833 13.6583 3.025 12.975C2.34167 12.2917 2 11.4667 2 10.5C2 9.53333 2.34167 8.70833 3.025 8.025C3.70833 7.34167 4.53333 7 5.5 7H6C6 5.61667 6.4875 4.4375 7.4625 3.4625C8.4375 2.4875 9.61667 2 11 2C12.3833 2 13.5625 2.4875 14.5375 3.4625C15.5125 4.4375 16 5.61667 16 7V9H17.5C18.2 9 18.7917 9.24167 19.275 9.725C19.7583 10.2083 20 10.8 20 11.5H22C22 10.35 21.6208 9.34583 20.8625 8.4875C20.1042 7.62917 19.15 7.13333 18 7C18 5.05 17.3208 3.39583 15.9625 2.0375C14.6042 0.679167 12.95 0 11 0C9.41667 0 8 0.475 6.75 1.425C5.5 2.375 4.66667 3.61667 4.25 5.15C2.98333 5.43333 1.95833 6.08333 1.175 7.1C0.391667 8.11667 0 9.275 0 10.575C0 12.0917 0.5375 13.375 1.6125 14.425Z"
        fill="#828299"
      />
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M8.05281 16.9792C8.75468 17.6597 9.60695 18 10.6096 18C11.4218 18 12.1312 17.7788 12.7378 17.3365C13.3444 16.8941 13.768 16.3375 14.0087 15.6667H19.3904V18H21.7968V15.6667H24V13.3333H14.0087C13.768 12.6625 13.3444 12.1059 12.7378 11.6635C12.1312 11.2212 11.4218 11 10.6096 11C9.60695 11 8.75468 11.3403 8.05281 12.0208C7.35094 12.7014 7 13.5278 7 14.5C7 15.4722 7.35094 16.2986 8.05281 16.9792ZM10.6001 16.6C11.7047 16.6 12.6001 15.7046 12.6001 14.6C12.6001 13.4954 11.7047 12.6 10.6001 12.6C9.49553 12.6 8.6001 13.4954 8.6001 14.6C8.6001 15.7046 9.49553 16.6 10.6001 16.6Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export function SSO(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 18" fill="none" {...props}>
<path
d="M1.6125 14.425C2.6875 15.475 4 16 5 16V14C4.25 14 3.70833 13.6583 3.025 12.975C2.34167 12.2917 2 11.4667 2 10.5C2 9.53333 2.34167 8.70833 3.025 8.025C3.70833 7.34167 4.53333 7 5.5 7H6C6 5.61667 6.4875 4.4375 7.4625 3.4625C8.4375 2.4875 9.61667 2 11 2C12.3833 2 13.5625 2.4875 14.5375 3.4625C15.5125 4.4375 16 5.61667 16 7V9H17.5C18.2 9 18.7917 9.24167 19.275 9.725C19.7583 10.2083 20 10.8 20 11.5H22C22 10.35 21.6208 9.34583 20.8625 8.4875C20.1042 7.62917 19.15 7.13333 18 7C18 5.05 17.3208 3.39583 15.9625 2.0375C14.6042 0.679167 12.95 0 11 0C9.41667 0 8 0.475 6.75 1.425C5.5 2.375 4.66667 3.61667 4.25 5.15C2.98333 5.43333 1.95833 6.08333 1.175 7.1C0.391667 8.11667 0 9.275 0 10.575C0 12.0917 0.5375 13.375 1.6125 14.425Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Seen.tsx
Tamaño: 1215 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Seen(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M17.3203 6.37695C15.7383 2.77344 12.5742 0.3125 9 0.3125C5.39648 0.3125 2.23242 2.77344 0.650391 6.37695C0.591797 6.52344 0.5625 6.75781 0.5625 6.875C0.5625 7.02148 0.591797 7.25586 0.650391 7.40234C2.23242 11.0059 5.39648 13.4375 9 13.4375C12.5742 13.4375 15.7383 11.0059 17.3203 7.40234C17.3789 7.25586 17.4375 7.02148 17.4375 6.875C17.4375 6.75781 17.3789 6.52344 17.3203 6.37695ZM13.2188 6.9043C13.2188 9.21875 11.3145 11.0938 9 11.0938C6.65625 11.0938 4.78125 9.21875 4.78125 6.875C4.78125 4.56055 6.65625 2.65625 9 2.65625C11.3145 2.65625 13.2188 4.56055 13.2188 6.875V6.9043ZM9 4.0625H8.9707C8.91211 4.0918 8.82422 4.0918 8.73633 4.0918C8.88281 4.38477 9 4.67773 9 5C9 6.05469 8.15039 6.875 7.125 6.875C6.77344 6.875 6.45117 6.78711 6.1875 6.64062C6.1875 6.72852 6.1875 6.81641 6.1875 6.875C6.1875 8.42773 7.44727 9.6875 9 9.6875C10.5234 9.6875 11.8125 8.42773 11.8125 6.875C11.8125 5.35156 10.5234 4.0625 9 4.0625Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Seen(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Sent.tsx
Tamaño: 995 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Sent(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M14.5625 9.75H11.75L10.8125 11.625H5.1875L4.25 9.75H1.4375C0.910156 9.75 0.5 10.1895 0.5 10.6875V13.9688C0.5 14.7598 1.11523 15.375 1.90625 15.375H14.0938C14.8555 15.375 15.5 14.7598 15.5 13.9688V10.6875C15.5 10.1895 15.0605 9.75 14.5625 9.75ZM5.83203 4.79883L7.0625 3.59766V8.8125C7.0625 9.33984 7.47266 9.75 8 9.75C8.49805 9.75 8.9375 9.33984 8.9375 8.8125V3.59766L10.1387 4.79883C10.3145 4.97461 10.5488 5.0625 10.8125 5.0625C11.0469 5.0625 11.2812 4.97461 11.457 4.79883C11.8379 4.44727 11.8379 3.83203 11.457 3.48047L8.64453 0.667969C8.29297 0.287109 7.67773 0.287109 7.32617 0.667969L4.51367 3.48047C4.13281 3.83203 4.13281 4.44727 4.51367 4.79883C4.86523 5.17969 5.48047 5.17969 5.83203 4.79883Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Sent(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Settings.tsx
Tamaño: 5002 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Settings(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <g clipPath="url(#clip0_595_2191)">
        <path
          d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          fillRule="evenodd"
          clipRule="evenodd"
        />
        <path
          d="M16.1667 12.5002C16.0557 12.7515 16.0227 13.0303 16.0717 13.3007C16.1207 13.571 16.2496 13.8204 16.4417 14.0168L16.4917 14.0668C16.6466 14.2216 16.7696 14.4054 16.8534 14.6078C16.9373 14.8101 16.9805 15.027 16.9805 15.246C16.9805 15.465 16.9373 15.6819 16.8534 15.8842C16.7696 16.0866 16.6466 16.2704 16.4917 16.4252C16.3369 16.5801 16.1531 16.7031 15.9507 16.7869C15.7484 16.8708 15.5315 16.914 15.3125 16.914C15.0935 16.914 14.8766 16.8708 14.6743 16.7869C14.4719 16.7031 14.2881 16.5801 14.1333 16.4252L14.0833 16.3752C13.8869 16.183 13.6375 16.0542 13.3672 16.0052C13.0968 15.9561 12.818 15.9892 12.5667 16.1002C12.3202 16.2058 12.11 16.3812 11.9619 16.6048C11.8139 16.8283 11.7344 17.0903 11.7333 17.3585V17.5002C11.7333 17.9422 11.5577 18.3661 11.2452 18.6787C10.9326 18.9912 10.5087 19.1668 10.0667 19.1668C9.62465 19.1668 9.20073 18.9912 8.88817 18.6787C8.5756 18.3661 8.40001 17.9422 8.40001 17.5002V17.4252C8.39356 17.1493 8.30427 16.8818 8.14377 16.6574C7.98326 16.433 7.75896 16.2621 7.50001 16.1668C7.24866 16.0559 6.96985 16.0228 6.69952 16.0718C6.42919 16.1208 6.17974 16.2497 5.98334 16.4418L5.93334 16.4918C5.77855 16.6468 5.59474 16.7697 5.39241 16.8536C5.19008 16.9375 4.9732 16.9806 4.75418 16.9806C4.53515 16.9806 4.31827 16.9375 4.11594 16.8536C3.91361 16.7697 3.7298 16.6468 3.57501 16.4918C3.42005 16.337 3.29712 16.1532 3.21324 15.9509C3.12937 15.7486 3.0862 15.5317 3.0862 15.3127C3.0862 15.0936 3.12937 14.8768 3.21324 14.6744C3.29712 14.4721 3.42005 14.2883 3.57501 14.1335L3.62501 14.0835C3.81712 13.8871 3.946 13.6376 3.99501 13.3673C4.04403 13.097 4.01094 12.8182 3.90001 12.5668C3.79437 12.3204 3.61897 12.1101 3.3954 11.9621C3.17182 11.814 2.90983 11.7346 2.64168 11.7335H2.50001C2.05798 11.7335 1.63406 11.5579 1.3215 11.2453C1.00894 10.9328 0.833344 10.5089 0.833344 10.0668C0.833344 9.6248 1.00894 9.20088 1.3215 8.88832C1.63406 8.57576 2.05798 8.40016 2.50001 8.40016H2.57501C2.85084 8.39371 3.11835 8.30443 3.34276 8.14392C3.56717 7.98341 3.73811 7.75911 3.83334 7.50016C3.94427 7.24882 3.97736 6.97 3.92835 6.69967C3.87933 6.42934 3.75046 6.17989 3.55834 5.9835L3.50834 5.9335C3.35338 5.77871 3.23045 5.59489 3.14658 5.39256C3.0627 5.19023 3.01953 4.97335 3.01953 4.75433C3.01953 4.5353 3.0627 4.31843 3.14658 4.1161C3.23045 3.91377 3.35338 3.72995 3.50834 3.57516C3.66313 3.4202 3.84695 3.29727 4.04928 3.2134C4.25161 3.12952 4.46848 3.08635 4.68751 3.08635C4.90654 3.08635 5.12341 3.12952 5.32574 3.2134C5.52807 3.29727 5.71189 3.4202 5.86668 3.57516L5.91668 3.62516C6.11308 3.81728 6.36252 3.94615 6.63285 3.99517C6.90318 4.04418 7.182 4.01109 7.43334 3.90016H7.50001C7.74648 3.79453 7.95669 3.61913 8.10475 3.39555C8.25282 3.17198 8.33227 2.90998 8.33334 2.64183V2.50016C8.33334 2.05814 8.50894 1.63421 8.8215 1.32165C9.13406 1.00909 9.55798 0.833496 10 0.833496C10.442 0.833496 10.866 1.00909 11.1785 1.32165C11.4911 1.63421 11.6667 2.05814 11.6667 2.50016V2.57516C11.6677 2.84332 11.7472 3.10531 11.8953 3.32888C12.0433 3.55246 12.2535 3.72786 12.5 3.8335C12.7514 3.94443 13.0302 3.97752 13.3005 3.9285C13.5708 3.87948 13.8203 3.75061 14.0167 3.5585L14.0667 3.5085C14.2215 3.35354 14.4053 3.2306 14.6076 3.14673C14.8099 3.06286 15.0268 3.01968 15.2458 3.01968C15.4649 3.01968 15.6817 3.06286 15.8841 3.14673C16.0864 3.2306 16.2702 3.35354 16.425 3.5085C16.58 3.66328 16.7029 3.8471 16.7868 4.04943C16.8706 4.25176 16.9138 4.46864 16.9138 4.68766C16.9138 4.90669 16.8706 5.12357 16.7868 5.3259C16.7029 5.52823 16.58 5.71204 16.425 5.86683L16.375 5.91683C16.1829 6.11323 16.054 6.36268 16.005 6.633C15.956 6.90333 15.9891 7.18215 16.1 7.4335V7.50016C16.2056 7.74664 16.381 7.95684 16.6046 8.10491C16.8282 8.25297 17.0902 8.33243 17.3583 8.3335H17.5C17.942 8.3335 18.366 8.50909 18.6785 8.82165C18.9911 9.13421 19.1667 9.55813 19.1667 10.0002C19.1667 10.4422 18.9911 10.8661 18.6785 11.1787C18.366 11.4912 17.942 11.6668 17.5 11.6668H17.425C17.1569 11.6679 16.8949 11.7474 16.6713 11.8954C16.4477 12.0435 16.2723 12.2537 16.1667 12.5002V12.5002Z"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          fillRule="evenodd"
          clipRule="evenodd"
        />
      </g>
      <defs>
        <clipPath id="clip0_595_2191">
          <rect width="20" height="20" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Settings(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<g clipPath="url(#clip0_595_2191)">
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Sms.tsx
Tamaño: 537 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Sms(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M17 4.5C17 3.54297 16.207 2.75 15.25 2.75H4.75C3.76562 2.75 3 3.54297 3 4.5V12.375C3 13.3594 3.76562 14.125 4.75 14.125H7.375V16.4219C7.375 16.6953 7.67578 16.8594 7.89453 16.6953L11.3125 14.125H15.25C16.207 14.125 17 13.3594 17 12.375V4.5Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Sms(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/SmsFilled.tsx
Tamaño: 855 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function SmsFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
  const id = Date.now();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-workflow-node-icon
      {...props}
    >
      <path
        fill={`url(#${id})`}
        d="M18.75 3H5.25A2.252 2.252 0 003 5.25v10.124c0 1.241 1.009 2.25 2.25 2.25h3.375v2.953c0 .345.393.545.671.341l4.39-3.294h5.063c1.241 0 2.25-1.009 2.25-2.25V5.25c0-1.241-1.009-2.25-2.25-2.25z"
      ></path>
      <defs>
        <linearGradient id={String(id)} x1="3" x2="20.999" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function SmsFilled(props: React.ComponentPropsWithoutRef<'svg'>) {
const id = Date.now();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Star.tsx
Tamaño: 1050 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { colors } from '../../config';

const StarHolder = styled.div`
  position: absolute;
  top: 0;
  right: 0;
  transform: translate(50%, -50%);
  width: 16px;
  height: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 100%;
  background: white;
  border: 1px solid ${colors.gradientMiddle};
`;

export const Star = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <StarHolder>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 10" width={12} height={12} {...props}>
        <path
          fill="url(#a)"
          d="m1.913 9.8.812-3.512L0 3.925l3.6-.312L5 .3l1.4 3.313 3.6.312-2.725 2.363.813 3.512L5 7.938 1.913 9.8Z"
        />
        <defs>
          <linearGradient id="a" x1="0" x2="10" y1="5.05" y2="5.05" gradientUnits="userSpaceOnUse">
            <stop stopColor="#DD2476" />
            <stop offset="1" stopColor="#FF512F" />
          </linearGradient>
        </defs>
      </svg>
    </StarHolder>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { colors } from '../../config';
const StarHolder = styled.div`
position: absolute;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/StarEmpty.tsx
Tamaño: 508 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const StarEmpty = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 13" width={18} height={18} {...props}>
      <path
        fill="currentColor"
        d="M4.9 9.883 7 8.617 9.1 9.9l-.55-2.4 1.85-1.6-2.433-.217-.966-2.266-.967 2.25-2.433.216L5.45 7.5 4.9 9.883Zm-2.016 2.784 1.083-4.684-3.633-3.15 4.8-.416L7.001 0l1.866 4.417 4.8.416-3.633 3.15 1.083 4.684-4.116-2.484-4.117 2.484Z"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const StarEmpty = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 13" width={18} height={18} {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Sun.tsx
Tamaño: 1879 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Sun(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M15.4583 20.6667C18.3348 20.6667 20.6667 18.3348 20.6667 15.4583C20.6667 12.5819 18.3348 10.25 15.4583 10.25C12.5819 10.25 10.25 12.5819 10.25 15.4583C10.25 18.3348 12.5819 20.6667 15.4583 20.6667Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path d="M15.458 4V6.08333" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
      <path
        d="M15.458 24.833V26.9163"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M7.35352 7.354L8.83268 8.83317"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M22.083 22.083L23.5622 23.5622"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path d="M4 15.458H6.08333" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
      <path
        d="M24.833 15.458H26.9163"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M7.35352 23.5622L8.83268 22.083"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M22.083 8.83317L23.5622 7.354"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Sun(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Team.tsx
Tamaño: 2332 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Team(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M5.16699 4.83333C5.16699 3.54467 6.21166 2.5 7.50033 2.5C8.78899 2.5 9.83366 3.54467 9.83366 4.83333C9.83366 6.122 8.78899 7.16667 7.50033 7.16667C6.21166 7.16667 5.16699 6.122 5.16699 4.83333ZM7.50033 0.5C5.10709 0.5 3.16699 2.4401 3.16699 4.83333C3.16699 7.22657 5.10709 9.16667 7.50033 9.16667C9.89356 9.16667 11.8337 7.22657 11.8337 4.83333C11.8337 2.4401 9.89356 0.5 7.50033 0.5ZM4.16634 10.5C3.01707 10.5 1.91487 10.9565 1.10221 11.7692C0.289554 12.5819 -0.166992 13.6841 -0.166992 14.8333V16.5C-0.166992 17.0523 0.280723 17.5 0.833008 17.5C1.38529 17.5 1.83301 17.0523 1.83301 16.5V14.8333C1.83301 14.2145 2.07884 13.621 2.51643 13.1834C2.95401 12.7458 3.5475 12.5 4.16634 12.5H10.833C11.4518 12.5 12.0453 12.7458 12.4829 13.1834C12.9205 13.621 13.1663 14.2145 13.1663 14.8333V16.5C13.1663 17.0523 13.6141 17.5 14.1663 17.5C14.7186 17.5 15.1663 17.0523 15.1663 16.5V14.8333C15.1663 13.6841 14.7098 12.5819 13.8971 11.7692C13.0845 10.9565 11.9823 10.5 10.833 10.5H4.16634ZM15.6987 11.3584C15.8368 10.8237 16.3822 10.5021 16.917 10.6402C17.8466 10.8802 18.6702 11.4222 19.2585 12.181C19.8467 12.9398 20.1663 13.8725 20.167 14.8327V14.8334V16.5001C20.167 17.0523 19.7193 17.5001 19.167 17.5001C18.6147 17.5001 18.167 17.0523 18.167 16.5001V14.8338C18.1665 14.317 17.9945 13.8148 17.6778 13.4063C17.361 12.9977 16.9176 12.7059 16.417 12.5766C15.8822 12.4386 15.5607 11.8931 15.6987 11.3584ZM13.581 0.639648C13.046 0.50266 12.5012 0.825333 12.3643 1.36036C12.2273 1.89538 12.5499 2.44016 13.085 2.57715C13.5869 2.70566 14.0317 2.99756 14.3494 3.40683C14.6671 3.8161 14.8395 4.31947 14.8395 4.83756C14.8395 5.35566 14.6671 5.85903 14.3494 6.2683C14.0317 6.67757 13.5869 6.96947 13.085 7.09798C12.5499 7.23497 12.2273 7.77975 12.3643 8.31477C12.5012 8.8498 13.046 9.17247 13.581 9.03548C14.5132 8.79682 15.3393 8.25472 15.9293 7.49464C16.5193 6.73457 16.8395 5.79975 16.8395 4.83756C16.8395 3.87538 16.5193 2.94056 15.9293 2.18049C15.3393 1.42041 14.5132 0.878308 13.581 0.639648Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Team(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/TextAlignment.tsx
Tamaño: 1024 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function TextAlignment(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M14.875 14.125H4.375C3.88281 14.125 3.5 14.5352 3.5 15C3.5 15.4922 3.88281 15.875 4.375 15.875H14.875C15.3398 15.875 15.75 15.4922 15.75 15C15.75 14.5352 15.3398 14.125 14.875 14.125ZM4.375 8.875H14.875C15.3398 8.875 15.75 8.49219 15.75 8C15.75 7.53516 15.3398 7.125 14.875 7.125H4.375C3.88281 7.125 3.5 7.53516 3.5 8C3.5 8.49219 3.88281 8.875 4.375 8.875ZM4.375 5.375H10.5C10.9648 5.375 11.375 4.99219 11.375 4.5C11.375 4.03516 10.9648 3.625 10.5 3.625H4.375C3.88281 3.625 3.5 4.03516 3.5 4.5C3.5 4.99219 3.88281 5.375 4.375 5.375ZM4.375 12.375H10.5C10.9648 12.375 11.375 11.9922 11.375 11.5C11.375 11.0352 10.9648 10.625 10.5 10.625H4.375C3.88281 10.625 3.5 11.0352 3.5 11.5C3.5 11.9922 3.88281 12.375 4.375 12.375Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function TextAlignment(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Timer.tsx
Tamaño: 952 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Timer(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M7 0.1875C3.36328 0.1875 0.4375 3.14062 0.4375 6.75C0.4375 10.3867 3.36328 13.3125 7 13.3125C10.6094 13.3125 13.5625 10.3867 13.5625 6.75C13.5625 3.14062 10.6094 0.1875 7 0.1875ZM7 12C4.10156 12 1.75 9.64844 1.75 6.75C1.75 3.87891 4.10156 1.5 7 1.5C9.87109 1.5 12.25 3.87891 12.25 6.75C12.25 9.64844 9.87109 12 7 12ZM7.65625 6.85938V3.90625C7.65625 3.55078 7.35547 3.25 7 3.25C6.61719 3.25 6.34375 3.55078 6.34375 3.90625V7.1875C6.34375 7.40625 6.42578 7.59766 6.58984 7.73438L8.33984 9.04688C8.44922 9.12891 8.58594 9.15625 8.72266 9.15625C8.94141 9.15625 9.13281 9.07422 9.26953 8.91016C9.48828 8.60938 9.43359 8.19922 9.13281 7.98047L7.65625 6.85938Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Timer(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Translate.tsx
Tamaño: 922 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export function Translate(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none" {...props}>
      <path
        d="M9.16667 16L12.7292 6.5H14.4375L18 16H16.3542L15.5 13.5625H11.6667L10.8125 16H9.16667ZM12.1667 12.1875H15L13.625 8.25H13.5417L12.1667 12.1875ZM2.52083 13.5L1.47917 12.4375L5.47917 8.47917C4.97917 7.95139 4.51389 7.40278 4.08333 6.83333C3.65278 6.26389 3.27778 5.64583 2.95833 4.97917H4.66667C4.91667 5.42361 5.20139 5.84028 5.52083 6.22917C5.84028 6.61806 6.16667 7 6.5 7.375C7.02778 6.79167 7.51389 6.18403 7.95833 5.55208C8.40278 4.92014 8.76389 4.23611 9.04167 3.5H0V2H5.75V0H7.25V2H13V3.5H10.625C10.3333 4.45833 9.90972 5.34375 9.35417 6.15625C8.79861 6.96875 8.1875 7.74306 7.52083 8.47917L9.41667 10.3542L8.83333 11.8958L6.5 9.5625L2.52083 13.5Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export function Translate(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none" {...props}>
<path
d="M9.16667 16L12.7292 6.5H14.4375L18 16H16.3542L15.5 13.5625H11.6667L10.8125 16H9.16667ZM12.1667 12.1875H15L13.625 8.25H13.5417L12.1667 12.1875ZM2.52083 13.5L1.47917 12.4375L5.47917 8.47917C4.97917 7.95139 4.51389 7.40278 4.08333 6.83333C3.65278 6.26389 3.27778 5.64583 2.95833 4.97917H4.66667C4.91667 5.42361 5.20139 5.84028 5.52083 6.22917C5.84028 6.61806 6.16667 7 6.5 7.375C7.02778 6.79167 7.51389 6.18403 7.95833 5.55208C8.40278 4.92014 8.76389 4.23611 9.04167 3.5H0V2H5.75V0H7.25V2H13V3.5H10.625C10.3333 4.45833 9.90972 5.34375 9.35417 6.15625C8.79861 6.96875 8.1875 7.74306 7.52083 8.47917L9.41667 10.3542L8.83333 11.8958L6.5 9.5625L2.52083 13.5Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Translation.tsx
Tamaño: 1759 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export function Translation(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
      <path
        fill="currentColor"
        fillRule="evenodd"
        d="M10.8 20.4L12 24h9.6c.7 0 1.275-.235 1.725-.705.45-.47.675-1.035.675-1.695V6c0-.7-.225-1.275-.675-1.725-.45-.45-1.025-.675-1.725-.675H10.65L9.6 0H2.4C1.74 0 1.175.235.705.705A2.311 2.311 0 000 2.4V18c0 .66.235 1.225.705 1.695S1.74 20.4 2.4 20.4h8.4zm4.08-5.31l-.66.63-.78-2.64c.22.36.445.7.675 1.02.23.32.485.65.765.99zm2.115-2.79c-.29.6-.715 1.23-1.275 1.89-.3-.36-.56-.715-.78-1.065-.22-.35-.41-.675-.57-.975h-1.2l-.36-1.26h4.77c-.1.34-.295.81-.585 1.41zM21.6 22.8h-8.4l2.4-2.4-.96-3.33 1.08-1.11 3.24 3.24.87-.87-3.27-3.21c.54-.62 1.01-1.29 1.41-2.01.4-.72.7-1.46.9-2.22h1.53V9.66h-4.38V8.4h-1.23v1.26h-2.37L11.01 4.8H21.6c.36 0 .65.11.87.33.22.22.33.51.33.87v15.6c0 .34-.11.625-.33.855-.22.23-.51.345-.87.345zM7.85 10.69v2.324c-.321.35-.675.62-1.062.81-.386.19-.784.286-1.192.286-.438 0-.788-.11-1.05-.33-.264-.218-.395-.518-.395-.898 0-.409.164-.767.493-1.074.328-.307.82-.562 1.477-.767a9.84 9.84 0 01.799-.197c.284-.059.594-.11.93-.154zm.153 3.726l.131.987H9.6V9.77c0-1.228-.27-2.163-.81-2.806C8.25 6.321 7.464 6 6.428 6c-.671 0-1.331.113-1.98.34a6.115 6.115 0 00-1.696.887l.7 1.228c.583-.35 1.061-.596 1.433-.734a3.202 3.202 0 011.127-.209c.613 0 1.065.157 1.357.472.292.314.452.814.482 1.5-.467.06-.901.125-1.302.198-.402.073-.77.154-1.106.241-1.065.293-1.838.68-2.32 1.162-.48.482-.722 1.103-.722 1.863 0 .818.241 1.465.723 1.94.481.475 1.138.712 1.97.712.554 0 1.075-.106 1.564-.318.489-.212.937-.5 1.346-.866z"
        clipRule="evenodd"
      ></path>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export function Translation(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" {...props}>
<path
fill="currentColor"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Trash.tsx
Tamaño: 1290 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Trash(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M4.375 15.4375C4.375 16.1758 4.94922 16.75 5.6875 16.75H13.5625C14.2734 16.75 14.875 16.1758 14.875 15.4375V6.25H4.375V15.4375ZM11.8125 8.4375C11.8125 8.21875 12.0039 8 12.25 8C12.4688 8 12.6875 8.21875 12.6875 8.4375V14.5625C12.6875 14.8086 12.4688 15 12.25 15C12.0039 15 11.8125 14.8086 11.8125 14.5625V8.4375ZM9.1875 8.4375C9.1875 8.21875 9.37891 8 9.625 8C9.84375 8 10.0625 8.21875 10.0625 8.4375V14.5625C10.0625 14.8086 9.84375 15 9.625 15C9.37891 15 9.1875 14.8086 9.1875 14.5625V8.4375ZM6.5625 8.4375C6.5625 8.21875 6.75391 8 7 8C7.21875 8 7.4375 8.21875 7.4375 8.4375V14.5625C7.4375 14.8086 7.21875 15 7 15C6.75391 15 6.5625 14.8086 6.5625 14.5625V8.4375ZM15.3125 3.625H12.25L11.9219 2.99609C11.8398 2.85938 11.7031 2.75 11.5391 2.75H7.68359C7.51953 2.75 7.38281 2.85938 7.30078 2.99609L7 3.625H3.9375C3.69141 3.625 3.5 3.84375 3.5 4.0625V4.9375C3.5 5.18359 3.69141 5.375 3.9375 5.375H15.3125C15.5312 5.375 15.75 5.18359 15.75 4.9375V4.0625C15.75 3.84375 15.5312 3.625 15.3125 3.625Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Trash(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/User.tsx
Tamaño: 76225 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function User(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlnsXlink="http://www.w3.org/1999/xlink"
      width="33"
      height="32"
      fill="none"
      viewBox="0 0 33 32"
      {...props}
    >
      <circle cx="16.5" cy="16" r="16" fill="url(#pattern0)"></circle>
      <defs>
        <pattern id="pattern0" width="1" height="1" patternContentUnits="objectBoundingBox">
          <use transform="scale(.005)" xlinkHref="#image0_2011_37528"></use>
        </pattern>
        <image
          id="image0_2011_37528"
          width="200"
          height="200"
          xlinkHref="data:image/png;base64,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"
        ></image>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function User(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/UserAccess.tsx
Tamaño: 1567 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function UserAccess(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" viewBox="0 0 18 17" fill="none" {...props}>
      <path
        d="M8 8C6.9 8 5.95833 7.60833 5.175 6.825C4.39167 6.04167 4 5.1 4 4C4 2.9 4.39167 1.95833 5.175 1.175C5.95833 0.391667 6.9 0 8 0C9.1 0 10.0417 0.391667 10.825 1.175C11.6083 1.95833 12 2.9 12 4C12 5.1 11.6083 6.04167 10.825 6.825C10.0417 7.60833 9.1 8 8 8ZM15.25 17L14 15.5V11.825C13.4 11.5917 12.9167 11.2208 12.55 10.7125C12.1833 10.2042 12 9.63333 12 9C12 8.16667 12.2917 7.45833 12.875 6.875C13.4583 6.29167 14.1667 6 15 6C15.8333 6 16.5417 6.29167 17.125 6.875C17.7083 7.45833 18 8.16667 18 9C18 9.63333 17.8167 10.2042 17.45 10.7125C17.0833 11.2208 16.6 11.5917 16 11.825V12L17 13L16 14L17 15L15.25 17ZM15 10.5C15.4167 10.5 15.7708 10.3542 16.0625 10.0625C16.3542 9.77083 16.5 9.41667 16.5 9C16.5 8.58333 16.3542 8.22917 16.0625 7.9375C15.7708 7.64583 15.4167 7.5 15 7.5C14.5833 7.5 14.2292 7.64583 13.9375 7.9375C13.6458 8.22917 13.5 8.58333 13.5 9C13.5 9.41667 13.6458 9.77083 13.9375 10.0625C14.2292 10.3542 14.5833 10.5 15 10.5ZM10.025 9.15C10.0583 9.91667 10.2375 10.6375 10.5625 11.3125C10.8875 11.9875 11.3667 12.5417 12 12.975V16H0V13.225C0 12.6583 0.141667 12.1333 0.425 11.65C0.708333 11.1667 1.1 10.8 1.6 10.55C2.6 10.05 3.6375 9.66667 4.7125 9.4C5.7875 9.13333 6.88333 9 8 9C8.33333 9 8.67083 9.0125 9.0125 9.0375C9.35417 9.0625 9.69167 9.1 10.025 9.15Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function UserAccess(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="17" viewBox="0 0 18 17" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Variant.tsx
Tamaño: 1540 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Variant(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M1.33073 7.33333L4.66406 7.33333C5.28629 7.33333 5.7474 7.23889 6.0474 7.05C6.3474 6.86111 6.64184 6.61111 6.93073 6.3L7.88073 7.25C7.75851 7.38333 7.62795 7.51111 7.48906 7.63333C7.35017 7.75556 7.20295 7.87778 7.0474 8C7.25851 8.15556 7.44462 8.31389 7.60573 8.475C7.76684 8.63611 7.92517 8.8 8.08073 8.96667C8.46962 9.38889 8.91962 9.77222 9.43073 10.1167C9.94184 10.4611 10.8363 10.6444 12.1141 10.6667L11.0641 9.61667L11.9974 8.66667L14.6641 11.3333L11.9974 14L11.0641 13.0667L12.1141 12C10.5252 11.9778 9.39462 11.7333 8.7224 11.2667C8.05017 10.8 7.50295 10.3333 7.08073 9.86667C6.75851 9.51111 6.44462 9.22222 6.13906 9C5.83351 8.77778 5.34184 8.66667 4.66406 8.66667L1.33073 8.66667L1.33073 7.33333ZM10.5474 4.13333C10.7696 4.08889 11.0141 4.05833 11.2807 4.04167C11.5474 4.025 11.8252 4.01111 12.1141 4L11.0641 2.93333L11.9974 2L14.6641 4.66667L11.9974 7.33333L11.0641 6.38333L12.0974 5.33333C11.8641 5.33333 11.6446 5.34444 11.4391 5.36667C11.2335 5.38889 11.0418 5.41111 10.8641 5.43333L10.5474 4.13333ZM7.61406 5.56667C7.8474 5.34444 8.11962 5.13056 8.43073 4.925C8.74184 4.71944 9.12517 4.53889 9.58073 4.38333L9.8974 5.66667C9.5974 5.77778 9.34184 5.90556 9.13073 6.05C8.91962 6.19444 8.73073 6.35 8.56406 6.51667L7.61406 5.56667Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Variant(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/VariantsFile.tsx
Tamaño: 1991 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function VariantsFile(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M2.33333 13.1667C1.96667 13.1667 1.65278 13.0361 1.39167 12.775C1.13056 12.5139 1 12.2 1 11.8333V3.83333C1 3.46667 1.13056 3.15278 1.39167 2.89167C1.65278 2.63056 1.96667 2.5 2.33333 2.5H6.33333L7.66667 3.83333H13C13.3667 3.83333 13.6806 3.96389 13.9417 4.225C14.2028 4.48611 14.3333 4.8 14.3333 5.16667H7.11667L5.78333 3.83333H2.33333V11.8333H7V13.1667H2.33333Z"
        fill="#828299"
      />
      <path
        d="M6.66863 9.74351H8.56355C8.92496 9.74351 9.21021 9.69528 9.4193 9.59881C9.62839 9.50235 9.8291 9.34512 10.0214 9.12712L10.8036 9.90928C10.739 9.97691 10.6711 10.043 10.6 10.1077C10.5289 10.1723 10.4565 10.2349 10.3829 10.2956C10.4952 10.385 10.5987 10.4741 10.6935 10.563C10.7884 10.652 10.8824 10.7544 10.9757 10.8703C11.2305 11.197 11.5236 11.4641 11.8548 11.6715C12.186 11.8789 12.6646 11.9876 13.2905 11.9976L12.6401 11.3472L13.4118 10.5651L15.4023 12.5615L13.4118 14.552L12.6401 13.7802L13.2905 13.1194C12.3995 13.082 11.738 12.9253 11.3061 12.6493C10.8742 12.3734 10.4851 12.0248 10.1387 11.6036C9.91379 11.3343 9.69995 11.1409 9.4972 11.0236C9.29445 10.9063 8.98323 10.8477 8.56355 10.8477H6.66863V9.74351ZM12.3584 7.57276C12.4934 7.54106 12.6442 7.51706 12.8108 7.50075C12.9775 7.48444 13.1393 7.47478 13.2963 7.47176L12.6401 6.81099L13.4118 6.03334L15.4023 8.02974L13.4118 10.0202L12.6401 9.23808L13.2859 8.58772C13.1715 8.58772 13.0569 8.59368 12.9422 8.60561C12.8274 8.61754 12.7224 8.63241 12.627 8.65022L12.3584 7.57276ZM10.4956 8.59224C10.6493 8.4298 10.8243 8.27846 11.0208 8.13821C11.2172 7.99796 11.4342 7.87922 11.6718 7.782L11.9462 8.88437C11.8098 8.94596 11.6883 9.01699 11.5819 9.09746C11.4755 9.17792 11.3741 9.26828 11.2778 9.36852L10.4956 8.59224Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function VariantsFile(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/ViewportWide.tsx
Tamaño: 641 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';

export const ViewportWide = () => {
  const theme = useMantineTheme();

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      strokeWidth="1.5"
      stroke="#00abfb"
      fill="none"
      strokeLinecap="round"
      strokeLinejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12h-7l3 -3m0 6l-3 -3" />
      <path d="M14 12h7l-3 -3m0 6l3 -3" />
      <path d="M3 6v-3h18v3" />
      <path d="M3 18v3h18v-3" />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { useMantineTheme } from '@mantine/core';
import { colors } from '../../config';
export const ViewportWide = () => {
const theme = useMantineTheme();
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/VueLogo.tsx
Tamaño: 392 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const VueLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
      <path fill="#61B083" d="M14.75 2.063 12 6.875 9.25 2.062H0l12 20.813L24 2.062h-9.25Z" />
      <path fill="#364659" d="M14.75 2.063 12 6.875 9.25 2.062H4.812L12 14.563l7.188-12.5H14.75Z" />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const VueLogo = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" {...props}>
<path fill="#61B083" d="M14.75 2.063 12 6.875 9.25 2.062H0l12 20.813L24 2.062h-9.25Z" />
<path fill="#364659" d="M14.75 2.063 12 6.875 9.25 2.062H4.812L12 14.563l7.188-12.5H14.75Z" />
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Warning.tsx
Tamaño: 677 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Warning(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none" {...props}>
      <path
        d="M0 19L11 0L22 19H0ZM3.45 17H18.55L11 4L3.45 17ZM11 16C11.2833 16 11.5208 15.9042 11.7125 15.7125C11.9042 15.5208 12 15.2833 12 15C12 14.7167 11.9042 14.4792 11.7125 14.2875C11.5208 14.0958 11.2833 14 11 14C10.7167 14 10.4792 14.0958 10.2875 14.2875C10.0958 14.4792 10 14.7167 10 15C10 15.2833 10.0958 15.5208 10.2875 15.7125C10.4792 15.9042 10.7167 16 11 16ZM10 13H12V8H10V13Z"
        fill="currentColor"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Warning(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/WarningIcon.tsx
Tamaño: 789 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function WarningIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M16.8125 13.0312L10.125 1.65625C9.625 0.78125 8.34375 0.78125 7.8125 1.65625L1.15625 13.0312C0.65625 13.9062 1.28125 15 2.3125 15H15.6562C16.6875 15 17.3125 13.9062 16.8125 13.0312ZM8.25 5.25C8.25 4.84375 8.5625 4.5 9 4.5C9.40625 4.5 9.75 4.84375 9.75 5.25V9.25C9.75 9.6875 9.40625 10 9 10C8.5625 10 8.25 9.6875 8.25 9.25V5.25ZM9 13C8.4375 13 8 12.5625 8 12.0312C8 11.5 8.4375 11.0625 9 11.0625C9.53125 11.0625 9.96875 11.5 9.96875 12.0312C9.96875 12.5625 9.53125 13 9 13Z"
        fill={props.color || '#FF8000'}
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function WarningIcon(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Wifi.tsx
Tamaño: 868 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Wifi(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M25.625 11.597C22.3946 9.73188 18.7302 8.75 15 8.75C11.2698 8.75 7.60541 9.73188 4.375 11.597"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <path
        d="M22.5 15.7596C20.2197 14.4431 17.6331 13.75 15 13.75C12.367 13.75 9.78029 14.4431 7.5 15.7596"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
      <path
        d="M20 20.0897C18.4798 19.2121 16.7554 18.75 15 18.75C13.2446 18.75 11.5202 19.2121 10 20.0897"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Wifi(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/Workflow.tsx
Tamaño: 1906 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Workflow(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M11.308 15L10.3214 14.0083L11.4241 12.9L10.3214 11.7917L11.308 10.8L12.4107 11.9083L13.5134 10.8L14.5 11.7917L13.3973 12.9L14.5 14.0083L13.5134 15L12.4107 13.8917L11.308 15ZM3.82143 13.6C4.07937 13.6 4.29861 13.5093 4.47917 13.3278C4.65972 13.1463 4.75 12.9259 4.75 12.6667C4.75 12.4074 4.65972 12.187 4.47917 12.0056C4.29861 11.8241 4.07937 11.7333 3.82143 11.7333C3.56349 11.7333 3.34425 11.8241 3.16369 12.0056C2.98313 12.187 2.89286 12.4074 2.89286 12.6667C2.89286 12.9259 2.98313 13.1463 3.16369 13.3278C3.34425 13.5093 3.56349 13.6 3.82143 13.6ZM3.82143 15C3.17659 15 2.62847 14.7731 2.17708 14.3194C1.72569 13.8657 1.5 13.3148 1.5 12.6667C1.5 12.0185 1.72569 11.4676 2.17708 11.0139C2.62847 10.5602 3.17659 10.3333 3.82143 10.3333C4.29861 10.3333 4.73065 10.4662 5.11756 10.7319C5.50446 10.9977 5.78819 11.3509 5.96875 11.7917C6.36855 11.6491 6.69097 11.3995 6.93601 11.0431C7.18105 10.6866 7.30357 10.2944 7.30357 9.86667V6.83333C7.30357 5.86111 7.64211 5.03472 8.3192 4.35417C8.99628 3.67361 9.81845 3.33333 10.7857 3.33333H11.753L10.4568 2.03056L11.4821 1L14.5 4.03333L11.4821 7.06667L10.4568 6.03611L11.753 4.73333H10.7857C10.2054 4.73333 9.71205 4.9375 9.3058 5.34583C8.89955 5.75417 8.69643 6.25 8.69643 6.83333V9.86667C8.69643 10.6704 8.45139 11.3866 7.96131 12.0153C7.47123 12.644 6.83929 13.0491 6.06548 13.2306C5.93651 13.7491 5.66567 14.1736 5.25298 14.5042C4.84028 14.8347 4.3631 15 3.82143 15ZM2.48661 6.13333L1.5 5.14167L2.60268 4.03333L1.5 2.925L2.48661 1.93333L3.58929 3.04167L4.69196 1.93333L5.67857 2.925L4.57589 4.03333L5.67857 5.14167L4.69196 6.13333L3.58929 5.025L2.48661 6.13333Z"
        fill="#828299"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Workflow(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/general/WorkflowSettings.tsx
Tamaño: 90072 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function WorkflowSettings(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlnsXlink="http://www.w3.org/1999/xlink"
      width="64"
      height="64"
      fill="none"
      viewBox="0 0 64 64"
      {...props}
    >
      <rect width="64" height="64" fill="#525266" rx="32"></rect>
      <path fill="url(#pattern0)" d="M4 4H60V60H4z"></path>
      <defs>
        <pattern id="pattern0" width="1" height="1" patternContentUnits="objectBoundingBox">
          <use transform="scale(.00222)" xlinkHref="#image0_1481_2019"></use>
        </pattern>
        <image
          id="image0_1481_2019"
          width="450"
          height="450"
          xlinkHref="data:image/png;base64,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"
        ></image>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function WorkflowSettings(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/AngularGradient.tsx
Tamaño: 2784 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const AngularGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <g filter="url(#filter0_d_263_2791)">
        <path
          d="M12.2975 0.0302734L1.08337 3.9949L2.8555 18.7545L12.3093 23.9744L21.812 18.6838L23.5834 3.92469L12.2975 0.0302734Z"
          fill="#BEBECC"
        />
        <path
          d="M22.4648 4.77748L12.2712 1.2854V22.727L20.8139 17.9775L22.4648 4.77748Z"
          fill="url(#paint0_linear_263_2791)"
        />
        <path
          d="M2.3418 4.84051L3.86037 18.0407L12.2711 22.7271V1.28516L2.34189 4.84042L2.3418 4.84051Z"
          fill="url(#paint1_linear_263_2791)"
        />
        <path
          d="M15.0773 12.7L12.2713 14.0182H9.31387L7.92367 17.5114L5.33789 17.5594L12.2713 2.06421L15.0773 12.7001V12.7ZM14.806 12.0363L12.29 7.03241L10.2261 11.9502H12.2712L14.806 12.0364V12.0363Z"
          fill="white"
        />
        <path
          d="M12.2711 2.06396L12.2897 7.03225L14.6315 11.9539H12.2764L12.2711 14.0148L15.5277 14.0179L17.0497 17.5598L19.5239 17.6058L12.2711 2.06396Z"
          fill="#BEBECC"
        />
      </g>
      <defs>
        <filter
          id="filter0_d_263_2791"
          x="-2.91663"
          y="0.0302734"
          width="30.5"
          height="31.9441"
          filterUnits="userSpaceOnUse"
          colorInterpolationFilters="sRGB"
        >
          <feFlood floodOpacity="0" result="BackgroundImageFix" />
          <feColorMatrix
            in="SourceAlpha"
            type="matrix"
            values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
            result="hardAlpha"
          />
          <feOffset dy="4" />
          <feGaussianBlur stdDeviation="2" />
          <feComposite in2="hardAlpha" operator="out" />
          <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
          <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_263_2791" />
          <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_263_2791" result="shape" />
        </filter>
        <linearGradient
          id="paint0_linear_263_2791"
          x1="17.368"
          y1="22.727"
          x2="17.368"
          y2="1.2854"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_263_2791"
          x1="2.3418"
          y1="12.0061"
          x2="12.2711"
          y2="12.0061"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const AngularGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
<g filter="url(#filter0_d_263_2791)">
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/ArrowLeftGradient.tsx
Tamaño: 982 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ArrowLeftGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none" {...props}>
      <path
        d="M15 7C15 6.3125 14.4375 5.75 13.75 5.75H5.15625L7.90625 2.875C8.375 2.375 8.34375 1.59375 7.84375 1.09375C7.34375 0.625 6.5625 0.65625 6.09375 1.15625L1.34375 6.15625C0.875 6.625 0.875 7.40625 1.34375 7.875L6.09375 12.875C6.3125 13.125 6.65625 13.25 7 13.25C7.28125 13.25 7.59375 13.1562 7.84375 12.9062C8.34375 12.4375 8.375 11.6562 7.90625 11.1562L5.15625 8.25H13.75C14.4375 8.25 15 7.71875 15 7Z"
        fill="url(#paint0_linear_969_37969)"
      />
      <defs>
        <linearGradient id="paint0_linear_969_37969" x1="1" y1="7" x2="15" y2="7" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ArrowLeftGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/BellGradient.tsx
Tamaño: 1195 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function BellGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M17.7295 24.5C17.4521 25.1072 17.0539 25.6113 16.5748 25.9617C16.0956 26.312 15.5524 26.4965 14.9995 26.4965C14.4466 26.4965 13.9034 26.312 13.4243 25.9617C12.9452 25.6113 12.547 25.1072 12.2695 24.5M21.6667 11.3C21.6667 9.49653 20.9643 7.76692 19.714 6.49167C18.4638 5.21643 16.7681 4.5 15 4.5C13.2319 4.5 11.5362 5.21643 10.286 6.49167C9.03571 7.76692 8.33333 9.49653 8.33333 11.3C8.33333 19.2333 5 21.5 5 21.5H25C25 21.5 21.6667 19.2333 21.6667 11.3Z"
        stroke="url(#paint0_linear_458_3283)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_458_3283"
          x1="15"
          y1="26.4965"
          x2="15"
          y2="4.5"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BellGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/BoltGradient.tsx
Tamaño: 1051 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function BoltGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="17" viewBox="0 0 13 17" fill="none" {...props}>
      <path
        d="M12.4062 9.78125C12.7188 9.5 12.8125 9.0625 12.6562 8.65625C12.5312 8.28125 12.1562 8.03125 11.7188 8.03125H8.25L10.6562 2.40625C10.8438 1.96875 10.6875 1.46875 10.3125 1.21875C9.9375 0.9375 9.4375 0.96875 9.0625 1.25L1.0625 8.25C0.75 8.53125 0.65625 8.96875 0.8125 9.375C0.9375 9.75 1.3125 10.0312 1.75 10.0312H5.21875L2.8125 15.625C2.625 16.0625 2.78125 16.5625 3.15625 16.8125C3.3125 16.9375 3.53125 17 3.75 17C3.96875 17 4.21875 16.9375 4.40625 16.7812L12.4062 9.78125Z"
        fill={props.fill || 'current'}
      />
      <defs>
        <linearGradient id="paint0_linear_1062_464" x1="6.75" y1="17" x2="6.75" y2="1" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BoltGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="13" height="17" viewBox="0 0 13 17" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/BoltOutlinedGradient.tsx
Tamaño: 828 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function BoltOutlinedGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 32 32" {...props}>
      <path
        stroke="url(#paint0_linear_244_7514)"
        strokeLinecap="round"
        strokeLinejoin="round"
        strokeWidth="2"
        d="M17.5 3.667l-12 14.4h10.8l-1.2 9.6 12-14.4H16.3l1.2-9.6z"
      ></path>
      <defs>
        <linearGradient
          id="paint0_linear_244_7514"
          x1="5.5"
          x2="27.1"
          y1="15.667"
          y2="15.667"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476"></stop>
          <stop offset="1" stopColor="#FF512F"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function BoltOutlinedGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 32 32" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/ChatGradient.tsx
Tamaño: 715 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function ChatGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none" {...props}>
      <path
        d="M25 5L14 16M25 5L18 25L14 16M25 5L5 12L14 16"
        stroke="url(#paint0_linear_2873_32232)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_2873_32232" x1="15" y1="25" x2="15" y2="5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ChatGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/CheckCircleBroken.tsx
Tamaño: 1213 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function CheckCircleBroken(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="70" height="71" viewBox="0 0 70 71" fill="none" {...props}>
      <path
        d="M64.1673 32.8335V35.5169C64.1637 41.8064 62.1271 47.9263 58.3612 52.9638C54.5953 58.0014 49.3019 61.6866 43.2704 63.4699C37.239 65.2532 30.7927 65.0391 24.8929 62.8594C18.9931 60.6797 13.9559 56.6513 10.5326 51.375C7.10934 46.0986 5.48338 39.857 5.89721 33.5811C6.31104 27.3052 8.7425 21.3311 12.829 16.55C16.9154 11.7688 22.4379 8.43672 28.5729 7.05062C34.7078 5.66451 41.1264 6.29867 46.8715 8.85853M64.1673 12.1668L35.0006 41.3627L26.2506 32.6127"
        stroke="url(#paint0_linear_469_3757)"
        strokeWidth="4.375"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_469_3757"
          x1="35.0007"
          y1="64.6668"
          x2="35.0007"
          y2="6.3335"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CheckCircleBroken(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="70" height="71" viewBox="0 0 70 71" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/CodeGradient.tsx
Tamaño: 1481 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const CodeGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="20" viewBox="0 0 25 20" fill="none">
      <path
        d="M15.3981 0.244299C14.7605 0.0605347 14.0967 0.431814 13.9129 1.06936L9.11257 17.8707C8.92881 18.5082 9.30008 19.172 9.93763 19.3558C10.5752 19.5396 11.239 19.1683 11.4228 18.5307L16.2231 1.72942C16.4069 1.09187 16.0356 0.428063 15.3981 0.244299ZM18.4208 4.7484C17.952 5.21719 17.952 5.9785 18.4208 6.44728L21.7698 9.80005L18.417 13.1528C17.9483 13.6216 17.9483 14.3829 18.417 14.8517C18.8858 15.3205 19.6471 15.3205 20.1159 14.8517L24.3163 10.6514C24.785 10.1826 24.785 9.42127 24.3163 8.95248L20.1159 4.75215C19.6471 4.28336 18.8858 4.28336 18.417 4.75215L18.4208 4.7484ZM6.91865 4.7484C6.44986 4.27961 5.68855 4.27961 5.21977 4.7484L1.01944 8.94873C0.55065 9.41752 0.55065 10.1788 1.01944 10.6476L5.21977 14.8479C5.68855 15.3167 6.44986 15.3167 6.91865 14.8479C7.38743 14.3792 7.38743 13.6178 6.91865 13.1491L3.56589 9.80005L6.91865 6.44728C7.38743 5.9785 7.38743 5.21719 6.91865 4.7484Z"
        fill="url(#paint0_linear_264_3031)"
      />
      <defs>
        <linearGradient
          id="paint0_linear_264_3031"
          x1="0.667847"
          y1="9.80005"
          x2="24.6678"
          y2="9.80005"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const CodeGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="25" height="20" viewBox="0 0 25 20" fill="none">
<path
d="M15.3981 0.244299C14.7605 0.0605347 14.0967 0.431814 13.9129 1.06936L9.11257 17.8707C8.92881 18.5082 9.30008 19.172 9.93763 19.3558C10.5752 19.5396 11.239 19.1683 11.4228 18.5307L16.2231 1.72942C16.4069 1.09187 16.0356 0.428063 15.3981 0.244299ZM18.4208 4.7484C17.952 5.21719 17.952 5.9785 18.4208 6.44728L21.7698 9.80005L18.417 13.1528C17.9483 13.6216 17.9483 14.3829 18.417 14.8517C18.8858 15.3205 19.6471 15.3205 20.1159 14.8517L24.3163 10.6514C24.785 10.1826 24.785 9.42127 24.3163 8.95248L20.1159 4.75215C19.6471 4.28336 18.8858 4.28336 18.417 4.75215L18.4208 4.7484ZM6.91865 4.7484C6.44986 4.27961 5.68855 4.27961 5.21977 4.7484L1.01944 8.94873C0.55065 9.41752 0.55065 10.1788 1.01944 10.6476L5.21977 14.8479C5.68855 15.3167 6.44986 15.3167 6.91865 14.8479C7.38743 14.3792 7.38743 13.6178 6.91865 13.1491L3.56589 9.80005L6.91865 6.44728C7.38743 5.9785 7.38743 5.21719 6.91865 4.7484Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/CompassGradient.tsx
Tamaño: 1373 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function CompassGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M15.25 28C22.1536 28 27.75 22.4036 27.75 15.5C27.75 8.59644 22.1536 3 15.25 3C8.34644 3 2.75 8.59644 2.75 15.5C2.75 22.4036 8.34644 28 15.25 28Z"
        stroke="url(#paint0_linear_240_2428)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M20.5502 10.2L17.9002 18.1499L9.9502 20.7999L12.6002 12.85L20.5502 10.2Z"
        stroke="url(#paint1_linear_240_2428)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_240_2428" x1="15.25" y1="28" x2="15.25" y2="3" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_240_2428"
          x1="15.2502"
          y1="20.7999"
          x2="15.2502"
          y2="10.2"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function CompassGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/ConnectGradient.tsx
Tamaño: 1176 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function ConnectGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M22.5 19.25C20.4289 19.25 18.75 20.9289 18.75 23C18.75 25.0711 20.4289 26.75 22.5 26.75C24.5711 26.75 26.25 25.0711 26.25 23C26.25 20.9289 24.5711 19.25 22.5 19.25ZM22.5 19.25V10.5C22.5 9.83696 22.2366 9.20107 21.7678 8.73223C21.2989 8.26339 20.663 8 20 8H16.25M7.5 11.75C9.57107 11.75 11.25 10.0711 11.25 8C11.25 5.92893 9.57107 4.25 7.5 4.25C5.42893 4.25 3.75 5.92893 3.75 8C3.75 10.0711 5.42893 11.75 7.5 11.75ZM7.5 11.75V26.75"
        stroke="url(#paint0_linear_1853_5058)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_1853_5058"
          x1="15"
          y1="26.75"
          x2="15"
          y2="4.25"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function ConnectGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/DelayAction.tsx
Tamaño: 2538 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function DelayAction(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="none"
      viewBox="0 0 24 24"
      data-blue-gradient-svg
      {...props}
    >
      <mask
        id="mask0_433_2481"
        style={{ maskType: 'alpha' }}
        width="24"
        height="24"
        x="0"
        y="0"
        maskUnits="userSpaceOnUse"
      >
        <path fill="#525266" d="M0 0H24V24H0z"></path>
      </mask>
      <g mask="url(#mask0_433_2481)">
        <path
          fill="url(#paint0_linear_433_2481)"
          d="M15.25 5c-.35 0-.646-.12-.887-.362A1.207 1.207 0 0114 3.75c0-.35.12-.646.363-.888.241-.241.537-.362.887-.362s.646.12.887.362c.242.242.363.538.363.888s-.12.646-.363.888A1.207 1.207 0 0115.25 5zm0 16.5c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0114 20.25c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm4-13c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0118 7.25c0-.35.12-.646.363-.888.241-.241.537-.362.887-.362s.646.12.887.362c.242.242.363.538.363.888s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm0 9.5c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0118 16.75c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zm1.5-4.75c-.35 0-.646-.12-.887-.363A1.207 1.207 0 0119.5 12c0-.35.12-.646.363-.887.241-.242.537-.363.887-.363s.646.12.887.363c.242.241.363.537.363.887s-.12.646-.363.887a1.207 1.207 0 01-.887.363zM12 22a9.738 9.738 0 01-3.9-.788 10.099 10.099 0 01-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 012 12c0-1.383.263-2.683.788-3.9a10.099 10.099 0 012.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0112 2v2c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20v2zm0-8c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0110 12c0-.083.004-.17.012-.262a.929.929 0 01.063-.263L8 9.4 9.4 8l2.075 2.075c.067-.017.242-.042.525-.075.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0112 14z"
        ></path>
      </g>
      <defs>
        <linearGradient id="paint0_linear_433_2481" x1="2" x2="22" y1="12" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#525266"></stop>
          <stop offset="1" stopColor="#525266"></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function DelayAction(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/DisconnectGradient.tsx
Tamaño: 1728 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const DisconnectGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path
        d="M6.375 3C5.75273 3 5.25 3.50273 5.25 4.125V7.5H7.5V4.125C7.5 3.50273 6.99727 3 6.375 3ZM13.125 3C12.5027 3 12 3.50273 12 4.125V7.5H14.25V4.125C14.25 3.50273 13.7473 3 13.125 3ZM4.125 8.625C3.50273 8.625 3 9.12773 3 9.75C3 10.3723 3.50273 10.875 4.125 10.875V12C4.125 14.7211 6.05859 16.9922 8.625 17.5125V19.875C8.625 20.4973 9.12773 21 9.75 21C10.3723 21 10.875 20.4973 10.875 19.875V17.5125C11.3074 17.4246 11.7223 17.2875 12.109 17.1082C12.0352 16.7285 12 16.3383 12 15.9375C12 13.1145 13.8914 10.7344 16.4754 9.98906C16.493 9.91172 16.5 9.83086 16.5 9.75C16.5 9.12773 15.9973 8.625 15.375 8.625H4.125ZM18.1875 21C19.5302 21 20.8178 20.4666 21.7672 19.5172C22.7166 18.5678 23.25 17.2802 23.25 15.9375C23.25 14.5948 22.7166 13.3072 21.7672 12.3578C20.8178 11.4084 19.5302 10.875 18.1875 10.875C16.8448 10.875 15.5572 11.4084 14.6078 12.3578C13.6584 13.3072 13.125 14.5948 13.125 15.9375C13.125 17.2802 13.6584 18.5678 14.6078 19.5172C15.5572 20.4666 16.8448 21 18.1875 21ZM20.2723 14.6473L18.982 15.9375L20.2723 17.2277C20.4902 17.4457 20.4902 17.8043 20.2723 18.0223C20.0543 18.2402 19.6957 18.2402 19.4777 18.0223L18.1875 16.732L16.8973 18.0223C16.6793 18.2402 16.3207 18.2402 16.1027 18.0223C15.8848 17.8043 15.8848 17.4457 16.1027 17.2277L17.393 15.9375L16.1027 14.6473C15.8848 14.4293 15.8848 14.0707 16.1027 13.8527C16.3207 13.6348 16.6793 13.6348 16.8973 13.8527L18.1875 15.143L19.4777 13.8527C19.6957 13.6348 20.0543 13.6348 20.2723 13.8527C20.4902 14.0707 20.4902 14.4293 20.2723 14.6473Z"
        fill="#E64545"
      />
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const DisconnectGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
<path
d="M6.375 3C5.75273 3 5.25 3.50273 5.25 4.125V7.5H7.5V4.125C7.5 3.50273 6.99727 3 6.375 3ZM13.125 3C12.5027 3 12 3.50273 12 4.125V7.5H14.25V4.125C14.25 3.50273 13.7473 3 13.125 3ZM4.125 8.625C3.50273 8.625 3 9.12773 3 9.75C3 10.3723 3.50273 10.875 4.125 10.875V12C4.125 14.7211 6.05859 16.9922 8.625 17.5125V19.875C8.625 20.4973 9.12773 21 9.75 21C10.3723 21 10.875 20.4973 10.875 19.875V17.5125C11.3074 17.4246 11.7223 17.2875 12.109 17.1082C12.0352 16.7285 12 16.3383 12 15.9375C12 13.1145 13.8914 10.7344 16.4754 9.98906C16.493 9.91172 16.5 9.83086 16.5 9.75C16.5 9.12773 15.9973 8.625 15.375 8.625H4.125ZM18.1875 21C19.5302 21 20.8178 20.4666 21.7672 19.5172C22.7166 18.5678 23.25 17.2802 23.25 15.9375C23.25 14.5948 22.7166 13.3072 21.7672 12.3578C20.8178 11.4084 19.5302 10.875 18.1875 10.875C16.8448 10.875 15.5572 11.4084 14.6078 12.3578C13.6584 13.3072 13.125 14.5948 13.125 15.9375C13.125 17.2802 13.6584 18.5678 14.6078 19.5172C15.5572 20.4666 16.8448 21 18.1875 21ZM20.2723 14.6473L18.982 15.9375L20.2723 17.2277C20.4902 17.4457 20.4902 17.8043 20.2723 18.0223C20.0543 18.2402 19.6957 18.2402 19.4777 18.0223L18.1875 16.732L16.8973 18.0223C16.6793 18.2402 16.3207 18.2402 16.1027 18.0223C15.8848 17.8043 15.8848 17.4457 16.1027 17.2277L17.393 15.9375L16.1027 14.6473C15.8848 14.4293 15.8848 14.0707 16.1027 13.8527C16.3207 13.6348 16.6793 13.6348 16.8973 13.8527L18.1875 15.143L19.4777 13.8527C19.6957 13.6348 20.0543 13.6348 20.2723 13.8527C20.4902 14.0707 20.4902 14.4293 20.2723 14.6473Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/EditGradient.tsx
Tamaño: 1917 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const EditGradient = (props: React.ComponentPropsWithoutRef<'svg'>) => (
  <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
    <path
      d="M17.4023 2.00781L16.2422 0.847656C15.8555 0.460938 15.3633 0.25 14.8711 0.25C14.3438 0.25 13.8516 0.460938 13.4648 0.847656L5.87109 8.44141C5.58984 8.72266 5.41406 9.03906 5.34375 9.39062L4.5 13.1875C4.42969 13.5039 4.67578 13.75 4.95703 13.75C4.99219 13.75 5.02734 13.75 5.0625 13.75C5.0625 13.75 7.66406 13.2227 8.85938 12.9414C9.21094 12.8359 9.52734 12.6602 9.77344 12.4141C11.2852 10.9023 14.7305 7.45703 17.4023 4.78516C18.1758 4.01172 18.1758 2.78125 17.4023 2.00781ZM16.207 3.58984L8.57812 11.2188C8.54297 11.2539 8.50781 11.2891 8.47266 11.2891C7.98047 11.3945 7.24219 11.5703 6.53906 11.7109L6.99609 9.77734C6.99609 9.70703 7.03125 9.67188 7.06641 9.63672L14.6602 2.04297C14.7305 1.97266 14.8008 1.9375 14.8711 1.9375C14.9062 1.9375 14.9766 1.97266 15.0469 2.04297L16.207 3.20312C16.3125 3.30859 16.3125 3.48438 16.207 3.58984ZM14.9062 10.375C14.4141 10.375 14.0625 10.7617 14.0625 11.2188V15.7188C14.0625 16.2109 13.6758 16.5625 13.2188 16.5625H2.53125C2.03906 16.5625 1.6875 16.2109 1.6875 15.7188V5.03125C1.6875 4.57422 2.03906 4.1875 2.53125 4.1875H7.59375C8.05078 4.1875 8.4375 3.83594 8.4375 3.34375C8.4375 2.88672 8.05078 2.5 7.59375 2.5H2.53125C1.125 2.5 0 3.66016 0 5.03125V15.7188C0 17.125 1.125 18.25 2.53125 18.25H13.2188C14.5898 18.25 15.75 17.125 15.75 15.7188V11.2188C15.75 10.7617 15.3633 10.375 14.9062 10.375Z"
      fill="url(#paint0_linear_715_3628)"
    />
    <defs>
      <linearGradient
        id="paint0_linear_715_3628"
        x1="0"
        y1="9.25"
        x2="17.9824"
        y2="9.25"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#DD2476" />
        <stop offset="1" stopColor="#FF512F" />
      </linearGradient>
    </defs>
  </svg>
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const EditGradient = (props: React.ComponentPropsWithoutRef<'svg'>) => (
<svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
d="M17.4023 2.00781L16.2422 0.847656C15.8555 0.460938 15.3633 0.25 14.8711 0.25C14.3438 0.25 13.8516 0.460938 13.4648 0.847656L5.87109 8.44141C5.58984 8.72266 5.41406 9.03906 5.34375 9.39062L4.5 13.1875C4.42969 13.5039 4.67578 13.75 4.95703 13.75C4.99219 13.75 5.02734 13.75 5.0625 13.75C5.0625 13.75 7.66406 13.2227 8.85938 12.9414C9.21094 12.8359 9.52734 12.6602 9.77344 12.4141C11.2852 10.9023 14.7305 7.45703 17.4023 4.78516C18.1758 4.01172 18.1758 2.78125 17.4023 2.00781ZM16.207 3.58984L8.57812 11.2188C8.54297 11.2539 8.50781 11.2891 8.47266 11.2891C7.98047 11.3945 7.24219 11.5703 6.53906 11.7109L6.99609 9.77734C6.99609 9.70703 7.03125 9.67188 7.06641 9.63672L14.6602 2.04297C14.7305 1.97266 14.8008 1.9375 14.8711 1.9375C14.9062 1.9375 14.9766 1.97266 15.0469 2.04297L16.207 3.20312C16.3125 3.30859 16.3125 3.48438 16.207 3.58984ZM14.9062 10.375C14.4141 10.375 14.0625 10.7617 14.0625 11.2188V15.7188C14.0625 16.2109 13.6758 16.5625 13.2188 16.5625H2.53125C2.03906 16.5625 1.6875 16.2109 1.6875 15.7188V5.03125C1.6875 4.57422 2.03906 4.1875 2.53125 4.1875H7.59375C8.05078 4.1875 8.4375 3.83594 8.4375 3.34375C8.4375 2.88672 8.05078 2.5 7.59375 2.5H2.53125C1.125 2.5 0 3.66016 0 5.03125V15.7188C0 17.125 1.125 18.25 2.53125 18.25H13.2188C14.5898 18.25 15.75 17.125 15.75 15.7188V11.2188C15.75 10.7617 15.3633 10.375 14.9062 10.375Z"
fill="url(#paint0_linear_715_3628)"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/FilterGradient.tsx
Tamaño: 1674 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function FilterGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M0.572363 1.93273L0.57238 1.93274L0.574219 1.92883C0.698078 1.6661 0.959604 1.5 1.25008 1.5H14.7501C15.0406 1.5 15.3021 1.6661 15.4259 1.92883C15.5502 2.19251 15.5125 2.50201 15.3286 2.72733C15.3285 2.72738 15.3285 2.72743 15.3284 2.72748L9.61313 9.71147L9.50008 9.84962V10.0281V14C9.50008 14.19 9.39357 14.3622 9.22499 14.4457C9.05061 14.5321 8.85006 14.5129 8.70074 14.4005L8.70008 14.4L6.70008 12.9L6.70009 12.9L6.69769 12.8982C6.57433 12.8068 6.50008 12.6603 6.50008 12.5V10.0281V9.8496L6.38701 9.71145L0.668889 2.72472C0.668799 2.72461 0.66871 2.7245 0.66862 2.72439C0.486303 2.50046 0.4487 2.18928 0.572363 1.93273Z"
        fill="url(#paint0_linear_1041_41139)"
        stroke="url(#paint1_linear_1041_41139)"
      />
      <defs>
        <linearGradient
          id="paint0_linear_1041_41139"
          x1="0.000244141"
          y1="7.99979"
          x2="15.9984"
          y2="7.99979"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_1041_41139"
          x1="0.000244141"
          y1="7.99979"
          x2="15.9984"
          y2="7.99979"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function FilterGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/FilterOutlined.tsx
Tamaño: 1302 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function FilterOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
      <path
        d="M0.572363 1.93273L0.57238 1.93274L0.574219 1.92883C0.698078 1.6661 0.959604 1.5 1.25008 1.5H14.7501C15.0406 1.5 15.3021 1.6661 15.4259 1.92883C15.5502 2.19251 15.5125 2.50201 15.3286 2.72733C15.3285 2.72738 15.3285 2.72743 15.3284 2.72748L9.61313 9.71147L9.50008 9.84962V10.0281V14C9.50008 14.19 9.39357 14.3622 9.22499 14.4457C9.05061 14.5321 8.85006 14.5129 8.70074 14.4005L8.70008 14.4L6.70008 12.9L6.70009 12.9L6.69769 12.8982C6.57433 12.8068 6.50008 12.6603 6.50008 12.5V10.0281V9.8496L6.38701 9.71145L0.668889 2.72472C0.668799 2.72461 0.66871 2.7245 0.66862 2.72439C0.486303 2.50046 0.4487 2.18928 0.572363 1.93273Z"
        stroke="url(#paint0_linear_1000_35469)"
      />
      <defs>
        <linearGradient
          id="paint0_linear_1000_35469"
          x1="0.000244141"
          y1="7.99979"
          x2="15.9984"
          y2="7.99979"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function FilterOutlined(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/GlobeGradient.tsx
Tamaño: 1883 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function GlobeGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M15.75 28C22.6536 28 28.25 22.4036 28.25 15.5C28.25 8.59644 22.6536 3 15.75 3C8.84644 3 3.25 8.59644 3.25 15.5C3.25 22.4036 8.84644 28 15.75 28Z"
        stroke="url(#paint0_linear_240_2434)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M3.25 15.5H28.25"
        stroke="url(#paint1_linear_240_2434)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M15.75 3C18.8766 6.42294 20.6534 10.865 20.75 15.5C20.6534 20.135 18.8766 24.5771 15.75 28C12.6234 24.5771 10.8466 20.135 10.75 15.5C10.8466 10.865 12.6234 6.42294 15.75 3V3Z"
        stroke="url(#paint2_linear_240_2434)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_240_2434" x1="15.75" y1="28" x2="15.75" y2="3" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_240_2434"
          x1="15.75"
          y1="16.5"
          x2="15.75"
          y2="15.5"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
        <linearGradient id="paint2_linear_240_2434" x1="15.75" y1="28" x2="15.75" y2="3" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function GlobeGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/JsGradient.tsx
Tamaño: 2139 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const JsGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clipPath="url(#clip0_263_2800)">
        <path d="M0 0H24V24H0V0Z" fill="url(#paint0_linear_263_2800)" />
        <path
          d="M22.0357 18.276C21.8601 17.1809 21.146 16.2615 19.0312 15.4037C18.2966 15.0661 17.4776 14.8243 17.2335 14.2676C17.1468 13.9436 17.1354 13.7611 17.1901 13.5649C17.3475 12.9284 18.1072 12.73 18.7095 12.9125C19.0973 13.0425 19.4646 13.3414 19.6859 13.8182C20.7217 13.1475 20.7194 13.152 21.4426 12.6912C21.1779 12.2805 21.0365 12.0912 20.8631 11.9155C20.2403 11.2197 19.3916 10.8615 18.0342 10.8889C17.7992 10.9186 17.562 10.9505 17.327 10.9802C16.6494 11.1513 16.0038 11.5072 15.6251 11.984C14.489 13.2729 14.8129 15.5292 16.1954 16.4577C17.5574 17.4798 19.5582 17.7125 19.8137 18.6684C20.0624 19.8387 18.9536 20.2174 17.8517 20.0828C17.0395 19.914 16.5879 19.5011 16.0996 18.7505C15.2008 19.2707 15.2008 19.2707 14.2768 19.8022C14.4958 20.2813 14.7262 20.498 15.0936 20.9132C16.832 22.6767 21.1825 22.5901 21.9628 19.9209C21.9947 19.8296 22.2046 19.2182 22.0357 18.276ZM13.0471 11.0303H10.8023C10.8023 12.9695 10.7932 14.895 10.7932 16.8341C10.7932 18.0684 10.8571 19.1999 10.6563 19.5467C10.3278 20.2288 9.47683 20.1444 9.08899 20.0121C8.69432 19.8181 8.49356 19.5421 8.26086 19.152C8.19698 19.0402 8.14907 18.9535 8.13308 18.9467C7.52398 19.3185 6.91711 19.6927 6.30798 20.0646C6.61143 20.6874 7.05855 21.2281 7.63118 21.5794C8.48669 22.0927 9.6365 22.2501 10.8388 21.974C11.6213 21.7459 12.2966 21.2737 12.6502 20.555C13.1612 19.6128 13.0517 18.4722 13.0471 17.2106C13.0586 15.1528 13.0471 13.095 13.0471 11.0303Z"
          fill="white"
        />
      </g>
      <defs>
        <linearGradient id="paint0_linear_263_2800" x1="0" y1="12" x2="24" y2="12" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <clipPath id="clip0_263_2800">
          <rect width="24" height="24" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const JsGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
<g clipPath="url(#clip0_263_2800)">
<path d="M0 0H24V24H0V0Z" fill="url(#paint0_linear_263_2800)" />
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/LevelsGradient.tsx
Tamaño: 743 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function LevelsGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M4 19V12M4 8V1M12 19V10M12 6V1M20 19V14M20 10V1M1 12H7M9 6H15M17 14H23"
        stroke="url(#paint0_linear_3297_35030)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_3297_35030" x1="12" y1="19" x2="12" y2="1" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function LevelsGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/MailGradient.tsx
Tamaño: 951 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

import { ISvgPropsInterface } from '../interfaces/svg-props.interface';
export function MailGradient({ disabled = false, width = '30px', height = '31px', ...props }: ISvgPropsInterface) {
  return (
    <svg width={width} height={height} viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M24 9L15 15.75L6 9M7 7.5H23C24.1 7.5 25 8.4 25 9.5V21.5C25 22.6 24.1 23.5 23 23.5H7C5.9 23.5 5 22.6 5 21.5V9.5C5 8.4 5.9 7.5 7 7.5Z"
        stroke={!disabled ? 'url(#paint0_linear_440_2017)' : 'currentColor'}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_440_2017" x1="15" y1="23.5" x2="15" y2="7.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { ISvgPropsInterface } from '../interfaces/svg-props.interface';
export function MailGradient({ disabled = false, width = '30px', height = '31px', ...props }: ISvgPropsInterface) {
return (
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/MobileGradient.tsx
Tamaño: 1072 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function MobileGradient(props: React.ComponentPropsWithoutRef<'svg'> & { disabled?: boolean }) {
  const { disabled, width, height } = props;

  const isDisabled = disabled != null ? disabled : false;

  return (
    <svg
      width={width || '30px'}
      height={height || '31px'}
      viewBox="0 0 30 31"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    >
      <path
        d="M15 23H15.01M8.75 3H21.25C22.6307 3 23.75 4.11929 23.75 5.5V25.5C23.75 26.8807 22.6307 28 21.25 28H8.75C7.36929 28 6.25 26.8807 6.25 25.5V5.5C6.25 4.11929 7.36929 3 8.75 3Z"
        stroke={!isDisabled ? 'url(#paint0_linear_440_2955)' : 'currentColor'}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_440_2955" x1="15" y1="28" x2="15" y2="3" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function MobileGradient(props: React.ComponentPropsWithoutRef<'svg'> & { disabled?: boolean }) {
const { disabled, width, height } = props;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/NestedSquares.tsx
Tamaño: 1246 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function NestedSquares(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="33" viewBox="0 0 32 33" fill="none" {...props}>
      <path
        d="M11.9999 1.83301V5.83301M19.9999 1.83301V5.83301M11.9999 27.1663V31.1663M19.9999 27.1663V31.1663M26.6666 12.4997H30.6666M26.6666 19.1663H30.6666M1.33325 12.4997H5.33325M1.33325 19.1663H5.33325M7.99992 5.83301H23.9999C25.4727 5.83301 26.6666 7.02692 26.6666 8.49967V24.4997C26.6666 25.9724 25.4727 27.1663 23.9999 27.1663H7.99992C6.52716 27.1663 5.33325 25.9724 5.33325 24.4997V8.49967C5.33325 7.02692 6.52716 5.83301 7.99992 5.83301ZM11.9999 12.4997H19.9999V20.4997H11.9999V12.4997Z"
        stroke="url(#paint0_linear_300_1960)"
        strokeWidth="2.66667"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_300_1960"
          x1="15.9999"
          y1="31.1663"
          x2="15.9999"
          y2="1.83301"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function NestedSquares(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="32" height="33" viewBox="0 0 32 33" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/PageGradient.tsx
Tamaño: 774 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###


export const PageGradient = (props: React.ComponentPropsWithoutRef<'svg'>) => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="49" height="48" fill="none" viewBox="0 0 49 48" {...props}>
      <path
        fill="url(#a)"
        d="M32.5 37c.55 0 1-.45 1-1V18h-5c-1.106 0-2-.894-2-2v-5h-10c-.55 0-1 .45-1 1v24c0 .55.45 1 1 1h16Zm-20-25c0-2.206 1.794-4 4-4h10.344c1.062 0 2.081.419 2.831 1.169l5.656 5.656a4.001 4.001 0 0 1 1.169 2.831V36c0 2.206-1.794 4-4 4h-16c-2.206 0-4-1.794-4-4V12Z"
      />
      <defs>
        <linearGradient id="a" x1="12.5" x2="36.5" y1="24" y2="24" gradientUnits="userSpaceOnUse">
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const PageGradient = (props: React.ComponentPropsWithoutRef<'svg'>) => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="49" height="48" fill="none" viewBox="0 0 49 48" {...props}>
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/PlusGradient.tsx
Tamaño: 927 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function PlusGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M9 14C8.17157 14 7.5 14.6716 7.5 15.5C7.5 16.3284 8.17157 17 9 17V14ZM21 17C21.8284 17 22.5 16.3284 22.5 15.5C22.5 14.6716 21.8284 14 21 14V17ZM16.5 9.5C16.5 8.67157 15.8284 8 15 8C14.1716 8 13.5 8.67157 13.5 9.5H16.5ZM13.5 21.5C13.5 22.3284 14.1716 23 15 23C15.8284 23 16.5 22.3284 16.5 21.5H13.5ZM9 17H21V14H9V17ZM13.5 9.5V21.5H16.5V9.5H13.5Z"
        fill="url(#paint0_linear_440_1987)"
      />
      <defs>
        <linearGradient id="paint0_linear_440_1987" x1="15" y1="21.5" x2="15" y2="9.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function PlusGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/ReactGradient.tsx
Tamaño: 5345 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const ReactGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path
        d="M24 12.0024C24 10.4403 22.009 8.95983 18.9564 8.04177C19.6608 4.98478 19.3477 2.55264 17.9682 1.77398C17.6502 1.59133 17.2784 1.50481 16.8724 1.50481V2.57668C17.0974 2.57668 17.2784 2.61994 17.4301 2.70165C18.0954 3.07656 18.384 4.50412 18.159 6.34024C18.1052 6.79206 18.0171 7.26791 17.9095 7.75338C16.9507 7.52266 15.9038 7.34482 14.8031 7.22946C14.1427 6.34024 13.4578 5.53273 12.768 4.82616C14.3628 3.36976 15.8598 2.57187 16.8773 2.57187V1.5C15.532 1.5 13.7709 2.44209 11.9902 4.07633C10.2095 2.45171 8.44843 1.51923 7.10314 1.51923V2.5911C8.11578 2.5911 9.61761 3.38418 11.2124 4.83097C10.5275 5.53754 9.84264 6.34024 9.19201 7.22946C8.08643 7.34482 7.03954 7.52266 6.08072 7.75818C5.9682 7.27752 5.88504 6.81128 5.82634 6.36427C5.59641 4.52815 5.88015 3.1006 6.54056 2.72087C6.68732 2.63436 6.87811 2.5959 7.10314 2.5959V1.52403C6.69221 1.52403 6.32042 1.61055 5.99755 1.7932C4.62291 2.57187 4.31472 4.9992 5.02405 8.04658C1.98125 8.96944 0 10.4451 0 12.0024C0 13.5645 1.99103 15.045 5.04362 15.963C4.33918 19.02 4.65226 21.4522 6.0318 22.2308C6.34978 22.4135 6.72157 22.5 7.13249 22.5C8.47778 22.5 10.2389 21.5579 12.0196 19.9237C13.8002 21.5483 15.5614 22.4808 16.9066 22.4808C17.3176 22.4808 17.6894 22.3943 18.0122 22.2116C19.3869 21.4329 19.6951 19.0056 18.9857 15.9582C22.0188 15.0402 24 13.5597 24 12.0024ZM17.6307 8.79641C17.4497 9.41646 17.2246 10.0557 16.9702 10.695C16.7697 10.3105 16.5593 9.92596 16.3294 9.54143C16.1044 9.1569 15.8647 8.78199 15.625 8.41669C16.3196 8.51762 16.9898 8.6426 17.6307 8.79641ZM15.3901 13.9154C15.0086 14.5643 14.6172 15.1796 14.2112 15.7515C13.4823 15.814 12.7436 15.8477 12 15.8477C11.2613 15.8477 10.5226 15.814 9.79862 15.7564C9.39258 15.1844 8.99633 14.5739 8.61476 13.9298C8.24297 13.3002 7.90542 12.6609 7.59723 12.0168C7.90053 11.3727 8.24297 10.7287 8.60987 10.099C8.99144 9.4501 9.3828 8.83486 9.78883 8.26288C10.5177 8.20039 11.2564 8.16674 12 8.16674C12.7387 8.16674 13.4774 8.20039 14.2014 8.25807C14.6074 8.83005 15.0037 9.44049 15.3852 10.0846C15.757 10.7142 16.0946 11.3535 16.4028 11.9976C16.0946 12.6417 15.757 13.2858 15.3901 13.9154ZM16.9702 13.2906C17.2344 13.9347 17.4594 14.5787 17.6453 15.2036C17.0045 15.3574 16.3294 15.4872 15.6298 15.5881C15.8695 15.218 16.1093 14.8383 16.3343 14.449C16.5593 14.0644 16.7697 13.6751 16.9702 13.2906ZM12.0098 18.4192C11.5548 17.9578 11.0999 17.4435 10.6498 16.8811C11.0901 16.9003 11.5402 16.9147 11.9951 16.9147C12.455 16.9147 12.9099 16.9051 13.3551 16.8811C12.9148 17.4435 12.4598 17.9578 12.0098 18.4192ZM8.37016 15.5881C7.6755 15.4872 7.0053 15.3622 6.36445 15.2084C6.54545 14.5884 6.77049 13.9491 7.02487 13.3098C7.22544 13.6943 7.43579 14.0789 7.66572 14.4634C7.89564 14.8479 8.13045 15.2228 8.37016 15.5881ZM11.9853 5.5856C12.4403 6.04704 12.8952 6.56134 13.3453 7.12371C12.905 7.10449 12.455 7.09007 12 7.09007C11.5402 7.09007 11.0852 7.09968 10.64 7.12371C11.0803 6.56134 11.5353 6.04704 11.9853 5.5856ZM8.36527 8.41669C8.12556 8.78679 7.88585 9.16651 7.66082 9.55585C7.43579 9.94038 7.22544 10.3249 7.02487 10.7094C6.7607 10.0653 6.53567 9.42126 6.34978 8.79641C6.99062 8.6474 7.66572 8.51762 8.36527 8.41669ZM3.93804 14.4345C2.20628 13.7087 1.08602 12.757 1.08602 12.0024C1.08602 11.2478 2.20628 10.2913 3.93804 9.57027C4.35875 9.39242 4.81859 9.23381 5.29311 9.0848C5.57195 10.0269 5.93885 11.0074 6.3938 12.012C5.94374 13.0118 5.58174 13.9875 5.30779 14.9248C4.82348 14.7758 4.36364 14.6124 3.93804 14.4345ZM6.56992 21.3032C5.90461 20.9282 5.61598 19.5007 5.84101 17.6646C5.89482 17.2127 5.98288 16.7369 6.0905 16.2514C7.04933 16.4821 8.09621 16.66 9.1969 16.7753C9.85732 17.6646 10.5422 18.4721 11.232 19.1786C9.63718 20.635 8.14024 21.4329 7.12271 21.4329C6.90257 21.4281 6.71667 21.3849 6.56992 21.3032ZM18.1737 17.6405C18.4036 19.4767 18.1199 20.9042 17.4594 21.2839C17.3127 21.3705 17.1219 21.4089 16.8969 21.4089C15.8842 21.4089 14.3824 20.6158 12.7876 19.169C13.4725 18.4625 14.1574 17.6598 14.808 16.7705C15.9136 16.6552 16.9605 16.4773 17.9193 16.2418C18.0318 16.7273 18.1199 17.1935 18.1737 17.6405ZM20.0571 14.4345C19.6364 14.6124 19.1765 14.771 18.702 14.92C18.4232 13.9779 18.0563 12.9974 17.6013 11.9928C18.0514 10.993 18.4134 10.0173 18.6873 9.08C19.1716 9.229 19.6315 9.39242 20.062 9.57027C21.7937 10.2961 22.914 11.2478 22.914 12.0024C22.9091 12.757 21.7888 13.7136 20.0571 14.4345Z"
        fill="url(#paint0_linear_263_2786)"
      />
      <path
        d="M11.9951 14.199C13.2298 14.199 14.2307 13.2156 14.2307 12.0024C14.2307 10.7892 13.2298 9.80579 11.9951 9.80579C10.7604 9.80579 9.75948 10.7892 9.75948 12.0024C9.75948 13.2156 10.7604 14.199 11.9951 14.199Z"
        fill="url(#paint1_linear_263_2786)"
      />
      <defs>
        <linearGradient id="paint0_linear_263_2786" x1="12" y1="22.5" x2="12" y2="1.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
        <linearGradient id="paint1_linear_263_2786" x1="12" y1="22.5" x2="12" y2="1.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const ReactGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
<path
d="M24 12.0024C24 10.4403 22.009 8.95983 18.9564 8.04177C19.6608 4.98478 19.3477 2.55264 17.9682 1.77398C17.6502 1.59133 17.2784 1.50481 16.8724 1.50481V2.57668C17.0974 2.57668 17.2784 2.61994 17.4301 2.70165C18.0954 3.07656 18.384 4.50412 18.159 6.34024C18.1052 6.79206 18.0171 7.26791 17.9095 7.75338C16.9507 7.52266 15.9038 7.34482 14.8031 7.22946C14.1427 6.34024 13.4578 5.53273 12.768 4.82616C14.3628 3.36976 15.8598 2.57187 16.8773 2.57187V1.5C15.532 1.5 13.7709 2.44209 11.9902 4.07633C10.2095 2.45171 8.44843 1.51923 7.10314 1.51923V2.5911C8.11578 2.5911 9.61761 3.38418 11.2124 4.83097C10.5275 5.53754 9.84264 6.34024 9.19201 7.22946C8.08643 7.34482 7.03954 7.52266 6.08072 7.75818C5.9682 7.27752 5.88504 6.81128 5.82634 6.36427C5.59641 4.52815 5.88015 3.1006 6.54056 2.72087C6.68732 2.63436 6.87811 2.5959 7.10314 2.5959V1.52403C6.69221 1.52403 6.32042 1.61055 5.99755 1.7932C4.62291 2.57187 4.31472 4.9992 5.02405 8.04658C1.98125 8.96944 0 10.4451 0 12.0024C0 13.5645 1.99103 15.045 5.04362 15.963C4.33918 19.02 4.65226 21.4522 6.0318 22.2308C6.34978 22.4135 6.72157 22.5 7.13249 22.5C8.47778 22.5 10.2389 21.5579 12.0196 19.9237C13.8002 21.5483 15.5614 22.4808 16.9066 22.4808C17.3176 22.4808 17.6894 22.3943 18.0122 22.2116C19.3869 21.4329 19.6951 19.0056 18.9857 15.9582C22.0188 15.0402 24 13.5597 24 12.0024ZM17.6307 8.79641C17.4497 9.41646 17.2246 10.0557 16.9702 10.695C16.7697 10.3105 16.5593 9.92596 16.3294 9.54143C16.1044 9.1569 15.8647 8.78199 15.625 8.41669C16.3196 8.51762 16.9898 8.6426 17.6307 8.79641ZM15.3901 13.9154C15.0086 14.5643 14.6172 15.1796 14.2112 15.7515C13.4823 15.814 12.7436 15.8477 12 15.8477C11.2613 15.8477 10.5226 15.814 9.79862 15.7564C9.39258 15.1844 8.99633 14.5739 8.61476 13.9298C8.24297 13.3002 7.90542 12.6609 7.59723 12.0168C7.90053 11.3727 8.24297 10.7287 8.60987 10.099C8.99144 9.4501 9.3828 8.83486 9.78883 8.26288C10.5177 8.20039 11.2564 8.16674 12 8.16674C12.7387 8.16674 13.4774 8.20039 14.2014 8.25807C14.6074 8.83005 15.0037 9.44049 15.3852 10.0846C15.757 10.7142 16.0946 11.3535 16.4028 11.9976C16.0946 12.6417 15.757 13.2858 15.3901 13.9154ZM16.9702 13.2906C17.2344 13.9347 17.4594 14.5787 17.6453 15.2036C17.0045 15.3574 16.3294 15.4872 15.6298 15.5881C15.8695 15.218 16.1093 14.8383 16.3343 14.449C16.5593 14.0644 16.7697 13.6751 16.9702 13.2906ZM12.0098 18.4192C11.5548 17.9578 11.0999 17.4435 10.6498 16.8811C11.0901 16.9003 11.5402 16.9147 11.9951 16.9147C12.455 16.9147 12.9099 16.9051 13.3551 16.8811C12.9148 17.4435 12.4598 17.9578 12.0098 18.4192ZM8.37016 15.5881C7.6755 15.4872 7.0053 15.3622 6.36445 15.2084C6.54545 14.5884 6.77049 13.9491 7.02487 13.3098C7.22544 13.6943 7.43579 14.0789 7.66572 14.4634C7.89564 14.8479 8.13045 15.2228 8.37016 15.5881ZM11.9853 5.5856C12.4403 6.04704 12.8952 6.56134 13.3453 7.12371C12.905 7.10449 12.455 7.09007 12 7.09007C11.5402 7.09007 11.0852 7.09968 10.64 7.12371C11.0803 6.56134 11.5353 6.04704 11.9853 5.5856ZM8.36527 8.41669C8.12556 8.78679 7.88585 9.16651 7.66082 9.55585C7.43579 9.94038 7.22544 10.3249 7.02487 10.7094C6.7607 10.0653 6.53567 9.42126 6.34978 8.79641C6.99062 8.6474 7.66572 8.51762 8.36527 8.41669ZM3.93804 14.4345C2.20628 13.7087 1.08602 12.757 1.08602 12.0024C1.08602 11.2478 2.20628 10.2913 3.93804 9.57027C4.35875 9.39242 4.81859 9.23381 5.29311 9.0848C5.57195 10.0269 5.93885 11.0074 6.3938 12.012C5.94374 13.0118 5.58174 13.9875 5.30779 14.9248C4.82348 14.7758 4.36364 14.6124 3.93804 14.4345ZM6.56992 21.3032C5.90461 20.9282 5.61598 19.5007 5.84101 17.6646C5.89482 17.2127 5.98288 16.7369 6.0905 16.2514C7.04933 16.4821 8.09621 16.66 9.1969 16.7753C9.85732 17.6646 10.5422 18.4721 11.232 19.1786C9.63718 20.635 8.14024 21.4329 7.12271 21.4329C6.90257 21.4281 6.71667 21.3849 6.56992 21.3032ZM18.1737 17.6405C18.4036 19.4767 18.1199 20.9042 17.4594 21.2839C17.3127 21.3705 17.1219 21.4089 16.8969 21.4089C15.8842 21.4089 14.3824 20.6158 12.7876 19.169C13.4725 18.4625 14.1574 17.6598 14.808 16.7705C15.9136 16.6552 16.9605 16.4773 17.9193 16.2418C18.0318 16.7273 18.1199 17.1935 18.1737 17.6405ZM20.0571 14.4345C19.6364 14.6124 19.1765 14.771 18.702 14.92C18.4232 13.9779 18.0563 12.9974 17.6013 11.9928C18.0514 10.993 18.4134 10.0173 18.6873 9.08C19.1716 9.229 19.6315 9.39242 20.062 9.57027C21.7937 10.2961 22.914 11.2478 22.914 12.0024C22.9091 12.757 21.7888 13.7136 20.0571 14.4345Z"
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/Smiley.tsx
Tamaño: 1087 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export function Smiley(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="31" viewBox="0 0 30 31" fill="none" {...props}>
      <path
        d="M9.66669 18.167C9.66669 18.167 11.6667 20.8337 15 20.8337C18.3334 20.8337 20.3334 18.167 20.3334 18.167M11 11.5003H11.0134M19 11.5003H19.0134M28.3334 15.5003C28.3334 22.8641 22.3638 28.8337 15 28.8337C7.63622 28.8337 1.66669 22.8641 1.66669 15.5003C1.66669 8.13653 7.63622 2.16699 15 2.16699C22.3638 2.16699 28.3334 8.13653 28.3334 15.5003Z"
        stroke="url(#paint0_linear_300_2007)"
        strokeWidth="2.66667"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_300_2007"
          x1="15"
          y1="28.8337"
          x2="15"
          y2="2.16699"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Smiley(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="31" viewBox="0 0 30 31" fill="none" {...props}>
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/SmsGradient.tsx
Tamaño: 1240 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';

export interface IIconProps {
  disabled?: boolean;
  width?: string;
  height?: string;
}

export function SmsGradient({ disabled = false, width = '31px', height = '31px' }: IIconProps) {
  return (
    <svg width={width} height={height} viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M33.8332 26.2778C33.8332 27.0047 33.521 27.7018 32.9653 28.2158C32.4097 28.7298 31.656 29.0186 30.8702 29.0186H13.0924L7.1665 33.8334V12.5741C7.1665 11.8472 7.47867 11.1501 8.03434 10.6361C8.59 10.1221 9.34364 9.83337 10.1295 9.83337H30.8702C31.656 9.83337 32.4097 10.1221 32.9653 10.6361C33.521 11.1501 33.8332 11.8472 33.8332 12.5741V26.2778Z"
        stroke={!disabled ? 'url(#paint0_linear_440_3090)' : 'currentColor'}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient
          id="paint0_linear_440_3090"
          x1="20.4998"
          y1="33.8334"
          x2="20.4998"
          y2="9.83337"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export interface IIconProps {
disabled?: boolean;
width?: string;
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/TapeGradient.tsx
Tamaño: 1794 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function TapeGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M10.9578 15.1601C10.5492 14.7886 9.91672 14.8187 9.54522 15.2273C9.17371 15.636 9.20383 16.2684 9.61248 16.6399L10.9578 15.1601ZM12.6423 18.0429L13.315 18.7828C13.5234 18.5933 13.6423 18.3246 13.6423 18.0429C13.6423 17.7611 13.5234 17.4924 13.315 17.3029L12.6423 18.0429ZM9.61248 19.4458C9.20383 19.8173 9.17371 20.4497 9.54522 20.8584C9.91672 21.267 10.5492 21.2972 10.9578 20.9257L9.61248 19.4458ZM17.3555 17C16.8032 17 16.3555 17.4477 16.3555 18C16.3555 18.5523 16.8032 19 17.3555 19V17ZM20.4983 19C21.0506 19 21.4983 18.5523 21.4983 18C21.4983 17.4477 21.0506 17 20.4983 17V19ZM7 8.5H23V6.5H7V8.5ZM24 9.5V21.5H26V9.5H24ZM23 22.5H7V24.5H23V22.5ZM6 21.5V9.5H4V21.5H6ZM7 22.5C6.44772 22.5 6 22.0523 6 21.5H4C4 23.1569 5.34315 24.5 7 24.5V22.5ZM24 21.5C24 22.0523 23.5523 22.5 23 22.5V24.5C24.6569 24.5 26 23.1569 26 21.5H24ZM23 8.5C23.5523 8.5 24 8.94772 24 9.5H26C26 7.84315 24.6569 6.5 23 6.5V8.5ZM7 6.5C5.34315 6.5 4 7.84315 4 9.5H6C6 8.94772 6.44772 8.5 7 8.5V6.5ZM9.61248 16.6399L11.9696 18.7828L13.315 17.3029L10.9578 15.1601L9.61248 16.6399ZM11.9696 17.3029L9.61248 19.4458L10.9578 20.9257L13.315 18.7828L11.9696 17.3029ZM17.3555 19H20.4983V17H17.3555V19ZM6 13.5H15V11.5H6V13.5ZM15 13.5H24V11.5H15V13.5Z"
        fill="url(#paint0_linear_440_3778)"
      />
      <defs>
        <linearGradient id="paint0_linear_440_3778" x1="15" y1="23.5" x2="15" y2="7.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF512F" />
          <stop offset="1" stopColor="#DD2476" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function TapeGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="30" height="31" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/TerminalGradient.tsx
Tamaño: 1362 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { colors } from '../../config';

export function TerminalGradient(props: React.ComponentPropsWithoutRef<'svg'> & { disabled?: boolean }) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" {...props}>
      <mask
        id="mask0_2012_45416"
        style={{ maskType: 'alpha' }}
        width="16"
        height="16"
        x="0"
        y="0"
        maskUnits="userSpaceOnUse"
      >
        <path fill="#D9D9D9" d="M0 0H16V16H0z"></path>
      </mask>
      <g mask="url(#mask0_2012_45416)">
        <path
          fill="url(#paint0_linear_2012_45416)"
          d="M2.8 12.8c-.33 0-.613-.118-.848-.353A1.157 1.157 0 011.6 11.6V4.395c0-.33.117-.612.352-.845A1.16 1.16 0 012.8 3.2h10.4c.33 0 .612.118.847.353s.353.517.353.848v7.204c0 .33-.118.612-.353.845a1.16 1.16 0 01-.847.35H2.8zm0-1.2h10.4v-6H2.8v6zm2.2-.8l-.85-.85L5.5 8.6 4.15 7.25 5 6.4l2.2 2.2L5 10.8zm3 0V9.6h4v1.2H8z"
        ></path>
      </g>
      <defs>
        <linearGradient id="paint0_linear_2012_45416" x1="1.6" x2="14.4" y1="8" y2="8" gradientUnits="userSpaceOnUse">
          <stop stopColor={props.disabled ? colors.B40 : '#DD2476'}></stop>
          <stop offset="1" stopColor={props.disabled ? colors.B40 : '#FF512F'}></stop>
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { colors } from '../../config';
export function TerminalGradient(props: React.ComponentPropsWithoutRef<'svg'> & { disabled?: boolean }) {
return (
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/TimerGradient.tsx
Tamaño: 828 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function TimerGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M12 5.9V12.5L16.4 14.7M23 12.5C23 18.5751 18.0751 23.5 12 23.5C5.92487 23.5 1 18.5751 1 12.5C1 6.42487 5.92487 1.5 12 1.5C18.0751 1.5 23 6.42487 23 12.5Z"
        stroke="url(#paint0_linear_3519_36042)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_3519_36042" x1="12" y1="23.5" x2="12" y2="1.5" gradientUnits="userSpaceOnUse">
          <stop stopColor="#14DEEB" />
          <stop offset="1" stopColor="#446EDC" />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function TimerGradient(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/TurnOnGradient.tsx
Tamaño: 1191 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { ISvgPropsInterface } from '../interfaces/svg-props.interface';

export function TurnOnGradient({ stopColor, offSetStopColor, ...props }: ISvgPropsInterface) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="24" viewBox="0 0 22 24" fill="none" {...props}>
      <path
        d="M18.0722 6.10325C19.4704 7.48772 20.4225 9.25148 20.8081 11.1715C21.1937 13.0916 20.9955 15.0817 20.2385 16.8902C19.4815 18.6987 18.1998 20.2445 16.5554 21.332C14.9109 22.4195 12.9777 23 11 23C9.02233 23 7.08906 22.4195 5.44464 21.332C3.80022 20.2445 2.51849 18.6987 1.76152 16.8902C1.00455 15.0817 0.806325 13.0916 1.19191 11.1715C1.5775 9.25148 2.52958 7.48772 3.92778 6.10325M11.0056 1V11.9984"
        stroke="url(#paint0_linear_1020_1949)"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <defs>
        <linearGradient id="paint0_linear_1020_1949" x1="11" y1="23" x2="11" y2="1" gradientUnits="userSpaceOnUse">
          <stop stopColor={stopColor ?? '#FF512F'} />
          <stop offset="1" stopColor={offSetStopColor ?? '#DD2476'} />
        </linearGradient>
      </defs>
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { ISvgPropsInterface } from '../interfaces/svg-props.interface';
export function TurnOnGradient({ stopColor, offSetStopColor, ...props }: ISvgPropsInterface) {
return (
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/gradient/VueGradient.tsx
Tamaño: 1047 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

export const VueGradient = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <g clipPath="url(#clip0_271_6303)">
        <path
          d="M15.4166 2.0625L12.6666 6.875L9.91663 2.0625H0.666626L12.6666 22.875L24.6666 2.0625H15.4166Z"
          fill="url(#paint0_linear_271_6303)"
        />
        <path
          d="M15.4166 2.0625L12.6666 6.875L9.91663 2.0625H5.47913L12.6666 14.5625L19.8541 2.0625H15.4166Z"
          fill="#BEBECC"
        />
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_271_6303"
          x1="0.666626"
          y1="12.4688"
          x2="24.6666"
          y2="12.4688"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#DD2476" />
          <stop offset="1" stopColor="#FF512F" />
        </linearGradient>
        <clipPath id="clip0_271_6303">
          <rect width="24" height="24" fill="white" transform="translate(0.666626)" />
        </clipPath>
      </defs>
    </svg>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

export const VueGradient = () => {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
<g clipPath="url(#clip0_271_6303)">
<path
No se detectaron dependencias obvias en el texto.

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/interfaces/svg-props.interface.ts
Tamaño: 223 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import React from 'react';

export interface ISvgPropsInterface extends React.ComponentPropsWithoutRef<'svg'> {
  disabled?: boolean;
  width?: string;
  height?: string;
  stopColor?: string;
  offSetStopColor?: string;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  interface

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/icons/social/GitHub.tsx
Tamaño: 2708 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function GitHub(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M5.15625 12.4375C5.15625 12.375 5.09375 12.3125 5 12.3125C4.90625 12.3125 4.84375 12.375 4.84375 12.4375C4.84375 12.5 4.90625 12.5625 5 12.5312C5.09375 12.5312 5.15625 12.5 5.15625 12.4375ZM4.1875 12.2812C4.1875 12.3438 4.25 12.4375 4.34375 12.4375C4.40625 12.4688 4.5 12.4375 4.53125 12.375C4.53125 12.3125 4.5 12.25 4.40625 12.2188C4.3125 12.1875 4.21875 12.2188 4.1875 12.2812ZM5.59375 12.25C5.5 12.25 5.4375 12.3125 5.4375 12.4062C5.4375 12.4688 5.53125 12.5 5.625 12.4688C5.71875 12.4375 5.78125 12.4062 5.75 12.3438C5.75 12.2812 5.65625 12.2188 5.59375 12.25ZM7.625 0.25C3.3125 0.25 0 3.5625 0 7.875C0 11.3438 2.15625 14.3125 5.28125 15.375C5.6875 15.4375 5.8125 15.1875 5.8125 15C5.8125 14.7812 5.8125 13.7188 5.8125 13.0625C5.8125 13.0625 3.625 13.5312 3.15625 12.125C3.15625 12.125 2.8125 11.2188 2.3125 11C2.3125 11 1.59375 10.5 2.34375 10.5C2.34375 10.5 3.125 10.5625 3.5625 11.3125C4.25 12.5312 5.375 12.1875 5.84375 11.9688C5.90625 11.4688 6.09375 11.125 6.34375 10.9062C4.59375 10.7188 2.8125 10.4688 2.8125 7.46875C2.8125 6.59375 3.0625 6.1875 3.5625 5.625C3.46875 5.40625 3.21875 4.59375 3.65625 3.5C4.28125 3.3125 5.8125 4.34375 5.8125 4.34375C6.4375 4.15625 7.09375 4.09375 7.75 4.09375C8.4375 4.09375 9.09375 4.15625 9.71875 4.34375C9.71875 4.34375 11.2188 3.28125 11.875 3.5C12.3125 4.59375 12.0312 5.40625 11.9688 5.625C12.4688 6.1875 12.7812 6.59375 12.7812 7.46875C12.7812 10.4688 10.9375 10.7188 9.1875 10.9062C9.46875 11.1562 9.71875 11.625 9.71875 12.375C9.71875 13.4062 9.6875 14.7188 9.6875 14.9688C9.6875 15.1875 9.84375 15.4375 10.25 15.3438C13.375 14.3125 15.5 11.3438 15.5 7.875C15.5 3.5625 11.9688 0.25 7.625 0.25ZM3.03125 11.0312C2.96875 11.0625 3 11.1562 3.03125 11.2188C3.09375 11.25 3.15625 11.2812 3.21875 11.25C3.25 11.2188 3.25 11.125 3.1875 11.0625C3.125 11.0312 3.0625 11 3.03125 11.0312ZM2.6875 10.7812C2.65625 10.8438 2.6875 10.875 2.75 10.9062C2.8125 10.9375 2.875 10.9375 2.90625 10.875C2.90625 10.8438 2.875 10.8125 2.8125 10.7812C2.75 10.75 2.71875 10.75 2.6875 10.7812ZM3.6875 11.9062C3.65625 11.9375 3.65625 12.0312 3.75 12.0938C3.8125 12.1562 3.90625 12.1875 3.9375 12.125C3.96875 12.0938 3.96875 12 3.90625 11.9375C3.84375 11.875 3.75 11.8438 3.6875 11.9062ZM3.34375 11.4375C3.28125 11.4688 3.28125 11.5625 3.34375 11.625C3.40625 11.6875 3.46875 11.7188 3.53125 11.6875C3.5625 11.6562 3.5625 11.5625 3.53125 11.5C3.46875 11.4375 3.40625 11.4062 3.34375 11.4375Z"
        fill="#525266"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function GitHub(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/icons/social/Google.tsx
Tamaño: 1437 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
export function Google(props: React.ComponentPropsWithoutRef<'svg'>) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none" {...props}>
      <path
        d="M11.2083 8.18184V12.0546H16.5901C16.3538 13.3001 15.6446 14.3546 14.581 15.0637L17.8265 17.5819C19.7174 15.8365 20.8083 13.2729 20.8083 10.2274C20.8083 9.51832 20.7447 8.83643 20.6265 8.18195L11.2083 8.18184Z"
        fill="#4285F4"
      />
      <path
        d="M5.60401 11.9034L4.87203 12.4637L2.28107 14.4819C3.92653 17.7455 7.29902 20.0001 11.2081 20.0001C13.9081 20.0001 16.1719 19.1092 17.8265 17.5819L14.581 15.0637C13.6901 15.6637 12.5535 16.0274 11.2081 16.0274C8.60811 16.0274 6.39907 14.2729 5.6081 11.9092L5.60401 11.9034Z"
        fill="#34A853"
      />
      <path
        d="M2.28108 5.51822C1.59929 6.86362 1.20842 8.38183 1.20842 10C1.20842 11.6182 1.59928 13.1365 2.28107 14.4819C2.28107 14.4909 5.60843 11.8999 5.60843 11.8999C5.40843 11.2999 5.29021 10.6636 5.29021 9.99989C5.29021 9.33617 5.40843 8.69984 5.60843 8.09984L2.28108 5.51822Z"
        fill="#FBBC05"
      />
      <path
        d="M11.2083 3.98184C12.6811 3.98184 13.9901 4.49092 15.0356 5.47276L17.8992 2.60914C16.1628 0.990977 13.9084 0 11.2083 0C7.29923 0 3.92654 2.24546 2.28108 5.51822L5.60843 8.09984C6.39929 5.73616 8.60831 3.98184 11.2083 3.98184Z"
        fill="#EA4335"
      />
    </svg>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
export function Google(props: React.ComponentPropsWithoutRef<'svg'>) {
return (
<svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none" {...props}>
<path
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/Icon.const.ts
Tamaño: 115 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IconSize } from './Icon.types';

/**
 * Style Props
 */

export const DEFAULT_ICON_SIZE: IconSize = '20';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/Icon.md
Tamaño: 710 bytes
Lenguaje detectado: Markdown

### CONTENIDO ORIGINAL ###

# Icon

## Plan

This directory, `iconV2`, will be moved renamed to `icons` once we remove all the older Icons from the design system. They have all been marked as deprecated in the meantime.

## Background

This group of icons comes from the Material Icons by means of the [react-icons](https://react-icons.github.io/react-icons/icons/md/) package.

### A11y Context

`title` is mandatory to ensure that we are acknowledging a11y as a priority.

## Use

To use an Icon, simply use the [react-icons docs](https://react-icons.github.io/react-icons/icons/md/) for names with "Icon" as a prefix instead of "Md". Alternatively, you can refer to our Storybook!

E.g. instead of using `<Md10k />`, use `<Icon10k />`


### ANALISIS AUTOMATICO (ESPAÑOL) ###

# Icon
## Plan
This directory, `iconV2`, will be moved renamed to `icons` once we remove all the older Icons from the design system. They have all been marked as deprecated in the meantime.
## Background
### A11y Context
## Use
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/Icon.stories.tsx
Tamaño: 1961 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { useState } from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Grid, Group, ActionIcon, Code, Text } from '@mantine/core';
import { DEFAULT_ICON_SIZE } from './Icon.const';
import { IIconProps, IconSize } from './Icon.types';
import { Input } from '../input/Input';
import * as allIcons from './icon-registry';

export default {
  title: 'Icons/IconsV2',
  args: {
    size: DEFAULT_ICON_SIZE as IconSize,
    color: undefined,
  },
  argTypes: {
    color: { control: 'color' },
  },
} as Meta<IIconProps>;

const IconsWrapper = ({ color, size }: IIconProps) => {
  const [search, setSearch] = useState('');
  const [iconName, setIconName] = useState('IconName');

  return (
    <div style={{ width: '100%', height: '100%', margin: 'auto', overflowY: 'auto' }}>
      <Code block mb={20}>
        {`import { ${iconName} } from '@novu/design-system'
     
<${iconName} /> `}
      </Code>
      <Input label="Search Icon" placeholder="Search" value={search} onChange={(e) => setSearch(e.target.value)} />
      <Grid align="center" gutter="xs" style={{ padding: '10px', paddingTop: '20px', paddingBottom: '20px' }}>
        {Object.entries(allIcons).map(([name, Icon]) => {
          if (name.includes(search.toLowerCase())) {
            return (
              <Grid.Col key={name} span={3}>
                <Group align="center" spacing={3}>
                  <ActionIcon variant="transparent" onClick={() => setIconName(name)}>
                    <Icon color={color} size={size} />
                  </ActionIcon>
                  <Text align="center" weight={400} size="xs">
                    {name}
                  </Text>
                </Group>
              </Grid.Col>
            );
          }

          return null;
        })}
      </Grid>
    </div>
  );
};

const Template: StoryFn<IIconProps> = ({ ...args }) => <IconsWrapper {...args} />;

export const Icons = Template.bind({});
Icons.args = {};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { useState } from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Grid, Group, ActionIcon, Code, Text } from '@mantine/core';
import { DEFAULT_ICON_SIZE } from './Icon.const';
import { IIconProps, IconSize } from './Icon.types';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/Icon.types.ts
Tamaño: 1294 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { CSSProperties, SVGAttributes } from 'react';

/**
 * @deprecated Use @novu/novui/icons instead.
 * Icon Size in pixels (to be replaced with values directly from Design System)
 */
export type IconSize = '16' | '20' | '24';

/**
 * @deprecated Use @novu/novui/icons instead.
 * A temporary type that accepts a typical CSS color until we have our strict Design System types defined
 */
type UnsafeIconColor = CSSProperties['color'];

/** @deprecated Use @novu/novui/icons instead. */
export interface IIconStyleProps {
  /**
   *
   * @deprecated Use @novu/novui/icons instead.
   * Default: '20px'.
   *
   * The actual display size in pixels.
   */
  size?: IconSize;
  /**
   *
   * @deprecated Use @novu/novui/icons instead.
   * Default: B60
   *
   * WARNING: this is only to be used with colors from the design system, and will later be enforced more strictly
   */
  color?: UnsafeIconColor;
}

/** @deprecated Use @novu/novui/icons instead. */
export interface IIconProps extends Omit<SVGAttributes<SVGElement>, 'color'>, IIconStyleProps {
  /**
   * Description for accessibility. This is mandatory so that we make a11y a priority with icons
   */
  title: string;
}

/** @deprecated Use @novu/novui/icons instead. */
export type IconType = (props: IIconProps) => JSX.Element;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - IconType(props: IIconProps))
Declaraciones 'export' encontradas:
- export  type
- export  interface
- export  interface
- export  type

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/IconProvider.tsx
Tamaño: 681 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { PropsWithChildren } from 'react';
import { IconContext } from 'react-icons';
import { css } from '@emotion/react';
import { useMantineTheme } from '@mantine/core';
import { DEFAULT_ICON_SIZE } from './Icon.const';

const iconClassName = css`
  vertical-align: middle;
`;

export const IconProvider: React.FC<PropsWithChildren<{}>> = ({ children }) => {
  const theme = useMantineTheme();

  return (
    <IconContext.Provider
      value={{
        color: theme.colorScheme === 'dark' ? theme.colors.gray[7] : theme.colors.gray[7],
        size: DEFAULT_ICON_SIZE,
        className: iconClassName.name,
      }}
    >
      {children}
    </IconContext.Provider>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { PropsWithChildren } from 'react';
import { IconContext } from 'react-icons';
import { css } from '@emotion/react';
import { useMantineTheme } from '@mantine/core';
import { DEFAULT_ICON_SIZE } from './Icon.const';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/icon-registry.ts
Tamaño: 549389 bytes
Lenguaje detectado: TypeScript
 
### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/iconsV2/react-icons.d.ts
Tamaño: 579 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import type { IconSize, IconType as NovuIconType, IIconProps } from './Icon.types';

/** Override Icon types */

declare module 'react-icons' {
  export type IconType = NovuIconType;

  // avoid declaration merging by using type instead of interface below
  export type IconBaseProps = IIconProps;
  export type IconContextProps = {
    color?: IconColor;
    size?: IconSize;
    className?: string;
    attr?: React.SVGAttributes<SVGElement>;
  };

  export declare const DefaultContext: IconContextProps;
  export declare const IconContext: React.Context<IconContextProps>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  type
- export  type
- export  type
- export  declare
- export  declare

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/input/Input.stories.tsx
Tamaño: 1117 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Input } from './Input';
import { Copy } from '../icons';

export default {
  title: 'Inputs/Input',
  component: Input,
  argTypes: {
    value: {
      table: {
        disable: true,
      },
    },
    onChange: {
      table: {
        disable: true,
      },
    },
  },
} as Meta<typeof Input>;

const Template: StoryFn<typeof Input> = ({ ...args }) => <Input {...args} />;

export const PrimaryUse = Template.bind({});
PrimaryUse.args = {
  label: 'Notification Name',
  placeholder: 'Notification name goes here...',
};

export const WithDescription = Template.bind({});
WithDescription.args = {
  label: 'Notification Name',
  description: 'Will be used as identifier',
  placeholder: 'Notification name goes here...',
};

export const WithIcon = Template.bind({});
WithIcon.args = {
  label: 'Notification Name',
  value: 'e297cdd6cf29ea8f566c06da18ccf151',
  rightSection: <Copy />,
};

export const Error = Template.bind({});
Error.args = {
  label: 'Your Email',
  value: 'NotGood@email.com',
  error: 'Not Good!',
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Input } from './Input';
import { Copy } from '../icons';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/input/Input.tsx
Tamaño: 1746 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEvent, FocusEvent } from 'react';
import { TextInputProps, TextInput as MantineTextInput, Styles, InputProps } from '@mantine/core';
import { inputStyles } from '../config/inputs.styles';
import { SpacingProps } from '../shared/spacing.props';

export interface IInputProps extends SpacingProps, Pick<InputProps, 'classNames'> {
  label?: React.ReactNode;
  error?: React.ReactNode;
  placeholder?: string;
  required?: boolean;
  readOnly?: boolean;
  disabled?: boolean;
  value?: string;
  description?: string;
  onChange?: (event: ChangeEvent<HTMLInputElement>) => void;
  rightSection?: React.ReactNode;
  rightSectionWidth?: React.CSSProperties['width'];
  type?: 'text' | 'password' | 'email' | 'search' | 'tel' | 'url' | 'number' | 'time';
  min?: string | number;
  max?: string | number;
  onBlur?: (event: FocusEvent<HTMLInputElement>) => void;
  styles?: Styles<string, Record<string, any>>;
  className?: string;
  id?: string;
}

/**
 * Input component
 *
 */
export const Input = React.forwardRef<HTMLInputElement, IInputProps>(
  (
    {
      value,
      rightSection,
      rightSectionWidth,
      onChange,
      readOnly = false,
      disabled = false,
      type,
      ...props
    }: IInputProps,
    ref
  ) => {
    const defaultDesign = { radius: 'md', size: 'md', styles: inputStyles, type: 'text' } as TextInputProps;

    return (
      <MantineTextInput
        ref={ref}
        {...(rightSection ? { rightSection, rightSectionWidth: rightSectionWidth ?? 50 } : {})}
        {...defaultDesign}
        onChange={onChange}
        autoComplete="off"
        readOnly={readOnly}
        disabled={disabled}
        value={value}
        type={type}
        {...props}
      />
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEvent, FocusEvent } from 'react';
import { TextInputProps, TextInput as MantineTextInput, Styles, InputProps } from '@mantine/core';
import { inputStyles } from '../config/inputs.styles';
import { SpacingProps } from '../shared/spacing.props';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/layout/PageContainer.tsx
Tamaño: 691 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import React, { CSSProperties } from 'react';
import { Container } from '../container/Container';
import { PageMeta } from './PageMeta';

export function PageContainer({
  children,
  title,
  style,
}: {
  children: React.ReactNode;
  title?: string;
  style?: CSSProperties;
}) {
  const containerStyle = {
    borderRadius: 0,
    ...style,
  };

  return (
    <StyledContainer fluid style={containerStyle} h={`100%`}>
      <PageMeta title={title} />
      {children}
    </StyledContainer>
  );
}

const StyledContainer = styled(Container)`
  overflow-y: auto !important;
  border-radius: 0;
  padding-left: 0;
  padding-right: 0;
  margin: 0;
`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import React, { CSSProperties } from 'react';
import { Container } from '../container/Container';
import { PageMeta } from './PageMeta';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/layout/PageMeta.tsx
Tamaño: 243 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { Helmet } from 'react-helmet-async';

type Props = {
  title?: string;
};

export function PageMeta({ title }: Props) {
  return (
    <Helmet>
      <title>{title ? `${title} | ` : ``}Novu Cloud Dashboard</title>
    </Helmet>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { Helmet } from 'react-helmet-async';
type Props = {
title?: string;
};
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/layout/index.ts
Tamaño: 61 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './PageContainer';
export * from './PageMeta';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/loading-overlay/LoadingOverlay.tsx
Tamaño: 696 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { LoadingOverlayProps, LoadingOverlay as MantineLoadingOverlay, useMantineTheme } from '@mantine/core';
import { PropsWithChildren } from 'react';
import { colors } from '../config';

interface ILoadingOverlayProps {
  visible: boolean;
  minLayoutHeight?: number;
}

export function LoadingOverlay({ children, minLayoutHeight = 500, visible }: PropsWithChildren<ILoadingOverlayProps>) {
  const theme = useMantineTheme();
  const defaultDesign = {
    overlayColor: theme.colorScheme === 'dark' ? colors.B30 : colors.B98,
    loaderProps: { color: colors.error },
  } as LoadingOverlayProps;

  return <div style={{ position: 'relative', minHeight: minLayoutHeight }}>{children}</div>;
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { LoadingOverlayProps, LoadingOverlay as MantineLoadingOverlay, useMantineTheme } from '@mantine/core';
import { PropsWithChildren } from 'react';
import { colors } from '../config';
interface ILoadingOverlayProps {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/modal/Modal.styles.ts
Tamaño: 365 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';

import { colors } from '../config';

export default createStyles((theme: MantineTheme) => {
  return {
    modal: {
      backgroundColor: theme.colorScheme === 'dark' ? colors.B15 : colors.white,
    },
    body: {
      paddingTop: '5px',
    },
    inner: {
      paddingTop: '180px',
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/modal/Modal.tsx
Tamaño: 912 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { ModalProps, Modal as MantineModal } from '@mantine/core';
import React, { ReactNode } from 'react';
import useStyles from './Modal.styles';
import { colors, shadows } from '../config';

interface IModalProps extends ModalProps {
  opened: boolean;
  title: ReactNode | string;
  onClose: () => void;
  size?: 'lg' | 'xl' | 'md';
  zIndex?: number;
  centered?: boolean;
}

export function Modal({ children, ...props }: IModalProps) {
  const { classes, theme } = useStyles();
  const defaultDesign = {
    radius: 'md',
    size: 'lg',
    overlayOpacity: 0.7,
    overlayColor: theme.colorScheme === 'dark' ? colors.BGDark : colors.BGLight,
    shadow: theme.colorScheme === 'dark' ? shadows.dark : shadows.medium,
    classNames: classes,
  } as ModalProps;

  return (
    <MantineModal {...defaultDesign} {...props} sx={{ backdropFilter: 'blur(10px)' }}>
      {children}
    </MantineModal>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { ModalProps, Modal as MantineModal } from '@mantine/core';
import React, { ReactNode } from 'react';
import useStyles from './Modal.styles';
import { colors, shadows } from '../config';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/name-input/NameInput.tsx
Tamaño: 865 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEvent } from 'react';
import { TextInput as MantineTextInput } from '@mantine/core';
import { SpacingProps } from '../shared/spacing.props';
import { nameInputStyles } from './nameInputStyles';

interface INameInputProps extends SpacingProps {
  placeholder?: string;
  required?: boolean;
  autoFocus?: boolean;
  disabled?: boolean;
  value?: string;
  onChange?: (event: ChangeEvent<HTMLInputElement>) => void;
}

/**
 * NameInput component
 *
 */
export const NameInput = React.forwardRef<HTMLInputElement, INameInputProps>(
  ({ value, onChange, disabled = false, ...props }: INameInputProps, ref) => {
    return (
      <MantineTextInput
        ref={ref}
        styles={nameInputStyles}
        onChange={onChange}
        autoComplete="off"
        disabled={disabled}
        value={value}
        {...props}
      />
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEvent } from 'react';
import { TextInput as MantineTextInput } from '@mantine/core';
import { SpacingProps } from '../shared/spacing.props';
import { nameInputStyles } from './nameInputStyles';
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/name-input/nameInputStyles.ts
Tamaño: 1138 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { MantineTheme } from '@mantine/core';
import { colors } from '../config';

export const nameInputStyles = (theme: MantineTheme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    root: {
      flex: '1 1 auto',
    },
    wrapper: {
      background: 'transparent',
      width: '100%',
    },
    input: {
      background: 'transparent',
      borderStyle: 'solid',
      borderColor: dark ? theme.colors.dark[5] : theme.colors.gray[5],
      color: dark ? colors.white : colors.B40,
      borderWidth: '1px',
      fontSize: '20px',
      fontWeight: 700,
      padding: '4px 10px',
      lineHeight: '28px',
      minHeight: 'auto',
      height: 'auto',
      width: '100%',
      textOverflow: 'ellipsis',
      '&:not(:placeholder-shown)': {
        borderColor: 'transparent',
        padding: '4px 10px',
      },
      '&:hover, &:focus': {
        borderColor: dark ? colors.B30 : colors.B80,
        padding: '4px 10px',
      },
      '&:disabled': {
        backgroundColor: dark ? colors.B15 : theme.white,
        color: dark ? theme.white : theme.black,
        opacity: 1,
      },
    },
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - nameInputStyles(theme: MantineTheme))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/navigation/NavLinkPopover.styles.ts
Tamaño: 444 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles } from '@mantine/core';

import { colors } from '../config';

export default createStyles(({ colorScheme }) => ({
  dropdown: {
    padding: '16px',
    backgroundColor: colorScheme === 'dark' ? colors.B20 : colors.white,
    color: colors.B60,
    border: 'none',
  },
  arrow: {
    backgroundColor: colorScheme === 'dark' ? colors.B20 : colors.white,
    height: '7px',
    border: 'none',
    margin: '0px',
  },
}));


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/navigation/NavMenu.stories.tsx
Tamaño: 850 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { MemoryRouter } from 'react-router-dom';
import { NavMenu } from './NavMenu';
import { Activity, Bolt, Settings, Team } from '../icons';

export default {
  title: 'Menus/NavigationMenu',
  component: NavMenu,
  argTypes: {},
} as Meta<typeof NavMenu>;

const menuItems = [
  { icon: <Bolt />, link: '/0', label: 'Notifications' },
  { icon: <Activity />, link: '/1', label: 'Activity Feed' },
  { icon: <Settings />, link: '/2', label: 'Settings' },
  {
    icon: <Team />,
    link: '/3',
    label: 'Team Members',
  },
];

const Template: StoryFn<typeof NavMenu> = ({ ...args }) => (
  <MemoryRouter initialEntries={['/0']}>
    <NavMenu {...args} menuItems={menuItems} />{' '}
  </MemoryRouter>
);

export const Default = Template.bind({});
Default.args = {};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { MemoryRouter } from 'react-router-dom';
import { NavMenu } from './NavMenu';
import { Activity, Bolt, Settings, Team } from '../icons';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/navigation/NavMenu.styles.ts
Tamaño: 2100 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';

import { colors } from '../config';

export default createStyles((theme: MantineTheme) => {
  const dark = theme.colorScheme === 'dark';

  return {
    linkIcon: {
      marginLeft: '5px',
      '& *': {
        display: 'block',
      },
    },
    linkLabel: {
      fontSize: '14px',
      fontWeight: 700,
    },
    link: {
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between',
      height: '44px',
      width: '100%',
      margin: '8px 0px',
      position: 'relative',
      padding: theme.spacing.xs,
      boxSizing: 'border-box',
      color: theme.colors.gray[7],
      background: 'transparent',
      borderRadius: '7px',

      '&:hover': {
        backgroundColor: dark ? theme.colors.dark[7] : theme.white,
        color: dark ? theme.white : theme.colors.gray[8],
        boxShadow: dark ? theme.shadows.lg : theme.shadows.sm,
      },

      '&:first-of-type': {
        marginTop: '0px',
      },

      '&:last-of-type': {
        marginBottom: '0px',
      },

      '@media (min-width: 1440px)': {
        margin: '15px 0px',
        height: '50px',
      },
    },
    linkActive: {
      '&, &:hover': {
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        width: '100%',
        height: '44px',
        position: 'relative',
        padding: theme.spacing.xs,
        boxSizing: 'border-box',
        color: dark ? theme.white : theme.colors.gray[8],
        background: dark ? theme.colors.dark[7] : theme.white,
        boxShadow: dark ? theme.shadows.lg : theme.shadows.sm,
        backgroundClip: 'padding-box',
        borderRadius: '7px',

        '&:before': {
          content: '""',
          position: 'absolute',
          width: '8px',
          top: 0,
          right: 0,
          bottom: 0,
          left: 0,
          borderRadius: '7px 0px 0px 7px',
          background: colors.vertical,
        },

        '@media (min-width: 1440px)': {
          height: '50px',
        },
      },
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/navigation/NavMenu.tsx
Tamaño: 3514 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ReactNode, useState } from 'react';
import { NavLink as ReactNavLink } from 'react-router-dom';
import { Group, Transition, Popover } from '@mantine/core';
import useStyles from './NavMenu.styles';
import usePopoverStyles from './NavLinkPopover.styles';

interface INavMenuProps {
  menuItems: IMenuItem[];
}

interface IMenuItem {
  icon: ReactNode;
  label: string;
  link: string;
  testId?: string;
  rightSide?: ReactNode | { component: ReactNode; displayOnHover: boolean };
  condition?: boolean;
  tooltipLabel?: string;
}

/**
 * @deprecated
 */
export function NavMenu({ menuItems }: INavMenuProps) {
  return (
    <div>
      {menuItems
        .filter(({ condition = true }) => condition)
        .map(({ icon, link, label, testId, rightSide, tooltipLabel }) => {
          return (
            <NavLink
              link={link}
              icon={icon}
              label={label}
              tooltipLabel={tooltipLabel}
              rightSide={rightSide}
              key={link}
              testId={testId}
            />
          );
        })}
    </div>
  );
}

const NavLink = ({ rightSide, link, testId, icon, label, tooltipLabel }: IMenuItem) => {
  const [popoverOpened, setPopoverOpened] = useState(false);
  const [isHovered, setIsHovered] = useState<boolean>(false);
  const { classes } = useStyles();

  const onHoverEnabled = (rightSide as { component: ReactNode; displayOnHover: boolean })?.displayOnHover || false;

  return (
    <ReactNavLink
      to={link}
      className={({ isActive }) => (isActive ? classes.linkActive : classes.link)}
      data-test-id={testId}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <>
        <Group spacing={10}>
          <div className={classes.linkIcon}>{icon}</div>
          <div className={classes.linkLabel}>{label}</div>
        </Group>
        {!onHoverEnabled && rightSide}

        {onHoverEnabled && (
          <RightSide
            child={rightSide}
            isHover={isHovered}
            tooltipLabel={tooltipLabel}
            popoverOpened={popoverOpened}
            setPopoverOpened={setPopoverOpened}
          />
        )}
      </>
    </ReactNavLink>
  );
};

const RightSide = ({
  child,
  isHover,
  tooltipLabel,
  popoverOpened,
  setPopoverOpened,
}: {
  child?: ReactNode | { component: ReactNode; displayOnHover: boolean };
  isHover: boolean;
  tooltipLabel: string;
  popoverOpened: boolean;
  setPopoverOpened: (value: boolean) => void;
}) => {
  const { classes } = usePopoverStyles();

  const component = (child as { component: ReactNode; displayOnHover: boolean })?.component || null;

  return (
    <Transition mounted={isHover} transition="fade" duration={400} timingFunction="ease">
      {(styles) => (
        <div onMouseEnter={() => setPopoverOpened(true)} onMouseLeave={() => setPopoverOpened(false)}>
          <Popover
            opened={popoverOpened}
            onClose={() => setPopoverOpened(false)}
            classNames={classes}
            withArrow
            withinPortal={true}
            transitionDuration={250}
            position="top"
            radius="md"
          >
            <Popover.Target>
              <div style={styles}>{component}</div>
            </Popover.Target>
            <Popover.Dropdown>
              <div style={{ maxWidth: '190px' }}>{tooltipLabel}</div>
            </Popover.Dropdown>
          </Popover>
        </div>
      )}
    </Transition>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ReactNode, useState } from 'react';
import { NavLink as ReactNavLink } from 'react-router-dom';
import { Group, Transition, Popover } from '@mantine/core';
import useStyles from './NavMenu.styles';
import usePopoverStyles from './NavLinkPopover.styles';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/notification-badge/NotificationBadge.tsx
Tamaño: 592 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { Badge } from '@mantine/core';
import { colors } from '../config';

/**
 * Gradient Badge Component
 *
 */
export function NotificationBadge({ children }: { children: React.ReactNode }) {
  return (
    <Badge
      sx={{
        padding: 0,
        width: 20,
        height: 20,
        pointerEvents: 'none',
        border: 'none',
        background: colors.horizontal,
        lineHeight: '14px',
        color: colors.white,
        fontWeight: 'bold',
        fontSize: '12px',
      }}
      radius={100}
    >
      {children}
    </Badge>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { Badge } from '@mantine/core';
import { colors } from '../config';
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/ControlBar.tsx
Tamaño: 3710 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { Box, BoxProps, useMantineTheme } from '@mantine/core';
import { forwardRef, PropsWithChildren, useContext, useEffect, useState } from 'react';
import { ChevronLeft, ChevronRight } from '../icons';
import { ControlButton } from './ControlButton';
import { DEFAULT_ELLIPSIS_NODE, DEFAULT_SIBLING_COUNT, MAX_SIBLING_COUNT, MIN_SIBLING_COUNT } from './Pagination.const';
import { PaginationContext } from './PaginationContext';
import { getPaginationSymbols, PaginationSymbol } from './util';
import { clamp } from '../utils';
import { IconControlButton } from './IconControlButton';

const Group = styled(Box)<BoxProps & React.RefAttributes<HTMLDivElement>>(
  ({ theme }) => `
  display: flex;
  flex-direction: row;
  align-items: center;
  /* TODO: use theme value */
  gap: 0.25rem;
`
);

export interface IControlBarProps {
  /** the quantity of items to show on each side of the "current page" */
  siblingCount?: number;
  /** the node to render when showing a gap between two disparate page numbers. Defaults to "..." */
  ellipsisNode?: JSX.Element;
  className?: string;
}

/**
 * Primary pagination navigation component.
 *
 * `children` is optional, and if included, will override the default behavior.
 * If using your own children, use `Pagination.ControlButton` to hook into the PaginationContext.
 * @requires this component to be a child of a Pagination component
 */
export const ControlBar = forwardRef<HTMLDivElement, PropsWithChildren<IControlBarProps>>(
  ({ className, siblingCount = DEFAULT_SIBLING_COUNT, ellipsisNode = DEFAULT_ELLIPSIS_NODE, children }, ref) => {
    const { currentPageNumber, totalPageCount } = useContext(PaginationContext);
    const [clampedSiblingCount, setClampedSiblingCount] = useState<number>(siblingCount);

    useEffect(() => {
      // ensure the sibling count is within the allowed range
      if (siblingCount < MIN_SIBLING_COUNT || siblingCount > MAX_SIBLING_COUNT) {
        setClampedSiblingCount(clamp(siblingCount, MIN_SIBLING_COUNT, MAX_SIBLING_COUNT));
      }
    }, [siblingCount, setClampedSiblingCount]);

    const renderCentralButton = (curPageSymbol: PaginationSymbol, index: number) => {
      if (curPageSymbol === 'ELLIPSIS') {
        return (
          <ControlButton key={`pagination-ellipsis-btn-${index}`} disabled>
            {ellipsisNode}
          </ControlButton>
        );
      }

      return (
        <ControlButton
          key={`pagination-page-number-btn-${curPageSymbol}-${index}`}
          onClick={({ onPageChange }) => {
            onPageChange(curPageSymbol);
          }}
          isCurrentPage={curPageSymbol === currentPageNumber}
        >
          {curPageSymbol}
        </ControlButton>
      );
    };

    return (
      <Group ref={ref} className={className} theme={useMantineTheme()}>
        {children || (
          <>
            <IconControlButton
              onClick={({ onPageChange, currentPageNumber: curPageNum }) => {
                onPageChange(curPageNum - 1);
              }}
              disabled={currentPageNumber === 1}
            >
              <ChevronLeft />
            </IconControlButton>
            {getPaginationSymbols({ totalPageCount, currentPageNumber, siblingCount: clampedSiblingCount }).map(
              renderCentralButton
            )}
            <IconControlButton
              onClick={({ onPageChange, currentPageNumber: curPageNum }) => {
                onPageChange(curPageNum + 1);
              }}
              disabled={currentPageNumber === totalPageCount}
            >
              {<ChevronRight />}
            </IconControlButton>
          </>
        )}
      </Group>
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { Box, BoxProps, useMantineTheme } from '@mantine/core';
import { forwardRef, PropsWithChildren, useContext, useEffect, useState } from 'react';
import { ChevronLeft, ChevronRight } from '../icons';
import { ControlButton } from './ControlButton';
/* TODO: use theme value */
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/ControlButton.tsx
Tamaño: 3171 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { CSSProperties, forwardRef, useContext } from 'react';
import { Button, IButtonProps } from '../button/Button';
import { colors } from '../config';
import { IPaginationContext, PaginationContext } from './PaginationContext';

export type TPageButtonClickHandler = (ctx: IPaginationContext) => void;

type StylingProps = Pick<IControlButtonProps, 'isCurrentPage'>;

// TODO: Fix `theme` type once design system is ready and then use theme values
const getFontColor = ({ theme, isCurrentPage }: { theme: any } & StylingProps): string => {
  return theme.colorScheme === 'dark'
    ? isCurrentPage
      ? colors.white
      : colors.B60
    : isCurrentPage
      ? colors.BGDark // TODO: speak with Design -- this is bad, we should not be using a "BG" color for font
      : colors.B60;
};

// TODO: Fix `theme` type once design system is ready and then use theme values
const getFontWeight = ({ theme, isCurrentPage }: { theme: any } & StylingProps): CSSProperties['fontWeight'] => {
  return isCurrentPage ? 700 : 600;
};

// TODO: Fix `theme` type once design system is ready and then use theme values
const getBackgroundColor = ({ theme, isCurrentPage }: { theme: any } & StylingProps): CSSProperties['fontWeight'] => {
  return isCurrentPage ? (theme.colorScheme === 'dark' ? colors.B30 : colors.BGLight) : 'none';
};

const StyledButton = styled(Button, {
  shouldForwardProp: (propName: string) => {
    return propName !== 'isCurrentPage';
  },
})<StylingProps>(
  ({ theme, isCurrentPage }) => `
  font-weight: ${getFontWeight({ theme, isCurrentPage })};
  background: ${getBackgroundColor({ theme, isCurrentPage })};
  color: ${getFontColor({ theme, isCurrentPage })};

  & .mantine-Button-label {
    background-image: none;
  }

  &:disabled {
    background: ${getBackgroundColor({ theme, isCurrentPage })};
    color: ${getFontColor({ theme, isCurrentPage })};
  }
  
  /* override mantine */
  height: inherit;
  
  /* TODO: theme values for next few lines */
  border-radius: 4px;
  line-height: 20px;
  padding: 2px 3.5px;
  min-width: 24px;
`
);

export interface IControlButtonProps extends Omit<IButtonProps, 'onClick'> {
  onClick?: TPageButtonClickHandler;
  /** Does the button represent the currently-selected page */
  isCurrentPage?: boolean;
}

/**
 * Button for navigating to a specific page.
 * @requires this component to be a child of a Pagination component
 */
export const ControlButton: React.FC<IControlButtonProps> = forwardRef<HTMLButtonElement, IControlButtonProps>(
  ({ onClick, className, id, disabled, isCurrentPage, ...buttonProps }, buttonRef) => {
    const paginationCtx = useContext(PaginationContext);

    // hydrate the click handler with the context
    const handleClick = () => onClick?.(paginationCtx);

    return (
      <StyledButton
        theme={useMantineTheme()}
        isCurrentPage={isCurrentPage}
        id={id}
        onClick={handleClick}
        disabled={disabled || !onClick}
        ref={buttonRef}
        className={className}
      >
        {buttonProps.children}
      </StyledButton>
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { CSSProperties, forwardRef, useContext } from 'react';
import { Button, IButtonProps } from '../button/Button';
import { colors } from '../config';
// TODO: Fix `theme` type once design system is ready and then use theme values
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/GoToPageInput.tsx
Tamaño: 4091 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import {
  FocusEventHandler,
  forwardRef,
  KeyboardEventHandler,
  useContext,
  useImperativeHandle,
  useRef,
  useState,
} from 'react';
import styled from '@emotion/styled';
import { Input, NumberInput, NumberInputProps, useMantineTheme } from '@mantine/core';
import { PaginationContext } from './PaginationContext';
import { Tooltip } from '../tooltip/Tooltip';
import { FIRST_PAGE_NUMBER } from './Pagination.const';
import { colors } from '../config';

export interface IGoToPageInputProps extends NumberInputProps {
  firstPageNumber?: number;
}

const InputWrapper = styled(Input.Wrapper)(({ theme }) => {
  return `
  display: flex;
  flex-direction: row;
  align-items: center;

      
  /**
   * TODO: use theme values for color styles below.
   * Should be enforced for all child elements as these are in the design system.
   */
  color: ${theme.colorScheme === 'dark' ? colors.B60 : colors.B40};

  input {
    background-color: transparent;
    border-color: ${theme.colorScheme === 'dark' ? colors.B30 : colors.B80};
    margin: 0;
    min-height: inherit;
    height: 32px;
    text-align: center;
    min-width: 56px;
    max-width: 60px;

    &:focus, &:focus-within {
      border-color: ${theme.colorScheme === 'dark' ? colors.B60 : colors.B60};
    }
  }

  label {
    color: inherit;
    font-size: inherit;
    line-height: inherit;
    text-wrap: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    /* TODO: use theme values */
    margin-right: ${'0.5rem'};
  }
`;
});

/**
 * Input for navigating to the specified page size for Pagination.
 * @requires this component to be a child of a Pagination component
 */
export const GoToPageInput: React.FC<IGoToPageInputProps> = forwardRef<HTMLInputElement, IGoToPageInputProps>(
  ({ label, firstPageNumber = FIRST_PAGE_NUMBER, ...inputProps }, forwardedRef) => {
    const { onPageChange, totalPageCount } = useContext(PaginationContext);
    const [hasError, setHasError] = useState<boolean>(false);
    const [goToValue, setGoToValue] = useState<number | undefined>(undefined);

    const validateValue = (val: number | string) => {
      const numVal = +val;

      return !!numVal && numVal >= 1 && numVal <= totalPageCount;
    };

    /*
     * since we are forwarding the ref, we must use useImperativeHandle to be able to
     * invoke behavior on the input element
     */
    const internalRef = useRef<HTMLInputElement>(null);
    useImperativeHandle(forwardedRef, () => internalRef.current, []);

    const handleBlurEvent: FocusEventHandler<HTMLInputElement> = (event) => {
      const val = event.currentTarget.value;

      // check for empty value and ensure user can clear error
      if (!val) {
        setHasError(false);

        return;
      }

      if (!validateValue(val)) {
        setHasError(val !== undefined);

        return;
      }
      onPageChange(+val);
      setGoToValue(undefined);
      setHasError(false);
    };

    const handleKeyPress: KeyboardEventHandler<HTMLInputElement> = (event) => {
      if (event.key !== 'Enter') {
        return;
      }
      internalRef.current.blur();
    };

    return (
      <InputWrapper label={label} id="goToPage" theme={useMantineTheme()}>
        <Tooltip
          opened={hasError}
          data-test-id="conditions-form-tooltip-error"
          error
          position="top-end"
          label={`Value must be between ${firstPageNumber} and ${totalPageCount}`}
        >
          <NumberInput
            onKeyDown={handleKeyPress}
            value={goToValue}
            onChange={setGoToValue}
            id={'goToPage'}
            ref={internalRef}
            onBlur={handleBlurEvent}
            min={firstPageNumber}
            max={totalPageCount}
            maxLength={`${totalPageCount}`.length}
            hideControls
            noClampOnBlur
            autoCorrect={'none'}
            aria-autocomplete={'none'}
            autoComplete={'none'}
            disabled={totalPageCount === 1}
            {...inputProps}
          />
        </Tooltip>
      </InputWrapper>
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import {
FocusEventHandler,
forwardRef,
KeyboardEventHandler,
useContext,
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/IconControlButton.tsx
Tamaño: 1421 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { ControlButton, IControlButtonProps } from './ControlButton';
import { colors } from '../config';

// TODO: Fix `theme` type once design system is ready and then use theme values
const getFontColor = ({ theme }: { theme: any }): string => {
  // TODO: speak with Design -- this is bad, we should not be using a "BG" color for font
  return theme.colorScheme === 'dark' ? colors.white : colors.BGDark;
};

// TODO: Fix `theme` type once design system is ready and then use theme values
const getDisabledFontColor = ({ theme }: { theme: any }): string => {
  return theme.colorScheme === 'dark' ? colors.B40 : colors.B80;
};

export type IconControlButtonProps = Omit<IControlButtonProps, 'isCurrentPage'>;

const _IconControlButton = styled(ControlButton)<IconControlButtonProps>(
  ({ theme }) => `
  color: ${getFontColor({ theme })};
  /* SVG / icon overrides */
  path {
    fill: ${getFontColor({ theme })};
  }
  
  &:disabled {
    color: ${getDisabledFontColor({ theme })};
    /* SVG / icon overrides */
    path {
      fill: ${getDisabledFontColor({ theme })};
    }
  }
  `
);

/**
 * Specialized ControlButton for "rich" nodes such as Icons or custom JSX elements.
 */
export const IconControlButton: React.FC<IconControlButtonProps> = (props) => (
  <_IconControlButton theme={useMantineTheme()} {...props} />
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { useMantineTheme } from '@mantine/core';
import { ControlButton, IControlButtonProps } from './ControlButton';
import { colors } from '../config';
// TODO: Fix `theme` type once design system is ready and then use theme values
// TODO: speak with Design -- this is bad, we should not be using a "BG" color for font
// TODO: Fix `theme` type once design system is ready and then use theme values
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/PageSizeSelect.tsx
Tamaño: 3287 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { Input, useMantineTheme } from '@mantine/core';
import { forwardRef, useContext, useMemo } from 'react';
import { ISelectProps } from '../select/Select.types';
import { Select } from '../select/Select';
import { DEFAULT_PAGINATION_PAGE_SIZES } from './Pagination.const';
import { PaginationContext } from './PaginationContext';
import { getPageNumberForNewPageSize } from './util';
import { colors } from '../config';

const InputWrapper = styled(Input.Wrapper)(({ theme }) => {
  return `
    display: flex;
    flex-direction: row;
    align-items: center;
    
    & label {
      color: inherit;
      font-size: inherit;
      line-height: inherit;
      text-wrap: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;

      /* TODO: use theme values */
      margin-left: ${'0.5rem'};
    }
    
    /**
     * TODO: use theme values for all styles below.
     * Should be enforced for all child elements as these are in the design system.
     */
    color: ${theme.colorScheme === 'dark' ? colors.B60 : colors.B40};

    & input {
      border-color: ${theme.colorScheme === 'dark' ? colors.B30 : colors.B80};
      background-color: transparent;
    }
`;
});

const StyledSelect = styled(Select)(
  () => `
    max-width: 71px;
    input {
      padding-left: 12px;
      padding-right: 8px;
      margin: 0;
      min-height: inherit;
      /** Explicitly set by designs */
      height: 32px;
      min-width: 44px;
    }

    input:not([type=hidden]) + div {
      /* TODO: use theme values */
      width: 20px;
    }
`
);

export type TPageSizeSelectOption = string;
export interface IPageSizeSelectProps extends Omit<ISelectProps, 'onChange' | 'data'> {
  onPageSizeChange: (pageSize: number) => void;
  pageSizes?: (number | TPageSizeSelectOption)[];
  className?: string;
}

/**
 * Component for selecting the desired page size for Pagination.
 * @requires this component to be a child of a Pagination component
 */
export const PageSizeSelect: React.FC<IPageSizeSelectProps> = forwardRef<HTMLInputElement, IPageSizeSelectProps>(
  ({ onPageSizeChange, pageSizes = DEFAULT_PAGINATION_PAGE_SIZES, ...selectProps }, selectRef) => {
    const { pageSize, totalItemCount, currentPageNumber, onPageChange } = useContext(PaginationContext);

    /** handles clamping of page sizes to avoid poor UX and impossible states */
    const handlePageSizeChange = (val: string | string[]) => {
      const newPageSize = typeof val === 'string' ? +val : +val[0];

      const updatedPageNum = getPageNumberForNewPageSize({
        newPageSize,
        prevPageSize: pageSize,
        currentPageNumber,
        totalItemCount,
      });

      onPageChange(updatedPageNum, true);
      onPageSizeChange(newPageSize);
    };

    const options = useMemo(() => pageSizes.map((val) => `${val}`), [pageSizes]);

    return (
      <InputWrapper
        label={'rows per page'}
        id="pageSizeSelect"
        inputWrapperOrder={['input', 'label']}
        theme={useMantineTheme()}
      >
        <StyledSelect
          ref={selectRef}
          data={options}
          onChange={handlePageSizeChange}
          value={`${pageSize}`}
          className={selectProps.className}
        />
      </InputWrapper>
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { Input, useMantineTheme } from '@mantine/core';
import { forwardRef, useContext, useMemo } from 'react';
import { ISelectProps } from '../select/Select.types';
import { Select } from '../select/Select';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/Pagination.const.ts
Tamaño: 773 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

/** Default page size options for pagination  */
export const DEFAULT_PAGINATION_PAGE_SIZES = [10, 25, 50, 100];
export const DEFAULT_PAGE_SIZE = 10;

export const FIRST_PAGE_NUMBER = 1;
/** based on designs -- the maximum value for which all page numbers should be shown simultaneously */
export const MAX_PAGE_COUNT_WITHOUT_ELLIPSIS = 10;

/**
 * default number of "siblings" on pagination. A "sibling" is a page number on each side of the current page number
 * E.g. pagination with 2 siblings for a current page of 14 would look like the below -- note there are 2 values to each side:
 *
 * 12 13 [14] 15 16
 */
export const DEFAULT_SIBLING_COUNT = 2;
export const MIN_SIBLING_COUNT = 1;
export const MAX_SIBLING_COUNT = 5;

export const DEFAULT_ELLIPSIS_NODE = '...';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/Pagination.stories.tsx
Tamaño: 1378 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { useArgs } from '@storybook/client-api';
import { Pagination, IPaginationProps } from './Pagination';

export default {
  title: 'Components/Pagination',
  component: Pagination,
  args: {
    currentPageNumber: 6,
    totalPageCount: 11,
    totalItemCount: 100,
    onPageChange: (pageNum) => alert(pageNum),
    pageSize: 10,
    siblingCount: 2,
    ellipsisNode: '...',
  },
} as Meta<typeof Pagination>;

const TEST_PAGE_SIZES = [10, 25, 50, 100];

// @ts-ignore-next-line
const Template: StoryFn<typeof Pagination> = ({ siblingCount, ellipsisNode, ...args }) => {
  const [{ currentPageNumber }, updateArgs] = useArgs<IPaginationProps>();

  const handlePageSizeChange = (size: number) => {
    updateArgs({ pageSize: size });
  };

  const handlePageChange = (pageNum: number) => {
    updateArgs({ currentPageNumber: pageNum });
  };

  return (
    <Pagination {...args} onPageChange={handlePageChange} currentPageNumber={currentPageNumber}>
      <Pagination.PageSizeSelect onPageSizeChange={handlePageSizeChange} pageSizes={TEST_PAGE_SIZES} />
      <Pagination.ControlBar siblingCount={siblingCount} ellipsisNode={ellipsisNode} />
      <Pagination.GoToPageInput label={'Go to'} placeholder={'page'} />
    </Pagination>
  );
};

export const PaginationStory = Template.bind({});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { useArgs } from '@storybook/client-api';
import { Pagination, IPaginationProps } from './Pagination';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/Pagination.tsx
Tamaño: 3206 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import styled from '@emotion/styled';
import { PropsWithChildren } from 'react';
import { clamp } from '../utils';
import { colors } from '../config';
import { mantineConfig } from '../config/theme.config';
import { ControlBar } from './ControlBar';
import { ControlButton } from './ControlButton';
import { GoToPageInput } from './GoToPageInput';
import { PageSizeSelect } from './PageSizeSelect';
import { FIRST_PAGE_NUMBER } from './Pagination.const';
import { IPaginationContext, PaginationContext } from './PaginationContext';
import { clampPageNumber } from './util';
import { IconControlButton } from './IconControlButton';

const PaginationWrapper = styled.div(
  ({ theme }) => `
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    
    /**
     * TODO: use theme values for all styles below.
     * Should be enforced for all child elements as these are in the design system.
     */
    color: ${theme.colorScheme === 'dark' ? colors.B60 : colors.B40};
    font-size: ${mantineConfig.fontSizes.md}px;
    line-height: 20px;

    & input {
      background-color: ${theme.colorScheme === 'dark' ? colors.B15 : colors.white};
      border-radius: 7px;
      font-size: 14px;
    } 
`
);
export interface IPaginationProps extends IPaginationContext {
  /** Ignore validations which clamp the current page number between 1 and totalPageCount */
  shouldSkipValidation?: boolean;
  className?: string;
}

/**
 * Primary Pagination component.
 *
 * Use the namespaced components (like Pagination.ControlBar) as children to compose your controls.
 *
 * <Pagination ...>
 *  <Pagination.ControlBar />
 * </Pagination>
 */
export const Pagination = ({
  currentPageNumber,
  totalPageCount,
  totalItemCount,
  onPageChange,
  pageSize,
  className,
  shouldSkipValidation,
  children,
}: PropsWithChildren<IPaginationProps>) => {
  const handlePageChangeWithValidation = (pageNum: number, shouldSkipPageChangeValidation?: boolean) => {
    const val =
      shouldSkipValidation || shouldSkipPageChangeValidation
        ? pageNum
        : clampPageNumber(pageNum, { totalPageCount, currentPageNumber });
    onPageChange(val, shouldSkipPageChangeValidation);
  };

  const totalPageCountToUse = shouldSkipValidation
    ? totalPageCount
    : clamp(totalPageCount, FIRST_PAGE_NUMBER, Number.MAX_SAFE_INTEGER);

  const curPageNumToUse = shouldSkipValidation
    ? currentPageNumber
    : clampPageNumber(currentPageNumber, {
        totalPageCount: totalPageCountToUse,
        currentPageNumber,
      });

  return (
    <PaginationContext.Provider
      value={{
        currentPageNumber: curPageNumToUse,
        totalItemCount,
        onPageChange: handlePageChangeWithValidation,
        totalPageCount: totalPageCountToUse,
        pageSize,
      }}
    >
      <PaginationWrapper className={className}>{children}</PaginationWrapper>
    </PaginationContext.Provider>
  );
};

Pagination.Context = PaginationContext;
Pagination.ControlButton = ControlButton;
Pagination.IconControlButton = IconControlButton;
Pagination.ControlBar = ControlBar;
Pagination.GoToPageInput = GoToPageInput;
Pagination.PageSizeSelect = PageSizeSelect;

export default Pagination;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import styled from '@emotion/styled';
import { PropsWithChildren } from 'react';
import { clamp } from '../utils';
import { colors } from '../config';
import { mantineConfig } from '../config/theme.config';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/PaginationContext.tsx
Tamaño: 578 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { createContext } from 'react';

export interface IPaginationContext {
  totalItemCount: number;
  totalPageCount: number;
  /** Note: this is a page *number*, not index */
  currentPageNumber: number;
  pageSize: number;
  onPageChange: (pageNumber: number, shouldSkipPageValidation?: boolean) => void;
}

const DEFAULT_PAGINATION_CONTEXT: IPaginationContext = {
  totalItemCount: 0,
  totalPageCount: 1,
  currentPageNumber: 1,
  pageSize: 10,
  onPageChange: () => {},
};
export const PaginationContext = createContext<IPaginationContext>(DEFAULT_PAGINATION_CONTEXT);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { createContext } from 'react';
export interface IPaginationContext {
totalItemCount: number;
totalPageCount: number;
/** Note: this is a page *number*, not index */
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/index.ts
Tamaño: 79 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './Pagination';
export * from './usePaginationQueryParamsState';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/usePaginationQueryParamsState.spec.tsx
Tamaño: 4905 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { act, waitFor } from '@testing-library/react';
import { renderHook } from '@testing-library/react-hooks';
import { MemoryRouter, useSearchParams } from 'react-router-dom';
import * as ReactRouterDOM from 'react-router-dom';
import { afterEach, expect, it, vi } from 'vitest';

import { PropsWithChildren } from 'react';
import { IUsePaginationQueryParamsStateOptions, usePaginationQueryParamsState } from './usePaginationQueryParamsState';

const initialPageNumber = 1;
const pageSizes = [10, 20, 30];
const defaultPageNumberQueryParamName = 'page';
const defaultPageSizeQueryParamName = 'size';

const callHook = (options: IUsePaginationQueryParamsStateOptions, initialParams?: { page: number; size: number }) => {
  const paramStr = initialParams ? `?page=${initialParams.page}&size=${initialParams.size}` : '';

  return renderHook(() => usePaginationQueryParamsState(options), {
    wrapper: ({ children }: PropsWithChildren<{}>) => (
      <MemoryRouter initialEntries={[paramStr]}>{children}</MemoryRouter>
    ),
  });
};

const setSearchParams = vi.fn();

const mockUseSearchParams = (): ReturnType<typeof useSearchParams> => {
  const params = new URLSearchParams();

  return [params, setSearchParams];
};

vi.spyOn(ReactRouterDOM, 'useSearchParams').mockImplementation(mockUseSearchParams);

afterEach(() => {
  vi.clearAllMocks();
});

it('usePaginationQueryParamsState uses defaults', async () => {
  const page = initialPageNumber;
  const size = pageSizes[0];
  const options: IUsePaginationQueryParamsStateOptions = {
    defaultPageNumberQueryParamName,
    defaultPageSizeQueryParamName,
  };

  // Render hook
  const { result } = callHook(options);

  await waitFor(() => {
    // Verify that state is updated based on URL parameters on mount
    expect(result.current.currentPageNumberQueryParam).toBe(page);
    expect(result.current.pageSizeQueryParam).toBe(size);
  });

  const newSearchParams = new URLSearchParams({
    [defaultPageNumberQueryParamName]: `${page}`,
    [defaultPageSizeQueryParamName]: `${size}`,
  });
  expect(setSearchParams).toHaveBeenCalledWith(newSearchParams, { replace: true });
});

it('usePaginationQueryParamsState updates state based on URL parameters on mount', async () => {
  const page = 2;
  const size = 20;
  const mockUseSearchParamsNew = (): ReturnType<typeof useSearchParams> => {
    const params = new URLSearchParams();
    params.set('page', `${page}`);
    params.set('size', `${size}`);

    return [params, setSearchParams];
  };

  vi.spyOn(ReactRouterDOM, 'useSearchParams').mockImplementationOnce(mockUseSearchParamsNew);

  const options: IUsePaginationQueryParamsStateOptions = {
    initialPageNumber,
    pageSizes,
    defaultPageNumberQueryParamName,
    defaultPageSizeQueryParamName,
  };

  // Render hook
  const { result } = callHook(options, { page, size });

  // Verify that state is updated based on URL parameters on mount
  expect(result.current.currentPageNumberQueryParam).toBe(page);
  expect(result.current.pageSizeQueryParam).toBe(size);

  const newSearchParams = new URLSearchParams({
    [defaultPageNumberQueryParamName]: `${page}`,
    [defaultPageSizeQueryParamName]: `${size}`,
  });
  expect(setSearchParams).toHaveBeenCalledWith(newSearchParams, { replace: true });
});

it('usePaginationQueryParamsState updates URL parameters on state change', async () => {
  const page = 3;
  const size = 30;
  const options: IUsePaginationQueryParamsStateOptions = {
    initialPageNumber,
    pageSizes,
    defaultPageNumberQueryParamName,
    defaultPageSizeQueryParamName,
  };

  // Render hook
  const { result } = callHook(options);

  // Update state to trigger URL parameter update
  act(() => {
    result.current.setPageSizeQueryParam(size);
    result.current.setCurrentPageNumberQueryParam(page);
  });

  // Verify that URL parameters are updated on state change
  expect(result.current.pageSizeQueryParam).toBe(size);
  expect(result.current.currentPageNumberQueryParam).toBe(page);

  const newSearchParams = new URLSearchParams({
    [defaultPageNumberQueryParamName]: `${page}`,
    [defaultPageSizeQueryParamName]: `${size}`,
  });
  expect(setSearchParams).toHaveBeenCalledWith(newSearchParams, { replace: true });
});

it('usePaginationQueryParamsState does not update URL parameters when areSearchParamsEnabled is false', async () => {
  const options: IUsePaginationQueryParamsStateOptions = {
    areSearchParamsEnabled: false,
    initialPageNumber,
    pageSizes,
    defaultPageNumberQueryParamName,
    defaultPageSizeQueryParamName,
  };

  // Render hook
  const { result } = callHook(options);

  await waitFor(() => {
    // Verify that state is updated based on URL parameters on mount
    expect(result.current.currentPageNumberQueryParam).toBe(1);
    expect(result.current.pageSizeQueryParam).toBe(10);
    expect(setSearchParams).not.toHaveBeenCalled();
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { act, waitFor } from '@testing-library/react';
import { renderHook } from '@testing-library/react-hooks';
import { MemoryRouter, useSearchParams } from 'react-router-dom';
import * as ReactRouterDOM from 'react-router-dom';
import { afterEach, expect, it, vi } from 'vitest';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/usePaginationQueryParamsState.ts
Tamaño: 2767 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useEffect, useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import { DEFAULT_PAGE_SIZE, DEFAULT_PAGINATION_PAGE_SIZES, FIRST_PAGE_NUMBER } from './Pagination.const';

const URL_PAGE_SIZE_QUERY_PARAM_NAME = 'size';
const URL_PAGE_NUMBER_QUERY_PARAM_NAME = 'page';

export interface IUsePaginationQueryParamsStateOptions {
  areSearchParamsEnabled?: boolean;
  initialPageNumber?: number;
  initialPageSize?: number;
  pageSizes?: number[];
  defaultPageSizeQueryParamName?: string;
  defaultPageNumberQueryParamName?: string;
}

export const usePaginationQueryParamsState = ({
  areSearchParamsEnabled = true,
  initialPageNumber = FIRST_PAGE_NUMBER,
  initialPageSize = DEFAULT_PAGE_SIZE,
  pageSizes = DEFAULT_PAGINATION_PAGE_SIZES,
  defaultPageNumberQueryParamName = URL_PAGE_NUMBER_QUERY_PARAM_NAME,
  defaultPageSizeQueryParamName = URL_PAGE_SIZE_QUERY_PARAM_NAME,
}: IUsePaginationQueryParamsStateOptions) => {
  const [searchParams, setSearchParams] = useSearchParams();
  const [pageSizeQueryParam, setPageSizeQueryParam] = useState<number>(
    getValidatedPageSizeFromUrl(searchParams.get(defaultPageSizeQueryParamName), initialPageSize, pageSizes)
  );
  const [currentPageNumberQueryParam, setCurrentPageNumberQueryParam] = useState<number>(
    getValidatedPageNumberFromUrl(searchParams.get(defaultPageNumberQueryParamName), initialPageNumber)
  );

  useEffect(() => {
    if (!areSearchParamsEnabled) {
      return;
    }

    // make sure that the other query params are not overridden
    const newSearchParams = new URLSearchParams(document.location.search);
    newSearchParams.set(defaultPageNumberQueryParamName, `${currentPageNumberQueryParam}`);
    newSearchParams.set(defaultPageSizeQueryParamName, `${pageSizeQueryParam}`);

    setSearchParams(newSearchParams, { replace: true });
  }, [
    pageSizeQueryParam,
    currentPageNumberQueryParam,
    setSearchParams,
    defaultPageNumberQueryParamName,
    defaultPageSizeQueryParamName,
  ]);

  return {
    pageSizeQueryParam,
    currentPageNumberQueryParam,
    setPageSizeQueryParam,
    setCurrentPageNumberQueryParam,
  };
};

function getValidatedPageNumberFromUrl(pageNumberStr: string | undefined, initialPageNumber: number): number {
  const pageNumberUnchecked = parseInt(pageNumberStr ?? 'NaN', 10);

  return pageNumberUnchecked && pageNumberUnchecked > 0 ? pageNumberUnchecked : initialPageNumber;
}

function getValidatedPageSizeFromUrl(
  pageSizeStr: string | undefined,
  initialPageSize: number,
  pageSizes: number[]
): number {
  const sizeValUnchecked = parseInt(pageSizeStr ?? 'NaN', 10);

  return pageSizes.includes(sizeValUnchecked) && sizeValUnchecked > 0
    ? sizeValUnchecked
    : (initialPageSize ?? pageSizes[0]);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - getValidatedPageNumberFromUrl(pageNumberStr: string | undefined, initialPageNumber: number)
 - getValidatedPageSizeFromUrl(pageSizeStr: string | undefined,
  initialPageSize: number,
  pageSizes: number[])
Asignaciones con arrow functions encontradas (posibles funciones):
 - defaultPageSizeQueryParamName(URL_PAGE_SIZE_QUERY_PARAM_NAME,
}: IUsePaginationQueryParamsStateOptions))
Declaraciones 'export' encontradas:
- export  interface
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/clampPageNumber.spec.ts
Tamaño: 1514 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, describe, it } from 'vitest';
import { clampPageNumber } from './clampPageNumber';

const FIRST_PAGE_NUMBER = 1;

describe('clampPageNumber', () => {
  it('should clamp page number to the first page if it is less than the first page number', () => {
    const result = clampPageNumber(0, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(FIRST_PAGE_NUMBER);
  });

  it('should clamp page number to the total page count if it is greater than the total page count', () => {
    const result = clampPageNumber(15, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(10);
  });

  it('should return the new page number if it is within the safe bounds', () => {
    const result = clampPageNumber(3, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(3);
  });

  it('should return the current page number if the new page number is not an integer', () => {
    const result = clampPageNumber(3.5, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(5);
  });

  it('should return the first page number if total page count is zero', () => {
    const result = clampPageNumber(3, { totalPageCount: 0, currentPageNumber: 5 });
    expect(result).to.equal(FIRST_PAGE_NUMBER);
  });

  it('should return the first page number if total page count is negative', () => {
    const result = clampPageNumber(3, { totalPageCount: -5, currentPageNumber: 5 });
    expect(result).to.equal(FIRST_PAGE_NUMBER);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - FIRST_PAGE_NUMBER(1;

describe('clampPageNumber', ())
 - result(clampPageNumber(0, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(FIRST_...)
 - result(clampPageNumber(15, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(10);
...)
 - result(clampPageNumber(3, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(3);
  ...)
 - result(clampPageNumber(3.5, { totalPageCount: 10, currentPageNumber: 5 });
    expect(result).to.equal(5);
...)
 - result(clampPageNumber(3, { totalPageCount: 0, currentPageNumber: 5 });
    expect(result).to.equal(FIRST_P...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/clampPageNumber.ts
Tamaño: 714 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { clamp } from '../../utils';
import { FIRST_PAGE_NUMBER } from '../Pagination.const';
import { IPaginationContext } from '../PaginationContext';

/**
 * Ensure that the page number is within the safe bounds of the total page count.
 */
export const clampPageNumber = (
  newPageNum: number,
  { totalPageCount, currentPageNumber }: Pick<IPaginationContext, 'totalPageCount' | 'currentPageNumber'>,
  firstPageNumber: number = FIRST_PAGE_NUMBER
): number => {
  if (!Number.isInteger(newPageNum)) {
    return !Number.isInteger(currentPageNumber)
      ? firstPageNumber
      : clamp(currentPageNumber, firstPageNumber, totalPageCount);
  }

  return clamp(newPageNum, firstPageNumber, totalPageCount);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - number(FIRST_PAGE_NUMBER
): number)
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/getPageNumberForNewPageSize.spec.ts
Tamaño: 1884 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { describe, it, expect } from 'vitest';
import { getPageNumberForNewPageSize, IAdjustedPageNumParams } from './getPageNumberForNewPageSize';

describe('getPageNumberForNewPageSize', () => {
  it('computes the new page size as 1 when the currentPageNumber * prevPageSize < newPageSize', () => {
    const params: IAdjustedPageNumParams = {
      prevPageSize: 10,
      newPageSize: 50,
      totalItemCount: 80,
      currentPageNumber: 3,
    };
    const result = getPageNumberForNewPageSize(params);
    expect(result).toBe(1);
  });

  it('computes a page greater than 1 when the previous and new item ranges do not include the first item', () => {
    const params: IAdjustedPageNumParams = {
      prevPageSize: 10,
      newPageSize: 25,
      totalItemCount: 80,
      currentPageNumber: 5,
    };
    const result = getPageNumberForNewPageSize(params);
    expect(result).toBe(2);
  });

  it('returns 3 when moving from a higher to lower page size ', () => {
    const params: IAdjustedPageNumParams = {
      prevPageSize: 25,
      newPageSize: 10,
      totalItemCount: 46,
      currentPageNumber: 2,
    };
    const result = getPageNumberForNewPageSize(params);
    expect(result).toBe(3);
  });

  it('computes a higher page number when switching to a smaller page size', () => {
    const params: IAdjustedPageNumParams = {
      prevPageSize: 50,
      newPageSize: 25,
      totalItemCount: 122,
      currentPageNumber: 3,
    };
    const result = getPageNumberForNewPageSize(params);
    expect(result).toBe(5);
  });

  it('ensures the current page number is clamped for the new total page count', () => {
    const params: IAdjustedPageNumParams = {
      prevPageSize: 10,
      newPageSize: 25,
      totalItemCount: 20,
      currentPageNumber: 2,
    };
    const result = getPageNumberForNewPageSize(params);
    expect(result).toBe(1);
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - result(getPageNumberForNewPageSize(params);
    expect(result).toBe(1);
  });

  it('computes a page greate...)
 - result(getPageNumberForNewPageSize(params);
    expect(result).toBe(2);
  });

  it('returns 3 when moving ...)
 - result(getPageNumberForNewPageSize(params);
    expect(result).toBe(3);
  });

  it('computes a higher page...)
 - result(getPageNumberForNewPageSize(params);
    expect(result).toBe(5);
  });

  it('ensures the current pa...)

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/getPageNumberForNewPageSize.ts
Tamaño: 963 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { IPaginationContext } from '../PaginationContext';

export interface IAdjustedPageNumParams extends Pick<IPaginationContext, 'currentPageNumber' | 'totalItemCount'> {
  newPageSize: number;
  prevPageSize: number;
}

/**
 * Get the adjusted page number such that the beginning of the previous item viewing range is still visible.
 *
 * For example, if the user has a pageSize: 10 and currentPageNumber: 4 and changes the page size to 25,
 * this function will return 2 because page 2 will show items 26-50, and previously the user could see items 31-40,
 */
export const getPageNumberForNewPageSize = ({
  newPageSize,
  prevPageSize,
  totalItemCount,
  currentPageNumber,
}: IAdjustedPageNumParams): number => {
  const minPageNumOfCurrentRange = (currentPageNumber - 1) * prevPageSize + 1;
  const newTotalPageCount = Math.ceil(totalItemCount / newPageSize);

  return Math.min(Math.ceil(minPageNumOfCurrentRange / newPageSize), newTotalPageCount);
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getPageNumberForNewPageSize({
  newPageSize,
  prevPageSize,
  totalItemCount,
  currentPageNumber,
}: IAdjustedPageNumParams): ...)
Declaraciones 'export' encontradas:
- export  interface
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/getPaginationSymbols.spec.ts
Tamaño: 10047 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { expect, it, describe } from 'vitest';
import { MAX_PAGE_COUNT_WITHOUT_ELLIPSIS } from '../Pagination.const';
import { getPaginationSymbols, PaginationSymbol } from './getPaginationSymbols';

describe(getPaginationSymbols.name, () => {
  it('should have a single page number for 1 page', () => {
    expect(getPaginationSymbols({ totalPageCount: 1, currentPageNumber: 1, siblingCount: 2 })).toEqual([1]);
  });

  it('should have 3 page numbers for 3 pages', () => {
    expect(getPaginationSymbols({ totalPageCount: 3, currentPageNumber: 1, siblingCount: 2 })).toEqual([1, 2, 3]);
  });

  it('should show all page numbers for "max pages without ellipsis" regardless of sibling count', () => {
    expect(
      getPaginationSymbols({ totalPageCount: MAX_PAGE_COUNT_WITHOUT_ELLIPSIS, currentPageNumber: 3, siblingCount: 0 })
    ).toEqual([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
    expect(
      getPaginationSymbols({ totalPageCount: MAX_PAGE_COUNT_WITHOUT_ELLIPSIS, currentPageNumber: 3, siblingCount: 2 })
    ).toEqual([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
    expect(
      getPaginationSymbols({ totalPageCount: MAX_PAGE_COUNT_WITHOUT_ELLIPSIS, currentPageNumber: 3, siblingCount: 6 })
    ).toEqual([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
  });

  it('should show omit ellipsis and show page numbers when within the "window size" - 1 of page 1', () => {
    expect(getPaginationSymbols({ totalPageCount: 11, currentPageNumber: 5, siblingCount: 2 })).toEqual([
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      'ELLIPSIS',
      11,
    ] as PaginationSymbol[]);
  });

  it('should show show ellipsis a when at "window size" or above of page 1', () => {
    expect(getPaginationSymbols({ totalPageCount: 11, currentPageNumber: 6, siblingCount: 2 })).toEqual([
      1,
      'ELLIPSIS',
      4,
      5,
      6,
      7,
      8,
      'ELLIPSIS',
      11,
    ] as PaginationSymbol[]);
  });

  it('should show assymetric siblings for a >10 pages', () => {
    expect(getPaginationSymbols({ totalPageCount: 48, currentPageNumber: 24, siblingCount: 2 })).toEqual([
      1,
      'ELLIPSIS',
      22,
      23,
      24,
      25,
      26,
      'ELLIPSIS',
      48,
    ] as PaginationSymbol[]);
  });

  it('should show symmetric siblings for 100 <= pages < 10000', () => {
    expect(getPaginationSymbols({ totalPageCount: 500, currentPageNumber: 101, siblingCount: 2 })).toEqual([
      1,
      'ELLIPSIS',
      99,
      100,
      101,
      102,
      103,
      'ELLIPSIS',
      500,
    ] as PaginationSymbol[]);
  });

  describe('1 sibling', () => {
    const siblingCount = 1;
    const totalPageCount = 100;
    it('should work within the window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 4, siblingCount })).toEqual([
        1,
        2,
        3,
        4,
        5,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 5, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        4,
        5,
        6,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work in the middle-ish', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 20, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        19,
        20,
        21,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 96, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        95,
        96,
        97,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work within the window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 97, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        96,
        97,
        98,
        99,
        100,
      ] as PaginationSymbol[]);
    });
  });

  describe('3 siblings', () => {
    const siblingCount = 3;
    const totalPageCount = 100;
    it('should work within the window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 6, siblingCount })).toEqual([
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 7, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work in the middle-ish', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 20, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 94, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work within the window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 95, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
      ] as PaginationSymbol[]);
    });
  });

  describe('4 siblings', () => {
    const siblingCount = 4;
    const totalPageCount = 100;
    it('should work within the window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 7, siblingCount })).toEqual([
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 8, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work in the middle-ish', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 20, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 93, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work within the window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 94, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
      ] as PaginationSymbol[]);
    });
  });

  describe('5 siblings', () => {
    const siblingCount = 5;
    const totalPageCount = 100;
    it('should work within the window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 8, siblingCount })).toEqual([
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the first page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 9, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work in the middle-ish', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 20, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work near, but not in window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 92, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        'ELLIPSIS',
        100,
      ] as PaginationSymbol[]);
    });
    it('should work within the window of the last page', () => {
      expect(getPaginationSymbols({ totalPageCount, currentPageNumber: 93, siblingCount })).toEqual([
        1,
        'ELLIPSIS',
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99,
        100,
      ] as PaginationSymbol[]);
    });
  });
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - totalPageCount(100;
    it('should work within the window of the first page', ())
 - totalPageCount(100;
    it('should work within the window of the first page', ())
 - totalPageCount(100;
    it('should work within the window of the first page', ())
 - totalPageCount(100;
    it('should work within the window of the first page', ())

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/getPaginationSymbols.ts
Tamaño: 5327 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { FIRST_PAGE_NUMBER, MAX_PAGE_COUNT_WITHOUT_ELLIPSIS } from '../Pagination.const';
import { IPaginationContext } from '../PaginationContext';

/** 'ELLIPSIS' is used to indicate that there are page numbers between the adjacent values that are not being shown. */
export type PaginationSymbol = number | 'ELLIPSIS';

type TGetPaginationSymbolsParams = Pick<IPaginationContext, 'totalPageCount' | 'currentPageNumber'> & {
  siblingCount: number;
};

/**
 * Top-level function to determine what values should be used for a pagination ControlBar.
 * 'ELLIPSIS' is used to indicate that there are page numbers between the adjacent values that are not being shown.
 *
 * For example, if the totalPageCount is 11, the currentPageNumber is 6, the siblingCount is 2, this function will return:
 * [1, 'ELLIPSIS', 4, 5, 6, 7, 8, 'ELLIPSIS', 11]
 */
export const getPaginationSymbols = ({
  totalPageCount,
  siblingCount,
  currentPageNumber,
}: TGetPaginationSymbolsParams): PaginationSymbol[] => {
  // show every page if we have {MAX_PAGE_COUNT_WITHOUT_ELLIPSIS} or fewer
  if (totalPageCount <= MAX_PAGE_COUNT_WITHOUT_ELLIPSIS) {
    return createArrayForRange(totalPageCount);
  }

  // determine if the current page is close enough to either end to omit the ellipsis
  const windowRange = getWindowRange(siblingCount);
  const isInRangeOfFirstPage = checkIfCurrentPageIsNearStart({ currentPageNumber, windowRange });
  const isInRangeOfLastPage = checkIfCurrentPageIsNearEnd({
    currentPageNumber,
    windowRange,
    totalPageCount,
  });

  // determine how many values to show (not inluding first and last)
  const windowSize = getWindowSize({
    totalPageCount,
    siblingCount,
    isInRangeOfFirstPage,
    isInRangeOfLastPage,
  });

  /*
   * determine where the window should start -- this behave differently depending on if
   * the current page is in the middle or within range of either end
   */
  const windowStart = getWindowStart({
    windowSize,
    currentPageNumber,
    totalPageCount,
    isInRangeOfFirstPage,
    isInRangeOfLastPage,
  });
  const pageSymbols: PaginationSymbol[] = createArrayForRange(windowSize, windowStart);

  // add first page and ellipsis at the beginning
  if (!isInRangeOfFirstPage) {
    pageSymbols.unshift('ELLIPSIS');
  }

  // add ellipsis and last page at the end
  if (!isInRangeOfLastPage) {
    pageSymbols.push('ELLIPSIS');
  }

  // add first and last page numbers
  pageSymbols.unshift(FIRST_PAGE_NUMBER);
  pageSymbols.push(totalPageCount);

  return pageSymbols;
};

/**
 * Note: the `function` keyword is used below to leverage function hoisting for helper functions.
 */

/** Creates an array of specified length where each value is baseValue + its index */
function createArrayForRange(length: number, baseValue = 1) {
  return Array.from({ length }, (_, i) => i + baseValue);
}

/** Determines if the current page is within a range of the totalPageCount */
function checkIfCurrentPageIsNearEnd({
  currentPageNumber,
  windowRange,
  totalPageCount,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount'> & { windowRange: number }) {
  return totalPageCount - currentPageNumber < windowRange;
}

/** Determines if the current page is within a range of the first page */
function checkIfCurrentPageIsNearStart({
  currentPageNumber,
  windowRange,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount' | 'totalPageCount'> & { windowRange: number }) {
  return currentPageNumber - FIRST_PAGE_NUMBER < windowRange;
}

interface TInPaginationRangeParams {
  isInRangeOfFirstPage: boolean;
  isInRangeOfLastPage: boolean;
}

/** Determines the quantity of page numbers to show, ignoring the first and last pages (which are always shown) */
function getWindowSize({
  siblingCount,
  totalPageCount,
  isInRangeOfFirstPage,
  isInRangeOfLastPage,
}: Omit<TGetPaginationSymbolsParams, 'currentPageNumber'> & TInPaginationRangeParams) {
  if (totalPageCount <= MAX_PAGE_COUNT_WITHOUT_ELLIPSIS) {
    return totalPageCount;
  }

  // window size in the middle of the range
  const windowSize = siblingCount * 2 + 1;

  // determine if there's it's necessary to subsititute the ellipsis with an additional page number
  const numReplacementSlots = isInRangeOfFirstPage || isInRangeOfLastPage ? 1 : 0;

  return windowSize + numReplacementSlots;
}

/**
 * Gets the "distance" within which the current page number is considered to be in range of the first or last page.
 * This stems from replicating MaterialUI's implementation which has multiple layers of nuance.
 */
function getWindowRange(siblingCount: number) {
  return siblingCount * 2 + (3 - siblingCount);
}

/**
 * Determines the first page number that will be included in the viewing window, ignoring the first and last page.
 *
 * For example, if the goal is to display 3 4 5 6 7, this function will return 3.
 */
function getWindowStart({
  windowSize,
  currentPageNumber,
  totalPageCount,
  isInRangeOfFirstPage,
  isInRangeOfLastPage,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount'> & {
  windowSize: number;
} & TInPaginationRangeParams) {
  if (isInRangeOfLastPage) {
    return totalPageCount - windowSize;
  }
  if (isInRangeOfFirstPage) {
    return FIRST_PAGE_NUMBER + 1;
  }
  const windowOffset = Math.ceil(windowSize / 2) - 1;

  return Math.max(currentPageNumber - windowOffset, 1);
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Funciones 'function' encontradas:
 - createArrayForRange(length: number, baseValue = 1)
 - checkIfCurrentPageIsNearEnd({
  currentPageNumber,
  windowRange,
  totalPageCount,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount'> & { windowRange: number })
 - checkIfCurrentPageIsNearStart({
  currentPageNumber,
  windowRange,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount' | 'totalPageCount'> & { windowRange: number })
 - getWindowSize({
  siblingCount,
  totalPageCount,
  isInRangeOfFirstPage,
  isInRangeOfLastPage,
}: Omit<TGetPaginationSymbolsParams, 'currentPageNumber'> & TInPaginationRangeParams)
 - getWindowRange(siblingCount: number)
 - getWindowStart({
  windowSize,
  currentPageNumber,
  totalPageCount,
  isInRangeOfFirstPage,
  isInRangeOfLastPage,
}: Omit<TGetPaginationSymbolsParams, 'siblingCount'> & {
  windowSize: number;
} & TInPaginationRangeParams)
Asignaciones con arrow functions encontradas (posibles funciones):
 - getPaginationSymbols({
  totalPageCount,
  siblingCount,
  currentPageNumber,
}: TGetPaginationSymbolsParams): Pagination...)
 - baseValue(1) {
  return Array.from({ length }, (_, i))
Declaraciones 'export' encontradas:
- export  type
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/pagination/util/index.ts
Tamaño: 122 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './getPaginationSymbols';
export * from './clampPageNumber';
export * from './getPageNumberForNewPageSize';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/password-input/PasswordInput.tsx
Tamaño: 1268 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEvent } from 'react';
import styled from '@emotion/styled';
import { PasswordInputProps, PasswordInput as MantinePasswordInput } from '@mantine/core';
import { colors } from '../config';
import { inputStyles } from '../config/inputs.styles';
import { SpacingProps } from '../shared/spacing.props';

interface IPasswordInputProps extends SpacingProps {
  label?: React.ReactNode;
  error?: React.ReactNode;
  placeholder?: string;
  required?: boolean;
  value?: string;
  description?: string;
  onChange?: (event: ChangeEvent<HTMLInputElement>) => void;
}

/**
 * Password Input component
 *
 */
export const PasswordInput = React.forwardRef<HTMLInputElement, IPasswordInputProps>(
  ({ value, onChange, ...props }: IPasswordInputProps, ref) => {
    const defaultDesign = { radius: 'md', size: 'md', styles: inputStyles } as PasswordInputProps;

    return (
      <StyledPassword
        ref={ref}
        {...defaultDesign}
        onChange={onChange}
        autoComplete="off"
        value={value}
        {...props}
        toggleTabIndex={0}
      />
    );
  }
);

const StyledPassword = styled(MantinePasswordInput)<{ error?: any }>`
  button {
    color: ${colors.B40};
    margin-right: 10px;
  }

  input {
    height: 100%;
  }
`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEvent } from 'react';
import styled from '@emotion/styled';
import { PasswordInputProps, PasswordInput as MantinePasswordInput } from '@mantine/core';
import { colors } from '../config';
import { inputStyles } from '../config/inputs.styles';
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/popover/Popover.tsx
Tamaño: 2658 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { MouseEventHandler, ReactNode } from 'react';
import styled from '@emotion/styled';
import { Popover as MantinePopover, PopoverProps as MantinePopoverProps, useMantineTheme } from '@mantine/core';

import { colors, shadows } from '../config';
import { Label } from '../typography/label';

const DescriptionHolder = styled.div`
  max-width: 220px;
`;

type PopoverProps = {
  target: ReactNode;
  content?: ReactNode;
  title?: string;
  description?: string;
  url?: string;
  urlText?: string;
  onUrlClick?: MouseEventHandler<HTMLAnchorElement>;
  titleGradient?: 'red' | 'blue' | 'none';
  className?: string;
  opacity?: string | number;
  onDropdownMouseEnter?: MouseEventHandler<HTMLDivElement>;
  onDropdownMouseLeave?: MouseEventHandler<HTMLDivElement>;
} & Omit<MantinePopoverProps, 'children'>;

export const Popover = ({
  target,
  content,
  title,
  titleGradient = 'none',
  description,
  url,
  urlText,
  onUrlClick,
  className,
  opacity,
  onDropdownMouseEnter,
  onDropdownMouseLeave,
  ...rest
}: PopoverProps) => {
  const { colorScheme } = useMantineTheme();

  return (
    <MantinePopover
      withArrow
      position="right"
      radius="md"
      shadow={colorScheme === 'dark' ? shadows.dark : shadows.medium}
      offset={30}
      middlewares={{ flip: false, shift: false }}
      {...rest}
    >
      <MantinePopover.Target>{target}</MantinePopover.Target>
      <MantinePopover.Dropdown
        className={className}
        onMouseEnter={onDropdownMouseEnter}
        onMouseLeave={onDropdownMouseLeave}
        onClick={(e) => e.stopPropagation()}
        style={{
          minHeight: '100px',
          padding: '16px',
          backgroundColor: colorScheme === 'dark' ? colors.B17 : colors.white,
        }}
        sx={{ opacity: `${opacity || 1} !important` }}
      >
        {title && (
          <Label gradientColor={titleGradient} style={{ marginBottom: '8px' }}>
            {title}
          </Label>
        )}
        <DescriptionHolder className="popover-description-holder">
          {description && (
            <span style={{ color: colorScheme === 'dark' ? colors.white : colors.B60, lineHeight: 1.5 }}>
              {description}
            </span>
          )}
          {url && (
            <a
              href={url}
              style={{ color: '#DD2476', textDecoration: 'underline' }}
              onClick={onUrlClick}
              target="_blank"
              rel="noreferrer"
            >
              {urlText ?? 'Learn More'}
            </a>
          )}
        </DescriptionHolder>
        {content}
      </MantinePopover.Dropdown>
    </MantinePopover>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { MouseEventHandler, ReactNode } from 'react';
import styled from '@emotion/styled';
import { Popover as MantinePopover, PopoverProps as MantinePopoverProps, useMantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/popover/index.ts
Tamaño: 37 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export { Popover } from './Popover';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/radio/Radio.stories.tsx
Tamaño: 753 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Radio, RadioProps } from './Radio';

export default {
  title: 'Components/Radio',
  component: Radio,
  argTypes: {},
} as Meta<typeof Radio>;

const Template: StoryFn<typeof Radio> = ({ children, ...args }: RadioProps) => <Radio {...args}>Button</Radio>;

export const Default = Template.bind({});
Default.args = {
  value: 'test',
};

export const Disabled = ({ ...args }) => {
  return (
    <>
      <div style={{ marginBottom: 10 }}>
        <Radio disabled value="test" {...args}>
          Button
        </Radio>
      </div>

      <div>
        <Radio disabled checked value="test" {...args}>
          Button
        </Radio>
      </div>
    </>
  );
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Radio, RadioProps } from './Radio';
export default {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/radio/Radio.styles.ts
Tamaño: 1140 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors } from '../config';

export default createStyles((theme: MantineTheme, _params, getRef) => {
  const dark = theme.colorScheme === 'dark';
  const label = getRef('label');

  return {
    radio: {
      marginRight: '10px',
      color: colors.B60,
      background: 'transparent',
      border: `1px solid ${colors.B60}`,
      '&:disabled': {
        opacity: '0.85',
        '& + span': {
          opacity: '0.85',
        },
      },
      '&:disabled:not(:checked)': {
        background: 'transparent',
      },
      '&:checked:before': {
        width: '8px',
        height: '8px',
        background: 'white',
      },
      '&:checked': {
        color: dark ? 'white' : colors.B40,
        border: 'none',
        '&:disabled': {
          opacity: '0.65',
          '& + span': {
            opacity: '0.65',
          },
        },
        '& + span': {
          color: dark ? 'white' : colors.B40,
        },
      },
    },
    label: {
      ref: label,
      color: colors.B60,
      fontSize: '14px',
      paddingLeft: '10px',
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/radio/Radio.tsx
Tamaño: 807 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEvent } from 'react';
import { Radio as MantineRadio, RadioProps as MantineRadioProps } from '@mantine/core';
import useStyles from './Radio.styles';

export interface RadioProps extends MantineRadioProps {
  children?: React.ReactNode;
  value?: string;
  checked?: boolean;
  disabled?: boolean;
  onChange?: (event: ChangeEvent<HTMLInputElement>) => void;
}

/**
 * Checkbox Component
 *
 */
export function Radio({ value, onChange, disabled = false, checked, children, size = 'md', ...props }: RadioProps) {
  const { classes } = useStyles();

  return (
    <MantineRadio
      value={value}
      onChange={onChange}
      checked={checked}
      classNames={classes}
      disabled={disabled}
      size={size}
      {...props}
    >
      {children}
    </MantineRadio>
  );
}


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEvent } from 'react';
import { Radio as MantineRadio, RadioProps as MantineRadioProps } from '@mantine/core';
import useStyles from './Radio.styles';
export interface RadioProps extends MantineRadioProps {
/**
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/search-input/SearchInput.stories.tsx
Tamaño: 967 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { ChangeEventHandler } from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { useArgs } from '@storybook/client-api';

import { SearchInput, ISearchInputProps } from './SearchInput';

export default {
  title: 'Components/SearchInput',
  component: SearchInput,
  args: {
    placeholder: 'Type name or identifier...',
    value: '',
  },
} as Meta<ISearchInputProps>;

// @ts-ignore-next-line
const Template: StoryFn<typeof Pagination> = ({ siblingCount, ellipsisNode, ...args }) => {
  const [{ value }, updateArgs] = useArgs<ISearchInputProps>();

  const handleOnChange: ChangeEventHandler<HTMLInputElement> = ({ target: { value: newValue } }) => {
    updateArgs({ value: newValue });
  };

  const handleOnClearClick = () => {
    updateArgs({ value: '' });
  };

  return <SearchInput {...args} value={value} onChange={handleOnChange} onClearClick={handleOnClearClick} />;
};

export const SearchInputStory = Template.bind({});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React, { ChangeEventHandler } from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { useArgs } from '@storybook/client-api';
import { SearchInput, ISearchInputProps } from './SearchInput';
// @ts-ignore-next-line
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/search-input/SearchInput.tsx
Tamaño: 1382 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { forwardRef } from 'react';
import { Input, InputProps } from '@mantine/core';
import styled from '@emotion/styled';

import { IconClose, IconSearch } from '../iconsV2';
import { colors } from '../config';

export interface ISearchInputProps {
  placeholder?: string;
  value?: string;
  ref?: React.Ref<HTMLInputElement>;
  disabled?: boolean;
  onChange?: React.ChangeEventHandler<HTMLInputElement>;
  onClearClick?: React.MouseEventHandler<SVGElement>;
  'data-test-id'?: string;
}

const StyledInput = styled(Input)<InputProps & ISearchInputProps>`
  max-width: 15rem;

  .mantine-Input-input {
    border: none;
    background-color: transparent;
    font-size: 0.875rem;

    &::placeholder {
      color: ${colors.B40};
    }
  }

  .mantine-Input-icon:has(~ input:disabled) {
    opacity: 0.6;
  }
`;

const IconCloseStyled = styled(IconClose)`
  cursor: pointer;
`;

export const SearchInput = forwardRef<HTMLInputElement, ISearchInputProps>(
  ({ value, onClearClick, ...restSearchInputProps }, ref) => {
    return (
      <StyledInput
        {...restSearchInputProps}
        ref={ref}
        value={value}
        icon={<IconSearch title="search" />}
        rightSection={
          !!value && (
            <IconCloseStyled title="clear" onClick={onClearClick} data-test-id="search-input-clear" role="button" />
          )
        }
      />
    );
  }
);


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { forwardRef } from 'react';
import { Input, InputProps } from '@mantine/core';
import styled from '@emotion/styled';
import { IconClose, IconSearch } from '../iconsV2';
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/search-input/index.ts
Tamaño: 75 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

export * from './SearchInput';
export * from './useSearchQueryParamState';


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export
- export

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/search-input/useSearchQueryParamState.ts
Tamaño: 1760 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { useCallback, useEffect, useState } from 'react';
import { useSearchParams } from 'react-router-dom';

const URL_SEARCH_QUERY_PARAM_NAME = 'q';

const getInitialSearchQueryParamValue = (searchParam?: string, initialSearchQueryParam?: string) => {
  const search = searchParam ?? initialSearchQueryParam?.trim();

  return search ?? '';
};

export interface IUseSearchQueryParamStateOptions {
  areSearchParamsEnabled?: boolean;
  initialSearchQueryParam?: string;
  defaultSearchQueryParamName?: string;
}

export const useSearchQueryParamState = ({
  areSearchParamsEnabled = true,
  initialSearchQueryParam,
  defaultSearchQueryParamName = URL_SEARCH_QUERY_PARAM_NAME,
}: IUseSearchQueryParamStateOptions) => {
  const [searchParams, setSearchParams] = useSearchParams();
  const [searchQueryParam, setSearchQueryParam] = useState(() =>
    getInitialSearchQueryParamValue(searchParams.get(defaultSearchQueryParamName), initialSearchQueryParam)
  );

  const setSearchQueryParamCallback = useCallback(
    (newSearch: string) => setSearchQueryParam(newSearch.trimStart()),
    [setSearchQueryParam]
  );

  useEffect(() => {
    if (!areSearchParamsEnabled) {
      return;
    }

    // make sure that the other query params are not overridden
    const newSearchParams = new URLSearchParams(document.location.search);
    if (searchQueryParam) {
      newSearchParams.set(defaultSearchQueryParamName, searchQueryParam);
    } else {
      newSearchParams.delete(defaultSearchQueryParamName);
    }

    setSearchParams(newSearchParams, { replace: true });
  }, [areSearchParamsEnabled, defaultSearchQueryParamName, searchQueryParam, setSearchParams]);

  return {
    searchQueryParam,
    setSearchQueryParam: setSearchQueryParamCallback,
  };
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - getInitialSearchQueryParamValue(searchParam?: string, initialSearchQueryParam?: string))
 - defaultSearchQueryParamName(URL_SEARCH_QUERY_PARAM_NAME,
}: IUseSearchQueryParamStateOptions))
 - setSearchQueryParamCallback(useCallback(
    (newSearch: string))
Declaraciones 'export' encontradas:
- export  interface
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/segmented-control/SegmentedControl.stories.tsx
Tamaño: 669 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import { StoryFn, Meta } from '@storybook/react';
import { SegmentedControl } from './SegmentedControl';

export default {
  title: 'Components/SegmentedControl',
  component: SegmentedControl,
  argTypes: {
    onChange: {
      table: {
        disable: true,
      },
    },
    loading: {
      table: {
        disable: true,
      },
    },
  },
} as Meta<typeof SegmentedControl>;

const Template: StoryFn<typeof SegmentedControl> = ({ ...args }) => <SegmentedControl {...args} />;

export const Default = Template.bind({});
Default.args = {
  data: [
    { value: 'Development', label: 'Development' },
    { value: 'Production', label: 'Production' },
  ],
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import { StoryFn, Meta } from '@storybook/react';
import { SegmentedControl } from './SegmentedControl';
export default {
title: 'Components/SegmentedControl',
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/segmented-control/SegmentedControl.styles.ts
Tamaño: 1041 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineSize, MantineTheme } from '@mantine/core';
import { colors, shadows } from '../config';
import { getGradient } from '../config/helper';

export default createStyles<string, { size: MantineSize }>((theme: MantineTheme, _params, getRef) => {
  const dark = theme.colorScheme === 'dark';
  const label = getRef('label');

  return {
    root: {
      width: '100%',
      maxWidth: '300px',
      background: dark ? theme.colors.dark[7] : theme.white,
      padding: '5px',
      boxShadow: dark ? shadows.dark : shadows.light,
    },
    active: {
      background: `${dark ? getGradient(colors.B20) : getGradient(colors.white)} padding-box, ${
        colors.horizontal
      } border-box`,
      border: '2px solid transparent',
    },
    label: {
      ref: label,
      fontSize: '14px',
      fontWeight: 700,
      padding: `12px ${_params.size === 'md' ? '18' : '14'}px`,
      color: theme.colors.gray[8],
    },
    labelActive: {
      color: dark ? theme.white : theme.colors.gray[8],
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Declaraciones 'export' encontradas:
- export default  createStyles

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/segmented-control/SegmentedControl.tsx
Tamaño: 1711 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import {
  SegmentedControl as MantineSegmentedControl,
  SegmentedControlProps,
  SegmentedControlItem,
  LoadingOverlay,
  Sx,
} from '@mantine/core';
import styled from '@emotion/styled';
import useStyles from './SegmentedControl.styles';
import { colors } from '../config';

interface ISegmentedControlProps {
  data: string[] | SegmentedControlItem[];
  defaultValue?: string;
  value?: string;
  onChange?(value: string): void;
  loading?: boolean;
  fullWidth?: boolean;
  sx?: Sx | (Sx | undefined)[];
  disabled?: boolean;
  size?: 'md' | 'sm';
}

/**
 * SegmentedControl component
 *
 */
export const SegmentedControl = React.forwardRef<HTMLDivElement, ISegmentedControlProps>(
  ({ onChange, loading = false, ...props }, ref) => {
    const { classes, theme } = useStyles({
      size: props.size || 'md',
    });
    const defaultDesign = {
      radius: 'xl',
      size: 'md',
      transitionDuration: 500,
      transitionTimingFunction: 'linear',
      classNames: classes,
    } as SegmentedControlProps;

    return (
      <ControlWrapper style={{ position: 'relative', marginBottom: 0 }}>
        <LoadingOverlay
          visible={loading}
          overlayColor={theme.colorScheme === 'dark' ? colors.B30 : colors.B98}
          loaderProps={{
            color: colors.error,
          }}
          data-test-id={`${props['data-test-id']}-loading-overlay`}
        />
        <MantineSegmentedControl ref={ref} onChange={onChange} {...defaultDesign} {...props} />
      </ControlWrapper>
    );
  }
);

const ControlWrapper = styled.div`
  position: relative;
  margin-bottom: 30px;

  .mantine-SegmentedControl-control {
    border-color: transparent;
  }
`;


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import {
SegmentedControl as MantineSegmentedControl,
SegmentedControlProps,
SegmentedControlItem,
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/select/Select.stories.tsx
Tamaño: 1358 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Select } from './Select';

export default {
  title: 'Inputs/Select',
  component: Select,
  argTypes: {},
} as Meta<typeof Select>;

const Template: StoryFn<typeof Select> = ({ ...args }) => <Select {...args} />;

const data = [
  { value: 'Arial', label: 'Arial' },
  { value: 'Helvetica', label: 'Helvetica' },
  { value: 'Verdana', label: 'Verdana' },
  { value: 'Optima', label: 'Optima' },
  { value: 'Lato', label: 'Lato' },
  { value: 'sans-serif', label: 'sans-serif' },
  { value: 'blitz', label: 'Blitz.js' },
];

export const PrimaryUse = Template.bind({});
PrimaryUse.args = {
  label: 'Font Family',
  data,
  description: 'Will be used as the main font-family in the in-app widget',
  placeholder: 'Select',
};

export const WithMultiSelect = Template.bind({});
WithMultiSelect.args = {
  type: 'multiselect',
  label: 'Font Family',
  data,
  placeholder: 'Select',
};

export const SearchWithSelect = Template.bind({});
SearchWithSelect.args = {
  searchable: true,
  label: 'Font Family',
  data,
  placeholder: 'Find and select',
};

export const SearchWithMultiSelect = Template.bind({});
SearchWithMultiSelect.args = {
  searchable: true,
  type: 'multiselect',
  label: 'Font Family',
  data,
  placeholder: 'Find and select as many as you want',
};


### ANALISIS AUTOMATICO (ESPAÑOL) ###

import React from 'react';
import { StoryFn, Meta } from '@storybook/react';
import { Select } from './Select';
export default {
Contiene declaraciones 'import' (posible Python u otro).

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Añade un README describiendo qué hace este archivo.
- Si es parte de un proyecto, indica dependencia y punto de entrada.



################################################################################
Archivo: novu-next/libs/design-system/src/select/Select.styles.ts
Tamaño: 1696 bytes
Lenguaje detectado: TypeScript

### CONTENIDO ORIGINAL ###

import { createStyles, MantineTheme } from '@mantine/core';
import { colors } from '../config';

export const useSelectStyles = createStyles((theme: MantineTheme, _params, getRef) => {
  const dark = theme.colorScheme === 'dark';
  const rightSection = getRef('rightSection');

  return {
    rightSection: {
      ref: rightSection,
      color: `${dark ? theme.white : theme.colors.gray[8]} !important`,
      pointerEvents: 'none',
      marginRight: '2.5px',
    },
    dropdown: {
      backgroundColor: dark ? theme.colors.dark[4] : theme.white,
      borderRadius: '7px',
      padding: '5px',
      border: 'none',
      margin: '5px 0px',
      boxShadow: dark ? theme.shadows.lg : theme.shadows.md,
    },
    item: {
      padding: '10px',
      borderRadius: '5px',
      color: dark ? theme.white : theme.colors.gray[8],
      left: '5px',
      top: '5px',
      margin: '2.5px 0px',
      lineHeight: '20px',
      '&[data-selected]': {
        color: dark ? theme.white : theme.colors.gray[8],
        backgroundColor: dark
          ? theme.fn.lighten(theme.colors.dark[5], 0.1)
          : theme.fn.darken(theme.colors.gray[2], 0.1),
      },
      '&[data-hovered]:not([data-selected])': {
        backgroundColor: dark ? theme.colors.dark[5] : theme.colors.gray[2],
      },
    },
    values: {
      height: 'auto',
      lineHeight: '50px',
    },
    value: {
      borderRadius: '5px',
      backgroundColor: dark ? theme.colors.dark[4] : theme.colors.gray[0],
      padding: '15px 7px 15px 10px',
      margin: '0px 5px',
      fontWeight: 400,
    },
    disabled: {
      [`& + .${rightSection}`]: {
        color: `${colors.B70} !important`,
      },
    },
  };
});


### ANALISIS AUTOMATICO (ESPAÑOL) ###

Asignaciones con arrow functions encontradas (posibles funciones):
 - useSelectStyles(createStyles((theme: MantineTheme, _params, getRef))
Declaraciones 'export' encontradas:
- export  const

### SUGERENCIAS PARA CREAR TU PROPIA VERSIÓN ###

- Revisa package.json para dependencias y scripts.
- Usa módulos (import/export) y prueba con node o bundler.
- Añade un README con pasos de instalación (npm install, npm start).



################################################################################
Archivo: novu-next/libs/design-system/src/select/Select.tsx
Tamaño: 4917 bytes
Lenguaje detectado: TSX

### CONTENIDO ORIGINAL ###

import React, { useMemo } from 'react';
import {
  Box,
  Select as MantineSelect,
  MultiSelect as MantineMultiSelect,
  CloseButton,
  InputBaseProps,
  MultiSelectValueProps,
  useMantineTheme,
  SelectItem,
  Loader,
} from '@mantine/core';
import styled from '@emotion/styled';
import { useSelectStyles } from './Select.styles';
import { inputStyles } from '../config/inputs.styles';
import { ArrowDown } from '../icons';
import { colors } from '../config';
import { Text } from '../index';
import { ISelectProps } from './Select.types';

/**
 * Select component
 *
 */
export const Select = React.forwardRef<HTMLInputElement, ISelectProps>(
  (
    {
      data,
      type = 'select',
      value,
      filter,
      searchable = false,
      creatable = false,
      loading = false,
      disabled = false,
      required = false,
      onChange,
      inputProps = {},
      dataTestId,
      withinPortal = false,
      className,
      ...props
    }: ISelectProps,
    ref
  