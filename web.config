<?xml version="1.0" encoding="utf-8"?>
<!--
     This configuration file is required if you are using Node.js Application hosted on IIS http server.
     (See https://github.com/Azure/iisnode)
-->
<configuration>
    <system.webServer>
        <!-- Visit https://github.com/Azure/iisnode/wiki/iisnode-configuration-for-Node.js-applications for more information about iisnode configuration -->
        <iisnode watchedFiles="*.js;*.mjs;*.cjs;iisnode.yml;next.config.js;package.json" />

        <handlers>
            <!-- Indicates that the server.js file is a Node.js site to be handled by the iisnode module -->
            <add name="iisnode" path="server.js" verb="*" modules="iisnode" />
        </handlers>
        <rewrite>
            <rules>
                <!-- Do not interfere with requests for node-inspector debugging -->
                <rule name="NodeInspector" patternSyntax="ECMAScript" stopProcessing="true">
                    <match url="^server.js\/debug[\/]?" />
                </rule>

                <!-- First we consider turning this request into a static file rewrite -->
                <rule name="StaticContent" stopProcessing="true">
                    <match url="([\S]+[.](html|htm|svg|js|css|png|gif|jpg|jpeg|ico|json|txt))" />
                    <action type="Rewrite" url="{R:1}" />
                </rule>

                <!-- All other URLs are mapped to the Node.js application entry point -->
                <rule name="DynamicContent">
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True" />
                    </conditions>
                    <action type="Rewrite" url="server.js" />
                </rule>
            </rules>
        </rewrite>

        <!-- You can control how Node is hosted within IIS by controlling attributes in the <iisnode> element. -->
        <!--
      <iisnode
          node_env="production"
          nodeProcessCommandLine="&quot;%programfiles%\nodejs\node.exe&quot;"
          nodeProcessCountPerApplication="1"
          maxConcurrentRequestsPerProcess="1024"
          maxNamedPipeConnectionRetry="3"
          namedPipeConnectionRetryDelay="2000"
          maxLogFileSizeInKB="128"
          maxTotalLogFileSizeInKB="1024"
          loggingEnabled="true"
          logDirectory="iisnode"
          devErrorsEnabled="true"
          flushResponse="false"
          debuggingEnabled="true"
          debugPort="5858"
          debuggerExtensionDll="iisnode-inspector.dll"
      />
      -->
    </system.webServer>
</configuration>
