<!--
    Esta es la configuración para ejecutar una aplicación Next.js en IIS usando iisnode.
    Asegura que las solicitudes se redirijan correctamente a la aplicación Node.js.
-->
<configuration>
    <system.webServer>
        <handlers>
            <!-- 
                Indica que iisnode debe manejar las solicitudes. 
                El asterisco (*) significa que interceptará todas las rutas.
            -->
            <add name="iisnode" path="src/server.js" verb="*" modules="iisnode"/>
        </handlers>

        <rewrite>
            <rules>
                <!-- 
                    Regla 1: No reescribir las solicitudes que ya están destinadas a la lógica del servidor de Next.js
                    (como las rutas de API internas o los archivos estáticos de la carpeta .next).
                    Esto evita bucles de reescritura.
                -->
                <rule name="next-server">
                    <match url="/*" />
                    <action type="Rewrite" url="src/server.js" />
                </rule>
            </rules>
        </rewrite>

        <!-- 
            Habilita el logging de iisnode para depuración. 
            Los logs se generarán en la carpeta 'iisnode' dentro del directorio de la aplicación.
            Es útil descomentar esto si encuentras errores 500 en producción.
        -->
        <!-- 
        <iisnode      
            loggingEnabled="true"
            logDirectory="iisnode"
        />
        -->

    </system.webServer>
</configuration>